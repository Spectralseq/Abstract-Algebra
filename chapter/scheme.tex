\chapter{The language of schemes}
\section{Affine schemes}
Let $A$ be a ring. Recall that we have associate with $A$ a topological space $\Spec(A)$, called the spectrum of $A$. In this section we shall make $\Spec(A)$ a locally ringed space and consider sheaf of modules over it; such spaces will be called \textbf{affine schemes}. 
\subsection{Sheaves associated with a module}
Let $A$ be a ring and $M$ an $A$-module. For any element $f\in A$, let $S_f$ be the multiplicative subset consisting of powers of $f$. Recall that the localization of $M$ with respect to $S_f$ is then denoted by $M_f$, and that of $A$ by $A_f$. Let $\widebar{S}_f$ be the saturation of $S_f$, which is defined to be the complement of the union of prime ideals of $A$ that are disjoint from $S_f$, or equivalently not contains $f$. By \cref{localization multiplicative saturation def}, the set $\widebar{S}_f$ is also characterized by
\[\widebar{S}_f=\{x\in A:\text{there exist $n,m\geq 0$ such that $f^nx=f^m$}\}.\]
Also, by \cref{localization ring isomorphism iff saturation}, we have $\widebar{S}_fA=A_f$ and $\widebar{S}_fM=M_f$.
\begin{lemma}\label{scheme affine f g localization same iff}
Let $f,g$ be elements of $A$. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $g\in\widebar{S}_f$, or equivalently $\widebar{S}_g\sub\widebar{S}_f$;
\item[(\rmnum{2})] $f\in\sqrt{(g)}$, or equivalently $\sqrt{(f)}\sub\sqrt{(g)}$;
\item[(\rmnum{3})] $D(f)\sub D(g)$, or equivalently $V(g)\sub V(f)$.
\end{enumerate}
\end{lemma}
\begin{proof}
We first note that $g\in\widebar{S}_f$ is equivalent to $S_g\sub\widebar{S}_f$, so the equivalence in (\rmnum{1}). Also, the equivalence of (\rmnum{2}) and (\rmnum{3}) follows from \cref{Spec of ring closed subsets prop}. Finally, if $g\in\widebar{S}_f$, then there exist $n,m\geq 0$ such that $f^ng=f^m$, which is an element of $(g)$, and thus $f\in\sqrt{(g)}$. Conversely, if $D(f)\sub D(g)$, then by the discriptions $S_f=\bigcup_{f\notin\p}\p$ and $S_g=\bigcup_{g\notin\p}\p$, we conclude that $\widebar{S}_g\sub\widebar{S}_f$, whence the lemma.
\end{proof}
If $D(g)\sub D(f)$ in $\Spec(A)$, then by \cref{scheme affine f g localization same iff}, we have $\widebar{S}_f\sub\widebar{S}_g$, so there is a canonical homomorphism $\rho_{g,f}:M_f\to M_g$; moreover, if $D(f)\sups D(g)\sups D(h)$, we then have
\[\rho_{h,g}\circ\rho_{g,f}=\rho_{h,f}.\]
As $f$ runs through $A-\p$ (where $\p$ is a point in $X=\Spec(A)$), the set $S_f$ then constitute a filtered set indexed by $A-\p$, since any two element $f,g$ of $A-\p$ contains $S_{fg}$; as the union of the $S_f$ for $f\in A-\p$ is $A-\p$, we conclude from \cref{localization and direct limit} that the $A_\p$-module $M_\p$ is canonically identified with the direct limit $\rlim M_f$, relative to the family $(\rho_{g,f})$ of homomorphisms. For each $f\in A-\p$, we denote the canonical homomorphism from $M_f$ to $M_\p$ by
\[\rho_{\p}^{f}:M_f\to M_\p.\]

We now define the \textbf{structural sheaf} of the prime spectrum $X=\Spec(A)$, denoted by $\widetilde{A}$, to be the sheaf of rings associated with the presheaf $D(f)\mapsto A_f$ over the basis $\mathcal{B}$ of $X$, formed by $D(f)$ with $f\in A$. Simialrly, for an $A$-module $M$,we define the \textbf{associated sheaf} $\widetilde{M}$ to be the sheaf associated presheaf $D(f)\mapsto M_f$ over the basis $\mathcal{B}$ of $X$. By the property of sheafification, it is clear that the stalk $\widetilde{A}_\p$ (resp. $\tilde{M}_\p$) is identified with the ring $A_\p$ (resp. with $A_\p$-module $M_\p$). 
\begin{theorem}\label{scheme affine associated sheaf section on D(f)}
For each $A$-module $M$, the presheaf $D(f)\to M_f$ is a sheaf on the basis $\mathcal{B}$ of $X$, so for each $f\in A$ we have a canonical isomorphism
\[M_f\to\Gamma(D(f),\widetilde{M}).\]
In particular, $M$ is canonically identified with $\Gamma(X,\widetilde{M})$.
\end{theorem}
\begin{proof}
To show that the presheaf $D(f)\mapsto M_f$ is a sheaf on the basis $\mathcal{B}$ of $X$, we need to check the sheaf condition for the standard open coverings. If $D(f)=\bigcup_{i=1}^{n}D(g_i)$, then the sheaf condition for this covering is equivalent with the exactness of the sequence
\[\begin{tikzcd}
0\ar[r]&M_f\ar[r]&\bigoplus_iM_{g_i}\ar[r]&\bigoplus_{i,j}M_{g_ig_j}
\end{tikzcd}.\]
Note that $D(g_i)=D(fg_i)$, and hence we can rewrite this sequence as the sequence
\[\begin{tikzcd}
0\ar[r]&M_f\ar[r]&\bigoplus_iM_{fg_i}\ar[r]&\bigoplus_{i,j}M_{fg_ig_j}
\end{tikzcd}.\]
Since the $D(g_i)$'s cover $D(f)$ (which is identified with $\Spec(A_f)$), the elements $g_1,\dots,g_n$ generate the unit ideal in $A_f$, so we may apply \cref{localization glue exact seq module} to the module $M_f$ over $A_f$ and the elements $g_1,\dots,g_n$ to conclude that the sequence is exact.
\end{proof}
\begin{corollary}\label{scheme affine associated sheaf Hom bijection}
Let $M$, $N$ be $A$-modules. The canonical homomorphism 
\[\Hom_A(M,N)\to\Hom_{\widetilde{A}}(\widetilde{M},\widetilde{N}),\quad \phi\mapsto\tilde{\phi}\]
is bijective. In particular, the relations $M=0$ and $\widetilde{M}=0$ are equivalent.
\end{corollary}
\begin{proof}
Consider the canonical homomorphism $\Hom_{\widetilde{A}}(\widetilde{M},\widetilde{N})\to\Hom_{A}(M,N),\varphi\mapsto\Gamma(\varphi)$ (\cref{scheme affine associated sheaf section on D(f)}). It suffices to show that $\phi\mapsto\tilde{\phi}$ and $\varphi\mapsto\Gamma(\varphi)$ are inverses of each other. Now, it is evident that $\Gamma(\tilde{\phi})=\phi$, by the definition of $\tilde{\phi}$. On the other hand, if we put $\phi=\Gamma(\varphi)$ for $\varphi\in\Hom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$, the map $\varphi_{D(f)}:\Gamma(D(f),\widetilde{M})\to\Gamma(D(f),\widetilde{N})$ induced by $\varphi$ is making the following diagram commutes:
\[\begin{tikzcd}
M\ar[d,swap,"\rho_{f,1}"]\ar[r,"\phi"]&N\ar[d,"\rho_{f,1}"]\\
M_f\ar[r,"\varphi_{D(f)}"]&N_f
\end{tikzcd}\]
We then have necessarily $\varphi_{D(f)}=\phi_f$ for each $f\in A$, which shows $\widetilde{\Gamma(\varphi)}=\varphi$.
\end{proof}
\begin{proposition}\label{scheme affine associated sheaf restriction on D(f)}
For each $f\in A$, the open set $D(f)\sub X$ is canonically identified with the spectrum $\Spec(A_f)$, and the sheaf $\widetilde{M}_f$ associated with the $A_f$-module $M_f$ is canonically identified with the restriction $\widetilde{M}_{D(f)}$.
\end{proposition}
\begin{proof}
The first assertion is proved in \cref{Spec of ring induced map on spec(A_f)}. Now for $D(g)\sub D(f)$, then $M_g$ is identified with the localization of $M_f$ with respect to the canonical image of $g$ in $A_f$, so the canonical identification of $\tilde{M}_f$ and $\widetilde{M}_{D(f)}$ follows by definition.
\end{proof}
\begin{proposition}\label{scheme affine associated sheaf exact}
The functor $M\mapsto\widetilde{M}$ is an exact functor from the category of $A$-modules to the category of $\widetilde{A}$-modules.
\end{proposition}
\begin{proof}
Let $M,N$ be two $A$-modules and $\phi:M\to N$ a homomorphism; for any $f\in A$, we have a corresponding homomorphism $\phi_f:M_f\to N_f$, and for $D(g)\sub D(f)$ the diagram
\[\begin{tikzcd}
M_f\ar[r,"\phi_f"]\ar[d,swap,"\rho_{g,f}"]&N_f\ar[d,"\rho_{g,f}"]\\
M_g\ar[r,"\phi_g"]&N_g
\end{tikzcd}\]
is commutative. These then give a homomorphism of $\widetilde{A}$-modules $\tilde{\phi}:\widetilde{M}\to\widetilde{N}$. Moreover, for each $\p\in X$, $\tilde{\phi}_x$ is the direct limit of $\phi_f$ for $f\in A-\p$, and concequently identified with the canonical homomorphism $\phi_\p:M_\p\to N_\p$. If $P$ is another $A$-module, $\psi:N\to P$ a homomorphism and $\eta=\psi\circ\phi$, then it is immediate that $\eta_\p=\psi_\p\circ\phi_\p$, hence $\tilde{\eta}=\tilde{\psi}\circ\tilde{\phi}$. We thus get a covariant functor $\widetilde{(-)}$ from the category of $A$-modules to the category of $\widetilde{A}$-modules. This functor is exact since for each $\p\in X$, $M\mapsto M_\p$ is an exact functor; furthermore, we have $\supp(M)=\supp(\widetilde{M})$ by the definitions of these two members.
\end{proof}
\begin{corollary}\label{scheme affine associated sheaf ker and coker}
Let $M$ and $N$ be two $A$-modules.
\begin{enumerate}
\item[(a)] If $\phi:M\to N$ is a homomorphism, then the sheaves associated with $\ker\phi$, $\im\phi$, and $\coker\phi$ are $\ker\tilde{\phi}$, $\im\tilde{\phi}$, and $\coker\tilde{\phi}$, respectively. In particular, $\tilde{\phi}$ is injective (resp. surjective, bijective) if and only if $\phi$ is injective (resp. surjective, bijective).
\item[(b)] If $M$ is a filtered limit (resp. direct sum) of a family $(M_i)_{i\in I}$ of $A$-modules, then $\widetilde{M}$ is a filtered limit (resp. direct sum) of the family $(\widetilde{M}_i)$.
\end{enumerate}
\end{corollary}
\begin{proof}
For (a), it suffices to apply the exact functor $M\mapsto\widetilde{M}$ to the following exact sequences:
\[
\begin{gathered}
\begin{tikzcd}
0\ar[r]&\ker\phi\ar[r]&M\ar[r]&\im\phi\ar[r]&0
\end{tikzcd}\\
\begin{tikzcd}
0\ar[r]&\im\phi\ar[r]&N\ar[r]&\coker\phi\ar[r]&0
\end{tikzcd}
\end{gathered}
\]
Now let $(M_i,\rho_{ji})$ be a filtered system of $A$-modules, with limit $M$, and let $\rho_i:M_i\to M$ be the canonical homomorphism. Since we have $\tilde{\rho}_{kj}\circ\tilde{\rho}_{ji}=\tilde{\rho}_{ji}$ and $\tilde{\rho}_i=\tilde{\rho}_j\circ\tilde{\rho}_{ji}$ for $i\leq j\leq k$, we see $(\widetilde{M},\tilde{\rho}_{ji})$ is a direct system of sheaves over $X$, and if we denote by $\eta_i:\widetilde{M}_i\to\rlim\widetilde{M}_i$ the canonical homomorphism, a unique homomorphism $\psi:\rlim\widetilde{M}_i\to\widetilde{M}$ such that $\psi\circ\eta_i=\tilde{\rho}_i$. For this $\psi$ to be bijective, it suffices that for each $\p\in X$, $\psi_\p$ is a bijection from $(\rlim\widetilde{M}_i)_\p$ to $\widetilde{M}_\p$; but $\widetilde{M}_\p=M_\p$ and
\[(\rlim\widetilde{M}_i)_\p=\rlim(\widetilde{M}_i)_\p=\rlim(M_i)_\p=M_\p\]
Also, it follows by definition that $(\tilde{\rho}_i)_\p$ and $(\eta_i)_\p$ are equal to the canonical homomorphism from $(M_i)_\p$ to $M_\p$; since $(\tilde{\rho}_i)_\p=\psi_\p\circ(\eta_i)_\p$, $\psi_\p$ is therefore the identity.\par
Finally, if $M$ is a direct sum of two modules $N$ and $P$, it is immediate that $\widetilde{M}=\widetilde{M}\oplus\widetilde{P}$; by taking filtered limits, we then generalize this result for the direct sum of an arbitrary family. This completes the proof.
\end{proof}
\begin{remark}
By \cref{scheme affine associated sheaf exact}, we conclude that the sheaves which are isomorphic to the sheaves associated with $A$-modules form an abelian category. Note also that it follows from \cref{scheme affine associated sheaf ker and coker} that if $M$ is a finitely generated $A$-module, that is, if there exists a surjective homomorphism $A^n\to M$, then there exists a homomorphism surjective $\widetilde{A}^n\to\widetilde{M}$, in other words, the $\widetilde{A}$-module $\widetilde{M}$ is generated by a finite family of sections over $X$, and vice versa.
\end{remark}
\begin{corollary}\label{scheme affine associated sheaf of submodule sum and inter}
Let $N$ and $P$ be submodules of $M$. The sheaves $\widetilde{N}$ and $\widetilde{P}$ can be identified with sub-$\widetilde{A}$-modules of $\widetilde{M}$, and we have
\[\widetilde{N+P}=\widetilde{N}+\widetilde{P},\quad \widetilde{N\cap P}=\widetilde{N}\cap\widetilde{P}.\]
In particular, if $\widetilde{N}=\widetilde{P}$, then $N=P$.
\end{corollary}
\begin{proof}
If $N$ is a submodule of an $A$-module $M$, the canonical injection $N\to M$ induced an injective homomorphism $\widetilde{N}\to\widetilde{M}$, hence identifies $\widetilde{N}$ with a sub-$\widetilde{A}$-module of $\widetilde{M}$. Now note that $N+P$ is the image of the canonical homomorphism $\alpha:N\oplus P\to M$, so by \cref{scheme affine associated sheaf ker and coker} we have
\[\widetilde{N+P}=\widetilde{\im\alpha}=\im\tilde{\alpha}=\widetilde{N}+\widetilde{P}\]
since $\tilde{\alpha}$ is equal to the canonical homomorphism $\widetilde{N}\oplus\widetilde{P}\to\widetilde{M}$. Similarly, since $N\cap P$ is the kenrel of the canonical homomorphism $M\to(M/N)\oplus(M/P)$, we also have $\widetilde{N\cap P}=\widetilde{N}\cap\widetilde{P}$.
\end{proof}
\begin{corollary}\label{scheme affine associated sheaf global section exact}
Over the category of sheaves isomorphic to sheaves associated with $A$-modules, the global section functor $\Gamma$ is exact.
\end{corollary}
\begin{proof}
In fact, let $\widetilde{M}\stackrel{\tilde{\phi}}{\to}\tilde{N}\stackrel{\tilde{\psi}}{\to}P$ be an exact sequence corresponding to two homomorphisms $\phi:M\to N$ and $\psi:N\to P$. If $Q=\im\phi$ and $R=\ker\psi$, we have 
\[\widetilde{Q}=\im\tilde{\phi}=\ker\tilde{\psi}=\widetilde{R}\]
by \cref{scheme affine associated sheaf ker and coker}, so $Q=R$ and the sequence is exact.
\end{proof}
\begin{corollary}\label{scheme affine associated sheaf tensor and Hom}
Let $M$ and $N$ be two $A$-modules.
\begin{enumerate}
\item[(a)] The sheaf associated with $M\otimes_AN$ is canonically identified with $\widetilde{M}\otimes_{\widetilde{A}}\widetilde{N}$.
\item[(b)] If moreover $M$ is finitely presented, the sheaf associated with $\Hom_A(M,N)$ is canonically identified with $\sHom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$.
\end{enumerate}
\end{corollary}
\begin{proof}
The sheaf $\mathscr{F}=\widetilde{M}\otimes_{\widetilde{A}}\widetilde{N}$ is the sheafification of the presheaf
\[U\mapsto\mathscr{F}(U)=\Gamma(U,\widetilde{M})\otimes_{\Gamma(U,\widetilde{A})}\Gamma(U,\widetilde{N})\]
where $U$ runs through the basis $\mathcal{B}$ of $X$ formed by $D(f)$, $f\in A$. Now, $\mathscr{F}(D(f))$ is canonically identified with $M_f\otimes_{A_f}N_f$ by \cref{scheme affine associated sheaf section on D(f)}, which is isomorphic to $\Gamma(D(f),\widetilde{M\otimes_AN})$. Moreover, it is immediately verified that the canonical isomorphisms
\[\mathscr{F}(D(f))\cong\Gamma(D(f),\widetilde{M\otimes_AN})\]
is compatible with the restriction maps, so they define a canonical isomorphism $\widetilde{M}\otimes_{\widetilde{A}}\widetilde{N}\cong\widetilde{M\otimes_AN}$.\par
Now assume that $M$ is finitely presented. The sheaf $\mathscr{G}=\sHom_{\widetilde{A}}(\widetilde{M},\widetilde{N})$ is the sheafification of the presheaf
\[U\mapsto\mathscr{G}(U)=\Hom_{\widetilde{A}|_U}(\widetilde{M}|_U,\widetilde{N}|_U)\]
where $U$ runs through the basis $\mathcal{B}$ of $X$. By \cref{scheme affine associated sheaf restriction on D(f)} and \cref{scheme affine associated sheaf Hom bijection}, the module $\mathscr{G}(D(f))$ is then identified with $\Hom_{A_f}(M_f,N_f)$, which is isomorphic to $\Gamma(D(f),\widetilde{\Hom_A(M,N)})$ by \cref{localization and Hom set if finite presented}. It is clear that these isomorphisms are compatible with the restriction maps, so we conclude that $\sHom_{\widetilde{A}}(\widetilde{M},\widetilde{N})\cong\widetilde{\Hom_A(M,N)}$.
\end{proof}
Now consider an $A$-algebra $B$ (commutative); this can be interpreted by saying that $B$ is an $A$-module and that we are given an element $e\in B$ and an $A$-homomorphism $\varphi:B\otimes_AB\to B$ so that the diagrams
\[\begin{tikzcd}
B\otimes_AB\otimes_AB\ar[r,"\varphi\otimes 1"]\ar[d,swap,"1\otimes\varphi"]&B\otimes_AB\ar[d,"\varphi"]&\\
B\otimes_AB\ar[r,"\varphi"]&B
\end{tikzcd}\quad\begin{tikzcd}
B\otimes_AB\ar[rd,swap,"\varphi"]\ar[rr,"\sigma"]&&B\otimes_AB\ar[ld,"\varphi"]\\
&B
\end{tikzcd}\]
(where $\sigma$ is the canonical symmetry) commute, and that $\varphi(e\otimes x)=\varphi(x\otimes e)=x$. In view of \cref{scheme affine associated sheaf tensor and Hom}, the homomorphism $\tilde{\varphi}:\widetilde{B}\otimes_{\widetilde{A}}\widetilde{B}\to\widetilde{B}$ of $\widetilde{A}$-modules satisfies similar conditions, hence defines a \textbf{$\widetilde{A}$-algebra} structure on $\widetilde{B}$. In the same way, the data of a $B$-module $N$ amounts to giving an $A$-module $N$ and an $A$-homomorphism $\psi:B\otimes_AN\to N$ such that the diagram
\[\begin{tikzcd}
B\otimes_AB\otimes_AN\ar[d,swap,"1\otimes\psi"]\ar[r,"\varphi\otimes 1"]&B\otimes_AN\ar[d,"\psi"]\\
B\otimes_AN\ar[r,"\psi"]&N
\end{tikzcd}\]
commutes and $\psi(e\otimes n)=n$; the homomorphism $\tilde{\psi}:\widetilde{B}\otimes_{\widetilde{A}}\widetilde{N}\to\widetilde{N}$ then satisfies similar conditions, and defines on $\widetilde{N}$ a $\widetilde{B}$-module structure.\par
If $\rho:B\to B'$ (resp. $\phi:N\to N'$) is a homomorphism of $A$-algebras (resp. a homomorphisms of $B$-modules), then $\tilde{\rho}$ (resp. $\tilde{\phi}$) is a homomorphism of $\widetilde{A}$-algebras (resp. a homomorphisms of $\widetilde{B}$-modules), $\ker\tilde{\rho}$ is an ideal of $\widetilde{B}$ (resp. $\ker\tilde{\phi}$, $\coker\tilde{\phi}$, and $\im\tilde{\phi}$ are $\widetilde{B}$-modules). Moreover, by \cref{Spec finite standard open cov glue property}(b) if $N$ is a $B$-module, then $\widetilde{N}$ is a finitely generated $\widetilde{B}$-module if and only if $N$ is finitely generated over $B$.\par
If $M$ and $N$ are two $B$-modules, the $\widetilde{B}$-module $\widetilde{M}\otimes_{\widetilde{B}}\widetilde{N}$ is canonically identified with $\widetilde{M\otimes_BN}$; similarly, $\sHom_{\widetilde{B}}(\widetilde{M},\widetilde{N})$ is canonically identified with $\widetilde{\Hom_B(M,N)}$ if $M$ is finitely presented. If $\b$ is an ideal of $B$, then $\widetilde{\b N}=\tilde{\b}\widetilde{N}$.\par
Finally, if $B$ is a graded $A$-algebra with $(B_n)$ its graduation, the $\widetilde{A}$-algebra $\widetilde{B}$ is then the direct sum of the sub-$\widetilde{A}$-modules $\widetilde{B}_n$ (\cref{scheme affine associated sheaf ker and coker}), so $(\widetilde{B}_n)$ is a graduation of $\widetilde{B}$. Similarly, if $M$ is a graded $B$-module with graduation $(M_n)$, then $\widetilde{M}$ is a graded $\widetilde{B}$-module with graduation $(\widetilde{M}_n)$.
\subsection{Functorial properties of the associated sheaf}
We now consider the functorial properties of the operation $M\mapsto\widetilde{M}$. Let $A$ and $B$ be rings and $\varphi:B\to A$ be a ring homomorphism. Then we have an associated map
\[^{a}\!\varphi:X=\Spec(A)\to Y=\Spec(B)\]
We will define a canonical homomorphism
\[\varphi^{\#}:\mathscr{O}_Y\to{^{a}\!\varphi}_*(\mathscr{O}_X)\]
of sheaf of rings. For any $g\in B$, we set $f=\varphi(g)$; we have $\varphi^{-1}(D(g))=D(f)$ by \cref{Spec of ring induced map prop}. Now the sections $\Gamma(D(g),\widetilde{B})$ and $\Gamma(D(f),\widetilde{A})$ are canonically identified with $B_g$ and $A_f$, respectively, and we have an induced map $\varphi_g:B_g\to A_f$, which then gives a homomorphism of rings
\[\Gamma(D(g),\widetilde{B})\to\Gamma(\varphi^{-1}(D(g)),\widetilde{A})=\Gamma(D(g),{^{a}\!\varphi}_*(\widetilde{A})).\]
Moreover, these homomorphisms satisfy the following compatible conditions: for $D(g)\sups D(g')$ in $Y$, the diagram
\[\begin{tikzcd}
\Gamma(D(g),\widetilde{A})\ar[r]\ar[d]&\Gamma(D(g),{^{a}\!\varphi}_*(\widetilde{A}))\ar[d]\\
\Gamma(D(g'),\widetilde{A})\ar[r]&\Gamma(D(g'),{^{a}\!\varphi}_*(\widetilde{A}))
\end{tikzcd}\]
is commutative; we then get a morphism of $\mathscr{O}_Y$-algebras, since $D(g)$ form a basis for the topological space $Y$. The couple $(^{a}\!\varphi,\varphi^{\#})$ is called the \textbf{canonical morphism} of the locally ringed spaces induced by $\varphi$.\par
We also note that, if $y={^{a}\!\varphi}(x)$, the homomorphism $\varphi^{\#}_x$ is no other that the homomorphism
\[\varphi_x:B_y\to A_x\]
induced by the homomorphism $\varphi:B\to A$. In fact, for $b/g\in B_y$, where $b,g\in B$ and $g\notin\p_y$, $D(g)$ is then an open neighborhood of $y$ in $Y$, and the homomorphism
\[\Gamma(D(g),\widetilde{B})\to\Gamma(D(g),({^{a}\!\varphi})_*(\widetilde{A}))\]
induced by $\varphi^{\#}$ is just $\varphi_g$; by considering the section $\xi\in\Gamma(D(g),\widetilde{B})$ corresponding to $b/g$, we then obtain that $\varphi^{\#}_x(\xi)=\varphi(b)/\varphi(g)$ in $A_x$.
\begin{example}
Let $S$ be a miltiplicative subset of $A$ and $\varphi:A\to S^{-1}A$ the canonical homomorphism. We have seen in \cref{Spec of ring and localization} that $^{a}\!\varphi$ is a homeomorphism from $Y=\Spec(S^{-1}A)$ to the subspace $X=\Spec(A)$ formed by $x$ such that $\p_x\cap S=\emp$. Moreover, for any $x$ in this subspace, hence of the form $^{a}\!\varphi(y)$ where $y\in Y$, the homomorphism $\varphi^{\#}_y:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ is bijective; therefore, $\mathscr{O}_Y$ is identified with the sheaf induced over $Y$ by $\mathscr{O}_X$.
\end{example}
\begin{proposition}\label{scheme affine associated sheaf direct image char}
Let $\varphi:B\to A$ be a ring homomorphism and $\Phi:X\to Y$ the associated morphism. For any $A$-module $M$, there exists a canonical functorial isomorphism of the $\mathscr{O}_Y$-module $\widetilde{\varphi^*(M)}$ to its direct image $\Phi_*(\widetilde{M})$.
\end{proposition}
\begin{proof}
For $g\in B$, put $f=\varphi(g)$; the modules $\Gamma(D(g),\widetilde{\varphi^*(M)})$ and $\Gamma(D(f),\widetilde{M})$ are identified with $(\varphi^*(M))_{g}$ and $M_f$, respectively; moreover, the $B_g$-module $\varphi_g^*(M_f)$ is canonically isomorphic to $(\varphi^*(M))_g$. We then have a functorial isomorphism of $\Gamma(D(g),\widetilde{B})$-modules:
\[\Gamma(D(g),\widetilde{\varphi^*(M)})\cong\varphi^*(\Gamma(D(\varphi(g)),\widetilde{M}))\]
and this isomorphism satisfies the compatible conditions with restrictions, hence define an isomorphism of sheaves. 
\end{proof}
This proof also proves that for any $A$-algebra $R$, the canonical functorial isomorphism $\widetilde{\varphi^*(R)}\to\Phi_*(\widetilde{R})$ is an isomorphism of $\mathscr{O}_Y$-algebras. If $M$ is an $R$-module, the canonical isomorphism $\widetilde{\varphi^*(M)}\cong\Phi_*(\widetilde{M})$ is an isomorphism of $\Phi_*(\widetilde{R})$-modules.
\begin{corollary}\label{scheme affine direct image exact on qcoh sheaf}
The direct image functor $\Phi_*$ is exact on the category of quasi-coherent sheaves.
\end{corollary}
\begin{proof}
Recall that the functor $\varphi^*$ is exact and $M\mapsto\widetilde{M}$ is an exact functor.
\end{proof}
\begin{proposition}\label{scheme affine associated sheaf inverse image char}
Let $\varphi:B\to A$ be a ring homomorphism and $\Phi:X\to Y$ the associated morphism. Let $N$ be a $B$-module and $\varphi_*(N)$ the $A$-module $N\otimes_BA$. Then there exist a canonical functorial isomorphism of the $\mathscr{O}_X$-module $\Phi^*(\widetilde{N})$ to $\widetilde{\varphi_*(N)}$. 
\end{proposition}
\begin{proof}
We first remark that $j:z\mapsto z\otimes 1$ is a $B$-homomorphism from $N$ to $\varphi^*\varphi_*(N)$: this holds because for $g\in B$, we have
\[(gz)\otimes 1=z\otimes\varphi(g)=\varphi(g)(z\otimes 1).\]
By \cref{scheme affine associated sheaf Hom bijection}, this corresponds to a homomorphism $\tilde{j}:\widetilde{N}\to\widetilde{\varphi^*(\varphi_*(N))}$ of $\mathscr{O}_Y$-modules, and via \cref{scheme affine associated sheaf direct image char} we can think that $\tilde{j}$ maps $\widetilde{N}$ to $\Phi_*(\widetilde{\varphi_*(N)})$. From the adjointness of $\Phi^*$ and $\Phi_*$, this canonically corresponds to a homomorphism
\[\theta:\Phi^*(\widetilde{N})\to\widetilde{\varphi_*(N)}.\]
It then remains to show that $\theta$ is bijective, or equivalently that $\theta_x$ is bijective for every $x\in X$. For this, put $y={^{a}\!\varphi}(x)$, choose $g\in B$ such that $y\in D(g)$, and let $f=\varphi(g)$. Then the ring $\Gamma(D(f),\widetilde{A})$ is identified with $A_f$, the module $\Gamma(D(f),\widetilde{\varphi_*(N)})$ is identified with $(\varphi_*(N))_f$, and $\Gamma(D(g),\widetilde{N})$ is identified with $N_g$. Let $s=n/g^p$ ($n\in N$) be a section of $\Gamma(D(g),\widetilde{N})$ and $t=a/f^q$ ($a\in A$) a section of $\Gamma(D(f),\widetilde{A})$. Then, since $s$ is send to $(n\otimes 1)/f^p$ be $\tilde{j}$, by definition we have
\[\theta_x(s_x\otimes t_x)=t_x\cdot s_x.\]
Recall that we can identify $(\varphi_*(N))_f$ with $N_f\otimes_{B_g}\varphi^*(A_f)$, under which $n/g^p$ is identified with $(n/g^p)\otimes 1$. So it is immediately seen that $\theta_x$ is none other than the canonical isomorphism
\[N_y\otimes_{B_y}\varphi_y^*(A_x)\cong(\varphi_*(N))_x=(N\otimes_{B}\varphi^*(A))_x.\]
Finally, let $v:N_1\to N_2$ be a homomorphism of $B$-modules; since $\tilde{v}_y=v_y$ for any $y\in Y$, it follows immediately from the preceding argument that $\Phi^*(\tilde{v})$ is canonically identified to $\widetilde{v\otimes 1}$, which completes the proof.
\end{proof}
If $S$ is an $B$-algebra, the canonical isomorphism of $\Phi^*(\widetilde{S})$ to $\widetilde{\varphi_*(S)}$ is an isomorphism of $\mathscr{O}_X$-algebras; if moreover $N$ is a $S$-module, the canonical isomorphism of $\Phi^*(\widetilde{N})$ to $\widetilde{\varphi_*(N)}$ is an isomorphism of $\Phi^*(\widetilde{S})$-algebras.
\begin{corollary}\label{scheme affine associated sheaf generator of Phi^* by image}
The sections of $\Phi^*(\widetilde{N})$ which are cannical images of section of the $B$-module $\Gamma(\widetilde{N})$, generate the $A$-module $\Gamma(\Phi^*(\widetilde{N}))$.
\end{corollary}
\begin{proof}
In fact, these images are identified with the elements $z\otimes 1$ of $\varphi_*(N)$, if we identify $N$ and $\varphi_*(N)$ with $\Gamma(\widetilde{N})$ and $\Gamma(\widetilde{\varphi_*(N)})$.
\end{proof}
By the proof of \cref{scheme affine associated sheaf inverse image char}, we see that the canonical map $\alpha:\widetilde{N}\to\Phi_*\Phi^*(\widetilde{N})$ is none other than the homomorphism $\tilde{j}$, where $j:N\to\varphi_*(N)$ is the canonical map $z\mapsto z\otimes 1$. Similarly, the canonical map $\beta:\Phi^*\Phi_*(\widetilde{M})\to\widetilde{M}$ is none other than the homomorphism $\tilde{p}$, where $p:\varphi^*(M)\otimes_B\varphi^*(A)\to M$ is the canonical homomorphism that sends $m\otimes a$ to $am$.
\begin{corollary}\label{scheme affine associated sheaf Phi^* and Hom}
Let $N_1$ and $N_2$ be $B$-modules and assume that $N_1$ is finitely presented. Then there is a canonical homomorphism
\[\Phi^*(\sHom_{\widetilde{B}}(\widetilde{N}_1,\widetilde{N}_2))\to\sHom_{\widetilde{A}}(\Phi^*(\widetilde{N}_1),\Phi^*(\widetilde{N}_2)).\]
This homomorphism is bijective if $\varphi$ is a flat homomorphism.
\end{corollary}
\begin{proof}
By the above remarks and \cref{scheme affine associated sheaf tensor and Hom}, this homomorphism is induced by the homomorphism
\[\Hom_B(N_1,N_2)\otimes_BA\to\Hom_A(N_1\otimes_BA,N_2\otimes_BA).\]
The last assertion follows from \cref{module flat algebra extension of Hom}.
\end{proof}
A locally ringed space $(X,\mathscr{O}_X)$ is called an \textbf{affine scheme} if it is isomorphic to the spectrum of a ring $A$. In this case, the ring $\Gamma(X,\mathscr{O}_X)$ is canonically identified with $A$. By absuing language, we often call $\Spec(A)$ an affine scheme, without mention the structural sheaf.\par
Let $A$ and $B$ be two rings and $(X,\mathscr{O}_X)$, $(Y,\mathscr{O}_Y)$ the corresponding affine schemes. Then any ring homomorphism $\varphi:B\to A$ corresponds to a morphism $({^{a}\!\varphi},\varphi^{\#}):(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$. Note that the homomorphism $\varphi$ is completely determined by $({^{a}\!\varphi},\varphi^{\#})$, since by definition we have $\varphi=\Gamma(\varphi^{\#}):\Gamma(\widetilde{B})\to\Gamma(\widetilde{A})$.
\begin{theorem}\label{scheme affine morphism char by ring homomorphism}
Let $(X,\mathscr{O}_X)$ and $(Y,\mathscr{O}_Y)$ be two affine schemes. Then any morphism $(\psi,\psi^{\#}):(X,\mathscr{O}_X)\to (Y,\mathscr{O}_Y)$ of locally ringed spaces is of the form $({^{a}\!\varphi},\varphi^{\#})$, where $\varphi:\Gamma(Y,\mathscr{O}_Y)\to\Gamma(X,\mathscr{O}_X)$ is a ring homomorphism.
\end{theorem}
\begin{proof}
Put $A=\Gamma(X,\mathscr{O}_X)$ and $B=\Gamma(Y,\mathscr{O}_Y)$. Let $(\psi,\psi^{\#}):(X,\mathscr{O}_X)\to (Y,\mathscr{O}_Y)$ be a morphism of locally ringed spaces. By definition, $\psi^{\#}$ is a homomorphism from $\mathscr{O}_Y$ to $\psi_*\mathscr{O}_X$, and we then deduce a canonical homomorphism of rings
\[\varphi=\Gamma(\psi^{\#}):B=\Gamma(Y,\mathscr{O}_Y)\to\Gamma(Y,\psi_*\mathscr{O}_X)=\Gamma(X,\mathscr{O}_X)=A.\]
Since $\psi^{\#}_x$ is a local homomorphism, by passing to quotients we deduce a monomorphism $\theta^x$ from the residue field $\kappa(\psi(x))$ into the residue field $\kappa(x)$ such that, for any section $f\in\Gamma(Y,\mathscr{O}_Y)$, we have $\theta^x(f(\psi(x)))=\varphi(f)(x)$ (we consider the elements of $\Gamma(Y,\mathscr{O}_Y)$ as functions on $B$). The relationship $f(\psi(x))=0$ is therefore equivalent to $\varphi(f)(x)=0$, which means $\psi(x)={^{a}\!\varphi}(x)$. Since this hold for any $x\in X$, we conclude that $\psi={^{a}\!\varphi}$. We also know that the diagram
\[\begin{tikzcd}
B=\Gamma(Y,\mathscr{O}_Y)\ar[r,"^{a}\!\varphi"]\ar[d]&\Gamma(X,\mathscr{O}_X)=A\ar[d]\\
B_{\psi(x)}\ar[r,"\psi^{\#}_x"]&A_x
\end{tikzcd}\]
is commutative, so $\psi^{\#}_x$ is equal to the homomorphism $\varphi_x:B_{\psi(x)}\to A_x$ induced from $\varphi$. Since the morphism $\psi^{\#}$ is determined by $\psi^{\#}_x$, we obtain that $\psi^{\#}=\varphi^{\#}$.
\end{proof}
\begin{corollary}
Let $(X,\mathscr{O}_X)$ and $(Y,\mathscr{O}_Y)$ be two affine schemes. Then there is a canonical bijection
\[\Mor(X,Y)\to\Hom_{\mathbf{Ring}}(\Gamma(Y,\mathscr{O}_Y),\Gamma(X,\mathscr{O}_X))\]
which sends a morphism $(f,f^{\#})$ to the global section of $f^{\#}$.
\end{corollary}
We can also say that the functors $(\Spec(A),\widetilde{A})$ in $A$ and $\Gamma(X,\mathscr{O}_X)$ in $(X,\mathscr{O}_X)$ define an equivalence of the opposite category of commutative rings and of the category of the category of affine schemes.
\begin{corollary}\label{scheme affine surjective ring map induce mono}
If $\varphi:B\to A$ is surjective, then the corresponding morphism $\Phi$ is a monomorphism of locally ringed spaces.
\end{corollary}
\begin{proof}
The map $^{a}\!\varphi$ is injective by \cref{Spec of ring and quotient map}, and since $\varphi$ is surjective, for any $x\in x$ the map $\varphi^{\#}_x:B_{{^{a}\!\varphi}(x)}\to A_x$, obtained by passing to localization, is surjective; these prove the assertion.
\end{proof}
\subsection{Quasi-coherent sheaves over affine schemes}
Recall that we have defined the abstract notion of a quasi-coherent sheaf. In this paragraph we show that any quasi-coherent sheaf on an affine scheme $\Spec(A)$ corresponds to the sheaf $\widetilde{M}$ associated with an $A$-module $M$.
\begin{lemma}\label{scheme sheaf principal open condition lemma}
Let $X=\Spec(A)$ and $V=\bigcup_{i=1}^{n}D(g_i)$ be a union of finitely may standard opens. Let $\mathscr{F}$ be an $\mathscr{O}_X$-module satisfying the conditions:
\begin{enumerate}
\item[(a)] For any $D(f)\sub D(g_i)$ (resp. $D(g_ig_j)$) and any section $s\in\Gamma(D(f),\mathscr{F})$, there exists $n\geq 0$ such that $f^ns$ can be extended to a section of $\mathscr{F}$ on $D(g_i)$ (resp. on $D(g_ig_j)$).
\item[(b)] For any $D(f)\sub D(g_i)$ (resp. $D(g_ig_j)$) and any section $t\in\Gamma(V,\mathscr{F})$ such that $t|_{D(f)}=0$, there exists $n\geq 0$ such that $f^nt=0$.
\end{enumerate}
Then we have the stronger conditions:
\begin{enumerate}
\item[($\alpha$)] For any $f\in A$ and any section $s\in\Gamma(D(f)\cap V,\mathscr{F})$, there exists $n\geq 0$ such that $f^ns$ can be extended to a section of $\mathscr{F}$ on $V$.
\item[($\beta$)] For any $f\in A$ and any section $t\in\Gamma(V,\mathscr{F})$ such that $t|_{D(f)\cap V}=0$, there exists $n\geq 0$ such that $f^nt=0$.
\end{enumerate}
\end{lemma}
\begin{proof}
First we prove condition ($\beta$). Since $D(f)\cap D(g_i)=D(fg_i)$, for each $i$ we have an integer $n_i\geq 0$ such that $(fg_i)^{n_i}t$ restricts to zero on $D(g_i)$. Since $g_i$ is invertible in $A_{g_i}=\Gamma(D(g_i),\mathscr{O}_X)$, this implies $f^{n_i}t=0$ on $D(g_i)$. Take $n$ such that $n\geq n_i$, then $f^nt=0$ on each $D(g_i)$, whence $f^nt=0$ and we get ($\beta$).\par
To show ($\alpha$), we apply (a) on $\mathscr{F}|_{D(g_i)}$ to get an integer integers $n_i\geq 0$ and $s'_i\in\Gamma(D(g_i),\mathscr{F})$ such that 
\[s'_i|_{D(fg_i)}=(fg_i)^{n_i}s|_{D(fg_i)}.\]
By inverting $g_i$, this produces sections $s_i\in\Gamma(D(g_i),\mathscr{F})$ such that 
\[s_i|_{D(fg_i)}=f^{n_i}s|_{D(fg_i)}.\]
We may assume that all $n_i$ take the same value $n$. Then each $s_i-s_j$ restricts to zero on $D(f)\cap D(g_i)\cap D(g_j)=D(fg_ig_j)$, so by applying (b) on $\mathscr{F}|_{D(g_ig_j)}$ we get an integer $m_{ij}$ such that
\[(fg_ig_j)^{m_{ij}}(s_i-s_j)|_{D(g_ig_j)}=0.\]
Then similarly, since $g_ig_j$ is invertible in $A_{g_ig_j}$, this implies
\[f^{m_{ij}}(s_i-s_j)|_{D(g_ig_j)}=0.\]
We can also assume that all $m_{ij}$'s take the same value $m$, so that by the sheaf condition there exists a section $u\in\Gamma(V,\mathscr{F})$ such that $u|_{D(g_i)}=f^ms_i$. Then $f^nu$ extends $f^{m+n}s$, as desired.
\end{proof}
\begin{theorem}\label{scheme affine qcoh sheaf on qc open char}
Let $X=\Spec(A)$ be an affine scheme. Let $V$ be a quasi-compact open subset and $\mathscr{F}$ be an $\mathscr{O}_X|_V$-module. Then the following are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] There is a $A$-module $M$ such that $\mathscr{F}$ is isomorphic to $\widetilde{M}|_V$.
\item[(\rmnum{2})] There exists a finite open covering $(V_i)$ of $V$ by sets of the form $D(f_i)$ ($f_i\in A$) contained in $V$, such that, for each $i$, $\mathscr{F}|_{V_i}$ is isomorphic to a sheaf of the form $\widetilde{M}_i$, where $M_i$ is an $A_{f_i}$-module.
\item[(\rmnum{3})] The sheaf $\mathscr{F}$ is quasi-coherent.
\item[(\rmnum{4})] (\textbf{Serre's lifting criterion}) The following conditions are satisfied:
\begin{enumerate}
\item[(a)] For any $D(f)\sub V$ and any section $s\in\Gamma(D(f),\mathscr{F})$, there exists $n\geq 0$ such that $f^ns$ can be extended to a section of $\mathscr{F}$ on $V$.
\item[(b)] For any $D(f)\sub V$ and any section $t\in\Gamma(V,\mathscr{F})$ such that $t|_{D(f)}=0$, there exists $n\geq 0$ such that $f^nt=0$.
\end{enumerate}
\end{enumerate}
\end{theorem}
\begin{proof}
The implication (\rmnum{1})$\Rightarrow$(\rmnum{2}) is immediate from \cref{scheme affine associated sheaf restriction on D(f)} since $X$ can be covered by standard opens. Also, since any $A$-module is isomorphic to the kernel of a homomorphism $A^{\oplus I}\to A^{\oplus J}$, \cref{scheme affine associated sheaf ker and coker} shows that (\rmnum{2})$\Rightarrow$(\rmnum{3}). Conversely, if $\mathscr{F}$ is quasi-coherent, any point $x\in V$ possesses a neighborhood of the form $D(f)\sub V$ such that $\mathscr{F}|_{D(f)}$ is isomorphic to the cokernel of a homomorphism $(\widetilde{A}_f)^{\oplus I}\to(\widetilde{A}_f)^{\oplus J}$, hence to the sheaf associated with the cokernel of the corresponding homomorphism $A_f^{\oplus I}\to A_f^{\oplus J}$ (\cref{scheme affine associated sheaf Hom bijection} and \cref{scheme affine associated sheaf ker and coker}); since $V$ is quasi-compact, it then follows that (\rmnum{3}) implies (\rmnum{2}).\par
Now we prove that (\rmnum{2})$\Rightarrow$(\rmnum{4}). First assume that $V=D(g)$ for some $g\in A$, and $\mathscr{F}$ is isomorphic to $\widetilde{N}$ for some $A_g$-module $N$. Since $D(g)$ can be identified with $\Spec(A_g)$, we can assume that $g=1$ and $V=X$. In this case, the set $\Gamma(D(f),\mathscr{F})$ and $N_f$ are canonically identified (\cref{scheme affine associated sheaf section on D(f)}), and it is clear that conditions (a) and (b) in (\rmnum{4}) are satisfied. To prove the general case, since $V$ is quasi-compact we can choose a finite covering by standard opens $D(g_i)$ with $\mathscr{F}|_{D(g_i)}$ isomorphic to $\widetilde{M}_i$ for some $A_{g_i}$-module $M_i$. Then $\mathscr{F}$ satisfies the conditions (a) and (b) in \cref{scheme sheaf principal open condition lemma}, so by \cref{scheme sheaf principal open condition lemma}, $\mathscr{F}$ also satisfies conditions ($\alpha$) and ($\beta$), which is what we want.\par
Finally, we show that (\rmnum{4})$\Rightarrow$(\rmnum{1}). First we prove that, if (a) and (b) hold for $\mathscr{F}$, then they hold for $\mathscr{F}|_{D(g)}$ with $D(g)\sub V$. This is evident for condition (a); as for (b), if $t\in\Gamma(D(g),\mathscr{F})$ restricts to zero on $D(f)\sub D(g)$, then by condition (a) there is an integer $m\geq 0$ such that $g^mt$ can be extended to $V$. By applying condition (b) on the extension of $g^mt$, we get another integer $n\geq 0$ such that $f^ng^mt=0$. Since $g$ is invertible in $A_g$, this gives $f^nt=0$ as desired.\par
This being done, since $V$ is quasi-compact, by \cref{scheme sheaf principal open condition lemma} we know that conditions ($\alpha$) and ($\beta$) holds for $\mathscr{F}$. Now consider the module $M=\Gamma(V,\mathscr{F})$; we shall define a morphism $\varphi:\widetilde{M}\to j_*\mathscr{F}$, where $j:V\hookrightarrow X$ is the inclusion. For this, it suffices to define
\[\varphi_f:M_f\to\Gamma(D(f),j_*\mathscr{F})=\Gamma(D(f)\cap V,\mathscr{F})\]
for each $f\in A$. Since $f$ is invertible in $A_f$ and $\Gamma(D(f)\cap V,\mathscr{F})$ is a $A_f$-module, the restriction $M=\Gamma(V,\mathscr{F})\to\Gamma(D(f)\cap V,\mathscr{F})$ factors into
\[\begin{tikzcd}
M\ar[r]&M_f\ar[r,"\varphi_f"]&\Gamma(D(f)\cap V,\mathscr{F})
\end{tikzcd}\]
which gives the desired maps $\varphi_f$. We now claim that the conditions (a) and (b) in (\rmnum{4}) imply that $\varphi$ is an isomorphism. In fact, if $s\in\Gamma(D(f)\cap V,\mathscr{F})$, then by condition (a) there exist an integer $n\geq 0$ and $z\in\Gamma(V,\mathscr{F})=M$ such that $z|_{D(f)\cap V}=f^ns$; then $\varphi_f(z/f^n)=s$, showing that $\varphi$ is surjective. Similarly, if there is $z\in M$ such that $\varphi_f(z/1)=0$ in $D(f)\cap V$, then by condition (b) there is $n\geq 0$ such that $f^nz=0$, so that $z/1=0$ in $M_f$. This means $\varphi_f$ is injective, so we get an isomorphism $\widetilde{M}\cong j_*\mathscr{F}$. By restriction, we then conclude that $\mathscr{F}\cong\widetilde{M}|_V$.
\end{proof}
\begin{corollary}\label{scheme affine qcoh cat equivalent to module}
Let $X=\Spec(A)$ be an affine scheme. Then the functors $M\mapsto\widetilde{M}$ and $\mathscr{F}\mapsto\Gamma(X,\mathscr{F})$ define equivalences of categories between the category of quasi-coherent $\mathscr{O}_X$-modules and the category of $A$-modules.
\end{corollary}
\begin{proof}
The space $X$ it self is quasi-compact, so we can apply \cref{scheme affine qcoh sheaf on qc open char}.
\end{proof}
\begin{corollary}\label{scheme affine qcoh kernel and cokernel}
Let $X=\Spec(A)$ be an affine scheme. Then kernels and cokernels of maps of quasi-coherent $\mathscr{O}_X$-modules are quasi-coherent.
\end{corollary}
\begin{proof}
This follows from the exactness of the functor $\widetilde{M}$ and \cref{scheme affine associated sheaf ker and coker}.
\end{proof}
\begin{corollary}\label{scheme affine qcoh ft and fp iff}
For $\widetilde{M}$ to be a $\mathscr{O}_X$-module of finite type (resp. of finite presentation), it is necessary and sufficient that $M$ is a finitely generated $A$-module (resp. of finite presentation).
\end{corollary}
\begin{proof}
In view of the exactness of the functor $M\mapsto\widetilde{M}$, it is immediate that if $M$ is of finite type (resp. finite presentation), so is $\widetilde{M}$. Conversely, if $\widetilde{M}$ is of finite type (resp. finite presentation), since $X$ is quasi-compact, there exists finitely many $f_i\in A$ such that $D(f_i)$ cover $X$ and $M_{f_i}$ is of finite type (resp. finite presentation) over $A_{f_i}$. It then follows from \cref{Spec finite standard open cov glue property} that $M$ is of finite type (resp. finite presentation).
\end{proof}
\begin{corollary}\label{scheme affine qcho local free iff finite projective}
For an $A$-module $M$, the $\mathscr{O}_X$-module is locally free of finite rank if and only if $M$ is a finitely generated projective $A$-module.
\end{corollary}
\begin{proof}
Since $X$ is quasi-compact, this follows from \cref{module finite projective iff}.
\end{proof}
\begin{corollary}\label{scheme affine qcoh sheaf of algebra is induced by module of algebra}
Let $X=\Spec(A)$ be an affine scheme. Then any quasi-coherent $\mathscr{O}_X$-algebra over $X$ is isomorphic to an $\mathscr{O}_X$-algebra of the form $\widetilde{B}$, where $B$ is an algebra over $A$. Moreover, any quasi-coherent $\widetilde{B}$-module is isomorphic to a $\widetilde{B}$-module of the form $\widetilde{N}$, where $N$ is a $B$-module.
\end{corollary}
\begin{proof}
In fact, a quasi-coherent $\mathscr{O}_X$-algebra is a quasi-coherent $\mathscr{O}_X$-module, hence of the form $\widetilde{B}$, where $B$ is an $A$-module. The fact that $B$ is an $A$-algebra follows from the structural morphism $\widetilde{B}\otimes_{\mathscr{O}_X}\widetilde{B}\to\widetilde{B}$ of $\mathscr{O}_X$-modules, which induces an $A$-algebra map $B\otimes_AB\to B$.\par
If $\mathscr{G}$ is a quasi-coherent $\widetilde{B}$-module, it suffices to show that $\mathscr{G}$ is also a quasi-coherent $\mathscr{O}_X$-module to then conclude in the same way. As the question is local, we can, by restricting ourselves to an open set of $X$ of the form $D(f)$, over which $\mathscr{G}$ is the cokernel of a morphism $\widetilde{B}^{\oplus I}\to\widetilde{B}^{\oplus J}$ of $\widetilde{B}$-modules (and a fortiori $\mathscr{O}_X$-modules). The claim then follows from \cref{scheme affine associated sheaf Hom bijection} and \cref{scheme affine associated sheaf ker and coker}.
\end{proof}
\begin{proposition}\label{scheme affine qcoh global section exact}
Let $X=\Spec(A)$ be an affine scheme, Suppose that
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}_1\ar[r]&\mathscr{F}_2\ar[r]&\mathscr{F}_3\ar[r]&0
\end{tikzcd}\]
is a short exact sequence of $\mathscr{O}_X$-modules, and assume that $\mathscr{F}_1$ is quasi-coherent. Then the sequence
\[\begin{tikzcd}
0\ar[r]&\Gamma(X,\mathscr{F}_1)\ar[r]&\Gamma(X,\mathscr{F}_2)\ar[r]&\Gamma(X,\mathscr{F}_3)\ar[r]&0
\end{tikzcd}\]
is exact.
\end{proposition}
\begin{proof}
We know already that $\Gamma$ is a left-exact functor so we have only to show that the last map is surjective (which we denot by $\psi:\Gamma(X,\mathscr{F}_2)\to\Gamma(X,\mathscr{F}_3)$). Let $s\in\Gamma(X,\mathscr{F}_3)$ be a global section. Since the morphism $\mathscr{F}_2\to\mathscr{F}_3$ is surjective, for any $x\in X$ there is an open neighborhood $D(f)$ of $x$ such that
\[s|_{D(f)}=\psi(t)\]
where $t\in\mathscr{F}_2(D(f))$. We claim that for some $n>0$, $f^ns=\psi(u)$ for some $u\in\Gamma(X,\mathscr{F}_2)$. Indeed, we can cover $X$ with a finite number of open sets $D(g_i)$ such that for each $i$, $s|_{D(g_i)}=\psi(t_i)$ for a section $t_i\in\mathscr{F}_2(D(g_i))$. Then by the exactness of the original sequence, on $D(f)\cap D(g_i)=D(fg_i)$ we have 
\[(t-t_i)|_{D(fg_i)}\in\mathscr{F}_1(D(fg_i))\]
where we identify $\mathscr{F}_1$ as the kernel of $\psi$. Since $\mathscr{F}_1$ is quasi-coherent, by \cref{scheme affine qcoh cat equivalent to module}, there is an integer $n\geq 0$ such that the $f^n(t-t_i)|_{D(fg_i)}$ can be extended to a section $u_i\in\mathscr{F}_1(D(g_i))$. Let 
\[\tilde{t}_i=f^nt_i+u_i\in\mathscr{F}_2(D(g_i)).\]
Then $\tilde{t}_i|_{D(fg_i)}=f^nt_i|_{D(fg_i)}+f^n(t-t_i)|_{D(fg_i)}=f^nt|_{D(fg_i)}$ and we have
\begin{align}\label{scheme affine qcoh global section exact-1}
f^ns|_{D(g_i)}=f^n\psi(t_i)=\psi(\tilde{t}_i-u_i)=\psi(\tilde{t}_i).
\end{align}
Now on $D(g_ig_j)$ the two sections $\tilde{t}_i$ and $\tilde{t}_j$ of $\mathscr{F}_2$ are mapped to $f^ns|_{D(g_ig_j)}$ by $\psi$, so $\tilde{t}_i-\tilde{t}_j\in\mathscr{F}_1(D(g_ig_j))$. Furthermore, since $\tilde{t}_i$ and $\tilde{t}_j$ are both equal to $f^nt|_{D(fg_ig_j)}$ on $D(fg_ig_j)$, by \cref{scheme affine qcoh cat equivalent to module} there exists $m\geq 0$ such that $f^m(\tilde{t}_i-\tilde{t}_j)=0$ on $D(g_ig_j)$, which we may take to be independent of $i$ and $j$. Then the sections $f^m\tilde{t}_i$ glue to give a global section of $\mathscr{F}_2$ over $X$, which lifts $f^{m+n}s$ by (\ref{scheme affine qcoh global section exact-1}). This proves the claim.\par
Now cover $X$ by a finite number of open sets $D(f_i)$ such that $s|_{D(f_i)}$ lifts to a section of $\mathscr{F}_2$ over $D(f_i)$ for each $i$. Then by the previous proof, we can find an integer $n\geq 0$ (one for all $i$) and global sections $t_i\in\Gamma(X,\mathscr{F}_2)$ such that $\psi(t_i)=f^ns$. Since the open sets $D(f_i)$ cover $X$, the ideal $(f_1^n,\dots,f_r^n)$ is the unit ideal of $A$, and we can write $1=\sum a_if_i^n$, with $a_i\in A$. Let $t=\sum a_it_i$. Then $t$ is a global section of $\mathscr{F}_2$ whose image under $\psi$ is $\sum a_if_i^ns=s$.
\end{proof}
\begin{proposition}\label{scheme affine colimit of qcoh is qcoh}
Let $X=\Spec(A)$ be an affine scheme. Then the direct sum of an arbitrary collection of quasi-coherent sheaves on $X$ is quasi-coherent. More generally, colimits of quasi-coherent sheaves are quasi-coherent.
\end{proposition}
\begin{proof}
Let $\{\mathscr{F}_i\}_{i\in I}$ be a collection of quasi-coherent sheaves on $X$. By \cref{scheme affine qcoh sheaf on qc open char} we can write $\mathscr{F}_i=\widetilde{M}_i$ for $A$-modules $M_i$, so the assertion follows from \cref{scheme affine associated sheaf ker and coker}.
\end{proof}
\begin{proposition}\label{scheme affine qcoh sheaf two of three}
Let $X$ be an affine scheme. Suppose that
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}_1\ar[r]&\mathscr{F}_2\ar[r]&\mathscr{F}_3\ar[r]&0
\end{tikzcd}\]
is a short exact sequence of sheaves $\mathscr{O}_X$-modules. If two out of three are quasi-coherent then so is the third.
\end{proposition}
\begin{proof}
The statement about kernels and cokernels follows from the fact that the functor $M\mapsto\widetilde{M}$ is exact and fully faithful from $A$-modules to quasi-coherent sheaves. Now let $\mathscr{F}_1$ and $\mathscr{F}_3$ be quasi-coherent. By \cref{scheme affine qcoh global section exact}, the corresponding sequence of global sections over $X$ is exact, say $0\to M_1\to M_2\to M_3\to 0$. Applying the functor $\widetilde{M}$ we get an exact commutative diagram
\[\begin{tikzcd}
0\ar[r]&\widetilde{M}_1\ar[r]\ar[d]&\widetilde{M}_2\ar[r]\ar[d]&\widetilde{M}_3\ar[r]\ar[d]&0\\
0\ar[r]&\mathscr{F}_1\ar[r]&\mathscr{F}_2\ar[r]&\mathscr{F}_3\ar[r]&0
\end{tikzcd}\]
The two outside arrows are isomorphisms, since $\mathscr{F}_1$ and $\mathscr{F}_3$ are quasi-coherent. So by the five lemma, the middle one is also, showing that $\mathscr{F}_2$ is quasi-coherent.
\end{proof}
\begin{theorem}\label{scheme affine Noe coh sheaf char}
Let $X=\Spec(A)$ be an affine scheme where $A$ is Noetherian. Let $V$ be an open subset of $X$ and $\mathscr{F}$ an $\mathscr{O}_X|_V$-module. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{F}$ is coherent.
\item[(\rmnum{2})] $\mathscr{F}$ is of finite type and quasi-coherent.
\item[(\rmnum{3})] There exists a finitely generated $A$-moduel $M$ such that $\mathscr{F}\cong\widetilde{M}|_V$.
\end{enumerate} 
\end{theorem}
\begin{proof}
It is clear that (\rmnum{1}) implies (\rmnum{2}). To show (\rmnum{2}) implies (\rmnum{3}), we note that $V$ is quasi-compact since $X$ is Noetherian, so by \cref{scheme affine qcoh sheaf on qc open char}, $\mathscr{F}$ is isomorphic to $\widetilde{M}|_V$, where $M$ is an $A$-module. Now we have $M=\rlim M_\lambda$, where $M_\lambda$ is the set of finitely generated sub-$A$-modules of $M$. Since the functor $\widetilde{(-)}$ is exact, this implies $\mathscr{F}=\widetilde{N}|_V=\rlim\widetilde{M_\lambda}|_V$. But $\mathscr{F}$ is of finite type and $V$ is quasi-compact, so by \cref{sheaf of module ft over qc surjective homomorphism prop} there exists an index $\lambda$ such that $\mathscr{F}=\widetilde{M_\lambda}|_V$ (note that the canonical homomorphism $\widetilde{M}_\lambda\to\widetilde{M}$ is injective). This proves (\rmnum{3}).\par
It remains to show that $\widetilde{M}|_V$ is coherent if $M$ is finitely generated. Since $\mathscr{F}$ is clearly of finite type, it suffices to show that for every open $U\sub X$ and $s_1,\dots,s_n\in\mathscr{F}(U)$, the associated map $\bigoplus_{i=1}^{n}\mathscr{O}_U\to\mathscr{F}|_U$ is of finite type. Since the question is local, we may assume $V=D(f)$ for $f\in A$. Then it suffices to show the kernel of a morphism $\bigoplus_{i=1}^{n}\widetilde{A}_f\to\widetilde{M}$ is of finite type. But this morphism corresponds to a homomorphism $A_f^n\to M$, whose kernel is finitely generated since $A_f$ is Noetherian, so the claim follows.
\end{proof}
\begin{corollary}
Let $X=\Spec(A)$ be an affine scheme where $A$ is Noetherian. Then any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ is the inductive limit of coherent $\mathscr{O}_X$-modules.
\end{corollary}
\begin{proof}
We have $\mathscr{F}=\widetilde{M}$ for an $A$-module $M$, and $M$ is the inductive limit of its finitely generated submodules.
\end{proof}
\begin{corollary}
Let $X=\Spec(A)$ be an affine scheme where $A$ is Noetherian. Then the functor $M\mapsto\widetilde{M}$ gives an equivalence of categories between the category of finite generated $A$-modules and the category of coherent $\mathscr{O}_X$-modules.
\end{corollary}
\section{General schemes}
\subsection{Schemes and morphisms of schemes}
Let $(X,\mathscr{O}_X)$ be a ringed space. An oepn subset $V$ of $X$ is said to be \textbf{affine} if the ringed space $(V,\mathscr{O}_X|_V)$ is an affine scheme (i.e. isomorphic to the spectrum of a ring). We say $(X,\mathscr{O}_X)$ is a \textbf{scheme} if every point of $X$ admits an affine open neighborhood. If $(X,\mathscr{O}_X)$ is a scheme, then affine open subsets of $X$ form a basis for $X$ (because the standard opens form a basis for a spectrum $\Spec(A)$, and they are again affine), and in particular $(X,\mathscr{O}_X)$ is a locally ringed space. With this, for any open subset $U$ of $X$, the ringed space $(U,\mathscr{O}_X|_U)$ is also a scheme, called the scheme \textbf{induced} on $U$ by $X$, or the \textbf{restriction} of $(X,\mathscr{O}_X)$ on $U$.
\begin{proposition}\label{scheme underlying space is Kolmogoroff}
The underlying space of a scheme is Kolmogoroff.
\end{proposition}
\begin{proof}
In fact, if $x$ and $y$ are two points of a scheme $X$, then it is obvious that there exists an open neighborhood of one of these points not containing the other if $x,y$ are not not in a same open affine; and if they are in the same open affine, this follows from the fact that the underlying spaces of affine schemes are Kolmogoroff (\cref{Spec of ring is Kolmogoroff}).
\end{proof}
\begin{proposition}\label{scheme irr closed unique generic point}
If $(X,\mathscr{O}_X)$ is a scheme, any irreducible closed subset of $X$ admits a unique generic point, and the map $x\mapsto\widebar{\{x\}}$ is a bijection of $X$ to the family of irreducible closed subsets of $X$.
\end{proposition}
\begin{proof}
Let $Y$ is an irreducible closed subset of $X$ and $y\in Y$. If $U$ is an affine open neighborhood of $y$ in $X$, then $U\cap Y$ is dense in $Y$ and is irreducible (\cref{topo space irreducible iff}), so it is the closure in $U$ of a point $x\in U$, and therefore $Y\sub\widebar{U}$ is the closure of $x$ in $X$. The uniqueness of the generic point of $X$ follows from \cref{scheme underlying space is Kolmogoroff} and (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 2.1.3).
\end{proof}
If $Y$ is an irreducible closed subset of $X$ and $y$ its generic point, the local ring $\mathscr{O}_{X,y}$ is then denoted by $\mathscr{O}_{X,Y}$ and called the \textbf{local ring of $\bm{X}$ along $\bm{Y}$}, or the \textbf{local ring of $\bm{Y}$ in $\bm{X}$}. We say a scheme $(X,\mathscr{O}_X)$ is \textbf{irreducible} (resp. \textbf{connected}) if the underlying space $X$ is irreducible (resp. connected), and \textbf{integral} if it is irreducible and reduced. We say the scheme $(X,\mathscr{O}_X)$ is \textbf{locally integral} if each point $x\in X$ admits an open neighborhoods $U$ such that the scheme induced over $U$ by $(X,\mathscr{O}_X)$ is integral. If $X$ is an irreducible scheme and $x$ is its generic point, the local ring $\mathscr{O}_{X,x}$ is called \textbf{the ring of rational functions on $\bm{X}$}.\par
Let $(X,\mathscr{O}_X)$ and $(Y,\mathscr{O}_Y)$ be schemes. A \textbf{morphism} (of schemes) from $(X,\mathscr{O}_X)$ to $(Y,\mathscr{O}_Y)$ is defined to be that of locally ringed space. That is, a pair $(f,f^{\#})$ such that for each $x\in X$, the homomorphism $f^{\#}_x$ is local. In this case, by passing to quotients, $f^{\#}_x$ induces a monomorphism $f^x:\kappa(f(x))\to\kappa(x)$, so $\kappa(x)$ can be considered as an extension of the field $\kappa(f(x))$.\par
The composition of two morphisms of schemes is defined in the same way with that of locally ringed spaces, and we then see that schemes form a category, denoted by $\mathbf{Sch}$. Following the general notation, we denote by $\Hom_{\mathbf{Sch}}(X,Y)$ the set of morphisms from a scheme $X$ to a scheme $Y$.\par
\begin{example}
Let $U$ be an open subset of $X$. Then the canonical injection of $(U,\mathscr{O}_X|_U)$ to $(X,\mathscr{O}_X)$ is a morphism of schemes; it is moreover a monomorphism of ringed spaces (and a fortiori a monomorphism of schemes).
\end{example}
\begin{proposition}\label{scheme morphism to affine correspond}
Let $(X,\mathscr{O}_X)$ be a scheme and $(Y,\mathscr{O}_Y)$ be an affine scheme. Then there exists a canonical bijection
\[\Hom_{\mathbf{Sch}}(X,Y)\to\Hom_{\mathbf{Ring}}(\Gamma(X,\mathscr{O}_X),\Gamma(X,\mathscr{O}_X)).\]
\end{proposition}
\begin{proof}
Let $A=\Gamma(Y,\mathscr{O}_Y)$. Note first that, if $(X,\mathscr{O}_X)$ and $(Y,\mathscr{O}_Y)$ are any two ringed spaces, a morphism $(\psi,\psi^{\#}):(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ canonically defines a homomorphism of rings
\[\Gamma(Y,\mathscr{O}_Y)\to\Gamma(Y,\psi_*(\mathscr{O}_X))=\Gamma(X,\mathscr{O}_X).\]
It then remains to see that any homomorphism $\rho:A\to\Gamma(X,\mathscr{O}_X)$ is of the form $\Gamma(\psi^{\#})$ for a unique morphism $(\psi,\psi^{\#})$. However, there is by hypothesis a covering $(V_\alpha)$ of $X$ by affine open sets. By considering the composition
\[\begin{tikzcd}
A\ar[r,"\rho"]&\Gamma(X,\mathscr{O}_X)\ar[r]&\Gamma(V_\alpha,\mathscr{O}_X|_{V_\alpha})
\end{tikzcd}\]
we obtain a homomorphism $\rho_\alpha:A\to\Gamma(V_\alpha,\mathscr{O}_X|_{V_\alpha})$, which corresponds to a morphism $(\psi_\alpha,\psi_\alpha^{\#})$ from the scheme $(V_\alpha,\mathscr{O}_X|_{V_\alpha})$ to $(Y,\mathscr{O}_Y)$ (\cref{scheme affine morphism char by ring homomorphism}). Moreover, for each pair $(\alpha,\beta)$ of indices, any point of $V_\alpha\cap V_\beta$ admits an affine open neighborhood $W$ contained in $V_\alpha\cap V_\beta$; it is clear that by composing $\rho_\alpha$ and $\rho_\beta$ with the restriction homomorphism to $W$, we obtain the same homomorphism $A\to\Gamma(W,\mathscr{O}_X|_W)$, so, by virtue of the relation $(\psi^{\#}_\alpha)_x=(\rho_\alpha)_x$ for any $x\in V_\alpha$ and any $\alpha$, the restrictions of $(\psi_\alpha,\psi_\alpha^{\#})$ and $(\psi_\beta,\psi_\beta^{\#})$ to $W$ coincide. By gluing we then get a unique morphism $(\psi,\psi^{\#}):(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ which extending $(\psi_\alpha,\psi_\alpha^{\#})$ on each $V_\alpha$. It is clear that $(\psi,\psi^{\#})$ is a morphism of schemes, and we have $\Gamma(\psi^{\#})=\rho$.
\end{proof}
\begin{remark}
Let $\rho:A\to\Gamma(X,\mathscr{O}_X)$ be a ring homomorphism, and let $(\psi,\psi^{\#})$ be the corresponding morphism $(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$. For each $f\in A$, we have
\[\psi^{-1}(D(f))=\{x\in X:f\notin\m_{\psi(x)}\}=\{x\in X:(\rho(x))_x\notin\m_x\}=X_{\rho(f)}.\]
Note that this can be viewed as a generalization of \cref{Spec of ring induced map prop}(a).
\end{remark}
\begin{proposition}\label{scheme morphism to affine qcoh sheaf}
Under the hypothesis of \cref{scheme morphism to affine correspond}, let $\rho:A\to\Gamma(X,\mathscr{O}_X)$ be a ring homomorphism and $f:(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ the corresponding morphism of schemes. Let $\mathscr{F}$ (resp. $\mathscr{G}$) be a quasi-coherent $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module). Then there exist a canonical bijection
\[\Hom_{\mathbf{Qcoh(Y)}}(\mathscr{G},f_*(\mathscr{F}))\to\Hom_A(\Gamma(Y,\mathscr{G}),\rho^*(\Gamma(X,\mathscr{F}))).\]
\end{proposition}
\begin{proof}
Indeed, by reasoning as in \cref{scheme morphism to affine correspond}, we are immediately reduced to the case where $X$ is affine and the proposition then follows from \cref{scheme affine associated sheaf Hom bijection} and \cref{scheme affine associated sheaf direct image char}.
\end{proof}
We say a morphism $f:(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ is \textbf{open} (resp. \textbf{closed}) if for any open subset $U$ of $X$ (resp. any closed subset $F$ of $X$), $f(U)$ is open in $Y$ (resp. $f(F)$ is closed in $Y$). We say $f$ is \textbf{dominant} if $f(X)$ is dense in $Y$, and \textbf{surjective} if $f$ is surjective. It should be noted that these conditions only involve the continuous map $f$.
\begin{proposition}\label{scheme morphism open closed surjective and composition}
Let $f:(X,\mathscr{O}_X)$ and $g:(Y,\mathscr{O}_Y)\to(Z,\mathscr{O}_Z)$ be morphisms of schemes.
\begin{enumerate}
\item[(a)] If $f$ and $g$ are open (resp. closed, dominant, surjective), so is the composition $g\circ f$.
\item[(b)] If $f$ is surjective and $g\circ f$ is closed, $g$ is closed.
\item[(c)] If $g\circ f$ is surjective, $g$ is surjective.
\end{enumerate}
\end{proposition} 
\begin{proof}
The assertions (a) and (c) are evident. Put $h=g\circ f$. If $F$ is closed in $Y$, then $f^{-1}(F)$ is closed in $X$, so $h(f^{-1}(F))$ is closed in $Z$. But since $f$ is surjective, we have $f(f^{-1}(F))=F$, so $h(f^{-1}(F))=g(F)$, which shows $g$ is closed.
\end{proof}
\begin{proposition}\label{scheme morphism open closed surjective local on target}
Let $f:(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ be a morphism of schemes and $(U_\alpha)$ an open covering of $Y$. For $f$ to be open (resp. closed, surjective, dominant), it is necessary and sufficient that for each $U_\alpha$, the restrictions $f:f^{-1}(U_\alpha)\to U_\alpha$ is open (resp. closed, surjective, dominant). 
\end{proposition}
\begin{proof}
The proposition follows immediately from the definitions, taking into account the fact that a subset $F$ of $Y$ is closed (resp. open, dense) in $Y$ if and only if each of the sets $F\cap U_\alpha$ is closed (resp. open, dense) in $U_\alpha$.
\end{proof}
Let $(X,\mathscr{O}_X)$ and $(Y,\mathscr{O}_Y)$ be schemes; suppose that $X$ and $Y$ have a same finite number of irreducible components $X_i$ (resp. $Y_i$) ($1\leq i\leq n$); let $\xi_i$ (resp. $\eta_i$) be the generic point of $X_i$ (resp. $Y_i$). We say that a morphism
\[f:(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)\]
is \textbf{birational} if, for any $i$, we have $f^{-1}(\eta_i)=\{\xi_i\}$ and $f^{\#}_{\xi_i}:\mathscr{O}_{Y,\eta_i}\to\mathscr{O}_{X,\xi_i}$ is an isomorphism. It is clear that any birational morphism is dominant, hence surjective if it is closed.
\begin{remark}
Throughout the remainder of this chapter and when there is no risk of creating confusion, we will omit in the notation of a scheme (resp. of a morphism) the structural sheaf (resp. the morphism of structural sheaf). If $U$ is an open subset of the underlying space of a scheme $X$, when we speak of $U$ as of a scheme, it will always be the scheme induced on $U$ by $X$.
\end{remark}
With the morphisms of schemes defined, we can talk about glueing schemes as in the case of ringed spaces. It follows immediately from the definition that any ringed space obtained by glueing schemes is again a scheme. In particular, since any scheme admits a basis of affine open subsets, we see any scheme is obtained by glueing affine schemes.
\begin{example}\label{scheme P^1 glueing construction}
Cosnider a field $K$, $A=K[s]$, $B=K[t]$ be two rings of polynomials over $K$ with one indeterminate, and $X_1=\Spec(A)$, $X_2=\Spec(B)$. In $X_1$ (resp. $X_2$), let $U_{12}$ (resp. $U_{21}$) be the affine open set $D(s)$ (resp. $D(t)$), whose ring $A_s$ (resp. $B_t$) is formed by the rational fractions of the form $f(s)/s^m$ (resp. $g(t)/t^n$) with $f\in A$ (resp. $g\in B$). Let $\varphi_{12}$ be the isomorphism of of schemes $U_{21}\to U_{12}$ corresponding to the isomorphism of $A$ and $B$ such that, $f(s)/s^m$ is mapped to the rational fraction $f(1/t)/(1/t^m)$ (i.e. we map $s$ to $1/t$). We can then glue $X_1$ and $X_2$ along $U_{12}$ and $U_{21}$ by the isomorphism $u_{12}$, which evidently satisfies the glueing condition. We will see later the schem $X$ thus obtained is a particular case of a general method of construction. We only show here that $X$ is not an affine scheme, which will result from the fact that the ring $\Gamma(X,\mathscr{O}_X)$ is isomorphic to $K$, therefore has a spectrum reduced to a point. Indeed, a section of $\mathscr{O}_X$ above $X$ has a restriction over $X_1$ (resp. $X_2$), identified with an open affine of $X$, which is a polynomial $f(s)$ (resp. $g(t)$), and it follows from the definition of $u_{12}$ that we must have $g(t)=f(1/t)$, which is not possible only if $f=g\in K$.
\end{example}
\subsection{Local schemes}
Let $X$ be a scheme and $A=\Gamma(X,\mathscr{O}_X)$. We say $X$ is a local scheme if $X$ is affine and the ring $X$ is local. In this case, there then exists a unique closed point $\xi$ in $X$, and for any point $x\in X$ we have $\xi\in\widebar{\{x\}}$.\par
Following this notation, for a general scheme $Y$ and $y\in Y$, the scheme $\Spec(\mathscr{O}_{Y,y})$ is called the \textbf{local scheme of $\bm{Y}$ at $\bm{y}$}. Let $V$ be an affine open subset of $Y$ containing $y$, and $B$ the ring of $V$. The local ring $\mathscr{O}_{Y,y}$ is then canonically identified with $B_y$, and the canonical homomorphism $B\to B_y$ then induces a morphism $\Spec(\mathscr{O}_{Y,y})\to V$ of schemes. If we compose this with the canonical injection of $V$ into $Y$, we then get a morphism $\Spec(\mathscr{O}_{Y,y})\to Y$, which is independent of the choice of the affine open $V$ containing $y$: in fact, if $U$ is another affine neighborhood of $y$, there exists an affine open neighborhood $W$ of $y$ contained in $U\cap V$; we can then limit ourselves to the case $U\sub V$, and if $A$ is the ring of $U$, we have a commutative diagram
\[\begin{tikzcd}
A\ar[rr]\ar[rd]&&B\ar[ld]\\
&\mathscr{O}_{Y,y}
\end{tikzcd}\]
The morphism $\Spec(\mathscr{O}_{Y,y})\to Y$ thus defined is said to be \textbf{canonical}.
\begin{proposition}\label{scheme local canonical morphism prop}
Let $Y$ be a scheme, $y\in Y$, and $f:\Spec(\mathscr{O}_{Y,y})\to Y$ be the canonical morphism.
\begin{enumerate}
\item[(a)] The map $f$ is a homeomorphism of $\Spec(\mathscr{O}_{Y,y})$ onto the subspace $S_y$ of points $z\in Y$ such that $y\in\widebar{\{z\}}$ (i.e. the set of generalizations of $y$).
\item[(b)] For each $\p\in\Spec(\mathscr{O}_{Y,y})$, the homomorphism $f^{\#}_\p:\mathscr{O}_{Y,f(\p)}\to(\mathscr{O}_{Y,y})_\p$ is an isomorphism.
\end{enumerate}
In particular, $f$ is a monomorphism of locally ringed spaces.
\end{proposition}
\begin{proof}
Since the unique closed point $\eta$ of $\Spec(\mathscr{O}_{Y,y})$ belongs to the closure of any other point in this space, and $f(\eta)=y$, the image of $\Spec(\mathscr{O}_{Y,y})$ by the continuous map $f$ is contained in $S_y$. As $S_y$ is contained in any affine open neighborhood of $y$, we can reduce to the case where $Y$ is an affine scheme; but in this case the proposition follows immediately.
\end{proof}
\begin{corollary}\label{scheme local scheme correspond generalization}
There is a bijective correspondence between $\Spec(\mathscr{O}_{Y,y})$ and irreducible closed subsets of $Y$ containing $y$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme local canonical morphism prop} and the fact that every irreducible closed set in $Y$ has a unique generic point.
\end{proof}
\begin{corollary}\label{scheme generic point of irre component iff local ring 0-dim}
For a point $y\in Y$ to be the generic point of an irreducible component of $Y$, it is necessary and suffcient that $\mathscr{O}_{Y,y}$ is zero-dimensional.
\end{corollary}
\begin{proof}
This follows from the observation that $y$ is the generic point of an irreducible component if and only if it is a maximal element under generalization, which is then equivalent by \cref{scheme local scheme correspond generalization} to that $\Spec(\mathscr{O}_{Y,y})$ is a singleton.
\end{proof}
\begin{proposition}\label{scheme local morphism factors through prop}
Let $(X,\mathscr{O}_X)$ be a local scheme with $A=\Gamma(X,\mathscr{O}_X)$, $\xi$ its unique closed point, and $(Y,\mathscr{O}_Y)$ a scheme. Then any morphism $f:(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ factors through $\Spec(\mathscr{O}_{Y,f(\xi)})$:
\[f:X\to\Spec(\mathscr{O}_{Y,f(\xi)})\to Y\]
where the second one is the canonical morphism, and the first one corresponds to a local homomorphism $\mathscr{O}_{Y,f(\xi)}\to A$.
\end{proposition}
\begin{proof}
In fact, for any $x\in X$, we have $\xi\in\widebar{\{x\}}$, hence $f(\xi)\in\widebar{\{f(x)\}}$. It then follows that $f(X)$ is contained in any affine open neighborhood of $f(\xi)$ (in fact any open neighborhood of $f(\xi)$). We can then reduce to the case that $(Y,\mathscr{O}_Y)$ is an affine scheme with ring $B=\Gamma(Y,\mathscr{O}_Y)$, and the morphism $f$ corresponds to a ring homomorphism $\rho:B\to A$. We have $\rho^{-1}(\p_{\xi})=\p_{f(\xi)}$, so the image under $\rho$ of an element of $B-\p_{f(\xi)}$ is invertible in the local ring $A$, and we get a canonical homomorphism $\rho_\xi:B_{f(\xi)}\to A$.
\end{proof}
\begin{corollary}\label{scheme local morphism correspond local ring homomorphism}
There is a canonical bijection between $\Hom_{\mathbf{Sch}}(X,Y)$ to the set of local homomorphisms $\mathscr{O}_{Y,y}\to A$, where $y\in Y$.
\end{corollary}
\begin{proof}
It suffices to note that any local homomorphism $\mathscr{O}_{Y,y}\to A$ corresponds to a unique morphism $f:X\to\Spec(\mathscr{O}_{Y,y})$ such that $f(\xi)=y$, and by composing this with the canonical morphism $\Spec(\mathscr{O}_{Y,y})\to Y$, we get a morphism $X\to Y$.
\end{proof}
\begin{example}
The affine scheme whose ring is a field $K$ have an underlying space reduced to one point. If $A$ is a local ring of maximal ideal $\m$, any local homomorphism $A\to K$ has a kernel equal to $\m$, so factors into $A\to A/\m\to K$, where the second arrow is a monomorphism. The morphisms $\Spec(K)\to\Spec(A)$ correspond therefore bijectively to the field extensions $A/\m\to K$.
\end{example}
Let $(Y,\mathscr{O}_Y)$ be a scheme; for any $y\in Y$ and any ideal $\a_y$ of $\mathscr{O}_{Y,y}$, the canonical homomorphism $\mathscr{O}_{Y,y}/\a_y$ defines a morphism $\Spec(\mathscr{O}_{Y,y}/\a_y)\to\Spec(\mathscr{O}_{Y,y})$; by composing this with the canonical morphism $\Spec(\mathscr{O}_{Y,y})\to Y$, we obtain a morphism $\Spec(\mathscr{O}_{Y,y}/\a_y)\to Y$, also called canonical. If $\a_y=\m_y$ is the maximal ideal of $\mathscr{O}_{Y,y}$, then $\mathscr{O}_{Y,y}=\kappa(y)$ and \cref{scheme local morphism correspond local ring homomorphism} then imply the following result:
\begin{corollary}\label{scheme local of field morphism factors through prop}
Let $(X,\mathscr{O}_X)$ be a local scheme with $K=\Gamma(X,\mathscr{O}_X)$ a field, $\xi$ its unique point, and $(Y,\mathscr{O}_Y)$ be a scheme. Then any morphism $f:(X,\mathscr{O}_X)\to(Y,\mathscr{O}_Y)$ factors into
\[f:X\to\Spec(\kappa(f(\xi)))\to Y\]
where the second arrow is the canonical morphism, and the first arrow corresponds to a field extension $\kappa(f(\xi))\to K$. This establishes a canonical bijection between $\Hom_{\mathbf{Sch}}(X,Y)$ to the set of field extensions $\kappa(y)\to K$, where $y\in Y$.
\end{corollary}
\begin{corollary}\label{scheme local of field morphism is mono}
For any $y\in Y$, the canonical morphism $\Spec(\mathscr{O}_{Y,y}/\a_y)\to Y$ is a monomorphism of locally ringed spaces.
\end{corollary}
\begin{proof}
This follows from \cref{scheme local canonical morphism prop} and \cref{scheme affine surjective ring map induce mono}.
\end{proof}
\begin{remark}
Let $X$ be a local scheme, $\xi$ its unique closed point. Since any affine open neighborhood of $\xi$ is necessarily all of $X$, any invertible $\mathscr{O}_X$-module is necessarily isomorphic to $\mathscr{O}_X$ (in other words, is trivial). This property does not hold in general for any affine scheme $\Spec(A)$, but we will see that if $A$ is a normal ring, this is true when $A$ is factorial.
\end{remark}
\subsection{Shemes over a scheme}
As in any category, for a scheme $S$ we can define the category $\mathbf{Sch}/S$ of $S$-objects in the category of schemes, which will be a morphism $\varphi:X\to S$ where $X$ is a scheme. In this case we also say that $X$ is a \textbf{scheme over $\bm{S}$}, or an \textbf{$\bm{S}$-scheme}. We say that $S$ is the \textbf{base scheme} of the $S$-scheme $X$ and $\varphi$ is called the structural morphism of the $S$-scheme $X$. When $S$ is an affine scheme of the ring $A$, we also say that $X$ is a \textbf{scheme over $\bm{A}$} or an \textbf{$\bm{A}$-scheme}.\par
It follows from \cref{scheme morphism to affine correspond} that giving a scheme over a ring $A$ is equivalent to giving a scheme $(X,\mathscr{O}_X)$, where $\mathscr{O}_X$ is an $A$-algebra. In particular, any scheme can be considered as a scheme over $\Z$. In other words, the scheme $\Spec(\Z)$ is a final object in the category of schemes (also a final object in the category of locally ringed spaces).\par
If $\varphi:X\to S$ is the structural morphism of an $S$-scheme $X$, we say a point $x\in X$ is \textbf{lying over} a point $s\in S$ if $\varphi(x)=s$. We say $X$ \textbf{dominates} $S$ if the morphism $\varphi$ is dominant. Let $X$ and $Y$ be two $S$-schemes; a morphism $u:X\to Y$ is called a \textbf{morphism of schemes over $\bm{S}$} (or \textbf{$\bm{S}$-morphism}) if the diagram
\[\begin{tikzcd}
X\ar[rd]\ar[rr,"u"]&&Y\ar[ld]\\
&S&
\end{tikzcd}\]
is commutative; in other words, if for any $s\in S$ and any $x\in X$ lying over $s$, the point $u(x)$ is lying over $s$. This definition immediately shows that the composite of two $S$-morphisms is an $S$-morphism, so the $S$-schemes thus form a category. We denote by $\Hom_S(X,Y)$ the set of $S$-morphisms from an $S$-scheme $X$ to an $S$-scheme $Y$; the identity morphism of an $S$-scheme $X$ is then denoted by $1_X$ or $\id_X$. If $S$ is an affine scheme $S$, we also say $A$-morphisms for $S$-morphisms.\par
If $X$ is an $S$-scheme, $\varphi:X\to S$ the structural morphism, an \textbf{$\bm{S}$-section} of $X$ is defined to be an $S$-morphism of $S$ to $X$, which is equivalently a morphism $\psi:S\to X$ of schemes such that $\varphi\circ\psi=\id_S$. We denote by $\Gamma(X/S)$ the set of $S$-sections of $X$.
\begin{example}
If $X$ is an $S$-scheme and $v:X'\to X$ a morphism of schemes, the composition scheme
\[\begin{tikzcd}
X'\ar[r,"v"]&X\ar[r]&S
\end{tikzcd}\]
then defines $X'$ as an $S$-scheme; in particular, any scheme induceed over an open subset $U$ of $X$ can be considered as an $S$-scheme by means of the canonical injection.
\end{example}
\begin{example}
Let $u:X\to Y$ be an $S$-morphism of $S$-schemes, the restriction of $u$ on any open subset $U$ of $X$ is then an $S$-morphism $U\to Y$. Conversely, let $(U_\alpha)$ be a covering of $X$ and for each $\alpha$, let $u_\alpha:U_\alpha\to Y$ be an $S$-morphism; if for any pair $(\alpha,\beta)$ of indices, the restrictions of $u_\alpha$ and $u_\beta$ on $U_\alpha\cap U_\beta$ coincide, then there exists a unique $S$-morphism $X\to Y$ whose restriction on $U_\alpha$ equals to $u_\alpha$.
\end{example}
Let $S\to S'$ be a morphism of schemes; for any $S'$-scheme $X$, the composition morphism $X\to S'\to S$ then defines $X$ as an $S$-scheme. Conversely, suppose that $S'$ is the scheme induced over an open subset of $S$; let $X$ be an $S$-scheme and suppose that the structural morphism $X\to S$ has image contained in $S'$; then we can consider $X$ as an $S'$-scheme. In the latter case, if $Y$ is an $S$-scheme whose structural morphism also maps the underlying space in $S'$, any $S$-morphism from $X$ in $Y$ is also an $S'$-morphism.
\subsection{Quasi-coherent sheaves on schemes}
\begin{proposition}\label{scheme qcoh sheaf char}
Let $X$ be a scheme. For an $\mathscr{O}_X$-module $\mathscr{F}$ to be quasi-coherent, it is necessary and sufficient that, for any affine open subset $V$ of $X$, the restriction $\mathscr{F}|_V$ is isomorphism to the sheaf associated with a $\Gamma(V,\mathscr{O}_X)$-module.
\end{proposition}
\begin{proof}
We recall that being quasi-coherent is a local property, and affine opens form a basis for $X$. Also, by \cref{scheme affine qcoh sheaf on qc open char}, a quasi-coherent sheaf on an affine open $V$ is isomorphic to $\widetilde{M}$ for some $\Gamma(V,\mathscr{O}_X)$-module $M$.
\end{proof}
\begin{corollary}\label{scheme qcoh and exact sequence prop}
Let $X$ be an arbitrary scheme.
\begin{enumerate}
\item[(\rmnum{1})] Let $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ be an exact sequence of $\mathscr{O}_X$-modules; if two of them are quasi-coherent, then so is the third one.
\item[(\rmnum{2})] The images, kernels and cokernels of homomorphisms of quasi-coherent $\mathscr{O}_X$-modules are quasi-coherent. The inductive limits and direct sums of quasi-coherent sheaves are quasi-coherent. If $\mathscr{G}$ and $\mathscr{H}$ are quasi-coherent $\mathscr{O}_X$-modules of a quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, then $\mathscr{G}+\mathscr{H}$ and $\mathscr{G}\cap\mathscr{H}$ are quasi-coherent.
\item[(\rmnum{3})] Let $0\to\mathscr{F}_1\to\mathscr{F}_2\to\mathscr{F}_3\to\mathscr{F}_4\to\mathscr{F}_5\to 0$ be an exact sequence of $\mathscr{O}_X$-modules. If $\mathscr{F}_1,\mathscr{F}_2,\mathscr{F}_4,\mathscr{F}_5$ are quasi-coherent, so is $\mathscr{F}_3$.
\item[(\rmnum{4})] If $\mathscr{F}$ and $\mathscr{G}$ are quasi-coherent $\mathscr{O}_X$-modules, $\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{G}$ is quasi-coherent. In particular, if $\mathscr{I}$ is a quasi-coherent ideal of $\mathscr{O}_X$, $\mathscr{I}\mathscr{F}$ is a quasi-coherent $\mathscr{O}_X$-module.
\item[(\rmnum{5})] Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module with finite presentation. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{G}$, $\sHom_{\mathscr{O}_X}(\mathscr{F},\mathscr{G})$ is quasi-coherent.
\item[(\rmnum{6})] If $\mathscr{F}$ is a quasi-coherent $\mathscr{O}_X$-module of finite type, the annihilator $\mathscr{I}$ of $\mathscr{F}$ is a quasi-coherent ideal of $\mathscr{O}_X$.  
\end{enumerate}
\end{corollary}
\begin{proof}
By \cref{scheme qcoh sheaf char}, assertions (\rmnum{1}) to (\rmnum{5}) follow from \cref{scheme affine qcoh sheaf two of three}, \cref{scheme affine associated sheaf ker and coker}, and \cref{scheme affine associated sheaf tensor and Hom}. To prove (\rmnum{6}), we can assume that $X=\Spec(A)$ is affine, $\mathscr{F}=\widetilde{M}$, where $M$ is a finitely generated $A$-module, with generators $t_1,\dots,t_r$. The ideal $\mathscr{I}$ is then the intersection of the annihilators of $t_i$. But the annihilator of $t_i$ is by definition the kernel of the canonical morphism $\mathscr{O}_X\to\mathscr{F}$ corresponding to $s\mapsto st_i$ from $A$ to $M$, hence quasi-coherent. It then follows that $\mathscr{I}$ is quasi-coherent, as an intersection of quasi-coherent $\mathscr{O}_X$-modules.
\end{proof}
\begin{corollary}\label{scheme qcoh finite presented kernel finite}
Let $X$ be a scheme, $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ an exact sequence of quasi-coherent $\mathscr{O}_X$-modules. If $\mathscr{H}$ is finitely presented and $\mathscr{G}$ is of finite type, then $\mathscr{F}$ is of finite type.
\end{corollary}
\begin{proof}
Since this question is local, we may assume that $X$ is affine, and the corresponding result is then \cref{module ft exact sequence kernel finite}.
\end{proof}
\begin{proposition}\label{scheme qcoh over qcoh algebra char}
Let $X$ be a scheme and $\mathscr{B}$ be a quasi-coherent $\mathscr{O}_X$-algebra. For a $\mathscr{B}$-module $\mathscr{F}$ to be quasi-coherent, it is necessary and sufficient that $\mathscr{F}$ is a quasi-coherent $\mathscr{O}_X$-module. In particular, if $\mathscr{F}$ and $\mathscr{G}$ are quasi-coherent $\mathscr{B}$-modules, $\mathscr{F}\otimes_{\mathscr{B}}\mathscr{G}$ is a quasi-coherent $\mathscr{B}$-module; the same holds for $\sHom_{\mathscr{B}}(\mathscr{F},\mathscr{G})$ if $\mathscr{F}$ is a finitely presented $\mathscr{B}$-module.
\end{proposition}
\begin{proof}
Since the question is local, we can suppose that $X$ is affine with ring $A$, and then $\mathscr{B}=\widetilde{B}$, where $B$ is an $A$-algebra. If $\mathscr{F}$ is quasi-coherent over the space $(X,\mathscr{B})$, we can write $\mathscr{F}$ as the cokernel of $\mathscr{B}$-homomorphism $\mathscr{B}^{\oplus I}\to\mathscr{B}^{\oplus J}$; since this homomorphism is also an $\mathscr{O}_X$-homomorphism, and $\mathscr{B}^{\oplus I}$, $\mathscr{B}^{\oplus J}$ are quasi-coherent $\mathscr{O}_X$-modules, we conclude that $\mathscr{F}$ is also quasi-coherent.\par
Conversely, if $\mathscr{F}$ is a quasi-coherent $\mathscr{O}_X$-module, we have $\mathscr{F}=\widetilde{M}$ where $M$ is a $B$-module (\cref{scheme affine qcoh sheaf of algebra is induced by module of algebra}); $M$ is isomorphic to the cokernel of a homomorphism $B^{\oplus I}\to B^{\oplus J}$, so $\mathscr{F}$ is a $\mathscr{B}$-module isomorphic to the cokernel of the corresponding homomorphism $\mathscr{B}^{\oplus I}\to\mathscr{B}^{\oplus J}$. This completes the proof.
\end{proof}
Let $X$ be a scheme. A quasi-coherent $\mathscr{O}_X$-algebra $\mathscr{B}$ is \textbf{of finite type} (resp. \textbf{of finite presentation}) if for all $x\in X$, there exists an open affine neighborhood $U$ of $x$ such that $\Gamma(U,\mathscr{B})=B$ is an algebra of type finite (resp. of finite presentation\footnote{Recall that an algebra $B$ is finitely presented over $A$ if it is isomorphic to the quotient of a polynomial ring over $A$ in finitely many variables by a finitely generated ideal.}) over $\Gamma(U,\mathscr{O}_X)=A$. If this is the case, we have $\mathscr{B}|_U=\widetilde{B}$, and for all $f\in A$, the $(\mathscr{O}_X|_{D(f)})$-algebra $\mathscr{B}|_{D(f)}$ induced on $D(f)$ is of finite type (resp. of finite presentation), because it is isomorphic to $\widetilde{B\otimes_AA_f}$. As the $D(f)$ form a basis of the topology of $X$, we deduce that for any open set $V$ of $X$, $\mathscr{B}|_V$ is a $(\mathscr{O}_X|_{V})$-algebra of finite type (resp. of finite presentation).
\begin{proposition}\label{scheme locally free module trivilization on affine open}
Let $X$ be a scheme, $\mathscr{E}$ a locally free $\mathscr{O}_X$-module of rank $r$, $Z$ a finite subset of $X$ contained in an affine open $V$. Then there exists an open neighborhood $U\sub V$ of $Z$ such that $\mathscr{E}|_U$ is isomorphic to $\mathscr{O}_U^r$.
\end{proposition}
\begin{proof}
By replacing $X$ by $V$, we can assume that $X=\Spec(A)$ is affine. For each $z_i\in Z$ there exists a closed point $z_i'$ in the closure $\widebar{\{z_i\}}$ (that is, a maximal ideal containing $\p_{z_i}$); if $Z'$ is the set of the $z_i'$, any neighborhood of $Z'$ is a neighborhood of $Z$, and we can then suppose that $Z$ is closed in $X$. Now, the subset $Z$ of $X$ is defined by an ideal $\a$ of $A$; consider the scheme $\Spec(A/\a)$, with $Z$ its underlying space, and the injection $\iota:Z\to X$ corresponds to the canonical homomorphism $A\to A/\a$. Then $\iota^*(\mathscr{E})=\mathscr{E}\otimes_{\mathscr{O}_X}\mathscr{O}_Z$ is locally free with rank $r$ over the discrete scheme $Z$, so is isomorphic to $\mathscr{O}_Z^r$. In other words, there exist sections $s_1,\dots,s_r$ of $\mathscr{E}\otimes_{\mathscr{O}_X}\mathscr{O}_Z$ over $Z$ such that the homomorphism $\mathscr{O}_Z^r\to\mathscr{E}\otimes_{\mathscr{O}_X}\mathscr{O}_Z$ defined by these sections is bijective. On the other hand, we have $\mathscr{E}=\widetilde{M}$ where $M$ is an $A$-module; then each $s_i$ belongs to $M\otimes_A(A/\a)$, and is then the image of an element $t_i\in M=\Gamma(X,\mathscr{E})$. For each $z_j\in Z$, by \cref{sheaf of module local free same rank inj iff bij}, there then exists a neighborhood $V_i$ of $z_i$ in $X$ such that the restrictions of $t_i$ to $V_j$ define an isomorphism $\mathscr{O}_X^r|_{V_j}\to\mathscr{E}|_{V_j}$; the union $U$ of the $V_j$'s then satisfies the requirement.
\end{proof}
\begin{proposition}\label{scheme qcoh ft is direct image from supp}
Let $X$ a scheme and $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module of finite type. Then there exists a closed subscheme $Y$ of $X$ with underlying space $\supp(\mathscr{F})$ and a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{G}$ of finite type supported on $Y$ such that, if $j:Y\to X$ is the canonical injection, $\mathscr{F}$ is isomorphic to $j_*(\mathscr{G})$.
\end{proposition}
\begin{proof}
It suffices to note that the annihilator $\mathscr{I}$ of $\mathscr{F}$ is a quasi-coherent ideal of $\mathscr{O}_X$ (\cref{scheme qcoh and exact sequence prop}), so if $Y$ is the closed subscheme of $X$ defined by $\mathscr{I}$, as $\mathscr{I}\mathscr{F}=0$, $\mathscr{F}$ is an $(\mathscr{O}_X/\mathscr{I})$-module, and we can take $\mathscr{G}=j^*(\mathscr{F})$.
\end{proof}
\subsection{Noetherian schemes and locally Noetherian schemes}
We say a scheme $X$ is Noetherian (resp. locally Noetherian) if there is a finite covering (resp. a covering) of open affines $V_\alpha$ such that each ring $\Gamma(V_\alpha,\mathscr{O}_X)$ is Noetherian. The underlying space of a Noetherian (resp. locally Noetherian) scheme is then a Noetherian space (resp. locally Noetherian). Moreover, if $X$ is locally Noetherian. the structural sheaf $\mathscr{O}_X$ is coherent, any quasi-coherent $\mathscr{O}_X$-module of finite type is coherent (\cref{scheme affine Noe coh sheaf char}), and any local ring $\mathscr{O}_{X,x}$ is Noetherian. Any quasi-coherent sub-$\mathscr{O}_X$-module (resp. any quasi-coherent $\mathscr{O}_X$-quotient) of a coherent $\mathscr{O}_X$-module $\mathscr{F}$ is then coherent, because the
question is local again, and we just apply \cref{scheme affine Noe coh sheaf char}, together with the fact that a sub-module (resp. quotient module) of a finitely generated module on a Noetherian ring is finitely generated. More particularly, any quasi-consistent ideal of $\mathscr{O}_X$ is consistent.\par
If a scheme $X$ is a finite union (resp. a union) of open Noetherian (resp. locally Noetherian) subschemes $W_\lambda$, it is clear that $X$ is then Noetherian (resp. locally Noetherian).
\begin{proposition}\label{scheme Noe iff local Noe and quasi-compact}
For a scheme $X$ to be Noetherian, it is necessary and sufficient that it is locally Noetherian and its underlying space is quasi-compact.
\end{proposition}
\begin{proof}
This follows from the definition, since a Noetherian space is quasi-compact.
\end{proof}
\begin{proposition}\label{scheme affine Noe iff Noe ring}
Let $X$ be an affine scheme with ring $A$. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is Noetherian;
\item[(\rmnum{2})] $X$ is locally Noetherian;
\item[(\rmnum{3})] $A$ is Noetherian.
\end{enumerate}
\end{proposition}
\begin{proof}
Since $X$ is quasi-compact, it is clear that (\rmnum{1}) and (\rmnum{2}) are equivalent. Also, (\rmnum{3}) implies (\rmnum{1}) by definition. Now assume that $X$ is Noetherian, then there is a finite covering $(V_i)$ of $X$ by affine opens where $A_i=\Gamma(V_i,\mathscr{O}_X)$ is Noetherian. Let $(\a_n)$ be an increasing sequence of ideals of $A$; it corresponds to it canonically in a one-to-one way to an increasing sequence $(\tilde{\a}_n)$ of ideals in $\widetilde{A}=\mathscr{O}_X$; to see that the sequence $(\a_n)$ is stationary, it suffices to prove that the sequence $(\tilde{\a}_n)$ is. However, the restriction $\tilde{\a}_n|_{V_i}$ is a quasi-coherent ideal of $\mathscr{O}_X|_{V_i}$; $\tilde{\a}_n|_{V_i}$ is then of the form $\tilde{\a}_{n,i}$, where $\a_{n,i}$ is an ideal of $A_i$. As $A_i$ is Noetherian, the sequence $(\a_{n,i})$ is stationary for all $i$, hence the proposition.
\end{proof}
Note that the above reasoning also proves that if $X$ is a Noetherian scheme, any increasing sequence of coherent ideals of $\mathscr{O}_X$ is stationary.
\begin{proposition}\label{scheme local Noe qcoh finite type algebra is coh and fp}
Let $X$ be a locally Noetherian scheme. Any quasi-coherent $\mathscr{O}_X$-algebra $\mathscr{B}$ of finite type is a coherent shaf of rings and an $\mathscr{O}_X$-algebra of finite presentation.
\end{proposition}
\begin{proof}
We can assume that $X=\Spec(A)$ is affine, where $A$ is a Noetherian ring, and $\mathscr{B}=\widetilde{B}$, where $B$ is an $A$-algebra of finite type. It then follows that $B$ is finitely presented over $A$, so $\mathscr{B}$ is of finite presentation. To show that $\mathscr{B}$ is coherent, we must prove that the kernel $\mathscr{N}$ of a $\mathscr{B}$-homomorphism $\mathscr{B}^m\to\mathscr{B}$ is a $\mathscr{B}$-module of finite type; but it is of the form $\widetilde{N}$, where $N$ is the kernel of the corresponding homomorphism $B^m\to B$ of $B$-modules. Since $B$ is also Noetherian, $N$ is a finitely generated $B$-module. There then exists a surjective $B$-homomorphism $B^n\to N$, so a surjective homomorphism $\mathscr{B}^n\to\mathscr{N}$, which proves our assertion.
\end{proof}
\begin{corollary}\label{scheme local Noe qcoh finite type algebra coh module iff}
Let $X$ be a locally Noetherian scheme and $\mathscr{B}$ be a quasi-coherent $\mathscr{O}_X$-algebra of finite type. For a $\mathscr{B}$-module $\mathscr{F}$ to be coherent, it is necessary and sufficient that $\mathscr{F}$ is a quasi-coherent $\mathscr{O}_X$-module and a $\mathscr{B}$-module of finite type, and if $\mathscr{G}$ is a sub-$\mathscr{B}$-module or a quotient $\mathscr{B}$-module of $\mathscr{F}$, for $\mathscr{G}$ to be a coherent $\mathscr{B}$-module, it is necessary and sufficient that $\mathscr{G}$ is a quasi-coherent $\mathscr{O}_X$-module. 
\end{corollary}
\begin{proof}
Considering \cref{scheme qcoh over qcoh algebra char}, the conditions on $\mathscr{F}$ is necessary. To prove the sufficiency, we can assume that $X=\Spec(A)$ is affine, where $A$ is Noetherian, $\mathscr{B}=\widetilde{B}$, where $B$ is an $A$-algebra of finite type, and $\mathscr{F}=\widetilde{M}$, where $M$ is a $B$-module and there exists a surjective $B$-homomorphism $\mathscr{B}^m\to\mathscr{F}$. Then we get a corresponding homomorphism $B^m\to M$, so $M$ is a finitely generated $B$-module; the kernel $P$ of thie homomorphism is finitely generated since $B$ is Noetherian, and $\mathscr{F}$ is therefore the cokernel of a morphism $\mathscr{B}^n\to\mathscr{B}^m$, so it is coherent (since $\mathscr{B}$ is a coherent sheaf of rings). The same reasoning shows that any quasi-coherent sub-$\mathscr{B}$-module (resp. quotient $\mathscr{B}$-module) of $\mathscr{F}$ is of finite type, whence the second part of the corollary.
\end{proof}
\begin{proposition}\label{scheme local Noe maximal generalization prop}
Let $X$ be a locally Noetherian scheme and $E$ be a subset of $X$. Any point $x\in E$ admits in $E$ a maximal generalization $y$ (i.e. $y$ has no further generalization in $Y$). In particular, if $E\neq\emp$, there exists a maximal element $y\in E$ under generalization. 
\end{proposition}
\begin{proof}
The generalizations of $x$ in $X$ lie in the points of $\Spec(\mathscr{O}_{X,x})$ (\cref{scheme local scheme correspond generalization}), where $\mathscr{O}_{X,x}$ is a Noetherian local ring. We then know that the lengths of chains of prime ideals in this ring are bounded by $\dim(\mathscr{O}_{X,x})$, and to prove the proposition it suffices to consider a chain of prime ideals belonging to $E$ and having the greatest possible length.
\end{proof}
\begin{proposition}\label{scheme artinian iff}
Let $X$ be a scheme. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X=\Spec(A)$ is affine and $A$ is Artinian;
\item[(\rmnum{2})] $X$ is Noetherian and has discrete underlying space;
\item[(\rmnum{3})] $X$ is Noetherian and every point in $X$ is closed (in other words, $X$ is T1).
\end{enumerate}
If these equivalent conditions hold, then $X$ is finite and the ring $A$ is a direct product of finitely many Artinian local rings.
\end{proposition}
\begin{proof}
We know that (\rmnum{1}) implies the last asserion. It is clear that (\rmnum{1})$\Rightarrow$(\rmnum{2})$\Rightarrow$(\rmnum{3}). To see that (\rmnum{3}) implies (\rmnum{1}), let us first show that $X$ is then finite; we can indeed reduce to case where $X$ is affine, and we know that a Noetherian ring of which all the prime ideals are maximal is Artinian, hence our assertion.
\end{proof}
Note that a Noetherian scheme can have an underlying space finite without being artinian, as shown by the example of a spectrum discrete valuation ring.
\section{Product of schemes}
Let $(X_\alpha)$ be a family of schemes, and $X$ be the topological space which is the \textbf{coproduct} of the underlying spaces of $X$. Then $X$ is the union of its open subspaces $U_\alpha$, and for each $\alpha$ we have a embedding $\iota_\alpha:X_\alpha\to X$ with image equal to $U_\alpha$. If we endow each $U_\alpha$ the sheaf $(\iota_\alpha)_*(\mathscr{O}_{X_\alpha})$, it is clear that $X$ becomes a scheme, which we will call the \textbf{coproduct} of the family $(X_\alpha)$, and denote by $\coprod_\alpha X_\alpha$. It is clear that the scheme $X$ satisfies the universal property of coproducts of $X_\alpha$'s: for any scheme $Y$ and morphisms $f_\alpha:X_\alpha\to Y$, there exists a unique morphism $f:X\to Y$ such that $f\circ\iota_\alpha=f_\alpha$. In other words, we have a functorial bijection
\[\Hom(\coprod_\alpha X_\alpha,Y)\to\prod_\alpha\Hom(X_\alpha,Y).\]
This fact can be also stated that $\coprod_\alpha X_\alpha$ represents the covariant functor $\prod_\alpha\Hom(X_\alpha,-)$ on the category of schemes. In particular, if $X_\alpha$ are $S$-schemes with structural morphisms $\psi_\alpha$, then $X$ is an $S$-scheme with structural morphism $\psi:X\to S$ such that $\psi\circ\iota_\alpha=\psi_\alpha$. We usually denote the coproduct of two schemes $X$ and $Y$ by $X\amalg Y$, and it is clear that if $X=\Spec(A)$ and $Y=\Spec(B)$, then $X\amalg Y$ is canonically identified with $\Spec(A\times B)$.\par
In this section, we shall consider product of schemes, which is far more complicated than coproducts. We will see that fiber products plays a central role of many construction and operations on schemes.
\subsection{Product of schemes}
Let $X$ and $Y$ be $S$-schemes. Recall that the object $X\times_SY$ represents by definition the contravariant functor
\[T\mapsto F(T)=\Hom_S(T,X)\times\Hom_S(T,Y)\]
on the category of $S$-schemes. To prove the existence of $X\times_SY$, we shall apply the methods used in \cref{ringed space representable functor via subfunctor}. We first verify condition (\rmnum{2}) in \cref{ringed space representable functor via subfunctor}, which means $F$ is a sheaf over the category $\mathbf{Sch}$: this is evident since the functors $T\mapsto\Hom_S(T,X)$ and $T\mapsto\Hom_S(T,Y)$ are sheaves, and a projective limit of sheaves over $\mathbf{Sch}$ is again a sheaf over $\mathbf{Sch}$.\par
This already allows us to bring ourselves back to the case that the scheme $S$ is affine. In fact, let $(S_\alpha)$ is a covering of $S$ by affine open sets. In view of the above fact and of (\cite{EGA1} new, $0_{\text{\Rmnum{1}}}$, 4.5.5), it suffices to show that each of the functors $F\times_{h_S}h_{S_\alpha}$ is representable. On the other hand, let $\varphi:X\to S$ and $\psi:Y\to S$ be the structural morphisms; it is immediate that when $T$ is a locally ringed $S_\alpha$-space (hence also an $S$-space), we have canonical identifies
\[\Hom_S(T,X)\stackrel{\sim}{\to}\Hom_{S_\alpha}(T,\varphi^{-1}(S_\alpha)),\quad \Hom_S(T,Y)\stackrel{\sim}{\to}\Hom_{S_\alpha}(T,\psi^{-1}(S_\alpha)).\]
Therefore, in view of (\cite{EGA1} new, $0_{\text{\Rmnum{1}}}$, 4.5.5), we only need to show that $F$ is representable when it is restricted to the subcategory of locally ringed $S_\alpha$-spaces.\par
With these being done, assume that $S$ is affine and consider a covering $(X_\lambda)$ (resp. $(Y_\mu)$) of $X$ (resp. $Y$) by affine opens. We shall verify the conditions (\rmnum{1}) and (\rmnum{3}) of \cref{ringed space representable functor via subfunctor} for the subfunctors $F_{\lambda\mu}:T\mapsto\Hom_S(T,X_\lambda)\times\Hom_S(T,Y_\mu)$ of $F$. Let $Z$ be a locally ringed $S$-space and $(p,q)$ be an element of $F(Z)$, i.e. $p:Z\to X$ and $q:Z\to Y$ are $S$-morphisms. These determine by Yoneda Lemma a natural transform $h_Z\to F$ which associates a locally ringed $S$-space $T$ the map
\[\Hom_S(T,Z)\to F(T),\quad g\mapsto(p\circ g,q\circ g)\]
and every natural transform $h_Z\to F$ is of this form. We now show that the functor
\begin{align}\label{scheme product subfunctor-1}
T\mapsto F_{\lambda\mu}(T)\times_{F(T)}h_Z(T)
\end{align}
is representable by a locally ringed $S$-space induced by $Z$ on an open subset of $Z$. In fact, an element of the right side of (\ref{scheme product subfunctor-1}) (which is a fiber product of sets) is a triple $(u_\lambda,v_\mu,g)$, where $g:T\to Z$, $u_\lambda:T\to X_\lambda$, and $v_\mu:T\to Y_\mu$ are $S$-morphisms such that the following diagram commutes:
\[\begin{tikzcd}
T\ar[rrd,bend left=20pt,"v_\mu"]\ar[rdd,swap,bend right=20pt,"u_\lambda"]\ar[rd,"g"]&&\\
&Z\ar[d,swap,"p"]\ar[r,"q"]&Y\ar[d]\\
&X\ar[r]&S
\end{tikzcd}\]
Now this in particular implies that $g(T)\sub Z_{\lambda\mu}=p^{-1}(X_\lambda)\cap q^{-1}(Y_\mu)$, and conversely, any $S$-morphism $g:T\to Z$ verifying this condition corresponds to the unique triple $(p\circ g,q\circ g,g)$, since $p\circ g$ (resp $q\circ g$) can be viewed as a morphism from $Z$ to $X_\lambda$ (resp. $Y_\mu$). In other word, we have a canonical bijection
\[F_{\lambda\mu}(T)\times_{F(T)}\Hom_S(T,Z)\stackrel{\sim}{\to}\Hom_S(T,Z_{\lambda\mu})\]
and the functor (\ref{scheme product subfunctor-1}) is then represented by the couple $(Z_{\lambda\mu},(p|_{Z_{\lambda\mu}},q|_{Z_{\lambda,\mu}}),j_{\lambda\mu})$, where $j_{\lambda\mu}:Z_{\lambda\mu}\to Z$ is the cannical injection. Since the $Z_{\lambda\mu}$ form an open covering of $Z$, this proves both of the conditions (\rmnum{1}) and (\rmnum{3}) of \cref{ringed space representable functor via subfunctor}.\par
It remains to show that the functors $F_{\lambda\mu}$ are representable, which means we need to construct $X\times_SY$ when $X$, $Y$, and $S$ are affine schemes. This is fairly easy, as we will now show.
\begin{proposition}\label{scheme fiber product affine case}
Assume that $S=\Spec(A)$, $X=\Spec(B)$, and $Y=\Spec(C)$, where $B$ and $C$ are $A$-algebras. Then the scheme $Z=\Spec(B\otimes_AC)$, with $p,q$ the $S$-morphisms corresponding to the canonical $A$-homomorphisms $B\to B\otimes_AC$ and $C\to B\otimes_AC$, representes the functor $F$ in the category of locally rinfed $S$-spaces.
\end{proposition}
\begin{proof}
In fact, in the category of rings, the tensor product $B\otimes_AC$ of two $A$-algebras $B$ and $C$ is a coproduct in the category of $A$-algebras, as can be easily verified. 
\end{proof}
We then conclude that fiber products exist in the category of schemes. As always, the notation $X\times_SY$ will be used to denote this product for two $S$-schemes $X$ and $Y$. If $S=\Spec(A)$ is an affine scheme, we also write $X\times_AY$. If $Y=\Spec(B)$ is an affine scheme, in view of \cref{scheme fiber product affine case}, we use $X\otimes_SB$ to denote this product, and $X\otimes_AB$ if $S=\Spec(A)$ is also affine.\par
The general notations and results for fiber products in a category can be then used for the product of schemes. In particular, if $p_1:X\times_XY\to X$, $p_2:X\times_SY\to Y$ are the canonical projections, and $g:T\to X$, $h:T\to Y$ are two $S$-morphisms, we denote by $(g,h)_S$ the unique $S$-morphism fits into the following diagram:
\[\begin{tikzcd}
T\ar[rrd,bend left=20pt,"h"]\ar[rdd,swap,bend right=20pt,"g"]\ar[rd,"{(g,h)_S}"description]&&\\
&X\times_SY\ar[d,swap,"p_1"]\ar[r,"p_2"]&Y\ar[d]\\
&X\ar[r]&S
\end{tikzcd}\]
If $S=\Spec(A)$, $X=\Spec(B)$, $Y=\Spec(C)$, and $T=\Spec(D)$ are all affine, and $g,h$ correspond to homomorphisms $\rho:B\to D$, $\sigma:C\to D$ of $A$-algebras, then $(g,h)_S$ corresponds to the homomorphism $\tau:B\otimes_AC\to D$ such that
\[\tau(b\otimes c)=\rho(b)\sigma(c).\]
Again, if $S=\Spec(A)$ is affine, we also write $(g,h)_A$ instead of $(g,h)_S$.
\begin{corollary}\label{scheme product inverse image of base open}
Let $Z=X\times_SY$ be the product of two $S$-schemes, $p:Z\to X$, $q:Z\to Y$ the canonical projections, $\varphi$ (resp $\psi$) the structural morphisms of $X$ (resp. $Y$). Let $U,V$ be open subsets of $X,Y$ respectively, and $W$ be an open subset of $S$ such that $p(U)\sub W$ and $p(V)\sub W$. Then the product $U\times_WV$ is canonically identified with the scheme induced by $Z$ on the subset $p^{-1}(V)\cap q^{-1}(W)$ (considered as a $U$-scheme). Moreover, if $g:T\to X$, $h:T\to Y$ are $S$-morphisms such that $g(T)\sub V$, $h(T)\sub W$, the $U$-morphism $(g,h)_S$ is identified with $(g,h)_S$, considered as morphisms from $T$ to $p^{-1}(V)\cap q^{-1}(W)$.
\end{corollary}
\begin{proof}
We first note that, if $U$ is an open set of $S$ and $\varphi:X\to S$, $\psi:Y\to S$ are structural morphisms with images in $U$, then the fiber product $X\times_SY$ is identified with $X\times_UY$. Apply this to $V$ and $W$, we conclude that $U\times_WV=U\times_WV$. So it suffices to prove that the subscheme $R=p^{-1}(U)\cap q^{-1}(V)$ with its restricted projections to $U$ and $V$ form a product of $U$ and $V$. For this, we note that if $T$ is an $S$-scheme, we can identify the $S$-morphisms $T\to R$ and the $S$-morphisms $T\to Z$ with image in $R$. If $g:T\to U$, $h:T\to V$ are two $S$-morphisms, we can consider them as $S$-morphisms of $T$ in $X$ and $Y$ respectively, and by hypothesis there is therefore an $S$-morphism and there is a morphism $f:T\to Z$ such that $g=p\circ f$, $h=q\circ f$. Since $p(f(T))\sub U$ and $q(f(T))\sub V$, we have
\[f(T)\sub p^{-1}(U)\cap q^{-1}(V)=W\]
whence our claim.
\end{proof}
\begin{corollary}\label{scheme product of coproduct}
Let $(X_\lambda)$ (resp. $(Y_\mu)$) be a family of $S$-schemes and $X$ (resp. $Y$) be their coproduct. Then $X\times_SY$ is identified with the coproduct of the family $(X_\lambda\times_SY_\mu)$.
\end{corollary}
\begin{proof}
In fact, in the notations of \cref{scheme product inverse image of base open}, the underlying space of $X\times_SY$ is the disjoint union of open sets $p^{-1}(X_\lambda)\cap q^{-1}(Y_\mu)$, and it suffices to apply \cref{scheme product inverse image of base open}.
\end{proof}
\begin{remark}
The product of two Noetherian $S$-schemes need not to be Noetherian, even if they are both spectrum of fields. For example, if $k$ is a nonperfect field of characteristic $p>0$, the tensor product $A=k^{p^{-\infty}}\otimes_kk^{p^{-\infty}}$ is not a Noetherian ring: in fact, for any integer $n>0$, there exists $x_n\in k^{p^{-\infty}}$ such that $x_n^{p^n}\in k$ and $x_n^{p^{n-1}}\notin k$. If we consider the element $z_n=1\otimes x_n-x_n\otimes 1$ of $A$, we then have $z_n^{p^n}=0$, and $z_n^{p^{n-1}}\neq 0$ since $1$ and $x_n^{p^{n-1}}$ are linearly independent over $k$. We then conclude that the nilradical of $A$ is not nilpotent, so $A$ is not Noetherian.
\end{remark}
\begin{remark}
We should note that the underlying topological space of the fiber product $X\times_SY$ is not the fiber product of the underlying topological spaces. This can be seen from the tensor product of two fields, which can not be a field.
\end{remark}
\subsection{Base change of schemes}
The functor $X\times_SY$ is covariant in both of its variables, and this follows from the following commutative diagram:
\[\begin{tikzcd}
X\times Y\ar[r,"f\times 1"]\ar[d]&X'\times Y\ar[r,"f'\times 1"]\ar[d]&X''\times Y\ar[d]\\
X\ar[r,"f"]&X'\ar[r,"f'"]&X''
\end{tikzcd}\]
\begin{proposition}\label{scheme fiber product with base iso}
For any $S$-scheme $X$, the first (resp. second) projection $X\times_SS$ (resp. $S\times_SX$) is a functorial isomorphism of $X\times_SS$ (resp. $S\times_SX$) to $X$, with inverse isomorphism $(1_X,\varphi)_S$ (resp. $(\varphi,1_X)_S$), where $\varphi:X\to S$ is the structural morphism. We can therefore write
\[X\times_SS=S\times_SX=X.\]
\end{proposition}
\begin{proof}
It suffices to prove that the triple $(X,1_X,\varphi)$ form a product of $X$ and $S$, which is immediate.
\end{proof}
\begin{corollary}
Let $X$ and $Y$ be $S$-schemes, $\varphi:X\to S$, $\psi:Y\to S$ the structural morphisms. If we identify canonically $X$ with $X\times_SS$ and $Y$ with $S\times_SY$, the projections $X\times_SY\to X$ and $X\times_SY\to Y$ is identified respectively to $1_X\times\psi$ and $\varphi\times 1_Y$.
\end{corollary}
We can define similarly the fiber product of $S$-schemes $X_1,\dots,X_n$, whose existence can be proved by induction on $n$, which is isomorphic to $(X_1\times_S\cdots\times_SX_{n-1})\times_SX_n$. The uniqueness of the product entails, as in any category, its properties of commutativity and associativity. If, for example, $p_1,p_2,p_3$ denotes the projections of $X_1\times_SX_2\times_SX_3$, and if we identify this scheme with $(X_1\times_SX_2)\times_SX_3$, the projection in $X_1\times_SX_2$ is identified with $(p_1,p_2)_S$.\par
Let $S$, $S'$ be two schemes, $\varphi:S\to S'$ an morphism, making $S'$ an $S$-scheme. For any $S$-scheme $X$, consider the product $X\times_SS'$, and let $p$ and $\pi'$ the projections to $X$ and $S'$ respectively. Through the morphism $\pi'$, this product is an $S'$-scheme, which we may denoted by $X_{(S')}$ or $X_{(\varphi)}$, and the obtained scheme is called the \textbf{base change} of $X$ from $S$ to $S'$, or the inverse image of $X$ via $\varphi$. We note that if $\pi$ is the structural morphism of $X$ and $\theta$ is the structural morphism of $X\times_SS'$, the following diagram is commutative:
\[\begin{tikzcd}
X_{(S')}\ar[r,"\pi'"]\ar[d,swap,"p"]&S'\ar[d,"\varphi"]\\
X\ar[r,"\pi"]&S
\end{tikzcd}\]
For any $S$-morphism $f:X\to Y$, we denote by $f_{(S')}$ the $S'$-morphism $f\times_S1:X_{(S')}\to Y_{(S')}$ and call it the inverse image of $f$ by $\varphi$. The operation $X_{(S')}$ is clearly a covariant functor on $X$, from the category $\mathbf{Sch}/S$ to $\mathbf{Sch}/S'$.\par
Let $S,S'$ be two affine schemes with rings $A$, $A'$; a morphism $S'\to S$ corresponds to a homomorphism $A\to A'$. If $X$ is an $S$-scheme, we then denote by $X_{(A')}$ of $X\otimes_AA'$ by the $S'$-scheme $X_{(S')}$; if $X$ is also affine with ring $B$, then $X_{(A')}$ is affine with ring $B_{(A')}=B\otimes_AA'$.\par
We point out that the scheme $X_{(S')}$ satisfies the following universal property: any $S'$-scheme $T$ is an $S$-scheme via the morphism $\varphi$, and for any $S$-morphism $g:T\to X$ there exists a unique $S'$-morphism $f:T\to X_{(S')}$ such that $g=p\circ f$.
\begin{proposition}[\textbf{Transitivity}]\label{scheme base change transitive}
Let $\varphi':S''\to S'$ and $\varphi:S'\to S$ be morphism of schemes. For any $S$-scheme $X$, there is a canonical functorial isomorphism of the $S''$-schemes $(X_{(\varphi)})_{(\varphi')}$ and $X_{(\varphi\circ\varphi')}$. 
\end{proposition}
\begin{proof}
In fact, let $T$ be an $S''$-scheme, $\psi$ its structural morphism, $g:T\to X$ an $S$-morphism ($T$ is an $S$-scheme via the morphism $\varphi\circ\varphi'\circ\psi$). Since $T$ is an $S'$-scheme with structural morphism $\varphi'\circ\psi$, we can write $g=p\circ g'$, where $g':T\to X_{(\varphi)}$ is an $S'$-morphism. Then $g'=p'\circ g''$, where $g'':T\to (X_{(\varphi)})_{\varphi'}$ is an $S''$-morphism:
\[\begin{tikzcd}
(X_{(\varphi)})_{\varphi'}\ar[r,"p'"]\ar[d,"\pi''"]&X_{(\varphi)}\ar[r,"p"]\ar[d,"\pi'"]&X\ar[d,"\pi"]\\
S''\ar[r,"\varphi'"]&S'\ar[r,"\varphi"]&S
\end{tikzcd}\]
The claim now follows from the definition of the universal property of $X_{(\varphi\circ\varphi')}$.
\end{proof}
The previous result can also be written as $(X_{(S')})_{(S'')}=X_{(S'')}$, if there is no risk of confusion. Moreover precisely, we have
\[(X\times_SS')\times_{S'}S''=X\times_{S}S'';\]
the functorial of the isomorphism in \cref{scheme base change transitive} also shows the transitive of inverse image of morphisms:
\[(f_{(S')})_{(S'')}=f_{(S'')}\]
for any $S$-morphism $f:X\to Y$.
\begin{corollary}\label{scheme base change fiber prod prop}
If $X$ and $Y$ are $S$-schemes, there exists a canonical functorial isomorphism of $S'$-schemes $X_{(S')}\times_{S'}Y_{(S')}$ and $(X\times_SY)_{S'}$.
\end{corollary}
\begin{proof}
In fact, we have, the following canonical isomorphisms:
\[(X\times_SS')\times_{S'}(Y\times_SS')=X\times_S(Y\times_SS')=(X\times_SY)\times_SS'\]
where we use \cref{scheme base change transitive} and the associativity of fiber product.
\end{proof}
Again, the functorial isomorphism in \cref{scheme base change fiber prod prop} also gives the isomorphism
\[(u_{(S')},v_{(S')})_{(S')}=((u,v)_{S})_{S'}\]
for any $S$-morphisms $u:T\to X$, $v:T\to Y$. In other words, the inverse image functor $X_{(S')}$ commutes on the formation of the products; note that it also commutes to the formation of coproducts.
\begin{corollary}\label{scheme base change base morphism prop}
Let $Y$ be an $S$-scheme, $f:X\to Y$ a morphism making $X$ a $Y$-scheme (and also an $S$-scheme). Then the scheme $X_{(S')}$ is canonically identified with the product $X\times_YY_{(S')}$, and the projection $X\times_YY_{(S')}\to Y_{(S')}$ is identified with $f_{(S')}$. 
\end{corollary}
\begin{proof}
Let $\psi:Y\to S$ be the structural morphism of $Y$; we have a commutative diagram
\[\begin{tikzcd}
X_{(S')}\ar[r,"f_{(S')}"]\ar[d]&Y_{(S')}\ar[r,"\psi_{(S')}"]\ar[d]&S'\ar[d]\\
X\ar[r,"f"]&Y\ar[r,"\psi"]&S
\end{tikzcd}\]
Now $Y_{(S')}$ is identified with $S'_{(\psi)}$, and $X_{(S')}$ with $S'_{(\psi\circ f)}$, so by \cref{scheme base change transitive} and \cref{scheme fiber product with base iso}, we deduce the corollary.
\end{proof}
\begin{example}
Let $A$ be a ring, $X$ an $A$-scheme, and $\a$ an ideal of $A$. Then $X_0=X\otimes_A(A/\a)$ is an $(A/\a)$-scheme, called the scheme obtained from $X$ by \textbf{reduction mod $\a$}.
\end{example}
\begin{proposition}\label{scheme fiber product monomorphism}
Let $f:X\to X'$, $g:Y\to Y'$ be two $S$-morphisms that are monomorphisms of schemes; then $f\times_Sg$ is a monomorphism. In particular, for any extension $S'\to S$ of base scheme, the inverse image $f_{(S')}:X_{(S')}\to Y_{(S')}$ is a monomorphism.
\end{proposition}
\begin{proof}
In fact, if $p,q$ are the projections of $X\times_SY$, and $p',q'$ that of $X'\times_SY'$:
\[\begin{tikzcd}
X\times_SY\ar[rr,"q"]\ar[dd,swap,"p"]\ar[rd,"{f\times_Sg}"description]&&Y\ar[d,"g"]\\
&X'\times_SY'\ar[r,"q'"]\ar[d,swap,"p'"]&Y'\ar[d]\\
X\ar[r,"f"]&X'\ar[r]&S
\end{tikzcd}\]
then for any two morphisms $u,v:T\to X\times_SY$, the relation $(f\times_Sg)\circ u=(f\times_Sg)\circ v$ implies
\[p'\circ(f\times_Sg)\circ u=p'\circ(f\times_Sg)\circ v\]
so $f\circ p\circ u=f\circ p\circ v$, and since $f$ is a monomorphism, we conclude $p\circ u=p\circ v$. Similarly, since $g$ is a monomorphism, we have $q\circ u=q\circ v$, whence $u=v$.
\end{proof}
For any $S$-morphism $f:S'\to X$, the morphism $f'=(f,1_{S'})_S$ is then an $S'$-morphism from $S'$ to $X'=X_{(S')}$ such that $p\circ f'=f$, $\pi'\circ f'=1_{S'}$, which is called an \textbf{$\bm{S'}$-section} of $X'$:
\[\begin{tikzcd}[row sep=15mm,column sep=15mm]
X'\ar[d,swap,"p"]\ar[r,"\pi'"]&S'\ar[ld,"f"description]\ar[l,bend right=40pt,swap,"f'"]\ar[d,"\varphi"]\\
X\ar[r,"\pi"]&S
\end{tikzcd}\]
Conversely if $f'$ is an $S'$-section, then $f=p\circ f'$ is an $S$-morphism $S'\to X$. We then deduce the following canonical correspondence
\begin{align}\label{scheme Hom(S',X) and Hom(S',X') correspond}
\Hom_{S}(S',X)\stackrel{\sim}{\to}\Hom_{S'}(S',X')
\end{align}
The morphism $f'$ is called the \textbf{graph} of $f$, and denoted by $\Gamma_f$. A particularly important case is $S'=X$ and $f=1_X$, where corresponding morphism $X\to X\times_SX$ is called the \textbf{diagonal morphism} of $X$, and denoted by $\Delta_X$. Also, if $f:X\to Y$ is a morphism of schemes, we denote by $\Delta_f$ the diagonal map from $X$ to $X\times_YX$.
\begin{example}\label{scheme X-sections of X[T] char}
Since any scheme $X$ can be considered as a $\Z$-scheme, we can consider the $X$-sections of $X\otimes_{\Z}\Z[T]$ (where $T$ is an indeterminate) corresponding to the $\Z$-morphisms $X\to\Spec(\Z[T])$. 
\[\begin{tikzcd}
X\otimes_{\Z}\Z[T]\ar[d]\ar[r]&\Spec(\Z[T])\ar[d]\\
X\ar[r]\ar[u,dashed,bend left=30pt]\ar[ru,dashed]&\Spec(\Z)
\end{tikzcd}\]
We claim that such $X$-sections correspond to sections of the structural sheaf $\mathscr{O}_X$ of $X$. In fact, the morphisms $X\to\Spec(\Z[T])$ correspond to ring homomorphisms $\Z[T]\to\Gamma(X,\mathscr{O}_X)$, which in turn are entirely determined by the image of $T$, and can be an arbitrary element of $\Gamma(X,\mathscr{O}_X)$, whence our assertion.
\end{example}
\subsection{Tensor product of quasi-coherent sheaves}
Let $S$ be a scheme, $X,Y$ be two $S$-schemes, $Z=X\times_SY$, and $p,q$ be the projections of $Z$ to $X$ and $Y$, respectively. Let $\mathscr{F}$ (resp. $\mathscr{G}$) be an $\mathscr{O}_X$-module (resp. an $\mathscr{O}_Y$-module). Then the tensor product $p^*(\mathscr{F})\otimes_{\mathscr{O}_Z}q^*(\mathscr{G})$ is called the \textbf{tensor product of $\mathscr{F}$ and $\mathscr{G}$ over $\mathscr{O}_S$} (or \textbf{over $\bm{S}$}) and denoted by $\mathscr{F}\otimes_{\mathscr{O}_S}\mathscr{G}$ (or $\mathscr{F}\otimes_S\mathscr{G}$). More generaly, if $(X_i)_{1\leq i\leq n}$ is a finite family of $S$-schemes and for each $i$, $\mathscr{F}_i$ is an $\mathscr{O}_X$-module, we can define the tensor product $\mathscr{F}_1\otimes_S\cdots\otimes_S\mathscr{F}_n$ over the scheme $Z=X_1\times_S\cdots\times_SX_n$. This is a quasi-coherent $\mathscr{O}_Z$-module if each $\mathscr{F}_i$ is quasi-coherent (\cref{scheme qcoh and exact sequence prop}), and is coherent if each $\mathscr{F}_i$ is coherent and $Z$ is locally Noetherian in view of \cref{sheaf of module coh pullback if coh sheaf of ring}.\par
We note that if $X=Y=S$, the above definition coincide with the usual one of tensor product of $\mathscr{O}_S$-modules. Moreover, as $q^*(\mathscr{O}_Y)=\mathscr{O}_{X\times_SY}$, the product $\mathscr{F}\otimes_{S}\mathscr{O}_Y$ is canonically identified with $p^*(\mathscr{F})$, and similarly $\mathscr{O}_X\otimes_S\mathscr{G}$ is identified with $q^*(\mathscr{G})$. In particular, if $Y=S$ and $f:X\to Y$ is the structural morphism, then $\mathscr{O}_X\otimes_Y\mathscr{G}=f^*(\mathscr{G})$: the ordinary tensor product and the inverse image therefore appears as a special case of the general tensor product. We also note that if $X$ and $Y$ are fixed, the operation $\mathscr{F}\otimes_S\mathscr{G}$ is a covariant bifunctor and is right exact on $\mathscr{F}$ and $\mathscr{G}$.
\begin{proposition}\label{scheme affine general tensor of qcoh char}
Let $S,X,Y$ be affine schemes with rings $A$, $B$, $C$, respectively, where $B,C$ are $A$-algebras. Let $M$ (resp. $B$) be a $B$-module (resp. $C$-module) and $\mathscr{F}=\widetilde{M}$ (resp. $\mathscr{G}=\widetilde{N}$) the associated quasi-coherent sheaf. Then $\mathscr{F}\otimes_S\mathscr{G}$ is canonically isomorphic to the sheaf associated with the $(B\otimes_AC)$-module $M\otimes_AN$.
\end{proposition}
\begin{proof}
In fact, in view of \cref{scheme affine associated sheaf inverse image char} and \cref{scheme affine associated sheaf tensor and Hom}, $\mathscr{F}\otimes_S\mathscr{G}$ is canonically isomorphic to the sheaf associated with the $(B\otimes_AC)$-module
\[(M\otimes_B(B\otimes_AC))\otimes_{B\otimes_AC}((B\otimes_AC)\otimes_CN)\]
and due to the canonical isomorphisms between tensor products, the latter is isomorphic to $M\otimes_B(B\otimes_AC)\otimes_CN=(M\otimes_BB)\otimes_A(C\otimes_CN)=M\otimes_AN$.
\end{proof}
\begin{proposition}\label{scheme inverse image of general tensor char}
Let $f:T\to X$, $g:T\to Y$ be two $S$-morphisms, and $\mathscr{F}$ (resp. $\mathscr{G}$) be an $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module). Then we have $(f,g)_S^*(\mathscr{F}\otimes_S\mathscr{G})=f^*(\mathscr{F})\otimes_{\mathscr{O}_T}g^*(\mathscr{G})$.
\end{proposition}
\begin{proof}
If $p,q$ are the projections of $X\times_SY$, the assertion follows from the relations $(f,g)_S^*\circ p^*=f^*$ and $(f,g)_S^*\circ q^*=g^*$, and the fact that the inverse image operation commutes with tensor products.
\end{proof}
\begin{corollary}\label{scheme inverse image of general tensor under product morphism}
Let $f:X\to X'$, $g:Y\to Y'$ be two $S$-schemes and $\mathscr{F}'$ (resp. $\mathscr{G}'$) be an $\mathscr{O}_{X'}$-module (resp. $\mathscr{O}_{Y'}$-module). Then $(f\times_Sg)^*(\mathscr{F}'\otimes_S\mathscr{G}')=f^*(\mathscr{F}')\otimes_Sg^*(\mathscr{G}')$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme inverse image of general tensor char} and the fact that $f\times_Sg=(f\circ p,g\circ q)_S$, where $p,q$ are the projections of $X\times_SY$.
\end{proof}
\begin{corollary}\label{scheme general tensor associativity}
Let $X,Y,Z$ be $S$-schemes and $\mathscr{F}$ (resp. $\mathscr{G}$, $\mathscr{H}$) be an $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module, $\mathscr{O}_Z$-module). Then the sheaf $\mathscr{F}\otimes_S\mathscr{G}\otimes_S\mathscr{H}$ is the inverse image of $(\mathscr{F}\otimes_S\mathscr{G}\otimes_S\mathscr{H})$ under the canonical isomorphism $X\times_SY\times_SZ\to(X\times_SY)\times_SZ$, and $\mathscr{G}\otimes_S\mathscr{F}$ is the inverse image of $\mathscr{F}\otimes_S\mathscr{G}$ under the canonical isomorphism $X\times_S\to Y\times_SX$.
\end{corollary}
\begin{proof}
The first isomorphism is $(p_1,p_2)_S\times_Sp_3$, where $p_1,p_2,p_3$ are the projections of $X\times_SY\times_SZ$, and second one is similarly.
\end{proof}
\begin{corollary}
If $X$ is an $S$-scheme, any $\mathscr{O}_X$-module $\mathscr{F}$ is the inverse image of $\mathscr{F}\otimes_S\mathscr{O}_S$ under the canonical isomorphism from $X$ to $X\times_SS$.
\end{corollary}
Let $X$ be an $S$-scheme, $\mathscr{F}$ be an $\mathscr{O}_X$-module, and $\varphi:S'\to S$ be an morphism. We denote by $\mathscr{F}_{(\varphi)}$ or $\mathscr{F}_{(S')}$ the sheaf $\mathscr{F}\otimes_S\mathscr{O}_{S'}$ over $X\times_SS'=X_{(\varphi)}=X_{(S')}$, so $\mathscr{F}_{(S')}=p^*(\mathscr{F})$, where $p$ is the projection $X_{(S')}\to X$.
\begin{proposition}\label{scheme sheaf base change transitivity}
Let $\varphi':S''\to S'$ be a morphism. For any $\mathscr{O}_X$-module $\mathscr{F}$ over the $S$-scheme $X$, $(\mathscr{F}_{(\varphi)})_{(\varphi')}$ is the inverse image of $\mathscr{F}_{(\varphi\circ\varphi)}$ under the canonical isomorphism $(X_{(\varphi)})_{(\varphi')}\to X_{(\varphi\circ\varphi')}$.
\end{proposition}
\begin{proof}
This follows from the definition and the associativity of base change, since $(\mathscr{F}\otimes_S\mathscr{O}_{S'})\otimes_{S'}\mathscr{O}_{S''}=\mathscr{F}\otimes_S\mathscr{O}_{S''}$.
\end{proof}
\begin{proposition}\label{scheme sheaf base change and inverse image commute}
Let $Y$ be an $S$-scheme and $f:X\to Y$ be an $S$-morphism. For any $\mathscr{O}_Y$-module $\mathscr{G}$ and any morphism $S'\to S$, we have $(f_{(S')})^*(\mathscr{G}_{(S')})=(f^*(\mathscr{G}))_{(S')}$.
\end{proposition}
\begin{proof}
This follows from the diagram
\[\begin{tikzcd}
X_{(S')}\ar[d]\ar[r,"f_{(S')}"]&Y_{(S')}\ar[d]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
and the functoriality of inverse images.
\end{proof}
\begin{corollary}\label{scheme sheaf base change and product commute}
Let $X,Y$ be $S$-schemes and $\mathscr{F}$ (resp. $\mathscr{G}$) be an $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module). For any morphism $S'\to S$, the inverse image of the sheaf $(\mathscr{F}_{(S')})\otimes_{S'}(\mathscr{G}_{(S')})$ under the canonical isomorphism $(X\times_SY)_{(S')}\cong(X_{(S')})\times_{S'}(Y_{(S')})$ is equal to $(\mathscr{F}\otimes_S\mathscr{G})_{(S')}$.
\end{corollary}
\begin{proof}
If $p,q$ are the projections of $X\times_SY$, the isomorphism is given by $(p_{(S')},q_{(S')})_S'$, so the corollary follows from \cref{scheme inverse image of general tensor char} and \cref{scheme sheaf base change and inverse image commute}.
\end{proof}
\begin{proposition}\label{scheme general tensor stalk char}
Let $X,Y$ be two $S$-schemes and $\mathscr{F}$ (resp. $\mathscr{G}$) be an $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module). Let $p,q$ be the projections of $Z=X\times_SY$, $z$ be a point of $Z$, and put $x=p(z)$, $y=q(z)$. Then the stalk $(\mathscr{F}\otimes_S\mathscr{G})_z$ is isomorphic to $(\mathscr{F}_x\otimes_{\mathscr{O}_{X,x}}\mathscr{O}_{Z,z})\otimes_{\mathscr{O}_{Z,z}}(\mathscr{G}_y\otimes_{\mathscr{O}_{Y,y}}\mathscr{O}_{Z,z})=\mathscr{F}_x\otimes_{\mathscr{O}_{X,x}}\mathscr{O}_{Z,z}\otimes_{\mathscr{O}_{Y,y}}\mathscr{G}_y$.
\end{proposition}
\begin{proof}
Since the question is local, we can reduce to the affine case, and the assertion follows from \cref{scheme affine associated sheaf tensor and Hom}.
\end{proof}
\begin{corollary}\label{scheme general tensor of ft sheaf supp char}
With the notations in \cref{scheme general tensor stalk char}, if $\mathscr{F}$ and $\mathscr{G}$ are of finite type, then
\[\supp(\mathscr{F}\otimes_S\mathscr{G})=p^{-1}(\supp(\mathscr{F}))\cap q^{-1}(\supp(\mathscr{G})).\]
\end{corollary}
\begin{proof}
As $p^*(\mathscr{F})$ and $q^*(\mathscr{G})$ are of finite type over $\mathscr{O}_{Z}$, in view of \cref{scheme general tensor stalk char} and \cref{supp of module finite tensor}, we can reduce to the case $\mathscr{G}=\mathscr{O}_Y$, and the assertion then follows from the formula $\supp(p^{-1}(\mathscr{F}))=p^{-1}(\supp(\mathscr{F}))$.
\end{proof}
\subsection{Scheme valued points}
Let $X$ be a scheme; for any scheme $T$, we denote by $X(T)$ the set $\Hom(T,X)$ of morphisms from $T$ to $X$, and the elements of this set will be called \textbf{points of $\bm{X}$ with values in $\bm{T}$}. The operation $T\mapsto X(T)$ is then a contravariant functor from the category of schemes to that of sets (in one word, we identify the scheme $X$ with the induced functor $h_X$ on $\mathbf{Sch}$). Moreover, any morphism $g:X\to Y$ of schemes defines a natural transform $X(T)\to Y(T)$, which send $v\in X(T)$ to $g\circ v\in Y(T)$. The product of two $S$-schemes $X$ and $Y$ is then defined by the canonical isomorphism
\begin{align}\label{scheme fiber product as functor}
(X\times_SY)(T)\stackrel{\sim}{\to}X(T)\times_{S(T)}Y(T)
\end{align}
where the maps $X(T)\to S(T)$ and $Y(T)\to S(T)$ corresponds to the structural morphisms $X\to S$ and $Y\to S$.\par
If we are given a scheme $S$ and consider $S$-schemes and $S$-morphisms, we denote by $X(T)_S$ the set $\Hom_S(T,X)$ of $S$-morphisms $T\to X$, and omit the index $S$ if there is no risk of confusion. We also say the elements of $X(T)_S$ are the ($S$-)points of the $S$-scheme $X$ with values in the $S$-scheme $T$. In particular, an $S$-section of $X$ is none other than a point of $X$ with values in $S$. The formula (\ref{scheme fiber product as functor}) is then written as
\[(X\times_SY)(T)_S=X(T)_S\times Y(T)_S;\]
more generally, if $Z$ is an $S$-scheme, $X,Y,T$ are $Z$-schemes, we have
\[(X\times_ZY)(T)_S=X(T)_S\times_{Z(T)_S}Y(T)_S.\]
We remark that for any morphism $S'\to S$, the set $X(S')_S=\Hom_S(S',X)$ is identified with the set $\Hom_{S'}(S',X')$, where $X'=X\times_SS'$, which is the set of $S'$-sections of $X'$.\par
In $T$ (resp. $S$) is an affine scheme with ring $B$ (resp. $A$), we replace $T$ (resp. $S$) by $B$ (resp. $A$) in the above notations, and we then refer points of $X$ with values in the ring $B$, or points of the $A$-scheme $X$ with values in the $A$-algebra $B$ for the elements $X(B)$ of $X(B)_A$, respectively. We also call $X(T)_A$ the set of points of the $A$-scheme $X$ with values in the $A$-scheme $T$.\par
Consider in particular the case where $T$ is a local scheme $\Spec(A)$, where $A$ is a local ring; the elements $X(A)$ corresponds to local homomorphisms $\mathscr{O}_{X,x}\to A$ for $x\in X$ (\cref{scheme local morphism correspond local ring homomorphism}); we say the point $x$ of the underlying topological space $X$ is the \textbf{locality} of the point of $X$ with values in $A$ to which it corresponds (of course, several distinct points of $X$ with values in $A$ can have the same locality), or that the point of $X$ with values in $A$ which corresponds to $x$ is \textbf{localizaed in $\bm{x}$}.\par
Even more particularly, a point of $X$ with values in a field $K$ correspond to a point $x\in X$ and a field extension $\kappa(x)\to K$. If $X$ is an $S$-scheme, saying that $S'=\Spec(K)$ is an $S$-scheme means $K$ is an extension of the residue field $\kappa(s)$ for an point $s\in S$; an element of $X(K)_S$, which is called \textbf{a point of $\bm{X}$ lying over $\bm{s}$ with values in $\bm{K}$}, corresponds then to a $\kappa(s)$-homomorphism $\kappa(x)\to K$, where $x$ is a point of the topological space $X$ lying over $s$ (hence $\kappa(x)$ is an extension of $\kappa(s)$).\par
The points of $X$ with values in an algebraically closed field $K$ are called \textbf{geometric points} of the scheme $X$;\footnote{This terminology is also sometimes used when $K$ is only separably closed, but at that time we will explicitly clarify which convention we adapt.} the field $K$ is called the \textbf{value field} of the geometric point. If $X$ is an $S$-scheme and $s$ is an point of $S$, a \textbf{geometric point of $\bm{X}$ lying over $\bm{s}$} is then a geometric point of $X$ localizaed in a point of $X$ lying over $s$. We then have a map $X(K)\to X$, which send a geometric point with values in $K$ to the point it locates.\par
If $S=\Spec(k)$ is the spectrum of a field $k$ and $X$ is an $S$-scheme, the $S$-points of $X$ with values in $k$ is identified with the $S$-sections of $X$, or with the points $x$ of $X$ such that the canonical homomorphism $k\to\kappa(x)$ is an isomorphism since only at such a point there exists a homomorphism $\kappa(x)\to k$ such that the composition $k\to\kappa(x)\to k$ is the identity. Such points are called the \textbf{rational points} over $k$ of the $k$-scheme $X$. Note that if $k'$ is an extension of $k$, the points of $X$ with values in $k'$ correspond to the points of $X'=X_{(k')}$ rational over $k'$ (cf. (\ref{scheme Hom(S',X) and Hom(S',X') correspond})).\par
The example $X=\Spec(K)$, where $K$ is an nontrivial extension of $k$, shows that there do not necessarily exist in $X$ rational points on $k$, even if $X$ is nonempty. Still assuming that $X$ is a $k$-scheme. For any point $x\in X$, there is always an extensions $k'$ of $k$ for which there is a point $x'$ of $X'=X_{(k')}$ rational over $k'$ and whose image by the canonical projection $X'\to X$ is $x$: it suffices to take for $k'$ an extension of $\kappa(x)$, the $k$-monomorphism $\kappa(x)\to k'$ giving the sought point $x'$. When we thus passes from a point $x$ to a rational point $x'\in X'$ over $k'$ and above $x$, we say that we "make $x$ rational."
\begin{proposition}\label{scheme over field rational point closed}
Let $S=\Spec(k)$ be the specturm of a field $k$, and $X$ be an $S$-scheme. Then any $k$-rational point of $X$ is closed in $X$.
\end{proposition}
\begin{proof}
In fact, it suffices to show that the point $x$ is closed in any open affine open set containing $x$, so we may assume that $X=\Spec(A)$ is affine. In this case, since the composition homomorphism $k\to A\to\kappa(x)$ is an isomorphism (we know that $\kappa(x)=k$), we conclude in particular that $A/\p_x\to k$ is an integral extension, which implies that $A/\p_x$ is a field (\cref{integral ring extension field iff}).
\end{proof}
\begin{proposition}\label{scheme fiber product lift point in a field}
Let $(X_i)_{1\leq i\leq n}$ be $S$-schemes, $s$ a point of $X$, and $x_i$ a point of $X_i$ lying over $s$ for each $i$. For there to be a point $y$ of the scheme $Y=X_1\times_S\cdots\times_SX_n$ whose projections on $X_i$ is $x_i$, it is necessary and sufficient that the $x_i$ are over the same point $s$ of $S$.
\end{proposition}
\begin{proof}
This condition is clearly necessary. Now let $s$ be an element of $S$ and $x_i$ a point of $X_i$ lying over $s$. Then there exist $\kappa(s)$-homomorphisms $\kappa(x_i)\to K$ where $K$ is a common field. The composition $\kappa(s)\to\kappa(x_i)\to K$ are all identical, so the morphisms $\Spec(K)\to X_i$ corresponding to $\kappa(x_i)\to K$ are $S$-morphisms, and we conclude that they define a unique morphism $\Spec(K)\to Y$. If $y$ is the corresponding point of $Y$, it is clear that its projection into each of the $X_i$ is $x_i$.
\end{proof}
In other words, if we denote by $(X)$ the set underlying $X$, we see that we have a canonical surjective map $(X\times_SY)\to(X)\times_{(S)}(Y)$; we have already pointed that this maps is not injective in general; that is, there can be multiple points distinct in $X\times_SY$ having same projections to $X$ and $Y$.
\begin{corollary}\label{scheme inverse image under base change prop}
Let $f:X\to Y$ be an $S$-morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ the $S'$-morphism induced by a base change $S'\to S$. Let $p$ (resp. $q$) be the projection $X_{(S')}\to X$ (resp. $Y_{(S')}\to Y$); for any subset $V$ of $X$, we have 
\[q^{-1}(f(M))=f_{(S')}(p^{-1}(M)).\]
\end{corollary}
\begin{proof}
By \cref{scheme base change base morphism prop}, $X_{(S')}$ is identified with the product $X\times_YY_{(S')}$ and we have the following commutative diagram
\[\begin{tikzcd}
X_{(S')}\ar[r,"f_{(S')}"]\ar[d,swap,"p"]&Y_{(S')}\ar[d,"q"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
By \cref{scheme fiber product lift point in a field}, the relation $q(y')=f(x)$ for $x\in V$, $y'\in Y_{(S')}$ is equivalent to the existence of a point $x'\in X_{(S')}$ such that $p(x')=x$ and $f_{(S')}(x')=y'$, whence the corollary.
\end{proof}
\begin{proposition}\label{scheme fiber product inverse image char by composition extension}
Let $X,Y$ be $S$-schemes and $x\in X$, $y\in Y$ two points lying over the same point $s\in S$. Then the set of points $X\times_SY$ with projections $x$ and $y$ is in canonical correspondence with the set of types of the composition field extension of $\kappa(x)$ and $\kappa(y)$, considered as extensions of $\kappa(s)$.
\end{proposition}
\begin{proof}
Let $p$ (resp. $q$) be the projection of $X\times_SY$ to $X$ (resp. $Y$) and let $E$ be the subspace $p^{-1}(x)\cap q^{-1}(y)$ of the underlying topological space of $X\times_SY$. We first note that since $x$ and $y$ are lying over $s$, the morphisms $\Spec(\kappa(x))\to S$ and $\Spec(\kappa(y))\to S$ factor through $\Spec(\kappa(s))$:
\[\begin{tikzcd}
&\Spec(\kappa(x))\ar[d]&\\
\Spec(\kappa(y))\ar[r]&\Spec(\kappa(s))\ar[r]&S
\end{tikzcd}\]
since $\Spec(\kappa(s))\to S$ is a monomorphism by \cref{scheme local of field morphism is mono}, it follows immediately that we have
\[P=\Spec(\kappa(x))\times_S\Spec(\kappa(y))=\Spec(\kappa(x))\times_{\Spec(\kappa(s))}\Spec(\kappa(y))=\Spec(\kappa(x)\otimes_{\kappa(s)}\kappa(y)).\]
Let $i:\Spec(\kappa(x))\to X$ and $j:\Spec(\kappa(y))\to Y$ be the canonical morphisms, we put $\alpha=i\times_Sj:P\to E$ to be the map on the underlying topological space. On the other hand, any point $z\in E$ defines two $\kappa(s)$-homomorphisms $\kappa(x)\to\kappa(z)$ and $\kappa(y)\to\kappa(z)$, hence a $\kappa(s)$-homomorphism $\kappa(x)\otimes_{\kappa(s)}\kappa(y)\to\kappa(z)$, which corresponds to a morphism $\Spec(\kappa(z))\to P$; we take $\beta(z)$ to be the image of this morphism, which defines a map $\beta:E\to P$.\par
To verify that $\alpha\circ\beta$ and $\beta\circ\alpha$ are identity maps, we need the following commutative diagram
\[\begin{tikzcd}[row sep=3mm,column sep=3mm]
\Spec(\kappa(z))\ar[rd]\ar[rrd,bend left=20pt]\ar[rdd,bend right=30pt]&&&\\
&P\ar[r]\ar[rd,"\alpha"description]\ar[d]&\Spec(\kappa(y))\ar[rd,"j"]&\\
&\Spec(\kappa(x))\ar[rd,swap,"i"]&E\ar[d]\ar[r]&Y\ar[d]\\
&&X\ar[r]&S
\end{tikzcd}\]
for $z\in E$. By the uniqueness part of the universal property of fiber products, the canonical morphism $\Spec(\kappa(z))\to E$ induced by $\Spec(\kappa(z))\to X$ and $\Spec(\kappa(z))\to Y$ is given by the composition $\Spec(\kappa(z))\to P\to E$, and also equal to the canonical morphism $\Spec(\kappa(z))\to E$ of the scheme $X\times_SY$ at $z$ (\cref{scheme local of field morphism factors through prop}). This means the image of $\beta(z)$ under $\alpha$ is exactly the image of the canonical morphism $\Spec(\kappa(z))\to E$, which is just $z$; this shows $\alpha\circ\beta=1_E$. As for $\beta\circ\alpha$, we just note that if $z=\alpha(\p)$ for some $\p\in P$ (a prime ideal), then the morphism $\alpha$ induces a field extensins $\kappa(z)\to\kappa(\p)$, which corresponds to morphism $\Spec(\kappa(\p))\to\Spec(\kappa(z))$. Again by the uniqueness part of the fiber product $P$, we conclude that the canonical morphism $\Spec(\kappa(\p))\to P$ factors through $\Spec(\kappa(z))$, which means $\beta(z)=\p$, so $\beta\circ\alpha=1_P$. Finally, we recall that the set $P$ corresponds to composition fields of $\kappa(x)$ and $\kappa(y)$ over $\kappa(s)$.
\end{proof}
\subsection{Surjective morphisms}
Let $\mathcal{P}$ be a property for morphisms of schemes. We consider the following conditions:
\begin{enumerate}
\item[(\rmnum{1})] If $f:X\to X'$ and $g:Y\to Y'$ are $S$-morphisms satisfying $\mathcal{P}$, then $f\times_Sg$ also satisfies $\mathcal{P}$.
\item[(\rmnum{2})] If $f:X\to Y$ is an $S$-morphism satisfying $\mathcal{P}$ and $S'\to S$ is a morphism, then $f_{(S')}:X_{(S')}\to Y_{(S')}$ also satisfies $\mathcal{P}$.
\end{enumerate}
Since $f_{(S')}=f\times_S1_{S'}$, we see if any identity morphism satisfies $\mathcal{P}$, then (\rmnum{1}) implies (\rmnum{2}). On the other hand, since $f\times_Sg$ is the following composition
\[\begin{tikzcd}
X\times_SY\ar[r,"f\times 1_Y"]&X'\times_SY\ar[r,"1_{X'}\times g"]&X'\times_SY'
\end{tikzcd}\]
it is clear that if the composition of two morphisms satisfying $\mathcal{P}$ still satisfies $\mathcal{P}$, then (\rmnum{2}) implies (\rmnum{1}) (in this case we say $\mathcal{P}$ is stable under composition). In general, a property $\mathcal{P}$ is called \textbf{stable under base change} if it satisfies the condition (\rmnum{2}). For example \cref{scheme fiber product monomorphism} just says that being a monomorphism is stable under base change. On the other hand, if $\mathcal{P}$ is an arbitrary property of morphisms, we say a morphism $f:X\to S$ \textbf{satisfies $\mathcal{P}$ universally} (or is \textbf{universally $\mathcal{P}$}), if for any morphism $S'\to S$ the inverse image $f_{(S')}$ satisfies $\mathcal{P}$.\par
Our first application of the above definition is that surjectivity is stable under base change:
\begin{proposition}\label{scheme surjective stable under base change}
Surjective morphisms of schemes are stable under base change.
\end{proposition}
\begin{proof}
Note that it is clear that surjectivity is stable under composition, in fact we have the both conditions (\rmnum{1}) and (\rmnum{2}) described above. But condition (\rmnum{2}) follows from \cref{scheme inverse image under base change prop} by setting $V=X$.
\end{proof}
\begin{proposition}\label{scheme surjective iff geometric point extension}
For a morphism $f:X\to Y$ of schemes to be surjective, it is necessary and sufficient that for any field $K$ and any morphism $\Spec(K)\to Y$, there exists an extension $K'$ of $K$ and a morphism $\Spec(K')\to X$ fitting into the following diagram
\[\begin{tikzcd}
\Spec(K')\ar[d]\ar[r]&X\ar[d,"f"]\\
\Spec(K)\ar[r]&Y
\end{tikzcd}\]
\end{proposition}
\begin{proof}
The condition is sufficient, since for any $y\in Y$, we can apply the canonical morphism $\Spec(\kappa(y))\to Y$ to get a morphism $\Spec(K)\to X$, which gives a inverse image of $y$ in $X$. Conversely, suppose that $f$ is surjective, and let $y\in T$ be the image of $\Spec(K)$ in $Y$; there exists $x\in X$ such that $f(x)=y$. Consider the monomorphism $\kappa(y)\to\kappa(x)$ corresponding to $f$, and take an extension $K'$ of $\kappa(y)$ containing $\kappa(x)$ and $K$; the morphism $\Spec(K')\to X$ corresponding to $\kappa(x)\to K'$ then satisfies the requirement.
\end{proof}
\begin{corollary}\label{scheme surjective iff geometric point surjective}
For a morphism $f:X\to Y$ to be surjective, it is necessary and sufficient that, for any field $K$, there exist an algebraically closed extension $K'$ of $K$ such that the map $X(K')\to Y(K')$ corresponding to $f$ is surjective.
\end{corollary}
\begin{proof}
In view of \cref{scheme surjective iff geometric point extension}, this condition is sufficient. Conversely, suppose that $f$ is surjective and let $K$ be a field. If $p$ is the characteristic of $K$, let us take for $K'$ an algebraically closed extension of $K$ having over the prime field $P$ a transcendence basis of strictly larger cardinality to the cardinals of all the transcendence bases on $P$ of the residual fields of $X$ and $Y$ having characteristic $p$. It then remains to see, with the same notations as in \cref{scheme surjective iff geometric point extension}, that any monomorphism $u:\kappa(y)\to K'$ factors into
\[\begin{tikzcd}
\kappa(y)\ar[r,"w"]&\kappa(x)\ar[r,"v"]&K'
\end{tikzcd}\]
where $w=f^x$. Now, let $L$ a purely transcendental extension of $P$ contained in $\kappa(y)$ and over which $\kappa(y)$ is algebraic; if $B$ is a transcendence basis of $L$ over $P$, we can complete $w(B)$ into a transcendence basis $B'$ of $\kappa(x)$ on $P$, and then (due to the assumption made on the trancendence bases of $K'$) define a monomorphism $v_1:P(B')\to K'$ such that $v_1\circ(w|_L)$ coincides with $u|_L$. There is also an isomorphism $v_2=u\circ w^{-1}$ from $w(\kappa(y))$ to $u(\kappa(y))$ such that $v_2$ and $v_1$ coincide in $w(L)$; as $w(\kappa(y))$ and $P(B'-w(B))$ are linearly disjoint on $w(L)$, we can extend $v_1$ and $v_2$ into a monomorphism $v_0$ of $M=P(B')(w(\kappa(y)))$ in $K'$; as $K'$ is algebraically closed and $\kappa(x)$ is algebraic over $M$, we can finally extend $v_0$ into the monomorphism $v:\kappa(x)\to K'$, which completes the proof.
\end{proof}
\subsection{Radical morphisms}
\begin{proposition}\label{scheme radical morphism def}
Let $f:X\to Y$ be a morphism of schemes. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is universally injective.
\item[(\rmnum{2})] The map $f$ is injective and for any $x\in X$, the extension $f^x:\kappa(f(x))\to\kappa(x)$ is purely inseparable.
\item[(\rmnum{3})] For any field $K$, the map $X(K)\to Y(K)$ corresponding to $f$ is injective.
\item[(\rmnum{4})] For any field $K$, there exists an algebraically closed extension $K'$ of $K$ such that the map $X(K')\to X(K')$ corresponding to $f$ is injective.
\item[(\rmnum{5})] The diagonal morphism $\Delta_f:X\to X\times_YX$ is surjective.    
\end{enumerate}
The morphism $f$ is called \textbf{radical} if it satisfies the above equivalent conditions.
\end{proposition}
\begin{proof}
It is clear that (\rmnum{1}) implies $f$ is injective; on the other hand, if $\kappa(x)$ is not a purely inseparable extension of $\kappa(f(x))$, there exist two distinct $\kappa(f(x))$-monomorphisms $\kappa(x)\to K$ into an algebraically closed extension $K$ of $\kappa(x)$; hence we get two distinct morphisms $g_1,g_2$ of $\Spec(K)$ to $X$, whose compositions $f\circ g_1$, $f\circ g_2$ equal to the same morphism $\Spec(K)\to Y$. If we set $Y'=\Spec(K)$, there then would be two distinct $Y'$-sections of $X_{(Y')}$; since $K$ is a field, the $Y'$-sections of $X_{(Y')}$ correspond one-to-one to their images (the rational points of $X_{(Y')}$ over $K$), so $f_{(Y')}:X_{(Y')}\to Y'$ would not be injective, contrary to the assumption.\par
To show that (\rmnum{2}) implies (\rmnum{3}), we note that by \cref{scheme local of field morphism factors through prop}, (\rmnum{3}) signifies that for any $y\in Y$ and a monomorphism $\kappa(y)\to K$ to a field $K$, there do not exist two distinct $\kappa(y)$-monomorphisms $\kappa(x_1)\to K$, $\kappa(x_2)\to K$, where $x_1$, $x_2$ are both lying over $y$. Now (\rmnum{2}) implis that if we have two such monomorphisms, they come from the same point $x$ since $f$ is injective; moreover, since $\kappa(x)$ is a purely inseparable extension of $\kappa(y)$, the two monomorphisms $\kappa(x)\to K$ are necessarily equal.\par
It is clear that (\rmnum{3}) implies (\rmnum{4}). Conversely, suppose that (\rmnum{4}) holds; let $K$ be a field and $K'$ be an algebraically closed extension of $K$; then the diagram
\begin{equation}\label{scheme radical extension iff-1}
\begin{aligned}
\begin{tikzcd}
X(K)\ar[r,"\alpha"]\ar[d,"\varphi"]&Y(K)\ar[d,"\varphi'"]\\
X(K')\ar[r,"\alpha'"]&Y(K')
\end{tikzcd}
\end{aligned}
\end{equation}
is commutative. Since the homomorphism $K\to K'$ is injective, $\varphi$ is injective by \cref{scheme local of field morphism factors through prop}, and by hypothesis we can choose $K'$ such that $\alpha'$ is also injective. Then $\alpha$ is injective, which shows (\rmnum{3}).\par
To see that (\rmnum{4}) and (\rmnum{5}) are equivalent, we note that, for the morphism $\Delta_f$ to be surjective, it is necessary and sufficient that, in view of \cref{scheme surjective iff geometric point surjective}, for any field $K$, there exists an algebraically closed extension $K'$ of $K$ such that the diagonal map
\[X(K')\to(X\times_YX)(K')=X(K')\times_{Y(K')}X(K')\]
corresponding to $\Delta_f$ is surjective. But by the definition of this fiber product, this signifies that the map $X(K')\to Y(K')$ is injective, whence our claim.\par
Finally, we prove that (\rmnum{3}) implies (\rmnum{1}). If (\rmnum{3}) is satisfied, then for any base change $Y'\to Y$, the map
\[(X\times_YY')(K)\to Y'(K)\]
is still injective, as we immediately verify by noting that $(X\times_YY')(K)=X(K)\times_{Y(K)}Y'(K)$ and that $X(K)\to Y(K)$ is injective. Therefore, it suffices to prove that if $X(K)\to Y(K)$ is injective for any field $K$, then $f$ is injective. Now if $x_1$ and $x_2$ are two points of $X$ such that $f(x_1)=f(x_2)=y$, there then exists a field extension $K$ of $\kappa(y)$ and $\kappa(y)$-monomorphisms $\kappa(x_1)\to K$, $\kappa(x_2)\to K$; the corresponding morphisms $u_1,u_2$ of $\Spec(K)$ to $X$ are then such that $f\circ u_1=f\circ u_2$, and by hypothesis this implies $u_1=u_2$, so $x_1=x_2$. 
\end{proof}
\begin{remark}
We then obtain examples of injective morphisms (and even bijective) of schemes but not universally injective: it suffices to take a morphism $\Spec(K)\to\Spec(k)$, where $K$ is a separable extension of $k$ distinct from $k$.
\end{remark}
\begin{corollary}\label{scheme monomorphism is radical}
A monomorphism of schemes $f:X\to Y$ is radical. In particular, if $A$ is a ring, $S$ is a multiplicative subset of $A$, then the canonical morphism $\Spec(S^{-1}A)\to\Spec(A)$ is radical.
\end{corollary}
\begin{proof}
The first assertion follows from \cref{scheme radical morphism def}(\rmnum{3}), and the second from the fact that $\Spec(S^{-1}A)\to\Spec(A)$ is a monomorphism.
\end{proof}
\begin{corollary}\label{scheme radical morphism geometric point inverse image}
Let $f:X\to Y$ be a radical morphism, $g:Y'\to Y$ a morphism, and $X'=X_{(Y')}$. Then the radical morphism $f_{(Y')}$ is a bijection from the underlying space $X'$ to $g^{-1}(f(X))$. Moreover, for any field $K$, the set $X'(K)$ is identified with the inverse image in $Y'(K)$ under the map $Y'(K)\to Y(K)$ (corresponding to $g$) of the subset $X(K)$ of $Y(K)$.
\end{corollary}
\begin{proof}
The first assertion follows from \cref{scheme radical morphism def}(\rmnum{2}) and \cref{scheme inverse image under base change prop}; the second one follows from the commutative diagram (\ref{scheme radical extension iff-1}).
\end{proof}
\begin{proposition}\label{scheme radical stable under composition}
Let $f:X\to Y$ and $g:Y\to Z$ be two morphism of schemes.
\begin{enumerate}
\item[(a)] If $f$ and $g$ are radical, so is $g\circ f$.
\item[(b)] Conversely, if $g\circ f$ is radical, so is $f$.
\end{enumerate}
\end{proposition}
\begin{proof}
It suffices to apply the functors $X,Y,Z$ on any field $K$, and use the characterization of \cref{scheme radical morphism def}(\rmnum{3}); the verification boils down to set-theoretic issues, which are straightforward. 
\end{proof}
\begin{proposition}\label{scheme radical stable under base change}
Radical morphisms are stable under base changes. In particular, if $f:X\to X'$ and $g:y\to Y'$ are radical $S$-morphisms, then so is $f\times_Sg$.
\end{proposition}
\begin{proof}
Since radical is equivalently to universally injective, the first assertion is clear. The second one follows from the first one since radical morphisms are stable under composition by \cref{scheme radical stable under composition}.
\end{proof}
\subsection{Fibers of morphisms}
\begin{proposition}\label{scheme morphism base change by local scheme prop}
Let $f:X\to Y$ be a morphism, $y$ be a point of $Y$, and $\a_y$ be an ideal of $\mathscr{O}_{Y,y}$. Put $Y'=\Spec(\mathscr{O}_{Y,y}/\a_{y})$, $X'=X\times_YY'$, and let $p:X'\to X$ be the canonical projection. Then $p$ is a homeomorphism from $X'$ onto the subspace $f^{-1}(Y')$ of $X$ (where we identify $Y'$ are a subspace of $Y$, cf. \cref{scheme local scheme correspond generalization}). Moreover, for any $x'\in X'$, the homomorphism $p^{\#}_{x'}:\mathscr{O}_{X,p(x')}\to\mathscr{O}_{X',x'}$ is surjective with kernel $\a_y\mathscr{O}_{X,x}$.
\end{proposition}
\begin{proof}
The morphism $\Spec(\mathscr{O}_{Y,y}/\a_y)\to Y$ is radical (\cref{scheme radical morphism def}), so we conclude from \cref{scheme radical morphism geometric point inverse image} that $p$ identifies the space $X'=X\times_Y\Spec(\mathscr{O}_{Y,y}/\a_y)$ with $f^{-1}(Y')$. It remains to show that $p$ is a homeomorphism and identify its morphism on stalks. Since this question is local, we may assume that $X=\Spec(B)$, $Y=\Spec(A)$, where $B$ is an $A$-algebra. Then the morphism $p$ corresponds to the homomorphism $1\otimes\rho:B\to B\otimes_AA'$, where $\rho:A\to A'=A_{\p_y}/\a_y$ is the canonical homomorphism. Now any element of $B\otimes_AA'$ is of the form
\[\sum_ib_i\otimes\rho(a_i)/\rho(s)=\rho\Big(\sum_ia_ib_i\otimes 1\Big)(1\otimes\rho(s))^{-1}\]
where $s\notin\p_y$, so we can apply \cref{Spec of ring and quotient map}. The assertion on the homomorphism $p_{x'}^{\#}$ also follows from the equality.
\end{proof}
We will mainly use \cref{scheme morphism base change by local scheme prop} for the case $\a_y=\m_y$ is the maximal ideal of $\mathscr{O}_{Y,y}$. If there is no confusion, we denote by $X_y$ the $\kappa(y)$-scheme obtained by transporting of scheme structure from $X'=X\otimes_S\kappa(s)$ to $f^{-1}(y)$ via the projection $p$, and this is always the scheme that will be involved when we speak of the \textbf{fiber} $f^{-1}(y)$ of the morphism $f$ as a scheme.\par
Let $X,Y$ be two $S$-schemes and $f:X\to Y$ an $S$-morphism. By the transitivity of base change, we have the canonical isomorphism
\[X_s=X\times_YY_s\]
for any $s\in S$; the morphism $f_s:X_s\to Y_s$ induced by $f$ by the base change $Y_s\to Y$ is such that, for any $y\in Y_s$, the fiber $f_s^{-1}(y)$ is identified with the $\kappa(y)$-scheme $f^{-1}(y)$, since the residue field of $Y_s$ at $y$ is the same as that of $Y$ at $y$, in view of \cref{scheme morphism base change by local scheme prop}
\begin{proposition}[\textbf{Transitivity of Fibers}]\label{scheme fiber transitivity}
Let $f:X\to Y$, $g:Y'\to Y$ be two morphisms; put $X'=X_{(Y')}$ and $f'=f_{(Y')}$. For any $y'\in Y'$, if $y=g(y')$, then the scheme $X'_{y'}$ is canonically isomorphic to $X_y\otimes_{\kappa(y)}\kappa(y')$.
\end{proposition}
\begin{proof}
In fact, by the transitivity of base change, we have canonical isomorphisms
\[(X\otimes_Y\kappa(y))\otimes_{\kappa(y)}\kappa(y')\cong X\times_Y\Spec(\kappa(y'))\cong(X\times_YY')\otimes_{Y'}\kappa(y')\]
The left one is $X_y\otimes_{\kappa(y)}\kappa(y')$, and the right one is $X'_{y'}\otimes_{Y'}\kappa(y')$, so our assertion follows.
\end{proof}
\begin{proposition}\label{scheme monomorphism fiber prop}
Let $f:X\to Y$ be a monomorphism of schemes. Then for each $y\in Y$, the fiber $X_y$ is a $\kappa(y)$-scheme which is either empty or $\kappa(y)$-isomorphic to $\Spec(\kappa(y))$.
\end{proposition}
\begin{proof}
By \cref{scheme morphism base change by local scheme prop}, $X_y$ is reduced to a point, and hence affine. By \cref{scheme fiber product monomorphism}, the morphism $f_y:X_y\to\Spec(\kappa(y))$ induced by $f$ under base change is still a monomorphism. If $A$ is the ring of $X_y$, this signifies that the homomorphism $A\otimes_{\kappa(y)}A\to A$ which maps $a\times a'$ to $aa'$ is bijective, and clearly implies that $A=\kappa(y)$, since otherwise there exist an element $a\in A$ not contained in $\kappa(y)$ and the image $a\otimes 1$ and $1\otimes a$ are distinct, but both mapped to $a$.
\end{proof}
\begin{proposition}\label{scheme property descent under surjective base change}
Let $f:X\to Y$ be an $S$-morphism of $S$-schemes, $g:S'\to S$ a surjective morphism, and $f'=f_{(S')}:X'=X_{(S')}\to Y'=Y_{(S')}$. Consider the following properties:
\begin{enumerate}
\item[(a)] surjective;
\item[(b)] injective;
\item[(c)] dominant;
\item[(d)] finite fiber (as sets);
\end{enumerate}
Then if $\mathcal{P}$ denotes one of the properties above and if $f'$ satisfies $\mathcal{P}$, then so does $f$.
\end{proposition}
\begin{proof}
Since the projection $Y'\to Y$ is surjective by \cref{scheme surjective stable under base change}, we can, by virtue of \cref{scheme base change base morphism prop}, limiting ourselves to the case where $Y=S$, $Y'=S'$. For any $y'\in Y'$, let $y=g(y')$; we have the transitivity relation $X'_{y'}\cong X_y\otimes_{\kappa(y)}\kappa(y')$ (\cref{scheme fiber transitivity}). Since the morphism $\Spec(\kappa(y'))\to\Spec(\kappa(y))$ is surjective, so is the projection $X'_{y'}\to X_y$ (\cref{scheme surjective stable under base change}). Thus, if $X'_{y'}$ is nonempty (resp. a singleton, resp. a finite set), the same holds for $X_y$. Since $S'\to S$ is surjective, this proves (a), (b), and (d). On the other hand, if $f'$ is dominant, so is the composition $g\circ f'=f\circ g'$; but since $g':X'\to X$ is surjective by \cref{scheme surjective stable under base change}, this implies $f$ is dominant.
\end{proof}
\subsection{Universally open and universally closed morphisms}
Following the usual terminology, we say a morphism $f:X\to Y$ is \textbf{universally open} (resp. \textbf{universally closed}, resp. a \textbf{universal embedding,} resp. a \textbf{universal homeomorphism}) if for any base change $Y'\to Y$, the morphism $f_{(Y')}:X_{(Y')}\to Y'$ is open (resp. closed, resp. an embedding, resp. a homeomorphism).
\begin{proposition}\label{scheme universally open closed stable prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] The composition of two universally open morphisms (resp. universally closed morphisms, resp. two universal embeddings, resp. two universal homeomorphisms) is universally open (resp. universally closed, resp. a universal embedding, resp. a universal homeomorphism). 
\item[(\rmnum{2})] If $f:X\to X'$, $g:Y\to Y'$ are two universally open (resp. universally closed, resp. two universal embeddings, resp. two universal homeomorphisms) $S$-morphisms, so is the product $f\times_Sg$.
\item[(\rmnum{3})] If $f:X\to Y$ is a universally open (resp. universally closed, resp. a universal embedding, resp. a universal homeomorphism) $S$-morphism, so is $f_{(S')}:X_{(S')}\to Y_{(S')}$ for any base change $S'\to S$.
\item[(\rmnum{4})] Let $f:X\to Y$, $g:Y\to Z$ be two morphism such that $f$ is surjective; if $g\circ f$ is universally open (resp. universally closed, resp. a universal embedding, resp. a universal homeomorphism), so is $g$.
\item[(\rmnum{5})] Let $(U_\alpha)$ be an open cover of $Y$. For a morphism $f:X\to Y$ to be universally open (resp. universally closed, resp. a universal embedding, resp. a universal homeomorphism), it is necessary and sufficient that, for each $\alpha$, the restriction $f_\alpha:f^{-1}(U_\alpha)\to U_\alpha$ is universally open (resp. closed).
\end{enumerate}
\end{proposition}
\begin{proof}
The assertion (\rmnum{1}) follows from definiton, and so does (\rmnum{3}). We have already remareked that (\rmnum{1}) and (\rmnum{3}) together imply (\rmnum{2}), since identity morphisms satisfies all the properties mentioned above. To prove (\rmnum{4}), we note that for any morphism $Z'\to Z$, the morphism $f_{(Z')}\to X_{(Z')}$ is surjective, so it suffices to prove that if $g\circ f$ is open (resp. closed, resp. an embedding, resp. a homeomorphism) and $f$ is surjective, then so is $g$. For the case where $g\circ f$ is open or closed, the fact that $g$ is open or closed result easily; for the other two cases, we can limit ourselves to the case $g(f(X))=g(Y)=Z$, so that $g\circ f$ is a homeomorphism from $X$ to $Z$. As $f$ is surjective, $g$ is necessarily bijective, and as it is open by the first two cases already shown, $g$ is then a homeomorphism from $Y$ to $Z$.\par
Finally, the necessity in (\rmnum{5}) follows from (\rmnum{3}) and \cref{scheme product inverse image of base open}. Conversely, suppose the condition in (\rmnum{5}) and let $g:Y'\to Y$ be a morphism; then $g^{-1}(U_\alpha)=U_\alpha'$ form an open cover of $Y'$ and if $f'=f_{(Y')}$, the restriction $f'^{-1}(U'_\alpha)\to U_\alpha'$ of $f'$ is none other than $(f_\alpha)_{(U'_\alpha)}$ (\cref{scheme product inverse image of base open}). We can then reduce to proving that $f$ is open (resp. closed, resp. an embedding, resp. a homeomorphism) if each $f_\alpha$ is, which is immediate. 
\end{proof}

We recall that openness of a map is a local property, i.e., a map $f:X\to Y$ is open if and only if it is open at every point of $X$. Simialrly, the property of universally open morphisms is also local. To justify this, we define a morphism $f:X\to Y$ is \textbf{universally open at a point $x\in X$} if for any base change $Y'\to Y$ the morphism $f_{(Y')}:X_{(Y')}\to Y_{(Y')}$ is open at any point $x'$ of $X'$ lying over $x$.

\begin{proposition}\label{scheme universally open at point stable prop}
Let $f:X\to Y$, $g:Y\to Z$ be two morphisms of schemes, $x$ a point of $X$, and $y=f(x)$.
\begin{enumerate}
\item[(a)] If $f$ is universally open at $x$ and $g$ is universally open at $y$, then $g\circ f$ is universally open at $x$. Conversely, if $g\circ f$ is universally open at $x$, then $g$ is universally open at $y$.
\item[(b)] If $f:X\to Y$ is an $S$-morphism universally open at a point $x\in X$, then for any base change $S'\to S$, the morphism $f_{(S')}:X_{(S')}\to Y_{(S')}$ is universally open at any point of $X_{(S')}$ lying over $x$.
\end{enumerate}
\end{proposition}
\begin{proof}
Assertion (b) is an immediate concequence of the definition of universally openness at a point and transitivity of base change. Also, it follows from \cref{scheme inverse image under base change prop} that to prove (a), we may drop the "universally" condition and prove the assertion for openness, which then follows from (\cite{EGA1} new, $0_{\text{\Rmnum{1}}}$, 2.8.2).
\end{proof}

\begin{proposition}\label{scheme morphism open at point and locally finite closed cover}
Let $X$, $Y$ be two schemes, $f:X\to Y$ be a morphism, and $x$ be a point of $X$. Let $(Y_i)$ be a locally finite covering of $Y$ by closed subschemes, and suppose that for each $i$ such that $f(x)\in Y_i$, the restriction $f_i:f^{-1}(Y_i)\to Y_i$ of $f$ is an open morphism (resp. universally open) at the point $x$. Then $f$ is open (resp. universally open) at the point $x$.
\end{proposition}
\begin{proof}
The assertion about openness is immediate. For the universal part, consider a morphism $g:Y'\to Y$ and in $Y'$ the closed subschemes $Y'_i=g^{-1}(Y_i)$ (\cref{scheme inverse image of subscheme}), which underlying spaces form a locally finite covering of $Y'$. If $f'=f_{(Y')}:X_{(Y')}\to Y'$ is the base change of $f$, the restriction $f'_i:f'^{-1}(Y_i)\to Y'_i$ of $f'$ equals to $(f_i)_{(Y')}$, so we can apply (\cite{EGA1} new, $0_{\text{\Rmnum{1}}}$, 2.10.2 (\rmnum{2})) to $f'$.
\end{proof}

\begin{proposition}\label{scheme morphism closed and finite closed cover}
Let $f:X\to Y$ be a morphism of schemes, $(X_i)_{1\leq i\leq n}$ (resp. $(Y_i)_{1\leq i\leq n}$) be a finite family of closed subschemes of $X$ (resp. $Y$), and $j_i:X_i\to X$ (resp. $h_i:Y_i\to Y$) be the canonical injections. Suppose that $(X_i)_{1\leq i\leq n}$ covers $X$ and for each $i$ there exists a morphism $f_i:X_i\to Y_i$ fitting into the following diagram
\[\begin{tikzcd}
X_i\ar[d,swap,"j_i"]\ar[r,"f_i"]&Y_i\ar[d,"h_i"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
Then for $f$ to be closed (resp. universally closed), it is necessary and sufficient that each $f_i$ is.
\end{proposition}
\begin{proof}
If $f$ is closed, then each $f_i$ is closed since $Y_i$ are closed in $Y$. Conversely, if the $f_i$ are closed, for any closed subset $F$ of $X$, we have $f_i(F\cap X_i)=f(F\cap X_i)$ and it closed in $Y_i$, hence in $Y$, and as $f(F)$ is the union of $f(F\cap X_i)$, it is therefore closed in $Y$.\par
For the case of universally closed morphisms, the condition is necessary because $j_i$ is a closed immersion (hence universally closed, cf. \cref{scheme immersion stable under base change}), and if $f$ is universally closed, so is $f\circ j_i=h_i\circ f_i$. But $h_i$ is a closed immersion, hence separated (\cref{scheme morphism separated permanence prop}), it then follows that $f_i$ is universally closed (\cref{scheme morphism cancelled by separated eg}).\par
Conversely, suppose that each $f_i$ is universally closed, and consider the scheme $Z$ that is the coproduct of that $X_i$. Let $u:Z\to X$ be the induced morphism by the $j_i$'s. The restriction of $f\circ u$ to $X_i$ is equal to $f\circ j_i=h_i\circ f$, hence universally closed (\cref{scheme immersion stable under base change} and \cref{scheme universally open closed stable prop}(\rmnum{1})); we then deduce from \cref{scheme product of coproduct} that $f\circ u$ is universally closed. But since $u$ is surjective by hypotheses, we conclude that $f$ is universally closed (\cref{scheme universally open closed stable prop}(\rmnum{4})).
\end{proof}

\begin{remark}
If $X$ only have finitely many irreducible components, then we deduce from \cref{scheme morphism closed and finite closed cover} that, to verify a morphism $f:X\to Y$ is closed (resp. universally closed), we can reduce ourselves to doing it for dominant morphisms of integral schemes. In fact, let $(X_i)_{1\leq i\leq n}$ be the reduced subschemes of $X$ with underlying spaces the irreducible components of $X$ (\cref{scheme closed subset reduced subscheme}), which are then integral. Let $Y_i$ be the unique reduced closed subscheme of $Y$ with underlying space $\widebar{f(X_i)}$ (\cref{scheme closed subset reduced subscheme}), which iss irreducible (\cref{topo space irreducible under continuous map}). If $j_i:X_i\to X$ (resp. $h_i:Y_i\to Y$) is the canonical injection, there then exists a dominant morphism $f_i:X_i\to Y_i$ such that $f\circ g_i=h_i\circ f_i$ (\cref{scheme morphism from reduced factorization}); we are then in the case of \cref{scheme morphism closed and finite closed cover}, so $f$ is closed (resp. universally closed) if and only if each $f_i$ is.
\end{remark}
\begin{proposition}\label{scheme morphism universally closed if stable under polynomial base change}
Let $X$, $Y$ be two $S$-schemes and $f:X\to Y$ be an $S$-morphism. For $f$ to be universally closed, it suffices that, for any base change $S'\to S$ where $S'=S\otimes_{\Z}\Z[(T_\lambda)_{\lambda\in I}]$ (denoted by $S[(T_\lambda)_{\lambda\in I}]$), the morphism $f_{(S')}:X_{(S')}\to Y_{(S')}$ is closed.
\end{proposition}
\begin{proof}
We note that if $(S_\alpha)$ is an open cover of $S$ and $Y_\alpha$ is the inverse image of $S_\alpha$ in $Y$, it suffices to prove that the restricted morphism $f_\alpha:f^{-1}(Y_\alpha)\to Y_\alpha$ is closed (\cref{scheme universally open closed stable prop}(\rmnum{5})). Now the inverse image of $S_\alpha$ in $S'$ is $S_\alpha[(T_\lambda)_{\lambda\in I}]=S'_\alpha$ and $(f_\alpha)_{(S')}$ is the restriction $(f_{(S')})^{-1}(Y'_\alpha)\to Y'_\alpha$ of $f_{(S')}$, where $Y'_\alpha$ is the inverse image of $S'_\alpha$ in $Y_{(S')}$. If the proposition is proved for $S_\alpha$ and $f_\alpha$, it is then true for $S$ and $f$. We can then assume that $S$ is affine.\par
Now let $(U_\beta)$ be an open covering of $Y$; for $f$ to be universally closed, it suffices to prove that $f_\beta:f^{-1}(U_\beta)\to U_\beta$ is universally closed for each $\beta$ (\cref{scheme universally open closed stable prop}(\rmnum{5})). Again, the morphism $(f_\beta)_{(S')}$ is the restriction $(f_{(S')})^{-1}(U'_\beta)\to U'_\beta$ of $f_{(S')}$, where $U'_\beta=U_\beta\times_SS'$ is the inverse image of $U_\beta$ in $Y_{(S')}$. If the proposition is proved for $U_\beta$ and $f_\beta$, it then holds for $Y$ and $f$. Therefore, we can further assume that $Y$ is affine.\par
Let us first show that if $f_{(S')}$ is closed for any base change $S'\to S$, then $f$ is universally closed. In fact, any $Y$-scheme $Y'$ can be considered as an $S$-scheme, and as the morphism $Y\to S$ is separated (recall that $Y$ and $S$ are assumed to be affine), $X\times_YY'$ (resp. $Y\times_YY'=Y'$) is identified with a closed subscheme of $X\times_SY'$ (resp. $Y\times_SY'$) (\cref{scheme immersion stable under product}). In the following commutative diagram
\[\begin{tikzcd}
X\times_YY'\ar[d]\ar[r,"f\times 1_{Y'}"]&Y\times_YY'=Y'\ar[d]\\
X\times_SY'\ar[r,"f_{(Y')}"]&Y\times_SY
\end{tikzcd}\]
the vertical morphisms are closed immersions, so if $f_{(Y')}$ is a closed morphism, so is $f\times 1_{Y'}$.\par
It remains to prove that $f_{(S')}$ is closed for arbitrary base change $S'\to S$ if this is true for $S'=S[(T_\lambda)]$. Now by hypotheses $S$ is affine, and if $(S'_\gamma)$ is an open covering of $S'$, we see in the same manner as before that for $f_{(S')}$ to be closed, it suffices to prove that $f_{(S'_\gamma)}$ is closed. We can then assume $S'$ to be affine. If $S=\Spec(A)$, we have $S'=\Spec(A')$, where $A'$ is an $A$-algebra. Let $(t_\lambda)_{\lambda\in I}$ be a generator for $A'$, which means there is a surjective $A$-homomorphism $A[(T_\lambda)]\to A'$ identifying $A'$ with $A[(T_\lambda)]/\b$, where $\b$ is an ideal. If $S''=\Spec(A[(T_\lambda)])$, $S'$ is then a closed subscheme of $S''$, and $X_{(S')}$ (resp. $Y_{(S')}$) is identified with a closed subscheme of $X_{(S'')}$ (resp. $Y_{(S'')}$). The morphism $f_{(S')}$ is the restriction of $f_{(S'')}$ on $X_{(S')}$, and since $f_{(S'')}$ is closed by hypotheses, we conclude that $f_{(S')}$ is closed. This completes the proof.
\end{proof}
\section{Subschemes and immersions}
\subsection{Subschemes}
\begin{proposition}\label{scheme sheaf of ideal induce subscheme}
Let $X$ be a scheme and $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_X$. The support $Y$ of the sheaf $\mathscr{O}_X/\mathscr{I}$ is then closed, and if $\mathscr{O}_Y$ is the sheaf induced on $Y$ by $\mathscr{O}_Y/\mathscr{I}$, $(Y,\mathscr{O}_Y)$ is a scheme.
\end{proposition}
\begin{proof}
Since the problem is local, it suffices to consider the affine case and show that $Y$ is closed and $(X,\mathscr{O}_Y)$ is an affine scheme. In fact, if $X=\Spec(A)$, we have $\mathscr{O}_X=\widetilde{A}$ and $\mathscr{I}=\widetilde{\a}$, where $\a$ is an ideal of $A$ (\cref{scheme affine qcoh sheaf on qc open char}); $Y$ is then equal to the closed subset $V(\a)$ of $X$ and is identified with the spectrum of $B=A/\a$ (\cref{Spec of ring clopen subsets char}). Moreover, if $\rho:A\to B=A/\a$ is the canonical homomorphism, the direct image $^{a}\!\rho_*(\widetilde{B})$ is canonically identified with the sheaf $\widetilde{A}/\widetilde{\a}=\mathscr{O}_X/\mathscr{I}$ (\cref{scheme affine associated sheaf ker and coker} and \cref{scheme affine associated sheaf direct image char}). These complete the proof.
\end{proof}
We say $(Y,\mathscr{O}_Y)$ is the \textbf{subscheme of $(X,\mathscr{O}_X)$ defined by the quasi-coherent ideal $\mathscr{I}$}. More generally, we say a locally ringed space $(Y,\mathscr{O}_Y)$ is a \textbf{subscheme} of a scheme $(X,\mathscr{O}_X)$ if $Y$ is a locally closed subspace of $X$ and if $U$ denote the largest open subset of $X$ containing $Y$ such that $Y$ is open in $U$ (in other words, the complement of $\widebar{Y}-Y$, so $U=(X-\widebar{Y})\cup Y$), then $(Y,\mathscr{O}_Y)$ is a subscheme of $(U,\mathscr{O}_X|_U)$ defined by a quasi-coherent ideal of $\mathscr{O}_X|_U$. We say the subscheme $(Y,\mathscr{O}_Y)$ of $(X,\mathscr{O}_X)$ is \textbf{closed} if $Y$ is closed in $X$ (in this case $U=X$). It follows from this definition and \cref{scheme sheaf of ideal induce subscheme} that closed subschemes of $X$ are in one-to-one correspondence with quasi-coherent ideals of $\mathscr{O}_X$, since if two such ideals $\mathscr{I}$, $\mathscr{J}$ have the same support (closed) $Y$ and the sheaf induced by $\mathscr{O}_X/\mathscr{I}$ and $\mathscr{O}_X/\mathscr{J}$ on $Y$ are identical, then $\mathscr{I}=\mathscr{J}$.\par
Let $(Y,\mathscr{O}_Y)$ be a subscheme of $X$, $U$ the largest open subset of $X$ containing $Y$ such that $Y$ is closed in $U$, $V$ an open subset of $X$ contained in $U$; then $V\cap Y$ is closed in $V$. Moreover, if $Y$ is defined by the quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X|_U$, then $\mathscr{I}|_V$ is a quasi-coherent ideal of $\mathscr{O}_X|_V$, and it is immediate that the scheme induced by $Y$ over $Y\cap V$ is the closed subscheme of $V$ defined by the ideal $\mathscr{I}|_V$.\par
In particular, the scheme induced by $X$ over an open subset of $X$ is a subscheme of $X$; such schemes are called \textbf{open subschemes} of $X$. One should note that a subscheme of $X$ can have the underlying space being an open set $U$ of $X$ without being induced on this open subset by $X$: it is induced over $U$ by $X$ only if it is defined by the ideal $0$ of $\mathscr{O}_X|_U$, and there are in general quasi-coherent ideals $\mathscr{I}$ of $\mathscr{O}_X|_U$ such that $(\mathscr{O}_X|_U)/\mathscr{I}$ have support $U$ but is nonzero.
\begin{proposition}\label{scheme subscheme and open cover}
Let $(Y,\mathscr{O}_Y)$ be a locally ringed space such that $Y$ is a subspace of $X$ and there exists a covering $(V_\alpha)$ of $Y$ by open sets of $X$ such that for each $\alpha$, $Y\cap V_\alpha$ is closed in $V_\alpha$ and the locally ringed space $(Y_\cap V_\alpha,\mathscr{O}_Y|_{Y\cap V_\alpha})$ is a closed subscheme of the scheme induced over $V_\alpha$ by $X$. Then $(Y,\mathscr{O}_Y)$ is a subscheme of $X$. 
\end{proposition}
\begin{proof}
The hypothesis implies that $Y$ is locally closed in $X$ and the largest open set $U$ containing $Y$ and in which $Y$ is closed contains the $V_\alpha$. We are then reduced to the case $U=X$ and $Y$ is closed in $X$. We define a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$ by letting $\mathscr{I}_{V_\alpha}$ to be the sheaf of ideal of $\mathscr{O}_X|_{V_\alpha}$ that defines the closed subscheme $(Y\cap V_\alpha,\mathscr{O}_Y|_{Y\cap V_\alpha})$ and for any open set $W$ of $X$ not meeting $Y$, $\mathscr{I}_W=\mathscr{O}_X|_W$. It is immediately verified that there exists a unique sheaf of ideals $\mathscr{I}$ satisfying these conditions and that it defines the closed subscheme $(Y,\mathscr{O}_Y)$.
\end{proof}
\begin{proposition}\label{scheme subscheme of subscheme is subscheme}
A (closed) subscheme of a (closed) subscheme of $X$ is canonically identified with a (closed) subscheme of $X$. 
\end{proposition}
\begin{proof}
Since a locally closed subset of a locally closed subset of $X$ is still locally closed in $X$, it is clear by \cref{scheme subscheme and open cover} that the question is local and we may assume that $X$ is affine. The proposition then follows from the identification $A/\b$ and $(A/\a)/(\b/\a)$ where $\a,\b$ are ideals of the ring $A$ such that $\a\sub\b$.
\end{proof}
Let $Y$ be a subscheme of $X$ and denote by $\iota:Y\to X$ the canonical injection of the underlying space; we know the inverse image $\iota^*(\mathscr{O}_X)$ is the restriction $\mathscr{O}_X|_Y$. If for any $y\in Y$, we denote by $\iota_y$ the canonical homomorphism $\mathscr{O}_{X,y}\to\mathscr{O}_{Y,y}$, these homomorphisms are then the restrictions to the stalks of $\mathscr{O}_X$ at the points of $Y$ of a surjective homomorphism of sheaves of rings $\iota^{\#}:\mathscr{O}_X|_Y\to\mathscr{O}_Y$: it suffices indeed to check it locally on $Y$, so we can assume that $X$ is affine and $Y$ is a closed subscheme; in this case, if $\mathscr{I}$ is the quasi-coherent ideal of $\mathscr{O}_X$ which defines $Y$, the $\iota_y$'s are nothing but the restrictions to the stalks of the canonical homomorphism $\mathscr{O}_X|_Y\to (\mathscr{O}_X/\mathscr{I})|_{Y}$. We have therefore defined a monomorphism $j_Y=(\iota,\iota^{\#})$ of locally ringed spaces, which is called the \textbf{canonical injection morphism}. If $f:X\to Z$ is another morphism of schemes, we say the composition
\[\begin{tikzcd}
Y\ar[r,"j_Y"]&X\ar[r,"f"]&Z
\end{tikzcd}\]
is the \textbf{restriction} of $f$ to the subscheme $Y$ of $X$.\par
A subscheme $Y$ of a scheme $X$ is considered as an $X$-scheme via the canonical injection $j_Y:Y\to X$. Two subschemes $Y$, $Z$ of $X$ that are $X$-isomorphic are then necessary identical. In fact, if $u:Y\to Z$ is an $X$-isomorphism, the relation $j_Y=j_Z\circ u$ shows the underlying spaces of $Y$ and $Z$ are identical. Moreover if $U\sups Y$ is an open subset of $X$ such that $Y=Z$ are closed in $U$, and $\mathscr{I}$, $\mathscr{J}$ are the ideals of $U$ defining respectively $Y$ and $Z$, for each $x\in Y$ we then have a commutative diagram
\[\begin{tikzcd}
\mathscr{O}_{X,x}/\mathscr{J}_x\ar[rr,"u^{\#}_{x}"]&&\mathscr{O}_{X,x}/\mathscr{I}_{x}\\
&\mathscr{O}_{X,x}\ar[lu]\ar[ru]
\end{tikzcd}\]
Since $u$ is an isomorphism, this implies $\mathscr{I}_x=\mathscr{J}_x$, so $Y=Z$ and $u=1_Y$.\par
According to the general definitions, we say a morphism $f:Z\to X$ is \textbf{dominated by the canonical injection} $j_Y:Y\to X$ of a subscheme $Y$ of $X$, if $f$ factors through $j_Y$:
\[\begin{tikzcd}
Z\ar[r,"g"]&Y\ar[r,"j_Y"]&X
\end{tikzcd}\]
where $g$ is a morphism of schemes. Since $j_Y$ is a monomorphism, the morphism $g$ is unique.
\begin{proposition}\label{scheme morphism factor through subscheme iff}
Let $Y$ be a subscheme of a scheme $X$ and $j:Y\to X$ be the cannical injection. For a morphism $f:Z\to X$ to be dominated by the injection $j$, it is necessary and sufficient that $f(Z)\sub Y$ and for each $z\in Z$, the homomorphism $f^{\#}_z:\mathscr{O}_{X,f(z)}\to\mathscr{O}_{Z,z}$ factors through $\mathscr{O}_{Y,f(z)}$ (or equivalently, the kernel of $\mathscr{O}_{X,f(z)}\to\mathscr{O}_{Z,z}$ is contained in that of $\mathscr{O}_{X,f(z)}\to\mathscr{O}_{Y,f(z)}$). 
\end{proposition}
\begin{proof}
The condition is cleraly necessary. For the sufficiency, we may assume that $Y$ is a closed subscheme of $X$, and replace $X$ by an open subset $U$ such that $Y$ is closed in $U$. $Y$ is then defined by a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$. Let $\mathscr{J}$ be the kernel of the homomorphism $f^*(\mathscr{O}_X)\to\mathscr{O}_Z$. In view of the properties of the functor $f^*$, the hypothesis implies tht for each $z\in Z$ we have $(f^*(\mathscr{I}))_z\sub\mathscr{J}_z$, and concequently $f^*(\mathscr{I})\sub\mathscr{J}$. Therefore the homomorphism $f^*(\mathscr{O}_X)\to\mathscr{O}_Z$ factors into
\[\begin{tikzcd}
f^*(\mathscr{O}_X)\ar[r]&f^*(\mathscr{O}_X)/f^*(\mathscr{I})=f^*(\mathscr{O}_X/\mathscr{I})\ar[r,"\theta_z"]&\mathscr{O}_Z
\end{tikzcd}\]
the first arrow being the canonical homomorphism. Let $g$ be the continuous map of $Z$ in $Y$ coincide with $f$; it is clear that $g^*(\mathscr{O}_Y)=f^*(\mathscr{O}_X/\mathscr{I})$; on the other hand, for any $z\in Z$, $\theta_z$ is obviously a local homomorphism, so $(g,\theta):Z\to Y$ is a morphism of schemes which satisfies $f=j\circ g$, whence the proposition.
\end{proof}
\begin{corollary}
Let $Y$ and $Z$ be subschemes of $X$. For the canonical injection $Z\to X$ to be dominated by the injection $Y\to X$, it is necessary and sufficient that $Z$ is a subscheme of $Y$.
\end{corollary}
Due to this corollary, for two subschemes $Y$, $Z$ of $X$ we write $Y\preceq Z$ if $Y$ is a subscheme of $Z$. It is clear that this defines an order relation on the set of subschemes of $X$, since two subschemes $Y$ and $Z$ are identical if $Y\preceq Z$ and $Z\preceq Y$.
\subsection{Immersions of schemes}
We say a morphism $f:Y\to X$ is an \textbf{immersion} (resp. a \textbf{closed immersion}, resp. an \textbf{open immersion}) if it is factorized into
\[\begin{tikzcd}
Y\ar[r,"g"]&Z\ar[r,"j"]&X
\end{tikzcd}\]
where $g$ is an isomorphism, $Z$ is a subscheme (resp. a closed subscheme, resp. an open subscheme) of $X$, and $j$ is the canonical injection. The subscheme $Z$ and the isomorphism $g$ are then uniquely determined since two $X$-isomorphic subschemes are identical. We say $f=i\circ g$ is the \textbf{canonical factorization} of the immersion $f$, and the subscheme $Z$ and the isomorphism $g$ is called \textbf{associated} with $f$. It is clera that an immersion is a monomorphism of schemes (since $j$ is a monomorphism), and a fortiori a radical morphism (\cref{scheme monomorphism is radical}). Also, it is clear from \cref{scheme subscheme of subscheme is subscheme} that the composition of two immersions (resp. two open immersions, resp. two closed immersions) is an immersion (resp. an open immersion, resp. a closed immersion).\par
Again, one should note that an immersion $f:Y\to X$ such that $f(Y)$ is a open subset of $X$, in other words which is an open morphism, is not necessarily an open immersion.
\begin{example}\label{scheme affine closed subscheme is affine}
Let $X$ be an affine scheme. Then from the definition of closed subschemes, we see that for a morphism $f:Y\to X$ to be a closed immersion, it is necessary and sufficient that $Y$ is an affine scheme and $\Gamma(f):\Gamma(X,\mathscr{O}_X)\to\Gamma(Y,\mathscr{O}_Y)$ is surjective.
\end{example}
\begin{lemma}\label{Scheme closed embedding is affine}
Let $f:Y\to X$ be a morphism of schemes such that $f(Y)$ is closed and $f$ is a homeomorphism onto $f(Y)$. Then for each point $x\in X$, there exists an affine open neighborhood $U$ of $x$ such that $f^{-1}(U)$ is an affine open of $Y$.
\end{lemma}
\begin{proof}
Since $f(Y)$ is closed in $X$, the lemma is trivial if $x\notin f(Y)$, since it suffices to choose an affine open neighborhood of $x$ disjoint from $f(Y)$. If $x\in f(Y)$, there exists a unique point $y\in Y$ such that $f(y)=x$. Let $W$ be an affine open neighborhood of $x$ in $X$ and $V$ an affine open neighborhood of $y$ in $Y$ such that $f(V)\sub W$. By hypothesis $f(V)$ is an open neighborhood of $x$ in $f(Y)$, so there exists an open neighborhood $U'\sub W$ of $x$ such that $U'\cap f(Y)=f(V)$. Let $U$ be an open neighborhood of $x$ contained in $U'$ and is of the form $D(s)$, where $s\in A=\Gamma(W,\mathscr{O}_X)$ (recall that $W$ is chosen to be affine); in view of \cref{Spec of ring induced map prop}(b), $f^{-1}(U)\sub V$ is of the form $D(t)$, where $t$ is the image of $s$ in $B=\Gamma(V,\mathscr{O}_Y|_V)$, hence proves the lemma.
\end{proof}
\begin{lemma}\label{scheme morphism affine direct image of qcoh is qcoh}
Let $f:Y\to X$ be a morphism of schemes and $(U_\lambda)$ be an affine open covering of $X$ such that for each $\lambda$, $f^{-1}(U_\lambda)$ is an affine open of $Y$. Then for any quasi-coherent $\mathscr{O}_Y$-module $\mathscr{F}$, the direct image $f_*(\mathscr{F})$ is a quasi-coherent $\mathscr{O}_X$-module.
\end{lemma}
\begin{proof}
For each $\lambda$, put $V_\lambda=f^{-1}(U_\lambda)$, and let $f_\lambda:V_\lambda\to U_\lambda$ be the restriction of $f$ to $V_\lambda$. Then the restriction $f_*(\mathscr{F})$ to $U_\lambda$ is equal to $(f_\lambda)_*(\mathscr{F}_\lambda)$, where $\mathscr{F}_\lambda=\mathscr{F}|_{U_\lambda}$. But since $U_\lambda$ and $V_\lambda$ are affine by hypothesis, we see $(f_\lambda)_*(\mathscr{F}_\lambda)$ is quasi-coherent by \cref{scheme affine associated sheaf direct image char}. This proves the lemma.
\end{proof}
\begin{proposition}\label{scheme morphism immersion iff stalk} 
Let $f:Y\to X$ be a morphism of schemes.
\begin{enumerate}
\item[(a)] For $f$ to be an open immersion, it is necessary and sufficient that $f$ is a homeomorphism onto an open subset of $X$ and for each $y\in Y$, the homomorphism $f^{\#}_y:\mathscr{O}_{X,f(y)}\to\mathscr{O}_{Y,y}$ is bijective.
\item[(b)] For $f$ to be an immersion (resp. a closed immersion), it is necessary and sufficient that $f$ is a homeomorphism onto a locally closed (resp. closed) subset of $X$ and for each $y\in Y$, the homomorphism $f^{\#}_y:\mathscr{O}_{X,f(y)}\to\mathscr{O}_{Y,y}$ is surjective.
\end{enumerate}
\end{proposition}
\begin{proof}
In the two cases, the conditions are clearly necessary, so we only need to prove the sufficiency. If the conditions in (a) holds, it is clear that $f^{\#}$ induces an isomorphism of $\mathscr{O}_Y$ to $f^*(\mathscr{O}_X)$, and $f^*(\mathscr{O}_X)$ is the sheaf defined by the transport by structure by means of $f^*$ from the induced sheaf $\mathscr{O}_X|_{f(Y)}$, hence the conclusion.\par
Suppose then the conditions in (b) holds. Let $U_0$ be the largest open set of $X$ such that $Z=f(Y)$ is closed in $U_0$; by replacing $X$ by the subscheme induced by $X$ over $U_0$, we may assume that $Z=f(Y)$ is closed in $X$. By \cref{Scheme closed embedding is affine} and \cref{scheme morphism affine direct image of qcoh is qcoh}, the sheaf $f_*(\mathscr{O}_Y)$ is a quasi-coherent $\mathscr{O}_X$-module. We have an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{I}\ar[r]&\mathscr{O}_X\ar[r,"f^{\#}"]&f_*(\mathscr{O}_Y)\ar[r]&0
\end{tikzcd}\]
where two terms are quasi-coherent $\mathscr{O}_X$-modules; we then deduce that (\cref{scheme qcoh and exact sequence prop}) $\mathscr{I}$ is a quasi-coherent ideal of $\mathscr{O}_X$, and $f^{\#}$ factors into
\[\begin{tikzcd}
\mathscr{O}_X\ar[r]&\mathscr{O}_X/\mathscr{I}\ar[r,"\theta"]&f_*(\mathscr{O}_Y)
\end{tikzcd}\]
where the first arrow is the canonical homomorphism and $\theta$ is an isomorphism. If $\mathscr{O}_Z=(\mathscr{O}_X/\mathscr{I})|_Z$, $(Z,\mathscr{O}_Z)$ is then a closed subscheme of $(X,\mathscr{O}_X)$ and $f$ factors through the canonical injection $j_Z:Z\to X$. Since the corresponding morphism $Y\to Z$ is just $(f_0,\theta_0)$, where $f_0$ is the map $f$ considered as a homeomorphism from $Y$ to $Z$ and $\theta_0$ is the restriction of $\theta$ to $\mathscr{O}_Z$, it is clear that $f$ is a closed immersion, which completes the proof.
\end{proof}
\begin{remark}
It may happen that $f:Y\to X$ is a closed immersion and for all $y\in Y$, $f^{\#}_y:\mathscr{O}_{X,f(y)}\to\mathscr{O}_{Y,y}$ is bijective, without $f$ being an open immersion (that is, $f(Y)$ is not necessarily open in $X$). For example, let $X=\Spec(A)$ be an affine scheme and $x\in X$ be a closed point of $X$ that is not isolated. Then if $Y=\Spec(A/\m_x)$, the canonical morphism $Y\to X$ is a closed immersion satisfying the desired property, since the subspace $\{x\}$ is not open in $X$.
\end{remark}
\begin{corollary}\label{scheme immersion open covering prop}
Let $f:Y\to X$ be a morphism of schemes.
\begin{enumerate}
\item[(a)] Let $(V_\lambda)$ be a covering of $f(Y)$ by open subsets of $X$. Then for $f$ to be an immersion (an open immersion), it is necessary and sufficient that for each $\lambda$, the restriction $f^{-1}(V_\lambda)\to V_\lambda$ of $f$ is an immersion (an open immersion).
\item[(b)] Let $(U_\lambda)$ be an open covering of $X$. Then for $f$ to be a closed immersion, it is necessary and sufficient that for each $\lambda$, the restriction $f^{-1}(U_\lambda)\to U_\lambda$ of $f$ is a closed immersion.
\end{enumerate}
\end{corollary}
\begin{proof}
In the case (a), $f^{\#}_y$ is surjective (resp. bijective) for every point $y\in Y$, and in case (b) it is surjective for every point $y\in Y$; it then suffices to verify that in case (a) $f$ is a homeomorphism of $Y$ onto a locally closed (resp. open) subset of $X$ and in case (b), a homeomorphism onto a closed subset of $X$. Now, the hypothesis imply that $f$ is clearly injective and maps each neighborhood of $y\in Y$ to a neighborhood of $f(y)$ in $f(Y)$. In case (a), $f(Y)\cap V_\lambda$ is locally closed (resp. open) in the union of the $V_\lambda$, and a fortiori in $X$; in case (b), $f(Y)\cap U_\lambda$ is closed in $U_\lambda$, hence closed in $X$ since $X=\bigcup_\lambda U_\lambda$.
\end{proof}
\begin{remark}
We can generalize the notions of immersions to any ringed spaces. We define a \textbf{ringed subspace} of a ringed space $(X,\mathscr{O}_X)$ to be a ringed space of the form $(Y,(\mathscr{O}_U/\mathscr{I})|_Y)$, where $U$ is an open of $X$, $\mathscr{I}$ an ideal of $\mathscr{O}_U$ and $Y$ the support of the sheaf of rings $\mathscr{O}_U/\mathscr{I}$ (support which is no longer necessarily closed in $U$). We can define the canonical injection $Y\to X$, and the definitions and results of \cref{scheme morphism factor through subscheme iff} are valid without modification. We then define the notion of immersion (resp. of closed immersion) in the same manner. The characterizations of open (resp. closed) immersions given in \cref{scheme morphism immersion iff stalk}  still hold (observing that if $f(Y)$ is closed in $X$, $f_*(\mathscr{O}_Y)$ has support $f(Y)$). The result of \cref{scheme morphism immersion iff stalk}  can therefore be stated by saying that if a scheme $Y$ is a ringed subspace of a scheme $X$, then $Y$ is a subscheme of $X$.
\end{remark}
\subsection{Inverse image of subschemes}
\begin{proposition}\label{scheme immersion stable under product}
Let $f:X'\to X$ and $g:Y'\to Y$ be two $S$-morphisms. Let $p,q$ be the projections of $X\times_SY$.
\begin{enumerate}
\item[(a)] If $f$ and $g$ are immersions (resp. open immersions, resp. closed immersions), then $f\times_Sg$ is an immersion (resp. an open immersion, resp. a closed immersion).
\item[(b)] If $X'$ (resp. $Y'$) is identified with a subscheme of $X$ (resp. $Y$) via the immersion $f$ (resp. $g$), then $f\times_Sg$ identifies the underlying space of $X'\times_SY'$ with the subspace $p^{-1}(X')\cap q^{-1}(Y')$ of the underlying space of $X\times_SY$.
\end{enumerate}
\end{proposition}
\begin{proof}
We can restrict ourselves to the case where $X'$ and $Y'$ are subschemas and $f$ and $g$ are the canonical injection morphisms. The proposition has already been established for the subschemes induced on the open sets (\cref{scheme product inverse image of base open}); as any subscheme is a closed subscheme of an open scheme, we are reduced in case $X'$ and $Y'$ are closed subschemes.\par
We can further assume that $S$ is affine. In fact, let $(S_\lambda)$ be an affine open cover of $S$, $\varphi$ and $\psi$ be the structural morphisms of $X$ and $Y$, and let $X_\lambda=\varphi^{-1}(S_\lambda)$, $Y_\lambda=\psi^{-1}(S_\lambda)$. The restriction $X'_\lambda$ (resp. $Y'_\lambda$) of $X'$ (resp $Y'$) to $X_\lambda\cap X'$ (resp. $Y_\lambda\cap Y'$) is a closed subscheme of $X_\lambda$ (resp. $Y_\lambda$), the schemes $X_\lambda$, $Y_\lambda$, $X'_\lambda$, $Y'_\lambda$ can then be considered as $S_\lambda$-schemes and the product $X_\lambda\times_SY_\lambda$ and $X_\lambda\times_{S\lambda}Y_\lambda$ (resp. $X'_\lambda\times_SY'_\lambda$ and $X'_\lambda\times_{S_\lambda}Y'_\lambda$) are identified (\cref{scheme product inverse image of base open}). If the proposition is true when $S$ is affine, the restriction of $f\times_Sg$ to the $X'_\lambda\times_SY'_\lambda$ will therefore be an immersion. As the product $X'_\lambda\times_SY'_\mu$ (resp. $X_\lambda\times_SY_\mu$) is identified with $(X'_\lambda\cap X'_\mu)\times_S(Y'_\lambda\cap Y'_\mu)$ (resp. $(X_\lambda\cap X_\mu)\times_S(Y_\lambda\cap Y_\mu)$), the restriction of $f\times_Sg$ to $X'_\lambda\times_SY'_\mu$ is also an immersion; it follows from \cref{scheme immersion open covering prop} that $f\times_Sg$ is an immersion.\par
Secondly, let's prove that we can also assume that $X$ and $Y$ are affine. In fact, let $(U_i)$ (resp. $(V_j)$) be an affine open cover of $X$ (resp. $Y$), and let $X'_i$ (resp. $Y'_j$) be the restriction of $X'$ (resp. $Y'$) to $X'\cap U_i$ (resp. $Y'\cap V_j$), which is a closed subscheme of $U_i$ (resp. $V_j$). Then $U_i\times_SV_j$ is identified with the restriction of $X\times_SY$ to $p^{-1}(U_i)\cap q^{-1}(V_j)$ by \cref{scheme product inverse image of base open}, and similarly, if $p':X'\times_SY'\to X'$ and $q':X'\times_SY'\to Y'$ are the canonical projections, the product $X'_i\times_SY'_j$ is identified with the restriction of $X'\times_SY'$ to $p'^{-1}(X'_i)\cap q'^{-1}(Y'_j)$. Put $h=f\times_Sg$, then since $X'_i=f^{-1}(U_i)$, $Y'_j=g^{-1}(V_j)$, we have
\[p'^{-1}(X'_i)\cap q'^{-1}(Y'_j)=h^{-1}(p^{-1}(U_i)\cap q^{-1}(V_j))=h^{-1}(U_i\times_SV_j).\]
Again, by the same reasoning and using \cref{scheme immersion open covering prop}, we can show that $h$ is an immersion.\par
Suppose then that $X$, $Y$, and $S$ are affine, with rings $B$, $C$, and $A$, respectively. Then $B$ and $C$ are $A$-algebras, $X'$ and $Y'$ are affine subschemes with rings quotients $B'$, $C'$ of $B$ and $C$, respectively. Moreover, $f$ and $g$ are induced by ring homomorphisms $\rho:B\to B'$ and $\sigma:C\to C'$. With these, we see $X\times_SY$ (resp. $X'\times_SY'$) is the affine scheme with ring $B\otimes_AC$ (resp. $B'\otimes_AC'$), and $f\times_Sg$ corresponds to the ring homomorphism $\rho\otimes\sigma:B\otimes_AC\to B'\otimes_AC'$. Since this homomorphism is surjective, $f\times_Sg$ is an immersion. Moreover, if $\b$ (resp. $\c$) is the kernel of $\rho$ (resp. $\sigma$), the kernel of $\rho\otimes\sigma$ is $u(\b)+v(\c)$, where $u$ (resp. $v$) is the homormorphism $b\mapsto b\otimes 1$ (resp. $c\mapsto 1\otimes c$). As $p$ corresponds to the ring homomorphism $u$ and $q$ corresponds to $v$, this kernel corresponds, in the spectrum $\Spec(B\otimes_AC)$, to the closed subset $p^{-1}(X')\cap q^{-1}(Y')$, which proves the demonstration.
\end{proof}
\begin{corollary}\label{scheme immersion stable under base change}
If $f:X\to Y$ is an immersion (resp. an open immersion, resp. a closed immersion) and an $S$-morphism, then $f_{(S')}$ is an immersion (resp. an open immersion, resp. a closed immersion) for any extension $S'\to S$ of base schemes.
\end{corollary}
\begin{proof}
This follows from the observation that the identity morphism is an immersion (resp. an open immersion, resp. a closed immersion).
\end{proof}
\begin{corollary}\label{scheme immersion universally prop}
An immersion (resp. a closed immersion, resp. an open immersion) is a universally embedding (resp. universally closed, resp. universally open).
\end{corollary}
\begin{proposition}\label{scheme inverse image of subscheme}
Let $f:X\to Y$ be a morphism, $Y'$ a subscheme (resp. a closed subscheme, resp. an open subscheme) of $Y$, and $j:Y'\to Y$ the canonical injection.
\begin{enumerate}
\item[(a)] The projection $j':X\times_YY'\to X$ is an immersion (resp. a closed immersion, resp. an open immersion), and the subscheme of $X$ associated with $j'$ has underlying space $f^{-1}(Y')$.
\[\begin{tikzcd}
X\times_YY'\ar[r]\ar[d,hook,swap,"p"]&Y'\ar[d,hook,"j"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
Moreover, for a morphism $h:Z\to X$ to be such that $f\circ h:Z\to Y$ is dominated by $j$, it is necessary and sufficient that $h$ is dominated by $j'$.
\item[(b)] If $Z$ is a closed subscheme defined by a quasi-coherent ideal $\mathscr{K}$ of $\mathscr{O}_Y$, the inverse image of $Z$ by $f$ is defined by the quasi-coherent ideal $f^*(\mathscr{K})\mathscr{O}_X$.
\end{enumerate}
\end{proposition}
\begin{proof}
As $p=1_X\times_Yj$, the first assertion in (a) follows from \cref{scheme immersion stable under product}. The second one is a special case of \cref{scheme radical morphism geometric point inverse image}. Finally, if we have $f\circ h=j\circ h'$, where $h':Z\to Y'$ is a morphism, it follows from the universal property of product that we have $h=p\circ u$, where $u:Z\to X\times_YY'$ is a morphism, whence assertion (a).\par
To prove (b), since the question is local on $X$ and $Y$, we may assume that $X$ and $Y$ are affine. It then suffices to note that if $A$ is an $B$-algebra and $\b$ is an ideal of $B$, we have $A\otimes_B(B/\b)=A/\b A$, and apply \cref{scheme affine associated sheaf inverse image char}.
\end{proof}
We say the subscheme of $X$ thus defined is the \textbf{inverse image} of the subscheme $Y'$ of $Y$ by the morphism $f$. We say the morphism $f\times 1_{Y'}:f^{-1}(Y')\to Y'$ is the restriction of $f$ to $f^{-1}(Y')$. When we speak of $f^{-1}(Y')$ as a subscheme of $X$, it is always this subscheme that will be involved.
\begin{example}
If the scheme $f^{-1}(Y')$ and $X$ are identical, $j':f^{-1}(Y')\to X$ is then the identity and any morphism $h:Z\to X$ is dominated by $j'$; hence the morphism $f:X\to Y$ factors into
\[\begin{tikzcd}
X\ar[r,"g"]&Y'\ar[r,"j"]&Y
\end{tikzcd}\]
\end{example}
\begin{example}
If $y$ is a closed point of $Y$ and $Y'=\Spec(\kappa(y))$ is the smallest closed subscheme of $Y$ having $\{y\}$ as underlying space, the closed subscheme $f^{-1}(Y')$ is then canonically isomorphic to the \textbf{fiber} $f^{-1}(y)$.
\end{example}
\begin{corollary}\label{scheme inverse image subscheme factor through iff}
Retain the hypotheses of \cref{scheme inverse image of subscheme}(b). Let $X'$ be a closed subscheme of $X$ defined by a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$ and $i:X'\to X$ be the canonical injection. For the restriction $f\circ i$ of $f$ to $X'$ is dominated by the injection $j:Y'\to Y$, it is necessary and sufficient that $f^*(\mathscr{K})\mathscr{O}_X\sub\mathscr{I}$. 
\end{corollary}
\begin{proof}
This follows from \cref{scheme inverse image of subscheme}(b) and (a).
\end{proof}
\begin{corollary}\label{scheme inverse image of subscheme transitivity}
Let $f:X\to Y$, $g:Y\to Z$ be two morphisms, and $h=g\circ f$ be their composition. For any subscheme $Z'$ of $Z$, the subscheme $f^{-1}(g^{-1}(Z'))$ and $h^{-1}(Z')$ of $X$ are identical.
\end{corollary}
\begin{proof}
This follows from the transitivity of products and \cref{scheme inverse image of subscheme}.
\end{proof}
\begin{corollary}\label{scheme inverse image in subscheme of subscheme char}
Let $X'$, $X''$ be two subschemes of $X$ and $j':X'\to X$, $j'':X''\to X$ be the canonical injections. Then $j'^{-1}(X'')$ and $j''^{-1}(X')$ are both equal to the infimum $\inf(X',X'')$ of $X'$ and $X''$ for the ordered relation on subschemes, and is canonically isomorphic to $X'\times_SX''$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme inverse image of subscheme}, \cref{scheme subscheme of subscheme is subscheme}, and the universal property of products.
\end{proof}
\begin{corollary}\label{scheme inverse image of inf subscheme}
Let $f:X\to Y$ be a morphism and $Y'$, $Y''$ be two subschemes of $Y$. Then we have $f^{-1}(\inf(Y',Y''))=\inf(f^{-1}(Y'),f^{-1}(Y''))$.
\end{corollary}
\begin{proof}
In fact, we have the canonical isomorphism of $(X\times_YY')\times_X(X\times_YY'')$ and $X\times_Y(Y'\times_YY'')$.
\end{proof}
\subsection{Local immersions and local isomorphisms}
Let $f:X\to Y$ be a morphism of schemes. We say $f$ is a \textbf{local immersion} (resp. a \textbf{local isomorphism}) \textbf{at a point $x\in X$} if there exists an open neighborhood $U$ of $x$ in $X$ and an open neighborhood $V$ of $f(x)$ in $Y$ such that the restriction of $f$ to $U$ is a closed immersion (resp. an open immersion) into $V$. We say $f$ is a local immersion (resp. a local isomorphism) if $f$ is a local immersion (resp. a local isomorphism) at every point of $X$.\par
An immersion (resp. closed immersion) $f:X\to Y$ can then be characterized as a local immersion such that $f$ is a homeomorphism onto a subset of $Y$ (resp. a closed subset of $Y$). An open immersion $f$ can be characterized as an injective local isomorphism.
\begin{proposition}\label{scheme irreducible dominant local immersion prop}
Let $X$ be an irreducible scheme, $f:X\to Y$ be a injective dominant morphism. If $f$ is a local immersion, then it is an immersion and $f(X)$ is open in $Y$.
\end{proposition}
\begin{proof}
In fact, let $x\in X$ and $U$ be an open neighborhood of $x$ in $X$, $V$ an open neighborhood of $f(x)$ in $Y$ such that $f|_Y$ is a closed immersion into $V$. As $U$ is dense in $X$, $f(U)$ is also dense in $Y$ by hypothesis, hence $f(U)=V$ and $f$ is a homeomorphism from $U$ to $V$. The hypothesis $f$ is injective implies $f^{-1}(V)=U$, whence the proposition.
\end{proof}
\begin{proposition}\label{scheme local immersion stable prop}
Let $f:X\to X'$, $g:Y\to Y'$ be two $S$-schemes.
\begin{enumerate}
\item[(a)] The composition of two local immersions (resp. local isomorphisms) is a local immersion (resp. a local isomorphism).
\item[(b)] If $f$ and $g$ are local immersions (resp. local isomorphisms), so is the product $f\times_Sg$.
\item[(c)] If $f$ is a local immersion (resp. a local isomorphism), so is $f_{(S')}$ for any extension $S'\to S$ of base schemes.
\end{enumerate}
\end{proposition}
\begin{proof}
It suffices to prove (a) and (b). Now (a) follows from the transitivity of closed immersions (resp. open immersions) and the fact that if $f$ is a homeomorphism of $X$ to a closed subset $Y$, then for any open set $U\sub X$, $f(U)$ is open in $f(X)$, so there exists an open subset $V$ of $Y$ such that $f(U)=V\cap f(X)$, and $f(U)$ is therefore closed in $V$.\par
To prove (b), let $p,q$ be the projections of $X\times_SY$ and $p',q'$ that of $X'\times_SY'$. There exist by hypotheses open neighborhoods $U$, $U'$, $V$, $V'$ of $x=p(z)$, $x'=p'(z')$, $y=q(z)$, $y'=q'(z')$, respectively, such that $f|_U$ and $g|_V$ are closed immersions (resp. open immersions) onto $U'$ and $V'$, respectively. As the underlying space of $U\times_SV$ is $p^{-1}(U)\cap q^{-1}(V)$ and that of $U'\times_SV'$ is $p'^{-1}(U')\cap q'^{-1}(V')$, which are neighborhoods of $z$ and $z'$, respectively (\cref{scheme product inverse image of base open}), the claim follows by \cref{scheme immersion stable under base change}.
\end{proof}
\begin{remark}
A local isomorphism is clearly flat and universally open, and therefore is universally generalizing.
\end{remark}
\begin{proposition}\label{scheme irreducible to integral morphism dominant prop}
Let $X$ be an irreducible scheme, $Y$ an integral scheme, and $f:X\to Y$ be a morphism.
\begin{enumerate}
\item[(a)] If $f$ is dominant, then for any $x\in X$, the homomorphism $f^{\#}_x:\mathscr{O}_{Y,f(x)}\to\mathscr{O}_{X,x}$ is injective.
\item[(b)] If $f$ is dominant and a local immersion, then $f$ is a local isomorphism (and therefore $X$ is integral).
\end{enumerate}
\end{proposition}
\begin{proof}
Let $\xi$ and $\eta$ be the generic points of $X$ and $Y$, respectively. If $f$ is dominant, we then have $f(\xi)=\eta$; moreover $\mathscr{O}_{Y,\eta}$ is a field since $Y$ is reduced, so $f^{\#}_\xi:\mathscr{O}_{Y,\eta}\to\mathscr{O}_{X,\xi}$ is a monomorphism. For any point $x\in X$, and any affine neighborhood $U$ of $y=f(x)$, there exists an affine neighborhood $V$ of $x$ contained in $f^{-1}(U)$. The open set $U$ (resp. $V$) contains $\eta$ (resp. $\xi$), and the ring $\Gamma(U,\mathscr{O}_Y)$ is integral with fraction field $\mathscr{O}_{Y,\eta}$. If $\rho:\Gamma(U,\mathscr{O}_Y)\to\Gamma(V,\mathscr{O}_X)$ is the homomorphism corresponding to $f$, the composition
\[\begin{tikzcd}
\Gamma(U,\mathscr{O}_Y)\ar[r,"\rho"]&\Gamma(V,\mathscr{O}_X)\ar[r]&\mathscr{O}_{X,\xi}
\end{tikzcd}\]
is then the restriction of $f^{\#}_\xi$ to $\Gamma(U,\mathscr{O}_Y)$, so the homomorphism $\rho$. We now deduce that $f^{\#}_x$ is injective: in fact the hypotheses that $X$ is irreducible implies that $\Gamma(V,\mathscr{O}_X)$ has a unique minimal $\n$, which is its nilradical; the homomorphism $f^{\#}_x$ just send an element $u/s$ (where $u,s\in\Gamma(U,\mathscr{O}_Y)$ and $s\neq 0$) to the element $\rho(u)/\rho(s)\in\mathscr{O}_{X,x}$, which is zero only if there exists $t\notin\p_x$ such that $t\rho(u)=0\in\n$. But as $t\notin\n$, this then implies $\rho(u)\in\n$, so $\rho(u)$ is nilpotent and since $\rho$ is injective, this shows that $u$ is nilpotent, which means $u=0$ for $\Gamma(U,\mathscr{O}_Y)$ being integral.\par
To prove the second assertion, let $f$ be dominant and a local immersion. We see $f(Y)$ is open in $Y$ by \cref{scheme irreducible dominant local immersion prop}. Since $f^{\#}_x$ is surjective for every point $x\in X$ (\cref{scheme morphism immersion iff stalk} ), it follows that $\f^{\#}_x$ is an isomorphism by (a), and this shows $f$ is a local isomorphism, again by \cref{scheme morphism immersion iff stalk} .
\end{proof}
\begin{proposition}\label{scheme reduced immersion is local iso at point iff flat}
Let $Y$ be a reduced scheme such that the family of irreducible components of $Y$ is locally finite. Let $j:X\to Y$ be an immersion. For $j$ to be a local isomorphism at a point $x\in X$, it is necessary and sufficient that the homomorphism $j^{\#}_x:\mathscr{O}_{Y,j(x)}\to\mathscr{O}_{X,x}$ is flat.
\end{proposition}
\begin{proof}
Since the question is local on $Y$, we may assume that $Y$ is affine, that $j$ is a closed immersion, and that all irreducible components of $Y$ contain $j(x)$ (hence are finite in number), and we prove that $j$ is an isomorphism in this case. If $Y=\Spec(A)$, and if $\p$ is the prime ideal of $A$ corresponding to $j(x)$, the morphism $\Spec(A_\p)\to\Spec(A)$ is then dominant since $\p$ contains the minimal ideals of $A$ (it is contaiend in every irreducible component of $\Spec(A)$). As $A$ is reduced, the homomorphism $A\to A_\p$ is injective (\cref{Spec of ring map dominant iff ker nilpotent}). If $\mathscr{O}$ is the ideal of $\mathscr{O}_Y$ defining the closed subscheme of $Y$ associated with $j$, we have $\mathscr{I}=\widetilde{\a}$, where $\a$ is an ideal of $A$, and it is identified with a subset of $\a_\p$. If $j$ is flat at $x$, then $(A/\a)_\p$ is a flat $A_\p$-module, and since the homomorphism $A_\p\to(A/\a)_\p$ is local, it is faithfully flat (\cref{ring faithfully flat iff}). By \cref{ring faithfully flat iff} this implies $\a_\p=0$, hence $\a=0$ and the claim follows.
\end{proof}
\subsection{Nilradical and associated reduced scheme}
\begin{proposition}\label{scheme qcoh algebra nilradical sheaf exist}
Let $(X,\mathscr{O}_X)$ be a scheme and $\mathscr{B}$ be a quasi-coherent $\mathscr{O}_X$-algebra. There exist a unique quasi-coherent ideal $\mathscr{N}$ of $\mathscr{B}$ such that for each point $x\in X$, the stalk $\mathscr{N}_x$ is the nilradical of the ring $\mathscr{B}_x$. If $X=\Spec(A)$ is affine and $\mathscr{B}=\widetilde{B}$, where $B$ is an $A$-algebra, then $\mathscr{N}=\widetilde{\n}$, where $\n$ is the nilradical of $B$.
\end{proposition}
\begin{proof}
Since the question is loca, we may assume that $X=\Spec(A)$ is affine and $\mathscr{B}=\widetilde{B}$. We know that $\widetilde{\n}$ is a quasi-coherent $\mathscr{O}_X$-module and for each point $x\in X$, the stalk $\n_x$ is an ideal of the fraction ring $B_x$. It suffices to show that the nilradical of $B_x$ is contained in $\n_x$, the opposite inclusion being evident. Now, let $z/s$ be a nilpotent element in $B_x$, where $z\in B$ and $s\notin\p_x$. By hypotheses, there exist $k\geq 0$ such that $(z/s)^k=0$, which means there exists $t\notin\p_x$ such that $tz^k=0$. We then conclude that $(tz)^k=0$, so $z/s=(tz)/(ts)$ is indeed in $\n_x$.  
\end{proof}
The quasi-coherent ideal $\mathscr{N}$ is called the \textbf{nilradical} of the $\mathscr{O}_X$-algebra $\mathscr{B}$. In particular, we denote by $\mathscr{N}_X$ the nilradical of $\mathscr{O}_X$.
\begin{corollary}\label{scheme reduced scheme structure given by nilradical}
Let $X$ be a scheme. Then the closed subscheme of $X$ defined by the quasi-coherent ideal $\mathscr{N}_X$ is the unique reduced subscheme of $X$ with underlying space $X$. It is also the smallest subscheme of $X$ having $X$ as underlying space. 
\end{corollary}
\begin{proof}
Since the structural sheaf of the closed subscheme $Y$ defined by $\mathscr{N}_X$ is $\mathscr{O}_X/\mathscr{N}_X$, it is immediate that $Y$ is reduced and has $X$ as underlying space, since $\mathscr{N}_{x}\neq\mathscr{O}_{X,x}$ for each $x\in X$. To prove the second claim, let $Z$ be a subscheme of $X$ with $X$ as underlying space. Then $Z$ is closed in $X$, so let $\mathscr{I}$ be the ideal defining it. We can assume that $X$ is affine, so $\mathscr{I}=\widetilde{\a}$ where $\a$ is an ideal of $A$. Then for each $x\in X$ we have $\a\sub\p_x$, so $\a\sub\n$, where $\n$ is the nilradical of $A$. This shows $Y$ is the smallest subscheme of $X$ with underlying space $X$, and if $Z$ is distinct from $Y$, we necessarily have $\mathscr{I}_x\neq\mathscr{N}_{x}$ for some $x\in X$, and concequently $Z$ is not reduced.
\end{proof}
The reduced scheme defined by $\mathscr{N}_X$ on $X$ is called the \textbf{reduced scheme associated with $\bm{X}$}, and denoted by $X_{\red}$. To say that a schema $X$ is reduced therefore means that $X_{\red}=X$. Clearly, we have a canonical closed immersion $X_{\red}\to X$, which is also a universal homeomorphism.
\begin{proposition}\label{scheme affine reduced integral iff}
For the spectrum of a ring $A$ to be reduced (resp. integral), it is necessary and sufficient that $A$ is reduced (resp. integral).
\end{proposition}
\begin{proof}
In fact, the condition $\mathscr{N}=0$ is necessary and sufficient for $\Spec(A)$ to be reduced, and the integral conditions follows from \cref{Spec of ring subset irreducible iff ideal prime}.
\end{proof}
\begin{proposition}\label{scheme integral iff ring is integral}
A scheme $X$ is integral if and only if for each open subset $U$ of $X$, the ring $\Gamma(U,\mathscr{O}_X)$ is integral.
\end{proposition}
\begin{proof}
We first assume that $\Gamma(U,\mathscr{O}_X)$ is integral for any open set $U$. It is clear that $X$ is reduced. If $X$ is not irreducible, then one can find two nonempty disjoint open subsets $U_1$ and $U_2$. Then $\Gamma(U_1\cup U_2,\mathscr{O}_X)=\Gamma(U_1,\mathscr{O}_X)\times\Gamma(U_2,\mathscr{O}_X)$, which is not an integral domain. Thus $X$ is an integral scheme.\par
Conversely, suppose that $X$ is reduced and irreducible. Let $U\sub X$ be an open subset, and suppose that there are elements $f,g\in\Gamma(U,\mathscr{O}_X)$ with $fg=0$. Let 
\[Y=\{x\in U:f_x\in\m_x\},\quad Z=\{x\in U:g_x\in\m_x\};\]
then $Y$ and $Z$ are closed subsets, and $Y\cup Z=U$. Since $X$ is irreducible, so $U$ is irreducible, and one of $Y$ or $Z$ is equal to $U$, say $Y=U$. But then the restriction of $f$ to any open affine subset of $U$ will be contained in every point of that subset, hence nilpotent and thus zero. This shows that $\Gamma(U,\mathscr{O}_X)$ is integral.
\end{proof}
\begin{proposition}\label{scheme irreducible component open and nilradical}
Let $X$ be a scheme and $x$ a point of $X$.
\begin{enumerate}
\item[(a)] For $x$ to belong to a unique irreducible component of $X$, it is necessary and sufficient that the nilradical of $\mathscr{O}_{X,x}$ is prime.
\item[(b)] If the nilradical of $\mathscr{O}_{X,x}$ is prime and the family of irreducible components of $X$ is locally finite, there exists an open neighborhood $U$ of $x$ that is irreducible.
\item[(c)] For $X$ to be the coproduct of its irreducible components, it is necessary and sufficient that the family of irreducible components of $X$ is locally finite and for each $x\in X$, the nilradical of $\mathscr{O}_{X,x}$ is prime.
\end{enumerate}
\end{proposition}
\begin{proof}
To check that whether $x$ belongs to distinct irreducible components of $X$, we may assume that $X=\Spec(A)$ is affine (\cref{topo space open irre closed intersection}). Then this signifies that $\p_x$ contains two distinct minimal prime ideals of $A$, and equivalently $\m_x$ contains two distinct minimal prime ideals of $\mathscr{O}_{X,x}$, which is a contradiction if and only if the nilradical of $\mathscr{O}_{X,x}$ is prime.\par
Now assume the conditions in (a). As the family of irreducible components of $X$ is locally finite, the union of those of these components which do not contain $x$ is closed, so its complement $U$ is open and contained in the unique irreducible component of $X$ containing $x$, and therefore irreducible (\cref{topo space irreducible iff}). The assertion in (c) follows from (b) and \cref{topo space locally Noe irre component open iff}.
\end{proof}
\begin{proposition}\label{scheme locally integral iff}
For a scheme $X$ to be locally integral, it is necessary and sufficient that the family of irreducible components is locally finite and for each point $x\in X$, the local ring $\mathscr{O}_{X,x}$ is integral. In this case, $X$ is the coproduct of its irreducible components, which are integral subschemes.
\end{proposition}
\begin{proof}
As the localizations of integral domains are integral, for a locally integral scheme $X$, its local rings $\mathscr{O}_{X,x}$ are inegral. The set of the irreducible components of $X$ is locally finite since each $x\in X$ admits an irreducible open neighborhoods; moreover, the irreducible components of $X$ are all open and disjoint, so $X$ is the coproduct of its irreducible components (\cref{topo space locally Noe irre component open iff}). Conversely, if $X$ satisfies these conditions, then $X$ is the coproduct of its irreducible components, which are open and integral. It follows immediately that $X$ is locally integral.
\end{proof}
\begin{corollary}\label{scheme locally finite irre component integral iff local ring}
Let $X$ be a scheme whose set of irreducible components is locally finite (for example if $X$ is locally Noetherian). Then for $X$ to be integral, it is necessary and sufficient that it is connected and for each $x\in X$, the local ring $\mathscr{O}_{X,x}$ is integral. In particular, a locally integral and connected scheme is integral.
\end{corollary}
\begin{proposition}\label{scheme local Noe reduced integral stalk lift}
Let $X$ be a locally Noetherian scheme and let $x\in X$ be a point such that the nilradical $\mathscr{N}_x$ of $\mathscr{O}_{X,x}$ is prime (resp. such that $\mathscr{O}_{X,x}$ is reduced, resp. such that $\mathscr{O}_{X,x}$ is integral). Then there exist an open neighborhood $U$ of $x$ that is irreducible (resp. reduced, resp. integral).
\end{proposition}
\begin{proof}
It suffices to consider the case where $\mathscr{N}_x$ is prime and where $\mathscr{N}_x=0$, the third one is the conjunction of the first two cases. If $\mathscr{N}_X$ is prime, the claim follows from \cref{scheme irreducible component open and nilradical}. If $\mathscr{N}_x=0$, we then have $\mathscr{N}_y=0$ for $y$ in a neighborhood of $x$, since $\mathscr{N}$ is quasi-coherent, hence coherent since $X$ is locally Noetherian and $\mathscr{N}$ is of finite type, and the conclusion follows from \cref{sheaf of module ft local prop}.
\end{proof}
\begin{proposition}\label{scheme Noetherian nilradical is nilpotent}
For a Noetherian scheme $X$, the nilradical $\mathscr{N}_X$ of $\mathscr{O}_X$ is nilpotent.
\end{proposition}
\begin{proof}
Since $X$ is quasi-compact, We can cover $X$ by a finite number of affine open sets $U_i$, and it suffices to prove that there exist integers $n_i$ such that $(\mathscr{N}_X|_{U_i})^{n_i}=0$. If $n$ is the largest of the $n_i$, we will then have $\mathscr{N}_X^n=0$. We are therefore reduced to the case where $X=\Spec(A)$ is affine, $A$ being a Noetherian ring. It then suffices to observe that the nilradical of $A$ is nilpotent.
\end{proof}
\begin{corollary}\label{scheme Noetherian affine iff red is}
A Noetherian sheme $X$ is affine if and only if $X_{\red}$ is affine.
\end{corollary}
\begin{proof}
If $X$ is affine it is clear that $X_{\red}$ is affine, regardless of $X$ being Noetherian. Conversely, assume that $X_{\red}$ is affine and $X$ is Noetherian. Then by \cref{scheme Noetherian nilradical is nilpotent}, the nilradical $\mathscr{N}$ of $\mathscr{O}_X$ is nilpotent. For any quasi-coherent sheaf $\mathscr{F}$ on $X$, consider the follows exact sequence (where $k\geq 0$)
\[\begin{tikzcd}
0\ar[r]&\mathscr{N}^k\mathscr{F}\ar[r]&\mathscr{N}^{k-1}\mathscr{F}\ar[r]&\mathscr{N}^{k-1}\mathscr{F}/\mathscr{N}^k\mathscr{F}\ar[r]&0
\end{tikzcd}\]
Since $\mathscr{N}^{k-1}\mathscr{F}/\mathscr{N}^k\mathscr{F}$ is an $\mathscr{O}_X/\mathscr{N}$-module and $(X,\mathscr{O}_{X}/\mathscr{N})$ is affine, by Serre's criterion we have $H^1(X,\mathscr{N}^{k-1}\mathscr{F}/\mathscr{N}^k\mathscr{F})=0$, so
\[H^1(X,\mathscr{N}^k\mathscr{F})=0\Rightarrow H^1(X,\mathscr{N}^{k-1}\mathscr{F})=0.\]
Since $\mathscr{N}$ is nilpotent, this shows $H^1(X,\mathscr{F})=0$, so $(X,\mathscr{O}_X)$ is affine, by Serre's criterion again.
\end{proof}
Let $f:X\to Y$ be a morphism of schemes; let $i:X_{\red}\to X$ and $j:Y_{\red}\to Y$ be the canonical injections. The homomorphism $f^{\#}_x:\mathscr{O}_{Y,f(x)}\to\mathscr{O}_{X,x}$ maps nilpotent elements of $\mathscr{O}_{Y,f(x)}$ into nilpotent elements of $\mathscr{O}_{X,x}$, so $f^*(\mathscr{N}_Y)\mathscr{O}_X\sub\mathscr{N}_X$. It then follows from \cref{scheme morphism factor through subscheme iff} that $f\circ i$ factors through $j$, so we get an induced morphism $f_{\red}:X_{\red}\to Y_{\red}$ and a commutative diagram
\begin{equation}\label{scheme associated red on morphism}
\begin{tikzcd}
X_{\red}\ar[d,swap,"i"]\ar[r,"f_{\red}"]&Y_{\red}\ar[d,"j"]\\
X\ar[r,"f"]&Y
\end{tikzcd}
\end{equation}
In particular, if $X$ is reduced, then the morphism $f$ factors into
\[\begin{tikzcd}
X\ar[r,"f_{\red}"]&Y_{\red}\ar[r,"j"]&Y
\end{tikzcd}\]
or in other words, $f$ is dominated by the canonical injection $j$. We also conclude that $Y_{\red}$ satisfies the universal property that any morphism from a reduced scheme to $Y$ factors through $Y_{\red}$.\par
For two morphisms $f:X\to Y$, $g:Y\to Z$, it follows from the uniqueness of factorization that we have
\[(g\circ f)_{\red}=g_{\red}\circ f_{\red};\]
we can equivalently say that the operation $X\mapsto X_{\red}$ is a covariant functor on the category of schemes.
\begin{proposition}\label{scheme associated red and product relation}
If $X$ and $Y$ are $S$-schemes, the schemes $X_{\red}\times_{S_{\red}}Y_{\red}$ and $X_{\red}\times_SY_{\red}$ are identical, and are canonically identified with a subscheme of $X\times_SY$ having the same underlying space as this product.
\end{proposition}
\begin{proof}
The fact that $X_{\red}\times_SY_{\red}$ is identified with a subscheme of $X\times_SY$ follows from the fact that if $f:X'\to X$ and $g:Y'\to Y$ are surjective $S$-immersions, then $f\times_Sg:X'\times_SY'\to X\times_SY$ is a surjective immersion (\cref{scheme immersion stable under product} and \cref{scheme surjective stable under base change}). On the other hand, if $\varphi:X_{\red}\to S$ and $\psi:Y_{\red}\to S$ are the structural morphisms, it is clear that they factors through $S_{\red}$, and as $S_{\red}\to S$ is a monomorphism, the second assertion follows.
\end{proof}
\begin{corollary}\label{scheme associated red and product iterated commute}
The schemes $(X\times_SY)_{\red}$ and $(X_{\red}\times_{S_{\red}}Y_{\red})_{\red}$ are canonically identified.
\end{corollary}
We note that if $X$ and $Y$ are reduced $S$-schemes, it is not necessarily that case that $X\times_SY$ is reduced, since the tensor product of two reduced algebras (even two fields) may not be reduced.
\begin{corollary}\label{scheme associated red on morphism factor through}
For any morphism $f:X\to Y$ of schemes, the diagram (\ref{scheme associated red on morphism}) factors into
\begin{equation}\label{scheme associated red on morphism factor through-1}
\begin{tikzcd}
X_{\red}=(X\times_YY_{\red})_{\red}\ar[r]&X\times_YY_{\red}\ar[d]\ar[r]&Y_{\red}\ar[d]\\
&X\ar[r,"f"]&Y
\end{tikzcd}
\end{equation}
\end{corollary}
\begin{proof}
For this, we only need to note that $(X\times_YY_{\red})_{\red}=(X_{\red}\times_{Y_{\red}}Y_{\red})_{\red}=X_{\red}$.
\end{proof}
\begin{proposition}\label{scheme associated red on property of morphism f_red iff f}
Let $X$ and $Y$ be two schemes. Consider the following properties for a morphism $f:X\to Y$:
\begin{enumerate}
\item[(\rmnum{1})] surjective;
\item[(\rmnum{2})] injective;
\item[(\rmnum{3})] open at the point $x$ (resp. open);
\item[(\rmnum{4})] closed;
\item[(\rmnum{5})] a homeomorphism onto its image;
\item[(\rmnum{6})] universally open at a point $x$ (resp. universally open);
\item[(\rmnum{7})] universally closed;
\item[(\rmnum{8})] a universal embedding;
\item[(\rmnum{9})] a universal homeomorphism; 
\item[(\rmnum{10})] radical;
\item[(\rmnum{11})] generalizing at a point $x$ (resp. generalizing);
\item[(\rmnum{12})] universally generalizing at a point $x$ (resp. universally generalizing).
\end{enumerate}
Then, if $\mathcal{P}$ denote one of the above properties, for $f$ to possess the property $\mathcal{P}$, it is necessary and sufficient that $f_{\red}$ possess $\mathcal{P}$.
\end{proposition}
\begin{proof}
The proposition is evident for the properties (\rmnum{1}), (\rmnum{2}), (\rmnum{3}), (\rmnum{4}), (\rmnum{5}), (\rmnum{11}), which only depend on the map of the underlying spaces. For (\rmnum{10}), the proposition follows from the fact that the fibers of $f$ and $f_{\red}$ at a point $y\in Y$ have the same underlying space and the residue field at a point of $X$ (resp. $Y$) is the same for $X_{\red}$ and $Y_{\red}$. For the properties (\rmnum{6}), (\rmnum{7}), (\rmnum{8}), (\rmnum{9}) and (\rmnum{12}), if $f$ possesses one of these properties, the same is true of $f_{\red}$ due to \cref{scheme associated red on morphism factor through} and that the morphism $X_{\red}\to X\times_YY_{\red}$ is a universal homeomorphism. Conversely, if $f_{\red}$ possesses one of these properties, it suffices to note that for any morphism $Y'\to Y$ we have $(X_{\red}\times_{Y_{\red}}Y_{\red}')_{\red}=(X\times_YY')_{\red}$, so the morphism
\[(f_{(Y')})_{\red}:(X\times_YY')_{\red}\to Y'_{\red}\]
possesses the "nonuniversal" version of the same property, and by what we have already seen, $f_{(Y')}$ then has the corresponding property.
\end{proof}
\begin{proposition}\label{scheme associated red on property of morphism f to f_red}
Let $X$ and $Y$ be two schemes and $x$ be a point of $X$. Consider the following properties for a morphism $f:X\to Y$:
\begin{enumerate}
\item[(\rmnum{1})] a monomorphism;
\item[(\rmnum{2})] an immersion; 
\item[(\rmnum{3})] an open immersion;
\item[(\rmnum{4})] a closed immersion;
\item[(\rmnum{5})] a local immersion at the point $x$;
\item[(\rmnum{6})] a local isomorphism at the point $x$;
\item[(\rmnum{7})] birational.
\end{enumerate}
Then, if $f$ possesses one of the above properties, $f_{\red}$ also possesses that property. 
\end{proposition}
\begin{proof}
For the properties (\rmnum{2}) to (\rmnum{7}), the result follows from the observation that $(f_{\red})^{\#}_x:\mathscr{O}_{Y,f(x)}\to\mathscr{O}_{X,x}$ is surjective (resp. bijective) if $f^{\#}_x:\mathscr{O}_{Y,f(x)}\to\mathscr{O}_{X,x}$ is surjective (resp. bijective) (\cref{scheme morphism immersion iff stalk} ). For (\rmnum{1}) it suffices to note that a monomorphism is universal (\cref{scheme fiber product monomorphism}), the diagram (\ref{scheme associated red on morphism factor through-1}), and the fact that $X_{\red}\to X\times_YY_{\red}$ is a closed immersion, hence a monomorphism.
\end{proof}
Note that if $f_{\red}$ is an immersion, it is not necessarily true that $f$ is. For example, let $Y=\Spec(k)$ where $k$ is a field and $X=\Spec(A)$, where $A=k[T]/(T^2)$. Then the canonical injection $\rho:k\to k[T]/(T^2)$ corresponds to a morphism $f:X\to Y$. It is clear that $f$ is not an immersion (in fact any nonzero immersion into $Y$ is automatically closed); but $A_{\red}=k$ so $f_{\red}$ is an isomorphism.
\begin{remark}
To say that an immersion $f:Y\to X$ is surjective means it is closed and that the subscheme of $X$ associated with $f$ is defined by an ideal $\mathscr{I}$ contained in the nilradical $\mathscr{N}_X$. In this case, we say $f$ is a nilimmersion; $f$ is then a homeomorphism from $Y$ to $X$, and $f_{\red}$ is an isomorphism from $Y_{\red}$ to $X_{\red}$. We say the nilimmersion $f$ is \textbf{nilpotent} (resp. \textbf{locally nilpotent}) if the ideal $\mathscr{I}$ is nilpotent (resp. locally nilpotent, i.e. that every $x\in X$ has an open neighborhood $U$ such that $\mathscr{I}|_U$ is nilpotent). More precisely, we say $f$ is \textbf{nilpotent of order $\bm{n}$} if $\mathscr{I}^{n+1}=0$. If $Y$ is a subscheme of $X$ and $f$ is the canonical immersion, we say $X$ is an \textbf{infinitesimal neighborhood} (resp. an \textbf{infinitesimal neighborhood of order $\bm{n}$}) of $Y$ if $f$ is nilpotent (resp. nilpotent of order $n$). 
\end{remark}
\subsection{Reduced scheme structure on closed subsets}
\begin{proposition}\label{scheme closed subset reduced subscheme}
For any locally closed subspace $Y$ of the underlying space of a scheme $X$, there exists a unique reduced subscheme of $X$ with underlying space $Y$. 
\end{proposition}
\begin{proof}
The uniqueness is immediate from \cref{scheme reduced scheme structure given by nilradical}, so we only need to construct a reduced scheme structure on $Y$. If $X$ is affine with ring $A$ and $Y$ is closed in $X$, the proposition is immediate: $I(Y)$ is the largest ideal $\a\sub A$ such that $V(\a)=Y$, and is radical, hence the ring $A/I(Y)$ is reduced, and we can take the scheme structure $(Y,\widetilde{A/I(Y)})$ on $Y$.\par
In the general case, for any affine open $U\sub X$ such that $U\cap Y$ is closed in $U$, consider the closed subscheme $Y_U$ of $U$ defined by the quasi-coherent ideal associated with the ideal $I(U\cap Y)$ of $\Gamma(U,\mathscr{O}_X|_U)$, which is reduced. If $V$ is an open affine of $X$ contained in $U$, then $Y_V$ is induced by $Y_U$ on $V\cap Y$ since this induced scheme is a closed subscheme of $V$ which is reduced and has $V\cap Y$ as underlying space; the uniqueness of $Y_V$ therefore entails our assertion.
\end{proof}
\begin{corollary}\label{scheme locally closed subset maximal generalization}
Let $X$ be a scheme and $Y$ be a locally closed subset of $X$. Then any point $x\in Y$ admits a maximal generalization $y$ (i.e. $y$ has no further generalization in $Y$). In particular, if $Y\neq\emp$, there exist a maximal element $y\in Y$ under generalization.
\end{corollary}
\begin{proof}
It suffices to give $Y$ a subscheme structure of $X$ and take $y$ to be the generic point of the irreducible components of $Y$ containing $x$. 
\end{proof}
\begin{example}\label{scheme reduced subscheme on closed point eg}
Let $X$ be a scheme and $x$ be a closed point of $X$. Let $U$ be an open neighborhood of $x$. Then $Z=(X-U)\cup\{x\}$ is a closed subset of $X$, so we can consider the reduced scheme structure on it. Let $\mathscr{I}$ be the corresponding quasi-coherent ideal of $\mathscr{O}_X$, we want to determine the stalk $\mathscr{I}_x$. For this, we can assume that $X=\Spec(A)$ is affine and $X-U=V(\a)$, where $\a$ is an ideal of $A$. Then the point $x$ corresponds to a maximal ideal $\m$ of $A$ such that $\a\nsubseteq\m$, and $Z=V(\a)\cup\{x\}=V(\a\cap\m)$. By definition, $\mathscr{I}$ is the quasi-coherent ideal on $X$ associated with $I(Z)=\sqrt{\a\cap\m}$, and therefore
\[\mathscr{I}_x=(\sqrt{\a\cap\m})_\m=\sqrt{(\a\cap\m)_\m},\]
which is the intersection of prime ideals $\p$ containing $\a\cap\m$ and contained in $\m$. But if a prime ideal $\p\sub\m$ of $A$ contains $\a\cap\m$, then by \cref{prime ideal contain intersection} we have $\p\supset\a$ or $\p\supset\m$. If $\p\neq\m$, then this implies $\p\supset\a$ and therefore $\m\supset\p\supset\a$, which is a contradiction (since $x$ is not contained in $X-U=V(\a)$). From this, we conclude that $\mathscr{I}_x=\m_x$.
\end{example}
\begin{example}\label{scheme Noe stalk of ideal defining irre component}
Let $X$ be a reduced locally Noetherian scheme and $X'$ be a reduced closed subscheme of $X$ with underlying space an irreducible component of $X$. Then $X'$ is defined by a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$. Let $x$ be the generic point of $X'$; we claim that $\mathscr{I}_x=0$. For this, we can assume that $X=\Spec(A)$ is affine, where $A$ is a reduced Noetherian ring, so $\mathscr{I}=\tilde{\p}$ where $\p$ is a minimal prime ideal of $A$. By definition the stalk of $\mathscr{I}$ at $x$ is indeitified with $\p A_\p$, which is the maximal ideal of $A_\p=\mathscr{O}_{X,x}$. But since $A$ is reduced and $\p$ is minimal, $A_\p$ is a reduced Artinian local ring, whence a field, and we then conclude that $\p A_p=0$, so $\mathscr{I}_x=0$.
\end{example}
\begin{proposition}\label{scheme morphism from reduced factorization}
Let $X$ be a reduced scheme, $f:X\to Y$ be a morphism, and $Z$ be a closed subscheme of $Y$ containing $f(X)$. Then $f$ factors into
\[\begin{tikzcd}
X\ar[r,"g"]&Z\ar[r,"j"]&Y
\end{tikzcd}\]
where $j$ is the canonical injection.
\end{proposition}
\begin{proof}
The hypotheses implies that the closed subscheme $f^{-1}(Z)$ of $X$ has underlying space $X$ (\cref{scheme inverse image of subscheme}). As $X$ is reduced, this subscheme coincides with $X$ by \cref{scheme reduced scheme structure given by nilradical}, and the proposition then follows from \cref{scheme inverse image of subscheme}.
\end{proof}
\begin{corollary}\label{scheme reduced subscheme extend to closure}
Let $X$ be a reduced subscheme of a scheme $Y$. If $Z$ is the reduced closed subscheme of $Y$ with underlying space $\widebar{X}$, then $X$ is an open subscheme of $Z$.
\end{corollary}
\begin{proof}
Since $X$ is locally closed, there is an open set $U$ of $Y$ such that $X=U\cap\widebar{X}$. By \cref{scheme morphism from reduced factorization}, $X$ is then a reduced subscheme of $Z$, with underlying space open in $Z$. Since the scheme structure induced by $Z$ is also reduced, we conclude that $X$ is induced by $Z$, in view of the uniqueness part of \cref{scheme closed subset reduced subscheme}.
\end{proof}
\begin{corollary}\label{scheme morphism closed subscheme inclusion iff ideal}
Let $f:X\to Y$ be morphism and $X'$ (resp. $Y'$) be a closed subscheme of $X$ (resp. $Y$) defined by a quasi-coherent ideal $\mathscr{I}$ (resp. $\mathscr{K}$) of $\mathscr{O}_X$ (resp. $\mathscr{O}_Y$). Suppose that $X'$ is reduced and $f(X')\sub Y'$, then we have  $f^*(\mathscr{K})\mathscr{O}_X\sub\mathscr{I}$.
\end{corollary}
\begin{proof}
The restriction of $f$ to $X'$ factors into $X'\to Y'\to Y$ by \cref{scheme morphism from reduced factorization}, so it suffices to use \cref{scheme inverse image subscheme factor through iff}.
\end{proof}
\section{Separated schemes and morphisms}
\subsection{Diagonal and graph of a morphism}
Let $X$ be an $S$-scheme; recall that the diagonal morphism $X\to X\times_SX$, denoted by $\Delta_{X/S}$ or $\Delta_X$, is the $S$-morphism $(1_X,1_X)_S$, which means $\Delta_X$ is the unique $S$-morphism such that
\[p_1\circ\Delta_X=p_2\circ\Delta_X=1_X,\]
where $p_1,p_2$ are the canonical projections of $X\times_SX$. If $f:T\to X$ and $g:T\to Y$ are two $S$-morphisms, we verify that
\[(f,g)_S=(f\times_Sg)\circ\Delta_{T/S}.\]
If $\varphi:X\to S$ is the structural morphism of $X$, we also write $\Delta_{\varphi}$ for $\Delta_{X/S}$.
\begin{proposition}\label{scheme product of diagonal morphism}
Let $X,Y$ be $S$-schemes. If we identify $(X\times_SY)\times_S(X\times_SY)$ and $(X\times_SX)\times_S(Y\times_SY)$, the morphism $\Delta_{X\times Y}$ is identified with $\Delta_X\times\Delta_Y$.
\end{proposition}
\begin{proof}
In fact, if $p_1,q_1$ are the canonical projections $X\times_SX\to X$, $Y\times_SY\to Y$, the projection $(X\times_SY)\times_S(X\times_SY)\to X\times_SY$ is identified with $p_1\times q_1$, and we have
\[(p_1\times q_1)\circ(\Delta_X\times\Delta_Y)=(p_1\circ\Delta_X)\times(q_1\circ\Delta_Y)=1_{X\times Y}\]
similar for the projection to the second factor.
\end{proof}
\begin{corollary}\label{scheme diagonal morphism and base change}
For any extension $S'\to S$ of base schemes, $\Delta_{X_{(S')}}$ is identified with $(\Delta_X)_{(S')}$.
\end{corollary}
\begin{proof}
It suffices to remark that $(X\times_SX)_{(S')}$ is identified with $X_{(S')}\times_{S'}X_{(S')}$ canonically.
\end{proof}
\begin{proposition}\label{scheme product over base cochange and diagonal morphism}
Let $X,Y$ be $S$-schemes and $S\to T$ be a morphism. Let $\varphi:X\to S$, $\psi:Y\to S$ be the structural morphisms, $p,q$ the projection of $X\times_SY$, and $\pi=\varphi\circ p=\psi\circ q$ the structural morphism $X\times_SY\to S$. Then the diagram
\begin{equation}\label{scheme product over base cochange and diagonal morphism-1}
\begin{tikzcd}[row sep=12mm,column sep=12mm]
X\times_SY\ar[r,"{(p,q)_T}"]\ar[d,swap,"\pi"]&X\times_TY\ar[d,"\varphi\times_T\psi"]\\
S\ar[r,"\Delta_{S/T}"]&S\times_TS
\end{tikzcd}
\end{equation}
commutes and cartesian.
\end{proposition}
\begin{proof}
By the definition of products, we may prove the proposition in the category of sets, and replace $X$, $Y$, $S$ by $X(Z)_T$, $Y(Z)_T$, $S(Z)_T$, where $Z$ is an arbitrary $T$-scheme, and it is then immediate.
\end{proof}
\begin{corollary}\label{scheme morphism cartesian square with diagonal morphism}
If $f:X\to Y$ is an $S$-morphism, the diagram
\begin{equation}\label{scheme morphism cartesian square with diagonal morphism-1}
\begin{tikzcd}[row sep=12mm,column sep=12mm]
X\ar[d,swap,"f"]\ar[r,"\Gamma_f"]&X\times_SY\ar[d,"{f\times_S1_Y}"]\\
Y\ar[r,"\Delta_Y"]&Y\times_SY
\end{tikzcd}
\end{equation}
is commutative and cartesian.
\end{corollary}
\begin{proof}
It suffcies to apply \cref{scheme product over base cochange and diagonal morphism} with $S$ replaced by $Y$ and $T$ by $S$, and note that $X\times_YY=X$.
\end{proof}
\begin{proposition}\label{scheme monomorphism iff diagonal isomorphism}
For a morphism $f:X\to Y$ of schemes to be a monomorphism, it is necessary and sufficient that $\Delta_{X/Y}$ is an isomorphism from $X$ to $X\times_YX$.
\end{proposition}
\begin{proof}
In fact, $f$ is monic means for any $Y$-scheme $Z$, the corresponding map $X(Z)_Y\to Y(Z)_Y$ is an injection, and as $Y(Z)_Y$ is reduced to a singleton, this means $X(Z)_Y$ is either empty or a singleton. But this is equivalent to saying that $X(Z)_Y\times X(Z)_Y$ is canonically isomorphic to $X(Z)_Y$ via the diagonal map, where the first set is $(X\times_YX)(Z)_Y$, and this means $\Delta_{X/Y}$ is an isomorphism.
\end{proof}
\begin{proposition}\label{scheme diagonal is immersion}
The diagonal morphism is an immersion from $X$ to $X\times_SX$, and the corresponding subscheme of $X\times_SX$ is called the \textbf{diagonal} of $X\times_SX$.
\end{proposition}
\begin{proof}
Let $p_1,p_2$ be the projections of $X\times_SX$. As the continuous maps $p_1$ and $\Delta_X$ are such that $p_1\circ\Delta_X=1_X$, $\Delta_X$ is a homeomorphism from $X$ onto $\Delta_X(X)$. Simialrly, the composition of the homomorphisms $\mathscr{O}_{X,x}\to\mathscr{O}_{\Delta_X(X),x}\to\mathscr{O}_{X,x}$ corresponding to $p_1$ and $\Delta_X$ is the identity, so the homomorphism corresponding to $\Delta_X$ on stalks are surjective. The proposition then follows from \cref{scheme morphism immersion iff stalk} .
\end{proof}
\begin{corollary}\label{scheme morphism product of projection is immersion}
With the hypotheses of \cref{scheme product over base cochange and diagonal morphism}, the morphisms $(p,q)_T$ is an immersion.
\end{corollary}
\begin{proof}
This follows from \cref{scheme product over base cochange and diagonal morphism} and \cref{scheme immersion stable under base change}.
\end{proof}
\begin{corollary}\label{scheme morphism graph is immersion}
Let $X$ and $Y$ be $S$-schemes and $f:X\to Y$ be an $S$-morphism. Then the graph morphism $\Gamma_f:X\to X\times_SY$ of $f$ is an immersion.
\end{corollary}
\begin{proof}
This follows from the diagram (\ref{scheme morphism cartesian square with diagonal morphism-1}) and \cref{scheme immersion stable under base change}.
\end{proof}
The subscheme of $X\times_SY$ associated with the immersion $\Gamma_f$ is called the \textbf{graph} of the morphism $f$; the subschemes of $X\times_SY$ which are graphs of morphisms $X\to Y$ are characterized by the fact that the restriction of the projection $p_1:X\times_SY\to X$ to such a subscheme $G$ is an isomorphism $g$ from $G$ to $X$: in fact, if this is the case, $G$ is then the graph of the morphism $p_2\circ g^{-1}$, where $p_2:X\times_SY\to Y$ is the second projection.\par
In particular, if $X=S$, the $S$-morphisms $S\to Y$, which are none other than the $S$-sections of $Y$, are equal to their graph morphisms; the subschemes of $Y$ which are graphs of $S$-sections (in other words, those which are isomorphic to $S$ by the restriction of the structural morphism $Y\to S$) are then called the \textbf{images of these sections}, or, by abuse of language, the $S$-sections of $Y$.
\begin{proposition}\label{scheme diagonal morphism functorial}
If $f:X\to Y$ is an $S$-morphism, the diagram
\begin{equation}\label{scheme diagonal morphism functorial-1}
\begin{tikzcd}
X\ar[r,"\Delta_X"]\ar[d,swap,"f"]&X\times_SX\ar[d,"f\times_Sf"]\\
Y\ar[r,"\Delta_Y"]&Y\times_SY
\end{tikzcd}
\end{equation}
is commutative (in other words, $\Delta_X$ is a functorial morphism on the category of schemes).
\end{proposition}
\begin{proof}
The morphisms $\Delta_Y\circ f$ satisfies the condition that
\[p_1\circ(\Delta_Y\circ f)=p_2\circ(\Delta_Y\circ f)=f\]
where $p_1,p_2$ are the projections of $Y\times_SY$. Similarly, if $q_1,q_2$ are the projections of $X\times_SX$,
\begin{align*}
&p_1\circ(f\times_Sf)\circ\Delta_X=f\circ q_1\circ\Delta_X=f,\\
&p_2\circ(f\times_Sf)\circ\Delta_X=f\circ q_2\circ\Delta_X=f.
\end{align*}
It then follows from the universal property of products that $\Delta_Y\circ f=(f\times_Sf)\circ\Delta_X$.
\end{proof}
\begin{corollary}\label{scheme diagonal of subscheme char}
If $X$ is a subscheme of $Y$, the diagonal $\Delta_X(X)$ is identified with a subscheme of $\Delta_Y(Y)$ whose the underlying space is identified with
\[\Delta_Y(Y)\cap p_1^{-1}(X)=\Delta_Y(Y)\cap p_2^{-1}(X)\]
where $p_1,p_2$ are the projections of $Y\times_SY$.
\end{corollary}
\begin{proof}
Apply \cref{scheme diagonal morphism functorial} to the immersion $f:X\to Y$, we see $(f\times_Sf)$ is an immersion which identifies $X\times_SX$ with the subspace $p_1^{-1}(X)\cap p_2^{-1}(X)$ of $Y\times_SY$ (\cref{scheme immersion stable under product}). Moreover, if $z\in\Delta_Y\cap p_1^{-1}(X)$, we have $z=\Delta_Y(y)$ and $y=p_1(z)\in X$, so $y=f(y)$, and $z=\Delta_Y(f(y))$ belongs to $\Delta_X(X)$ in view of the diagram (\ref{scheme diagonal morphism functorial-1}).
\end{proof}
\begin{proposition}\label{scheme morphism equalizer char by inverse image of diagonal}
Let $u_1:X\to Y$, $u_2:X\to Y$ be two $S$-morphisms. Then the kernel $\ker(u_1,u_2)$ is canonically isomorphic to the inverse image in $X$ of the diagonal $\Delta_Y(Y)$ under the morphism $(u_1,u_2)_S:X\to Y\times_SY$.
\end{proposition}
\begin{proof}
Let $Z\to X$ be the inverse image of $\Delta_Y(Y)$ under the morphism $(u_1,u_2)_S$. Then if $f:T\to X$ is an $S$-morphism such that $u_1\circ f=u_2\circ f$, then
\begin{align*}
&p_1\circ (u_1,u_2)_S\circ f=u_1\circ f=u_2\circ f=p_1\circ\Delta_Y\circ u_2\circ f,\\
&p_2\circ (u_1,u_2)_S\circ f=u_2\circ f=p_2\circ\Delta_Y\circ u_2\circ f
\end{align*}
where $p_1,p_2$ are the projections of $Y\times_SY$. We conclude that $(u_1,u_2)_S\circ f=\Delta_Y\circ u_2\circ f$, and by the definition of $Z$, the morphism $f$ factors uniquely through $Z$, which proves our claim.
\end{proof}
\begin{corollary}\label{scheme morphism equalizer char by residue field}
For a point $x\in X$ to belong to $\ker(u_1,u_2)$, it is necessary and sufficient that $u_1(x)=u_2(x)=y$ and the homomorphisms $\kappa(y)\to\kappa(x)$ corresponding to $u_1$ and $u_2$ are equal.
\end{corollary}
\begin{proof}
In fact, if $j:Z\to X$ is the kernel of $u_1$ and $u_2$, to say $x\in Z$ signifies that the canonical morphism $h:\Spec(\kappa(x))\to X$ factors into $h=j\circ g$, where $g$ is a morphism from $\Spec(\kappa(x))$ to $Z$. This is equivalent to $u_1\circ h=u_2\circ h$, and by \cref{scheme local of field morphism factors through prop} to that $u_1(x)=u_2(x)$ and the field extensions $\kappa(y)\to\kappa(x)$ corresponding to $u_1$ and $u_2$ are equal.
\end{proof}
\begin{proposition}\label{scheme morphism cartesian square of kernel}
Let $X$ and $Y$ be $S$-schemes and $f:X\to Y$, $g:X\to Y$ be $S$-morphisms. Then we have the following commutative diagram
\[\begin{tikzcd}
\ker(f,g)\ar[r]\ar[d]&X\ar[r,"g"]\ar[d,"\Gamma_g"]&Y\ar[d,"\Delta_{Y}"]\\
X\ar[r,"\Gamma_f"]\ar[d,swap,"f"]&X\times_SY\ar[r,"g\times_S\mathbf{1}_Y"]\ar[d,"f\times_S\mathbf{1}_Y"]&Y\times_SY\\
Y\ar[r,"\Delta_{Y}"]&Y\times_SY
\end{tikzcd}\]
where all squares are cartesian.
\end{proposition}
\begin{proof}
The fact that $\ker(f,g)$ is identified with the kernel of $\Gamma_f$ and $\Gamma_g$ can be deduced from by applying the projection $X\times_SY\to Y$, or by Yoneda since this is clearly true for sets. The other two small squares are cartesian by \cref{scheme morphism cartesian square with diagonal morphism}, so the claim follows from the transitivity of products.
\end{proof}
\begin{proposition}\label{scheme morphism arbitrary calcelled if}
Let $\mathcal{P}$ be a property for morphisms of schemes and consider the following conditions:
\begin{enumerate}
\item[(\rmnum{1})] If $j:X\to Y$ is an immersion and $g:Y\to Z$ is a morphism possessing the property $\mathcal{P}$, then $g\circ j$ possesses the property $\mathcal{P}$.
\item[(\rmnum{2})] If $f:X\to X'$ and $g:y\to Y'$ are two $S$-morphisms possessing the property $\mathcal{P}$, then $f\times_Sg$ possesses the property $\mathcal{P}$.  
\item[(\rmnum{3})] If the composition $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ possesses the property $\mathcal{P}$, then $f$ possesses the property $\mathcal{P}$.
\end{enumerate}
Then (\rmnum{3}) is a concequence of (\rmnum{1}) and (\rmnum{2}).
\end{proposition}
\begin{proof}
The morphism $f$ factors into
\[\begin{tikzcd}
X\ar[r,"\Gamma_f"]&X\times_{Z}Y\ar[r,"p_2"]&Y
\end{tikzcd}\]
where $p_2$ is the projection. On the other hand, $p_2$ is idnetified with $(g\circ f)\times_{Z}1_Y$, and by (\rmnum{2}) it possesses the property $\mathcal{P}$; as $\Gamma_f$ is an immersion, it then follows from (\rmnum{1}) that $f$ possesses $\mathcal{P}$.
\end{proof}
\begin{proposition}\label{scheme morphism cancelled eg}
Let $f:X\to Y$ and $g:Y\to Z$ be two morphisms. Consider the following properties for a morphism:
\begin{enumerate}
\item[(\rmnum{1})] a monomorphism;
\item[(\rmnum{2})] an immersion;
\item[(\rmnum{3})] a local immersion;
\item[(\rmnum{4})] a universal embedding; 
\item[(\rmnum{5})] radical.
\end{enumerate}
Then, if $g\circ f$ possesses one of these properties, so does $f$.
\end{proposition}
\begin{proof}
The properties (\rmnum{1}) and (\rmnum{5}) have only been put for memory, because for (\rmnum{1}) this is a property valid for any category, and for (\rmnum{5}), the proposition has already been proven in \cref{scheme radical morphism def}.\par
An immersion has each of these properties, and the composition of two morphisms having one (determined) of these properties also possesses it; moreover, all the above properties are stable under products. Thus the claim follows from \cref{scheme morphism arbitrary calcelled if}.
\end{proof}
\begin{corollary}\label{scheme local immersion stable under target product}
Let $j:X\to Y$ and $g:X\to Z$ be two $S$-morphisms. If $j$ possesses one of the properties in \cref{scheme morphism cancelled eg}, so does $(j,g)_S$.
\end{corollary}
\begin{proof}
In fact, if $p:Y\times_SZ\to Y$ is the projection, we have $j=p\circ(j,g)_S$, and it suffices to apply \cref{scheme morphism cancelled eg}.
\end{proof}
\subsection{Separated morphisms and schemes}
A morphism $f:X\to Y$ of schemes is called \textbf{separated} if the diagonal morphism $\Delta_f:X\to X\times_YX$ is a closed immersion. In this case, $X$ is said to be a \textbf{separated $\bm{Y}$-scheme}, or \textbf{separated over $\bm{Y}$}. A scheme $X$ is called \textbf{separated} if it is separated over $\Z$. In view of \cref{scheme diagonal is immersion}, for $X$ to be separated over $Y$, it is necessary and sufficient that the diagonal is a closed subscheme of $X\times_YX$.
\begin{proposition}\label{scheme affine morphism is separated}
Any morphism of affine schemes is separated. In particular, any affine scheme is separated.
\end{proposition}
\begin{proof}
If $f:\Spec(B)\to\Spec(A)$ is a morphism of affine schemes, where $B$ is an $A$-algebra, the diagonal morphism corresponds to the ring homomorphism $B\otimes_AB\to B$ given by $b\otimes b'\mapsto bb'$. Since this is surjective, we conclude that $\Delta_f$ is a closed immersion, so $f$ is separated.
\end{proof}
\begin{proposition}\label{scheme product over separate base cochange and diagonal canonical closed}
Let $X,Y$ be $S$-schemes and $S\to T$ be a separated morphism. Then the canonical immersion $X\times_SY\to X\times_TY$ in (\ref{scheme product over base cochange and diagonal morphism-1}) is closed.
\end{proposition}
\begin{proof}
In fact, in the diagram (\ref{scheme product over base cochange and diagonal morphism-1}), the diagonal $\Delta_{S/T}$ is a closed immersion, so its base change $\varphi\times_T\psi:X\times_SY\to X\times_TY$ is also closed.
\end{proof}
\begin{corollary}\label{scheme morphism to separated graph is closed}
Let $X,Y$ be $S$-schemes and $f:X\to Y$ be an $S$-morphism. If $Y$ is spearated over $S$, the graph morphism $\Gamma_f:X\to X\times_SY$ is a closed immersion. In particular, any $S$-section of $Y$ is a closed immersion.
\end{corollary}
\begin{proof}
This follows from (\ref{scheme morphism cartesian square with diagonal morphism-1}) and \cref{scheme immersion stable under base change}.
\end{proof}
\begin{proposition}\label{scheme equalizer over separated scheme closed}
Let $Y$ be a separated $S$-scheme. Then for any $S$-morphisms $u_1:X\to Y$, $u_2:X\to Y$, the kernel of $u_1$ and $u_2$ is a closed subscheme of $X$.
\end{proposition}
\begin{proof}
Recall that by \cref{scheme morphism equalizer char by inverse image of diagonal} the kernel is the inverse image of $\Delta_Y(Y)$ under the morphism $(u_1,u_2)_S$. Since $\Delta_Y(Y)$ is closed, it follows from \cref{scheme immersion stable under base change} that its inverse image is also closed.
\end{proof}
\begin{corollary}\label{scheme separated over integral base section uniquely determine}
Let $S$ be an integral scheme, $\eta$ its generic point, and $X$ a separated $S$-scheme. If two $S$-sections $u,v$ of $X$ satisfy $u(\eta)=v(\eta)$, then $u=v$. 
\end{corollary}
\begin{proof}
In fact, if $x=u(\eta)=v(\eta)$, the corresponding homomorphisms $\kappa(x)\to\kappa(\eta)$ are necessarily identical, since their composition with the homomorphism $\kappa(\eta)\to\kappa(x)$ corresponding to the structural morphism $X\to S$ is the idnetity on $\kappa(\eta)$. We then deduce from \cref{scheme morphism equalizer char by residue field} that $\eta\in\ker(u_1,u_2)$, and by hypothesis $\ker(u_1,u_2)$ is a closed subscheme of $S$ (\cref{scheme equalizer over separated scheme closed}). As $S$ is reduced and $\eta$ is its generic point, the unique closed subscheme of $S$ containing $\eta$ is $S$ (\cref{scheme reduced scheme structure given by nilradical}), so $u=v$.
\end{proof}
\begin{proposition}\label{scheme morphism cancelled by separated if}
Let $\mathcal{P}$ be a property of morphisms of schemes, and consider the following properties:
\begin{enumerate}
\item[(\rmnum{1})] If $j:X\to Y$ is a closed immersion and $g:Y\to Z$ is a morphism possessing the property $\mathcal{P}$, then $g\circ j$ possesses the property $\mathcal{P}$.
\item[(\rmnum{2})] If $f:X\to X'$ and $g:Y\to Y'$ are two $S$-morphisms possessing the property $\mathcal{P}$, then $f\times_Sg$ possesses the property $\mathcal{P}$.
\item[(\rmnum{3})] If the composition $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ possesses the property $\mathcal{P}$ and if $g$ is separated, then $f$ possesses the property $\mathcal{P}$.
\item[(\rmnum{4})] If $f:X\to Y$ possesses the property $\mathcal{P}$, so does $f_{\red}$. 
\end{enumerate}
Then, (\rmnum{3}) and (\rmnum{4}) are concequences of (\rmnum{1}) and (\rmnum{2}).
\end{proposition}
\begin{proof}
For the property (\rmnum{3}), the demonstration is similar to \cref{scheme morphism arbitrary calcelled if}, with the fact that $\Gamma_f$ is a closed immersion by \cref{scheme morphism to separated graph is closed}. On the other hand, in the commutative diagram
\[\begin{tikzcd}
X_{\red}\ar[d]\ar[r,"f_{\red}"]&Y_{\red}\ar[d]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
the vertical morphisms are closed immersions, so we see that (\rmnum{4}) is a consequence of (\rmnum{1}) and (\rmnum{3}), observing that a closed immersion is separated in view of the definition and \cref{scheme monomorphism iff diagonal isomorphism}.
\end{proof}
\begin{proposition}\label{scheme morphism cancelled by separated eg}
Let $f:X\to Y$ be a morphism and $g:Y\to Z$ be a separated morphism. Suppose that $g\circ f$ possesses one of the following properties:
\begin{enumerate}
\item[(\rmnum{1})] universally closed;
\item[(\rmnum{2})] a closed immersion;
\end{enumerate}
Then $f$ possesses the same property.
\end{proposition}
\begin{proof}
In fact, these properties satisfy the conditions (\rmnum{1}) and (\rmnum{2}) in \cref{scheme morphism cancelled by separated if}.
\end{proof}
\begin{corollary}\label{scheme morphism closed stable under target product}
Let $Z$ be a separated $S$-scheme and $f:X\to Y$, $g:X\to Z$ be two $S$-morphisms. If $f$ is universally closed (resp. a closed immersion), so is $(f,g)_S:X\to Y\times_SZ$.
\end{corollary}
\begin{proof}
The morphism $j$ factors into
\[\begin{tikzcd}
X\ar[r,"{(f,g)_S}"]&Y\times_SZ\ar[r,"p"]&Y
\end{tikzcd}\]
and the projection $p:Y\times_SZ\to Y$ is a separate morphism by \cref{scheme morphism separated permanence prop} (which do not use \cref{scheme morphism closed stable under target product}), so it suffices to apply \cref{scheme morphism cancelled by separated eg}.
\end{proof}
\begin{remark}
From the diagram in \cref{scheme morphism cartesian square of kernel}, we conclude that a morphism $Y\to S$ is separated if and only if the following equivalent conditions holds:
\begin{enumerate}
\item[(\rmnum{1})] The diagonal morphism $\Delta_{Y/S}$ is a closed immersion.
\item[(\rmnum{2})] For every $S$-scheme $X$ and for any two $S$-morphisms $f,g:X\to Y$, the kernel $\ker(f,g)$ is a closed subscheme of $X$.
\item[(\rmnum{3})] For every $S$-scheme $X$ and for any $S$-morphism $f:X\to Y$, the graph morphism $\Gamma_f$ is a closed immersion.
\end{enumerate}
Also, if the conclusion in \cref{scheme morphism cancelled by separated eg} holds for the morphisms $\Delta_Y:Y\to Y\times_SY$ and $p_2:Y\times_SY\to Y$, then $\Delta_Y$ is a closed immersion so $Y$ is separated over $S$.
\end{remark}
\subsection{Criterion of separated morphisms}
\begin{proposition}[\textbf{Propoerties of Seperated Morphisms}]\label{scheme morphism separated permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] Any radical morphism (and in particular any monomorphism, hence any immersion) is a separated morphism.
\item[(\rmnum{2})] The composition of two separated morphisms is separated.
\item[(\rmnum{3})] If $f:X\to X'$ and $g:Y\to Y'$ are two separated $S$-morphisms, $f\times_Sg$ is separated.
\item[(\rmnum{4})] If $f:X\to Y$ is a separated $S$-morphism, the $S'$-morphism $f_{(S')}$ is separated for any base change $S'\to S$.
\item[(\rmnum{5})] If the composition $g\circ f$ of two morphisms is separated, then $f$ is separated.
\item[(\rmnum{6})] For a morphism $f$ to be separated, it is necessary and sufficient that $f_{\red}$ is separated.    
\end{enumerate}
\end{proposition}
\begin{proof}
A radical morphism, its diagonal morphism is surjective (\cref{scheme radical morphism def}), so it is separated. If $f:X\to Y$, $g:Y\to Z$ are two morphisms, the diagram
\[\begin{tikzcd}
X\ar[rr,"\Delta_{X/Z}"]\ar[rd,swap,"\Delta_{X/Y}"]&&X\times_ZX\\
&X\times_YX\ar[ru,swap,"j"]
\end{tikzcd}\]
where $j$ is the canonical immersion in (\ref{scheme product over base cochange and diagonal morphism-1}), is commutative. If $f$ and $g$ are separated, $\Delta_{X/Y}$ is a closed immersion and $j$ is a closed immersion by \cref{scheme product over separate base cochange and diagonal canonical closed}, so $\Delta_{X/Z}$ is closed, which proves (\rmnum{2}). With (\rmnum{1}) and (\rmnum{2}), conditions (\rmnum{3}) and (\rmnum{4}) are equivalent, and it suffices to prove (\rmnum{4}). Now by transitivity, $X_{(S')}\times_{Y_{(S')}}X_{(S')}$ is identified with $(X\times_YX)\times_YY_{(S')}$, and the diagonal morphism $\Delta_{X_{(S')}}$ is identified with $\Delta_X\times_Y1_{Y_{(S')}}$. The assertion then follows from \cref{scheme immersion stable under base change}.\par
To prove (\rmnum{5}), consider the factorization
\[\begin{tikzcd}
X\ar[r,"\Gamma_f"]&X\times_ZY\ar[r,"p_2"]&Y
\end{tikzcd}\]
of $f$, and note that $p_2=(g\circ f)\times_Z1_Y$; the hypothesis that $g\circ f$ is separated implies $p_2$ is separated by (\rmnum{3}), and as $\Gamma_f$ is an immersion, $\Gamma_f$ is separated by (\rmnum{1}), hence $f$ is separated by (\rmnum{2}). Finally, for (\rmnum{6}), we recall that the schemes $X_{\red}\times_{Y_{\red}}X_{\red}$ and $X_{\red}\times_YX_{\red}$ is canonically identified (\cref{scheme associated red and product relation}); if $j:X_{\red}\to X$ is the canonical injection, the diagram
\[\begin{tikzcd}
X_{\red}\ar[d,swap,"j"]\ar[r,"\Delta_{X_{\red}}"]&X_{\red}\times_YX_{\red}\ar[d,"j\times_Yj"]\\
X\ar[r,"\Delta_X"]&X\times_YX
\end{tikzcd}\]
is commutative, and the assertion follows from the fact that the vertical morphisms are homeomorphisms.
\end{proof}
\begin{corollary}\label{scheme morphism separated restriction is separated}
If $f:X\to Y$ is separated, the restriction of $f$ to any subscheme of $X$ is separated.
\end{corollary}
\begin{proof}
This follows from \cref{scheme morphism separated permanence prop}(\rmnum{1}) and (\rmnum{3}).
\end{proof}
\begin{corollary}\label{scheme separated base change is separated}
If $X$ and $Y$ are $S$-schemes and $Y$ is separated over $S$, $X\times_SY$ is separated over $X$.
\end{corollary}
\begin{proof}
This is a particular case of \cref{scheme morphism separated permanence prop}(\rmnum{4}).
\end{proof}
\begin{proposition}\label{scheme separated iff on finite closed cover}
Let $X$ be a scheme and suppose that $(X_i)_{1\leq i\leq n}$ is a finite covering of $X$ by closed subsets. Let $f:X\to Y$ be a morphism and for each $i$ let $Y_i$ be a closed subset of $Y$ such that $f(X_i)\sub Y_i$. Consider the reduced subscheme structures on each $X_i$ and $Y_i$ and let $f_i:X_i\to Y_i$ be the restriction of $f$ on $X_i$. Then for $f$ to be separated, it is necessary and sufficient that each $f_i$ is separated.
\end{proposition}
\begin{proof}
The necessity follows from \cref{scheme morphism separated permanence prop}(\rmnum{1}), (\rmnum{2}) and (\rmnum{5}). Conversely, if each $f_i$ is separated, then the restriction $X_i\to Y$ of $f$ is separated (\cref{scheme morphism separated permanence prop}). If $p_1,p_2$ are the projections of $X\times_YX$, the subspace $\Delta_{X_i}(X_i)$ is identified with the subspace $\Delta_X(X)\cap p_1^{-1}(X_i)$ of $X\times_YX$ (\cref{scheme diagonal of subscheme char}). This subspace is closed in $X\times_YX$ by hypothesis, and their union is $\Delta_X(X)$, so $\Delta_X$ is closed and $f$ is separated. 
\end{proof}
Suppose in particular that $X_i$ are the irreducible components of $X$; then we can suppose that each $Y_i$ is a irreducible closed subset of $Y$ (\cref{topo space irreducible under continuous map}); \cref{scheme separated iff on finite closed cover} then enable us to reduce the separation problem to integral schemes.
\begin{proposition}\label{scheme morphism separated local on target}
Let $(Y_\lambda)$ be an open covering of a scheme $Y$. For a morphism $f:X\to Y$ to be separated, it is necessary and sufficient that each of the restriction $f_\lambda:f^{-1}(Y_\lambda)\to Y_\lambda$ is separated.
\end{proposition}
\begin{proof}
If we set $X_\lambda=f^{-1}(Y_\lambda)$ and identify $X_\lambda\times_YX_\lambda$ and $X_\lambda\times_{Y_\lambda}X_\lambda$, the $X_\lambda\times_YX_\lambda$ form an open covering of $X\times_YX$. If $Y_{\lambda\mu}=Y_\lambda\cap Y_\mu$ and $X_{\lambda\mu}=X_\lambda\cap X_\mu=f^{-1}(Y_{\lambda\mu})$, then $X_\lambda\times_YX_\mu$ is identified with $X_{\lambda\mu}\times_{Y_{\lambda\mu}}X_{\lambda\mu}$ by \cref{scheme product inverse image of base open}, hence with $X_{\lambda\mu}\times_YX_{\lambda\mu}$, and finally to an open subset of $X_\lambda\times_YX_\lambda$, which establishes our assertion (\cref{scheme immersion open covering prop}).
\end{proof}
\cref{scheme morphism separated local on target} allows, by taking a covering of $Y$ byopen affines, to reduce the study of separated morphisms to separated morphisms with values in affine schemes.
\begin{proposition}\label{scheme separated over affine iff intersection of affine open cover}
Let $Y$ be an affine scheme, $X$ be a scheme, and $(U_\alpha)$ be an affine open covering of $X$. For a morphism $f:X\to Y$ to be separated, it ie necessary and sufficient that, for any couple of indices $(\alpha,\beta)$, the intersection $U_\alpha\cap U_\beta$ is affine, and the ring $\Gamma(U_\alpha\cap U_\beta,\mathscr{O}_X)$ is generated by the images of $\Gamma(U_\alpha,\mathscr{O}_X)$ and $\Gamma(U_\beta,\mathscr{O}_X)$.
\end{proposition}
\begin{proof}
The open sets $U_\alpha\times_YU_\beta$ form an open cover of $X\times_YX$ (\cref{scheme product inverse image of base open}). Let $p,q$ be the projections of $X\times_YX$, we have
\[\Delta_X^{-1}(U_\alpha\times_YU_\beta)=\Delta_X^{-1}(p^{-1}(U_\alpha)\cap q^{-1}(U_\beta))=U_\alpha\cap U_\beta.\]
It therefore amounts to show that the restriction of $\Delta_X$ to $U_\alpha\cap U_\beta$ is a closed immersion into $U_\alpha\times_YU_\beta$. But this restriction is just $(j_\alpha,j_\beta)_Y$, where $j_\alpha$ (resp. $j_\beta$) is the canonical injection of $U_\alpha\cap U_\beta$ to $U_\alpha$ (resp. to $U_\beta$). As $U_\alpha\times_YU_\beta$ is an affine scheme with ring isomorphic to $\Gamma(U_\alpha,\mathscr{O}_X)\otimes_{\Gamma(Y,\mathscr{O}_Y)}\Gamma(U_\beta,\mathscr{O}_X)$, we see that $U_\alpha\cap U_\beta$ is a closed subscheme of $U_\alpha\times_YU_\beta$ if and only if it is affine and the ring homomorphism
\[\Gamma(U_\alpha,\mathscr{O}_X)\otimes_{\Gamma(Y,\mathscr{O}_Y)}\Gamma(U_\beta,\mathscr{O}_X)\to\Gamma(U_\alpha\cap U_\beta,\mathscr{O}_X),\quad h_\alpha\otimes h_\beta\to h_\alpha h_\beta\]
is surjective (\cref{scheme affine closed subscheme is affine}), which proves our assertion.
\end{proof}
\begin{corollary}\label{scheme separated over affine iff affine}
Let $Y$ be an affine scheme. For a morphism $f:X\to Y$ to be separated, it is necessary and sufficient that $X$ is separated.
\end{corollary}
\begin{proof}
In fact, the criterion in \cref{scheme separated over affine iff intersection of affine open cover} does not depend on $f$.
\end{proof}
\begin{corollary}\label{scheme morphism separated and preimage of separated affine}
For a morphism $f:X\to Y$ to be separated, it is necessary that for any open affine subscheme $U$ that is separated, the open subscheme $f^{-1}(U)$ is separated, and it suffices that this true for every affine open subset $U\sub Y$.
\end{corollary}
\begin{proof}
The necessity follows from \cref{scheme separated iff on finite closed cover} and \cref{scheme morphism separated permanence prop}(\rmnum{2}). The sufficiency follows from \cref{scheme morphism separated local on target} and \cref{scheme separated over affine iff affine}.
\end{proof}
\begin{proposition}\label{scheme morphism separated preimage of affine open in affine open}
Let $Y$ be a separated scheme and $f:X\to Y$ be a morphism. For any affine open $U$ of $X$ and any affine open $V$ of $Y$, $U\cap f^{-1}(V)$ is affine.
\end{proposition}
\begin{proof}
Let $p_1,p_2$ be the projections of $X\times_{\Z}Y$. Using the universal property of $\Gamma_f$, the subspace $U\cap f^{-1}(V)$ can be characterized by
\[\Gamma_f(U\cap f^{-1}(V))=\Gamma_f(X)\cap p_1^{-1}(U)\cap p_2^{-1}(V)\]
Now $p_1^{-1}(U)\cap p_2^{-1}(V)$ is idnetified with the product $U\times_{\Z}V$, and therefore is affine; as $\Gamma_f(X)$ is closed in $X\times_{\Z}Y$ (\cref{scheme morphism to separated graph is closed}), $\Gamma_f(X)\cap p_1^{-1}(U)\cap p_2^{-1}(V)$ is closed in $U\times_{\Z}V$, hence also affine. The assertion then follows from the fact that $\Gamma_f$ is a closed immersion and \cref{scheme affine closed subscheme is affine}.
\end{proof}
\begin{example}\label{scheme nonseparated eg}
The scheme in \cref{scheme P^1 glueing construction} is separated. In fact, for the covering $(X_1,X_2)$ of $X$ by affine opens, $X_1\cap X_2=U_{12}$ is affine and $\Gamma(U_{12},\mathscr{O}_X)$, the fraction ring of the form $f(s)/s^m$ where $f\in K[s]$, is generated by $K[s]$ and $1/s$, so the conditions in \cref{scheme separated over affine iff intersection of affine open cover} are satisfied.\par
With the same choice of $X_1$, $X_2$, $U_{12}$ and $U_{21}$ as in \cref{scheme P^1 glueing construction}, take this time for $u_{12}$ the isomorphism which sends $f(s)$ to $f(t)$; this time we obtain by gluing together a non-separated integral scheme $X$, because the first condition of \cref{scheme separated over affine iff intersection of affine open cover} holds, but the second fails. It is immediate here that $\Gamma(X,\mathscr{O}_X)\to\Gamma(X_1,\mathscr{O}_X)=K[s]$ is an isomorphism; the inverse isomorphism defines a morphism $f:X\to\Spec(K[s])$ which is surjective, and for any $y\in\Spec(K[s])$ such that $\p_y\neq(0)$, $f^{-1}(y)$ is reduced to a singleton, but for $\p_y=(0)$, $f^{-1}(y)$ consists of two distinct points (we say that $X$ is the "affine line on $K$, where the point $0$ is doubled").\par
We can also give examples where neither of the two conditions of \cref{scheme separated over affine iff intersection of affine open cover} does not hold. Note first that in the prime spectrum $Y$ of the ring of polynomials $A=K[s,t]$ in two indeterminates over a field $K$, the open set $U=D(s)\cup D(t)$ is not an affine open set. Indeed, if $z$ is a section of $\mathscr{O}_Y$ over $U$, there exist two integers $m,n\geq 0$ such that $s^mz$ and $t^nz$ are the restrictions to $U$ of polynomials in $s$ and $t$ (\cref{scheme affine qcoh sheaf on qc open char}), which is obviously only possible if the section $z$ extends into a section over the entire space $Y$, identified with a polynomial in $s$ and $t$. If $U$ were affine, the canonical injection $U\to Y$ would therefore be an isomorphism by \cref{scheme affine morphism char by ring homomorphism}, which is absurd since $U\neq Y$.\par
This being so, let us take two affine schemes $Y_1$, $Y_2$, with rings $A_1=K[x_1,t_1]$, $A_2=K[s_2,t_2]$. Let $U_{12}=D(s_1)\cup D(t_1)$, $U_{21}=D(s_2)\cup D(t_2)$, and let $u_{12}$ be the restriction to $U_{21}$ of the isomorphism $Y_2\to Y_1$ corresponding to the isomorphism of rints, which sends $f(s_1,t_1)$ to $f(s_2,t_2)$. We thus obtain an example where none of the conditions of \cref{scheme affine morphism char by ring homomorphism} is satisfied (the integral scheme thus obtained is called "affine plane over $K$, where point $0$ is doubled").
\end{example}
\section{Finiteness conditions for morphisms}
We study, in this section, various "finiteness conditions" for a morphism $f:X\to Y$ of schemes. There are basically two notions of "global finiteness" on $X$: quasi-compactness and quasi-separateness. On the other hand, there is two notions of "local finiteness" on $X$: locally of finite type and locally of finite presentation. By combining these local notions with the previous global notions, we obtain the notions of morphism of finite type and of morphism of finite presentation.
\subsection{Quasi-compact and quasi-separated morphisms}
We say a morphism $f:X\to Y$ is \textbf{quasi-compact} is for any quasi-compact open subset $U$ of $Y$, the inverse image $f^{-1}(U)$ is quasi-compact. It is clear that this condition is purely topological, and if $X$ is Noetherian, then any morphism $f:X\to Y$ is quasi-compact. We say a $Y$-scheme $X$ is \textbf{quasi-compact over $\bm{Y}$} if its structural morphism is quasi-compact.\par
If $\mathcal{B}$ is a base of $Y$ formed by quasi-compact open sets (for example, affine opens), for a morphism $f$ to be quasi-compact, it is necessary and sufficient that for any open set $V\in\mathcal{B}$, $f^{-1}(V)$, since any quasi-compact open set of $Y$ is a finite union of open sets in $\mathcal{B}$.\par
If $f:X\to Y$ is a quasi-compact morphism, it is clear that for any open set $V$ of $Y$, the restriction $f^{-1}(V)\to V$ of $f$ is quasi-compact. Conversely, if $(U_\alpha)$ is an open covering of $Y$ and $f:X\to Y$ is a morphism such that the restriction $f^{-1}(U_\alpha)\to U_\alpha$ is quasi-compact, then $f$ is quasi-compact, since there exist a basis of quasi-compact open sets for $Y$, each set of which is contained in at least one of the $U_\alpha$. We conclude that if $f:X\to Y$ is an $S$-morphism of $S$-schemes, and if there is an open covering $(S_\lambda)$ of $S$ such that the restrictions $\varphi^{-1}(S_\lambda)\to\psi^{-1}(S_\lambda)$ of $f$ (where $\varphi:X\to S$ and $\psi:Y\to S$ are the structural morphisms) are quasi-compact morphisms, then $f$ is quasi-compact.
\begin{proposition}\label{scheme morphism qc to s is qc}
Let $Y$ be a separated scheme. Then for a morphism $f:X\to Y$ to be quasi-compact, it is necessary and sufficient that $X$ is quasi-compact.
\end{proposition}
\begin{proof}
If $X$ is quasi-compact, it is a union of finitely many affine opens $U_i$, and for any affine open $V$ of $Y$, $U_i\cap f^{-1}(V)$ is an affine open by \cref{scheme morphism separated preimage of affine open in affine open}, hence quasi-compact; therefore $f^{-1}(V)$ is quasi-compact. Conversely, if $f$ is a quasi-compact morphism, then since $Y$ is quasi-compact open in $Y$, we see $X=f^{-1}(Y)$ is also quasi-compact.
\end{proof}
\begin{example}\label{scheme open immersion not qc}
A closed immersion is quasi-compact since a closed subset of a quasi-compact set is again quasi-compact. However, open immersions are in general not quasi-compact: the standard example is the affine scheme $X=\Spec(k[x_1,x_2,\dots])$ and consider $U=X-\{0\}$, where $0$ is the point of $X$ corresponding to the maximal ideal $(x_1,x_2,\dots)$. The canonical injection $j:U\to X$ is not quasi-compact because $U$ is not quasi-compact. To see this, consider the covering $(D(x_i))_{i\in\N}$ of $U$; for any finite subset $J$ of $\N$, the family $(D(x_i))_{i\in J}$ can not cover $U$ simply because the prime ideal $\p_J$ generated by $x_i$ with $i\in J$ is contained in $U$ but not in the union of the $D(x_i)$ for $i\in J$.
\end{example}
We say a morphism $f:X\to Y$ of schemes is \textbf{quasi-separated} (of $X$ is an \textbf{$\bm{Y}$-scheme quasi-separated over $\bm{Y}$}) if the diagonal morphism $\Delta_f:X\to X\times_YX$ is quasi-compact. A scheme $X$ is called \textbf{quasi-separated} if it is quasi-separated over $\Z$. Since a closed immersion is quasi-compact, we see any separated morphism is quasi-separated. In particular, any separated scheme is quasi-separated.
\begin{proposition}[\textbf{Properties of Quasi-Compact Morphisms}]\label{scheme morphism qc permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] An immersion $j:X\to Y$ is quasi-compact if it is closed, or $Y$ is locally Noetherian, or $X$ is Noetherian.
\item[(\rmnum{2})] The composition of two quasi-compact morphisms is quasi-compact.
\item[(\rmnum{3})] If $f:X\to Y$ is a quasi-compact $S$-morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is quasi-compact for any base change $g:S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:Y\to Y'$ is two quasi-compact $S$-morphisms, then $f\times_Sg$ is quasi-compact.
\item[(\rmnum{5})] If the composition $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ is quasi-compact, and if $f$ is quasi-separated or if $X$ is locally Noetherian, then $f$ is quasi-compact.
\item[(\rmnum{6})] For a morphism $f$ to be quasi-compact, it is necessary and sufficient that $f_{\red}$ is quasi-compact.
\end{enumerate}
\end{proposition}
\begin{proof}
Assertion (\rmnum{6}) is evident, since the quasi-compactness for a morphism only depends on the map of the underlying spaces. Also, (\rmnum{2}) follows from the definition of quasi-compactness.\par
The assertion in (\rmnum{1}) is clear if $j$ is closed; if $j$ is an immersion and $Y$ is locally Noetherian, any quasi-compact open $V$ of $Y$ is Noetherian, so $j^{-1}(V)=X\cap V\sub V$ is quasi-compact (here we identify $X$ as a subscheme of $Y$). If $X$ is Noetherian, then any morphism from $X$ is quasi-compact.\par
To prove (\rmnum{3}), we can assume that $S=Y$ by the transitivity of products; put $f'=f_{(S')}$, and let $U'$ be a quasi-compact open subset of $S'$. For any $s'\in U'$, let $T$ be an affine open neighborhood of $g(s')$ in $S$, and let $W$ be an affine open neighborhood of $s'$ contained in $U'\cap g^{-1}(T)$; it suffices to show that $f'^{-1}(W)$ is quasi-compact, or in other words, we only need to show that if $S$ and $S'$ are affine, then $X\times_SS'$ is quasi-compact. This is true because by hypothesis $X$ is a finite union of affine opens $V_j$, and $X\times_SS'$ is then the union of the affine schemes $V_j\times_SS'$, hence quasi-compact. With (\rmnum{2}) and (\rmnum{3}), asserion (\rmnum{4}) then follows.\par
We now prove (\rmnum{5}) in the case where $X$ is locally Noetherian. Put $h=g\circ f$ and let $U$ be a quasi-compact open of $Y$; $g(U)$ is then quasi-compact in $Z$ (not necessarily open), so it is contained in a finite union of quasi-compact opens $V_j$, and $f^{-1}(U)$ is contained in the union of the $h^{-1}(V_j)$, which are all quasi-compact by hypothesis. We then conclude that $f^{-1}(U)$ is a Noetherian space (\cref{topo space Noe prop}), and a fortiori quasi-compact.\par
To prove (\rmnum{5}) in the case that $g$ is quasi-separated, recall that $f$ factors into
\[\begin{tikzcd}
X\ar[r,"\Gamma_f"]&X\times_ZY\ar[r,"p_2"]&Y
\end{tikzcd}\]
where $p_2$ is identified with $(g\circ f)\times_Z1_Y$, and if $g\circ f$ is quasi-compact, so is $p_2$ by (\rmnum{3}). Finally, we have the following cartesian square (\cref{scheme morphism cartesian square with diagonal morphism})
\[\begin{tikzcd}
X\ar[r,"\Gamma_f"]\ar[d,swap,"f"]&X\times_ZY\ar[d,"f\times 1_Y"]\\
Y\ar[r,"\Delta_g"]&Y\times_ZY
\end{tikzcd}\]
as by hypothesis $\Delta_g$ is quasi-compact, $\Gamma_f$ is also quasi-compact, and by (\rmnum{2}) we conclude that $f$ is quasi-compact.
\end{proof}
\begin{proposition}\label{scheme morphism qc cancelled by surjective}
Let $f:X\to Y$, $g:Y\to Z$ be two morphisms. If $g\circ f$ is quasi-compact and $f$ is surjective, then $g$ is quasi-compact.
\end{proposition}
\begin{proof}
If fact, if $V$ is a quasi-compact open of $Z$, $f^{-1}(g^{-1}(V))$ is quasi-compact by hypothesis, and we have $g^{-1}(V)=f(f^{-1}(g^{-1}(V)))$ since $f$ is surjective, so $g^{-1}(V)$ is quasi-compact.
\end{proof}
\begin{proposition}\label{scheme morphism qs dominant char}
Let $f$ be a quasi-compact morphism of schemes.
\begin{enumerate}
\item[(a)] The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is dominant;
\item[(\rmnum{2})] for any maximal point $y\in Y$, $f^{-1}(y)\neq\emp$.
\item[(\rmnum{3})] for any maximal point $y\in Y$, $f^{-1}(y)$ contains a maximal point of $X$.
\end{enumerate} 
\item[(b)] If $f$ is dominant, for any generalizing morphism $g:Y'\to Y$, the morphism $f_{(Y')}:X_{(Y')}\to Y'$ is quasi-compact and dominant.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{3})$\Rightarrow$(\rmnum{2})$\Rightarrow$(\rmnum{1}). Suppose that $f$ is dominant and consider an affine open neighborhood $U$ of $y$; $f^{-1}(U)$ is quasi-compact, hence a union of finitely many affine opens $V_i$, and by hypothesis $y$ belongs to the closure of $f(V_i)$ in $U$. We can evidently suppose that $X$ and $Y$ are reduced. As the closure in $X$ of an irreducible component of $V_i$ is an irreducible component of $X$ (\cref{topo space subspace finite irre component prop}), we can replace $X$ by $V_i$, $Y$ by the closed reduced subscheme $\widebar{f(V_i)}\cap U$ of $U$, and we are thus reduced to proving the proposition when $X=\Spec(B)$ and $Y=\Spec(A)$ are affine and reduced. Since $f$ is dominant, $A$ is then a subring of $B$ (\cref{Spec of ring induced map prop}); the proposition then follows from the fact that any minimal prime ideal of $A$ is the intersection with $A$ of a minimal prime ideal of $B$ (\cref{ring extension minimal prime is contracted of minimal}).\par
If $f:X\to Y$ is quasi-compact and dominant, then $f'=f_{(Y')}$ is quasi-compact by \cref{scheme morphism qc permanence prop}. On the other hand, a maximal point $y'$ of $Y'$ is hypothesis lying over a maximal point $y$ of $Y$ (\cite{EGA1} new, 3.9.5); as $f^{-1}(y)$ is nonempty by (\rmnum{1}), the same holds for $f'^{-1}(y')$ (\cref{scheme fiber transitivity}), whence the conclusion.
\end{proof}
\begin{proposition}\label{scheme morphism qc closed iff specialization}
For a quasi-compact morphism $f:X\to Y$, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] The morphism $f$ is closed.
\item[(\rmnum{2})] For any $x\in X$ and any specialization $y'$ of $y=f(x)$ distinct from $y$, there exists a specialization $x'$ of $x$ such that $f(x')=y'$.
\end{enumerate}
In particular, if $f:X\to Y$ is a quasi-compact immersion, for $f$ to be a closed immersion, it is necessary and sufficient that $X$ (considered as a subspace of $Y$) contains any specializations (in $Y$) of its points.
\end{proposition}
\begin{proof}
The condition (\rmnum{2}) expresses as $f(\widebar{\{x\}})=\widebar{\{y\}}$, and is therefore a concequence of (\rmnum{1}). To show that (\rmnum{2}) implies (\rmnum{1}), consider a closed subset of $X'$ of $X$; let $Y'=\widebar{f(X')}$ and we prove that $Y'=f(X')$. Endow $X'$ and $Y'$ the reduced subscheme structure, there then exists a morphism $f':X'\to Y'$ such that the diagram
\[\begin{tikzcd}
X'\ar[r,"f'"]\ar[d]&Y'\ar[d]\\
X\ar[r,"f"]&Y
\end{tikzcd}\] 
commutes. As $f$ is quasi-compact, so is $f'$ (\cref{scheme morphism qc permanence prop}(\rmnum{1}) and (\rmnum{5})). We are then reduced to proving that if $f$ is a quasi-compact dominant morphism, then $f(X)=Y$. Now let $y'$ be a point of $y$ and let $y$ be the generic point of a irreducible component of $Y$ containing $y'$; by (\rmnum{2}), it suffices to note that $f^{-1}(y)$ is nonempty, which follows from \cref{scheme morphism qs dominant char}.
\end{proof}
\begin{proposition}[\textbf{Properties of Quasi-Separated Morphisms}]\label{scheme morphism qs permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] Any radical morphism $f:X\to Y$ (in particular, any monomorphism and any immersion) is quasi-separated.
\item[(\rmnum{2})] If $f:X\to Y$ and $g:Y\to Z$ are two quasi-separated morphisms, $g\circ f$ is quasi-separated.
\item[(\rmnum{3})] Let $X$, $Y$ be two $S$-schemes and $f:X\to Y$ be a quasi-separated $S$-morphism. Then, for any base change $g:S'\to S$, the morphism $f_{(S')}:X_{(S')}\to Y_{(S')}$ is quasi-separated.
\item[(\rmnum{4})] If $f:X\to X'$, $g:Y\to Y'$ are two quasi-separated $S$-morphisms, $f\times_Sg$ is quasi-separated.
\item[(\rmnum{5})] If the composition $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ is quasi-separated, then $f$ is quasi-separated; if moreover $f$ is quasi-compact and surjective, $g$ is also quasi-separated.
\item[(\rmnum{6})] For a morphism $f:X\to Y$ to be quasi-separated, it is necessary and sufficient that $f_{\red}$ is quasi-separated.
\end{enumerate}
\end{proposition}
\begin{proof}
The assertion (\rmnum{1}) follows from \cref{scheme morphism separated permanence prop}(\rmnum{1}). To prove (\rmnum{3}), we may reduce to the case $Y=S$, and the assertion then follows from $\Delta_{f_{(S')}}=(\Delta_f)_{(S')}$ (\cref{scheme diagonal morphism and base change}) and \cref{scheme morphism qc permanence prop}.\par
For assertion (\rmnum{2}), consider the projections $p,q$ of $X\times_YX$; if $\pi:X\times_YX\to Y$ is the structural morphism and $j=(p,q)_{Z}$, we have the following cartesian square (\cref{scheme product over base cochange and diagonal morphism-1})
\[\begin{tikzcd}
X\times_YX\ar[r,"j"]\ar[d,swap,"\pi"]&X\times_{Z}X\ar[d,"f\times_{Z}f"]\\
Y\ar[r,"\Delta_g"]&Y\times_{Z}Y
\end{tikzcd}\]
If $g$ is quasi-separated then $\Delta_g$ is quasi-compact, so $j$ is also quasi-compact by \cref{scheme morphism qc permanence prop}(\rmnum{3}). If $f$ is quasi-separated, $\Delta_f$ is quasi-compact and so is $j\circ\Delta_f$, which equals to $\Delta_{g\circ f}$. With these, assertion (\rmnum{4}) then follows from (\rmnum{2}) and (\rmnum{3}).\par
Suppose now that $g\circ f$ is quasi-separated. Then with the preceding notations, $\Delta_{g\circ f}=j\circ\Delta_f$ is quasi-compact, so $\Delta_f$ is quasi-compact by \cref{scheme morphism qc permanence prop}(\rmnum{5}) and $f$ is then quasi-separated. If moreover $f$ is quasi-compact and surjective, $f\times_{\Z}f$ is also quasi-compact by \cref{scheme morphism qc permanence prop}(\rmnum{4}), and we conclude that $\Delta_g\circ\pi\circ\Delta_f$ is quasi-compact. Since $\pi\circ\Delta_f=f$ is surjective, it follows from \cref{scheme morphism qc permanence prop}(\rmnum{5}) that $\Delta_g$ is quasi-compact, so $g$ is quasi-separated.\par
Finally, for a morphism $f:X\to Y$, consider the following diagram
\[\begin{tikzcd}
X_{\red}\ar[d,swap,"j_X"]\ar[r,"{f_{\red}}"]&Y_{\red}\ar[d,"j_Y"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
where $j_X$ and $j_Y$ are surjective closed immersions, and so quasi-separated and quasi-compact. From the equality $f\circ j_X=j_Y\circ f_{\red}$ and (\rmnum{5}), we see $f$ is quasi-separated if and only if $f_{\red}$ is quasi-separated.
\end{proof}
\begin{corollary}\label{scheme morphism from into qs prop}
Let $X$ and $Y$ be schemes.
\begin{enumerate}
\item[(\rmnum{1})] If $f$ is quasi-separated, any morphism $f:X\to Y$ is quasi-separated.
\item[(\rmnum{2})] If $Y$ is quasi-separated, for a morphism $f:X\to Y$ to be quasi-separated, it is necessary and sufficient that the scheme $X$ is quasi-separated.
\item[(\rmnum{3})] Let $X$ be a quasi-compact and $Y$ be quasi-separated. Then any morphism $f:X\to Y$ is quasi-compact. 
\end{enumerate}
\end{corollary}
\begin{proof}
To show (\rmnum{1}) we only need to note that any morphism $f:X\to Y$ is a $\Z$-morphism, and if $X$ is quasi-separated, then for any morphism $f:X\to Y$ the composition $X\to Y\to\Spec(\Z)$ is quasi-separated, so $f$ is quasi-separated by \cref{scheme morphism qs permanence prop}(\rmnum{5}). Similarly, assertion (\rmnum{2}) follows from \cref{scheme morphism qs permanence prop}(\rmnum{2}) and (\rmnum{5}). Assertion (\rmnum{3}) follows from \cref{scheme morphism qc permanence prop}(\rmnum{5}).
\end{proof}
\begin{proposition}\label{scheme qs local on target}
Let $f:X\to Y$ be a morphism and $(U_\alpha)$ be a covering of $Y$ by open subschemes that are quasi-separated. For $f$ to be quasi-separated, it is necessary and sufficient that the open subschemes $f^{-1}(U_\alpha)$ is quasi-separated.
\end{proposition}
\begin{proof}
The inverse image of $U_\alpha$ in $X\times_YX$ is $X_\alpha\times_{U_\alpha}X_\alpha$, where $X_\alpha=f^{-1}(U_\alpha)$, and the restriction $X_\alpha\to X_\alpha\times_{U_\alpha}X_\alpha$ of $\Delta_f$ is just $\Delta_{f_\alpha}$, where $f_\alpha$ is the restriction $X_\alpha\to U_\alpha$ of $f$. Since quasi-compactness is local on target, we see $f$ is quasi-separated if and only if each $f_\alpha$ is. But by hypothesis $U_\alpha$ is separated, so the conclusion follows from \cref{scheme morphism from into qs prop}(\rmnum{2}).
\end{proof}
By \cref{scheme qs local on target}, to verify a morphism is quasi-separated, it suffices to verify the quasi-separateness of some subschemes. This can be done by the following simple criteria:
\begin{proposition}\label{scheme qs iff intersection of qc open}
Let $X$ be a scheme and $(U_\alpha)$ be a covering of $X$ formed by quasi-compact open subsets. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is a quasi-separated scheme.
\item[(\rmnum{2})] For any quasi-compact open subset $U$ of $X$, the canonical injection $U\to X$ is quasi-compact (that is, $U$ is retrocompact in $X$).
\item[(\rmnum{3})] The intersection of two quasi-compact open subsets of $X$ is quasi-compact.
\item[(\rmnum{4})] For any couple of indices $(\alpha,\beta)$, the intersection $U_\alpha\cap U_\beta$ is quasi-compact.
\end{enumerate}
\end{proposition}
\begin{proof}
Properties (\rmnum{2}) and (\rmnum{3}) are equivalent by the definition of quasi-compactness. As a quasi-compact open is a finie union of affine open sets, for two quasi-compact open subsets $U$, $V$ of $X$, $U\times_{\Z}V$ is a quasi-compact open subset of $X\times_{\Z}X$ (\cref{scheme product inverse image of base open}), with inverse image $U\cap V$ under $\Delta_X$, hence (\rmnum{1}) implies (\rmnum{3}). It is clear that (\rmnum{3}) implies (\rmnum{4}); finally, if (\rmnum{4}) holds, the $U_\alpha\times_{\Z}U_\beta$ form a covering of $X\times_{\Z}X$ by quasi-compact open sets and the inverse image of $U_{\alpha}\times_{\Z}U_\beta$ under $\Delta_X$ is $U_\alpha\cap U_\beta$, hence quasi-compact. It then follows that $\Delta_X$ is quasi-compact, so (\rmnum{4}) implies (\rmnum{1}).
\end{proof}
\begin{corollary}\label{scheme local Noe is qs}
Any locally Noetherian scheme $X$ is quasi-separated, and any morphism $f:X\to Y$ is then quasi-separated.
\end{corollary}
\begin{proof}
It suffices to note that any quasi-compact open subset of $X$ is Noetherian, so $X$ is quasi-separated by \cref{scheme qs iff intersection of qc open} and any morphism $f:X\to Y$ is quasi-separated by \cref{scheme qs local on target}, since any open subscheme of $X$ is again locally Noetherian.
\end{proof}
\begin{proposition}\label{scheme morphism qc and qs descent by surjective qc base change}
Let $f:X\to Y$ be a morphism and $g:Y'\to Y$ be a base change that is surjective and quasi-compact. Put $f'=f_{(Y')}$ and consider the following properties:
\begin{enumerate}
\item[(\rmnum{1})] quasi-compact;
\item[(\rmnum{2})] quasi-separated.
\end{enumerate}
Then if $\mathcal{P}$ denotes one of these properties and $f'$ possesses the property $\mathcal{P}$, then $f$ possesses the property $\mathcal{P}$.
\end{proposition}
\begin{proof}
Let $g':X'\to X$ be the cannical projection, which is surjective and quasi-compact (\cref{scheme surjective stable under base change} and \cref{scheme morphism qc permanence prop}(\rmnum{3})). If $f'$ is quasi-compact, so is $g\circ f'$ and since $f\circ g'=g\circ f'$ we conclude that $f$ is quasi-compact by \cref{scheme morphism qc permanence prop}(\rmnum{5}).\par
Now assume that $f'$ is quasi-separated. We have $X'\times_{Y'}X'=(X\times_YX)_{(Y')}$ and $\Delta_{f'}=(\Delta_f)_{(Y')}$. The projection $X'\times_{Y'}X'\to X\times_YX$ is quasi-compact and surjective by the same reasoning, and we can apply (\rmnum{1}) to the morphism $\Delta_f$. Since by hypothesis $\Delta_{f'}$ is quasi-compact, we conclude that $\Delta_f$ is quasi-compact, so $f$ is quasi-separated.
\end{proof}
\begin{proposition}\label{scheme morphism qc and qs finite coproduct}
Let $f_i:X_i\to Y$ be a finite family of morphisms and $f:X\to Y$ be their coproduct. Then for $f$ to be quasi-compact (resp. quasi-separated), it is necessary and sufficient that each $f_i$ is quasi-compact (resp. quasi-separated).
\end{proposition}
\begin{proof}
The assertion about quasi-compactness follows from definition. We also note that $X\times_YX$ is the coproduct of that $X_i\times_YX_j$, and $\Delta_f$ is the morphism that coincides with $\Delta_{f_i}$ on each $X_i$, so the assertion for quasi-separatedness also follows.
\end{proof}
\begin{theorem}\label{scheme qcqs qcoh extension by invertible sheaf}
Let $X$ be a quasi-compact and quasi-separated scheme, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, $s$ be a section over $X$, $X_s$ the open subset of $x\in X$ such that $s(x)\neq 0$, and $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module.
\begin{enumerate}
\item[(a)] If $t\in\Gamma(X,\mathscr{F})$ is such that $t|_{X_s}=0$, there exists $n>0$ such that $t\otimes s^{\otimes n}=0$.
\item[(b)] For any section $t\in\Gamma(X_s,\mathscr{F})$, there exists an integer $n>0$ such that $t\otimes s^{\otimes n}$ can be extended to a section $t'\in\Gamma(X,\mathscr{F}\otimes\mathscr{L}^{\otimes n})$.
\end{enumerate} 
\end{theorem}
\begin{proof}
As the space $X$ is a finite union of affine opens $U_i$ such that $\mathscr{L}|_{U_i}$ is isomorphic to $\mathscr{O}_X|_{U_i}$, we can assume that $X$ is affine and $\mathscr{L}=\mathscr{O}_X$. The assertion (a) then follows from \cref{scheme affine qcoh sheaf on qc open char}(\rmnum{4}).\par
Now let $t$ be a sectin of $\mathscr{F}$ over $X_s$. Since $\mathscr{L}|_{U_i}$ is isomorphic to $\mathscr{O}_X|_{U_i}$, the restriction $(t\otimes s^{\otimes n})|_{U_i\cap X_s}$ is identified with $(t|_{U_i\cap X_s})(s|_{U_i\cap X_s})^n$ under the isomorphism $(\mathscr{F}\otimes\mathscr{L}^{\otimes n})|_{U_i}\cong\mathscr{F}|_{U_i}$. We then conclude from \cref{scheme affine qcoh sheaf on qc open char}(\rmnum{4}) that there exists an integer $n\geq 0$ such that for each $i$, $(t\otimes s^{\otimes n})|_{U_i\cap X_s}$ extends to a section $t_i$ of $\mathscr{F}\otimes\mathscr{L}^{\otimes n})$ over $U_i$. Let $t_{ij}$ be the restriction of $t_i$ to $U_i\cap U_j$; by definition we have $(t_{ij}-t_{ji})|_{X_s\cap U_i\cap X_j}=0$. Since $X$ is quasi-separated, $U_i\cap U_j$ is quasi-compact, so by \cref{scheme affine qcoh sheaf on qc open char}(\rmnum{4}) there exists an integer $m\geq 0$ such that $(t_{ij}-t_{ji})\otimes s^{\otimes m}=0$. The sections $t_i\otimes s^{\otimes m}$ then glue together to give a section $t'\in\Gamma(X,\mathscr{F}\otimes\mathscr{L}^{\otimes(n+m)})$, which induces $t_i\otimes s^{\otimes m}$ over each $U_i$, and hence induces $t\otimes s^{\otimes(n+m)}$ over $X_s$.
\end{proof}
\begin{corollary}\label{scheme qcqs section of qcoh over X_s char}
With the hypotheses of \cref{scheme qcqs qcoh extension by invertible sheaf}, consider the ring $A=\Gamma_*(\mathscr{L})$ and the graded $A$-module $M=\Gamma_*(\mathscr{F};\mathscr{L})$ of type $\Z$. Then for each $s\in A_n$, there exists a canonical isomorphism $\Gamma(X_s,\mathscr{F})\cong M_{(s)}$, where $M_{(s)}=(M_s)_0$ is the degree zero part of the localization $M_s$.
\end{corollary}
\begin{proof}
With the notations of \cref{scheme qcqs qcoh extension by invertible sheaf}(b), we see that any element $t\in\Gamma(X_s,\mathscr{F})$ corresponds to an element $t'/s^n$ in $M_{(s)}$, which is independent of the integer $n$ and the chosen extension $t'$, in view of \cref{scheme qcqs qcoh extension by invertible sheaf}(a). It is immediate that this defines a homomorphism, and is bijective.
\end{proof}
\begin{corollary}\label{scheme qcqs qcoh section over X_s char}
Let $X$ be a quasi-compact and quasi-separated scheme and $\mathscr{F}$ a quasi-coherent $\mathscr{O}_X$-module. Then if $A=\Gamma(X,\mathscr{O}_X)$ and $M=\Gamma(X,\mathscr{F})$, the $A_s$-module $\Gamma(X_s,\mathscr{F})$ is canonically isomorphic to $M_s$.
\end{corollary}
\begin{proof}
This is a special case of \cref{scheme qcqs section of qcoh over X_s char}, by taking $\mathscr{L}=\mathscr{O}_X$.
\end{proof}
\begin{proposition}\label{scheme qc qcoh ft ideal power annihilated if supp}
Let $X$ be a quasi-compact scheme, $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module of finite type, and $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_X$ of finite type such that $\supp(\mathscr{F})$ is contained in $\supp(\mathscr{O}_X/\mathscr{I})$. Then there exists an integer $n\geq 0$ such that $\mathscr{I}^n\mathscr{F}=0$.
\end{proposition}
\begin{proof}
As $X$ is a finite union of affine open subsets, we may assume that $X=\Spec(A)$ is affine. Then $\mathscr{F}=\widetilde{M}$ and $\mathscr{I}=\tilde{\a}$, where $M$ is a finitely generated $A$-module and $\a$ is a finitely generated ideal of $A$, and
\[\supp(\mathscr{F})=\supp(M)=V(\Ann(M)),\quad \supp(\mathscr{O}_X/\mathscr{I})=\supp(A/\a)=V(\a).\]
By hypothesis we have $V(\Ann(M))\sub V(\a)$, so $\a\sub\sqrt{\Ann(M)}$. Since $\a$ is finitely generated, there exists an integer $n\geq 0$ such that $\a^n\sub\Ann(M)$, and therefore $\mathscr{I}^n\mathscr{F}=\widetilde{\a^nM}=0$.
\end{proof}
\begin{corollary}\label{scheme qc qcoh ft direct image of inverse prop}
Under the hypothesis of \cref{scheme qc qcoh ft ideal power annihilated if supp}, there exists a closed subscheme $Y$ of $X$ with underlying space $\supp(\mathscr{O}_X/\mathscr{I})$ such that, if $j:Y\to X$ is the canonical injection, we have $\mathscr{F}=j_*(j^*(\mathscr{F}))$. 
\end{corollary}
\begin{proof}
Note that the support of $\mathscr{O}_X/\mathscr{I}$ and $\mathscr{O}_X/\mathscr{I}^n$ are the same because if $\mathscr{I}_x=\mathscr{O}_{X,x}$, we also have $\mathscr{I}_x^n=\mathscr{O}_{X,x}$, and on the other hand we have $\mathscr{I}_n^x\sub\mathscr{I}_x$ for each $x\in X$. In view of \cref{scheme qc qcoh ft ideal power annihilated if supp}, we may then suppose that $\mathscr{I}\mathscr{F}=0$, so $\mathscr{F}$ is also an $(\mathscr{O}_X/\mathscr{I})$-module. If $Y$ is the subscheme defined by $\mathscr{I}$, the conclusion is immediate.
\end{proof}
\subsection{Morphisms of finite type and of finite presentation}
Let $f:X\to Y$ be a morphism of schemes, $x$ be a point of $X$, and $y=f(x)$. We say $f$ is \textbf{of finite type} (resp. \textbf{of finite presentation}) \textbf{at the point $\bm{x}$} if there exist an affine neighborhood $V$ of $y$ and an affine neighborhood $U$ of $x$ such that $f(U)\sub V$ and $\Gamma(U,\mathscr{O}_X)$ is a $\Gamma(V,\mathscr{O}_Y)$-algebra of finite type (resp. of finite presentation). We say $f$ is \textbf{locally of finite type} (resp. \textbf{locally of finite presentation}) if it is of finite type (resp. of finite presentation) at every point of $X$. In this case, we say the $Y$-scheme $X$ is locally of finite type (resp. locally of finite presentation) over $Y$.
\begin{lemma}\label{scheme ft fp at point affine open prop}
Let $f:X\to Y$ be a morphism of schemes, $x$ be a point of $X$, and $y=f(x)$. If there exist an affine neighborhood $V$ of $y$ and an affine neighborhood $U$ of $x$ such that $f(U)\sub V$ and $\Gamma(U,\mathscr{O}_X)$ is a $\Gamma(V,\mathscr{O}_Y)$-algebra of finite type (resp. of finite presentation), then for any affine open neighborhoods $U'$ of $x$ and $V'$ of $y$, there exist affine open neighborhoods $U_1\sub U\cap U'$ of $x$ and $V_1\sub V\cap V'$ of $y$, respectively of the form $\Spec(\Gamma(U',\mathscr{O}_X)_{s'})$ and $\Spec(\Gamma(V',\mathscr{O}_Y)_{t'})$, such that $f(U_1)\sub V_1$ and $\Gamma(U_1,\mathscr{O}_X)$ is a $\Gamma(V_1,\mathscr{O}_Y)$-algebra of finite type (resp. of finite presentation).
\end{lemma}
\begin{proof}
Let $t'\in\Gamma(V',\mathscr{O}_Y)$ such that $V_1=\Spec(\Gamma(V',\mathscr{O}_Y)_t)$ is an affine neighborhood of $y$ contained in $V\cap V'$ and choose $s'_0\in\Gamma(U',\mathscr{O}_X)$ such that $U''=\Spec(\Gamma(U',\mathscr{O}_X)_{s'_0})$ is a neighborhood of $x$ contained in $U\cap U'\cap f^{-1}(V_1)$. There then exists $s\in\Gamma(U,\mathscr{O}_X)$ such that $U_1=\Spec(\Gamma(U,\mathscr{O}_X)_{s})$ is a neighborhood of $x$ contained in $U''$. If $s''$ is the image of $s$ in $\Gamma(U'',\mathscr{O}_X)$, we then have $U_1=\Spec(\Gamma(U'',\mathscr{O}_X)_{s''})$, so there exists $s'\in\Gamma(U',\mathscr{O}_X)$ such that $U_1=\Spec(\Gamma(U',\mathscr{O}_X)_{s'})$. Now $\Gamma(U_1,\mathscr{O}_X)=\Gamma(U,\mathscr{O}_X)[1/s]$, so it is a $\Gamma(U,\mathscr{O}_X)$-algebra of finite presentation, and a fortiori a $\Gamma(V,\mathscr{O}_Y)$-algebra of finite type (resp. of finite presentation). The homomorphism $\Gamma(V,\mathscr{O}_Y)\to\Gamma(U_1,\mathscr{O}_X)$ factors into
\[\begin{tikzcd}
\Gamma(V,\mathscr{O}_X)\ar[r]&\Gamma(V_1,\mathscr{O}_Y)\ar[r]&\Gamma(U_1,\mathscr{O}_X)
\end{tikzcd}\]
If $\Gamma(U_1,\mathscr{O}_X)$ is identified with a quotient algebra $\Gamma(V,\mathscr{O}_Y)[T_1,\dots,T_n]/\a$, then it is also identified with the quotient algebra $\Gamma(V_1,\mathscr{O}_Y)[T_1,\dots,T_n]/\b$, where $\b$ is the ideal generated by $\a$. It then follows that $\Gamma(U_1,\mathscr{O}_X)$ is a $\Gamma(V_1,\mathscr{O}_Y)$-algebra of finite type (resp. finite presentation). 
\end{proof}
\begin{proposition}\label{scheme local Noe local ft iff fp}
If $Y$ is locally Noetherian, then $f:X\to Y$ is locally of finite type if and only if it is locally of finite presentation. Moreover, if this holds, then $X$ is also locally Noetherian.
\end{proposition}
\begin{proof}
The first assertion is clear since we can take $\Gamma(V,\mathscr{O}_Y)$ to be Noetherian. The second one follows because $\Gamma(U,\mathscr{O}_X)$ is then also Noetherian.
\end{proof}
\begin{proposition}[\textbf{Properties of Morphisms Locally of Finite Type}]\label{scheme morphism local ft permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] Any local immersion is locally of finite type.
\item[(\rmnum{2})] If $f:X\to Y$ and $g:Y\to Z$ are two morphisms locally of finite type, then $g\circ f$ is locally of finite type.
\item[(\rmnum{3})] If $f:X\to Y$ is an $S$-morphism locally of finite type, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is locally of finite type for any base change $g:S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:Y\to Y'$ are two $S$-morphisms locally of finite type, $f\times_Sg$ is locally of finite type.
\item[(\rmnum{5})] If the composition $g\circ f$ of two morphisms is locally of finite type, then $f$ is locally of finite type.
\item[(\rmnum{6})] If a morphism $f$ is locally of finite type, so is $f_{\red}$. 
\end{enumerate}
\end{proposition}
\begin{proof}
Assertion (\rmnum{6}) follows from the fact that if a ring homomorphism $A\to B$ is of finite type, then so is $A/\n(A)\to B/\n(B)$. Now in view of \cref{scheme morphism arbitrary calcelled if}, it suffices to prove (\rmnum{1}), (\rmnum{2}) and (\rmnum{3}). If $j:X\to Y$ is a local immersion, for any $x\in X$ there exists an affine open neighborhood $V$ of $j(x)$ in $Y$ and an affine open neighborhood $U$ of $x$ such that the restriction $U\to V$ of $j$ is a closed immersion. Then $\Gamma(U,\mathscr{O}_X)$ is a quotient ring of $\Gamma(V,\mathscr{O}_Y)$, and is therefore of finite type.\par
To establish (\rmnum{3}), we may assume that $Y=S$; let $p:X_{(S')}\to X$ and $q:X_{(S')}\to S$ be the canonical projections, $x'$ be a point of $X_{(S')}$, and $x=p(x')$, $s'=q(x')$, $s=f(p(x'))=g(q(x'))$. Let $V$ be an affine neighborhood of $s$ in $S$ and $U$ be an affine neighborhood of $x$ in $X$ such that $f(U)\sub V$ and $\Gamma(U,\mathscr{O}_X)$ is a $\Gamma(V,\mathscr{O}_S)$-algebra of finite type. Let $V'$ be an affine open neighborhood of $s'$ in $S'$ contained in $g^{-1}(V)$; then $p^{-1}(U)\cap q^{-1}(V)$ is an affine neighborhood of $x'$ and is identified with $U\times_VV'$ (\cref{scheme product inverse image of base open}). This is an affine scheme with ring $\Gamma(U,\mathscr{O}_X)\otimes_{\Gamma(V,\mathscr{O}_S)}\Gamma(V',\mathscr{O}_{S'})$; as this is a $\Gamma(V',\mathscr{O}_{S'})$-algebra of finite type, we see (\rmnum{3}) follows.\par
Finally, to prove (\rmnum{2}), consider a point $x\in X$; there exists by hypothesis an affine open neighborhood $W$ of $g(f(x))$ in $Z$ and an affine open neighborhood $V$ of $f(x)$ in $Y$ such that $g(V)\sub W$ and $\Gamma(V,\mathscr{O}_Y)$ is a $\Gamma(W,\mathscr{O}_Z)$-algebra of finite type. By \cref{scheme ft fp at point affine open prop} there exists an affine open neighborhood $V'\sub V$ of $f(x)$ and an affine open neighborhood $U\sub f^{-1}(V')$ of $x$ such that $\Gamma(V',\mathscr{O}_Y)$ is a $\Gamma(V,\mathscr{O}_Y)$-algebra of finite type and $\Gamma(U,\mathscr{O}_X)$ is a $\Gamma(V',\mathscr{O}_Y)$-algebra of finite type. We then conclude that $\Gamma(U,\mathscr{O}_X)$ is a $\Gamma(W,\mathscr{O}_Z)$-algebra of finite type, so (\rmnum{2}) follows.
\end{proof}
\begin{corollary}\label{scheme morphis local ft local Noe base change is local Noe}
Let $f:X\to Y$ be a morphism locally of finite type. For any morphism $Y'\to Y$ such that $Y'$ is locally Noetherian, $X\times_YY'$ is locally Noetherian.
\end{corollary}
\begin{proof}
This follows from \cref{scheme local Noe local ft iff fp}, since $f_{(Y')}:X\times_YY'\to Y'$ is locally of finite type by \cref{scheme morphism local ft permanence prop}.
\end{proof}
\begin{proposition}\label{scheme affine morphism local ft iff ring ft}
Let $\rho:A\to B$ be a homomorphism of rings. For the corresponding morphism $f:\Spec(B)\to\Spec(A)$ to be locally of finite type, it is necessary and sufficient that $B$ is an $A$-algebra of finite type.
\end{proposition}
\begin{proof}
This condition is clearly sufficient. Conversely, assume that $f$ is locally of finite type. Then by \cref{scheme ft fp at point affine open prop} there exists a finite cover of $\Spec(B)$ by open sets $D(g_i)$ (where $g_i\in B$) such that $B_{g_i}$ is an $A$-algebra of finite type. Since the $D(g_i)$'s cover $\Spec(B)$, we see $g_i$ generate the ring $B$, and it follows from \cref{Spec finite standard open cov on domain glue property} that $B$ is of finite type over $A$.
\end{proof}
\begin{proposition}[\textbf{Properties of Morphisms Locally of Finite Presentation}]\label{scheme morphism local fp permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})]  Any local isomorphism is locally of finite presentation.
\item[(\rmnum{2})] If two morphisms $f:X\to Y$, $g:Y\to Z$ are locally of finite presentation, so is $g\circ f$.
\item[(\rmnum{3})] If $f:X\to Y$ is an $S$-morphism locally of finite presentation, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is locally of finite presentation for any base change $g:S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:\to Y'$ are two $S$-morphisms locally of finite presentation, $f\times_Sg$ is locally of finite presentation.
\item[(\rmnum{5})] If the compositin $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ is locally of finite presentation and if $g$ is locally of finite type, then $f$ is locally of finite presentation.
\end{enumerate}
\end{proposition}
\begin{proof}
The first assertion is trivial, and to prove (\rmnum{2}), (\rmnum{3}), it suffices to replace the "algebra of finite type" in the proof of \cref{scheme morphism local ft permanence prop} by "algebra of finite presentation", and use \cref{scheme ft fp at point affine open prop}. Again, assertion (\rmnum{4}) then follows from these. For (\rmnum{5}), consider the cartesian square
\[\begin{tikzcd}
X\ar[d,swap,"f"]\ar[r,"\Gamma_f"]&X\times_ZY\ar[d,"f\times_Z1_Y"]\\
Y\ar[r,"\Delta_g"]&Y\times_ZY
\end{tikzcd}\]
If we can show that $\Delta_g$ is locally of finite presentation, then it follows from (\rmnum{3}) that $\Gamma_f$ is also locally of finite presentation. But $f$ factors into
\[\begin{tikzcd}
X\ar[r,"\Gamma_f"]&X\times_ZY\ar[r,"p_2"]&Y
\end{tikzcd}\]
and we have $p_2=(g\circ f)\times_Z1_Y$, which is locally of finite presentation by (\rmnum{4}) since $g\circ f$ is. We then deduce that $f$ is locally of finite presentation.\par
It then suffices to prove that is $g:Y\to Z$ is a morphism locally of finite type, then the diagonal morphism $\Delta_g:Y\to Y\times_ZY$ is locally of finite presentation. To do this we may assume that $Z=\Spec(A)$, $Y=\Spec(B)$, and $B$ is an $A$-algebra of finite type. The diagonal $\Delta_g$ corresponds to the homomorphism $\pi:B\otimes_AB\to B$ such that $\pi(x\otimes y)=xy$. Let $\mathfrak{I}$ be the kernel of $\pi$. We claim that $\mathfrak{I}$ is generated by the elements $1\otimes s-s\otimes 1$, where $s$ runs through a system of generators for the $A$-algebra $B$ (this then proves the claim since $B$ is of finite type over $A$). Now, it is clear that for any $x\in B$, we have $x\otimes 1-1\otimes x\in\mathfrak{I}$; on the other hand, for $x,y\in B$, we have
\[x\otimes y=xy\otimes 1+(x\otimes 1)(1\otimes y-y\otimes 1)\]
If $\sum_i(x_i\otimes y_i)\in\mathfrak{I}$, we have by definition that $\sum_ix_iy_i=0$, so
\[\sum_i(x_i\otimes y_i)=\sum_i(x_i\otimes 1)(1\otimes y_i-y_i\otimes 1).\]
Moreover, if $x=st$, then
\[x\otimes 1-1\otimes x=(s\otimes 1)(t\otimes 1-1\otimes t)+(s\otimes 1-1\otimes t)(1\otimes t).\]
The claim then follows by indcution on the number of factors of a product in $B$.
\end{proof}
\begin{corollary}\label{scheme morphism local ft diagonal is local fp}
Let $g:Y\to Z$ be a morphism locally of finite type. Then the diagonal morphism $\Delta_g:Y\to Y\times_ZY$ is locally of finite presentation.
\end{corollary}
\begin{proof}
This is contained in the proof of \cref{scheme morphism local fp permanence prop}.
\end{proof}
\begin{proposition}\label{algebra fp iff polynomial map finite kernel}
Let $A$ be a ring, $B$ be an $A$-algebra, $B'=A[T_1,\dots,T_n]$, and $\rho:B'\to B$ be a surjective homomorphism of $A$-algebras. Then for $B$ to be an $A$-algebra of finite presentation, it is necessary and sufficient that the kernel $\a$ of $\rho$ is finitely generated in $B'$.
\end{proposition}
\begin{proof}
The condition is sufficient by definition. Conversely, we note that the morphism $g:\Spec(B')\to\Spec(A)$ is locally of finite type; if $B$ is an $A$-algebra of finite presentation, the morphism $f:\Spec(B)\to\Spec(B')$ corresponding to $\rho$ and $g\circ f:\Spec(B)\to\Spec(A)$ are locally of finite presentation, so it follows from \cref{scheme morphism local fp permanence prop}(\rmnum{5}) that $f$ is locally of finite presentation. Now it suffices to apply \cref{localization of quotient ring finite presentation}.
\end{proof}
\begin{corollary}\label{scheme immersion local fp iff ideal sheaf finite type}
Let $X,Y$ be two schemes, $j:X\to Y$ be an immersion, $U$ an open subset of $Y$ such that $j(X)$ is closed in $U$, and $\mathscr{I}$ the quasi-coherent ideal of $\mathscr{O}_U$ defining the closed subscheme of $Y$ associated with $j$. For $j$ to be locally of finite presentation, it is necessary and sufficient that $\mathscr{I}$ is a $\mathscr{O}_U$-module of finite type.
\end{corollary}
\begin{proof}
Since the question is local, we can assume that $X$ and $Y$ are affine. The assertion then reduces to \cref{algebra fp iff polynomial map finite kernel}.
\end{proof}
\begin{proposition}\label{scheme affine morphism local fp iff ring fp}
Let $\rho:A\to B$ be a ring homomorphism. For the corresponding morphism $f:\Spec(B)\to\Spec(A)$ to be locally of finite presentation, it is necessary and sufficient that $B$ is an $A$-algebra of finite presentation.
\end{proposition}
\begin{proof}
The condition is clearly sufficient, so we only need to prove the necessity. If $f$ is locally of finite presentation, then it follows from \cref{scheme affine morphism local ft iff ring ft} that $B$ is an $A$-algebra of finite type, so there exists a surjective homomorphism $\rho:C'=A[T_1,\dots,T_n]\to B$ of $A$-algebras. It then follows from \cref{scheme morphism local fp permanence prop}(\rmnum{5}) that the closed immersion $j:\Spec(B)\to\Spec(B')$ is locally of finite presentation, so, if $\b$ is the kernel of $\rho$, the $\widetilde{B'}$-module $\tilde{\b}$ is of finite type, and $\b$ is therefore finitely generated in $B'$ by \cref{scheme affine qcoh ft and fp iff}.
\end{proof}
\begin{proposition}\label{scheme affine finite fp as ring iff fp as module} 
Let $\rho:A\to B$ be a homomorphism of rings such that $B$ is a finite $A$-algebra. For $B$ to be an $A$-algebra of finite presentation, it is necessary and sufficient that $B$ is an $A$-module of finite presentation.
\end{proposition}
\begin{proof}
There exists a finite $A$-algebra $B'$ of finite presentation such that $B'$ is a free $A$-module, and a surjective $A$-homomorphism of $A$-algebras $u:B'\to B$ (\cref{algebra finite surjective fp free algebra homomorphism}); we have a surjective homomorphism $v:B''=A[T_1,\dots,T_m]\to B'$ of $A$-algebras whose kernel is finitely generated. If $w=v\circ u:B''\to B$ and $\b$ (resp. $\a$) is the kernel of $w$ (resp. $u$), we have $\a=v(\b)$ since $v$ is surjective. If $B$ is an $A$-algebra of finite presentation, $\b$ is a finitely generated ideal of $B''$ by \cref{algebra fp iff polynomial map finite kernel}, so $\a$ is a finitely generated ideal in $B'$, hence a finitely generated $A$-module since $B'$ is a finite $A$-algebra. As $B'$ is a free $A$-module, $B$ is then an $A$-module of finite presentation. The converse is proved in \cref{algebra finite fp as module then fp as ring}.
\end{proof}
\begin{proposition}\label{scheme local immersion ft open iff nil}
Let $f:X\to Y$ be a local immersion of finite type at a point of $y\in Y$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is an open map at $y$.
\item[(\rmnum{2})] There exists an open neighborhood $U$ of $y$ in $Y$ such that $f|_U$ is a nilimmersion over the open subscheme $U$.
\item[(\rmnum{3})] There exists an open neighborhood $U$ of $y$ in $Y$ such that $f|_U$ is a nilpotent immersion over the open subscheme $U$.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{3}) implies (\rmnum{2}) and (\rmnum{2}) implies (\rmnum{1}). To show that (\rmnum{1}) implies (\rmnum{3}), we can, by restricting $f$, suppose that $f$ is a closed immersion from an affine open $U$ of $Y$ to an affine open $V$ of $X$. Moreover, by choosing an irreducible component containing $f(y)$, we can further assume that $V$ is irreducible. As $f$ is a homeomorphism from $U$ to $f(U)$, the hypothesis of (\rmnum{1}) then implies that $f(U)=V$ since $V$ is connected. If $V=\Spec(A)$, $U=\Spec(B)$, we have $B=A/\a$, where $\a$ is a nilideal of $A$. On the other hand, in view of \cref{scheme ft fp at point affine open prop}, we can, by replacing $A$ with a fraction field $A_s$, suppose that $B$ is an $A$-algebra of finite presentation. But then $\a$ is a finitely generated ideal of $A$ by \cref{algebra fp iff polynomial map finite kernel}, so it is nilpotent.
\end{proof}
\begin{proposition}\label{scheme morphism local ft iso if fiber is residue field}
Let $f:X\to Y$ be a morphism locally of finite type. Suppose that $f$ admits a $Y$-section $g$, and for every $y\in Y$, the fiber $X_y=f^{-1}(y)$ is a $\kappa(y)$-scheme $\kappa(y)$-isomorphic to $\Spec(\kappa(y))$ (and necessarily has underlying space $\{g(y)\}$). Then $f$ is an isomorphism.
\end{proposition}
\begin{proof}
In fact, $g$ is a nilimmersion of $Y$ to $X$ (\cref{scheme morphism graph is immersion}), so the image $g(Y)$ has underlying space $X$ and is defined by a nilideal $\mathscr{I}$ of $\mathscr{O}_X$. As $f\circ g=1_Y$ and $f$ is locally of finite type, $g$ is locally of finite presentation by \cref{scheme morphism local fp permanence prop}(\rmnum{5}), so $\mathscr{I}$ is an ideal of finite type of $\mathscr{O}_X$ (\cref{scheme immersion local fp iff ideal sheaf finite type}). For any $y\in Y$, put $x=g(y)$, and consider the following exact sequence:
\[\begin{tikzcd}
0\ar[r]&\mathscr{I}_x\ar[r]&\mathscr{O}_{X,x}\ar[r,"g^{\#}_y"]&\mathscr{O}_{Y,y}\ar[r]\ar[l,bend left=20pt,"f^{\#}_x"]&0
\end{tikzcd}\]
The relation $f\circ g=1_Y$ implies $f^{\#}_x\circ g^{\#}_y=1$, so the above exact sequence splits. By tensoring with $\kappa(y)=\mathscr{O}_{Y,y}/\m_y$, we then get an isomorphism $\mathscr{O}_{X,x}/\m_y\mathscr{O}_{X,x}\cong\kappa(y)\oplus(\mathscr{I}_x/\m_y\mathscr{I}_x)$. But the hypothesis on $X_y$ implies that $\kappa(y)$-isomorphic to $\kappa(y)$, so we deduce that $\m_y\mathscr{I}_x=\mathscr{I}_x$ and a fortiori $\m_x\mathscr{I}_x=\mathscr{I}_x$. As $\mathscr{I}_x$ is a finitely generated ideal of $\mathscr{O}_{X,x}$, by Nakayama lemma we conclude $\mathscr{I}_x=0$, so $\mathscr{I}=0$ and $f$ is an isomorphism.
\end{proof}
\begin{corollary}\label{scheme morphism monomorphism at fiber then monomorphism}
Let $X,Y$ be two $S$-schemes and $f:X\to Y$ be an $S$-morphism. Suppose that $X$ is locally of finite type over $S$. For each $s\in S$, let $X_s,Y_s$ be the fiber of $X$ and $Y$ at the point $s$, and $f_s:X_s\to Y_s$ be the morphism induced by $f$ under the base change $\Spec(\kappa(s))\to S$. Then if for each $s\in S$, $f_s$ is a monomorphism, $f$ is a monomorphism.
\end{corollary}
\begin{proof}
If $f_s$ is a monomorphism, so is $f_y:X_y\to\Spec(\kappa(y))$ . By hypothesis $f$ is locally of finite type (\cref{scheme morphism local ft permanence prop}(\rmnum{5})), so we can limit ourselves to the case $Y=S$. To see that $f$ is a monomorphism, it suffices to prove that the first projection $p:X\times_SX\to X$ is an isomorphism (\cref{scheme monomorphism iff diagonal isomorphism}). Now the hypothesis on $f_s$ implies that the projections $p_s:X_s\otimes_{\kappa(s)}X_s\to X_s$ are isomorphisms for all $s\in S$. Since $p$ admits an $S$-section, namely the diagonal $\Delta_f$, it follows from \cref{scheme morphism local ft iso if fiber is residue field} that $p$ is an isomorphism.
\end{proof}
We now come to the definition of \textit{morphisms of finite type}, which can be seen as a global version of morphisms locally of finite type. Briefly speaking, the notion of finite type concerns the "global finiteness" of a morphism: we have the following definition and proposition.
\begin{proposition}\label{scheme morphism ft def}
Let $f:X\to Y$ be a morphism and $(U_\alpha)$ be a covering of $Y$ by affine opens. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is locally of finite type and quasi-compact.
\item[(\rmnum{2})] For each $\alpha$, $f^{-1}(U_\alpha)$ is a finite union of affine opens $V_{\alpha,i}$ such that the ring $\Gamma(V_{\alpha,i},\mathscr{O}_X)$ is a $\Gamma(U_\alpha,\mathscr{O}_Y)$-algebra of finite type.
\item[(\rmnum{3})] For any affine open $U$ of $Y$, $f^{-1}(U)$ is a finite union of affine opens $V_j$ such that $\Gamma(V_j,\mathscr{O}_X)$ is a $\Gamma(U,\mathscr{O}_X)$-algebra of finite type. 
\end{enumerate}
We say the morphism $f$ is \textbf{of finite type} if it satisfies the above equivalent conditions. In this case, we say $X$ is of finite type over $Y$.
\end{proposition}
\begin{proof}
It is clear that (\rmnum{3})$\Rightarrow$(\rmnum{2})$\Rightarrow$(\rmnum{1}). To prove that (\rmnum{1}) implies (\rmnum{3}), we may assume that $Y=U$ is affine; then $X$ is quasi-compact, hence is a finte union of affine opens $V_j$ such that the restriction $V_j\to U$ of $f$ is locally of finite type. By \cref{scheme affine morphism local ft iff ring ft}, we see $\Gamma(V_j,\mathscr{O}_X)$ is a $\Gamma(U,\mathscr{O}_X)$-algebra of finite type. 
\end{proof}
\begin{proposition}\label{scheme morphism ft target Noe}
Let $f:X\to Y$ be a morphism of finite type. If $Y$ is Noetherian (resp. locally Noetherian), so is $X$.
\end{proposition}
\begin{proof}
This follows from \cref{scheme local Noe local ft iff fp} and \cref{topo space Noe prop}.
\end{proof}
\begin{proposition}[\textbf{Properties of Morphisms of Finite Type}]\label{scheme morphism ft permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] Any quasi-compact immersion is of finite type.
\item[(\rmnum{2})] The composition of two morphisms of finite type is of finite type.
\item[(\rmnum{3})] If $f:X\to Y$ is an $S$-morphism of finite type, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is of finite type for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:Y\to Y'$ are two $S$-morphisms of finite type, $f\times_Sg$ is of finite type. 
\item[(\rmnum{5})] If the composition $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ is of finite type and if $g$ is quasi-separated or $X$ is Noetherian, then $f$ is of finite type.
\item[(\rmnum{6})] If a morphism $f$ is of finite type, so is $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
This follows directly from \cref{scheme morphism local ft permanence prop} and \cref{scheme morphism qc permanence prop}.
\end{proof}
\begin{corollary}\label{scheme morphism ft Noe base change is Noe}
Let $f:X\to Y$ be a morphism of finite type. For any morphism $Y'\to Y$ such that $Y'$ is Noetherian, $X\times_YY'$ is Noetherian.
\end{corollary}
\begin{proof}
This follows from \cref{scheme morphism ft permanence prop}(\rmnum{3}) and \cref{scheme morphism ft target Noe}.
\end{proof}
\begin{corollary}\label{scheme ft over local Noe base morphism is ft}
Let $X$ be a scheme of finite type over a locally Noetherian scheme $S$. Then any $S$-morphism $f:X\to Y$ is of finite type.
\end{corollary}
\begin{proof}
The morphism $f$ is locally of finite type by \cref{scheme morphism local ft permanence prop}(\rmnum{5}). To see it is quasi-compact, we can suppose that $S$ is Noetherian. If $\varphi:X\to S$ and $\psi:Y\to S$ are the structural morphism, we have $\varphi=\psi\circ f$ and $X$ is Noetherian by \cref{scheme morphism ft target Noe}, so $f$ is of finite type, by \cref{scheme morphism ft permanence prop}(\rmnum{5}).
\end{proof}
Let $X$ and $Y$ be two schemes. We say a morphism $f:X\to Y$ is \textbf{of finite presentation} if it satisfies the following conditions:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is locally of presentation;
\item[(\rmnum{2})] $f$ is quasi-compact;
\item[(\rmnum{3})] $f$ is quasi-separated.
\end{enumerate}
In this case, we say $X$ is \textbf{of finite presentation over $\bm{Y}$}, or is an \textbf{$\bm{Y}$-scheme of finite presentation}. It is clear that condition (\rmnum{3}) is automatic if $f$ is separated, or if $X$ is locally Noetherian. If $Y$ is locally Noetherian, then again, $f$ is of finite type if and only if it is of finite presentation, and in this case $X$ is also locally Noetherian.\par
\begin{proposition}[\textbf{Properties of Morphisms of Finite Presentation}]\label{scheme morphism fp permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] Any quasi-compact immersion that is locally of finite presentation (in particular any quasi-compact open immersion) is of finite presentation.
\item[(\rmnum{2})] The composition of two morphisms of finite presentation is of finite presentation.
\item[(\rmnum{3})] If $f:X\to Y$ be an $S$-morphism of finite presentation, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is of finite presentation for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:Y\to Y'$ are two $S$-morphisms of finite presentation, $f\times_Sg$ is of finite presentation.
\item[(\rmnum{5})] If the composition $g\circ f$ of two morphisms $f:X\to Y$, $g:Y\to Z$ is of finite presentation and if $g$ is quasi-separated and locally of finite type, then $f$ is of finite presentation.
\end{enumerate}
\end{proposition}
\begin{proof}
This follows from \cref{scheme morphism qc permanence prop}, \cref{scheme morphism qs permanence prop}, and \cref{scheme morphism local fp permanence prop}.
\end{proof}
It follows from \cref{scheme morphism fp permanence prop}(\rmnum{3}) that if $f$ is a morphism of finite presentation and $U$ is an open subset of $Y$, the restriction $f^{-1}(U)\to U$ of $f$ is also of finite presentation. conversely, let $(U_\alpha)$ be a covering of $Y$ by affine opens and suppose that the restriction $f^{-1}(U_\alpha)\to U_\alpha$ of $f$ is a morphism of finite presentation. Then it follows that $f$ is of finite presentation, since $f$ is clearly of finite presentation and quasi-compact and it is quasi-separated by \cref{scheme qs local on target}.\par
If $X$ is a quasi-separated scheme, any morphism $f:X\to Y$ is quasi-separated by \cref{scheme morphism from into qs prop}. Therefore, if $f$ is quasi-compact and locally of finite presentation, it is of finite presentation.
\begin{corollary}\label{scheme affine ft and fp iff ring}
Let $\rho:A\to B$ be a ring homomorphism. For the corresponding morphism $f:\Spec(B)\to\Spec(A)$ to be of finite type (resp. of finite presentation), it is necessary and sufficient that $B$ is an $A$-algebra of finite type (resp. of finite presentation).
\end{corollary}
\begin{proof}
Since any morphism of affine schemes is quasi-compact and separated, this follows from \cref{scheme affine morphism local ft iff ring ft} and \cref{scheme affine morphism local fp iff ring fp}.
\end{proof}
\begin{remark}
In the definition of morphisms of finite presentation, the condition (\rmnum{3}) is not a concequence of the other two conditions. For example, let $Y$ be a non-Noetherian affine scheme and let $Y$ be a non-quasi-compact open subset of $Y$ (an example for this is $Y=\Spec(k[x_1,x_2,\dots])$ and $U=Y-\{0\}$, cf. \cref{scheme open immersion not qc}). Let $X$ be the scheme obtained by glueing two schemes $Y_1,Y_2$ isomorphic to $Y$ along the open sets $U_1,U_2$ corresponding to $U$, so that $X$ is the union of two affine opens isomorphic to $Y_1,Y_2$, respectively, and $Y_1\cap Y_2=U$. Let $f:X\to Y$ be the morphism which coincides with the canonical isomorphism $Y_i\to Y$ on each $Y_i$. Then it is clearly locally of finite presentation, and is quasi-compact since the inverse image of a quasi-compact open of $Y$ is the union of its images in $Y_1$ and $Y_2$; but as $Y_1\cap Y_2=U$ is not quasi-compact, it is not quasi-separated by \cref{scheme qs iff intersection of qc open} and \cref{scheme morphism from into qs prop}(\rmnum{2}).
\end{remark}
\begin{proposition}\label{scheme morphism ft and fp coproduct}
Let $f_i:X_i\to Y$ be a finite family of morphisms and $f:X\to Y$ be their coproduct, where $X=\coprod_iX_i$. Then for $f$ to be of finite type (resp. finite presentation), it s necessary and sufficient that each $f_i$ is.
\end{proposition}
\begin{proof}
In view of \cref{scheme morphism qc and qs finite coproduct}, it suffices to note that the same assertion holds for morphisms of locally finite type and of finite presentation.
\end{proof}
\subsection{Algebraic schemes}
We say a $K$-scheme is \textbf{algebraic} (resp. \textbf{locally algebraic}) if it is of finite type over $K$ (resp. locally of finite type over $K$). The field $K$ is called the \textbf{base field} of $X$.
\begin{proposition}\label{scheme algebraic is Jacobson and closed point char}
Let $K$ be a field. A locally algebraic (resp. algebraic) $K$-scheme is locally Noetherian (Noetherian). Moreover $X$ is a Jacobson scheme and a point $x\in X$ is closed if and only if $\kappa(x)$ is a finite extension of $K$. 
\end{proposition}
\begin{proof}
The first assertion is clear, and $X$ is Jacobson by \cref{scheme finite type over Jacobson is Jacobson}. To characterize close points in $X$, we note that for a point $x\in X$ to be closed, it is necessary and sufficient that for an open covering $(U_\alpha)$ of $X$, $s$ is closed in the $U_\alpha$ containing it. As there is a covering of $X$ by affine opens $U_\alpha$ such that $\Gamma(U_\alpha,\mathscr{O}_X)$ is a $K$-algebra of finite type, we can then assume that $X=\Spec(A)$ where $A$ is a $K$-algebra of finite type. The closed points of $X$ are then maximal ideals of $A$; but then $A/\p_x=\kappa(x)$ is a finite extension by \cref{Jacobson ring finite algebra is Jacobson}. Conversely, if $\kappa(x)$ is a finite $K$-algebra, so is the ring $A/\p_x\sub\kappa(x)$, and as an integral $K$-algebra is also a field (\cref{integral ring extension field iff}), we have $A/\p_x=\kappa(x)$, so $x$ is closed.
\end{proof}
\begin{corollary}\label{scheme algebraic over ac field closed point iff rational}
Let $K$ be an algebraically closed field and $X$ be a locally algebraic $K$-scheme. Then the closed points of $X$ are exactly the rational points of $X$ over $K$, which are identified with the $K$-points of $X$ with values in $K$.
\end{corollary}
\begin{proposition}\label{scheme algebraic Artinian iff}
Let $K$ be a field and $X$ be a locally algebraic scheme over $K$. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is Artinian.
\item[(\rmnum{2})] The underlying space of $X$ has only finitely many closed points.
\item[(\rmnum{3})] The underlying space of $X$ is finite.
\item[(\rmnum{4})] $X$ is isomorphic to $\Spec(A)$ where $A$ is $K$-algebra of finite dimension.
\end{enumerate}
If $X$ is algebraic over $K$, then these conditions are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{5})] The underlying space of $X$ is discrete. 
\item[(\rmnum{6})] The points of $X$ are all closed.
\end{enumerate}
\end{proposition}
\begin{proof}
We see (\rmnum{1}) implies any other conditions, and (\rmnum{5}) or (\rmnum{6}) implies (\rmnum{1}) if $X$ is Noetherian. Moreover, it is clear that (\rmnum{4}) implies (\rmnum{1}), since a finite dimensional $K$-algebra is Artianian. In the condition of (\rmnum{2}), the set $X_0$ of closed points of $X$ is then finite, closed and very dense in $X$, whence equal to $X$ and $X$ is therefore Artinian, since it is then Noetherian.
\end{proof}
\begin{corollary}\label{scheme algebraic point isolated iff}
Let $K$ be a field, $X$ be a locally algebraic $K$-scheme, and $x$ be a point of $X$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $x$ is isolated in $X$;
\item[(\rmnum{2})] $x$ is closed in $X$ and $\mathscr{O}_{X,x}$ is Artinian;
\item[(\rmnum{3})] $\mathscr{O}_{X,x}$ is a finite dimensional $K$-algebra.   
\end{enumerate}
\end{corollary}
\begin{proof}
If $\mathscr{O}_{X,x}$ is a finite dimensional $K$-algebra, so is the residue field $\kappa(x)=\mathscr{O}_{X,x}/\m_x$, so (\rmnum{3}) implies (\rmnum{2}) in view of \cref{scheme algebraic is Jacobson and closed point char}. The local ring $\mathscr{O}_{X,x}$ is Artinian signifies that $x$ is a maximal point of $X$, since a Noetherian local ring is Artinian if and only if it has a unique primei deal. If $x$ is moreover closed, the set $\{x\}$ is closed and stable under generalization, hence open (\cite{EGA1} new, $0_{\text{\Rmnum{1}}}$, 2.1.5), and this proves $x$ is isolated in $X$. Finally, if $x$ is isolated in $X$, there exists an affine open neighborhood $U$ of $x$ such that $U=\{x\}$ and $\Gamma(U,\mathscr{O}_X)$ is a finite type $K$-algebra. But then $\Gamma(U,\mathscr{O}_X)=\mathscr{O}_{X,x}$, so (\rmnum{1}) implies (\rmnum{3}). 
\end{proof}
If the conditions in \cref{scheme algebraic Artinian iff}, we say $X$ is a finite scheme over $K$, or a finite $K$-scheme. For such a scheme, we denote by $\dim_K(X)$ the dimension of the ring $\Gamma(X,\mathscr{O}_X)$ over $K$. If $X$ and $Y$ are two finite schemes over $K$, we have
\[\dim_K(X\amalg Y)=\dim_K(X)+\dim_K(Y),\quad \dim_K(X\times_KY)=\dim_K(X)\dim_K(Y).\]
\begin{corollary}\label{scheme finite over field stable under base change}
Let $X$ be a finite scheme over a field $K$. For any extension $K'$ of $K$, $X\otimes_KK'$ is a finite scheme over $K'$, with $\dim_{K'}(X')=\dim_K(X)$.
\end{corollary}
\begin{proof}
In fact, if $X=\Spec(A)$, we have $[A\otimes_KK':K']=[A:K]$, whence the claim.
\end{proof}
\begin{corollary}\label{scheme finite over field count point in a.c. extension}
Let $X$ be a finite scheme over a field $K$. We put
\[n=\sum_{x\in X}[\kappa(x):K]_s\]
Then, for any algebraically closed extension $\Omega$ of $K$, the underlying space of $X\otimes_K\Omega$ has exactly $n$ points, which are identified with the $\Omega$-valued points of $X$.
\end{corollary}
\begin{proof}
By \cref{scheme artinian iff}, we can assume that $A=\Gamma(X,\mathscr{O}_X)$ is local; let $\m$ be the maximal ideal of $A$, $L=A/\m$ the residue field, which is a finite algebraic extension of $K$ by \cref{scheme algebraic Artinian iff}. The $\Omega$-points of $X$ correspond bijectively to $\Omega$-sections of $X\otimes_K\Omega$, and to the closed points of $X\otimes_K\Omega$ by \cref{scheme algebraic over ac field closed point iff rational}, and finally to the points of this Artinian scheme (\cref{scheme artinian iff}). They also correspond to $K$-homomorphisms of $L$ into $\Omega$, and the assertion then follows from the definition of separable degree.
\end{proof}
The number $n$ defined in \cref{scheme finite over field count point in a.c. extension} is called the \textbf{separable rank} of $A$ (or $X$) over $K$, or the \textbf{geometric number of points} of $X$. This is also the number of elements in $X(\Omega)_K$. It follows from this definition that for any extension $K'$ of $K$, $X\otimes_KK'$ has the same geometric number of points as $X$. If we denote this number by $n(X)$, it is clear that, if $X$ and $Y$ are two finite schemes over $K$, we have
\[n(X\amalg Y)=n(X)+n(Y),\quad n(X\times_KY)=n(X)n(Y).\]
\begin{proposition}\label{scheme morphism ft fiber algebraic}
Let $f:X\to Y$ be a morphism locally of finite type (resp. of finite type). Then, for any $y\in Y$, the fiber $X_y=f^{-1}(y)$ is a locally algebraic (resp. algebraic) scheme over $\kappa(y)$, and for each $x\in X_y$, $\kappa(x)$ is a extension of $\kappa(y)$ of finite type.
\end{proposition}
\begin{proof}
As $X_y=X\otimes_Y\kappa(y)$, this follows from \cref{scheme morphism local ft permanence prop}(\rmnum{3}) and \cref{scheme morphism ft permanence prop}(\rmnum{3}).
\end{proof}
\begin{proposition}\label{scheme base change fiber finite scheme prop}
Let $f:X\to Y$, $g:Y'\to Y$ be two morphisms, and put $X'=X\times_YY'$, $f'=f_{(Y')}:X'\to Y'$. Let $y'\in Y'$ and $y=g(y')$. If the fiber $X_y=f^{-1}(y)$ is a finite scheme over $\kappa(y)$, then the fiber $X'_{y'}=f'^{-1}(y')$ is a finite scheme over $\kappa(y')$, and we have
\[\dim_{\kappa(y')}(X'_{y'})=\dim_{\kappa(y)}(X_y),\quad n(X'_{y'})=n(X_y).\]
\end{proposition}
\begin{proof}
This follows from the observation $X'_{y'}=X_y\otimes_{\kappa(y)}\kappa(y')$.
\end{proof}
\cref{scheme morphism ft fiber algebraic} shows that the morphisms of finite type (resp. locally of finite type) correspond intuitively to "algebraic families of algebraic varieties (resp. locally algebraic)", where $Y$ plays the role of "parameters." Because of this, these morphisms are of significant geometric interests. The morphisms which are not locally of finite type will intervene them by the process of "base change", for example by localization and completion.
\subsection{Local determination of morphisms}
\begin{proposition}\label{scheme local ft morphism determined local}
Let $X$ and $Y$ be $S$-schemes, $x\in X$, $y\in Y$ be points lying over the same point $s\in S$.
\begin{enumerate}
\item[(a)] Suppose that $Y$ is locally of finite type over $S$ at the point $y$. Then if two $S$-morphisms $f,g$ from $X$ to $Y$ are such that $f(x)=g(x)=y$ and the $\mathscr{O}_{S,s}$-homomorphisms $f^{\#}_x$ and $g^{\#}_x$ from $\mathscr{O}_{Y,y}$ to $\mathscr{O}_{X,x}$ coincide, then $f$ and $g$ coincide in an open neighborhood of $x$.
\item[(b)] Suppose that $Y$ is locally of finite presentation over $S$ at the point $y$. Then, for any $\mathscr{O}_{X,x}$-homomorphism $\varphi:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ there exists an open neighborhood $U$ of $x$ in $X$ and an $S$-morphism $f$ from $U$ to $Y$ such that $f(x)=y$ and $f^{\#}_x=\varphi$.
\end{enumerate} 
\end{proposition}
\begin{proof}
We first consider case (a). The question is local over $S$, $X$ and $Y$, so we can suppose that $S,X,Y$ are affine with rings $A,B,C$, respectively. The morphisms $f$ and $g$ then correspond to $A$-homomorphisms $\rho,\sigma$ from $C$ to $B$ such that $\rho^{-1}(\p_x)=\sigma^{-1}(\p_x)=\p_y$, and the homomorphisms $\rho_x$ and $\sigma_x$ from $C_y$ to $B_x$, deduced by $\rho$ and $\sigma$, coincide. We can morphism suppose that $C$ is an $A$-algebra of finite type. Let $(c_i)_{1\leq i\leq n}$ be generators of the $A$-algebra $C$, and put $b_i=\rho(c_i)$, $b'_i=\sigma(c_i)$. By hypothesis, we have $b_i/1=b'_i/1$ in the ring $B_x$. This means there exist elements $s_i\in B-\p_x$ such that $s_i(b_i-b'_i)=0$ for each $i$, and we can evidently choose one $s\in B-\p_x$ for all $i$. We then conclude that $b_i/1=b'_i/1$ for each $i$ in the ring $B_s$; if $i_s:B\to B_s$ is the canonical homomorphism, we then have $i_s\circ\rho=i_s\circ\sigma$, so the restriction of $f$ and $g$ on $D(s)$ are identical.\par
We now come to case (b). Again we can suppose that $S,X,Y$ are affine with rings $A,B,C$. Put $\p=\p_x$, $\q=\p_y$, and let $\varphi:C_\q\to B_\p$ be an $A$-homomorphism. We then get an $A$-homomorphism $\rho:C\to C_\q\stackrel{\varphi}{\to}B_\p$. Since we can consider $B_\p$ as an inductive limit of the filtered system of $A$-algebras $B_s$, where $s$ runs through elements of $B-\p$, and $C$ is by hypothesis an $A$-algebra of finite presentation, we deduce from \cref{algebra ft Hom set commutes with limit iff} that there exists $s\notin\p$ and an $A$-homomorphism $\sigma:C\to B_s$ whose canonical image is $\rho$, that is, the following diagram is commutative
\begin{equation}\label{scheme local ft morphism determined local-1}
\begin{tikzcd}
C\ar[d]\ar[r,"\sigma"]&B\ar[d]\\
C_\q\ar[r,"\varphi"]&B_\p
\end{tikzcd}
\end{equation}
It then suffices to take $U=D(s)$ and let $f$ be the morphism induced by $\sigma$.
\end{proof}
\begin{corollary}
Under the hypotheses of \cref{scheme local ft morphism determined local}(\rmnum{2}), if moreover $X$ is locally of finite type over $S$ at the point of $x$, we can choose $f$ to be of finite type.
\end{corollary}
\begin{proof}
To see this, we can assume that $S,X,Y$ are affine, so that the structural morphisms $X\to S$ and $Y\to S$ are respectively of finite type and of finite presentation; then the results follows from \cref{scheme ft fp at point affine open prop} and \cref{scheme morphism local ft permanence prop}(\rmnum{4}).
\end{proof}
\begin{corollary}\label{scheme local ft morphism local construct affine}
Retain the hypotheses of \cref{scheme local ft morphism determined local}(\rmnum{2}) and suppose that $Y$ is integral and $\varphi:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ is injective. Then we can suppose that $U$ is affine and $f$ factors into
\[\begin{tikzcd}
U\ar[r,"g"]&V\ar[r]&Y
\end{tikzcd}\]
where $V$ is an affine open containing $y$ and $g:U\to V$ is a morphism corresponding to a injective homomorphism $\Gamma(V,\mathscr{O}_Y)\to\Gamma(U,\mathscr{O}_X)$.
\end{corollary}
\begin{proof}
In fact, with the notations of \cref{scheme local ft morphism determined local}(\rmnum{2}), $C$ is integral and the canonical homomorphism $C\to C_g$ is then injective; the result then follows from the diagram (\ref{scheme local ft morphism determined local-1}), since $\sigma$ is injective.
\end{proof}
\begin{proposition}\label{scheme morphism local ft fp local immersion iso iff}
Let $f:X\to Y$ be a morphism, $x$ be a point of $X$ and $y=f(x)$.
\begin{enumerate}
\item[(a)] Suppose that $f$ is locally of finite type at the point $x$. For $f$ to be a local immersion at the point $x$, it is necessary and sufficient that $f^{\#}_x:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ is surjective.
\item[(b)] Suppose that $f$ is locally of finite presentation at the point $x$. For $f$ to be a local isomorphism at the point $x$, it is necessary and sufficient that $f^{\#}_x:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ is an isomorphism.
\end{enumerate}
\end{proposition}
\begin{proof}
We only need to prove the sufficiency, and we first consider case (b). Then $X$ is locally of finite presentation over $y$ at the point $x$, so by \cref{scheme local ft morphism determined local}(\rmnum{1}) and (\rmnum{2}), there exists an open neighborhood $V$ of $y$ and a morphism $g:V\to X$ such that $g\circ f$ (resp. $f\circ g$) is defined and coincide with the identity on an open neighborhood $W$ of $x$ (resp. an open neighborhood $T$ of $y$). Put $T'=T\cap g^{-1}(w)$ and $W'=f^{-1}(T')$, we then verify that $g(T')\sub W'$, $f(W')\sub T'$ and $(g\circ f)|_{W'}=1_{W'}$, whence $f$ is a local isomorphism.\par
For (a), we can assume that $X$ and $Y$ are affine, with ring $A$ and $B$. Then $f$ corresponds to a homomorphism $\varphi:B\to A$ of finite type; we have $\varphi^{-1}(\p_x)=\p_y$, and the homomorphism $\varphi_x:B_y\to A_x$ induced by $\varphi$ is surjective. Let $(t_i)_{1\leq i\leq n}$ be a system of generators of the $B$-algebra $A$. The hypothesis on $\varphi_x$ then implies $t_i/1=\varphi(b_i)/\varphi(c)$ in the ring $A_x$, where $b_i\in B$ and $c\in B-\p_y$, so we can find $a\in A-\p_x$ such that
\[a(t_i\varphi(c)-\varphi(b_i))=0.\]
If we put $g=a\varphi(c)$, then $t_i/1=a\varphi(b_i)/g$ in the ring $A_g$. Now there exists by hypothesis a polynomial $Q(X_1,\dots,X_n)$ with coefficients in $\varphi(B)$ such that $a=Q(t_1,\dots,t_n)$; write $Q(X_1/T,\dots,X_n/T)=P(X_1,\dots,X_n,T)/T^m$, where $P$ is a polynomial of degree $m$. In the ring $A_g$, we then have
\begin{align*}
a/1&=Q(t_1/1,\dots,t_n/1)=Q(a\varphi(b_1)/g,\dots,a\varphi(b_n)/g)\\
&=a^mP(\varphi(b_1),\dots,\varphi(b_n),\varphi(c))/g^m=a^m\varphi(d)/g^m
\end{align*}
where $d\in B$. Since $g/1=(a/1)(\varphi(c)/1)$ is invertible in $A_g$ by definition, so is $a/1$ and $\varphi(c)/1$, and we can then write $a/1=(\varphi(d)/1)(\varphi(c)/1)^{-m}$. We conclude that $\varphi(d)/1$ is also invertible in $A_g$. Put $h=cd$, as $\varphi(h)/1$ is invertible in $A_g$, the composed homomorphism $B\to A\to A_g$ factors into
\[\begin{tikzcd}
B\ar[r,"\varphi"]\ar[rd]&A\ar[r]&A_g\\
&B_h\ar[ru,swap,"\gamma"]&
\end{tikzcd}\]
We claim that $\gamma$ is surjective. For this, it suffices to verify that the image of $B_h$ in $A_g$ contains $t_i/1$ and $1/g$. Now we have 
\[1/g=(\varphi(c)/1)^{m-1}(\varphi(d)/1)^{-1}=\gamma(c^m/h)\]
and $a/1=\gamma(d^{m+1}/h^m)$, so $(a\varphi(b_i))/1=\gamma(b_id^{m+1}/h^m)$, and as $t_i/1=(a\varphi(b_i)/1)(g/1)^{-1}$, we conclude our assertion. The choice of $h$ implies $f(D(g))\sub D(h)$, and the restriction of $f$ to $D(g)$ is induced by $\gamma$. Since $\gamma$ is surjective, this restriction is a closed immersion from $D(g)$ to $D(h)$, so $f$ is a local immersion at $x$.
\end{proof}
\begin{corollary}\label{scheme morphism local ft fp local immersion open iff}
With the notations of \cref{scheme morphism local ft fp local immersion iso iff}, suppose that $f$ is a local immersion at the point $x$ and is locally of finite presentation at $x$. For $f$ to be open at $x$, it is necessary and sufficient that the kernel of $f^{\#}_x$ is nilpotent.
\end{corollary}
\begin{proof}
In view of \cref{scheme local immersion ft open iff nil}, it suffices to prove the sufficiency of the condition. We can suppose that $Y=\Spec(A)$ and $X=\Spec(A/\n)$, where $\n$ is a finitely generated ideal of $A$ (\cref{scheme immersion local fp iff ideal sheaf finite type}), and by hypothesis $\n_x$ is nilpotent. If $(s_i)_{1\leq i\leq n}$ is a system of generators of $\n$, we then have $s_i^m/1=0$ in $A_x$ for an integer $m$ and all $i$. Then there exists $t\in A-\p_x$ such that $ts_i^m=0$ for all $i$, so $(s_i/1)^m=0$ in the ring $A_t$. This shows $\n_t$ is nilpotent, whence the conclusion.
\end{proof}
\subsection{Direct image of quasi-coherent sheaves}
\begin{proposition}\label{scheme morphism qcqs qcoh direct image}
Let $X,Y$ be two schemes and $f:X\to Y$ be a quasi-compact and quasi-separated morphism. Then for any quasi-coherent $\mathscr{O}_X$-module, $f_*(\mathscr{F})$ is quasi-coherent.
\end{proposition}
\begin{proof}
Since the question is local over $Y$, we can assume that $Y$ is affine. If $f$ is quasi-compact, $X$ is then a union of finitely many open affines $X_i$, and in view of \cref{scheme morphism qs permanence prop}(\rmnum{2}), $X$ is a quasi-separated scheme, hence the intersections $X_i\cap X_j$ are qausi-compact (\cref{scheme qs iff intersection of qc open}).\par
We first assume that each intersection $X_i\cap X_j$ is affine. Put $\mathscr{F}_i=\mathscr{F}|_{X_i}$, $\mathscr{F}_{ij}=\mathscr{F}|_{X_i\cap X_j}$ and let $\mathscr{F}'_i$ and $\mathscr{F}'_{ij}$ be the inverse image of $\mathscr{F}_i$ and $\mathscr{F}_j$ under the restriction of $f$ to $X_i$ and to $X_{i\cap X_j}$. We see that $\mathscr{F}'_i$ and $\mathscr{F}'_{ij}$ are quasi-coherent (\cref{sheaf of module qcoh under inverse image}). We define a homomorphism
\[u:\bigoplus_i\mathscr{F}'_i\to\bigoplus_{i,j}\mathscr{F}'_{ij}\]
such that $f_*(\mathscr{F})$ is the kernel of $u$, and this then implies $f_*(\mathscr{F})$ is quasi-coherent by \cref{scheme affine associated sheaf ker and coker}. For this, it suffices to define $u$ as a homomorphism of presheaves, so for each open subset $W\sub Y$, we need a homomorphism
\[u_W:\bigoplus_i\Gamma(f^{-1}(W)\cap X_i,\mathscr{F})\to\bigoplus_{ij}\Gamma(f^{-1}(W)\cap X_i\cap X_j,\mathscr{F})\]
so as to satisfy the compatibility for the restrictions to a smaller open subset. If for any section $s_i$ of $\mathscr{F}$ over $f^{-1}(W)\cap X_i$, we denote by $s_{ij}$ its restriction to $f^{-1}(W)\cap X_i\cap X_j$, we set
\[u_W((s_i))=(s_{ij}-s_{ji})\]
and the compatibility is evident. To identity the kernel $\mathscr{R}$ of $u$, we define a homomorphism $v:f_*(\mathscr{F})\to\mathscr{R}$ which sends a section $s$ of $\mathscr{F}$ over $f^{-1}(W)$ to the family $(s_i)$, where $s_i$ is the restriction of $s$ to $f^{-1}(W)\cap X_i$. By the sheaf axoims of $\mathscr{F}$, it is clear that $v$ is bijective, which proves the assertion in this case.\par
In the general case, the same reasoning can be applied if we can show that each $\mathscr{F}'_{ij}$ is quasi-coherent. But by hypotheses, $X_i\cap X_j$ is a union of finitely many affine opens $X_{ijk}$, and since each $X_{ijk}$ are affine open subschemes of the affine scheme $X_i$, their intersections are again affine (affine schemes are separated), so we can apply the previous arguments to conclude that $\mathscr{F}_{ij}'$ is quasi-coherent, and the proof is then complete.
\end{proof}
\begin{remark}
We should note that even if $X$ and $Y$ are Noetherian schemes and $f:X\to Y$ is a morphism of finite type, the direct image $f_*(\mathscr{F})$ of a coherent $\mathscr{O}_X$-module $\mathscr{F}$ is in general not coherent. For example, let $Y$ be the spectrum of a field $K$, $X=\Spec(K[T])$, and choose $\mathscr{F}=\mathscr{O}_X$.
\end{remark}
\begin{proposition}\label{scheme morphism qcqs direct image and colimit}
Let $f:X\to Y$ be a quasi-compact and quasi-separated morphism. Let $(\mathscr{F}_\lambda)$ be a inductive system of quasi-coherent $\mathscr{O}_X$-modules and $\mathscr{F}=\rlim\mathscr{F}_\lambda$ be the inductive limit. Then $\rlim f_*(\mathscr{F}_\lambda)\cong f_*(\mathscr{F})$.
\end{proposition}
\begin{proof}
For each affine open subset $W$ of $Y$ and any $\lambda$, we have a canonical homomorphism
\[u_{W,\lambda}:(f_*(\mathscr{F}_\lambda))|_W\to f_*(\mathscr{F})|_W\]
whence a canonical homomorphism
\[u_W:(\rlim f_*(\mathscr{F}_\lambda))|_W\to f_*(\mathscr{F})|_W\]
and this hommorphism is compatible with restrictions. Since $f$ is quasi-compact and quasi-separated, by \cref{scheme morphism qcqs qcoh direct image} $\rlim f_*(\mathscr{f}_\lambda)$ and $f_*(\mathscr{F})$ are quasi-coherent. Moreover, the homomorphism $u_W$ corresponds by taking global section over $W$ to the canonical homomorphism
\[\varphi_W:\Gamma(W,\rlim f_*(\mathscr{F}_\lambda))\to\Gamma(f^{-1}(W),\mathscr{F}).\]
Since $f$ is quasi-compact and quasi-separated, by (Stack Project. Lemma 6.29.1) we have
\[\Gamma(W,\rlim f_*(\mathscr{F}_\lambda))=\rlim\Gamma(W,f_*(\mathscr{F}_\lambda))=\rlim\Gamma(f^{-1}(W),\mathscr{F}_\lambda)=\Gamma(f^{-1}(W),\mathscr{F})\]
and $\varphi_W$ is therefore the identity homomorphism. By \cref{scheme affine qcoh cat equivalent to module}, it then follows that $u_W$ is an isomorphism for each $W$, and the assertion then follows.
\end{proof}
\subsection{Extension of quasi-coherent sheaves}\label{scheme qcoh sheaf extension subsection}
Let $X$ be a topological space and $\mathscr{F}$ be a sheaf of sets (resp. of groups, of rings) over $X$. Let $U$ be an open subset of $X$ with $j:U\to X$ the canonical injection, and let $\mathscr{G}$ be a subsheaf of $\mathscr{F}|_U=j^{-1}(\mathscr{F})$. As the functor $j_*$ is left exact, $j_*(\mathscr{G})$ is then a subsheaf of $j_*(j^{-1}(\mathscr{F}))$. Let $\rho_{\mathscr{F}}:\mathscr{F}\to j_*(j^{-1}(\mathscr{F}))$ be the canonical homomorphism associated with $\mathscr{F}$ and consider the subsheaf $\widebar{\mathscr{G}}=\rho_{\mathscr{F}}^{-1}(j_*(\mathscr{G}))$ of $\mathscr{F}$. It follows immediately from definition that, for any open subset $V$ of $X$, $\Gamma(V,\widebar{\mathscr{G}})$ is formed by sections $s\in\Gamma(V,\mathscr{F})$ whose restriction on $V\cap U$ is a section of $\mathscr{G}$ over $V\cap U$. In particular, we have $\widebar{\mathscr{G}}|_U=j^{-1}(\widebar{\mathscr{G}})=\mathscr{G}$, and $\widebar{\mathscr{G}}$ is the largest subsheaf of $\mathscr{F}$ inducing $\mathscr{G}$ on $U$. We say the subsheaf $\widebar{\mathscr{G}}$ is the \textbf{canonical extension} of the subsheaf $\mathscr{G}$ of $\mathscr{F}|_U$ to a subsheaf of $\mathscr{F}$.
\begin{proposition}\label{scheme qcoh extension from retrocompact prop}
Let $X$ be a scheme and $U$ be an open subset of $X$ such that the canonical injection $j:U\to X$ is quasi-compact (in other words, $U$ is retrocompact in $X$).
\begin{enumerate}
\item[(a)] For any quasi-coherent $(\mathscr{O}_X|_U)$-module $\mathscr{G}$, $j_*(\mathscr{G})$ is a quasi-coherent $\mathscr{O}_X$-module and we have $j_*(\mathscr{G})|_U=j^*(j_*(\mathscr{G}))=\mathscr{G}$.
\item[(b)] For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ and any quasi-coherent sub-$(\mathscr{O}_X|_U)$-module $\mathscr{G}$ of $\mathscr{F}|_U$, the canonical extension $\widebar{\mathscr{G}}$ of $\mathscr{G}$ is a quasi-coherent sub-$\mathscr{O}_X$-module of $\mathscr{F}$.
\end{enumerate}
\end{proposition}
\begin{proof}
Assertion (a) is a special case of \cref{scheme morphism qcqs qcoh direct image} since $j$ is quasi-separated by \cref{scheme morphism qs permanence prop}(\rmnum{1}), and the relation $j_*(\mathscr{G})|_U=j^*(j_*(\mathscr{G}))=\mathscr{G}$ can be checked directly. By the same reasoning, $j_*(j^*(\mathscr{F}))$ is quasi-coherent, and as $\widebar{G}$ is the inverse image of $j_*(\mathscr{G})$ under the homomorphism $\rho_{\mathscr{F}}:\mathscr{F}\to j_*(j^*(\mathscr{F}))$, assertion (b) follows from \cref{scheme qcoh and exact sequence prop}.
\end{proof}
\begin{corollary}\label{scheme qcoh extension if retrocompact and limit}
Let $X$ be a scheme and $U$ be a quasi-compact open subset of $X$ such that the canonical injection $j:U\to X$ is quasi-compact. Suppose that any quasi-coherent $\mathscr{O}_X$-module is the inductive limit of its quasi-coherent sub-$\mathscr{O}_X$-modules of finite type (this is true if $X$ is an affine scheme). Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module and $\mathscr{G}$ be a quasi-coherent sub-$(\mathscr{O}_X|_U)$-module of finite type of $\mathscr{F}|_U$. Then there exists a quasi-coherent sub-$\mathscr{O}_X$-module $\mathscr{G}'$ of finite type such that $\mathscr{G}'|_U=\mathscr{G}$. 
\end{corollary}
\begin{proof}
We have $\mathscr{G}=\widebar{\mathscr{G}}|_U$, and $\widebar{\mathscr{G}}$ is quasi-coherent by \cref{scheme qcoh extension from retrocompact prop}, hence is the inductive limit of its quasi-coherent sub-$\mathscr{O}_X$-modules $\mathscr{H}_\lambda$ of finite type. Then $\mathscr{G}$ is the inductive limit of the $\mathscr{H}_\lambda|_U$, hence equals to one of $\mathscr{H}_\lambda|_U$ since they are of finite type (\cref{sheaf of module ft over qc surjective homomorphism prop}).
\end{proof}
\begin{remark}\label{scheme qcoh limit if on affine open}
Suppose that for any affine open $U\sub X$ the injection $U\to X$ is quasi-compact. Then if the conclusion of \cref{scheme qcoh extension if retrocompact and limit} holds for any affine open $U$ and any quasi-coherent sub-$(\mathscr{O}_X|_U)$-module of finite type $\mathscr{G}$ of $\mathscr{F}|_U$, it follows that $\mathscr{F}$ is the inductive limit of its quasi-coherent sub-$\mathscr{O}_X$-modules of finite type. In fact, for any affine open $U\sub X$, we have $\mathscr{F}|_U=\widetilde{M}$, where $M$ is a $\Gamma(U,\mathscr{O}_X)$-module, and as the latter is the inductive limit of its finitely generated sub-modules, $\mathscr{F}|_U$ is the inductive limit of its quasi-coherent sub-$(\mathscr{O}_X|_U)$-modules of finite type. Now, by hypotheses, such a submodule is induced over $U$ by a quasi-coherent sub-$\mathscr{O}_X$-module of finite type $\mathscr{G}_{\lambda,U}$ of $\mathscr{F}$. The finite sums of $\mathscr{G}_{\lambda,U}$ are then quasi-coherent of finite type, since the question is local and we can assume that $X$ is affine, where the conclusion is trivial. It then follows that $\mathscr{F}$ is the inductive limit of these finite sums, whence our assertion.
\end{remark}
\begin{corollary}
Under the hypotheses of \cref{scheme qcoh extension if retrocompact and limit}, if $\mathscr{G}$ is a quasi-coherent $(\mathscr{O}_X|_U)$-module of finite type, there exists a quasi-coherent $\mathscr{O}_X$-module $\mathscr{G}'$ such that $\mathscr{G}'|_U=\mathscr{G}$.
\end{corollary}
\begin{proof}
As $\mathscr{F}=j_*(\mathscr{G})$ is quasi-coherent (\cref{scheme qcoh extension from retrocompact prop}) and $\mathscr{F}|_U=\mathscr{G}$, it suffices to apply \cref{scheme qcoh extension if retrocompact and limit} to $\mathscr{F}$. 
\end{proof}
\begin{lemma}\label{scheme qcoh extension if well-order cover}
Let $X$ be a scheme, $(V_\lambda)_{\lambda\in L}$ be a covering of $X$ by affine opens where $L$ is well-ordered, and $U$ be an open subset of $X$. For each $\lambda\in L$, let $W_\lambda=\bigcup_{\mu<\lambda}V_\mu$. Suppose that
\begin{enumerate}
\item[(\rmnum{1})] for any $\lambda\in L$, $V_\lambda\cap W_\lambda$ is quasi-compact;
\item[(\rmnum{2})] the canonical injection $j:U\to X$ is quasi-compact. 
\end{enumerate}
Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ and any quasi-coherent sub-$(\mathscr{O}_X|_U)$-module of finite type $\mathscr{G}$ of $\mathscr{F}|_U$, there exists a quasi-coherent sub-$\mathscr{O}_X$-module $\mathscr{G}'$ of $\mathscr{F}$ such that $\mathscr{G}'|_U=\mathscr{G}$.
\end{lemma}
\begin{theorem}\label{scheme local Noe qcoh extension}
Let $X$ be a scheme and $U$ be an open subset of $X$. Suppose that one of the following conditions is satisfied:
\begin{enumerate}
\item[(a)] $X$ is locally Noetherian;
\item[(b)] $X$ is quasi-compact and quasi-separated and $U$ is quasi-compact.
\end{enumerate}
Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ and any quasi-coherent sub-$(\mathscr{O}_X|_U)$-module of finite type $\mathscr{G}$ of $\mathscr{F}|_U$, there exists a quasi-coherent sub-$\mathscr{O}_X$-module $\mathscr{G}'$ of $\mathscr{F}$ such that $\mathscr{G}'|_U=\mathscr{G}$.
\end{theorem}
\begin{corollary}
With the conditions of \cref{scheme local Noe qcoh extension}, for any quasi-coherent $(\mathscr{O}_X|_U)$-module $\mathscr{G}$ of finite type, there exists a quasi-coherent $\mathscr{O}_X$-module $\mathscr{G}'$ of finite type such that $\mathscr{G}'|_U=\mathscr{G}$.
\end{corollary}
\begin{corollary}\label{scheme local Noe qcoh is inductive limit ft}
Let $X$ be a locally Noetherian scheme or a quasi-compact and quasi-separated scheme. Then any quasi-coherent $\mathscr{O}_X$-module is the inductive limit of its quasi-coherent sub-$\mathscr{O}_X$-modules of finite type.
\end{corollary}
\begin{proof}
This follows from \cref{scheme local Noe qcoh extension} and \cref{scheme qcoh limit if on affine open}.
\end{proof}
\begin{corollary}
Under the hypotheses of \cref{scheme local Noe qcoh is inductive limit ft}, if a quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ is such that any quasi-coherent sub-$\mathscr{O}_X$-module of finite type of $\mathscr{F}$ is generated by its global sections, then $\mathscr{F}$ is generated by its global sections.
\end{corollary}
\begin{proof}
Let $U$ be an affine neighborhood of a point $x\in X$, and let $s$ be a section of $\mathscr{F}$ over $U$. The sub-$\mathscr{O}_X$-module $\mathscr{G}$ of $\mathscr{F}|_U$ generated by $s$ is quasi-coherent and of finite type, hence there exists a quasi-coherent sub-$\mathscr{O}_X$-module of finite type $\mathscr{G}'$ of $\mathscr{F}$ such that $\mathscr{G}'|_U=\mathscr{G}$ (\cref{scheme local Noe qcoh extension}). By hypotheses, there is then a finite number of sections $t_i$ of $\mathscr{G}'$ over $X$ and sections $a_i$ of $\mathscr{O}_X$ over a neighborhood $V\sub U$ of $x$ such that $s|_V=\sum_ia_i\cdot(t_i|_V)$, which proves the corollary.
\end{proof}
\subsection{Scheme-theoretic image}
Let $f:X\to Y$ be a morphism of schemes. If there exists a smallest closed subscheme $Y'$ of $Y$ such that the canonical injection $j:Y'\to Y$ dominates $f$ (or equivalently, the inverse image $f^{-1}(Y')$ is equal to $X$), we then say that $Y'$ is the \textbf{scheme-theoretic image} of $X$ under $f$, or the \textbf{scheme-theoretic image of $\bm{f}$}. If $X$ is a subscheme of $Y$, the scheme-theoretic image of the canonical injection $j:X\to Y$ is called the \textbf{scheme-theoretic closure} of $X$.
\begin{proposition}[\textbf{Transitivity}]\label{scheme theoretic image transitivity}
Let $f:X\to Y$ and $g:Y\to Z$ be morphisms. Suppose that $Y'$ is the scheme-theoretic image of $X$ under $f$, and if $g'$ is the restriction of $g$ to $Y'$, the scheme-theoretic image of $Z'$ under $g'$ exists. Then the scheme-theoretic image of $X$ under $g\circ f$ is equal to $Z'$.
\end{proposition}
\begin{proof}
To say that a closed subscheme $Z_1$ of $Z$ is such that $(g\circ f)^{-1}(Z_1)=X$ signifies that $f^{-1}(g^{-1}(Z_1))=X$, or that $f$ is dominated by the canonical injection $g^{-1}(Z_1)\to Y$. Now, in view of the existence of the scheme-theoretic image $Y'$, for any closed subscheme $Z_1$ of $Z$ having this property, $g^{-1}(Z_1)$ dominates $Y'$, which, if $j:Y'\to Y$ is the canonical injection, amounts to saying that $j^{-1}(g^{-1}(Z_1))=g'^{-1}(Z_1)=Y'$. We then conclude that $Z'$ is the smallest closed subscheme $Z_1$ having this property, whence our claim.
\end{proof}
\begin{corollary}\label{scheme theoretic dense is epimorphism}
Let $f:X\to Y$ be an $S$-morphism such that $Y$ is the scheme-theoretic image of $Y$ under $f$. Let $Z$ be a separated $S$-scheme; if two $S$-morphisms $g_1,g_2:Y\to Z$ are such that $g_1\circ f=g_2\circ f$, then $g_1=g_2$.
\end{corollary}
\begin{proof}
Let $h=(g_1,g_2)_S:Y\to Z\times_SZ$. As the diagonal $T=\Delta_Z(Z)$ is a closed subscheme of $Z\times_SZ$, $Y'=h^{-1}(T)$ is a closed subscheme of $Y$. Put $u=g_1\circ f=g_2\circ f$; we then have $h\circ f=(u,u)_S=\Delta_Z\circ u$. As $\Delta_Z^{-1}(T)=Z$, we have $(h\circ f)^{-1}(T)=u^{-1}(Z)=X$, so $f^{-1}(Y')=X$. We then conclude that the canonical injection $Y'\to Y$ dominates $f$, so $Y'=Y$ by hypothesis. Then by \cref{scheme inverse image of subscheme}, $h$ factors into $\Delta_Z\circ v$ where $v$ is a morphism $Y\to Z$, which implies $g_1=g_2=v$.
\end{proof}
Let $f:X\to Y$ be a morphism and suppose that the scheme-theoretic image $Y'$ of $f$ exists. Then $Y'$ is defined by a quasi-coherent ideal $\mathscr{I}'$ of $\mathscr{O}_Y$, and by definition, $\mathscr{J}'$ is the largest quasi-coherent ideal such that the homomorphism $f^{\#}:\mathscr{O}_Y\to f_*(\mathscr{O}_X)$ factors into $\mathscr{O}_Y\to\mathscr{O}_Y/\mathscr{J}'\to f_*(\mathscr{O}_X)$. This implies that $\mathscr{J}'\sub\ker f^{\#}=\mathscr{J}$; we therefore obtain a case where $Y'$ exists, the one where $\mathscr{J}$ is quasi-coherent, and where $\mathscr{J}'=\mathscr{J}$.
\begin{proposition}\label{scheme theoretic image exist if}
Let $f:X\to Y$ be a morphism. Then the scheme-theoretic image of $X$ under $f$ exists if one of the following conditions is satisfied:
\begin{enumerate}
\item[(a)] $f_*(\mathscr{O}_X)$ is quasi-coherent (which is the case if $f$ is quasi-compact and quasi-separated).
\item[(b)] $X$ is reduced.
\end{enumerate}
In this case, the underlying space of $Y'$ is equal to $\widebar{f(X)}$, and if $f$ factors into
\[\begin{tikzcd}
X\ar[r,"f'"]&Y'\ar[r,"Y"]&Y
\end{tikzcd}\]
where $j$ is the canonical injection, $f'$ is scheme-theoretic dominant. Moreover, if $X$ is reduced (resp. integral), so is $Y'$. 
\end{proposition}
\begin{proof}
The case (a) is immediate by our previous argument; moreover, as $\mathscr{O}_Y/\mathscr{J}\to f_*(\mathscr{O}_X)$ is then injective, this shows that $f'$ is scheme-theoretic dominant. We still need to verify that the closed subscheme of $Y$ defined by $\mathscr{J}=\ker f^{\#}$ has underlying space $\widebar{f(X)}$. Since the support of $f_*(\mathscr{O}_X)$ is contained in $\widebar{f(X)}$, we have $\mathscr{J}_y=\mathscr{O}_y$ for $y\notin\widebar{f(X)}$, so the support pf $\mathscr{O}_Y/\mathscr{J}$ is contained in $\widebar{f(X)}$. Moreover, this support is closed and contains $f(X)$: if $y\in f(X)$, the identity element of the ring $(f_*(\mathscr{O}_X))_y$ is nonzero, being the germ at $y$ of the section $1\in\Gamma(X,\mathscr{O}_X)=\Gamma(Y,f_*(\mathscr{O}_X))$; as this is the image of the identity element under $f^{\#}$, it is not contained in $\mathscr{J}_y$, so $\mathscr{O}_y/\mathscr{I}_y\neq 0$; this proves our first claim. The case (b) follows from \cref{scheme morphism from reduced factorization}, because there is a smallest closed subscheme $Z$ with underlying space $\widebar{f(X)}$ such that $f(X)\sub Z$.
\end{proof}
\begin{proposition}\label{scheme theoretic over open subset char}
Suppose the notations of \cref{scheme theoretic image exist if} is satisfied, and let $Y'$ be the scheme-theoretic image of $X$ under $f$. For any open subset $V$ of $Y$, let $f_V:f^{-1}(V)\to V$ be the restriction of $f$. Then the scheme-theoretic image of $f^{-1}(V)$ under $f_V$ exists and is equal to the oepn subscheme $V\cap Y'$ of $Y'$.
\end{proposition}
\begin{proof}
Put $X'=f^{-1}(V)$; as the direct image of $\mathscr{O}_{X'}$ is the restriction of $f_*(\mathscr{O}_X)$ to $V$, it is clear that the kernel of the homomorphism $\mathscr{O}_V\to (f_V)_*(\mathscr{O}_{X'})$ is the restriction of $\mathscr{J}$ to $V$, whence the assertion.
\end{proof}
\begin{proposition}\label{scheme theoretic closure exist if qc}
Let $Y$ be a subscheme of a scheme $X$, such that the canonical injection $j:Y\to X$ is quasi-compact. Then the scheme-theoretic closure of $Y$ exists and has $\widebar{Y}$ as underlying space.
\end{proposition}
\begin{proof}
It suffices to apply \cref{scheme theoretic image exist if} to the injection $j$, which is separated (\cref{scheme morphism separated permanence prop}) and quasi-compact by hypothesis.
\end{proof}
With these notations, let $\widebar{Y}$ be the scheme-theoretic closure of $Y$ in $X$. If the injection $\widebar{Y}\to X$ is quasi-compact, and if $\mathscr{I}$ is the quasi-coherent ideal of $\mathscr{O}_X|_{\widebar{Y}}$ defining the closed subscheme $Y$ of $\widebar{Y}$, then the quasi-coherent ideal of $\mathscr{O}_X$ defining $\widebar{Y}$ is the canonical extension (\cref{scheme qcoh extension from retrocompact prop}) $\widebar{\mathscr{I}}$ of $\mathscr{I}$, because it is evidently the largest quasi-coherent ideal of $\mathscr{O}_X$ inducing $\mathscr{I}$ over $Y$.
\begin{corollary}\label{scheme section over closure zero if restriction}
Under the hypothesis of \cref{scheme theoretic closure exist if qc}, any section of $\mathscr{O}_{\widebar{Y}}$ over an open subset $V$ of $\widebar{Y}$ that is zero on $V\cap Y$ is zero.
\end{corollary}
\begin{proof}
In view of \cref{scheme theoretic over open subset char}, we can assume that $V=\widebar{Y}$. If we consider sections of $\mathscr{O}_{\widebar{Y}}$ over $\widebar{Y}$ as $\widebar{Y}$-sections of $\widebar{Y}\otimes_{\Z}\Z[T]$, which is separated over $\widebar{Y}$, the assertion is then a particular case of \cref{scheme theoretic dense is epimorphism}.
\end{proof}
\section{Rational maps over schemes}
\subsection{Rational maps and rational functions}
Let $X$ and $Y$ be two schemes, $U$ and $V$ be open dense sets of $X$, and $f$ (resp. $g$) be a morphism from $U$ (resp. $V$) to $Y$. We say the morphisms $f$ and $g$ are equivalent if they coincide over an open subset dense in $U\cap V$. As the intersection of finitely many open dense subsets of $X$ is an open dense subset of $X$, it is clear that this relation is an equivalence relation.\par
Given two schemes $X$ and $Y$, a \textbf{rational map} from $X$ to $Y$ is defined to be an equivalent class of morphisms from an open dense subset of $X$ to $Y$. If $X$ and $Y$ are $S$-schemes, this class is called an \textbf{rational $S$-map} is there exists an $S$-morphism in it. An rational $S$-map from $S$ to $X$ is called an \textbf{rational $\bm{S}$-section} of $X$. The rational $X$-sections of the $X$-scheme $X\otimes_{\Z}\Z[T]$ (where $T$ is an indeterminate) are called the \textbf{rational functions over} $X$ (cf. \cref{scheme X-sections of X[T] char}). A rational map $f$ from $X$ to $Y$ is usually denoted by $f:X\dashrightarrow Y$.\par
Let $f:X\dashrightarrow Y$ be a rational map and $U$ be an open subset of $X$. If $f_1,f_2$ are morphisms belonging to the class $f$, defined respectively over the open dense sets $V_1$, $V_2$ of $X$, the restrictions $f_1|_{U\cap V_1}$ and $f_2|_{U\cap V_2}$ coincide on $U\cap V_1\cap V_2$, which is dense in $U$; the class of morphisms $f$ therefore defines a rational map $U\dashrightarrow Y$, called the \textbf{restriction} of $f$ to $U$ and denoted by $f|_U$.\par
It is clear that we have a canonical map from $\Hom_S(X,Y)$ to the set of rational $S$-maps from $X$ to $Y$, which associates any $S$-morphism $f:X\to Y$ to the rational $S$-map it belongs to. If we denote by $\Gamma_{\rat}(X/Y)$ the set of rational $Y$-sections of $X$, we then have a canonical map $\Gamma(X/Y)\to\Gamma_{\rat}(X/Y)$. It is also clear that if $X$ and $Y$ are two $S$-schems, the set of rational $S$-maps from $X$ to $Y$ is canonically identified with $\Gamma_{\rat}((X\times_SY)/X)$.\par
In view of \cref{scheme X-sections of X[T] char}, we see the rational functions over $X$ are canonically identified with the equivalent classes of sections of the structural sheaf $\mathscr{O}_X$ over open dense sets of $X$, where two sections are equivalent if they coincide over an open dense subset of the intersection of their defining domain. In partiuclar, we see the rational functions over $X$ form a ring $K(X)$.\par
If $X$ is an irreducible scheme, any nonempty open subset of $X$ is dense; we can also say that the non-empty open sets of $X$ are the open neighborhoods of the generic point $x$ of $X$. To say that two morphisms from nonempty open subsets of $X$ to $Y$ are equivalent therefore means in this case that they have the same germ at the point $x$. In other words, rational maps (resp. rational $S$-maps) $X\dashrightarrow Y$ are identified with the germs of morphisms (resp. of $S$-morphisms) of non-empty open subsets of $X$ to $Y$ at the generic point $x$ of $X$. In particular:
\begin{proposition}\label{scheme irr rational function iso to stalk at generic}
If $X$ is an irreducible scheme, the ring $K(X)$ of rational functions over $X$ is canonically identified with the local ring $\mathscr{O}_{X,x}$ at the generic point $x$ of $X$. This is a local ring of zero dimension, and therefore an Artinian local ring if $X$ is Noetherian. It is a field if $X$ is integral, and is identified with the fraction field of $\Gamma(X,\mathscr{O}_X)$ if $X$ is moreover affine.
\end{proposition}
\begin{proof}
Since we can identify rational functions with sections over $X$, the first assertion follows from the definiton of stalks. For the second one, we can assume that $X$ is affine with ring $A$; then $\p_x$ is the nilradical of $A$, and in particular $\mathscr{O}_{X,x}$ has zero dimension. If $A$ is integral, $\p_x=(0)$ and $\mathscr{O}_{X,x}$ is the fraction field of $A$. Finally, if $A$ is Noetherian, then $\p_x$ is nilpotent and $\mathscr{O}_{X,x}=A_x$ is Artinian.
\end{proof}
If $X$ is integral, the ring $\mathscr{O}_{X,z}$ is integral for any $z\in X$. Any affine open $U$ containing $x$ must contain $x$ as its generic point, and $\mathscr{O}_{X,z}$, equal to a fraction field of $\Gamma(U,\mathscr{O}_X)$, is identified with $K(X)$. We then conclude that $K(X)$ is identified with the fraction field of $\mathscr{O}_{X,z}$, and in this way, $\mathscr{O}_{X,z}$ is canonically identified with a subring of $K(X)$, so that a germ $s\in\mathscr{O}_{X,z}$ is canonically identified with a rational function over $X$.
\begin{proposition}\label{scheme local finite rational map is product}
Let $X$ and $Y$ be two $S$-schemes such that the family $(X_\lambda)$ of irreducible components of $X$ is locally finite. For each $\lambda$, let $x_\lambda$ be the generic point of $X_\lambda$. If $R_\lambda$ is the set of germs at $x_\lambda$ of $S$-morphisms from open subsets of $X$ to $Y$, the set of rational $S$-maps from $X$ to $Y$ is identified with the product of $R_\lambda$. In particular, the ring of rational functions over $X$ is identified with the product of the local rings $\mathscr{O}_{X,x_\lambda}$.
\end{proposition}
\begin{proof}
The set of the intersections $X_\lambda\cap X_\mu$ for $\lambda\neq\mu$ is then locally finite, so their union is closed and contains the maximal points of $X$. If we set $X'_\lambda=X_\lambda-\bigcup_{\mu\neq\lambda}X_\lambda\cap X_\mu$, then $X'_\lambda$ is irreducible, with generic point equal to that of $X_\lambda$, and pairwise disjoint with union dense in $X$. For any open dense subset $U$ of $X$, $U'_\lambda=U\cap X'_\lambda$ is a nonempty open dense subset of $X'_\lambda$, and $U'_\lambda$ are pairwise disjoint with $U'=\bigcup_\lambda U'_\lambda$ closed in $X$. To give a morphism from $U'$ to $Y$ is then equivalent to giving (arbitrarily) a morphism from each of the $U'_\lambda$ in $Y$, so the assertion follows.
\end{proof}
\begin{corollary}\label{scheme affine Noe rational function is total fraction ring}
Let $A$ be a Noetherian ring and $X=\Spec(A)$. The ring of rational function functions over $X$ is identified with the total fraction ring $Q(A)$.
\end{corollary}
\begin{proof}
Let $S$ be the complement of the union of minimal prime ideals of $A$. Then by \cref{Spec of ring open dense char}, the ring of sections $\Gamma(D(f),\mathscr{O}_X)$ is identified with $A_f$, so $D(f)$ with $f\in S$ form a cofinal subset of the open dense sets of $X$, and the ring of rational functions over $X$ is then identified with the inductive limit of $A_f$, $f\in S$, which is exactly $Q(A)$.
\end{proof}
Suppose that $X$ is irreducible with generic point $x$. As any nonempty open set $U$ of $X$ contains $x$, and therefore contains any generalization $z\in X$, any morphism $U\to Y$ can be composed with the canonical morphism $\Spec(\mathscr{O}_{X,x})\to X$ (\cref{scheme local scheme correspond generalization}). Two morphisms from nonempty open subsets of $X$ to $Y$ which coincide on a smaller open subset then give the same morphism $\Spec(\mathscr{O}_{X,x})\to Y$. In other words, to any rational map $X$ to $Y$, there corresponds a well-defined morphism $\Spec(\mathscr{O}_{X,x})\to Y$.
\begin{proposition}\label{scheme irre rational map correspond local ring morphism}
Let $X$ and $Y$ be $S$-schemes. Suppose that $X$ is irreducible with generic point $x$, and $Y$ is of finite type over $S$. Then two rational $S$-maps $X$ to $Y$ corresponding to the same $S$-morphism $\Spec(\mathscr{O}_{X,x})\to Y$ are identical. If moreover $S$ is locally of finite presentation over $S$, then any $S$-morphism $\Spec(\mathscr{O}_{X,x})\to Y$ corresponds to a rational $S$-map from $X$ to $Y$.
\end{proposition}
\begin{proof}
Given that every non-empty open subset of $X$ is dense, this result follows immediately from \cref{scheme local ft morphism determined local}.
\end{proof}
\begin{corollary}\label{scheme irre rational map and K(X) value point}
Suppose that $X$ is irreducible with generic point $x$ and $Y$ is localy of finite presentation. Then the rational $S$-maps from $X$ to $Y$ are identified with the points of $Y$ with values in the $S$-scheme $\Spec(\mathscr{O}_{X,x})$.
\end{corollary}
\begin{proof}
This is just a reformulation of \cref{scheme irre rational map correspond local ring morphism}.
\end{proof}
\begin{corollary}\label{scheme irre rational map and local ring homomorphism}
Suppose that $X$ is irreducible with generic point $x$ and $Y$ is localy of finite presentation. Let $s$ be the image of $x$ in $S$. Then giving a rational $S$-map from $X$ to $Y$ is equivalent to giving a point $y$ of $Y$ lying over $s$ and a $\mathscr{O}_{S,s}$-homomorphism $\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}=K(X)$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme irre rational map correspond local ring morphism} and \cref{scheme local morphism factors through prop}.
\end{proof}
\begin{corollary}\label{scheme irre rational map depend on local ring}
Suppose that $X$ is irreducible with generic point $x$ and $Y$ is localy of finite presentation, then the rational $S$-maps from $X$ to $Y$ (with $Y$ given) only depends on the $S$-scheme $\Spec(\mathscr{O}_{X,x})$ and in particular remain the same if we replace $X$ by $\Spec(\mathscr{O}_{X,z})$, $z\in X$.
\end{corollary}
\begin{proof}
In fact, if $z\in\widebar{\{x\}}$ then $x$ is the generic point of $Z=\Spec(\mathscr{O}_{X,z})$ and $\mathscr{O}_{X,x}=\mathscr{O}_{Z,x}$.
\end{proof}
\begin{corollary}\label{scheme integral rational map correspond to residue field}
Suppose that $X$ is integral with generic point $x$ and $Y$ is localy of finite presentation. Let $s$ be the image of $x$ in $S$. Then following dates are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] a rational $S$-map from $X$ to $Y$;
\item[(\rmnum{2})] a point of $Y\otimes_S\kappa(s)$ with values in the extension $K(X)$ of $\kappa(s)$;
\item[(\rmnum{3})] a point $y\in Y$ over $s$ and an $\kappa(s)$-homomorphism $\kappa(y)\to\kappa(x)=K(X)$.
\end{enumerate}
\end{corollary}
\begin{proof}
The points of $Y$ over $s$ belong to $Y\otimes_S\kappa(s)$ and the $\mathscr{O}_{S,s}$-homomorphisms $\mathscr{O}_{Y,y}\to K(X)$ are $\kappa(s)$-homomorphisms $\kappa(y)\to K(X)$, since $K(X)$ is a field.
\end{proof}
\begin{corollary}\label{scheme integral algebraic rational map correspond to residue field}
Let $k$ be a field and $X,Y$ be two schemes locally algebraic over $k$. Suppose that $X$ is integral, then the rational $k$-maps from $X$ to $Y$ are identified with the points of $Y$ with values in the extension $K(X)$ of $k$.
\end{corollary}
\subsection{Defining domain of a rational map}
Let $X$ and $Y$ be schemes, $f$ a rational map from $X$ to $Y$. We say $f$ is \textbf{defined at a point $x\in X$} if there exists an open dense subset $U$ containing $x$ and a morphism $U\to Y$ representing $f$. The set of points $x\in X$ where $f$ is defined is called the \textbf{defining domain} of the rational map $f$. It is clearly an open dense subset of $X$.
\begin{proposition}\label{scheme reduced to separated rational extend to domain}
Let $X$ and $Y$ be two $S$-schemes such that $X$ is reduced and $Y$ is separated over $S$. Let $f$ be a rational $S$-map from $X$ to $Y$, and $U_0$ be its domain. There then exists a unique $S$-morphism $U_0\to Y$ belonging to the class $f$. 
\end{proposition}
\begin{proof}
For any morphism $U\to Y$ belonging to the class $f$, we necessarily have $U\sub U_0$, so we only need to prove that if $U_1,U_2$ are two dense subsets of $X$ and $f_i:U_i\to Y$ ($i=1,2$) are two $S$-morphisms that coincide on an open subset $V\sub U_1\cap U_2$, then $f_1$ and $f_2$ coincide on $U_1\cap U_2$. For this, we can clearly assume that $X=U_1=U_2$. As $X$ (hence $V$) is reduced, $X$ is smallest closed subscheme of $X$ dominating $V$ (\cref{scheme morphism from reduced factorization}). Let $g=(f_1,f_2)_S:X\to Y\times_SY$; as by hypothesis the diagonal $T=\Delta_Y(Y)$ is a closed subscheme of $Y\times_SY$, $Z=g^{-1}(T)$ is a closed subscheme of $X$. If $h:V\to Y$ is the restriction of $f_1$ and $f_2$ to $V$, the restriction of $g$ to $V$ is $\tilde{g}=(h,h)_S$, which factors into $\tilde{g}=\Delta_Y\circ h$. As $\Delta_Y^{-1}(T)=Y$, we have $\tilde{g}^{-1}(T)=V$, and $Z$ is therefore a closed subscheme of $X$ inducing the subscheme structure on $V$, hence dominates $V$, and this implies $Z=X$. From the relation $g^{-1}(T)=X$, we deduce that $g$ factors into $\Delta_Y\circ f$, where $f$ is a morphism $X\to Y$ (\cref{scheme inverse image of subscheme}), and we have $f_1=f_2=f$ from the definition of the diagonal morphism.
\end{proof}
It is clear that the morphism $U_0\to Y$ defined in \cref{scheme reduced to separated rational extend to domain} is the unique morphism in the class $f$ that admits no further extension to open dense subsets of $X$ containing $U_0$. Under the conditions of \cref{scheme reduced to separated rational extend to domain}, we can then identify the rational maps from $X$ to $Y$ with the morphisms unextendable to open dense subsets of $X$ to $Y$.
\begin{corollary}\label{scheme reduced to separated rational correspond to defined map}
Let $X$ and $Y$ be two $S$-schemes such that $X$ is reduced and $Y$ is separated over $S$. Let $U$ be an open dense subset of $X$, then there is a canonical bijective correspondence between the $S$-morphisms from $U$ to $Y$ and the rational $S$-maps from $X$ to $Y$ defined at each point of $U$.
\end{corollary}
\begin{proof}
In view of \cref{scheme reduced to separated rational extend to domain}, for any $S$-morphism $f:U\to Y$, there exists a rational $S$-map $\bar{f}$ from $X$ to $Y$ which extends $f$.
\end{proof}
\begin{corollary}\label{scheme reduced to separated rational extension only for Z}
Let $S$ be a separated scheme, $X$ be a reduced $S$-scheme, $Y$ be an $S$-scheme, and $f:U\to Y$ be an $S$-morphism from an open dense subset $U$ of $X$ to $Y$. If $\bar{f}$ is the rational $\Z$-map from $X$ to $Y$ extending $f$, $\bar{f}$ is an $S$-morphism (and therefore the rational $S$-map from $X$ to $Y$ extending $f$).
\end{corollary}
\begin{proof}
In fact, if $\varphi:X\to S$ and $\psi:Y\to S$ are the structural morphisms, $U_0$ is the defining domain of $\bar{f}$, and $j:U_0\to X$ is the injection, it suffices to prove that $\psi\circ\bar{f}=\varphi\circ j$, which follows from the proof of \cref{scheme reduced to separated rational extend to domain}, since $f$ is an $S$-morphism.
\end{proof}
\begin{corollary}\label{scheme reduced to separated rational function extension}
Let $X$ and $Y$ be $S$-schemes. Suppose that $X$ is reduced and $X,Y$ are spearated over $S$. Let $p:Y\to X$ be an $S$-morphism, $U$ be an open dense subset of $X$, and $f$ be a $U$-section of $Y$. Then the rational map $\bar{f}$ from $X$ to $Y$ extending $f$ is a rational $X$-section of $Y$.
\end{corollary}
\begin{proof}
We only need to prove that $p\circ\bar{f}$ is the identity on the defining domain of $\bar{f}$; since $X$ is separated over $S$, this follows from the proof of \cref{scheme reduced to separated rational extend to domain}.
\end{proof}
\begin{corollary}\label{scheme reduced rational function correspond section}
Let $X$ be a reduced scheme and $U$ be an open dense subset of $X$. There exists a canonical bijective correspondence between sections of $\mathscr{O}_X$ over $U$ and rational functions $f$ over $X$ defined on each point of $U$.
\end{corollary}
\begin{proof}
It suffices to remark that the $X$-scheme $X\otimes_{\Z}\Z[T]$ is separated over $X$ by \cref{scheme morphism separated permanence prop}.
\end{proof}
\begin{corollary}\label{scheme reduced morphism sp section extend iff}
Let $Y$ be a reduced scheme, $f:X\to Y$ be a separated morphism, $U$ be an open dense subset of $Y$, $g:U\to f^{-1}(U)$ be a $U$-section of $f^{-1}(U)$, and $Z$ the reduced subscheme of $X$ induced on $\widebar{g(U)}$. For $g$ to be the restriction of a $Y$-section of $X$, it is necessary and sufficient that the restriction of $f$ to $Z$ is an isomorphism from $Z$ to $Y$.
\end{corollary}
\begin{proof}
The restriction of $f$ to $f^{-1}(U)$ is a separated morphism (\cref{scheme morphism separated permanence prop}(\rmnum{1})), so $g$ is a closed immersion by \cref{scheme morphism to separated graph is closed}, and therefore $g(U)=Z\cap f^{-1}(U)$ coincides with the subscheme induced by $Z$ over the open subset $g(U)$ of $Z$. It is then clear that the given condition is sufficient, since if $f_Z:Z\to Y$ is an isomorphism and $\bar{g}:Y\to Z$ is the inverse morphism, then $\bar{g}$ extends $g$. Conversely, if $g$ is the restriction to $U$ of a $Y$-section $h$ of $X$, $h$ is then a closed immersion by \cref{scheme morphism to separated graph is closed}, so $h(Y)$ is clossed, and as it contains $g(U)$ and we have (as $h$ is continuous) $h(Y)=h(\widebar{U})\sub\widebar{h(U)}=\widebar{g(U)}$, we conclude that $h(Y)=Z$. It then follows from \cref{scheme closed subset reduced subscheme} that $h$ is necessarily an isomorphism from $Y$ to the closed subscheme $Z$ of $X$, so $f|_Z$ is also an isomorphism. 
\end{proof}
Let $X$ and $Y$ be two $S$-schemes, where $X$ is reduced and $Y$ is separated over $S$. Let $f$ be a rational $S$-map from $X$ to $Y$, and let $x$ be a point of $X$. We can compose $f$ with the canonical morphism $\Spec(\mathscr{O}_{X,x})\to X$ provided that the trace on $\Spec(\mathscr{O}_{X,x})$ of the defining domain of $f$ is dense in $\Spec(\mathscr{O}_{X,x})$ (identified with the set $z\in X$ such as $x\in\widebar{\{z\}}$ (cf. \cref{scheme local scheme correspond generalization}). This happens if the family of irreducible components of $X$ is \textit{locally finite}:
\begin{lemma}\label{scheme local finite open dense in local scheme iff}
Let $X$ be a scheme such that the family of irreducible components of $X$ is locally finite, and $x$ be a point of $X$. The irreducible components of $\Spec(\mathscr{O}_{X,x})$ are then the traces over $\Spec(\mathscr{O}_{X,x})$ of the irreducible components of $X$ containing $x$. For an open subset $U$ of $X$ to be such that $U\cap\Spec(\mathscr{O}_{X,x})$ is dense in $\Spec(\mathscr{O}_{X,x})$, it is necessary and sufficient that it meets the irreducible components of $X$ containing $x$ (and this is true in particular if $U$ is dense in $X$).
\end{lemma}
\begin{proof}
The second assertion clearly follows from the first one. As $\Spec(\mathscr{O}_{X,x})$ is contained in any affine open $U$ containing $x$ and the irreducible components of $U$ containing $x$ are the traces of the irreducible components of $X$ containing $x$ on $U$ (\cref{topo space open irre closed intersection}), we can suppose that $X$ is affine with ring $A$. Then the prime ideals of $A_x$ correspond to prime ideals of $A$ contained in $\p_x$, so the minimal prime ideals of $A_x$ correspond to minimal prime ideals of $A$ contained in $\p_x$, and the lemma follows from \cref{Spec of ring open dense char}.
\end{proof}
Suppose that we are under the assumption of \cref{scheme local finite open dense in local scheme iff}. If $U$ is the defining domain of definition of the rational $S$-map $f$, denote by $f'$ the rational map from $\Spec(\mathscr{O}_{X,x})$ to $Y$ which coincides with $f$ over $U\cap\Spec(\mathscr{O}_{X,x})$; we will say that this rational map is \textbf{induced} by $f$.
\begin{proposition}\label{scheme reduced to separated rational map define iff on local}
Let $S$ be a scheme, $X$ be a reduced $S$-scheme, and $Y$ be a separted $S$-scheme that is locally of finite presentation over $S$. Suppose that the family of irreducible components of $X$ is locally finite. Let $f$ be a rational $S$-map from $X$ to $Y$ and $x$ be a point of $X$. For $f$ to be defined at the point $x$, it is necessary and sufficient that the rational map $f'$ from $\Spec(\mathscr{O}_{X,x})$ to $Y$ induced by $f$ is a morphism. 
\end{proposition}
\begin{proof}
The conditions is clearly necessary since $\Spec(\mathscr{O}_{X,x})$ is contained in any open subset containing $x$. We now prove the sufficiency, so suppose that $f'$ is a morphism. In view of \cref{scheme local ft morphism determined local}, there exists an open neighborhood $U$ of $x$ in $X$ and an $S$-morphism $g:U\to Y$ inducing $f'$ on $\Spec(\mathscr{O}_{X,x})$. The point is that $U$ is not necessarily dense in $X$, so we want to extend $g$ to a morphism defined on an open dense subset of $X$. Now by \cref{scheme local finite open dense in local scheme iff}, there are finitely many irreducible components $X_i$ of $X$ containing $x$, and we can assume that these are the only ones meeting $U$, by replacing $U$ with a smaller open subset. As the generic points of $X_i$ belong to the defining domain of $f$ and to $U$, we see that $f$ and $g$ coincide over a non-empty open dense subset of each of the $X_i$ (\cref{scheme local ft morphism determined local}). Consider the morphism $f_1$ defined on an open dense subset of $U\cup(X-\widebar{U})$ which equals to $g$ over $U$ and to $f$ over the intersection of $X-\widebar{U}$ and the defining domain of $f$ (we also note that each $X_i$ is contained in $\widebar{U}$). As $U\cup(X-\widebar{U})$ is dense in $X$, $f_1$ and $f$ coincide on an open dense subset of $X$, and $f$ is an extension of $f_1$. Since $f_1$ is defined at $x$, this shows $f$ is defined at $x$.
\end{proof}
\subsection{Sheaf of rational functions}
Let $X$ be a scheme. For each open subset $U$ of $X$, we denote by $K(U)$ the ring of rational functions over $U$, which is an $\Gamma(U,\mathscr{O}_X)$-algebra. Moreover, if $V\sub U$ is a second open subset of $X$, any section of $\mathscr{O}_X$ over a dense subset of $U$ restricts to a section over a dense subset of $V$, and if two sections coincide over an open dense subset of $U$, their restriction also coincide over a smaller open dense subset of $V$. We then define a homomorphism of algebras $\Res^U_V:K(U)\to K(V)$, and it is clear that for $U\sups V\sups W$ open in $X$ we have $\Res^U_W=\Res^V_W\circ\Res^U_V$. Therefore, we get a presheaf of algebras over $X$. The associated sheaf of $\mathscr{O}_X$-algebras over $X$ is then called the \textbf{sheaf of rational functions} over the scheme $X$, and denoted by $\mathscr{K}_X$. For any open subset $U$ of $X$, it is clear that the restriction $\mathscr{K}_X|_U$ is equal to $\mathscr{K}_U$.
\begin{proposition}\label{scheme local finite rational sheaf qcoh and section}
Let $X$ be a scheme such that the family $(X_\lambda)$ of irreducible components of $X$ is locally finite. Then the $\mathscr{O}_X$-module $\mathscr{K}_X$ is quasi-coherent and for any open subset $U$ of $X$, $K(U)$ is equal to $\Gamma(U,\mathscr{K}_X)$ and is identified with the product of the local rings of the generic points $x_\lambda$ of the irreducible components $X_\lambda$ such that $X_\lambda\cap U\neq\emp$.
\end{proposition}
\begin{proof}
The fact that $K(U)$ is identified with the product follows from \cref{scheme local finite rational map is product}. We now show that the presheaf $U\mapsto K(U)$ is a sheaf. Consider an open subset $U$ of $X$ and an open covering $(V_\alpha)$ of $U$. If $s_\alpha\in K(V_\alpha)$ are such that $s_\alpha$ and $s_\beta$ coincide over $V_\alpha\cap V_\beta$ for each pair of indices, we then conclude that for any index $\lambda$ such that $U\cap X_\lambda\neq\emp$, the component in $K(X_\lambda)$ of all $s_\alpha$ such that $V_\alpha\cap X_\lambda\neq\emp$ are the same. Denoting by $t_\lambda$ this component, it is clear that the element of $K(U)$ with component $t_\lambda$ in $K(X_\lambda)$ has restriction $s_\alpha$ on each $V_\alpha$. Finally, to see the sheaf $\mathscr{K}_X$ is quasi-coherent, we can limit ourselves to the case $X=\Spec(A)$ is affine with finitely many irreducible components; by taking for $U$ the affine open sets of the form $D(f)$, where $f\in A$, it follows from the above argument that we have $\mathscr{K}_X=\widetilde{M}$, where $M$ is the direct sum of the $A$-modules $A_{x_\lambda}$.
\end{proof}
\begin{corollary}\label{scheme reduced rational sheaf direct product}
Let $X$ be a reduced scheme with irreducible components $(X_i)_{1\leq i\leq n}$, endowed with the reduced subscheme structures. If $\iota_i:X_i\to X$ is the canonical injection, $\mathscr{K}_X$ is the direct product of the $\mathscr{O}_X$-algebras $(\iota_i)_*(\mathscr{K}_{X_i})$.
\end{corollary}
\begin{proof}
This is a particular case of \cref{scheme local finite rational sheaf qcoh and section}, in view of the conditions in that proposition.
\end{proof}
\begin{corollary}\label{scheme irreducible qcoh K(X) module simple}
If $X$ is irreducible, any quasi-coherent $\mathscr{K}_X$-module $\mathscr{F}$ is a simple sheaf. 
\end{corollary}
\begin{proof}
It suffices to show that any $x\in X$ admits a neighborhood $U$ such that $\mathscr{F}|_U$ is a simple sheaf, which means we can assume that $X$ is affine. We can then suppose that $\mathscr{F}$ is the cokernel of a homomorphism $\mathscr{K}_X^{\oplus I}\to\mathscr{K}_X^{\oplus J}$, and it all boils down to seeing that $\mathscr{K}_X$ is a simple sheaf. But this is evident since $\Gamma(U,\mathscr{K}_X)=K(X)$ for any nonempty open subset $U$, since $U$ contains the generic point of $X$.
\end{proof}
\begin{corollary}\label{scheme irreducible qcoh tensor with K(X) simple}
If $X$ is irreducible, for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is a simple sheaf. If moreover $X$ is reduced (hence integral), $\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is isomorphic to a sheaf of the form $\mathscr{K}_X^{\oplus I}$.
\end{corollary}
\begin{proof}
The first claim follows from \cref{scheme irreducible qcoh K(X) module simple}, and the second one follows from the fact that if $X$ is integral then $K(X)$ is a field.
\end{proof}
\begin{proposition}\label{scheme local finite K(X) qcoh and injection}
Let $X$ be a scheme such that the family $(X_\lambda)$ of irreducible components of $X$ is locally finite. Then $\mathscr{K}_X$ is a quasi-coherent $\mathscr{O}_X$-algebra. If $X$ is reduced, the canonical homomorphism $\mathscr{O}_X\to\mathscr{K}_X$ is injective.
\end{proposition}
\begin{proof}
Since the question is local, the first claim follows from \cref{scheme local finite rational sheaf qcoh and section}. The second one follows from \cref{scheme reduced rational function correspond section}.
\end{proof}
Let $X$ and $Y$ be integral schemes, so that $\mathscr{K}_X$ (resp. $\mathscr{K}_Y$) is a quasi-coherent $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module). Let $f:X\to Y$ be a dominant morphism; then there exists a canonical homomorphism of $\mathscr{O}_X$-modules:
\[\tau:f^*(\mathscr{K}_Y)\to\mathscr{K}_X.\]
Suppose that $X=\Spec(A)$ and $Y=\Spec(B)$ are affine with integral domains $A$ and $B$, then $f$ corresponds to the injective homomorphism $B\to A$ (\cref{Spec of ring map dominant iff ker nilpotent}), which extens to a monomorphism $L\to K$ of fraction fields. The homomorphism $\tau$ then corresponds to the canonical homomorphism $L\otimes_BA\to K$.\par
In the general case, for any couple of affine opens $U\sub X$, $V\sub Y$ such that $f(U)\sub V$, we define similarly a homomorphism $\tau_{U,V}$ and note that if $U'\sub U$, $V'\sub V$ and $f(U')\sub V'$, then $\tau_{U,V}$ extends $\tau_{U',V'}$. If $x$ and $y$ are the generic points of $X$ and $Y$, respectively, then $f(x)=y$ and
\[(f^*(\mathscr{K}_Y))_x=\mathscr{O}_{Y,y}\otimes_{\mathscr{O}_{Y,y}}\mathscr{O}_{X,x}=\mathscr{O}_{X,x}\]
and $\tau_x$ is therefore an isomorphism. However, the homomorphism $\tau$ is usually not an isomorphism: for example, if $B=L$ is a field containing the integral domain $A$ and $A$ is not a field, the canonical homomorphism $L\otimes_BA\to K$ is then the canonical homomorphism $A\to K$, which is not bijective. 
\subsection{Torsion sheaves and torsion-free sheaves}
Let $X$ be a reduced scheme whose family of irreducible components is locally finite. For any $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphism $\mathscr{O}_X\to\mathscr{K}_X$ is injective by \cref{scheme local finite K(X) qcoh and injection}, and defines a homomorphism $\mathscr{F}\to\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ which on each stalk, is none other than the homomorphism $z\mapsto z\otimes 1$ from $\mathscr{F}_x$ to $\mathscr{F}_x\otimes_{\mathscr{O}_{X,x}}\mathscr{K}_{X,x}$. The kernel $\mathscr{T}$ (also denoted by $\mathscr{T}(\mathscr{F})$) of this homomorphism is a sub-$\mathscr{O}_X$-module $\mathscr{F}$ is called the \textbf{torsion sheaf} of $\mathscr{F}$, which is quasi-coherent if $\mathscr{F}$ is quasi-coherent (\cref{scheme local finite rational sheaf qcoh and section}). The sheaf $\mathscr{F}$ is called \textbf{torsion-free} if $\mathscr{T}=0$, and a \textbf{torsion sheaf} if $\mathscr{T}=\mathscr{F}$. For any $\mathscr{O}_X$-module $\mathscr{F}$, $\mathscr{F}/\mathscr{T}$ is torsion-free.
\begin{proposition}\label{scheme integral qcoh torsion-free iff}
If $X$ is an integral scheme, for a quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ to be torsion-free, it is necessary and sufficient that it is isomorphic to a sub-$\mathscr{O}_X$-module $\mathscr{G}$ of a simple sheaf of the form $\mathscr{K}_X^{\oplus I}$, generated (as a $\mathscr{K}_X$-module) by $\mathscr{G}$.
\end{proposition}
\begin{proof}
This follows from \cref{scheme irreducible qcoh tensor with K(X) simple}, since $\mathscr{F}$ is torsion-free if and only if the canonical homomorphism $\mathscr{F}\to\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is injective.
\end{proof}
The cardinality of the set $I$ is called the \textbf{rank} of $\mathscr{F}$. For any affine open $U$ of $X$, since the generic point of $x$ is contained in $U$, the rank of $\mathscr{F}$ is also equal to the rank of $\Gamma(U,\mathscr{F})$ as a $\Gamma(U,\mathscr{O}_X)$-module.
\begin{corollary}\label{scheme integral qcoh torsion-free rank 1 iff}
Over an integral scheme $X$, any torsion-free quasi-coherent $\mathscr{O}_X$-module of rank $1$ (and in particular any invertible $\mathscr{O}_X$-module) is isomorphic to a sub-$\mathscr{O}_X$-module of $\mathscr{K}_X$, and the converse is also true.
\end{corollary}
\begin{corollary}\label{scheme integral section tensor zero iff}
Let $X$ be an integral scheme, $\mathscr{L}$, $\mathscr{L}'$ be two torsion-free $\mathscr{O}_X$-module, $s$ (resp. $s'$) be two sections of $\mathscr{L}$ (resp. $\mathscr{L}'$) over $X$. For $s\otimes s'=0$, it is necessary and sufficient that one of the sections $s$, $s'$ is zero.
\end{corollary}
\begin{proof}
Let $x$ be the generic point of $X$. We have by hypothesis $(s\otimes s')_x=s_x\otimes s'_x=0$. As $\mathscr{L}_x$ and $\mathscr{L}'_x$ are identified with sub-$\mathscr{O}_{X,x}$-modules of the field $\mathscr{O}_{X,x}$, the preceding relation implies $s_x=0$ or $s'_x=0$, and therefore $s=0$ or $s'=0$ since $\mathscr{L}$ and $\mathscr{L}'$ are torsion-free (\cref{scheme irreducible qcoh K(X) module simple}).
\end{proof}
\begin{proposition}\label{scheme integral torsion-free sheaf push forward by dominant}
Let $X$ and $Y$ be two integral schemes and $f:X\to Y$ be a dominant morphism. For any torsion-free quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $f_*(\mathscr{F})$ is a torsion-free $\mathscr{O}_Y$-module.
\end{proposition}
\begin{proof}
As $f_*$ is left exact, it suffices, in view of \cref{scheme integral qcoh torsion-free iff}, to prove the proposition for $\mathscr{F}=\mathscr{K}_X^{\oplus I}$. Now any open subset $U$ of $Y$ contains the generic point of $Y$, hence $f^{-1}(U)$ contains the generic point of $X$, so we have $\Gamma(U,f_*(\mathscr{F}))=\Gamma(f^{-1}(U),\mathscr{F})=K(X)^{\oplus I}$. Therefore $f_*(\mathscr{F})$ is the simple sheaf with stalk $K(X)^{\oplus I}$, considered as a $\mathscr{K}_Y$-module, and it is evidently torsion-free.
\end{proof}
\begin{proposition}\label{scheme integral qcoh ft torsion iff}
Let $X$ be reduced scheme whose family of irreducible components is locally finite. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{F}$ is a torsion sheaf.
\item[(\rmnum{2})] $\mathscr{F}_x=0$ for every maximal point of $x$.
\item[(\rmnum{3})] $\supp(\mathscr{F})$ contains no irreducible component of $X$.
\end{enumerate}
\end{proposition}
\begin{proof}
Since the question is local, we may assume that $X$ has finitely many irreducible components $(X_i)_{1\leq i\leq n}$, with generic points $x_i$. Endow each $X_i$ the reduced subscheme structure of $X$, and let $\iota_i:X_i\to X$ be the canonical injection. If we put $\mathscr{F}=\iota_i^*(\mathscr{F})$, we see immediately that (\cref{scheme reduced rational sheaf direct product}) $\mathscr{F}$ is torsion-free if and only if each $\mathscr{F}_i$ is torsion-free. As $\mathscr{F}_{x_i}=(\mathscr{F}_i)_{x_i}$, to establish the equivalence of (\rmnum{1}) and (\rmnum{2}), we can assume that $X$ is integral. But then if $x$ is the generic point of $X$, the relation $\mathscr{F}_x=0$ and $\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{K}_X=0$ are equivalent by \cref{scheme integral qcoh torsion-free iff} and \cref{scheme irreducible qcoh K(X) module simple}. The equivalenct of (\rmnum{2}) and (\rmnum{3}) results from the fact that $\supp(\mathscr{F})$ is closed in $X$ (since $\mathscr{F}$ is quasi-coherent) and that the conditions $\supp(\mathscr{F})\cap X_i=\emp$ and $x_i\notin\supp(\mathscr{F})$ are then equivalent.
\end{proof}
\subsection{Separation criterion for integral schemes}
Let $X$ be an integral scheme, $K$ its function field, identified with the local ring at the generic point $\xi$ of $X$. For any $x\in X$, we can identify $\mathscr{O}_{X,x}$ as a subring of $K$, formed by the rational functions defined at the point $x$. For any rational function $f\in K$, the defining domain $\delta(f)$ of $f$ is then the open subset of $x\in X$ such that $f\in\mathscr{O}_{X,x}$, and in view of \cref{scheme reduced rational function correspond section} we have, for each open subset $U\sub X$, that
\begin{align}\label{scheme integral section is intersection of stalk}
\Gamma(U,\mathscr{O}_X)=\bigcap_{x\in U}\mathscr{O}_{X,x}.
\end{align}

Given a field $K$, for any subring $A$ of $K$, we denote by $L(A)$ the set of localizations $A_\p$, where $\p$ runs through prime ideals of $A$; they are identified with local subrings of $K$ containing $A$. As $\p=(\p A_\p)\cap A$, the map $\p\mapsto A_\p$ from $\Spec(A)$ to $L(A)$ is bijective. 
\begin{lemma}\label{local ring dominate L(A) iff}
Let $K$ be a field and $A$ be a subring of $K$. For a local subring $R$ to dominate a ring in $L(A)$, it is necessary and sufficient that $A\sub R$. In this case, the local ring $A_\p$ dominated by $R$ is then unique and corresponds to the prime ideal $\p=\m_R\cap A$, where $\m_R$ is the maximal ideal of $R$.
\end{lemma}
\begin{proof}
In fact, if $R$ dominates $A_\p$, then $\m_R\cap A_\p=\p A_\p$ by \cref{local ring dominate iff}, hence the uniqueness of $\p$. On the other hand, if $A\sub R$, $\m_R\cap A=\p$ is a prime ideal of $A$, and as the elements of $A-\p$ are then invertible in $R$, we have $A_\p\sub R$, so $\p A_\p\sub\m_R$ and $R$ dominates $A_\p$.
\end{proof}
\begin{lemma}\label{local ring in field related iff}
Let $K$ be a field, $A$, $B$ be two local subrings of $K$, and $C$ be the subring of $K$ generated by $A\cup B$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] There exists a prime ideal $\r$ of $C$ such that $\m_A=\r\cap A$ and $\m_B=\r\cap B$. 
\item[(\rmnum{2})] The ideal $\c$ generated in $C$ by $\m_A\cup\m_B$ is proper.
\item[(\rmnum{3})] There exists a local subring $R$ of $K$ dominating both $A$ and $B$.
\end{enumerate}
\end{lemma}
\begin{proof}
It is clear that (\rmnum{1}) implies (\rmnum{2}). Conversely, if $\c$ is proper, it is contained in a maximal ideal $\n$ of $C$, and $\n\cap A$ contains $\m_A$ and is proper, so $\n\cap A=\m_A$ and similarly $\n\cap B=\m_B$. Finally, it is clear that if $R$ dominates $A$ and $B$ then $C\sub R$ and $\m_A=\m_R\cap A=(\m_R\cap C)\cap A$, $\m_B=\m_R\cap B=(\m_R\cap C)\cap B$, so (\rmnum{3}) implies (\rmnum{1}). the converse is clear since we can take $R=C_\r$.
\end{proof}
If the equivalent conditions in \cref{local ring in field related iff} hold, we say the two local subrings $A$ and $B$ are \textbf{related}.
\begin{proposition}\label{local ring in field dominate local ring same iff}
Let $A$ and $B$ be subrings of a field $K$ and $C$ be the subring of $K$ generated by $A\cup B$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] For any local ring $R$ containing $A$ and $B$, we have $A_\p=B_\q$, where $\p=\m_R\cap A$ and $\q=\m_R\cap B$. 
\item[(\rmnum{2})] For any prime ideal $\r$ of $C$, we have $A_\p=B_\q$, where $\p=\r\cap A$ and $\q=\r\cap B$. 
\item[(\rmnum{3})] If $P\in L(A)$ and $Q\in L(B)$ are related, they are identical.
\item[(\rmnum{4})] We have $L(A)\cap L(B)=L(C)$.
\end{enumerate}
\end{proposition}
\begin{proof}
It follows from \cref{local ring dominate L(A) iff} and \cref{local ring in field related iff} that (\rmnum{1}) and (\rmnum{3}) are equivalent, and (\rmnum{1}) implies (\rmnum{2}) by applying (\rmnum{1}) to the ring $R=C_{\r}$. Conversely, (\rmnum{2}) implies (\rmnum{1}) because if $R$ contains $A\cup B$, it contains $C$, and if $\r=\m_R\cap C$, we have $\p=\r\cap A$ and $\q=\r\cap B$, so $A_\p=B_\q$. We also see that (\rmnum{4}) implies (\rmnum{1}), because if $R$ contains $A\cup B$, it then dominates a local ring $C_\r\in L(C)$ by \cref{local ring dominate L(A) iff}; we have by hypothesis that $L(C)=L(A)\cap L(B)$, and as $R$ dominates a unique ring in $L(A)$ (resp. $L(B)$), we conclude that $C_\r=A_\p=B_\q$.\par
Finally, we show that (\rmnum{3}) implies (\rmnum{4}). Let $R\in L(C)$; $R$ then dominates a ring $P\in L(A)$ and a ring $Q\in L(B)$ by \cref{local ring dominate L(A) iff}, so $P$ and $Q$ are related, hence identical by hypothesis. As we then have $C\sub P$, $P$ dominates a ring $R'\in L(C)$ (\cref{local ring dominate L(A) iff}), so $R$ dominates the ring $R'$, and by \cref{local ring dominate L(A) iff} we necessarily have $R=R'=P$, so $R\in L(A)\cap L(B)$. Conversely, if $R\in L(A)\cap L(B)$, we have $C\sub R$, so $R$ dominates a ring $R''\in L(C)$ by \cref{local ring dominate L(A) iff}. The two subrings $R$ and $R''$ are clearly related, and as $L(C)\sub L(A)\cap L(B)$, we conclude from condition (\rmnum{3}) that $R=R''$, so $R\in L(C)$ and the proof is complete.
\end{proof}
\begin{proposition}\label{scheme integral separate criterion}
Let $X$ be an integral scheme and $K$ be its field of rational functions. Then for $X$ to be separated, it is necessary and sufficient that the relation "$\mathscr{O}_{X,x}$ and $\mathscr{O}_{X,y}$ are related" for two points $x,y\in X$ implies $x=y$.
\end{proposition}
\begin{proof}
Suppose the given condition on $X$, we prove that $X$ is separated. Let $U=\Spec(A)$ and $V=\Spec(B)$ be two distinct affine opens of $X$, with $A,B$ identified as subrings of $K$. Then $U$ (resp. $V$) is identified with the set $L(A)$ (resp. $L(B)$), and by \cref{local ring in field dominate local ring same iff} the hypothesis on $X$ implies that, if $C$ is the subring of $K$ generated by $A\cup B$, $W=U\cap V$ is identified with $L(A)\cap L(B)=L(C)$. Moreover, we have seen from \cref{integral domain inter of localization} that any subring $R$ of $K$ is equal to the intersection of the local rings belong to $L(R)$, so
\begin{align}\label{scheme integral separate criterion-1}
C=\bigcap_{z\in W}\mathscr{O}_{X,z}=\Gamma(W,\mathscr{O}_X)
\end{align}
where we use formula (\ref{scheme integral section is intersection of stalk}). Consider then the subscheme induced by $X$ over $W$. The identity homomorphism $\varphi:C\to\Gamma(W,\mathscr{O}_X)$ corresponds to a morphism $\psi:W\to\Spec(C)$. In view of (\ref{scheme integral separate criterion-1}) and the relation $L(C)=L(A)\cap L(B)$, any prime ideal $\r$ of $C$ is of the form $\r=\m_x\cap C$, where $x\in W$ is the point in $\Spec(C)$ corresponding to $\r$, and the map $\psi$ just sends $x$ to $\r$, so it is bijective. On the other hand, for any $x\in W$, $\psi^{\#}_x$ is the canonical injection $C_{\r}\to\mathscr{O}_{X,x}$, where $\r=\m_x\cap C$. Now the local ring $\mathscr{O}_{X,x}$ dominates $A_\p$, $B_\q$ and $C_{\r}$, where $\p=\m_x\cap A$ and $\q=\m_x\cap B$, and as $C_{\r}\in L(C)=L(A)\cap L(B)$, by \cref{local ring dominate L(A) iff} we then conclude that $C_{\r}=A_\p=B_\q$ (we already have seen this in the proof of \cref{local ring in field dominate local ring same iff}). But the local rings $A_\p$ and $B_\q$ are both identified with the stalk $\mathscr{O}_{X,x}$, so we see that $C_\r=\mathscr{O}_{X,x}$ and $\psi^{\#}_x$ is bijective. It then remains to show that $\psi$ is a homeomorphism, which amounts to show that, for any closed subset $F\sub W$, the image $\psi(F)$ is closed in $\Spec(C)$. Now $F$ is the intersection with $W$ of a closed subset $E$ of the form $V(\a)$, where $\a$ is an ideal of $A$. We claim that $\psi(F)=V(\a C)$: in fact, the prime ideal of $C$ containing $\a C$ are the prime ideals of $C$ containing $\a$, hence the ideals of the form $\psi(x)=\m_x\cap C$, where $\a\sub\m_x$ and $x\in W$. As $\a\sub\m_x$ is equivalent to $x\in V(\a)=W\cap E$ for $x\in U$, we then get $\psi(F)=V(\a C)$. In view of \cref{scheme separated over affine iff intersection of affine open cover}, we then conclude that $X$ is separated, because $U\cap V$ is affine and the ring $C$ is generated by $A\cup B$.\par
Conversely, suppse that $X$ is separated, and let $x,y$ be two points of $X$ such that $\mathscr{O}_{X,x}$ and $\mathscr{O}_{X,y}$ are related. Let $U$ (resp. $V$) be an open affine containing $x$ (resp. $y$), with ring $A$ (resp. $B$). We then see $U\cap V$ is affine and its ring $C$ is generated by $A\cup B$ (\cref{scheme separated over affine iff intersection of affine open cover}). If $\p=\m_x\cap A$ and $\q=\m_x\cap B$, we have $A_\p=\mathscr{O}_{X,x}$ and $B_\q=\mathscr{O}_{X,y}$, so $A_\p$ and $B_\q$ are related. Then by \cref{local ring in field related iff} there exists a prime ideal $\r$ of $C$ such that $\p=\r\cap A$, $\q=\r\cap B$. But the prime ideal $\r$ then corresponds to a point $z\in U\cap V$ since $U\cap V$ is affine, and we have $x=z$ and $y=z$, so $x=y$.
\end{proof}
\begin{corollary}\label{scheme integral sp generalization iff local ring inclusion}
Let $X$ be a separated integral scheme and $x,y$ be two points of $X$. For $x\in\widebar{\{y\}}$, it is necessary and sufficient that $\mathscr{O}_{X,x}\sub\mathscr{O}_{Y,y}$, which means the rational functions defined at $x$ are also defined at $y$.
\end{corollary}
\begin{proof}
This condition is clearly necessary since the defining domain $\delta(f)$ of a rational function is open, hence stable under generalization. To see it is also sufficient, assume that $\mathscr{O}_{X,x}\sub\mathscr{O}_{X,y}$, so there exists a prime ideal $\p$ of $\mathscr{O}_{X,x}$ such that $\mathscr{O}_{Y,y}$ dominates $(\mathscr{O}_{X,x})_\p$ (\cref{local ring dominate L(A) iff}). By \cref{scheme local scheme correspond generalization}, there exists $z\in X$ such that $x\in\widebar{\{z\}}$ and $\mathscr{O}_{X,z}=(\mathscr{O}_{X,x})_\p$; as $\mathscr{O}_{X,z}$ and $\mathscr{O}_{X,y}$ are then related, we have $z=y$ by \cref{scheme integral separate criterion}, whence the corollary.
\end{proof}
\begin{corollary}\label{scheme integral sp local ring correspondence injective}
If $X$ is a separated integral scheme, the map $x\mapsto\mathscr{O}_{X,x}$ is injective. In other words, if $x,y$ are two distinct points of $X$, there exists a rational function defined at only one of these points.
\end{corollary}
\begin{proof}
This follows from \cref{scheme integral sp generalization iff local ring inclusion} and the $T_0$-axiom.
\end{proof}
\begin{corollary}\label{scheme Noe integral sp rational function domain generate}
Let $X$ be a Noetherian separated integral scheme. The sets $\delta(f)$ for $f\in K(X)$ form a subbasis the topology of $X$.
\end{corollary}
\begin{proof}
In fact, any closed subset of $X$ is then a finite union of irreducible closed subsets, which are of the form $\widebar{\{y\}}$. Now if $x\notin\widebar{\{y\}}$, there exists a rational function $f$ defined at $x$ but not at $y$ (\cref{scheme integral sp local ring correspondence injective}), which means $x\in\delta(f)$ and $\delta(f)\cap\widebar{\{y\}}=\emp$. The complement of $\widebar{\{y\}}$ is then a union of sets of the form $\delta(f)$, and in view of the previous remark, any open subset of $X$ is a union of finite intersections of sets of the form $\delta(f)$.
\end{proof}
\begin{proposition}\label{scheme integral sp dominant morphism prop}
Let $X$, $Y$ be two integral schemes with rational function fields $K$ and $L$, respectively. Suppose that $Y$ is separated and let $f:X\to Y$ be a dominant morphism. Then $L$ is identified with a subfield of $K$, and for every point $x\in X$, $\mathscr{O}_{Y,f(x)}$ is the unique local ring of $Y$ dominated by $\mathscr{O}_{X,x}$.
\end{proposition}
\begin{proof}
Ths first assertion is already proved in \cref{scheme irreducible dominant local immersion prop}. Now for every $x\in X$, the local homomorphism $f^{\#}_x:\mathscr{O}_{Y,f(x)}\to\mathscr{O}_{X,x}$ is injective by \cref{scheme irreducible dominant local immersion prop}, so, if we identify $L$ as a subfield of $K$, $\mathscr{O}_{Y,f(x)}$ is dominated by $\mathscr{O}_{X,x}$. As $Y$ is separated, two local rings of $Y$ can not be dominated by the same local ring (\cref{scheme integral separate criterion}), so our assertion follows.
\end{proof}
\begin{proposition}\label{scheme irre local immersion sp is immersion}
Let $X$ be an irreducible scheme and $f:X\to Y$ be a local immersion (resp. a local isomorphism). Suppose that $f$ is separated, then it is an immersion (resp. an open immersion).
\end{proposition}
\begin{proof}
It suffices to prove that $f$ is a homeomorphism from $X$ to $f(X)$ (\cref{scheme morphism immersion iff stalk} ). By replacing $f$ with $f_{\red}$, we may assume that $X$ and $Y$ are reduced. If $Y'$ is the reduced subscheme of $Y$ with underlying space $\widebar{f(X)}$, $f$ then factors into
\[\begin{tikzcd}
X\ar[r,"f'"]&Y'\ar[r,"j"]&Y
\end{tikzcd}\]
where $j$ is the canonical injection. Then $f'$ is separated by \cref{scheme morphism separated permanence prop}(\rmnum{5}) and is a local immersion by \cref{scheme morphism cancelled eg}(\rmnum{3}), so we may reduce to the case that $f$ is dominant. But then $Y$ is irreducible by \cref{topo space irreducible under continuous map}, and by \cref{scheme irreducible dominant local immersion prop}, we see $f$ is in fact a local isomorphism, so for each $x\in X$ the homomorphism $f^{\#}_x$ is an isomorphism. By \cref{scheme integral sp local ring correspondence injective}, this implies that $f$ is injective, so $f$ is in fact a homeomorphism.
\end{proof}
\section{Formal schemes}
\subsection{Formal affine schemes and morphisms}
Let $A$ be a admissible topological ring, with a nilideal $\mathfrak{I}$ (recall that this means $\mathfrak{I}$ is open and $(\mathfrak{I}^n)$ tends to $0$ in $A$). The specturm $\Spec(A/\mathfrak{I})$ is then a closed subscheme of $\Spec(A)$, which is the set of open prime ideals of $A$. This topological space does not depend on the nilideal of $\mathfrak{I}$, and we denote it by $\X$. Let $(\mathfrak{I}_\lambda)$ be a system of fundamental neighborhood of $0$ in $A$, formed by the nilideals of $A$, and for each $\lambda$, let $\mathscr{O}_\lambda$ be the structural sheaf of $\Spec(A/\mathfrak{I}_\lambda)$. This sheaf is induced over $\X$ by $\widetilde{A}/\widetilde{\mathscr{I}}_\lambda$ (and is zero outside $\X$). For $\mathfrak{I}_\mu\sub\mathfrak{I}_\lambda$, the canonical homomorphism $A/\mathfrak{I}_\mu\to A/\mathfrak{I}_\lambda$ defines a homomorphism $u_{\lambda\mu}:\mathscr{O}_\mu\to\mathscr{O}_\lambda$ of sheaves of rings, and $(\mathscr{O}_\lambda)$ is a projective system of sheaves of rings for these homomorphisms. As the topology of $\X$ admits a basis formed by quasi-compact open subsets, if we view each $\mathscr{O}_\lambda$ as a sheaf of discrete rings, the $\mathscr{O}_\lambda$ then form a projective system of sheaves of topological rings, and we denote by $\mathscr{O}_{\X}$ the limit of this system $(\mathscr{O}_\lambda)$. By (\cite{EGA1} $0_{\text{\Rmnum{1}}}$ 3.2.6), for any quasi-compact open subset $U$ of $\X$, $\Gamma(U,\mathscr{O}_{\X})$ is then the limit topological ring of the discrete rings $\Gamma(U,\mathscr{O}_\lambda)$.\par
Given an admissible topological ring $A$, the closed subspace $\X$ of $\Spec(A)$ formed by open prime ideals of $A$ is called the \textbf{formal spectrum} of $A$ and denoted by $\Spf(A)$. A topoloigcally ringed space is called a \textbf{formal affine scheme} if it is isomorphic to a formal spectrum $\Spf(A)=\X$ endowed with the sheaf of topological rings $\mathscr{O}_{\X}$, which is the limit of the sheaf of discrete rings $(\widetilde{A}/\widetilde{\mathfrak{I}}_\lambda)|_{\X}$, where $\mathfrak{I}_\lambda$ runs through the filtered set of nilideals of $A$. When we speak of a formal spectrum $\X=\Spf(A)$ as an formal affine scheme, it will always be understood that the topologically ringed space $(\X,\mathscr{O}_{\X})$ where $\mathscr{O}_{\X}$ is defined as above. By an \textbf{adic} (resp. \textbf{Noetherian}) formal affine scheme, we mean a formal affine scheme which is isomorphic to a formal specturm $\Spf(A)$, where $A$ is adic (resp. adic and Noetherian).\par
We note that any affine scheme $X=\Spec(A)$ can be considered as a formal affine scheme in a unique way: consider $A$ as a discrete topological ring, the rings $\Gamma(U,\mathscr{O}_X)$ are then discrete if $U$ is quasi-compact (but not true in general if $U$ is any open set of $X$).
\begin{proposition}\label{scheme formal affine global section of O_X}
If $\X=\Spf(A)$, where $A$ is an admissible ring, then $\Gamma(X,\mathscr{O}_{\X})$ is homeomorphic to $A$.
\end{proposition}
\begin{proof}
In fact, as $\X$ is closed in $\Spec(A)$, it is quasi-compact, and therefore $\Gamma(\X,\mathscr{O}_{\X})$ is homeomorphic to the limit of the discrete rings $\Gamma(\X,\mathscr{O}_\lambda)$. But $\Gamma(\X,\mathscr{O}_\lambda)$ is isomorphic to $A/\mathfrak{I}_\lambda$, and as $A$ is separated and complete, this is homeomorphic to $\rlim A/\mathfrak{I}_\lambda$, whence the proposition.
\end{proof}
\begin{proposition}\label{scheme formal standarad open is formal affine}
Let $A$ be an admissible ring, $\X=\Spf(A)$, and for $f\in A$, let $\mathfrak{D}(f)=D(f)\cap\X$. Then the topologically ringed space $(\mathfrak{D}(f),\mathscr{O}_{\X}|_{\mathfrak{D}(f)})$ is isomorphic to a formal affine spectrum $\Spf(A_{\{f\}})$.
\end{proposition}
\begin{proof}
For any nilideal $\mathfrak{I}$ of $A$, the discrete ring $A_f/\mathfrak{I}_f$ is canonically identified with $A_{\{f\}}/\mathfrak{I}_{\{f\}}$, so the topological space $\Spf(A_{\{f\}})$ is canonically identified with $\mathfrak{D}(f)$. Moreover, for any quasi-compact open $U$ of $\X$ contained in $\mathfrak{D}(f)$, $\Gamma(U,\mathscr{O}_\lambda)$ is identified with the module of sections of the structural sheaf of $\Spec(A_f/\mathfrak{I}_\lambda)$ over $U$, so, if we put $\Y=\Spf(A_{\{f\}})$, $\Gamma(U,\mathscr{O}_{\X})$ is identified with $\Gamma(U,\mathscr{O}_{\Y})$, whence the proposition.
\end{proof}
As a sheaf of rings, the stalk of the structural sheaf $\mathscr{O}_{\X}$ of $\Spf(A)$ for any $x\in X$ is, by \cref{scheme formal standarad open is formal affine}, identified with the inductive limit $\rlim A_{\{f\}}$ for $f\notin\p_x$. Therefore, by \cref{admissible ring complete localization at prime residue prop} and \cref{Noe ring complete localization at prime faithfully flat over limit}, we have the following:
\begin{proposition}\label{scheme formal affine stalk prop}
For any $x\in\X=\Spf(A)$, the stalk $\mathscr{O}_{\X,x}$ is a local ring whose residue field is isomorphic to $\kappa(x)$. If $A$ is adic and Noetherian, then $\mathscr{O}_{\X,x}$ is a Noetherian ring.
\end{proposition}
As the field $\kappa(x)$ is not reduced to $0$, we conclude in particular that the support of $\mathscr{O}_{\X}$ is equal to $\X$, and $(\X,\mathscr{O}_{\X})$ is a locally topologically ringed space.\par
We now consider morphisms of formal affine schemes. Let $A,B$ be admissible rings, and $\varphi:B\to A$ be a continuous homomorphism. The continuous map $^{a}\!\varphi:\Spec(A)\to\Spec(B)$ then maps $\X=\Spf(A)$ into $\Y=\Spf(B)$, because the inverse image of an open prime ideal of $A$ is an open prime ideal of $B$. On the other hand, for any $g\in B$, $\varphi$ defines a continuous homomorphism $\Gamma(\mathfrak{D}(g),\mathscr{O}_{\Y})\to\Gamma(\mathfrak{D}(\varphi(g),\mathscr{O}_{\X}))$ in view of \cref{scheme formal affine global section of O_X} and \cref{scheme formal standarad open is formal affine}; as these homomorphisms are compatible with restrictions and $\mathfrak{D}(\varphi(g))=({^{a}\varphi})^{-1}(\mathfrak{D}(g))$, we obtain a continuous homomorphism of sheaves of topological rings $\mathscr{O}_{\Y}\to{^{a}\!\varphi}_*(\mathscr{O}_{\X})$, which we denoted by $\tilde{\varphi}$. We then get a morphism $({^{a}\varphi},\tilde{\varphi}):(X,\mathscr{O}_{\X})\to(\Y,\mathscr{O}_{\Y})$ of topologically ringed spaces.
\begin{proposition}\label{scheme formal affine morphism correspond}
Let $A,B$ be admissible topological rings, and $\X=\Spf(A)$, $\Y=\Spf(B)$. For a morphism $\psi:\X\to\Y$ of topologically ringed spaces to be of the form $({^{a}\varphi},\tilde{\varphi}):\X\to\Y$, it is necessary and sufficient that for each $x\in X$, $f^{\#}_x:\mathscr{O}_{\Y,\psi(x)}\to\mathscr{O}_{\X,x}$ is a local homomorphism.
\end{proposition}
\begin{proof}
This conditions is necessary: in fact, let $\p=\p_x\in\Spf(A)$, and $\q=\varphi^{-1}(\p_x)$; if $g\notin\q$, then $\varphi(g)\notin\p$, and it is immediate that the homomorphism $B_{\{g\}}\to A_{\{\varphi(g)\}}$ induced from $\varphi$ maps $\q_{\{g\}}$ into $\p_{\{\varphi(g)\}}$; by passing to inductive limit, we then see that $\tilde{\varphi}_x$ is a local homomorphism.\par
Conversely, let $\psi$ be a morphism satisfying this condition. By \cref{scheme formal affine global section of O_X}, $\psi^{\#}$ defines a continuous homomorphism
\[\varphi=\Gamma(\psi^{\#}):B=\Gamma(\Y,\mathscr{O}_{\Y})\to\Gamma(\X,\mathscr{O}_{\X})=A.\]
By the hypothesis on $\psi^{\#}$, for the section $\varphi(g)$ of $\mathscr{O}_{\X}$ over $\X$ has invertible germ at a point $x$, it is necessary and sufficient that $g$ has invertible germ at $\psi(x)$. But by \cref{Noe ring complete localization at prime faithfully flat over limit}, the sections of $\mathscr{O}_{\X}$ (resp. $\mathscr{O}_{\Y}$) over $\X$ (resp. $\Y$) which have non-invertible germs at $x$ (resp. $\psi(x)$) are exactly the elements of $\p_x$ (resp $\p_{\psi(x)}$), so we conclude that $\psi={^{a}\!\varphi}$. Finally, for any $g\in B$, the diagram
\[\begin{tikzcd}
B=\Gamma(\Y,\mathscr{O}_{\Y})\ar[d]\ar[r,"\varphi"]&\Gamma(\X,\mathscr{O}_{\X})=A\ar[d]\\
B_{\{g\}}=\Gamma(\mathfrak{D}(g),\mathscr{O}_{\Y})\ar[r,"\Gamma(\psi^{\#}_{\mathfrak{D}(g)})"]&\Gamma(\mathfrak{D}(\varphi(g),\mathscr{O}_{\X}))=A_{\{\varphi(g)\}}
\end{tikzcd}\]
is commutative. By the universal property of localization of complete rings (\cref{topo ring complete localization universal prop}), we conclude that $\psi^{\#}_{\mathfrak{D}(g)}$ is equal to $\tilde{\varphi}_{\mathfrak{D}(g)}$ for $g\in B$, so we have $\psi^{\#}=\tilde{\varphi}$.
\end{proof}
We say a morphism $\psi:\X\to\Y$ satisfying the condition in \cref{scheme formal affine morphism correspond} is a \textbf{morphism of formal affine schemes}. Then by \cref{scheme formal affine morphism correspond}, the functor $A\mapsto\Spf(A)$ and $\X\to\Gamma(\X,\mathscr{O}_{\X})$ define an equivalence from the category of admissible topological rings to the opposite of the category of formal affine schemes.\par
As a particular case of \cref{scheme formal affine morphism correspond}, note that for $f\in A$, the canonical injection of the formal affine scheme over $\mathfrak{D}(f)$ induced by $\X$ corresponds to the canonical homomorphism $A\to A_{\{f\}}$. Under the hypothesis of \cref{scheme formal affine morphism correspond}, let $h$ be an element of $B$ and $g$ be an element of $A$, which is a multiple of $\varphi(h)$. We then have $\psi(\mathfrak{D}(g))\sub\mathfrak{D}(h)$; the restriction of $\psi$ to $\mathfrak{D}(g)$, considered as a morphism $\mathfrak{D}(g)\to\mathfrak{D}(h)$, is the unique morphism $\eta$ such that the diagram
\[\begin{tikzcd}
\mathfrak{D}(g)\ar[d]\ar[r,"\eta"]&\mathfrak{D}(h)\ar[d]\\
\X\ar[r,"\psi"]&\Y
\end{tikzcd}\]
This morphism corresponds to the unique continuous homomorphism $\tilde{\varphi}:B_{\{h\}}\to A_{\{g\}}$ such that the diagram
\[\begin{tikzcd}
B\ar[r,"\varphi"]\ar[d]&A\ar[d]\\
B_{\{h\}}\ar[r,"\tilde{\varphi}"]&A_{\{g\}}
\end{tikzcd}\]
is commutative.\par
Let $A$ be an admissible ring, $\mathfrak{I}$ be an open ideal of $A$, and $\X$ be the formal affine scheme $\Spf(A)$. Let $(\mathfrak{I}_\lambda)$ be the set of nilideals of $A$ contained in $\mathfrak{I}$; then $\widetilde{\mathfrak{I}}/\widetilde{\mathfrak{I}}_\lambda$ is a sheaf of ideals of $\widetilde{A}/\widetilde{\mathfrak{I}}_\lambda$. We denote by $\mathfrak{I}^{\Delta}$ the projective limit of the sheaves induced by $\widetilde{\mathfrak{I}}/\widetilde{\mathfrak{I}}_\lambda$ over $\X$, which is considered as an ideal of $\mathscr{O}_{\X}$. For any $f\in A$, $\Gamma(\mathfrak{D}(f),\mathfrak{I}^{\Delta})$ is the projective limit of $\mathfrak{I}_f/(\mathscr{I}_\lambda)_f$, which is identified with the open ideal $\mathfrak{I}_{\{f\}}$ of the ring $A_{\{f\}}$, and in particular $\Gamma(\X,\mathfrak{I}^{\Delta})=\mathfrak{I}$. We then conclude that (the $\mathfrak{D}(f)$ form a base of $\X$) that we have
\begin{align}\label{scheme formal affine associated sheaf of ideal}
\mathfrak{I}^{\Delta}|_{\mathfrak{D}(f)}=(\mathfrak{I}_{\{f\}})^{\Delta}
\end{align}
With these notations, for $f\in A$ the canonical map of $A_{\{f\}}=\Gamma(\mathfrak{D},\mathscr{O}_{\X})$ in $\Gamma(\mathfrak{D}(f),(\widetilde{A}/\widetilde{\mathfrak{I}})|_{\X})=A_f/\mathfrak{I}_f$ is surjective with kernel $\Gamma(\mathfrak{D}(f),\mathfrak{I}^{\Delta})=\mathfrak{I}_{\{f\}}$. These maps define a canonical continuous epimorphism from the sheaf $\mathscr{O}_{\X}$ to the sheaf of discrete rings $(\widetilde{A}/\widetilde{\mathfrak{I}})|_{\X}$, whose kernel is $\mathfrak{I}^{\Delta}$; this homomorphism is none other than the homomorphism $\tilde{\varphi}$, where $\varphi$ is the canonical continuous homomorphism $A\to A/\mathfrak{I}$. The morphism $({^{a}\!\varphi},\tilde{\varphi}):\Spec(A/\mathfrak{I})\to\X$ of the formal affine schemes is then called the canonical morphism. We then have a canonical isomorphism
\begin{equation}\label{scheme formal affine closed subscheme structural sheaf char}
\mathscr{O}_{\X}/\mathfrak{I}^{\Delta}\stackrel{\sim}{\to}(\widetilde{A}/\widetilde{\mathfrak{I}})|_{\X}.
\end{equation}
It is clear (in view of $\Gamma(X,\mathfrak{I}^{\Delta})=\mathfrak{I}$) that the map $\mathfrak{I}\mapsto\mathfrak{I}^{\Delta}$ is strictly increasing: in fact, for $\mathfrak{I}\sub\mathfrak{I}'$, the sheaf $\mathfrak{I}'^{\Delta}/\mathfrak{I}^{\Delta}$ is canonically isomorphic to $\widetilde{\mathfrak{I}}'/\widetilde{\mathfrak{I}}=\widetilde{\mathfrak{I}'/\mathfrak{I}}$.\par
An ideal $\mathscr{I}$ of $\mathscr{O}_{\X}$ is called a \textbf{nilideal} of $\X$ if, for any $x\in\X$, there exists an open neighborhood of $x$ in $\X$ of the form $\mathfrak{D}(f)$, where $f\in A$, such that $\mathscr{I}|_{\mathfrak{D}(f)}$ is of the form $\mathfrak{I}^{\Delta}$ for a nilideal $\mathfrak{I}$ of $A_{\{f\}}$. It is clear from our definiton that for any $f\in A$, any nilideal of $\X$ induces a nilideal of $\mathfrak{D}(f)$.
\begin{proposition}\label{scheme formal affine nilideal iff}
If $A$ is an admissible ring, any nilideal of $\X=\Spf(A)$ is of the form $\mathfrak{I}^{\Delta}$, where $\mathfrak{I}$ is a nilideal of $A$.
\end{proposition}
\begin{proof}
Let $\mathscr{I}$ be a nilideal of $\X$; by hypothesis, and since $\X$ is quasi-compact, there exist finitely many elements $f_i\in A$ such that $\mathfrak{D}(f)$ cover $\X$ and such that $\mathscr{I}|_{\mathfrak{D}(f)}=\mathfrak{K}_i$, where $\mathfrak{K}_i$ is a nilideal of $A_{\{f_i\}}$. For any $i$, there then exists an open ideal $\mathfrak{R}_i$ of $A$ such that $(\mathfrak{R}_i)_{\{f_i\}}=\mathfrak{K}_i$; let $\mathfrak{R}$ be a nilideal of $A$ contained in each the $\mathfrak{R}_i$. The canonical image of $\mathscr{I}/\mathfrak{R}^{\Delta}$ in the structural sheaf $\widetilde{(A/\mathfrak{R})}$ of $\Spec(A/\mathfrak{R})$ is then such that its restriction to each $\mathfrak{D}(f_i)$ is equal to $\widetilde{\mathfrak{R}_i/\mathfrak{R}}$; we then conclude that this canonical image is a quasi-coherent ideal over $\Spec(A/\mathfrak{R})$, hence is of the form $\widetilde{\mathfrak{I}/\mathfrak{R}}$, where $\mathfrak{I}$ is an ideal of $A$ containing $\mathfrak{R}$, and whence $\mathscr{I}=\mathfrak{I}^{\Delta}$ by (\ref{scheme formal affine closed subscheme structural sheaf char}). Moreover, as for each $i$ there exists an integer $n_i$ such that $\mathfrak{K}_i^{n_i}\sub\mathfrak{R}_{\{f_i\}}$, we have $(\mathscr{I}/\mathfrak{R}^{\Delta})^n=0$ for $n$ sufficiently large, and therefore $(\widetilde{\mathfrak{I}/\mathfrak{R}})^n=0$, and finally $(\mathfrak{I}/\mathfrak{R})^n=0$, which proves that $\mathfrak{I}$ is a nilideal of $A$.
\end{proof}
\begin{proposition}\label{scheme formal affine adic ft ideal prop}
Let $A$ be an adic ring, $\mathfrak{I}$ be a nilideal of $A$ such that $\mathfrak{I}/\mathfrak{I}^2$ is an $A/\mathfrak{I}$ of finte type. For any integer $n>0$, we then have $(\mathfrak{I}^{\Delta})^n=(\mathfrak{I}^n)^{\Delta}$.
\end{proposition}
\begin{proof}
In fact, for any $f\in A$ we have (since $\mathfrak{I}^{n}$ is an open ideal)
\[(\Gamma(\mathfrak{D}(f),\mathfrak{I}^{\Delta}))^n=(\mathfrak{I}_{\{f\}})^n=(\mathfrak{I}^n)_{\{f\}}=\Gamma(\mathfrak{D}(f^n),(\mathfrak{I}^n)^{\Delta})\]
in view of (\ref{scheme formal affine associated sheaf of ideal}) and \cref{topo ring complete localization adic ring ideal power prop}. As $(\mathfrak{I}^{\Delta})^n$ is associated with the presheaf $U\mapsto(\Gamma(U,\mathfrak{I}^{\Delta}))^n$, the corollary then follows since $\mathfrak{D}(f)$ form a basis for $\X$.
\end{proof}
A family $(\mathscr{I}_\lambda)$ of nilideals of $\X$ is called a \textbf{fundamental system of nilideals} if any nilideal of $\mathscr{I}$ contains at least one of these $\mathscr{I}_\lambda$. As $\mathscr{I}_\lambda=\mathfrak{I}_\lambda^{\Delta}$, this is equivalent to saying that the $\mathfrak{I}_\lambda$ form a fundamental neighborhood of $0$ in $A$, where $\mathscr{I}_\lambda=\mathscr{I}_\lambda^{\Delta}$. Let $(f_\alpha)$ be a family of elements of $A$ such that the $\mathfrak{D}(f_\alpha)$ cover $\X$. If $(\mathscr{I}_\lambda)$ is a filtered decreasing family of ideals of $\mathscr{O}_{\X}$ such that for any $\alpha$, the family $(\mathscr{I}_\lambda|_{\mathfrak{D}(f_\alpha)})$ is a fundamental system of nilideals of $\mathfrak{D}(f_\alpha)$, then $(\mathscr{I}_\lambda)$ is a fundamental system of nilideals of $\X$. In fact, for any nilideal of $\X$, there exists a finite covering of $\X$ by the $\mathfrak{D}(f_i)$ such that, for any $i$, $\mathscr{I}_{\lambda_i}|_{\mathfrak{D}(f_i)}$ is a nilideal of $\mathfrak{D}(f_i)$ contained in $\mathfrak{I}|_{\mathfrak{D}(f_i)}$. If $\mu$ is an index such that $\mathscr{I}_\mu\sub\mathscr{I}_{\lambda_i}$ for all $i$, then $\mathscr{I}_\mu$ is a nilideal of $\X$ which is evidently contained in $\mathscr{I}$, whence the assertion.
\subsection{Formal schemes and morphisms}
Given a topologically ringed space $\X$, we say an open subset $U\sub\X$ is a \textbf{formal affine open} (resp. \textbf{an adic formal affine open}, resp. \textbf{a Noetherian formal affine open}) if the topologically ringed space $(U,\mathscr{O}_{\X}|_U)$ is a formal affine scheme (resp. an adic formal affine scheme, resp. a Noetherian formal affine scheme). We way $(\X,\mathscr{O}_{\X})$ is a \textbf{formal scheme} (resp. \textbf{adic formal scheme}, resp. \textbf{locally Noetherian formal scheme}) if each of its point admits a formal affine open neighborhood (resp. an adic formal affine open, resp. a locally Noetherian formal affine open). We say that $\X$ is \textbf{Noetherian} if it is locally Noetherian and the underlying space is quasi-compact (hence Noetherian). As any affine scheme can be considered as a formal affine scheme, any scheme can be considered as a formal scheme.
\begin{proposition}\label{scheme formal basis by affine open}
If $\X$ is a formal scheme (resp. locally Noetherian formal scheme), the set of formal affine opens (resp. Noetherian formal affine opens) form a base for $\X$.
\end{proposition}
\begin{proof}
This follows from \cref{scheme formal standarad open is formal affine}, and the fact that if $A$ is a Noetherian adic ring, so is $A_{\{f\}}$ for any $f\in A$ (\cref{adic ring given by I-adic completion}).
\end{proof}
\begin{corollary}
If $\X$ is a formal scheme (resp. locally Noetherian formal scheme, resp. Noetherian formal scheme), the topological ringed space over any open subset of $\X$ is a formal scheme (resp. locally Noetherian formal scheme, resp. Noetherian formal scheme).
\end{corollary}
Given two formal schemes $\X,\Y$, we say that $f:\X\to\Y$ is a morphism of formal schemes if it is a morphism of the underlying locally ringed spaces. That is, if $(f,f^{\#})$ is a morphism of ringed spaces and $f^{\#}_x:\mathscr{O}_{\Y,f(x)}\to\mathscr{O}_{\X,x}$ is a local homomorphism. The composition of two morphisms are defined as the same and clearly a morphism of formal schemes. The formal schemes then form a category, which we denoted by $\mathbf{Schf}$, and we denote by $\Hom_{\mathsf{Schf}}(\X,\Y)$ the set of morphisms of formal schemes $\X\to\Y$.\par
If $U$ is an open subset of $\X$, the canonical injection $U\to\X$ is then a morphism of formal schemes, if we endow $U$ the formal scheme structure induced by $\X$. It is clear that this morphism is a monomorphism in the category $\mathbf{Schf}$.
\begin{proposition}\label{scheme affine formal morphism to affine correspond}
Let $\X$ be a formal scheme, $\Y=\Spec(A)$ be a formal affine scheme. Then there exists a canonical bijection
\[\Hom_{\mathbf{Scf}}(\X,\Y)\stackrel{\sim}{\to}\Hom_{\mathbf{TopRing}}(A,\Gamma(\X,\mathscr{O}_{\X})).\]
\end{proposition}
\begin{proof}
We first note that, if $(\X,\mathscr{O}_{\X})$ and $(\Y,\mathscr{O}_{\Y})$ are two topologically ringed spaces, a morphism $f:(\X,\mathscr{O}_{\X})\to(\Y,\mathscr{O}_{\Y})$ defines canonically a continuous homomorphism of rings $\varphi:\Gamma(\Y,\mathscr{O}_{\Y})\to\Gamma(\X,\mathscr{O}_{\X})$. In our case, we need to show that a continuous hommorphism $\varphi:A\to\Gamma(\X,\mathscr{O}_{\X})$ is of the form $\Gamma(\psi^{\#})$ for a unique morphism $(\psi,\psi^{\#})$. Now there exists by hypothesis a covering $(V_\alpha)$ of $\X$ by formal affine opens; by composing $\varphi$ with the restriction homomorphisms $\Gamma(\X,\mathscr{O}_{\X})\to\Gamma(V_\alpha,\mathscr{O}_{\X}|_{V_\alpha})$, we obtain a continuous homomorphism $\varphi_\alpha:A\to\Gamma(V_\alpha,\mathscr{O}_{\X}|_{V_\alpha})$, which corresponds to a unique morphism $\psi_\alpha:(V_\alpha,\mathscr{O}_{\X}|_{V_\alpha})\to(\Y,\mathscr{O}_{\Y})$, in view of \cref{scheme formal affine morphism correspond}. Moreover, for any couple $(\alpha,\beta)$ of indices, any point of $V_\alpha\cap V_\beta$ admits a formal affine open neighborhood $W$ contained in $V_\alpha\cap V_\beta$ and it is clear that the compositions of $\varphi_\alpha$ and $\varphi_\beta$ with the canonical restriction are the same continuous homomorphism $\Gamma(\Y,\mathscr{O}_{\Y})\to\Gamma(W,\mathscr{O}_{\X}|_W)$, so, in view of the relations $(\psi_\alpha^{\#})_x=(\tilde{\varphi}_\alpha)_x$ for any $x\in V_\alpha$, the restrictions of $\psi_\alpha$ and $\psi_\beta$ coincides on $V_\alpha\cap V_\beta$. We then conclude that there exists a unique morphism $\psi:(\X,\mathscr{O}_{\X})\to(\Y,\mathscr{O}_{\Y})$ whose restriction to $V_\alpha$ coincides with $\psi_\alpha$, and it is clear that this is the unique morphism such that $\Gamma(\psi^{\#})=\varphi$.
\end{proof}
Given a formal scheme $\mathfrak{S}$, a \textbf{formal $\mathfrak{S}$-scheme} is defined to be a formal scheme $\X$ together with a morphism $\varphi:\X\to\mathfrak{S}$, called the \textbf{structural morphism} of $\X$. If $\mathfrak{S}=\Spf(A)$, where $A$ is an admissible ring, we also say that the $\mathfrak{S}$-formal scheme $\X$ is a formal $A$-scheme or a formal scheme over $A$. Any formal scheme can be clearly considered as a formal scheme over $\Z$ (endowed with the discrete topology).\par
If $\X,\Y$ are two formal $\mathfrak{S}$-schemes, we say a morphism $f:\X\to\Y$ is an \textbf{$\mathfrak{S}$-morphism} if the diagram
\[\begin{tikzcd}
\X\ar[rr,"f"]\ar[rd]&&\Y\ar[ld]\\
&\mathfrak{S}
\end{tikzcd}\]
where the vertical arrows are structural morphisms, is commutative. With this definition, the $\mathfrak{S}$-schemes form (for $\mathfrak{S}$ fixed) a category $\mathbf{Scf}_{\mathfrak{S}}$. We denote by $\Hom_{\mathfrak{S}}(\X,\Y)$ the set of $\mathfrak{S}$-morphisms $\X\to\Y$. If $\mathfrak{S}=\Spf(A)$, we also say $A$-morphism for $\mathfrak{S}$-morphisms.\par
Let $\X$ be a formal scheme; we say an ideal $\mathscr{I}$ of $\mathscr{O}_{\X}$ is a nilideal of $\X$ if any $x\in\X$ admits a formal affine open neighborhood $U$ such that $\mathscr{I}|_U$ is a nilideal of the formal scheme $U$ induced by $\X$. In view of \cref{scheme formal basis by affine open}, for any open $V\sub\X$, $\mathscr{I}|_V$ is then a nilideal of the formal scheme induced over $V$.\par
A family $(\mathscr{I}_\lambda)$ of nilideals of $\X$ is called a \textbf{fundamental system of nilideals} if there exists a covering $(U_\alpha)$ of $\X$ by formal affine opens such that, for any $\alpha$, the family $(\mathscr{I}_\lambda|_{U_\alpha})$ form a fundamental system of nilideals of $U_\alpha$. For any open subset $V$ of $\X$, the family $(\mathscr{I}_\lambda|_V)$ then forms a fundamental system of nilideals for $V$, in view of (\ref{scheme formal affine associated sheaf of ideal}). If $\X$ is locally Noetherian, and $\mathscr{I}$ is a nilideal of $\X$, it then follows from \cref{scheme formal affine adic ft ideal prop} that the powers of $\mathscr{I}^n$ form a fundamental system of nilideals of $\X$.\par
Let $\X$ be a formal scheme, $\mathscr{I}$ be a nilideal of $\X$. Then the ringed space $(\X,\mathscr{O}_{\X}/\mathscr{I})$ is a scheme, which is affine (resp. locally Noetherian, resp. Noetherian) if $\X$ is a formal affine scheme (resp. a locally Noetherian formal scheme, resp. a Noetherian formal scheme). Moreover, if $\varphi:\mathscr{O}_{\X}\to\mathscr{O}_{\X}/\mathscr{I}$ is the cannical homomorphism, then $(1_{\X},\varphi)$ is a morphism (called canonical) of formal schemes $(\X,\mathscr{O}_{\X}/\mathscr{I})\to(\X,\mathscr{O}_{\X})$.
\begin{proposition}\label{scheme formal structural sheaf projective limit}
Let $\X$ be a formal scheme, $(\mathscr{I}_\lambda)$ be a fundamental system of nilideals of $\X$. Then the sheaf $\mathscr{O}_{\X}$ is the projective limit of the sheaf of discrete rings $\mathscr{O}_{\X}/\mathscr{I}_\lambda$.
\end{proposition}
\begin{proof}
As $\X$ admits a basis by quasi-compact open sets, we are reduced to the affine case, where the proposition follows from \cref{scheme formal affine nilideal iff} and the definition of $\mathscr{O}_{\X}$.
\end{proof}
\begin{proposition}\label{scheme formal local Noe X_red}
Let $\X$ be a locally Noetherian formal scheme. Then there exists a largest nilideal $\mathscr{T}$ of $\X$, which is the unique nilideal $\mathscr{I}$ such that the scheme $(\X,\mathscr{O}_{\X}/\mathscr{I})$ is reduced. If $\mathscr{I}$ is a nilideal of $\X$, then $\mathscr{T}$ is the inverse image of the nilradical of $\mathscr{O}_{\X}/\mathscr{I}$ under the homomorphism $\mathscr{O}_{\X}\to\mathscr{O}_{\X}/\mathscr{I}$. The reduced (usual) scheme $(\X,\mathscr{O}_{\X}/\mathscr{T})$ is denoted by $\X_{\red}$.
\end{proposition}
\begin{proof}
Suppose first that $\X=\Spf(A)$, where $A$ is a Noetherian adic ring. The existence of $\mathscr{T}$ and its properties then follows from \cref{scheme formal affine nilideal iff}, in view of \cref{admissible ring largest nilideal iff} about the largest nilideal of $A$. To prove the existence of $\mathscr{T}$ in the general case, it suffices to prove that if $V\sub U$ are two Noetherian formal affine opens of $X$, the largest nilideal $\mathscr{T}_U$ of $U$ induces the largest nilideal $\mathscr{T}_V$ of $V$; but as $\Gamma(V,(\mathscr{O}_{\X}|_V)/(\mathscr{T}_U|_V))$ is reduced, this is immediate.
\end{proof}
\begin{corollary}
Let $\X$ be a locally Noetherian formal scheme, $\mathscr{T}$ be the largest nilideal of $\X$. Then for any open subset $V$ of $\X$, $\mathscr{T}|_V$ is the largest nilideal of $V$.
\end{corollary}
\begin{proof}
This is already shown in the proof of \cref{scheme formal local Noe X_red}. 
\end{proof}
\begin{proposition}\label{scheme formal f_red induced morphism}
Let $\X,\Y$ be formal schemes, $\mathscr{I}$ (resp. $\mathscr{K}$) be the nilideal of $\X$ (resp. $\Y$), $f:\X\to\Y$ be a morphism of formal schemes.
\begin{enumerate}
\item[(\rmnum{1})] If $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$, there exists a unique morphism
\[f_{\red}:(\X,\mathscr{O}_{\X}/\mathscr{I})\to(\Y,\mathscr{O}_{\Y}/\mathscr{K})\]
of schemes such that the following diagram 
\begin{equation}\label{scheme formal f_red induced morphism-1}
\begin{tikzcd}
(\X,\mathscr{O}_{\X}/\mathscr{I})\ar[d]\ar[r,"f_{\red}"]&(\Y,\mathscr{O}_{\Y}/\mathscr{K})\ar[d]\\
(\X,\mathscr{O}_X)\ar[r,"f"]&(\Y,\mathscr{O}_{\Y})
\end{tikzcd}
\end{equation} 
\item[(\rmnum{2})] Suppose that $\X=\Spf(A)$, $\Y=\Spf(B)$ are formal affine schemes, $\mathscr{I}=\mathfrak{I}^{\Delta}$, $\mathscr{K}=\mathfrak{K}^{\Delta}$, where $\mathfrak{I}$ (resp. $\mathfrak{K}$) is a nilideal of $A$ (reps. $B$), and $f=({^{a}\!\varphi},\tilde{\varphi})$ where $\varphi:B\to A$ is a continuous homomorphism. For $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{K}$, it is necessary and sufficient that $\varphi(\mathfrak{K})\sub\mathfrak{I}$, and $f_{\red}$ is then the morphism $({^{a}\!\varphi'},\tilde{\varphi}')$, where $\varphi':B/\mathfrak{K}\to A/\mathfrak{I}$ is the induced homomorphism by passing to quotients.
\end{enumerate}
\end{proposition}
\begin{proof}
In case (a), the hypothesis implies that the image of the ideal $f^{-1}(\mathscr{K})$ of $f^{-1}(\mathscr{O}_{\Y})$ under $f^{\#}:f^{-1}(\mathscr{O}_{\Y})\to\mathscr{O}_{\X}$ is contained in $\mathscr{I}$. By passing to quotients, we then deduce that $f^{\#}$ is a homomorphism
\[\omega:f^{-1}(\mathscr{O}_{\Y}/\mathscr{K})=f^{-1}(\mathscr{O}_{\Y})/f^{-1}(\mathscr{K})\to\mathscr{O}_{\X}/\mathscr{I};\]
moreover, as for any $x\in\X$, $f^{\#}_x$ is a local homomorphism, so is $\omega_x$. The morphism $(f,\omega^{\flat})$ is then the unique morphism of ringed spaces satisfying the requirements.\par
With the assumptions of (b), the canonical correspondence between morphisms of formal affine schemes and continuous homomorphisms of ringed spaces shows that the relation $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$ implies that $f'=({^{a}\!\varphi'},\tilde{\varphi}')$, where $\varphi':B/\mathfrak{K}\to A/\mathfrak{I}$ is the unique homomorphism such that the diagram
\begin{equation}\label{scheme formal f_red induced morphism-2}
\begin{tikzcd}
B\ar[r,"\varphi"]\ar[d]&A\ar[d]\\
B/\mathfrak{K}\ar[r,"\varphi'"]&A/\mathfrak{I}
\end{tikzcd}
\end{equation}
The existence of $\varphi'$ implies then that $\varphi(\mathfrak{K})\sub\mathfrak{I}$. Conversely, if this condition is verified, we have a canonical homomorphism $\varphi':B/\mathfrak{K}\to A/\mathfrak{I}$, whence the induced morphism $f'=({^{a}\!\varphi'},\tilde{\varphi}')$ satisfies the commutativity of (\ref{scheme formal f_red induced morphism-2}). By considering the homomorphisms ${^{a}\!\varphi}^*(\mathscr{O}_{\Y})\to\mathscr{O}_{\X}$ and ${^{a}\!\varphi'}^*(\mathscr{O}_{\Y}/\mathscr{K})\to\mathscr{O}_{\X}/\mathscr{I}$, we then see that $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$.
\end{proof}
To conclude this paragraph, we discuss the fiber product of formal schemes. Let $\mathfrak{S}$ be a formal scheme. It turns out that the fiber product of formal schemes has the same construction as that of usual schemes, provided that we replace tensor products by completed tensor products.
\begin{proposition}\label{scheme formal affine product exist}
Let $\X=\Spf(B)$, $\Y=\Spf(C)$ be two formal affine schemes over a formal affine scheme $\Spf(A)$. Let $\mathfrak{Z}=\Spf(B\widehat{\otimes}_AC)$ and $p_1,p_2$ be the $\mathfrak{S}$-morphisms corresponding to the $A$-homomorphisms $\rho_1:B\to B\widehat{\otimes}_AC$ and $\rho_2:C\to B\widehat{\otimes}_AC$. Then $(\mathfrak{Z},p_1,p_2)$ forms a product in the category of the formal $\mathfrak{S}$-schemes $\X$ and $\Y$.
\end{proposition}
\begin{proof}
In view of \cref{scheme formal affine morphism correspond}, we note that for any continuous $A$-homomorphism $\varphi:B\widehat{\otimes}_AC\to D$, where $D$ is an admissible ring that is a topological $A$-algebra, we can associate the couple $(\varphi\circ\sigma_1,\varphi\circ\sigma_2)$, so that we define a bijection
\[\Hom_A(B\widehat{\otimes}_AC,D)\stackrel{\sim}{\to}\Hom_A(B,D)\times\Hom_A(C,D)\]
which follows from the universal property of the complete tensor product.
\end{proof}
\begin{proposition}\label{scheme formal product exist}
For any formal $\mathfrak{S}$-schemes $\X,\Y$, the product $\X\times_{\mathfrak{S}}\Y$ exists.
\end{proposition}
\begin{proof}
The demonstration is similar as the case for usual schemes, where we replace affine schemes by formal affine schemes and use \cref{scheme formal affine product exist}.
\end{proof}
\subsection{Inductive limits of schemes}
Let $\X$ be a formal scheme, $(\mathscr{I}_\lambda)$ be a fundamental system of nilideals of $\X$; for each $\lambda$, let $f_\lambda:(\X,\mathscr{O}_{\X}/\mathscr{I}_\lambda)\to\X$. For $\mathscr{I}_\mu\sub\mathscr{I}_\lambda$, the canoincal homomorphism $\mathscr{O}_{\X}/\mathscr{I}_\mu\to\mathscr{O}_{\X}/\mathscr{I}_\lambda$ defines a canonical morphism
\[f_{\mu\lambda}:(\X,\mathscr{O}_{\X}/\mathscr{I}_\lambda)\to(\X,\mathscr{O}_{\X}/\mathscr{I}_\mu)\]
of (usual) schemes such that we have $f_\lambda=f_\mu\circ f_{\mu\lambda}$. The scheme $X_\lambda=(\X,\mathscr{O}_{\X}/\mathscr{I}_\lambda)$ is the morphisms $f_{\mu\lambda}$ then constitutes an inductive system in the category of formal schemes.
\begin{proposition}\label{scheme formal inductive limit by fundamental system}
The formal scheme and the morphisms $f_\lambda$ constitute an inductive limit of the system $(X_\lambda,f_{\mu\lambda})$ in the cateogry of formal schemes.
\end{proposition}
\begin{proof}
Let $\Y$ be a formal scheme, and for each index $\lambda$, let
\[g_\lambda:X_\lambda\to\Y\]
be a morphism such that $g_\lambda=g_\mu\circ f_{\mu\lambda}$ for $\mathscr{I}_\mu\sub\mathscr{I}_\lambda$. This last condition and the definition of $X_\lambda$ then imply that the $g_\lambda$ are equal to the same continuous map $g:\X\to\Y$ on the underlying space; moreover, the homomorphisms $g_\lambda^{\#}:g^{-1}(\mathscr{O}_{\Y})\to\mathscr{O}_{X_\lambda}=\mathscr{O}_{\X}/\mathscr{I}_\lambda$ form a projective system of homomorphisms of sheaves of rings. By passing to projective limit, we then deduce a homomorphism $\omega:g^{-1}(\mathscr{O}_{\Y})\to\lim\mathscr{O}_{\X}/\mathscr{I}_\lambda=\mathscr{O}_{\X}$, and it is clear that $(g,\omega)$ is a morphism of ringed spaces such that the diagram
\begin{equation}\label{scheme formal inductive limit by fundamental system-1}
\begin{tikzcd}
X_\lambda\ar[rd,"f_\lambda"]\ar[rr,"g_\lambda"]&&\Y\\
&\X\ar[ru,"g"]&
\end{tikzcd}
\end{equation}
It remains to prove that $g$ is a morphism of formal schemes; the question is local on $\X$ and $\Y$, we can assume that $\X=\Spf(A)$, $\Y=\Spf(B)$, where $A,B$ are admissible rings, and $\mathscr{I}_\lambda=\mathfrak{I}^{\Delta}$ where $(\mathfrak{I}_\lambda)$ is a fundamental system of nilideals of $A$ (\cref{scheme formal affine nilideal iff}). As $A=\llim A/\mathfrak{I}_\lambda$, the existence of the morphism of formal affine schemes $g$ fitting into the diagram (\ref{scheme formal inductive limit by fundamental system-1}) then follows from the one-to-one correspondence \cref{scheme formal affine morphism correspond} between morphisms of formal affine schemes and continuous homomorphisms of rings, and of the definition of the projective limit. But the uniqueness of $g$ as a morphism of ringed spaces shows that it coincides with the morphism at the beginning of the demonstration.
\end{proof}
\begin{proposition}\label{scheme projective system limit exist if}
Let $\X$ be a topological space, $(\mathscr{O}_i,u_{ji})$ a projective system of sheaves of rings over $\X$ indexed by $\N$. Let $\mathscr{I}_i$ be the kernel of $u_{0,i}:\mathscr{O}_i\to\mathscr{O}_0$ and suppose that
\begin{enumerate}
\item[(a)] For each $i$, the ringed space $X_i=(\X,\mathscr{O}_i)$ is a scheme.
\item[(b)] For any $x\in\X$ and any $i\in\N$, there exists an open neighborhood $U_i$ of $x$ in $\X$ such that the restriction $\mathscr{I}_i|_{U_i}$ is nilpotent.
\item[(c)] The homomorphisms $u_{ji}$ are surjective.
\end{enumerate}
Let $\mathscr{O}_{\X}$ be the sheaf of topological rings which is the projective limit of the sheaf of discrete rings $\mathscr{O}_i$, and $u_i:\mathscr{O}_{\X}\to\mathscr{O}_i$ be the canonical homomorphism. Then the topologically ringed space $(\X,\mathscr{O}_{\X})$ is a formal scheme and the homomorphisms $u_i$ are surjective. If $\mathscr{I}^{(i+1)}$ is the kernel of $u_i$, then $(\mathscr{I}^{(i)})$ form a fundamental system of nilideals of $\X$, and $\mathscr{I}^{(1)}$ is the projective limit of the sheaf of ideals $\mathscr{I}_i$.
\end{proposition}
\begin{proof}
We first note that at each stalk, $u_{ji}$ is a surjective hommorphism and a fortiori a local homomorphism, so $v_{ij}=(1_{\X},u_{ji}):X_j\to X_i$ is a morphism of schemes for $i\geq j$. Suppose that each $X_i$ is an affine scheme with ring $A_i$. Then there exists a homomorphism $\varphi_{ji}:A_i\to A_j$ such that $u_{ji}=\tilde{\varphi}_{ji}$, so the sheaf $\mathscr{O}_j$ is a quasi-coherent $\mathscr{O}_i$-module over $X_i$, associated with $A_j$ considered as an $A_i$-module via $\varphi_{ji}$. For each $f\in A_i$, let $f'=\varphi_{ji}(f)$; by hypothesis, the opens $D(f)$ and $D(f')$ are identical over $\X$, and the homomorphism from $\Gamma(D(f),\mathscr{O}_i)=(A_i)_f$ to $\Gamma(D(f),\mathscr{O}_j)=(A_j)_{f'}$ corresponding to $u_{ji}$ is none other than $(A_j)_{f'}$. But if we consider $A_j$ as an $A_i$-module, $(A_j)_{f'}$ is the $(A_j)_f$-module $(A_j)_f$, so we have $u_{ji}=\tilde{\varphi}_{ji}$, if $\varphi_{ji}$ is considered as a homomorphism of $A_i$-modules. Then, as $u_{ji}$ is surjective, so is the $\varphi_{ji}$ and if $\mathfrak{ji}$ is the kernel of $\varphi_{ji}$, the kernel of $u_{ji}$ is the quasi-coherent $\mathscr{O}_i$-module $\widetilde{\mathfrak{I}}_{ji}$. In particular, we have $\mathscr{I}_i=\widetilde{\mathfrak{I}}_i$, where $\mathfrak{I}_i$ is the kernel of $\varphi_{0,i}:A_i\to A_0$. The hypothesis (b) implies that $\mathscr{I}_i$ is nilpotent: in fact, as $\X$ is quasi-compact, we can cover $X$ by finitely many opens $U_k$ such that $(\mathscr{I}_i|_{U_k})^{n_k}=0$ and by choosing $n$ to be the largest $n_k$, we have $\mathscr{I}_i^n=0$; we then conclude that each $\mathfrak{I}_i$ is nilpotent. Then the ring $A=\llim A_i$ is admissible by \cref{admissible rings iff projective limit of discrete}, the canonical homomorphisms $\varphi_i:A\to A_i$ is surjective and its kernel $\mathfrak{I}^{(i+1)}$ is equal to the projective limit of the $\mathfrak{I}_{ik}$ for $k\geq i$; the $\mathfrak{I}^{(i+1)}$ form a fundamental system of neighborhoods of $0$ in $A$. The assertion of the proposition then follows from the fact that $(\X,\mathscr{O}_{\X})=\Spf(A)$. We also note that if $f=(f_i)$ is an element in the projective limit $A=\llim A_i$, the open subsets $D(f_i)$ (affine open in $X_i$) is then identified with $\mathfrak{D}(f)$, and the scheme induced by $X_i$ over $\mathfrak{D}(f)$ is then identified with the affine scheme $\Spec((A_i)_{f_i})$.\par
In the general case, we remark that for any quasi-compact open $U$ of $\X$, the $\mathscr{I}_i|_U$ is nilpotent as we have seen. We claim that for any $x\in\X$, there is an open neighborhood $U$ of $x$ in $\X$ which is an affine open for any $X_i$. In fact, let $U$ be an affine open for $X_0$, and observe that $\mathscr{O}_{X_0}=\mathscr{O}_X/\mathscr{I}_i$. As $\mathscr{I}_i|_U$ is nilpotent in view of the preceding arguments, $U$ is also an affine open for $X_i$ in view of \cref{scheme affine closed subscheme is affine}. Now for any $U$ satisfying this property, it follows from the same arguments that $(U,\mathscr{O}_{\X}|_U)$ is a formal scheme such that the $\mathscr{I}^{(i)}|_U$ form a fundamental system of nilideals and $\mathscr{I}^{(1)}|_U$ is the projective limit of $\mathscr{I}_i|_U$, whence the conclusion.
\end{proof}
\begin{corollary}\label{scheme projetive system limit adic if}
Suppose that for $i\geq j$, the kernel of $u_{ji}$ is $\mathscr{I}_i^{j+1}$ and that $\mathscr{I}_1/\mathscr{I}_1^2$ is of finite type over $\mathscr{O}_0=\mathscr{O}_1/\mathscr{I}_1$. Then $\X$ is an adic formal scheme, and we have $\mathscr{I}^{(i)}=\mathscr{I}^{i+1}$ and $\mathscr{I}/\mathscr{I}^2$ is isomorphic to $\mathscr{I}_1$, where we put $\mathscr{I}=\mathscr{I}^{(1)}$. If moreover $X_0$ is locally Noetherian (resp. Noetherian), then $\X$ is locally Noetherian (resp. Noetherian).
\end{corollary}
\begin{proof}
As the underlying space of $\X$ and $X_0$ are the same, the question is local and we can assume that each $X_i$ is affine. In view of the relations $\mathscr{I}_{ji}=\widetilde{\mathfrak{I}}_{ji}$ (With the notations of \cref{scheme projective system limit exist if}), we are then reduced to the case of \cref{ring inverse limit complete and finiteness prop}, and note that $\mathfrak{I}_1/\mathfrak{I}_1^2$ is then a finitely generated $A_0$-module (\cref{scheme affine qcoh ft and fp iff}). 
\end{proof}
In particular, any locally Noetherian formal scheme $\X$ is the inductive limit of a sequence $(X_n)$ of locally Noetherian (usual) schemes verifying the conditions of \cref{scheme projective system limit exist if} and \cref{scheme projetive system limit adic if}: it suffices to consider a nilideal $\mathscr{I}$ of $\X$ (\cref{scheme formal local Noe X_red}) and put $X_n=(\X,\mathscr{O}_{\X}/\mathscr{I}^{n+1})$ (\cref{scheme formal inductive limit by fundamental system}). More generally, the same is true if $\X$ is an adic formal scheme having a nilideal $\mathscr{I}$ such that $\mathscr{I}/\mathscr{I}^2$ is a finitely generated $(\mathscr{O}_{\X}/\mathscr{I})$-module.
\begin{corollary}\label{scheme formal affine Noe iff Noe adic ring}
Let $A$ be an admissible ring. For the formal affine scheme $\X=\Spf(A)$ to be Noetherian, it is necessary and sufficient that $A$ is adic and Noetherian.
\end{corollary}
\begin{proof}
This condition is clearly sufficient. Conversely, suppose that $\X$ is Noetherian, and let $\mathfrak{I}$ be a nilideal of $A$, $\mathscr{I}=\mathfrak{I}^{\Delta}$ the nilideal of $\X$. The (usual) schemes $X_n=(\X,\mathscr{O}_{\X}/\mathscr{I}^{n+1})$ is then affine and Noetherian, so the ring $A_n=A/\mathscr{I}^{n+1}$ is Noetherian (\cref{scheme affine Noe iff Noe ring}), and we conclude that $\mathfrak{I}/\mathfrak{I}^2$ is a finitely generated $(A/\mathfrak{I})$-module. As the $\mathfrak{I}^n$ form a fundamental system of nilideals of $\X$, we have $\mathscr{O}_{\X}=\llim(\mathscr{O}_{\X}/\mathfrak{I}^n)$ (\cref{scheme formal structural sheaf projective limit}). 
\end{proof}
\begin{remark}\label{scheme projetive limit of module along projective system}
With the notations of \cref{scheme projective system limit exist if}, let $\mathscr{F}_i$ be an $\mathscr{O}_i$-module, and suppose that for $i\geq j$ we are given a $v_{ij}$-morphism $\theta_{ji}:\mathscr{F}_i\to\mathscr{F}_j$, such that $\theta_{kj}\circ\theta_{ji}=\theta_{ki}$ for $k\leq j\leq i$. As the underlying continuous map of $v_{ij}$ is the identity, $\theta_{ji}$ is a homomorphism of sheaves of abelian groups over $\X$. Moreover, if $\mathscr{F}$ is the limit of the projective system $(\mathscr{F}_i)$ of sheaves of abelian groups, the fact that each $\theta_{ji}$ is a $v_{ij}$-morphism permits us to define over $\mathscr{F}$ an $\mathscr{O}_{\X}$-module structure by passing to projective limits. With this, we say that $\mathscr{F}$ is the \textbf{projective limit} (for the $\theta_{ji}$) of the system of $\mathscr{O}_i$-modules $(\mathscr{F}_i)$. In the particular case where $v_{ij}^*(\mathscr{F}_i)=\mathscr{F}_j$ and there $\theta_{ji}$ is the identity, we then say that $\mathscr{F}$ is the limit of the system $(\mathscr{F}_i)$ such that $v_{ij}^*(\mathscr{F}_i)=\mathscr{F}_j$ for $j\leq i$ (without mension of $\theta_{ji}$).
\end{remark}
Let $\X,\Y$ be two formal schemes, $\mathscr{I}$ (resp. $\mathscr{K}$) be a nilideal of $\X$ (resp. $\Y$), and $f:\X\to\Y$ be a morphism such that $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$. We then have for each integer $n>0$ that $f^*(\mathscr{K}^n)\mathscr{O}_{\X}=(f^*(\mathscr{K})\mathscr{O}_{\X})^n\sub\mathscr{I}^n$, so \cref{scheme formal f_red induced morphism} deduce a morphism $f_n:X_n\to Y_n$ of (usual) schemes such that the diagram
\begin{equation}\label{scheme formal nilideal inverse induced morphism}
\begin{tikzcd}
X_m\ar[r,"f_m"]\ar[d]&Y_m\ar[d]\\
X_n\ar[r,"f_n"]&Y_n
\end{tikzcd}
\end{equation}
is commutative for $m\leq n$; in other words, $(f_n)$ is a inductive system of morphisms.\par
Conversely, let $(X_n)$ (resp. $(Y_n)$) be a inductive system of schemes satisfying the conditions (b), (c) of \cref{scheme projective system limit exist if}, and let $\X$ (resp. $\Y$) be the inductive limits (whose existence is proved by \cref{scheme projective system limit exist if}). By the definition of inductive limits, any inductive system $(f_n)$ of morphisms $f_n:X_n\to Y_n$ admits an inductive limit $f:\X\to\Y$, which is the unique morphism of formal schemes rendering the diagram
\[\begin{tikzcd}
X_n\ar[d]\ar[r,"f_n"]&Y_n\ar[d]\\
\X\ar[r,"f"]&\Y
\end{tikzcd}\]
\begin{proposition}\label{scheme formal adic morphism limit correspondence}
Let $\X,\Y$ be adic formal schemes, $\mathscr{I}$ (resp. $\mathscr{K}$) be a nilideal of $\X$ (resp. $\Y$). The map $f\mapsto(f_n)$ is a bijection from the set of morphisms $f:\X\to\Y$ such that $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$ to the set of sequences $(f_n)$ of morphisms rendering the diagram (\ref{scheme formal nilideal inverse induced morphism}).
\end{proposition}
\begin{proof}
If $f$ is the inductive limit of this sequence, it is necessary to prove that $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$. This question is local over $\X$ and $\Y$, so we can assume that $\X=\Spf(A)$, $\Y=\Spf(B)$ are affine, where $A,B$ are adic, $\mathscr{I}=\mathfrak{I}^{\Delta}$, $\mathscr{K}=\mathfrak{K}^{\Delta}$, where $\mathfrak{I}$ (resp. $\mathfrak{K}$) is a nilideal of $A$ (resp. $B$). We then have $X_n=\Spec(A_n)$, $Y_n=\Spec(B_n)$, where $A_n=A/\mathfrak{I}^{n+1}$ and $B_n=B/\mathfrak{K}^{n+1}$, in view of \cref{scheme formal affine adic ft ideal prop}. Then $f_n=({^{a}\!\varphi_n},\tilde{\varphi}_n)$, where $\varphi_n:B_n\to A_n$ is the homomorphism forming a projective system, so $f=({^{a}\!\varphi},\tilde{\varphi})$, where $\varphi=\llim\varphi_n$. The commutative diagram (\ref{scheme formal nilideal inverse induced morphism}) shows that $\varphi_n(\mathfrak{K}/\mathfrak{K}^{n+1})\sub\mathfrak{I}/\mathfrak{I}^{n+1}$ for each $n$ (by take $m=0$), so by passing to limit, $\varphi(\mathfrak{K})\sub\mathfrak{I}$, and this implies $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{I}$ (\cref{scheme formal f_red induced morphism}).
\end{proof}
\begin{corollary}\label{scheme formal local Noe morphism limit correspondence}
Let $\X,\Y$ be locally Noetherian formal schemes, $\mathscr{T}$ be the largest nilideal of $\X$.
\begin{enumerate}
\item[(\rmnum{1})] For any nilideal $\mathscr{K}$ of $\Y$ and any morphism $f:\X\to\Y$, we have $f^*(\mathscr{K})\mathscr{O}_{\X}\sub\mathscr{T}$. 
\item[(\rmnum{2})] There exists a bijective correspondence between $\Hom(\X,\Y)$ and the set of sequences $(f_n)$ of morphisms rendering the diagram (\ref{scheme formal nilideal inverse induced morphism}), where $X_n=(\X,\mathscr{O}_{\X}/\mathscr{T}^{n+1})$, $Y_n=(\Y,\mathscr{O}_{\Y}/\mathscr{K}^{n+1})$.
\end{enumerate}
\end{corollary}
\begin{proof}
It is clear that (\rmnum{2}) follows from (\rmnum{1}) and \cref{scheme formal adic morphism limit correspondence}. To prove (\rmnum{1}), we can assume that $\X=\Spf(A)$, $\Y=\Spf(B)$, $A,B$ being Noetherian and adic, $\mathscr{T}=\mathfrak{T}^{\Delta}$, $\mathscr{K}=\mathfrak{K}^{\Delta}$, where $\mathfrak{T}$ is the largest nilideal of $A$ and $\mathfrak{K}$ is a nilideal of $B$. Let $f=({^{a}\!\varphi},\tilde{\varphi})$ where $\varphi:B\to A$ is a continuous homomorphism; as the elements of $\mathfrak{K}$ are topologically nilpotent, so are those of $\varphi(\mathfrak{K})$, so $\varphi(\mathfrak{K})\sub\mathfrak{T}$ since $\mathfrak{T}$ is the set of topologically nilpotent elements of $A$ (\cref{admissible ring nilpotent iff contained in nilideal}). The conclusion then follows from \cref{scheme formal f_red induced morphism}(\rmnum{2}).
\end{proof}
\begin{corollary}\label{scheme formal adic S-morphism limit correspondence}
Let $f:\X\to\mathfrak{S}$ and $g:\Y\to\mathfrak{S}$ be morphisms of adic formal schemes. Let $\mathscr{I}$ (resp. $\mathscr{K}$, $\mathscr{L}$) be a nilideal of $\mathfrak{S}$ (resp. $\X$, $\Y$), and suppose that $f^*(\mathscr{I})\mathscr{O}_{\X}\sub\mathscr{K}$, $g^*(\mathscr{I})\mathscr{O}_{\Y}=\mathscr{L}$. Let $S_n=(\mathfrak{S},\mathscr{O}_{\mathfrak{S}}/\mathscr{I}^{n+1})$, $X_n=(\X,\mathscr{O}_{\mathfrak{X}}/\mathscr{K}^{n+1})$, $Y_n=(\Y,\mathscr{O}_{\mathfrak{Y}}/\mathscr{L}^{n+1})$. Then there exists a bijective correspondence between $\Hom_{\mathfrak{S}}(\X,\Y)$ and the set of sequences $(u_n)$ of $S_n$-morphisms $u_n:X_n\to Y_n$ rendering the diagram (\ref{scheme formal nilideal inverse induced morphism}).
\end{corollary}
\begin{proof}
For any $\mathfrak{S}$-morphism $u:\X\to\Y$, we have $f=g\circ u$ by definition, so
\[u^*(\mathscr{L})\mathscr{O}_{\X}=u^*(g^*(\mathscr{I})\mathscr{O}_{\Y})\mathscr{O}_{\X}=f^*(\mathscr{I})\mathscr{O}_{\X}\sub\mathscr{K},\]
so the corollary follows from \cref{scheme formal adic morphism limit correspondence}.
\end{proof}
We note that, for $m\leq n$, the datum of a morphism $f_n:X_n\to Y_n$ determines uniquely a morphism $f_m:X_m\to Y_m$ rendering the diagram (\ref{scheme formal nilideal inverse induced morphism}), as we immediately see by reducing to the affine case; we have thus defined a map
\[\varphi_{mn}:\Hom_{S_n}(X_n,Y_n)\to\hom_{S_m}(X_m,Y_m)\]
and the $\Hom_{S_n}(X_n,Y_n)$ form for the $\varphi_{mn}$ a projective system of sets; \cref{scheme formal adic S-morphism limit correspondence} then shows that there exists a canonical bijection
\[\Hom_{\mathfrak{S}}(\X,\Y)\stackrel{\sim}{\to}\llim_n\Hom_{S_n}(X_n,Y_n).\]
\begin{remark}
Let $\mathfrak{S}$, $\X,\Y$ be formal schemes and $f:\X\to\mathfrak{S}$, $g:\Y\to\mathfrak{S}$ be morphisms. Suppose that there are fundamental system of nilideals $(\mathscr{I}_\lambda)$, $(\mathscr{K}_\lambda)$, $(\mathscr{L}_\lambda)$ in $\mathfrak{S}$, $\X,\Y$, respectively, with the same index set $I$, such that $f^*(\mathscr{I}_\lambda)\mathscr{O}_{\X}\sub\mathscr{K}_\lambda$ and $g^*(\mathscr{I}_\lambda)\mathscr{O}_{\Y}\sub\mathscr{L}_\lambda$ for any $\lambda$. Put $S_\lambda=(\mathfrak{S},\mathscr{O}_{\mathfrak{S}}/\mathscr{I}_\lambda)$, $X_\lambda=(\X,\mathscr{O}_{\X}/\mathscr{K}_\lambda)$, $Y_\lambda=(\Y,\mathscr{O}_{\Y}/\mathscr{L}_\lambda)$; for $\mathscr{I}_\mu\sub\mathscr{I}_\lambda$, $\mathscr{K}_\mu\sub\mathscr{K}_\lambda$, $\mathscr{L}_\mu\sub\mathscr{L}_\lambda$, note that $S_\lambda$ (resp. $X_\lambda$, $Y_\lambda$) is a closed subscheme of $S_\mu$ ($X_\mu$, $Y_\mu$) with the same underlying space. As $S_\lambda\to S_\mu$ is a monomorphism of schemes, we then see that the products $X_\lambda\times_{S_\lambda}Y_\lambda$ and $X_\lambda\times_{S_\mu}Y_\lambda$ are identical (\cref{scheme product inverse image of base open}), because $X_\lambda\times_{S_\mu}Y_\lambda$ is identified with a closed subscheme of $X_\mu\times_{S_\mu}Y_\mu$ with the same underlying space. Now the product is the inductive limit of the schemes $X_\lambda\times_{S_\lambda}Y_\lambda$: in fact, we see as in \cref{scheme formal inductive limit by fundamental system}, we can assume that $\mathfrak{S}$, $\X$, $\Y$ are formal affine schemes. In view of \cref{scheme formal f_red induced morphism} and our hypotheses, immediately see that our assertion follows from the definition of the completed tensor product of two algebras.\par
Moreover, let $\mathfrak{Z}$ be a formal $\mathfrak{S}$-scheme, $(\mathscr{M}_\lambda)$ be a fundamental system of nilideals of $\mathfrak{Z}$ with index set $I$, $u:\mathfrak{Z}\to\X$, $v:\mathfrak{Z}\to\Y$ be morphisms such that $u^*(\mathscr{K}_\lambda)\mathscr{O}_{\mathfrak{Z}}\sub\mathscr{M}_\lambda$ and $v^*(\mathscr{L}_\lambda)\mathscr{O}_{\mathfrak{Z}}\sub\mathscr{M}_\lambda$. If we put $Z_\lambda=(\mathfrak{Z},\mathscr{O}_{\mathfrak{Z}}/\mathscr{M}_\lambda)$, and if $u_\lambda:Z_\lambda\to X_\lambda$ and $v_\lambda:Z_\lambda\to Y_\lambda$ are the corresponding $S_\lambda$-morphisms, we then verify that $(u,v)_{\mathfrak{S}}$ is the inductive limits of the $S_\lambda$-morphisms $(u_\lambda,v_\lambda)_{S_\lambda}$.
\end{remark}
\subsection{Formal completion of schemes}
Let $X$ be a (usual) scheme, $X'$ be a subscheme of $X$, $U$ be an open subset of $X$ containing $X'$ and such that $X'$ is a closed subscheme of $U$; then $X'$ is defined by a quasi-coherent ideal $\mathscr{I}_U$ of $\mathscr{O}_U$. For any integer $n>0$, and any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $(\mathscr{F}|_U)\otimes_{\mathscr{O}_U}(\mathscr{O}_U/\mathscr{I}_U^n)$ is then a quasi-coherent $\mathscr{O}_U$-module whose support is contained in $X'$, which is therefore often identified with its restriction to $X'$. The family $\{(\mathscr{F}|_U)\otimes_{\mathscr{O}_U}(\mathscr{O}_U/\mathscr{I}_U^n)\}_{n\geq 1}$ then forms a projective system of sheaves of abelian groups. The limit $\llim((\mathscr{F}|_U)\otimes_{\mathscr{O}_U}(\mathscr{O}_U/\mathscr{I}_U^n))$ is called the \textbf{completion of $\mathscr{F}$ along the subscheme $\bm{X'}$ of $\bm{X}$}, and denoted by $\widehat{\mathscr{F}}_{/X'}$ of simply $\widehat{\mathscr{F}}$ (if there is no confusion). The sections of $\widehat{\mathscr{F}}$ over $X'$ are called the \textbf{formal sections} of $\mathscr{F}$ along $X'$.\par
This definition is justified by the fact that it obviously does not depend on the choice open subset $U$, because at every point $x$ of $U-X'$, there is a neighborhood of $x$ in which $\mathscr{O}_U/\mathscr{I}_U^n$ is zero for any integer $n$. We can therefore limit ourselves to the case where $X'$ is a closed subscheme of $X$, and we will always assume this henceforth. Also, it is clear that for any open subset $U\sub X$, we have $(\mathscr{F}|_U)_{/(U\cap X')}=(\mathscr{F}_{/X'})|_{U\cap X'}$.\par
By passing to projective limits, it is clear that $(\mathscr{O}_X)_{/X'}$ is a sheaf of rings, and that $\mathscr{F}_{/X'}$ can be considered as an $(\mathscr{O}_{/X'})$-module. Furthermore, as there existss a basis for $X'$ formed by quasi-compact opens, we can consider $(\mathscr{O}_X)_{/X'}$ (resp. $\mathscr{F}_{/X'}$) as a sheaf of topological rings (resp. topological groups) which is the projective limit of the sheaf of discrete rings $\mathscr{O}_X/\mathscr{I}^n$ (resp. the sheaf of groups $\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}^n)=\mathscr{F}/\mathscr{I}^n\mathscr{F}$), and by passing to projective limits, $\mathscr{F}_{/X'}$ is then a topological $(\mathscr{O}_X)_{/X'}$-module. Note that for any quasi-compact open subset $U$ of $X$, $\Gamma(U\cap X',(\mathscr{O}_X)_{/X'})$ (resp. $\Gamma(U\cap X',\mathscr{F}_{/X'})$) is then the projective limit of the discrete rings (resp. groups) $\Gamma(U,\mathscr{O}_X/\mathscr{I})$ (resp. $\Gamma(U,\mathscr{F}/\mathscr{I}\mathscr{F})$).\par
Now let $u:\mathscr{F}\to\mathscr{G}$ be a homomorphism of $\mathscr{O}_X$-modules, we then deduce a canonical homomorphism
\[u_{\mathscr{I}^n}:\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}^n)\to\mathscr{G}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}^n)\]
for any $n\geq 1$, and these homomorphisms form a projective system. By passing to projective limits and restricting to $X'$, we obtain a continuous $(\mathscr{O}_X)_{/X'}$-homomorphism $\mathscr{F}_{/X'}\to\mathscr{G}_{/X'}$, denoted by $u_{/X'}$ or $\hat{u}$, and is called the \textbf{completion of $\bm{u}$ along $\bm{X'}$}. It is clear that if $v:\mathscr{G}\to\mathscr{H}$ is a second homomorphism of $\mathscr{O}_X$-modules, then $(v\circ u)_{/X'}=(v_{/X'})\circ(u_{/X'})$, so $\mathscr{F}_{/X'}$ is a covariant additive functor on $\mathscr{F}$ from the category of quasi-coherent $\mathscr{O}_X$-modules, with values in the category of $(\mathscr{O}_X)_{/X'}$-modules.
\begin{proposition}\label{scheme closed subscheme completion prop}
Let $X'$ be a closed subscheme of $X$ defined by a quasi-coherent ideal $\mathscr{I}$ of finite type. Then the support of $(\mathscr{O}_X)_{/X'}$ is $X'$, the topologically ringed space $(X',(\mathscr{O}_{X})_{/X'})$ is an adic formal scheme, and $\mathscr{I}_{/X'}$ is a nilideal of this formal scheme. If $X=\Spec(A)$ is an affine scheme, $\mathscr{I}=\widetilde{\mathfrak{I}}$ where $\mathfrak{I}$ is an ideal of $A$, and $X'=V(\mathfrak{I})$, then $(X',(\mathscr{O}_X)_{/X'})$ is canonically identified with $\Spf(\widehat{A})$, where $\widehat{A}$ is the Hausdorff completion of $A$ for the $\mathfrak{I}$-adic topology.
\end{proposition}
\begin{proof}
We can evidently assume that $X=\Spec(A)$ is affine. By \cref{filtration I-adic completion of finite ideal prop} the the Hausdorff completion $\widehat{\mathfrak{I}}$ of $\mathfrak{I}$ for the $\mathfrak{I}$-adic topology is identified with the ideal $\mathfrak{I}\widehat{A}$ of $\widehat{A}$, and that $\widehat{A}$ is a $\widehat{A}$-adic ring such that $\widehat{A}/\widehat{\mathfrak{I}}^n=A/\mathfrak{I}^n$. This last relation (for $n=1$) proves that the open prime ideals of $\widehat{A}$ are the ideals $\hat{\p}=\p\widehat{\mathfrak{I}}$, where $\p$ is a prime ideal of $A$ containing $\mathfrak{I}$, whence $\Spf(\widehat{A})=X'$. As $\mathscr{O}_X/\mathscr{I}^n=\widetilde{A/\mathfrak{I}^n}$, the proposition then follows from the definition of $\Spf(\widehat{A})$.
\end{proof}
The formal scheme therefore defined is called the \textbf{completion} of $X$ along $X'$ and denoted by $X_{/X'}$ or $\widehat{X}$. If $X'=X$, we can set $\mathscr{I}=0$, and then $X_{/X'}=X$. It is clear that if $U$ is an open subscheme of $X$, then $U_{/(U\cap X')}$ is canonically identified with the formal subscheme of $X_{/X'}$ induced over the open subset $U\cap X'$ of $X'$.
\begin{corollary}\label{scheme formal completion reduced prop}
Under the hypothesis of \cref{scheme closed subscheme completion prop}, assume that $X$ is locally Noetherian. Then the (usual) scheme $\widehat{X}_{\red}$ is the unique reduced subscheme of $X$ with underlying space $X'$ (\cref{scheme closed subset reduced subscheme}). For $\widehat{X}$ to be Noetherian, it is necessary and sufficient that $\widehat{X}_{\red}$ is Noetherian, and it is sufficient that $X$ is Noetherian. 
\end{corollary}
\begin{proof}
The determination of $\widehat{X}_{\red}$ is local (\cref{scheme formal local Noe X_red}), so we can assume that $X$ is affine; with the notations of \cref{scheme closed subscheme completion prop}, the ideal $\mathfrak{T}$ of topological nilpotent elements of $\widehat{A}$ is the inverse image of the nilradical of $A/\mathfrak{T}$ under the canonical map $\widehat{A}\to\widehat{A}/\widehat{\mathfrak{I}}=A/\mathfrak{I}$, so $\widehat{A}/\mathfrak{T}$ is isomorphic to $(A/\mathfrak{I})_{\red}$. The first assertion then follows from \cref{scheme formal local Noe X_red} and \cref{scheme closed subset reduced subscheme}. If $\widehat{X}_{\red}$ is Noetherian, its underlying space $X'$ is also Noetherian, so the $X'_n=\Spec(\mathscr{O}_X/\mathscr{I}^n)$ are Noetherian and so is $\widehat{X}$ (\cref{scheme projetive system limit adic if}); the converse of this is immeidate. 
\end{proof}
The canonical homomorphisms $\mathscr{O}_X\to\mathscr{O}_X/\mathscr{I}^n$ form a projective system and therefore gives, by passing to limit, a homomorphism of sheaves of rings $\theta:\mathscr{O}_X\to i_*((\mathscr{O}_X)_{/X'})=\llim(\mathscr{O}_X/\mathscr{I}^n)$, where $i:X'\to X$ is the canonical injection. We therefore obtain a morphism
\[(i,\theta):X_{/X'}\to X\]
of ringed spaces, called the \textbf{canonical morphism}. By tensoring, for any coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphisms $\mathscr{O}_X\to\mathscr{O}_X/\mathscr{I}^n$ gives homomorphisms $\mathscr{F}\to\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}^n)$ of $\mathscr{O}_X$-modules which form a projective system, and hence defines a canonical functorial homomorphism $\gamma:\mathscr{F}\to i_*(\mathscr{F}_{/X'})$ of $\mathscr{O}_X$-modules.
\begin{example}\label{scheme formal completion of local Noe independent of ideal}
Let $X',X''$ be closed subschemes of $X$, defined by quasi-coherent ideals $\mathscr{I}$, $\mathscr{I}'$ of $\mathscr{O}_X$. Suppose that for any affine open $U$ of $X$, the ideals $\mathscr{I}|_U$, $\mathscr{I}'|_U$ of $\mathscr{O}_U$ are such that there exists integers $m,m'>0$ such that $(\mathscr{I}|_U)^m\sub\mathscr{I}'|_U$ and $(\mathscr{I}'|_U)^{m'}\sub\mathscr{I}|_U$. It is clear that under this condition, for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the sheaf of abelian groups $\llim(\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}^n))$ and $\llim(\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}'^n))$ are canonically isomorphic, which means $\mathscr{F}_{/X'}=\mathscr{F}_{/X''}$. Note that this condition on $X'$ and $X''$ implies that these two closed subschemes have the same underlying space, but is not in general equivalent to the latter property.\par
However, if the quasi-coherent ideals $\mathscr{I}$ and $\mathscr{I}'$ are of finite type, then it follows from \cref{scheme qc qcoh ft ideal power annihilated if supp} that if the subschemes $X'$ and $X''$ have the same underlying space, the above condition is satisfied. In particular, if $X$ is locally Noetherian, so that any quasi-coherent ideal of $\mathscr{O}_X$ is of finite type, then for any closed subset (or locally closed) $X'$ of $X$, we can define $\mathscr{F}_{/X'}$ to be equal to $\mathscr{F}_{/Y}$ for any subscheme $Y$ of $X$ with underlying space $X'$.
\end{example}
\begin{proposition}\label{scheme local Noe formal completion exact}
Suppose that $X$ is locally Noetherian and let $X'$ be a closed subset of $X$, $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module.
\begin{enumerate}
\item[(\rmnum{1})] The functor $\mathscr{F}_{/X'}$ is exact on the category of coherent $\mathscr{O}_X$-modules.
\item[(\rmnum{2})] The functorial homomorphism $\gamma^{\sharp}:i^*(\mathscr{F})\to\mathscr{F}_{/X'}$ of $(\mathscr{O}_X)_{/X'}$-modules is an isomorphism.
\end{enumerate}
\end{proposition}
\begin{proof}
To prove (\rmnum{1}), it suffices to prove that if $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$ is an exact sequence of coherent $\mathscr{O}_X$-modules and $U$ is an affine open of $X$ with Noetherian ring $A=\Gamma(U,\mathscr{O}_X)$, the sequence
\[\begin{tikzcd}
0\ar[r]&\Gamma(U\cap X',\mathscr{F}'_{/X'})\ar[r]&\Gamma(U\cap X',\mathscr{F}_{/X'})\ar[r]&\Gamma(U\cap X',\mathscr{F}''_{/X'})\to 0
\end{tikzcd}\]
is exact. Then $\mathscr{F}|_U=\widetilde{M}$, $\mathscr{F}'|_U=\widetilde{M}'$, $\mathscr{F}''|_U=\widetilde{M}''$, where $M,M',M''$ are $A$-modules of finite type such that the sequence $0\to M'\to M\to M''\to 0$ is exact. Let $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_U$ defining a subscheme of $U$ with underlying space $U\cap X'$, and $\mathfrak{I}$ be the ideal of $A$ such that $\mathscr{I}=\widetilde{\mathfrak{I}}$. We have (\cref{scheme affine associated sheaf tensor and Hom})
\[\Gamma(U\cap X',\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}^n))=M\otimes_A(A/\mathfrak{I}^n);\]
so by the definition of projective limit,
\[\Gamma(U\cap X',\mathscr{F}_{/X'})=\llim(M\otimes_A(A/\mathfrak{I}^n))=\widehat{M}\]
where $\widehat{M}$ is the Huasdorff completion of $M$ for the $\mathfrak{I}$-adic topology, and similarly
\[\Gamma(U\cap X',\mathscr{F}'_{/X'})=\widehat{M}',\quad \Gamma(U\cap X',\mathscr{F}''_{/X'})=\widehat{M}'';\]
our assertion then follows from the fact that $A$ is Noetherian and the functor $\widehat{M}$ on $M$ is exact on the category of finitely generated $A$-modules (\cref{filtration Noe I-adic completion is tensor}).\par
For assertion (\rmnum{1}), the assertion is local, so we can assume that there exists an exact sequence $\mathscr{O}_X^m\to\mathscr{O}_X^n\to\mathscr{F}\to 0$; as $\gamma^{\sharp}$ is functorial, and the functors $i^*(\mathscr{F})$ and $\mathscr{F}_{/X'}$ are right exact, we have a commutative diagram
\begin{equation}\label{scheme local Noe formal completion exact-1}
\begin{tikzcd}
i^*(\mathscr{O}_X^m)\ar[d,"\gamma^{\sharp}"]\ar[r]&i^*(\mathscr{O}_X^n)\ar[r]\ar[d,"\gamma^{\sharp}"]&i^*(\mathscr{F})\ar[d,"\gamma^{\sharp}"]\ar[r]&0\\
(\mathscr{O}_X^m)_{/X'}\ar[r]&(\mathscr{O}_X^n)_{/X'}\ar[r]&\mathscr{F}_{/X'}\ar[r]&0
\end{tikzcd}
\end{equation}
with exact rows. Moreover, the functors $i^*(\mathscr{F})$ and $\mathscr{F}_{/X'}$ commutes with finite sums, so we are reduced to the case where $\mathscr{F}=\mathscr{O}_X$. We then have $i^*(\mathscr{O}_X)=(\mathscr{O}_X)_{/X'}=\mathscr{O}_{\widehat{X}}$, and $\gamma^{\sharp}$ is a homomorphism of $\mathscr{O}_{\widehat{X}}$-modules; it then suffices to verify that $\gamma^{\sharp}$ maps the unit section of $\mathscr{O}_{\widehat{X}}$ over an open subset of $X'$ to itself, which is immediate and also shows that $\gamma^{\sharp}$ is the identity.
\end{proof}
\begin{corollary}\label{scheme local Noe formal completion morphism flat}
Under the hypotheses of \cref{scheme local Noe formal completion exact}, the morphism $i:\widehat{X}\to X$ is flat.
\end{corollary}
\begin{corollary}\label{scheme local Noe formal completion and tensor Hom}
Let $X$ be a locally Noetherian scheme. If $\mathscr{F}$ and $\mathscr{G}$ are coherent $\mathscr{O}_X$-modules, there exists a canonical functorial isomorphism
\begin{gather}
(\mathscr{F}_{/X'})\otimes_{(\mathscr{O}_{X})_{/X'}}(\mathscr{G}_{/X'})\stackrel{\sim}{\to}(\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{G})_{/X'},\label{scheme local Noe formal completion and tensor Hom-1}\\
(\sHom_{\mathscr{O}_X}(\mathscr{F},\mathscr{G}))_{/X'}\stackrel{\sim}{\to}\sHom_{(\mathscr{O}_X)_{/X'}}(\mathscr{F}_{/X'},\mathscr{G}_{/X'}).\label{scheme local Noe formal completion and tensor Hom-2}
\end{gather}
\end{corollary}
\begin{proof}
This follows from the canonical identification of $i^*(\mathscr{F})$ and $\mathscr{F}_{/X'}$; the existence of the first isomorphism is clear for any morphism of ringed spaces and the second is the homomorphism of (\ref{ringed space inverse image and sheaf Hom}), which is an isomorphism for any flat morphism.
\end{proof}
\begin{proposition}\label{scheme local Noe formal completion section kernel char}
Let $X$ be a locally Noetherian scheme. For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, the kernel of the canonical homomorphism $\Gamma(X,\mathscr{F})\to\Gamma(X',\mathscr{F}_{/X'})$ induced from $\mathscr{F}\to\mathscr{F}_{/X'}$ is formed by the sections which are zero on an open neighborhood of $X'$.
\end{proposition}
\begin{proof}
It follows from the definition of $\mathscr{F}_{/X'}$ that the canonical image of such a section is zero. Conversely, if the image of $s\in\Gamma(X,\mathscr{F})$ is zero in $\Gamma(X',\mathscr{F}_{/X'})$, it suffices to see that any $x\in X'$ admits an open neighborhood in $X$ over which $s$ is zero, and we can therefore assume that $X=\Spec(A)$ is affine, $A$ is Noetherian, $X'=V(\mathfrak{I})$ where $\mathfrak{I}$ is an ideal of $A$, and $\mathscr{F}=\widetilde{M}$, where $M$ is a finitely generated $A$-module. Then $\Gamma(X',\mathscr{F}_{/X'})$ is the Huasdorff completion $\widehat{M}$ of $M$ for the $\mathfrak{I}$-topology, and the homomorphism $\Gamma(X,\mathscr{F})\to\Gamma(X',\mathscr{F}_{/X'})$ is the canonical homomorphism $M\to\widehat{M}$. We have seen that the kernel of this homomorphism (\cref{Noe ring Krull intersection thm}) consists of elements $z\in M$ which is annihilated by an element of $1+\mathfrak{I}$. We then have $(1+f)s=0$ for $f\in\mathfrak{I}$, and for any $x\in X'$ we deduce that $(1_x+f_x)s_x=0$; as $1_x+f_x$ is invertible in $\mathscr{O}_{X,x}$ ($\mathfrak{I}_x\mathscr{O}_{X,x}$ is contained in $\m_x$), we then have $s_x=0$, which proves the assertion.
\end{proof}
\begin{corollary}\label{scheme local Noe formal completion homomorphism kernel char}
Let $X$ be a locally Noetherian scheme and $u:\mathscr{F}\to\mathscr{G}$ be a homomorphism of coherent $\mathscr{O}_X$-modules. For the homomorphism $u_{/X'}:\mathscr{F}_{/X'}\to\mathscr{G}_{/X'}$ to be zero, it is necessary and sufficient that $u$ is zero on an open neighborhood of $X'$.
\end{corollary}
\begin{proof}
In fact, by \cref{scheme local Noe formal completion exact}, $u_{/X'}$ is identified with $i^*(u)$, so if we consider $u$ as a section of $\mathscr{H}=\sHom_{\mathscr{O}_X}(\mathscr{F},\mathscr{G})$ over $X$, $u_{/X'}$ is the section of $i^*(\mathscr{H})=\mathscr{H}_{/X'}$ over $X'$. It then suffices to apply \cref{scheme local Noe formal completion section kernel char} on $\mathscr{H}$.
\end{proof}
\begin{corollary}\label{scheme local Noe formal completion homomorphism mono epi iff}
Let $X$ be a locally Noetherian sceme and $u:\mathscr{F}\to\mathscr{G}$ be a homomorphism of coherent $\mathscr{O}_X$-modules. For the homomorphism $u_{/X'}:\mathscr{F}_{/X'}\to\mathscr{G}_{/X'}$ to be a monomorphism (resp. epimorphism), it is necessary and sufficient that $u$ is a monomorphism (resp. epimorphism) on an open neighborhood of $X'$.
\end{corollary}
\begin{proof}
Let $\mathscr{P}$ and $\mathscr{N}$ be the kernel and cokernel of $u$, so that we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{P}\ar[r]&\mathscr{F}\ar[r,"u"]&\mathscr{G}\ar[r]&\mathscr{N}\ar[r]&0
\end{tikzcd}\]
By applying $(-)_{/X'}$, we then get an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{P}_{/X'}\ar[r]&\mathscr{F}_{/X'}\ar[r,"u_{/X'}"]&\mathscr{G}_{/X'}\ar[r]&\mathscr{N}_{/X'}\ar[r]&0
\end{tikzcd}\]
That $u_{/X'}$ is a monomorphism (resp. epimorphism) is equivalent to $\mathscr{P}_{/X'}=0$ (resp. $\mathscr{N}_{/X'}=0$), so we can apply \cref{scheme local Noe formal completion section kernel char} to get the conclusion.
\end{proof}
\begin{corollary}\label{scheme local Noe formal completion locally free iff}
Let $X$ be a locally Noetherian scheme and $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module. For $\mathscr{F}_{/X'}$ to be locally free (resp. locally free of rank $n$), it is necessary and sufficient that there exists an open neighborhood $U$ of $X'$ such that $\mathscr{F}|_X'$ is locally free (resp. locally free of rank $n$).
\end{corollary}
\begin{proof}
To say that $\mathscr{F}_{/X'}$ is locally free signifies that any point $x\in X'$ admits an open neighborhood $V$ in $X$ such that there exists an isomorphism $v:(\mathscr{O}_X^n)_{/X'}\stackrel{\sim}{\to}\mathscr{F}_{/X'}|_{V\cap X'}$. We can evidently assume that $V=X$, and then it follows from (\ref{scheme local Noe formal completion and tensor Hom-2}) that $v$ is of the form $u_{/Z}$, where $u$ is a homomorphism $\mathscr{O}_X^n\to\mathscr{F}$; moreover, by replacing $X$ with an open neigbourhood of $Z$, we can assume, in view of \cref{scheme local Noe formal completion homomorphism mono epi iff}, that $u$ is bijective, whence the corollary.
\end{proof}
We now consider the induced morphisms between formal completions. Let $X,Y$ be schemes, $f:X\to Y$ be a morphism, $X'$ (resp. $Y'$) be a closed subscheme of $X$ (resp. $Y$), and $i:X'\to X$, $j:Y'\to Y$ be the canonical injections. Suppose that the composition morphism $f\circ i$ dominates $j$, so that we have commutative diagram
\[\begin{tikzcd}
X\ar[r,"f"]&Y\\
X'\ar[r,"f'"]\ar[u,"i"]&Y'\ar[u,swap,"j"]
\end{tikzcd}\]
where $f'$ is the restriction of $f$ to $X'$. If $\mathscr{I}$ (resp. $\mathscr{K}$) is the quasi-coherent ideal defining $X'$ (resp. $Y'$), then this means $f^*(\mathscr{K})\mathscr{O}_X\sub\mathscr{I}$ (\cref{scheme inverse image of subscheme}). We then have, for each integer $n>0$, $f^*(\mathscr{K}^n)\mathscr{O}_X\sub\mathscr{I}^n$, so if we put $X'_n=(X',\mathscr{O}_X/\mathscr{I}^{n+1})$, $Y'_n=(Y',\mathscr{O}_Y/\mathscr{K}^{n+1})$, the morphism $f$ induces a morphism $f_n:X'_n\to Y'_n$, and it is immediate that the $f_n$ form a inductive system. The inductive limit of this system (\cref{scheme formal adic morphism limit correspondence}) is denote by $\hat{f}:X_{/X'}\to Y_{/Y'}$, and called the \textbf{completion of $\bm{f}$ along the subschemes $\bm{X}'$ and $\bm{Y}'$}. It is clear from definition that the following diagram is commutative
\begin{equation}\label{scheme morphism formal completion diagram}
\begin{tikzcd}
X_{X'}\ar[d,swap,"i_X"]\ar[r,"\hat{f}"]&Y_{/Y'}\ar[d,"i_Y"]\\
X\ar[r,"f"]&Y
\end{tikzcd}
\end{equation}
where the vertical morphism are canonical morphism.\par
If $X=\Spec(B)$ and $Y=\Spec(A)$ are affine schemes, then $\mathscr{I}=\widetilde{\mathfrak{I}}$, $\mathscr{K}=\widetilde{\mathfrak{K}}$, where $\mathfrak{I}$ (resp. $\mathfrak{K}$) is an ideal of $B$ (resp. $A$), and $f$ corresponds to a homomorphism $\varphi:A\to B$ such that $\varphi(\mathfrak{K})\sub\mathfrak{I}$. The morphism $\hat{f}$ then corresponds to the continuous homomorphism $\hat{\varphi}:\widehat{A}\to\widehat{B}$ (\cref{scheme affine formal morphism to affine correspond}), where $\widehat{A}$ (resp. $\widehat{B}$) is the $\mathfrak{K}$-adic completion of $A$ (resp. $\mathfrak{I}$-adic completion of $B$).\par
Let $Z$ be a third scheme, $g:Y\to Z$ is a morphism, $Z'$ is a closed subscheme of $Z$ defined by a quasi-coherent ideal $\mathscr{R}$ of $\mathscr{O}_Z$, and suppose that we have $g^*(\mathscr{R})\mathscr{O}_Y\sub\mathscr{K}$. Then, if $\hat{g}$ is the completion of $g$ along $Y'$ and $Z'$, then it follows from our definition that $\widehat{(g\circ f)}=\hat{g}\circ\hat{f}$.\par
Now suppose that $X$ and $Y$ are locally Noetherian schemes, $X',Y'$ are closed subsets of $X,Y$, respectively, and $f:X\to Y$ is a morphism such that $f(X')\sub Y'$. Then there exists a coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$ (resp. $\mathscr{K}$ of $\mathscr{O}_Y$) such that $\supp(\mathscr{O}_X/\mathscr{I})=X'$ (resp. $\supp(\mathscr{O}_Y/\mathscr{K})=Y'$) and that $f^*(\mathscr{K})\mathscr{O}_X\sub\mathscr{I}$: in fact, it suffices to choose $\mathscr{I}$ to be the ideal defining the reduced subscheme structure of $X'$ and $\mathscr{K}$ to be the ideal defining that of $Y'$. The relation $f^*(\mathscr{K})\mathscr{O}_X\sub\mathscr{I}$ then follows from \cref{scheme morphism closed subscheme inclusion iff ideal}. We can then define the morphism $\hat{f}:X_{/X'}\to Y_{/Y'}$, and it follows from \cref{scheme formal completion of local Noe independent of ideal} that $\hat{f}$ does not depend on the choice of the idelas $\mathscr{I}$ and $\mathscr{K}$.
\begin{proposition}\label{scheme local Noe formal completion morphism equal iff}
Let $X$ and $Y$ be locally Noetherian $S$-schemes and suppose that $Y$ is of finite type over $S$. Let $X',Y'$ be closed subsets of $X,Y$, respectively, and $f,g$ be two $S$-morphisms from $X$ to $Y$ such that $f(X')\sub Y'$, $g(X')\sub Y'$. For that $\hat{f}=\hat{g}$, it is necessary and sufficient that $f$ and $g$ coincides in an open neighborhood of $X'$.
\end{proposition}
\begin{proof}
This conditions is clearly sufficient (without the finiteness conditio on $Y$). To see that it is necessary, we first note that $\hat{f}=\hat{g}$ implies $f(x)=g(x)$ for any $x\in X'$. On the other hand, since the question is local, we can assume that $X=\Spec(B)$ and $Y=\Spec(A)$ are affine neighborhoods of $x$ and $y=f(x)=g(x)$, respectively, with Noetherian rings, and that $S=\Spec(R)$ is affine. Then $A$ is an $R$-algebra of finite type (\cref{scheme affine ft and fp iff ring}), and $f,g$ correspond to $R$-homomorphisms $\rho,\sigma$ from $A$ into $B$. By hypothesis, the induced homomorphisms $\hat{\rho},\hat{\sigma}$ on completions are equal. We then conclude from \cref{scheme local Noe formal completion section kernel char} that for any section $s\in A$, the sections $\rho(s)$ and $\sigma(s)$ coincides in an open neighborhood of $X'$ (dependent of $s$); as $A$ is a finite type algebra over $R$, we then deduce that there exists an open neighborhood $V$ of $X'$ such that $\rho(s)$ and $\sigma(s)$ coincides over $V$ for any section $s\in A$. If $h\in A$ is such that $D(h)$ is an open neighborhood of $X'$ contained in $V$, we then conclude so $f$ and $g$ coincides on $D(h)$.
\end{proof}
\begin{proposition}\label{scheme local Noe formal completion and pullback}
Let $X$ and $Y$ be locally Noetherian schemes, $f:X\to Y$ be a morphism, $X',Y'$ be closed subsets of $X,Y$, respectively, such that $f(X')\sub Y'$. Then, for any coherent $\mathscr{O}_Y$-module $\mathscr{G}$, there exists a canonical isomorphism of $(\mathscr{O}_{X})_{/X'}$-modules
\begin{align}\label{scheme local Noe formal completion and pullback-1}
(f^*(\mathscr{G}))_{/X'}\stackrel{\sim}{\to}\hat{f}^*(\mathscr{G}_{/Y'}).
\end{align}
\end{proposition}
\begin{proof}
If we identify canonically $(f^*(\mathscr{G}))_{/X'}$ with $i_X^*(f^*(\mathscr{G}))$ and $\hat{f}(\mathscr{G}_{/Y'})$ with $\hat{f}^*(i_Y^*(\mathscr{G}))$ (\cref{scheme local Noe formal completion exact}), the proposition then follows from the commutative diagram (\ref{scheme morphism formal completion diagram}).
\end{proof}
\begin{remark}\label{scheme local Noe formal completion functor on coh}
Retain the hypotheses of \cref{scheme local Noe formal completion and pullback}, and let $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module, $\mathscr{G}$ be a coherent $\mathscr{O}_Y$-module. If $u:\mathscr{G}\to\mathscr{F}$ is an $f$-morphism, then it correponds to a homomorphism $u^{\sharp}:f^*(\mathscr{G})\to\mathscr{F}$, hence by completion a continuous $(\mathscr{O}_X)_{/X'}$-homomorphism
\[(u^{\sharp})_{/X'}:(f^*(\mathscr{G}))_{/X'}\to\mathscr{F}_{/X'}.\]
In view of (\ref{scheme local Noe formal completion and pullback-1}), there exists a unique $\hat{f}$-morphism $v:\mathscr{G}_{/Y'}\to\mathscr{F}_{/X'}$ such that $v^{\sharp}=(u^{\sharp})_{/X'}$. If we consider the triple $(\mathscr{F},X,X')$ (where $\mathscr{F}$ is quasi-coherent $\mathscr{O}_X$-module and $X'$ is a closed subset of $X$) as a category $\mathcal{C}$, with morphisms $(\mathscr{F},X,X')\to(\mathscr{G},Y,Y')$ consisting of a morphism $f:X\to Y$ of schemes such that $f(X')\sub Y'$ and an $f$-morphism $u:\mathscr{G}\to\mathscr{F}$, we can then say that $(X_{/X'},\mathscr{F}_{/X'})$ is a functor from $\mathcal{C}$ to the category of couples $(\mathfrak{Z},\mathscr{H})$ formed by a locally Noetherian formal scheme $\mathfrak{Z}$ and an $\mathscr{O}_{\mathfrak{Z}}$-module $\mathscr{H}$, with morphisms given by morphisms $g$ of formal schemes and $g$-morphisms of sheaves.
\end{remark}
\begin{proposition}\label{scheme formal completion fiber product char}
Let $X$ and $Y$ be $S$-schemes, $S'$ be a closed subscheme of $S$ and $X',Y'$ be closed subschemes of $X,Y$, respectively, such that, if $\mathscr{I}$, $\mathscr{K}$, $\mathscr{L}$ are the nilideals of $S'$, $X'$, $Y'$, then $\varphi^*(\mathscr{I})\mathscr{O}_X\sub\mathscr{K}$ and $\psi^*(\mathscr{I})\mathscr{O}_Y\sub\mathscr{L}$ (where $\varphi:X\to S$ and $\psi:Y\to S$ are the structural morphisms). Let $Z=X\times_SY$ and $Z'=p^{-1}(X')\cap q^{-1}(Y')$, where $p,q$ are the canonical projections.
\begin{enumerate}
\item[(a)] Then the completion $Z_{/Z'}$ is identified with the product of the formal $S_{S'}$-schemes $(X_{/X'})\times_{S_{S'}}(Y_{/Y'})$, the structural morphisms with $\hat{\varphi},\hat{\psi}$, and the projections with $\hat{p},\hat{q}$.
\item[(b)] If $T$ is an $S$-scheme, $u:T\to X$, $v:T\to Y$ are $S$-morphisms, and $T'$ is a closed subscheme of $T$ such that, if $\mathscr{M}$ is the ideal defining $T'$, then $u^*(\mathscr{K})\mathscr{O}_T\sub\mathscr{M}$ and $v^*(\mathscr{L})\mathscr{O}_T\sub\mathscr{M}$. Then the completion of $(u,v)_S$ along $T'$ and $Z'$ is canonically identified with $(\hat{u},\hat{v})_{S_{S'}}$.
\end{enumerate}
\end{proposition}
\begin{proof}
It is immediate that the question is local for $S,X,Y$, so we can assume that $S=\Spec(A)$, $X=\Spec(B)$, $Y=\Spec(C)$, $S'=V(\mathfrak{I})$, $X'=V(\mathfrak{K})$, $Y'=V(\mathfrak{R})$, where $\mathfrak{I},\mathfrak{K},\mathfrak{R}$ are ideals such that $\rho(\mathfrak{I})\sub\mathfrak{K}$ and $\sigma(\mathfrak{I})\sub\mathfrak{R}$, where $\sigma:A\to B$ and $\sigma:A\to C$ are the corresponding homomorphisms, Then we see that $Z=\Spec(B\otimes_AC)$ and that $Z'=V(\mathfrak{L})$, where $\mathfrak{L}$ is the ideal generated by $\im(\mathfrak{K}\otimes_AC)+\im(B\otimes_A\mathfrak{R})$. The conclusion then follows from \cref{scheme formal affine product exist} and the fact that the complete tensor product $\widehat{B}\hat{\otimes}_{\widehat{A}}\widehat{C}$ is the completion of $B\otimes_AC$ for the $\mathfrak{L}$-adic topology.
\end{proof}
\begin{corollary}\label{scheme formal completion diagram morpism char}
With the hypotheses of \cref{scheme formal completion fiber product char}, for any $S$-morphism $f:X\to Y$ satisfying $f^*(\mathscr{L})\mathscr{O}_X\sub\mathscr{K}$, the graph diagram $\Gamma_{\hat{f}}$ is identified with the completion $\widehat{(\Gamma_f)}$ of the diagram morphism of $f$.
\end{corollary}
\begin{corollary}\label{scheme formal completion of inverse image cartesian diagram}
Let $X,Y$ be schemes, $f:X\to Y$ be a morphism, $Y'$ be a closed subscheme of $Y$, and $X'=f^{-1}(Y')$. Then following commutative diagram is cartesian:
\[\begin{tikzcd}
X_{/X'}\ar[d,swap,"i_X"]\ar[r,"\hat{f}"]&Y_{/Y'}\ar[d,"i_Y"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
\end{corollary}
\begin{proof}
It suffices to apply \cref{scheme formal completion fiber product char}(a), where we take $X'=X$ and $S=S'=Y$.
\end{proof}
\subsection{Coherent sheaves over formal schemes}
In this paragraph, we discuss coherent sheaves over locally Noetherian formal schemes, and characterize them as projective limits of coherent modules over (usual) schemes. For this, we shall first consider the affine case, so let $A$ be an adic ring and $\mathfrak{I}$ be a nilideal of $A$. Let $X=\Spec(A)$, $\X=\Spf(A)$, whose underlying space is identified with the closed subset $V(\mathfrak{I})$ of $\Spec(A)$. If $X'=\Spec(A/\mathfrak{I})$ is the closed subscheme of $X$ defined by $\widetilde{\mathfrak{I}}$, it then follows from definigion that $\X$ is identified with $X_{/X'}$. For any $A$-module $M$, the sheaf $M^{\Delta}=(\widetilde{M})_{/X'}$ is then an $\mathscr{O}_{\X}$-module. Moreover, if $u:M\to N$ is a homomorphism of $A$-modules, it then corresponds to a homomorphism $\tilde{u}:\widetilde{M}\to\widetilde{N}$, and hence to a continuous homomorphism $\tilde{u}_{/X'}:(\widetilde{M})_{/X'}\to(\widetilde{N})_{/X'}$, which we denote by $u^{\Delta}$. It is evident that $(v\circ u)^\Delta=v^\Delta\circ u^\Delta$, so we obtain an additive covariant functor $M\mapsto M^{\Delta}$ from the category of $A$-module to the category of $\mathscr{O}_{\X}$-modules.\par
As $A$ is an adic ring, the ideals $\mathfrak{I}^n$ are open in $A$, hence separated and complete. The ideal $(\mathfrak{I}^n)^\Delta$ of $\mathscr{O}_{\X}$, with the preceding definition, is then equal to the ideal defined in \cref{scheme formal affine associated sheaf of ideal}, and if we put $\mathscr{I}=\mathfrak{I}^\Delta$, then $(\mathfrak{I}^n)^\Delta=\mathscr{I}^n$ if $\mathfrak{I}/\mathfrak{I}^2$ is a finitely generated $A$-module (\cref{scheme formal affine adic ft ideal prop}). Under this hypothesis, let $A_n=A/\mathfrak{I}^{n+1}$ and $X_n=\Spec(A_n)=(\X,\mathscr{O}_{\X}/\mathscr{I}^{n+1})$. If $u_{nm}:X_m\to X_n$ is the canonical morphism induced by $A_n\to A_m$ for $m\leq n$, the formal scheme $\X$ is then the inductive limit of $X_n$ for the $u_{nm}$ (\cref{scheme projective system limit exist if}).
\begin{proposition}\label{scheme formal affine Noe associated sheaf global section}
Let $A$ be an adic Noetherian ring. Then the functor $M\mapsto M^\Delta$ is exact on the category of finitely generated $A$-modules, and we have a canonical isomorphism
\[\Gamma(\X,M^\Delta)=M.\]
\end{proposition}
\begin{proof}
The exactness of the functor $M\mapsto M^\Delta$ follows from that of $M\mapsto\widetilde{M}$ (\cref{scheme affine associated sheaf exact}) and $\mathscr{F}\to\mathscr{F}_{/X'}$ (\cref{scheme local Noe formal completion exact}). By definition, $\Gamma(\X,M^\Delta)$ is the $\mathfrak{I}$-adic completion of the $A$-module $\Gamma(X,\widetilde{M})=M$ ($\mathfrak{I}$ is a nilideal of $A$). But as $A$ is complete and $M$ is finitely generated, we see that $M$ is complete and separated (\cref{filtration Noe I-adic completion is tensor}), and this proves the proposition.
\end{proof}
\begin{proposition}\label{scheme formal affine Noe associated sheaf faithful}
Let $A$ be an adic Noetherian ring.
\begin{enumerate}
\item[(a)] If $M$ and $N$ are finitely generated $A$-modules, there exists a canonical isomorphism
\begin{gather}
(M\otimes_AN)^\Delta\stackrel{\sim}{\to} M^\Delta\otimes_{\mathscr{O}_{\X}}N^\Delta,\label{scheme formal affine Noe associated sheaf faithful-1}\\
(\Hom_A(M,N))^\Delta\stackrel{\sim}{\to}\sHom_{\mathscr{O}_{\X}}(M^\Delta,N^\Delta).\label{scheme formal affine Noe associated sheaf faithful-2}
\end{gather}
\item[(b)] The map $u\mapsto u^\Delta$ is a functorial isomorphism
\begin{align}\label{scheme formal affine Noe associated sheaf faithful-3}
\Hom_A(M,N)\stackrel{\sim}{\to}\Hom_{\mathscr{O}_{\X}}(M^\Delta,N^\Delta).
\end{align}
\end{enumerate}
\end{proposition}
\begin{proof}
The first two isomorphisms follow from \cref{scheme affine associated sheaf tensor and Hom}(a) and \cref{scheme local Noe formal completion and tensor Hom}. Now as $\Hom_A(M,N)$ is a finitely generated $A$-module, we can apply \cref{scheme formal affine Noe associated sheaf global section} to identify $\Gamma(\X,(\Hom_A(M,N))^\Delta)$ with $\Hom_A(M,N)$, and by (\ref{scheme formal affine Noe associated sheaf faithful-2}), we see that (\ref{scheme formal affine Noe associated sheaf faithful-3}) is an isomorphism.
\end{proof}
\begin{proposition}\label{scheme formal affine Noe structure sheaf coh}
If $A$ is an adic Noetherian ring, $\mathscr{O}_{\X}$ is a coherent sheaf of rings.
\end{proposition}
\begin{proof}
If $f\in A$, we see that $A_{\{f\}}$ is an adic Noetherian ring (\cref{adic ring given by I-adic completion}) and as the question is local (\cref{scheme formal standarad open is formal affine}), we are reduced to prove that the kernel of a homomorphism $v:\mathscr{O}_{\X}^n\to\mathscr{O}_{\X}$ is an $\mathscr{O}_{\X}$-module of finite type. We then have $v=u^\Delta$, where $u:A^n\to A$ is a homomorphism (\ref{scheme formal affine Noe associated sheaf faithful-2}). As $A$ is Noetherian, the kernel of $u$ is finitely generated, which means we have a homomorphism $w:A^m\to A^n$ such that the following sequence is exact:
\[\begin{tikzcd}
A^m\ar[r,"w"]&A^n\ar[r,"u"]&A
\end{tikzcd}\]
We then conclude from \cref{scheme formal affine Noe associated sheaf global section} that the sequence
\[\begin{tikzcd}
\mathscr{O}_{\X}^m\ar[r,"w^\Delta"]&\mathscr{O}_{\X}^n\ar[r,"v"]&\mathscr{O}_{\X}
\end{tikzcd}\]
is exact, which means the kernel of $v$ is of finite type.
\end{proof}
With the preceding notations, let $A_n=A/\mathfrak{I}^{n+1}$ and $X_n$ be the affine scheme $\Spec(A_n)=(\X,\mathscr{O}_{\X}/\mathfrak{I}^{n+1})$, where $\mathscr{I}=\mathfrak{I}^\Delta$ is the nilideal of $\mathscr{O}_{\X}$ corresponding to $\mathfrak{I}$. Let $u_{nm}:X_m\to X_n$ be the morphism induced by the ring homomorphism $A_n\to A_m$ for $m\leq n$. As we have remarked, $\X$ is then the inductive limit of the $X_n$ (\cref{scheme projective system limit exist if}).
\begin{proposition}\label{scheme formal affine Noe coh iff associated of finite module}
Suppose that $A$ is an adic Noetherian ring and let $\mathscr{F}$ be an $\mathscr{O}_{\X}$-module. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{F}$ is a coherent $\mathscr{O}_{\X}$-module;
\item[(\rmnum{2})] there exists a finitely generated $A$-module $M$ (uniquely determined up to isomorphism) such that $\mathscr{F}$ is isomorphic to $M^\Delta$.
\item[(\rmnum{3})] $\mathscr{F}$ is isomorphic to the projective limit of a sequence $(\mathscr{F}_n)$ of coherent $\mathscr{O}_{X_n}$-modules such that $u_{nm}^*(\mathscr{F}_n)=\mathscr{F}_m$ for $m\leq n$, and the projective system $(\mathscr{F}_n)$ is then isomorphic to the system $(\mathscr{F}\otimes_{\mathscr{O}_{\X}}\mathscr{O}_{X_n})$
\end{enumerate}
\end{proposition}
\begin{proof}
By definition, we have $\mathscr{O}_{\X}=A^\Delta$. If condition (\rmnum{2}) is satisfied, then $M$ is the cokernel of a homomorphism $A^m\to A^n$, so it follows from \cref{scheme formal affine Noe associated sheaf global section} that $M^\Delta$ is the cokernel of a homomorphism $\mathscr{O}_{\X}^m\to\mathscr{O}_{\X}^n$. As the sheaf $\mathscr{O}_{\X}$ is coherent (\cref{scheme formal affine Noe structure sheaf coh}), so is $M^\Delta$ (\cref{sheaf of module abelian cat exactness char}) and this proves (\rmnum{2})$\Rightarrow$(\rmnum{1}).\par
Now assume the conditions in (\rmnum{3}). Then since each $X_n$ is an affine (usual) scheme, we have $\mathscr{F}_n=\widetilde{M}_n$, where $M_n$ is a finitely generated $A_n$-module. Since $u_{mn}^*(\mathscr{F}_n)=\mathscr{F}_m$ for $m\leq n$, we have $M_m=M_n\otimes_{A_n}A_m$ (\cref{scheme affine associated sheaf inverse image char}). The modules $M_n$ then form a projective system for the canonical bi-homomorphisms $M_n\to M_m$, and it follows from the definition of $A_n$ that this projective system satisfies the conditions of \cref{ring inverse limit complete and finiteness prop}, so its projective limit $M$ is a finitely generated $A$-module such that $M_n=M\otimes_AA_n$ for each $n$. We then deduce that $\mathscr{F}_n$ is induced over $X_n$ by $\widetilde{M}\otimes_{\mathscr{O}_{\X}}(\mathscr{O}_{\X}/\mathscr{I}^{n+1})$, so $\mathscr{F}=M^\Delta$ by definition. Conversely, if $\mathscr{F}=M^\Delta$ for a finitely generated $A$-module $M$, then by definition, $\mathscr{F}$ is the projective limit of the system $\widetilde{M}_n\otimes_{\mathscr{O}_{\X}}(\mathscr{O}_{\X}/\mathscr{I}^{n+1})$, and we have $u_{nm}^*(\mathscr{F}_n)=\mathscr{F}_m$ for $m\leq n$.\par
Finally, assume that $\mathscr{F}$ is a coherent $\mathscr{O}_{\X}$-module. Considered as an $\mathscr{O}_{\X}$-module, we have $\mathscr{O}_{X_n}=\mathscr{O}_{\X}/\mathscr{I}^{n+1}=\widetilde{A}_n$, so $\mathscr{F}_n=\mathscr{F}\otimes_{\mathscr{O}_{\X}}\mathscr{O}_{X_n}$ is a coherent $\mathscr{O}_{\X}$-module (\cref{sheaf of module coh tensor and Hom}), and since it is also a $\mathscr{O}_{X_n}$-module and $\mathscr{I}^{n+1}$ is coherent ($\mathfrak{I}$ is finitely generated), we conclude that $\mathscr{F}_n$ is a coherent $\mathscr{O}_{X_n}$-module (\cref{sheaf of module O/I coh iff}), and it is immediate that $u_{mn}^*(\mathscr{F}_n)=\mathscr{F}_m$ for $m\leq n$. If $\mathscr{G}=\llim\mathscr{F}_n$ is the projective limit, then it is a coherent $\mathscr{O}_{\X}$-module in view of the equivalence of (\rmnum{2}) and (\rmnum{3}), and it remains to prove that $\mathscr{F}$ is isomorphic to $\mathscr{G}$. Now the canonical homomorphisms $\mathscr{F}\to\mathscr{F}_n$ form a projective system, hence induces a canonical homomorphism $w:\mathscr{F}\to\mathscr{G}$, so it suffices to prove that $w$ is an isomorphism. Since this question is local, we can assume that $\mathscr{F}$ is the cokernel of a homomorphism $\mathscr{O}_{\X}^m\to\mathscr{O}_{\X}^n$, which is of the form $v^\Delta$, where $v$ is a homomorphism $v:A^m\to A^n$ of $A$-modules (\cref{scheme formal affine Noe associated sheaf faithful}), and $\mathscr{F}$ is then isomorphic to $M^\Delta$, where $M=\coker v$. In view of \cref{scheme formal affine Noe associated sheaf faithful}, we then have
\[\mathscr{F}_n=M^\Delta\otimes_{\mathscr{O}_{\X}}A_n^\Delta=(M\otimes_{A}A_n)^\Delta=(M\otimes_{A}A_n)^\Delta=\widetilde{M\otimes_AA_n}.\]
since the $\mathfrak{I}$-adic topology on $M\otimes_AA_n$ is discrete. This then implies $M^\Delta=\llim\mathscr{F}_n=\mathscr{G}$, so $w$ is an isomorphism.
\end{proof}
\begin{theorem}\label{scheme formal affine Noe associated sheaf equivalence}
Let $A$ be an adic Noetherian ring. Then the functor $M\mapsto M^\Delta$ is an equivalence from the category of finitely generated $A$-modules to the category of coherent $\mathscr{O}_{\X}$-module.
\end{theorem}
\begin{proof}
This follows from \cref{scheme formal affine Noe associated sheaf global section}, \cref{scheme formal affine Noe associated sheaf faithful} and \cref{scheme formal affine Noe coh iff associated of finite module}.
\end{proof}
Now let $A,B$ be two adic Noetherian rings and $\varphi:B\to A$ be a continuous homomorphism. We denote by $\mathfrak{I}$ (resp. $\mathfrak{K}$) the nilideal of $A$ (resp. $B$), so that $\varphi(\mathfrak{K})\sub\mathfrak{I}$, and we put $X=\Spec(A)$, $Y=\Spec(B)$, $\X=\Spf(A)$, $Y=\Spf(B)$. Let $f:X\to Y$ be the corresponding morphism and $\hat{f}:\X\to\Y$ be the completion of $f$, which is also the morphism of formal schemes corresponding to $\varphi$. We then have a commutative diagram
\begin{equation}\label{scheme formal affine Noe associated sheaf inverse image char-1}
\begin{tikzcd}
\X\ar[r,"\hat{f}"]\ar[d,swap,"i_X"]&\Y\ar[d,"i_Y"]\\
X\ar[r,"f"]&Y
\end{tikzcd}
\end{equation}
\begin{proposition}\label{scheme formal affine Noe associated sheaf inverse image char}
For any finitely generated $B$-module $N$, there exists a canonical homomorphism
\[\hat{f}^*(N^\Delta)\stackrel{\sim}{\to}(N\otimes_BA)^\Delta.\]
\end{proposition}
\begin{proof}
By \cref{scheme local Noe formal completion exact}, we have a canonical isomorphism $N^\Delta=i_Y^*(\widetilde{N})$, so by \cref{scheme affine associated sheaf inverse image char}
\[(N\otimes_BA)^\Delta=i_X^*(\widetilde{N\otimes_BA})=i_X^*(f^*(\widetilde{N})).\]
The proposition then follows from the commutative diagram \cref{scheme formal affine Noe associated sheaf inverse image char-1}.
\end{proof}
\begin{corollary}\label{scheme formal affine Noe associated sheaf of ideal inverse image}
For any ideal $\b$ of $B$, we have
\[\hat{f}^*(\b^\Delta)\mathscr{O}_{\X}=(\b A)^\Delta.\]
\end{corollary}
\begin{proof}
Let $j:\b\to B$ be the canonical injection, which corresponds to the canonical injection $j^\Delta:b^\Delta\to\mathscr{O}_{\Y}$. By definition, $\hat{f}^*(\b^\Delta)\mathscr{O}_{\X}$ is the image of the homomorphism $f^*(\j^\Delta):\hat{f}^*(\b^\Delta)\to\mathscr{O}_{\X}=\hat{f}^*(\mathscr{O}_{\Y})$. But this homomorphism is identified with $(j\otimes 1)^\Delta:(\b\otimes_BA)^\Delta\to\mathscr{O}_{\X}=(B\otimes_BA)^\Delta$ in view of \cref{scheme formal affine Noe associated sheaf inverse image char}. Since the image of $j\otimes 1$ is the ideal $\b A$ of $A$, the image of $(j\otimes 1)^\Delta$ is equal to $(\b A)^\Delta$, whence the corollary.
\end{proof}
\begin{proposition}\label{scheme formal Noe structure sheaf coh}
If $\X$ is a locally Noetherian formal scheme, the sheaf of rings $\mathscr{O}_{\X}$ is coherent and any nilideal of $\X$ is coherent.
\end{proposition}
\begin{proof}
In fact, this question is local, so we can assume that $\X$ is affine, and the proposition then follows from \cref{scheme formal affine Noe structure sheaf coh} and \cref{scheme formal affine Noe coh iff associated of finite module}.
\end{proof}
Let $\X$ be a locally Noetherian formal scheme, $\mathscr{I}$ be a nilideal of $\X$, and $X_n$ be the (usual) scheme $(\X,\mathscr{O}_{\X}/\mathscr{I}^{n+1})$, so that $\X$ is the inductive limit of $(X_n)$ for the morphisms $u_{mn}:X_m\to X_n$ (\cref{scheme projective system limit exist if}). With these notations, we have the following theorem:
\begin{theorem}\label{scheme formal Noe coh iff projective limit}
For an $\mathscr{O}_{\X}$-module $\mathscr{F}$ to be coherent, it is necessary and sufficient that it is isomorphic to the projective limit of a sequence $(\mathscr{F}_n)$ of coherent $\mathscr{O}_{X_n}$-modules such that $u_{nm}^*(\mathscr{F}_n)=\mathscr{F}_m$ for $m\leq n$. In this case, the projective system $(\mathscr{F}_n)$ is then isomorphic to the system $u_n^*(\mathscr{F})=\mathscr{F}\otimes_{\mathscr{O}_{\X}}\mathscr{O}_{X_n}$, where $u_n:X_n\to\X$ is the canonical morphism.
\end{theorem}
\begin{proof}
This question is local, so we can assume that $\X$ is an affine formal scheme, and the theorem then follows from \cref{scheme formal affine Noe coh iff associated of finite module}.
\end{proof}
In view of \cref{scheme formal Noe coh iff projective limit}, we can then say that giving a coherent $\mathscr{O}_{\X}$-module is equivalent to giving a projective system $(\mathscr{F}_n)$ of coherent $\mathscr{O}_{X_n}$-modules such that $u_{mn}^*(\mathscr{F}_n)=\mathscr{F}_m$ for $m\leq n$.
\begin{corollary}\label{scheme formal Noe Hom set isomorphic to inverse limit}
Under the hypotheses of \cref{scheme formal Noe coh iff projective limit}, if $\mathscr{F}$ and $\mathscr{G}$ are coherent $\mathscr{O}_{\X}$-modules, we have a canonical isomorphism
\begin{align}\label{scheme formal Noe Hom set isomorphic to inverse limit-1}
\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})\stackrel{\sim}{\to}\llim\Hom_{\mathscr{O}_{X_n}}(\mathscr{F}_n,\mathscr{G}_n).
\end{align}
\end{corollary}
\begin{proof}
The transition homomorphism $\Hom_{\mathscr{O}_{X_n}}(\mathscr{F}_n,\mathscr{G}_n)\to\Hom_{\mathscr{O}_{X_m}}(\mathscr{F}_m,\mathscr{G}_m)$ is given by $\theta_n\mapsto u_{mn}^*(\theta_n)$ ($m\leq n$), and the homomorphism \cref{scheme formal Noe Hom set isomorphic to inverse limit-1} sends an element $\theta\in\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})$ to the sequence $(u_n^*(\theta))$. In view of \cref{scheme formal Noe coh iff projective limit}, we see that the inverse homomorphism is given by sending a projective system $(\theta_n)\in\llim\Hom_{\mathscr{O}_{X_n}}(\mathscr{F}_n,\mathscr{G}_n)$ to its projective limit.
\end{proof}
\begin{corollary}\label{scheme formal Noe homomorphism of coh surjective iff}
Under the hypotheses of \cref{scheme formal Noe coh iff projective limit}, for a homomorphism $\theta:\mathscr{F}\to\mathscr{G}$ to be surjective, it is necessary and sufficient that the corresponding homomorphism $\theta_0=u_0^*(\theta):\mathscr{F}_0\to\mathscr{G}_0$ is surjective.
\end{corollary}
\begin{proof}
The question is local, so we can assume that $\X=\Spf(A)$, where $A$ is an adic Noetherian ring, $\mathscr{F}=M^\Delta$, $\mathscr{G}=N^\Delta$, and $\theta=u^\Delta$, where $M,N$ are finitely generated $A$-modules and $u:M\to N$ is a homomorphism. We then have $\theta_0=\tilde{u}_0$, where $u_0$ is the induced homomorphism
\[u\otimes 1:M\otimes_AA/\mathfrak{I}\to N\otimes_AA/\mathfrak{I}.\]
The conclusion then follows if we can prove that $u$ is surjective if and only if $u_0$ is surjective. To this end, recall that $\mathfrak{I}$ is contained in the Jacobson radical of $A$ (\cref{filtration complete Hausdorff ring invertibility}(b)), so the assertion follows from Nakayama's lemma.
\end{proof}
\begin{remark}\label{scheme formal Noe coh homomorphism is continuous}
In view of \cref{scheme formal Noe coh iff projective limit}, we see that any coherent $\mathscr{O}_{\X}$-module $\mathscr{F}$ is canonically endowed with a structure of topological $\mathscr{O}_{\X}$-module, which is the projective limit of the sheaf of discrete groups $\mathscr{F}_n$. It then follows from \cref{scheme formal Noe Hom set isomorphic to inverse limit} that any homomorphism $u:\mathscr{F}\to\mathscr{G}$ of coherent $\mathscr{O}_{\X}$-modules is automatically continuous. Moreover, if $\mathscr{H}$ is a coherent sub-$\mathscr{O}_{\X}$-module of a coherent $\mathscr{O}_{\X}$-module $\mathscr{F}$, then for any open subset $U\sub\X$, $\Gamma(U,\mathscr{H})$ is the kernel of the (continuous) homomorphism $\Gamma(U,\mathscr{F})\to\Gamma(U,\mathscr{F}/\mathscr{H})$ (because the functor $\Gamma$ is left exact). Since $\Gamma(U,\mathscr{F}/\mathscr{H})$ is a separated topological group, we conclude that $\Gamma(U,\mathscr{H})$ is a \textit{closed} subgroup of $\Gamma(U,\mathscr{F})$.
\end{remark}
\begin{proposition}\label{scheme formal Noe coh Hom and tensor isomorphism}
Let $X$ be a locally Noetherian formal scheme, $\mathscr{F}$ and $\mathscr{G}$ be coherent $\mathscr{O}_{\X}$-modules. Then there are canonical isomorphism of topological $\mathscr{O}_{\X}$-modules
\begin{gather}
\mathscr{F}\otimes_{\mathscr{O}_{\X}}\mathscr{G}\stackrel{\sim}{\to}\llim(\mathscr{F}_n\otimes_{\mathscr{O}_{X_n}}\mathscr{G}_n),\label{scheme formal Noe coh Hom and tensor isomorphism-1}\\
\sHom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})\stackrel{\sim}{\to}\sHom_{\mathscr{O}_{X_n}}(\mathscr{F}_n,\mathscr{G}_n).\label{scheme formal Noe coh Hom and tensor isomorphism-2}
\end{gather}
\end{proposition} 
As $\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})$ is the global section of the topological $\mathscr{O}_{\X}$-module $\sHom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})$, it is endowed with a canonical topology. If $\X$ is Noetherian, then it follows from \cref{scheme formal Noe coh Hom and tensor isomorphism-2} that a fundamental system of neighborhoods of $0$ is given by the subgroups $\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{I}^n\mathscr{G})$ (cf. \cite{EGA1}, $0_{\text{\Rmnum{0}}}$, 7.8.2).
\begin{proposition}\label{scheme formal Noe coh Hom surj and inj open}
Let $\X$ be a Noetherian formal scheme and $\mathscr{F},\mathscr{G}$ be coherent $\mathscr{O}_{\X}$-modules. Then in the topological group $\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})$, the set of surjective (resp. injective) homomorphisms is open.
\end{proposition}
\begin{proof}
In view of \cref{scheme formal Noe homomorphism of coh surjective iff}, the set of surjective homomorphisms in $\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})$ is the inverse image of the set of surjective homomorphisms in $\Hom_{\mathscr{O}_{X_0}}(\mathscr{F}_0,\mathscr{G}_0)$ under the continuous map $\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})\to\Hom_{\mathscr{O}_{X_0}}(\mathscr{F}_0,\mathscr{G}_0)$. For the second assertion, we may cover $\X$ by finitely many open Noetherian affine formal schemes $U_i$. For an element $\theta\in\Hom_{\mathscr{O}_{\X}}(\mathscr{F},\mathscr{G})$, it is necessary and sufficient that its restriction in $\Hom_{\mathscr{O}_{\X}|_{U_i}}(\mathscr{F}|_{U_i},\mathscr{G}|_{U_i})$ is injective for each $i$. Since there are only finitely many $U_i$, we can then reduce to the affine case, and the assertion follows from (\cite{EGA1}, $0_{\text{\Rmnum{1}}}$, 7.8.3).
\end{proof}
\chapter{Global properties of morphisms of schemes}
\section{Affine morphisms}
\subsection{Schemes affine over a scheme}
Let $S$ be a scheme and $X$ be an $S$-scheme. If $f:X\to S$ is the structural morphism, then the direct image $f_*(\mathscr{O}_X)$ is an $\mathscr{O}_S$-algebra, which we denote by $\mathscr{A}(X)$ if there is no confusion. If $U$ is an open subset of $S$, we have
\[\mathscr{A}(f^{-1}(U))=\mathscr{A}(X)|_U.\]
Similarly, for any $\mathscr{O}_X$-module $\mathscr{F}$ (resp. any $\mathscr{O}_X$-algebra $\mathscr{B}$), we denote by $\mathscr{A}(\mathscr{F})$ (resp. $\mathscr{A}(\mathscr{B})$) the direct image $f_*(\mathscr{F})$ (resp. $f_*(\mathscr{B})$) which is an $\mathscr{A}(X)$-module (resp. $\mathscr{A}(X)$-algebra), and also an $\mathscr{O}_S$-module (resp. $\mathscr{O}_S$-algebra).\par
Let $Y$ be another $S$-scheme with $g:Y\to S$ the structural morphism, and $h:X\to Y$ be an $S$-morphism. We then have a commutative diagram
\[\begin{tikzcd}
X\ar[rd,swap,"f"]\ar[rr,"h"]&&Y\ar[ld,"g"]\\
&S&
\end{tikzcd}\]
By definition we have a homomorphism $h^{\#}:\mathscr{O}_Y\to h_*(\mathscr{O}_X)$ of sheaves of rings, and we deduce from this a homomorphism of $\mathscr{O}_S$-algebras $g_*(h^{\#}):g_*(\mathscr{O}_Y)\to g_*(h_*(\mathscr{O}_X))=f_*(\mathscr{O}_X)$, which means, a homomorphism $\mathscr{A}(Y)\to\mathscr{A}(X)$ of $\mathscr{O}_S$-algebras, and we denote it by $\mathscr{A}(h)$. If $h':Y\to Z$ is another $S$-morphism, it is immediate that $\mathscr{A}(h'\circ h)=\mathscr{A}(h)\circ\mathscr{A}(h')$. Therefore we have defined a contravariant functor $\mathscr{A}(X)$ from the category of $S$-schemes to the category of $\mathscr{O}_S$-algebras.\par
Now let $\mathscr{F}$ be an $\mathscr{O}_X$-module, $\mathscr{G}$ be an $\mathscr{O}_Y$-module, and $u:\mathscr{G}\to\mathscr{F}$ be an $h$-morphism, wihch is a homomorphism $\mathscr{G}\to h_*(\mathscr{F})$ of $\mathscr{O}_Y$-modules. Then $g_*(u):g_*(\mathscr{G})\to g_*(h_*(\mathscr{F}))=f_*(\mathscr{F})$ is a homomorphism $\mathscr{A}(\mathscr{G})\to\mathscr{A}(\mathscr{F})$ of $\mathscr{O}_S$-modules, which we denote by $\mathscr{A}(u)$. The couple $(\mathscr{A}(h),\mathscr{A}(u))$ is then a bi-homomorphism of $\mathscr{A}(Y)$-modules $\mathscr{A}(\mathscr{G})$ ot the $\mathscr{A}(X)$-module $\mathscr{A}(\mathscr{F})$. If we fix $S$ and consider the couples $(X,\mathscr{F})$, where $X$ is an $S$-scheme and $\mathscr{F}$ is an $\mathscr{O}_X$-module, we then see that $(\mathscr{A}(X),\mathscr{A}(\mathscr{F}))$ defines a contravariant functor from the category of these couples to the category of couples of $\mathscr{O}_S$-algebras and modules of this algebra.\par
Consider now an $S$-scheme $X$ and let $f:X\to S$ be a structural morphism. We say that $X$ is \textbf{affine over $\bm{S}$} if there exists a covering $(S_\alpha)$ of $S$ by affine opens such that, for each $\alpha$, the open subscheme $f^{-1}(S_\alpha)$ of $X$ is affine. If this is true, we also say that $X$ is an \textbf{affine $\bm{S}$-scheme}, or the structural morphism $f$ is affine.
\begin{example}\label{scheme closed subscheme is S-affine}
Any closed subscheme of $S$ is an affine $S$-scheme. In fact, if $Y$ is a closed subscheme of $S$, then for any affine open $U$ of $S$, the intersection $U\cap Y$ is a closed subscheme of $U$, whence affine. 
\end{example}
\begin{remark}
One should note that an affine $S$-scheme $X$ is not necessary an affine scheme (for example $S$ is affine over $S$, but note that this is true if $S$ itself is affine). On the other hand, if $X$ is an $S$-scheme and is affine, it is not necessarily true that $X$ is an affine $S$-scheme (we will see this later). However, if $S$ is a separated scheme, then any affine scheme is affine over $S$ by \cref{scheme morphism separated preimage of affine open in affine open}.
\end{remark}
\begin{proposition}\label{scheme S-affine is separated}
Any affine $S$-scheme is separated over $S$.
\end{proposition}
\begin{proof}
Recall that separatedness is local on target (\cref{scheme morphism separated local on target}), and if $f^{-1}(S_\alpha)$ is affine, then the restriction of $f$ to $f^{-1}(S_\alpha)$ is a morphism between affine schemes, so is separated.
\end{proof}
\begin{proposition}\label{scheme S-affine preimage of open is affine}
Let $X$ be an affine $S$-scheme and $f:X\to S$ be the structural morphism. Then for any open subset $U\sub S$, $f^{-1}(U)$ is affine over $U$. In particular, if $U$ is affine, so is $f^{-1}(U)$.
\end{proposition}
\begin{proof}
In view of the definition, we can reduce to the case $S=\Spec(A)$ and $X=\Spec(B)$, so that $f$ corresponds to a homomorphism $\rho:A\to B$. As the standard opens $D(g)$ with $g\in A$ form a basis for $S$, we only need to prove the assertion for $U=D(g)$. But recall that $f^{-1}(D(g))=D(\rho(g))$, so our assertion follows.
\end{proof}
\begin{corollary}\label{scheme affine over affine iff affine}
Let $S$ be an affine scheme. Then for an $S$-scheme $X$ to be affine over $S$, it is necessary and sufficient that $X$ is an affine scheme.
\end{corollary}
\begin{proposition}\label{scheme S-affine direct image of qcoh is qcoh}
Let $X$ be an affine $S$-scheme and $f:X\to S$ be the structural morphism. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $f_*(\mathscr{F})$ is a quasi-coherent $\mathscr{O}_S$-module. In particular, the $\mathscr{O}_S$-algebra $\mathscr{A}(X)$ is quasi-coherent.
\end{proposition}
\begin{proof}
The morphism $f$ is separted by \cref{scheme S-affine is separated} and quasi-compact by \cref{scheme S-affine preimage of open is affine} (since any quasi-compact open subset is a finite union of affine opens), so we can apply \cref{scheme morphism qcqs qcoh direct image}.
\end{proof}
\begin{proposition}\label{scheme S-affine functor A fully faithful}
Let $X$ ba an affine $S$-scheme. For any $S$-scheme $Y$, the map $h\mapsto\mathscr{A}(h)$ from $\Hom_S(Y,X)$ to $\Hom_{\mathscr{O}_S\text{-}\mathbf{alg}}(\mathscr{A}(X),\mathscr{A}(Y))$ is bijective.
\end{proposition}
\begin{proof}
Let $f:X\to S$, $g:Y\to S$ be the structural morphisms. Suppose first that $S=\Spec(A)$ and $X=\Spec(B)$ are affine; we must shows that for any homomorphism $\omega:f_*(\mathscr{O}_X)\to g_*(\mathscr{O}_Y)$ of $\mathscr{O}_S$-algebras, there exists a unique $S$-morphism $h:Y\to X$ such that $\mathscr{A}(h)=\omega$. By definition, for any open subset $U\sub S$, $\omega$ defines a homomorphism $\omega_U:\Gamma(f^{-1}(U),\mathscr{O}_X)\to\Gamma(g^{-1}(U),\mathscr{O}_Y)$ of $\Gamma(U,\mathscr{O}_S)$-algebras. In particular, for $U=S$, this gives a homomorphism $\varphi:\Gamma(X,\mathscr{O}_X)\to\Gamma(Y,\mathscr{O}_Y)$, which by \cref{scheme morphism to affine correspond}, since $X$ is affine, corresponds to a morphism $h:Y\to X$. To see that $\mathscr{A}(h)=\omega$, we need to prove that for any open subset $U\sub S$, $\omega_U$ coincides with the algebra homomorphism $\varphi_U$, which corresponds to the $S$-morphism $h|_{g^{-1}(U)}:g^{-1}(U)\to f^{-1}(U)$. We may assume that $U=D(\lambda)$ where $\lambda\in A$; then, if $f:X\to S$ corresponds to the ring homomorphism $\rho:A\to B$, we have $f^{-1}(U)=D(\mu)$ where $\mu=\rho(\lambda)$, and $\Gamma(f^{-1}(U),\mathscr{O}_X)$ is the fraction ring $B_\mu$. Now the following diagram commutes
\[\begin{tikzcd}
B=\Gamma(X,\mathscr{O}_X)\ar[r,"\varphi"]\ar[d]&\Gamma(Y,\mathscr{O}_Y)\ar[d]\\
B_\mu=\Gamma(f^{-1}(U),\mathscr{O}_X)\ar[r,bend left=20pt,"\varphi_U"]\ar[r,bend right=20pt,"\omega_U"]&\Gamma(g^{-1}(U),\mathscr{O}_Y)
\end{tikzcd}\]
By the universal property of localization, we then conclude that $\varphi_U=\omega_U$, whence the assertion in this case.\par
In the general case, let $(S_\alpha)$ be a covering of $S$ by affine opens such that $f^{-1}(S_\alpha)$ are affine. Then any homomorphism $\omega:\mathscr{A}(X)\to\mathscr{A}(Y)$ of $\mathscr{O}_S$-algebras restricts to a family of homomorphisms
\[\omega_\alpha:\mathscr{A}(f^{-1}(S_\alpha))\to\mathscr{A}(g^{-1}(S_\alpha))\]
of $\mathscr{O}_{S_\alpha}$-algebras, so there is a family of $S_\alpha$-morphisms $h_\alpha:g^{-1}(S_\alpha)\to f^{-1}(S_\alpha)$ such that $\mathscr{A}(h_\alpha)=\omega_\alpha$. It all boils down to seeing that for any affine open $U$ of the base $S_\alpha\cap S_\beta$, the restriction of $h_\alpha$ and $h_\beta$ to $g^{-1}(U)$ coincide, which is immediate since these restrictions both correspond to the restriction homomorphism $\mathscr{A}(X)|_U\to\mathscr{A}(Y)|_U$ of $\omega$. 
\end{proof}
\begin{corollary}\label{scheme S-affine isomorphism iff algebra iso}
Let $X$ and $Y$ be affine $S$-schemes. For an $S$-morphism $h:Y\to X$ to be an isomorphism, it is necessary and sufficient that $\mathscr{A}(h):\mathscr{A}(X)\to\mathscr{A}(Y)$ is an isomorphism.
\end{corollary}
\begin{proof}
This follows from \cref{scheme S-affine functor A fully faithful} and the functoriality of $\mathscr{A}(X)$.
\end{proof}
\subsection{Affine \texorpdfstring{$S$}{S}-scheme associated with an \texorpdfstring{$\mathscr{O}_S$}{S}-algebra}
\begin{proposition}\label{scheme S-affine Spec functor dense}
Let $S$ be a scheme. For any quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{B}$, there exists an affine $S$-scheme $X$, defined up to $S$-isomorphisms, such that $\mathscr{A}(X)=\mathscr{B}$. The affine $S$-scheme $X$ is said to be \textbf{associated with the $\mathscr{O}_S$-algebra $\mathscr{B}$}, and denoted by $\Spec(\mathscr{B})$.
\end{proposition}
\begin{proof}
The uniqueness follows from \cref{scheme S-affine isomorphism iff algebra iso}, so we only need to construct the affine $S$-scheme $X$. For any affine open $U\sub S$, let $X_U$ be the scheme $\Spec(\Gamma(U,\mathscr{B}))$; as $\Gamma(U,\mathscr{B})$ is an $\Gamma(U,\mathscr{O}_S)$-algebra, $X_U$ is an $S$-scheme, and is affine over $U$ since $U$ and $X_U$ are both affine. Moreover, as $\mathscr{B}$ is quasi-coherent, the $\mathscr{O}_S$-algebra $\mathscr{A}(X_U)$ is canonically idnetified with $\mathscr{B}|_U$ (\cref{scheme affine associated sheaf direct image char}). Let $V$ be another affine open of $S$, and $X_{U,V}$ be the open subscheme of $X_U$ over $\varphi_U^{-1}(U\cap V)$, where $\varphi_U:X_U\to S$ is the structural morphism. Then $X_{U,V}$ and $X_{V,U}$ are affine over $U\cap V$ (\cref{scheme S-affine preimage of open is affine}), and by definition $\mathscr{A}(X_{U,V})$ and $\mathscr{A}(X_{V,U})$ are canonically identified with $\mathscr{B}|_{U\cap V}$. There then exists (\cref{scheme S-affine isomorphism iff algebra iso}) a canonical $S$-isomorphism $\theta_{U,V}:X_{V,U}\to X_{U,V}$; furthermore, if $W$ is a third affine open of $S$, and if $\theta'_{U,V},\theta'_{V,W},\theta'_{U,W}$ are the restrictions of $\theta_{U,V},\theta_{V,W},\theta_{U,W}$ over the inverse images of $U\cap V\cap W$ in $X_V,X_W,X_W$, then $\theta'_{U,V}\circ\theta'_{V,W}=\theta'_{U,W}$. By glueing the $X_{U,V}$, there then exists a scheme $X$ and an affine open cover $(T_U)$ of $X$ such that for each $U$ there is an isomorphism $\varphi_U:X_U\to T_U$ such that $\varphi_U$ maps $\varphi_U^{-1}(U\cap V)$ to $T_U\cap T_V$ and we have $\theta_{U,V}=\varphi_U^{-1}\circ\varphi_V$. The morphism $g_U=\varphi_U\circ\varphi_U^{-1}$ then makes $T_U$ an $S$-scheme, and the morphisms $g_U$ and $g_V$ coincide on $T_U\cap T_V$, so $X$ is an $S$-scheme. It is clear by definition that $X$ is affine over $S$ and $\mathscr{A}(T_U)=\mathscr{B}|_U$, so $\mathscr{A}(X)=\mathscr{B}$.
\end{proof}
\begin{corollary}
Let $S$ be a scheme. The functor $\mathscr{A}(X)$ defines an equivalence of categories between the category of affine $S$-schemes and the category of quasi-coherent $\mathscr{O}_S$-algebras.
\end{corollary}
\begin{proof}
By \cref{scheme S-affine functor A fully faithful} we now that $\mathscr{A}(X)$ is fully faithful, and \cref{scheme S-affine Spec functor dense} proves that it is essentially surjective, whence the claim. 
\end{proof}
\begin{corollary}\label{scheme qcoh algebra spec universal property}
Let $S$ be a scheme. Then for any quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{B}$, the contravariant functor
\[Y\mapsto\Hom_{\mathscr{O}_S\text{-}\mathbf{alg}}(\mathscr{B},\mathscr{A}(Y))=\Hom_{\mathscr{O}_Y\text{-}\mathbf{alg}}(\mathscr{B}\otimes_{\mathscr{O}_S}\mathscr{O}_Y,\mathscr{O}_Y)\]
from the category of $S$-schemes to the category of sets, is represented by $\Spec(\mathscr{B})$. 
\end{corollary}
\begin{proof}
Let $X=\Spec(\mathscr{B})$, then we know that $\mathscr{B}=\mathscr{A}(X)$, so the claim follows from \cref{scheme S-affine functor A fully faithful}.
\end{proof}
\begin{corollary}\label{scheme S-affine affine inverse image ring char}
Let $X$ be an affine $S$-scheme and $f:X\to S$ be the structural morphism. For any affine open $U\sub S$, the open subscheme $f^{-1}(U)$ of $X$ is an affine scheme with ring $\Gamma(U,\mathscr{A}(X))$.
\end{corollary}
\begin{proof}
We can suppose that $X$ is associated with the $\mathscr{O}_S$-algebra $\mathscr{A}(X)$, the corollary then follows from the construction of $X$ in \cref{scheme S-affine Spec functor dense}.
\end{proof}
\begin{example}\label{scheme affine not S-affine eg}
Let $S$ be the affine plane for a field $K$ with the point $0$ is doubled (\cref{scheme nonseparated eg}). With the notations there, $S$ is the union of two affine opens $Y_1,Y_2$. If $f$ is the open immersion $Y_1\to S$, then $f^{-1}(Y_2)=Y_1\cap Y_2$ and we have already seen in \cref{scheme nonseparated eg} that this is not affine. So we obtain an example of an affine scheme not affine over a scheme $S$.
\end{example}
\begin{remark}\label{scheme qcqs Stein factorization eg}
Let $S$ be a scheme and $f:X\to S$ be a quasi-compact and quasi-separated morphism, so that $\mathscr{A}(X)=f_*(\mathscr{O}_X)$ is a quasi-coherent $\mathscr{O}_S$-algebra (\cref{scheme morphism qcqs qcoh direct image}). The affine $S$-scheme
\[X^0=\Aff(X/S)=\Spec(f_*(\mathscr{O}_X))=\Spec(\mathscr{A}(X))\]
is called the \textbf{affine envelope} of the $S$-scheme $X$. If $f^0:X^0\to S$ is the structural morphism, by \cref{scheme S-affine Spec functor dense} we then have
\[\mathscr{A}(X^0)=f^0_*(\mathscr{O}_{X^0})=\mathscr{A}(X)=f_*(\mathscr{O}_{X});\]
by \cref{scheme qcoh algebra spec universal property}, the identity homomorphism on $\mathscr{A}(X)$ therefore corresponds to a canonical $S$-morphism $\iota_X:X\to X^0$ such that $f$ factors into
\[\begin{tikzcd}
X\ar[r,"\iota_X"]&X^0\ar[r,"f^0"]&S
\end{tikzcd}\]
This factorization for $f$ is called the \textbf{Stein factorization} of $f$. For the morphism $i_X$ to be an isomorphism, it is necessary and sufficient that the morphism $f$ is affine. Moreover, for any $S$-scheme $Y$ affine over $S$, the map $u\mapsto u\circ i_X$ is then a bijection
\begin{equation}\label{scheme qcqs Stein factorization eg-1}
\Hom_S(X^0,Y)\stackrel{\sim}{\to}\Hom_S(X,Y).
\end{equation}
which is functorial on $Y$: this follows from the canonical bijections
\begin{gather*}
\Hom_S(X,Y)\stackrel{\sim}{\to}\Hom_{\mathscr{O}_S\text{-}\mathbf{alg}}(\mathscr{A}(Y),\mathscr{A}(X))=\Hom_{\mathscr{O}_S\text{-}\mathbf{alg}}(\mathscr{A}(Y),\mathscr{A}(X^0))\stackrel{\sim}{\to}\Hom_S(X^0,Y).
\end{gather*}

That is, the $S$-affine scheme $X^0$ satisfies the universal property that any $S$-morphism $f:X\to Y$ such that $Y$ is affine over $S$ must factors through $X^0$, or equivalently that $X^0$ represents the covariant functor $Y\mapsto\Hom_S(X,Y)$ on the category of $S$-affine schemes. We also deduce that for $S$ fixed, $X\mapsto\Aff(X/S)$ is a covariant functor from the category of $S$-schemes that are quasi-compact and quasi-separted over $S$ to the cateogry of $S$-schemes affine over $S$. Consider a commutative diagram
\[\begin{tikzcd}
X\ar[r,"f"]\ar[d,swap,"\iota_X"]&X'\ar[d,"\iota_{X'}"]\\
X^0\ar[r,"f^0"]&X'^0
\end{tikzcd}\]
The relation (\ref{scheme qcqs Stein factorization eg-1}) can then be interpreted as the following: the functor $X\mapsto\Aff(X/S)$ is the left adjoint of the forgetful functor from the category of $S$-schemes affine over $S$ to the category of $S$-schemes. We then conclude that this functor commutes with inductive limits, hence finite sums.
\end{remark}
\begin{corollary}\label{scheme affine over S-affine iff}
Let $X$ be an affine $S$-scheme and $Y$ be an $X$-scheme. For $Y$ to be affine over $S$, it is necessary and sufficient that $Y$ is affine over $X$.
\end{corollary}
\begin{proof}
We can assume that $S$ is affine, and then $X$ is also affine by \cref{scheme affine over affine iff affine}. Then $Y$ is affine over $S$ if and only if it is affine over $X$, if and only if it is affine, so our claim follows.
\end{proof}
Let $X$ be an affine $S$-scheme. Then by \cref{scheme affine over S-affine iff}, to define of a scheme $Y$ affine over $X$ is equivalent to giving a scheme $Y$ affine over $S$ and an $S$-morphism $g:Y\to X$. In view of \cref{scheme S-affine Spec functor dense} and \cref{scheme S-affine functor A fully faithful}, this is equivalent to giving a quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{B}$ and a homomorphism $\mathscr{A}(X)\to\mathscr{B}$ of $\mathscr{O}_S$-algebras (which dfines over $\mathscr{B}$ an $\mathscr{A}(X)$-algebra structure). If $f:X\to S$ is the structural morphism, we then have $\mathscr{B}=f_*(g_*(\mathscr{O}_Y))$.
\begin{corollary}\label{scheme S-affine ft iff algebra ft}
Let $X$ be an affine $S$-scheme. For $X$ to be of finite type over $S$, it is necessary and sufficient that the quasi-coherent $\mathscr{O}_X$-algebra $\mathscr{A}(X)$ is of finite type.
\end{corollary}
\begin{proof}
By definition, we can assume that $S$ is affine. Then $X$ is an affine scheme, hence quasi-compact; if $S=\Spec(A)$, $X=\Spec(B)$, $\mathscr{A}(X)$ is the $\mathscr{O}_S$-algebra $\widetilde{B}$. As $\Gamma(X,\tilde{B})=B$, the corollary follows from \cref{scheme affine ft and fp iff ring}.
\end{proof}
\begin{corollary}\label{scheme S-affine reduced iff algebra reduced}
Let $X$ be an affine $S$-scheme. For $X$ to be reduced, it is necessary and sufficient that the quasi-coherent $\mathscr{O}_X$-algebra is reduced.
\end{corollary}
\begin{proof}
The question is local on $S$ so we can assume that $S$ is affine, and the corollary then follows from \cref{scheme affine reduced integral iff}.
\end{proof}
\subsection{Quasi-coherent sheaves over affine \texorpdfstring{$S$}{S}-schemes}
\begin{proposition}\label{scheme S-affine functor on qcoh full faithful}
Let $X$ be an affine $S$-scheme, $Y$ be an $S$-scheme, and $\mathscr{F}$ (resp. $\mathscr{G}$) be a quasi-coherent $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module). Then the map $(h,u)\mapsto(\mathscr{A}(h),\mathscr{A}(u))$ from the set of morphisms $(Y,\mathscr{G})\to(X,\mathscr{F})$ to the set of bi-homomorphisms $(\mathscr{A}(X),\mathscr{A}(\mathscr{F}))\to(\mathscr{A}(Y),\mathscr{A}(\mathscr{G}))$ is bijective.
\end{proposition}
\begin{proof}
The proof is the same as in \cref{scheme S-affine functor A fully faithful}, by using \cref{scheme morphism to affine qcoh sheaf}.
\end{proof}
\begin{corollary}\label{scheme S-affine qcoh isomorphism iff}
Under the hypotheses of \cref{scheme S-affine functor on qcoh full faithful}, suppose that $Y$ is affine over $S$. Then for the couple $(h,u)$ to be an isomorphism, it is necessary and sufficient that $(\mathscr{A}(h),\mathscr{A}(u))$ is a bi-isomorphism.
\end{corollary}
\begin{proposition}\label{scheme S-affine functor A on qcoh dense}
For any couple $(\mathscr{B},\mathscr{M})$ formed by a quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{B}$ and a quasi-coherent $\mathscr{B}$-module $\mathscr{M}$, there exists a couple $(X,\mathscr{F})$ formed by an affine $S$-scheme and a quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ such that $\mathscr{A}(X)=\mathscr{B}$ and $\mathscr{A}(\mathscr{F})=\mathscr{M}$, and this couple is determined up to isomorphisms.
\end{proposition}
\begin{proof}
The uniqueness part follows from \cref{scheme S-affine qcoh isomorphism iff}. The existence for the scheme $X$ follows from \cref{scheme S-affine Spec functor dense}. To define $\mathscr{M}$, we can consider an affine open $U\sub S$ and set $\mathscr{F}|_{f^{-1}(U)}=\widetilde{\Gamma(U,\mathscr{M})}$, where $f:X\to S$ is the structural morphism. We will use $\bigtilde{\mathscr{M}}$ to denote the quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ associated with $\mathscr{M}$.
\end{proof}
\begin{corollary}\label{scheme S-affine associated qcoh module functor prop}
In the category of quasi-coherent $\mathscr{B}$-modules, $\bigtilde{\mathscr{M}}$ is an additive covariant functor which commutes with inductive limits and direct sums.
\end{corollary}
\begin{proof}
We can in fact assume that $S$ is affine, and the claim then reduces to the functor $\widetilde{M}$ for $B$-modules, where $B=\Gamma(S,\mathscr{B})$.
\end{proof}
\begin{corollary}\label{scheme S-affine associated qcoh module ft iff}
Under the hypotheses of \cref{scheme S-affine functor A on qcoh dense}, assume that $\mathscr{B}$ is an $\mathscr{O}_X$-algebra of finite type. Then for $\bigtilde{\mathscr{M}}$ to be an $\mathscr{O}_X$-module of finite type, it is necessary and sufficient that $\mathscr{M}$ is an $\mathscr{B}$-module of finite type.
\end{corollary}
\begin{proof}
We can reduce to the case where $S=\Spec(A)$ is affine. Then $\mathscr{B}=\widetilde{B}$ where $B$ is an $A$-algebra of finite type, and $\mathscr{M}=\widetilde{M}$ where $M$ is an $B$-module. Over the scheme $X$, $\mathscr{O}_X$ is associated with the ring $B$ and $\bigtilde{\mathscr{M}}$ is associated with the $B$-module $M$. For $\bigtilde{\mathscr{M}}$ to be of finite type, it is necessary and sufficient that $M$ is of finite type, whence our claim.
\end{proof}
\begin{proposition}\label{scheme S-affine fiber product algebra char}
Let $Y$ be an affine $S$-scheme and $X,X'$ be two schemes affine over $Y$. Let $\mathscr{B}=\mathscr{A}(Y)$, $\mathscr{A}=\mathscr{A}(X)$, and $\mathscr{A}'=\mathscr{A}(X')$. Then $X\times_YX'$ is affine over $Y$ and $\mathscr{A}(X\times_YX')$ is identified with $\mathscr{A}\otimes_{\mathscr{B}}\mathscr{A}'$. 
\end{proposition}
\begin{proof}
In fact, $\mathscr{A}\otimes_{\mathscr{B}}\mathscr{A}'$ is a quasi-coherent $\mathscr{B}$-algebra (\cref{scheme qcoh over qcoh algebra char}), so is a quasi-coherent $\mathscr{O}_S$-algebra. Let $Z$ be the spectral of $\mathscr{A}\otimes_{\mathscr{B}}\mathscr{A}'$. The canonical $\mathscr{B}$-homomorphisms $\mathscr{A}\to\mathscr{A}\otimes_{\mathscr{B}}\mathscr{A}'$ and $\mathscr{A}'\to\mathscr{A}\otimes_{\mathscr{B}}\mathscr{A}'$ corresponds to $Y$-morphisms $p:Z\to X$ and $p':Z\to X'$ (\cref{scheme S-affine functor A fully faithful}). To see that the triple $(Z,p,p')$ is a product $X\times_YX'$, we can reduce to the case $S=\Spec(C)$ is affine. But then $Y,X,X'$ are all affine schemes with rings $B,A,A'$, which are $C$-algebras such that $\mathscr{B}=\widetilde{B}$, $\mathscr{A}=\widetilde{A}$, $\mathscr{A}'=\widetilde{A}$. We then see that $\mathscr{A}\otimes_{\mathscr{B}}\mathscr{A}'$ is identified with the $\mathscr{O}_S$-algebra $\widetilde{A\otimes_BA'}$ (\cref{scheme affine associated sheaf tensor and Hom}), so the ring of $Z$ is identified with $A\otimes_BA'$, and the morphisms $p,p'$ correspond to the canonical homomorphisms $A\to A\otimes_BA'$ and $A'\to A\otimes_BA'$. The proposition then follows from \cref{scheme fiber product affine case}.
\end{proof}
\begin{corollary}\label{scheme S-affine qcoh general product char}
Let $\mathscr{F}$ (resp. $\mathscr{F}'$) be a quasi-coherent $\mathscr{O}_X$-module (resp. $\mathscr{O}_{X'}$-module). Then $\mathscr{A}(\mathscr{F}\otimes_Y\mathscr{F}')$ is canonically identified with $\mathscr{A}(\mathscr{F})\otimes_{\mathscr{A}(Y)}\mathscr{A}(\mathscr{F}')$.
\end{corollary}
\begin{proof}
The sheaf $\mathscr{F}\otimes_Y\mathscr{F}'$ is coherent over $X\times_YX'$ by \cref{sheaf of module qcoh under inverse image}. Let $g:Y\to S$, $f:X\to Y$, $f':X'\to Y$ be the structural morphisms, so the structural morphism $h:Z\to S$ is equal to $g\circ f\circ p$ and to $g\circ f'\circ p'$. We define a canonical homomorphism
\[\mathscr{A}(\mathscr{F})\otimes_{\mathscr{A}(Y)}\mathscr{A}(\mathscr{F}')\to\mathscr{A}\]
by the following: for any open subset $U\sub S$, we have canonical homomorphisms
\[\Gamma(f^{-1}(g^{-1}(U)),\mathscr{F})\to\Gamma(h^{-1}(U),p^*(\mathscr{F})),\quad \Gamma(f'^{-1}(g^{-1}(U)),\mathscr{F}')\to\Gamma(h^{-1}(U),p'^*(\mathscr{F}')),\]
whence a canonical homomorphism
\[\begin{tikzcd}
\Gamma(f^{-1}(g^{-1}(U)),\mathscr{F})\otimes_{\Gamma(g^{-1}(U),\mathscr{O}_Y)}\Gamma(f'^{-1}(g^{-1}(U)),\mathscr{F}')\ar[d]\\
\Gamma(h^{-1}(U),p^*(\mathscr{F}))\otimes_{\Gamma(h^{-1}(U),\mathscr{O}_Z)}\Gamma(h^{-1}(U),p'^*(\mathscr{F}'))
\end{tikzcd}\]
To see this is an isomorphism of $\mathscr{A}(Z)$-modules, we can assume that $S$ is affine, and $\mathscr{F}=\widetilde{M}$, $\mathscr{F}'=\widetilde{M}'$, where $M$ (resp. $M'$) is an $A$-module (resp. $A'$-module). Then $\mathscr{F}\otimes_Y\mathscr{F}'$ is identified with the sheaf over $X\times_YX'$ associated with the $(A\otimes_BA')$-module $M\otimes_BM'$ and the corollary follows from the canonical indentification $\widetilde{M\otimes_BM'}$ with $\widetilde{M}\otimes_{\widetilde{B}}\widetilde{M}'$.
\end{proof}
\begin{corollary}\label{scheme S-affine qcoh algebra of inverse image char}
Let $X$ and $Y$ be affine $S$-schemes and $f:Y\to X$ be an $S$-morphism. Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module, then $\mathscr{A}(f^*(\mathscr{F}))$ is identified with $\mathscr{A}(\mathscr{F})\otimes_{\mathscr{A}(X)}\mathscr{A}(Y)$. 
\end{corollary}
\begin{proof}
This is a special case of \cref{scheme S-affine qcoh general product char}, by replacing $X'$ with $Y$ and $Y$ with $X$.
\end{proof}
In particular, if $X=X'=Y$ (where $X$ is an affine $S$-scheme), we see that if $\mathscr{F},\mathscr{G}$ are two quasi-coherent $\mathscr{O}_X$-modules, then
\[\mathscr{A}(\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{G})=\mathscr{A}(\mathscr{F})\otimes_{\mathscr{A}(X)}\mathscr{A}(\mathscr{G})\]
If moreover $\mathscr{F}$ is of finite presentation, then it follows from \cref{scheme affine associated sheaf direct image char} and \cref{scheme affine associated sheaf tensor and Hom} that
\[\mathscr{A}(\sHom_{\mathscr{O}_X}(\mathscr{F},\mathscr{G}))=\sHom_{\mathscr{A}(X)}(\mathscr{A}(\mathscr{F}),\mathscr{A}(\mathscr{G})).\]
\begin{proposition}\label{scheme S-affine coproduct prop}
If $X$ and $X'$ are two affine $S$-schemes with $\mathscr{B}=\mathscr{A}(X)$ and $\mathscr{B}'=\mathscr{A}(X')$. Then the coproduct $X\amalg X'$ is  affine over $S$ with $\mathscr{A}(X\amalg X')=\mathscr{B}\times\mathscr{B}'$.
\end{proposition}
\begin{proof}
The coproduct is affine over $S$ since the product of two affine schemes is affine, and the second assertion also follows from this, and the fact that $\Spec(A)\amalg\Spec(A')=\Spec(A\times A')$ for two rings $A,A'$.
\end{proof}
\begin{proposition}\label{scheme S-affine closed subscheme char}
Let $S$ be a scheme, $\mathscr{B}$ be a quasi-coherent $\mathscr{O}_S$-algebra, and $X=\Spec(\mathscr{B})$. For any quasi-coherent ideal $\mathscr{I}$ of $\mathscr{B}$, $\widetilde{\mathscr{I}}$ is a quasi-coherent ideal of $\mathscr{O}_X$, and the closed subschem of $X$ defined by $\widetilde{\mathscr{I}}$ is canonically isomorphic to $\Spec(\mathscr{B}/\mathscr{I})$.
\end{proposition}
\begin{proof}
In fact, it follows from \cref{scheme affine closed subscheme is affine} that $Y$ is affine over $S$, and in view of \cref{scheme S-affine Spec functor dense}, we can then assume that $S$ is affine, and the proposition follows from the corresponding result in affine schemes.
\end{proof}
We can also express the result of \cref{scheme S-affine closed subscheme char} by saying that if $h:\mathscr{B}\to\mathscr{B}'$ is a surjective homomorphism of quasi-coherent $\mathscr{O}_S$-algebras, then $\mathscr{A}(h):\Spec(\mathscr{B}')\to\Spec(\mathscr{B})$ is a closed immersion.
\begin{proposition}\label{scheme S-affine qcoh ideal of base inverse image char}
Let $S$ be a scheme, $\mathscr{B}$ be a quasi-coherent $\mathscr{O}_S$-algebra, and $X=\Spec(\mathscr{B})$. For any quasi-coherent ideal $\mathscr{K}$ of $\mathscr{O}_S$, we have (where $f:X\to S$ is the structural morphism) $f^*(\mathscr{K})\mathscr{O}_X=\widetilde{\mathscr{K}\mathscr{B}}$.
\end{proposition}
\begin{proof}
The question is local over $S$, so we can assume that $S=\Spec(A)$ is affine, and the proposition then follows \cref{scheme affine associated sheaf inverse image char}.
\end{proof}
\subsection{Base change of affine \texorpdfstring{$S$}{S}-schemes}
\begin{proposition}\label{scheme S-affine stable under base change}
Let $X$ be an affine $S$-scheme. For any extension $g:S'\to S$ of base scheme, $X'=X_{(S')}$ is affine over $S'$.
\end{proposition}
\begin{proof}
If $f':X'\to S'$ is the projection, it suffices to prove that $f'^{-1}(U')$ is an affine open for any affine open subset $U'$ of $S'$ such that $g(U')$ is contained in an affine open $U$ of $S$. We can then assume that $S$ and $S'$ are affine, so $X$ is affine. But then $X'$ is affine, so the claim follows.
\end{proof}
\begin{corollary}\label{scheme S-affine algebra under base change prop}
Let $f:X\to S$ be the structural morphism, $f':X'\to S'$, $g':X'\to X$ the projections such that the diagram
\[\begin{tikzcd}
X'\ar[r,"g'"]\ar[d,swap,"f'"]&X\ar[d,"f"]\\
S'\ar[r,"g"]&S
\end{tikzcd}\]
is commutative. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, there exists a canonical isomorphism $u:g^*(f_*(\mathscr{F}))\to f'_*(g'^*(\mathscr{F}))$ of $\mathscr{O}_{S'}$-modules. In particular, there exists a canonical isomorphism from $\mathscr{A}(X')$ to $g^*(\mathscr{A}(X))$.
\end{corollary}
\begin{proof}
To define $u$, it suffices to define a homomorphism
\[v:f_*(\mathscr{F})\to g_*(f'^*(\mathscr{F}))=f_*(g'_*(g'^*(\mathscr{F})))\]
and let $u$ be the homomorphism corresponding to $v$ (via the adjointness). We set $v=f_*(\rho)$, where $\rho:\mathscr{F}\to g'_*(g'^*(\mathscr{F}))$ is the canonical homomorphism. To prove that $u$ is an isomorphism, we can assume that $S$ and $S'$, hence $X$ and $X'$, are affine. Let $A,A',B,B'$ be the ring of $X,X',S,S'$, then $\mathscr{F}=\widetilde{M}$ where $M$ is an $B$-module. We then see that $g^*(f_*(\mathscr{F}))$ and $f'_*(g'^*(\mathscr{F}))$ are equal to the $\mathscr{O}_{S'}$-module associated with the $A'$-module $A'\otimes_AM$, and $u$ is the homomorphism associated with the identity.
\end{proof}
\begin{corollary}\label{scheme S-affine fiber affine}
For any affine $S$-scheme $X$ and $s\in S$, the fiber $X_s$ is an affine scheme.
\end{corollary}
\begin{proof}
It suffices to apply \cref{scheme S-affine stable under base change} on $\Spec(\kappa(s))\to S$.
\end{proof}
\begin{corollary}\label{scheme base change by affine morphism prop}
Let $X$ be an $S$-scheme and $S'$ be an affine $S$-scheme. Then $X'=X_{(S')}$ is affine over $X$. Moreover, if $f:X\to S$ is the structural homomorphism, there exists a canonical isomorphism of $\mathscr{O}_X$-algebras $\mathscr{A}(X')\cong f^*(\mathscr{A}(S'))$, and for any quasi-coherent $\mathscr{A}(S')$-module $\mathscr{M}$, a canonical bi-isomorphism $f^*(\mathscr{M})\cong\mathscr{A}(f'^*(\bigtilde{\mathscr{M}}))$, where $f'=f_{(S')}$ is the structural morphism $X'\to S'$.
\end{corollary}
\begin{proof}
It suffices to apply \cref{scheme S-affine stable under base change} and \cref{scheme S-affine algebra under base change prop}, with the role of $X$ and $S'$ exchanged. 
\end{proof}
Let $S$, $S'$ be two schemes, $q:S'\to S$ be a morphism, $\mathscr{B}$ (resp. $\mathscr{B}'$) be a quasi-coherent $\mathscr{O}_S$-algebra (resp. $\mathscr{O}_{S'}$-algebra), and $u:\mathscr{B}\to\mathscr{B}'$ be a $q$-morphism (which means a homomorphism $\mathscr{B}\to q_*(\mathscr{B}')$ of $\mathscr{O}_S$-algebras). If $X=\Spec(\mathscr{B})$ and $X'=\Spec(\mathscr{B}')$, we deduce a canonical morphism $v=\Spec(u):X'\to X$ such that the diagram
\begin{equation}\label{scheme S-affine morphism induced by algebra}
\begin{tikzcd}
X'\ar[d]\ar[r,"v"]&X\ar[d]\\
S'\ar[r,"q"]&S
\end{tikzcd}
\end{equation}
is commutatie. In fact, the homomorphism $u$ corresponds to a homomorphism $u^{\sharp}:q^*(\mathscr{B})\to\mathscr{B}'$ by adjointness, and there then exists a canonical $S'$-morphism
\[w:\Spec(\mathscr{B}')\to\Spec(q^*(\mathscr{B}))\]
such that $\mathscr{A}(w)=u^{\sharp}$ (\cref{scheme S-affine functor A fully faithful}). On the other hand, it follows from \cref{scheme S-affine algebra under base change prop} that $\Spec(q^*(\mathscr{B}))$ is canonically identified with $X\times_SS'$; the morphism $v$ is the defined to be the composition
\[\begin{tikzcd}
X'\ar[r,"w"]&X\times_SS'\ar[r,"p_1"]&X
\end{tikzcd}\]
where $p_1$ is the projection, and the commutativity of (\ref{scheme S-affine morphism induced by algebra}) is easily verified. Let $U$ (resp. $U'$) be an affine open of $S$ (resp. $S'$) such that $q(U')\sub U$, $A=\Gamma(U,\mathscr{O}_S)$, $A'=\Gamma(U',\mathscr{O}_{S'})$, $B=\Gamma(U,\mathscr{B})$, $B'=\Gamma(U'\mathscr{B}')$. The restriction of $u$ is a $(q|_{U'})$-morphism $u|_U:\mathscr{B}|_U\to\mathscr{B}'|_{U'}$ corresponding to a bi-homomorphism $B\to B'$ of algebras. If $V,V'$ are the inverse images of $U,U'$ in $X,X'$, respectively, the morphism $V'\to V$, which is the restriction of $v$, corresponds to the preceding bi-homomorphism.\par
Now let $\mathscr{M}$ be a quasi-coherent $\mathscr{B}$-module. There then exists a canonical isomorphism of $\mathscr{O}_{X'}$-modules
\begin{align}\label{scheme S-affine base change associated module isomorphism}
v^*(\bigtilde{\mathscr{M}})\cong (q^*(\mathscr{M})\otimes_{q^*(\mathscr{B})}\mathscr{B}')\widetilde{\hspace{3mm}}.
\end{align}
In fact, the canonical isomorphism of \cref{scheme S-affine algebra under base change prop} provides a canonical isomorphism of $p_1^*(\bigtilde{\mathscr{M}})$ with the sheaf over $\Spec(q^*(\mathscr{B}))$ associated with $q^*(\mathscr{B})$-module $q^*(\mathscr{M})$, and it suffices to apply \cref{scheme S-affine qcoh general product char}.\par
Recall that we say a morphism $f:X\to Y$ is affine if $X$ is an affine scheme over $Y$. The properties of affine $S$-schemes then translate into properties of affine morphisms.
\begin{proposition}[\textbf{Properties of Affine Morphisms}]
\label{scheme affine morphism permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A closed immersion is affine.
\item[(\rmnum{2})] The composition of two affine morphisms is affine.
\item[(\rmnum{3})] If $f:X\to Y$ is an affine $S$-morphism, then $f_{(S')}$ is affine for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $f':X'\to Y'$ are two affine $S$-morphisms, then $f\times_Sf'$ is affine. 
\item[(\rmnum{5})] If $f:X\to Y$ and $g:Y\to Z$ are two morphisms such that $g\circ f$ is affine and $g$ is separated, then $f$ is affine.
\item[(\rmnum{6})] If $f$ is affine, so is $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
In view of \cref{scheme morphism cancelled by separated if}, it suffices to prove (\rmnum{1}), (\rmnum{2}), and (\rmnum{3}). Now (\rmnum{1}) follows from \cref{scheme affine closed subscheme is affine}, (\rmnum{2}) follows from \cref{scheme affine over affine iff affine}, and (\rmnum{3}) follows from \cref{scheme S-affine stable under base change}.
\end{proof}
\begin{corollary}\label{scheme morphism affine to sp is affine}
If $X$ is an affine scheme and $Y$ is a separated scheme, any morphism $f:X\to Y$ is affine.
\end{corollary}
\begin{proof}
This is a direct concequence of \cref{scheme affine morphism permanence prop}(\rmnum{5}), since the canonical morphism $X\to\Spec(\Z)$ is affine.
\end{proof}
\begin{proposition}\label{scheme morphism to local Noe affine iff f_red}
Let $Y$ be a locally Noetherian scheme and $f:X\to Y$ be a morphism of finite type. Then for $f$ to be affine, it is necessary and sufficient that $f_{\red}$ is affine.
\end{proposition}
\begin{proof}
It suffcies to prove that $f$ is affine if $f_{\red}$ is affine. For this, we can assume that $Y$ is affine and Noetherian, and show that $X$ is affine. Now $Y_{\red}$ is affine, and $X_{\red}$ is therefore affine by hypothesis. Since $X$ is Noetherian, the assertion follows from \cref{scheme Noetherian affine iff red is}.
\end{proof}
\subsection{Vector bundles}
Let $A$ be a ring and $E$ be an $A$-module. Recall that the symmetric algebra over $E$ is the $A$-algebra $\bm{S}(E)$ (or $\bm{S}_A(E)$) which is the quotient of $\bm{T}(E)$ by the ideal generated by elements $x\otimes y-y\otimes x$, where $x,y$ belongs to $E$. The algebra $\bm{S}(E)$ is characterized by the universal property that if $\sigma:E\to \bm{S}(E)$ is the canonical map, any $A$-linear map $E\to B$, where $B$ is a commutative algebra, factors through $\bm{S}(E)$ and gives a homomorphism $\bm{S}(E)\to B$ of $A$-algebras. We deduce from this property that for two $A$-modules $E,F$, we have
\[\bm{S}(E\oplus F)=\bm{S}(E)\otimes \bm{S}(F).\]
Moreover, $\bm{S}(E)$ is a covariant functor on $E$ from the category of $A$-modules to that of commutative $A$-algebras. Finally, the preceding characterization shows that if $E=\rlim E_\lambda$, then $\bm{S}(E)=\rlim \bm{S}(E_\lambda)$. By abuse of language, a product $\sigma(x_1)\cdots\sigma(x_n)$, where $x_i\in E$, is usually written as $x_1\cdots x_n$. The algebra $\bm{S}(E)$ is graded, where $\bm{S}_n(E)$ is the set of linear combinations of products of $n$ elements of $E$. In particular, the algebra $\bm{S}(A)$ is canonically isomorphic to the polynomial algebra $A[T]$ over $A$, and the algebra $\bm{S}(A^n)$ is the polynomial algebra $A[T_1,\dots,T_n]$ over $A$. More particularly, if $E$ is free of rank $1$, then $\bm{S}_n(E)$ is isomorphic to the tensor algebra $\bm{T}(E)=\bigoplus_{n\geq 0}E^{\otimes n}$.\par
Let $\varphi:A\to B$ be a ring homomorphism. If $F$ is an $B$-module, the canonical map $F\to\bm{S}(F)$ then gives a canonical map $F_{(\varphi)}\to \bm{S}(F)_{(\varphi)}$, which factors into $F_{(\varphi)}\to \bm{S}(F_{(\varphi)})\to \bm{S}(F)_{(\varphi)}$. The canonical homomorphism $\bm{S}(F_{(\varphi)})\to \bm{S}(F)_{(\varphi)}$ is surjective, but not necessarily bijective. If $E$ is an $A$-module, any bi-homomorphism $E\to F$ (which is an $A$-homomorphism $E\to F_{(\varphi)}$) then gives an $A$-homomorphism $\bm{S}(E)\to \bm{S}(F_{(\varphi)})\to \bm{S}(F)_{(\varphi)}$ of algebras, which is a bi-homomorphism $\bm{S}(E)\to \bm{S}(F)$. Also, for any $A$-module $E$, $\bm{S}(E\otimes_AB)$ is canonically identified with the algebra $\bm{S}(E)\otimes_AB$, which follows from the universal property of $\bm{S}(E)$.\par
Let $R$ be a multiplicative subset of $A$. Then apply the previous arguments for the ring $B=R^{-1}A$, and recall that $R^{-1}E=E\otimes_AR^{-1}A$, we see that $\bm{S}(R^{-1}E)=R^{-1}\bm{S}(E)$. Moreover, if $R'\sups R$ is another multiplicative subset of $A$, the diagram
\[\begin{tikzcd}
R^{-1}E\ar[r]\ar[d]&R'^{-1}E\ar[d]\\
\bm{S}(R^{-1}E)\ar[r]&\bm{S}(R'^{-1}E)
\end{tikzcd}\]
is commutative.\par
Now let $(S,\mathscr{A})$ be a ringed space and $\mathscr{E}$ be an $\mathscr{A}$-module over $S$. If for each open subset $U\sub S$, we associate the $\Gamma(U,\mathscr{A})$-module $\bm{S}(\Gamma(U,\mathscr{E}))$, we then define a presheaf of algebras. The associated sheaf is called the \textbf{symmetric $\mathscr{A}$-algebra} of the $\mathscr{A}$-module $\mathscr{E}$ and denoted by $\bm{S}(\mathscr{E})$. It follows immediately that $\bm{S}(\mathscr{E})$ satisfies the following universal property: any homomorphism $\mathscr{E}\to\mathscr{B}$ of $\mathscr{A}$-modules, where $\mathscr{B}$ is an $\mathscr{A}$-algebra, factors through $\bm{S}(\mathscr{E})$ to give a homomorphism $\bm{S}(\mathscr{E})\to\mathscr{B}$ of $\mathscr{A}$-algebras. In particular, any homomorphism $u:\mathscr{E}\to\mathscr{F}$ of $\mathscr{A}$-modules defines a homomorphism $\bm{S}(u):\bm{S}(\mathscr{E})\to\bm{S}(\mathscr{F})$ of $\mathscr{A}$-algebras and $\bm{S}(\mathscr{E})$ is a covariant functor $\mathscr{E}$.\par
Now since the functor $\bm{S}$ commutes with inductive limits, we have $\bm{S}(\mathscr{E})_s=\bm{S}(\mathscr{E}_s)$ for any point $s\in S$. If $\mathscr{E}$, $\mathscr{F}$ are two $\mathscr{A}$-module, $\bm{S}(\mathscr{E}\oplus\mathscr{F})$ is canonically identified with $\bm{S}(\mathscr{E})\otimes_{\mathscr{A}}\bm{S}(\mathscr{F})$, as we can check this for the corresponding presheaves.\par
We see that $\bm{S}(\mathscr{E})$ is a graded $\mathscr{A}$-algebra, and $\bm{S}_n(\mathscr{E})$ is the $\mathscr{A}$-module associated with the presheaf $U\mapsto\bm{S}_n(\Gamma(U,\mathscr{E}))$. In particular, the algebra $\bm{S}(\mathscr{A})$ is identified with $\mathscr{A}[T]=\mathscr{A}\otimes_{\Z}\Z[T]$, and if $\mathscr{E}$ is an invertible sheaf, then $\bm{S}(\mathscr{E})$ is isomorphic to the tensor algebra $\bm{T}(\mathscr{E})=\bigoplus_{n\geq 0}\mathscr{E}^{\otimes n}$.
\begin{proposition}\label{ringed space sym inverse image prop}
Let $f:(S,\mathscr{A})\to(T,\mathscr{B})$ be a morphism of ringed spaces. If $\mathscr{F}$ is an $\mathscr{B}$-module, then $\bm{S}(f^*(\mathscr{F}))$ is canonically identified with $f^*(\bm{S}(\mathscr{F}))$
\end{proposition}
\begin{proof}
To see this, we may make use the universal property of $\bm{S}$. By definition, $\bm{S}(f^*(\mathscr{F}))$ is defined to be the unique $\mathscr{A}$-algebra satisfying the following equality
\[\Hom_{\mathscr{A}\text{-}\mathbf{alg}}(\bm{S}(f^*(\mathscr{F})),\mathscr{C})=\Hom_{\mathscr{A}}(f^*(\mathscr{F}),\mathscr{C})\]
for any $\mathscr{A}$-algebra $\mathscr{C}$. On the other hand, by the adjointness property of $f_*$ and $f^*$, we have
\begin{align*}
\Hom_{\mathscr{A}\text{-}\mathbf{alg}}(f^*(\bm{S}(\mathscr{F})),\mathscr{C})&=\Hom_{\mathscr{B}\text{-}\mathbf{alg}}(\bm{S}(\mathscr{F}),f_*(\mathscr{C}))\\
&=\Hom_{\mathscr{B}}(\mathscr{F},f_*(\mathscr{C}))=\Hom_{\mathscr{A}}(f^*(\mathscr{F}),\mathscr{C}).
\end{align*}
This implies the desired isomorphism. 
\end{proof}
\begin{proposition}\label{scheme affine sym of qcoh associated with module char}
Let $A$ be a ring, $S=\Spec(A)$ be the spectrum, and $\mathscr{E}=\widetilde{M}$ be the $\mathscr{O}_S$-module assocaited with an $A$-module $M$. Then the $\mathscr{O}_S$-algebra $\bm{S}(\mathscr{E})$ is associated with the $A$-algebra $\bm{S}(M)$.
\end{proposition}
\begin{proof}
In fact, for any $f\in A$, $\bm{S}(M_f)=\bm{S}(M)_f$, so the proposition follows from the definition of $\widetilde{\bm{S}(M)}$.
\end{proof}
\begin{corollary}\label{scheme qcoh sym ft fp iff}
If $S$ is a scheme and $\mathscr{E}$ is a quasi-coherent $\mathscr{O}_S$-module. Then the $\mathscr{O}_S$-algebra $\bm{S}(\mathscr{E})$ is quasi-coherent. If moreover $\mathscr{E}$ is of finite type (resp. of finite presentation), then each $\mathscr{O}_S$-module $\bm{S}_n(\mathscr{E})$ is of finite type (resp. finite presentation) and the $\mathscr{O}_S$-algebra $\bm{S}(\mathscr{E})$ is of finite type (resp. of finite presentation).
\end{corollary}
\begin{proof}
The first assertion is immediate by \cref{scheme affine sym of qcoh associated with module char}. The second one follows from the fact that, if $E$ is a finitely generated $A$-module, $\bm{S}_n(E)$ is also finitely generated. For the last assertion, we are reduced to the case $S=\Spec(A)$ and $\mathscr{E}=\widetilde{E}$ where $E$ is an $A$-module of finite type (resp. of finite presentation). Now if we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&N\ar[r]&A^n\ar[r]&E\ar[r]&0
\end{tikzcd}\]
then we deduce an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathfrak{I}\ar[r]&\bm{S}(A^n)\ar[r]&\bm{S}(E)\ar[r]&0
\end{tikzcd}\]
where $\mathfrak{I}$ is the ideal of $\bm{S}(A^n)$ generated by $N\sub\bm{S}_1(A^n)$, whence our conclusion.
\end{proof}
Let $S$ be a scheme and $\mathscr{E}$ be a quasi-coherent $\mathscr{O}_S$-module. For any $S$-scheme $T$, with structural morphism $f:T\to S$, let $\mathscr{E}_{(T)}=f^*(\mathscr{E})$, which is a quasi-coherent $\mathscr{O}_T$-module. The map
\[T\mapsto F_{\mathscr{E}}(T)=\Hom_{\mathscr{O}_T}(\mathscr{E}_{(T)},\mathscr{O}_T)=\Gamma(T,\mathscr{E}_{(T)}^{\vee})\]
then defines a contravariant functor from the category of $S$-schemes to that of sets if for any $S$-morphism $g:T'\to T$ we define $F_{\mathscr{E}}(g):F_{\mathscr{E}}(T)\to F_{\mathscr{E}}(T')$ to be the map $g^*:u\mapsto g^*(u)$ (note that the structural morphism $T'\to S$ is $f\circ g$ and we have $\mathscr{E}_{(T')}=g^*(\mathscr{E}_{(T)})$ and $\mathscr{O}_{T'}=g^*(\mathscr{O}_T)$).
\begin{proposition}\label{scheme qcoh associated vector bundle def}
For any quasi-coherent $\mathscr{O}_S$-module $\mathscr{E}$, the contravariant functor $F_{\mathscr{E}}$ is represented by the couple formed by the affine $S$-scheme $\V(\mathscr{E})=\Spec(\bm{S}(\mathscr{E}))$. The $S$-scheme $\V(\mathscr{E})$ is called the \textbf{vector bundle over $\bm{S}$ defined by $\mathscr{E}$}.
\end{proposition}
\begin{proof}
This follows from the following canonical isomorphisms for any $S$-scheme $T$:
\begin{align*}
\Hom_S(T,\V(\mathscr{E}))&=\Hom_{\mathscr{O}_S\text{-}\mathbf{alg}}(\bm{S}(\mathscr{E}),\mathscr{A}(T))=\Hom_{\mathscr{O}_S}(\mathscr{E},f_*(\mathscr{O}_T))\\
&=\Hom_{\mathscr{O}_T}(f^*(\mathscr{E}),\mathscr{O}_T)=\Hom_{\mathscr{O}_T}(\mathscr{E}_{(T)},\mathscr{O}_T). \qedhere
\end{align*}
\end{proof}
The canonical $\bm{S}(\mathscr{E})$-homomorphism $\mathscr{E}\otimes_{\mathscr{O}_S}\bm{S}(\mathscr{E})\to\bm{S}(\mathscr{E})$ induced by \cref{scheme S-affine functor A fully faithful} an $\mathscr{O}_{\V(\mathscr{E})}$-homomorphism $\mathscr{E}_{(\V(\mathscr{E}))}\to\mathscr{O}_{\V(\mathscr{E})}$, which is a section over $\V(\mathscr{E})$ of dual sheaf $\mathscr{E}_{(\V(\mathscr{E}))}^*$ of $\mathscr{E}_{(V(\mathscr{E}))}$, called the \textbf{universal section} of this dual. If $U=\Spec(A)$ is an affine open of $S$, its inverse image in $\V(\mathscr{E})$ is identified with $\Spec(\bm{S}(M))$, if $\mathscr{E}|_U=\widetilde{M}$ where $M$ is an $A$-module. Over the scheme $\Spec(\bm{S}(M))$, the universal section is identified with the homomorphism $m\otimes p\mapsto mp$ of $M\otimes_A\bm{S}(M)$ to $\bm{S}(M)$, where $M$ is identified with the subset $\bm{S}_1(M)$ of $\bm{S}(M)$.\par
Consider in particular an open subset $U$ of $S$. Then the $S$-morphisms $U\to\V(\mathscr{E})$ are the $U$-sections of the $U$-scheme induced by $\V(\mathscr{E})$ over $p^{-1}(U)$ (where $p:\V(\mathscr{E})\to S$ is the structural morphism). By the definition of $\V(\mathscr{E})$, these $U$-sections correspond bijectively to sections of the dual $\mathscr{E}^*$ of $\mathscr{E}$ over $U$. The functorial of $\V$ shows that this interpretation is compatible with the restriction to an open subset $U'\sub U$, so we can say that the dual $\mathscr{E}^*$ of $\mathscr{E}$ is canonically identified with the sheaf of germs of $S$-sections of $\V(\mathscr{E})$. In particular, if $T=S$, the zero homomorphism $\mathscr{E}\to\mathscr{O}_S$ corresponds to an $S$-section of $\V(\mathscr{E})$, called the \textbf{zero section}.\par
If now we choose $T$ to be the spectrum $\{\xi\}$ of a field $K$, the structural morphism $f:T\to S$ corresponds to a monomorphism $\kappa(s)\to K$, where $s=f(\xi)$ (\cref{scheme local of field morphism factors through prop}), and the $S$-morphisms $\{\xi\}\to\V(\mathscr{E})$ are none other than points of $\V(\mathscr{E})$ with values in the extension $K$ of $\kappa(s)$, which all locate at some points of $p^{-1}(s)$. The set of these points, which is called the \textbf{rational fiber} of $\V(\mathscr{E})$ over $K$ lying over the point $s$, is then identified (by the definition of $\V(\mathscr{E})$) with the dual of the $K$-vector space $\mathscr{E}_s\otimes_{\mathscr{O}_{S,s}}K=\mathscr{E}^s\otimes_{\kappa(s)}K$ where we set $\mathscr{E}^s=\mathscr{E}_s/\m_s\mathscr{E}_s$. If $\mathscr{E}^s$ and $K$ are of finite rank over $\kappa(s)$, this dual is identified with $(\mathscr{E}^s)^*\otimes_{\kappa(s)}K$, where $(\mathscr{E}^s)^*$ is the dual space of the $\kappa(s)$-vector space $\mathscr{E}^s$.\par
These properties justify the terminology of "vector bundle" introduced above, but note that the definition we obtained is dual to the classical definition, since one would expect to obtain the space $\mathscr{E}^s\otimes_{\kappa(s)}K$ for the fiber of $\V(\mathscr{E})$, rather than its dual. This distinction is imposed for the need of defining $\V(\mathscr{E})$ for any quasi-coherent $\mathscr{O}_S$-module $\mathscr{E}$, not only for locally free $\mathscr{O}_S$-modules of finite rank. We can indeed show that the functor $T\mapsto\Gamma(T,\mathscr{E}_{(T)})$ is only representable if $\mathscr{E}$ is locally free of finite rank.
\begin{proposition}\label{scheme qcoh vector bundle prop}
Let $S$ be a scheme.
\begin{enumerate}
\item[(\rmnum{1})] $\V$ is a contravariant functor on $\mathscr{E}$ from the category of quasi-coherent $\mathscr{O}_S$-modules to the category of affine $S$-schemes.
\item[(\rmnum{2})] If $\mathscr{E}$ is of finite type (resp. of finite presentation), $\V(\mathscr{E})$ is of finite type (resp. of finite presentation) over $S$.
\item[(\rmnum{3})] If $\mathscr{E}$ and $\mathscr{F}$ are two quasi-coherent $\mathscr{O}_S$-modules, $\V(\mathscr{E}\oplus\mathscr{F})$ is canonically identified with $\V(\mathscr{E})\times_S\V(\mathscr{F})$.
\item[(\rmnum{4})] Let $g:S'\to S$ be a morphism. For any quasi-coherent $\mathscr{O}_S$-module $\mathscr{E}$, $\V(g^*(\mathscr{E}))$ is canonically identified with $\V(\mathscr{E})_{(S')}=\V(\mathscr{E})\times_SS'$.
\item[(\rmnum{5})] A surjective homomorphism $\mathscr{E}\to\mathscr{F}$ of quasi-coherent $\mathscr{O}_S$-modules corresponds to a closed immersion $\V(\mathscr{F})\to\V(\mathscr{E})$. 
\end{enumerate}
\end{proposition}
\begin{proof}
Assertion (\rmnum{1}) follows from \cref{scheme S-affine functor A fully faithful}, since for any homomorphism $\mathscr{E}\to\mathscr{F}$ of $\mathscr{O}_S$-modules we have a homomorphism $\bm{S}(\mathscr{E})\to\bm{S}(\mathscr{F})$ of $\mathscr{O}_S$-algebras. Assertion (\rmnum{2}) follows immediately from \cref{scheme S-affine associated qcoh module ft iff} and \cref{scheme qcoh sym ft fp iff}. To prove (\rmnum{3}), it suffices to recall the canonical isomorphism $\bm{S}(\mathscr{E}\oplus\mathscr{F})\cong\bm{S}(\mathscr{E})\otimes_{\mathscr{O}_S}\bm{S}(\mathscr{F})$ and apply \cref{scheme S-affine fiber product algebra char}. Similarly, to prove (\rmnum{4}), it suffices to remark that if the homomorphism $\mathscr{E}\to\mathscr{F}$ is surjective, so is the corresponding homomorphism $\bm{S}(\mathscr{E})\to\bm{S}(\mathscr{F})$ of $\mathscr{O}_S$-algebras, and apply \cref{scheme S-affine closed subscheme char}.
\end{proof}
\begin{example}
Consider in particular $\mathscr{E}=\mathscr{O}_S$. The scheme $\V(\mathscr{O}_S)$ is the specturm of the $\mathscr{O}_S$-algebra $\bm{S}(\mathscr{O}_S)$, which is identified with $\mathscr{O}_S[T]=\mathscr{O}_S\otimes_{\Z}\Z[T]$. This is evident if $S=\Spec(\Z)$, in view of \cref{scheme affine sym of qcoh associated with module char}, and we pass from this to the general case by considering the structural morphism $S\to\Spec(\Z)$ and using \cref{scheme qcoh vector bundle prop}(\rmnum{4}). Because of this result, we again set $\V(\mathscr{O}_S)=S[T]$, and we obtain the identification of the sheaf of germs of $S$-sections of $S[T]$ over $\mathscr{O}_S$ as a particular case.\par
For any $S$-scheme $X$, by the definition of $\V(\mathscr{O}_S)$, the set $\Hom_S(X,S[T])$ is canonically identified with $\Hom_{\mathscr{O}_S}(\mathscr{O}_S,\mathscr{A}(X))$, which is canonically isomorphic to $\Gamma(S,\mathscr{A}(X))$ and therefore has a ring structure. Moreover, any $S$-morphism $h:X\to Y$ corresponds to a homomorphism $\Gamma(\mathscr{A}(h)):\Gamma(S,\mathscr{A}(Y))\to\Gamma(S,\mathscr{A}(X))$, so we obtain a contravariant functor $\Hom_S(X,S[T])$ from the category of $S$-schemes to the cateogry of rings. On the other hand, $\Hom_S(X,\V(\mathscr{E}))$ is identified similarly with $\Hom_{\mathscr{O}_S}(\mathscr{E},\mathscr{A}(X))$ (where $\mathscr{A}(X)$ is considered as an $\mathscr{O}_S$-module); we can then endow this set a $\Hom_S(X,S[T])$-module structure, and the couple
\[(\Hom_S(X,S[T]),\Hom_S(X,\V(\mathscr{E})))\]
is a contravariant functor on $X$ with values in the category of couples $(A,M)$ formed by a ring $A$ and an $A$-module $M$, with morphisms being the bi-homomorphisms. In view of this, we say that $S[T]$ is the \textbf{$S$-scheme of ring} and $\V(\mathscr{E})$ is the \textbf{$S$-scheme of module} over the $S$-scheme of ring $S[T]$. 
\end{example}
\section{Homogeneous specturm of graded algebras}
Let $S$ be a graded ring and $S_+$ be the irrelevant ideal. We say a subset $\mathfrak{I}$ of $S_+$ is an \textbf{ideal of $S_+$} if it is an ideal of $S$, and it is called a \textbf{graded prime ideal of $S_+$} if it is the intersection with $S_+$ of a graded prime ideal of $S$ not containing $S_+$ (in particular $\mathfrak{I}\neq S_+$, and this graded prime ideal of $S$ is unique by \cref{graded ring coincide partly with prime ideal iff}). If $\mathfrak{I}$ is an ideal of $S_+$, the radical of $\mathfrak{I}$ in $S_+$, denoted by $\r_+(\mathfrak{I})$, is the set of elements of $S_+$ which have some power contained in $\mathfrak{I}$, or equivalently, $\r_+(\mathfrak{I})=\sqrt{\mathfrak{I}}\cap S_+$. In particularm the radical of $0$ in $S_+$ is called the \textbf{nilradical} of $S_+$ and denoted by $\n_+$: this is the subset of nilpotent elements of $S_+$. If $\mathfrak{I}$ is a graded ideal of $S_+$, its radical $\r_+(\mathfrak{I})$ is also graded: by passing to $S/\mathfrak{I}$, we may assume that $\mathfrak{I}=0$, and note that if $x=x_h+x_{h+1}+\cdots+x_k$ is nilpotent, then so is each $x_i\in S_i$; we can suppose that $x_k=0$ and the top degree component of $x^n$ is then $x_k^n$, so $x_k$ is nilpotent, and we then preceed by induction on $k$. We say the graded ring $S$ is essentially reduced if $\n_+=0$, which means $S_+$ contains no nonzero nilpotent elements.\par
We note that in a graded ring $S$, if an element $x$ is a zero divisor, so is its homogeneous component of top degree. We then say that the ring $S$ is \textbf{essentially integral} if the ring $S_+$ (with the unit element) does not contain nonzero zero divisors; it suffices for this that a nonzero homogeneous element in $S_+$ is not divisor of $0$ in this ring. It is clear that if $\p$ is a graded prime ideal of $S_+$, $S/\p$ is essentially integral. Let $S$ be an essentially integral graded ring, and let $x_0\in S_0$. It there exists a homogeneous element $f\neq 0$ in $S_+$ such that $x_0f=0$, we then have $x_0S_+=0$, because $(x_0g)f=(x_0f)g=0$ for any $g\in S_+$, and the hypothesis on $S$ implies that $x_0g=0$. Therfore, for that $S$ is integral, it is necessary and sufficient that $S_0$ is integral and the annihilator of $S_+$ in $S_0$ reduces to zero.
\subsection{Localization of graded rings}
Let $S$ be a graded ring with positive degrees, $f$ be a homogeneous element of $S$ of degree $d>0$. Then the fraction ring $S_f$ is graded, where $(S_f)_n$ is the set of elements $x/f^k$, where $x\in S_{n+kd}$ with $k\geq 0$ (note that $n$ can be an arbitrary integer). We denote by $S_{(f)}$ the subring $(S_f)_0$ of $S_f$ formed by elements of degree $0$.\par
If $f\in S_d$, the monomials $(f/1)^h$ in $S_f$ (where $h$ is an integer) form a lineraly independent system over the ring $S_{(f)}$, and the set of their linear combinations over $S_{(f)}$ is exactly the ring $(S^{(d)})_f$ (recall that $S^{(d)}$ is the direct sum of $S_{nd}$), and then we get an isomorphism
\begin{align}\label{graded ring localization S_f isomorphic to polynomial}
(S^{(d)})_f\cong S_{(f)}[T,T^{-1}]=S_{(f)}\otimes_{\Z}\Z[T,T^{-1}]
\end{align}
(where $T$ is an indeterminate). In fact, if we have a relatin
\[\sum_{h=-a}^{a}z_h(f/1)^h=0\]
where $z_h=x_h/f^m\in S_{(f)}$, then there exists an integer $k>-a$ such that
\[\sum_{h=-a}^{b}f^{h+k}x_h=0,\]
and as the degrees of these terms are distinct, we have $f^{h+k}x_h=0$ for all $h$, so $z_h=0$ for all $h$. Similarly, if $M$ is a graded $S$-module, the localization $M_f$ is a graded $S_f$-module with $(M_f)_n$ being the set of elements $z/f^k$ where $z\in M_{n+kd}$. We denote by $M_{(f)}$ the set of elements of degree $0$ in $M_f$. It is immediate that $M_{(f)}$ is an $S_{(f)}$-module and we have $(M^{(d)})_f=M_{(f)}\otimes_{S_{(f)}}(S^{(d)})_f$.
\begin{lemma}\label{graded ring localization of fg prop}
Let $f\in S_d$ and $g\in S_e$ be two homogeneous elements of $S$ with positive degrees. Then there exists a canonical isomorphism
\[S_{(fg)}\cong (S_{(f)})_{g^d/f^e}.\]
If we identify these two rings, then for any $S$-module $M$, we have a canonical isomorphism
\[M_{(fg)}\cong (M_{(f)})_{g^d/f^e}.\] 
\end{lemma}
\begin{proof}
Note that $(fg)$ divides $f^eg^d$ and $f^eg^d$ divides $(fg)^{de}$, so the rings $S_{fg}$ and $S_{f^eg^d}$ are canonically identified. On the other hand, $S_{f^eg^d}$ is also identified with $(S_{f^e})_{g^d/1}$, and as $f^e/1$ is invertible in $S_{f^e}$, $s_{f^eg^d}$ is also identified with $(S_{f^e})_{g^d/f^e}$. Now the element $g^e/f^e$ is of degree zero in $S_{f^e}$, so we can conclude that the subring of $(S_{f^e})_{g^d/f^e}$ formed by elements of degree zero is $(S_{(f^e)})_{g^d/f^e}$, and as we have $S_{(f^e)}=S_{(f)}$, we see the assertion follows.
\end{proof}
With the hypotheses of \cref{graded ring localization of fg prop}, it is clear that the canonical homomorphism $S_f\to S_{fg}$, which maps $x/f^k$ to $xg^k/(fg)^k$, is of degree $0$ so restricts to a canonical homomorphism $S_{(f)}\to S_{(fg)}$, such that the diagram
\[\begin{tikzcd}
&S_{(f)}\ar[ld]\ar[rd]&\\
S_{(fg)}\ar[rr,"\sim"]&&(S_{(f)})_{(g^d/f^e)}
\end{tikzcd}\]
is commutative. We define similarly a canonical homomorphism $M_{(f)}\to M_{(fg)}$.
\begin{lemma}\label{graded ring localization of fg generated by f and g}
If $f,g$ are two homogeneous elements of $S_+$, the ring $S_{(fg)}$ is generated by the union of the canonical images of $S_{(f)}$ and $S_{(g)}$.
\end{lemma}
\begin{proof}
In view of \cref{graded ring localization of fg prop}, it suffices to show that $1/(g^d/f^e)=f^{d+e}/(fg)^d$ belongs to the canonical image of $S_{(g)}$ in $S_{(fg)}$, which is evident from the definition.
\end{proof}
\begin{proposition}\label{graded ring S_(f) isomorphic to quotient by f-1}
Let $f\in S_d$ be a homogeneous element of positive degree. Then there exists a canonical isomorphism $S_{(f)}\cong S^{(d)}/(f-1)S^{(d)}$ of rings. If we identify these two rings, then for any $S$-module $M$, there exists a canonical isomorphism of modules $M_{(f)}\cong M^{(d)}/(f-1)M^{(d)}$
\end{proposition}
\begin{proof}
The first isomorphism is defined by sending the element $x/f^n$, where $x\in S_{nd}$, to the element $\bar{x}$, the class of $x$ mod $(f-1)S^{(d)}$. This map is well-defined, because we have the congruence $f^hx\equiv x$ mod $(f-1)S^{(d)}$ for any $x\in S^{(d)}$, so if $f^hx=0$ for some $h>0$ then $\bar{x}=0$. On the other hand, if $x\in S_{nd}$ is such that $x=(f-1)y$ with $y=y_{hd}+y_{(h+1)d}\cdots+y_{kd}$, where $y_{jd}\in S_{jd}$ and $y_{hd}\neq 0$, we have necessarily $h=n$ and $x=-y_{hd}$, as well as the relations $y_{(j+1)d}=fy_{jd}$ for $h\leq j\leq k-1$ and $f_{ykd}=0$; in particular, this implies $f^{k-n}x=0$. We therefore have an inverse homomorphism from $S^{(d)}/(f-1)S^{(d)}$ to $S_{(f)}$ by corresponding a class $\bar{x}$ mod $(f-1)S^{(d)}$ (where $x\in S_{nd}$) the element $x/f^n$ of $S_{(f)}$, since the preceding remark shows that this map is well-defined. The first assertion is therefore proves, and the second one can be done similarly.
\end{proof}
\begin{corollary}\label{graded ring Noe S_(f) is Noe}
If $S$ is Noetherian, so is $S_{(f)}$ for any homogeneous element $f$ of positive degree.
\end{corollary}
\begin{proof}
This follows from \cref{graded ring S_(f) isomorphic to quotient by f-1} and \cref{graded ring finitely generated criterion}. 
\end{proof}
Let $T$ be a multiplicative subset of $S_+$ formed by homogeneous elements; $T_0=T\cup\{1\}$ is then a multiplicative subset of $S$. As the elements of $T_0$ are homogeneous, the ring $T_0^{-1}S$ is graded in a natrual way, and we denote by $S_{(T)}$ the subring of $T_0^{-1}S$ formed by elements of degree $0$. We know that $T_0^{-1}S$ is identified with the inductive limit of the rings $S_f$, where $f\in T$ (with the canonical homomorphisms $S_f\to S_{fg}$). As this identification preserves the degrees, it identified $S_{(T)}$ as the inductive limit of $S_{(f)}$, where $f\in T$. For any graded $S$-module $M$, we define similarly the module $M_{(T)}$ (over the ring $S_{(T)}$) formed by degree zero elements of $T_0^{-1}M$, and we conclude that $M_{(T)}$ is the inductive limit of $M_{(f)}$ for $f\in T$.\par
If $\p$ is a graded prime ideal of $S_+$, we denote by $S_{(\p)}$ and $M_{(\p)}$ the ring $S_{(T)}$ and the module $M_{(T)}$ respectively, where $T$ is the homogeneous elements of $S_+$ not contained in $\p$.
\subsection{The homogeneous specturm of a graded ring} 
Given a graded ring $S$ with positive degrees, we denote by $\Proj(S)$ the \textbf{homogeneous specturm} of $S$, which is the set of graded prime ideals of $S_+$, or, equivalently, the set of graded prime ideals of $S$ not containing $S_+$. We will define a scheme structure on $\Proj(S)$, just as we have done for $\Spec(A)$ for a ring $A$.\par
For a subset $E$ of $S$, let $V_+(E)$ be the set of graded prime ideals of $S$ containing $E$ and not containing $S_+$, which is also the subset $V(E)\cap\Proj(S)$ of $\Spec(S)$. We have immediately the following equalities:
\begin{gather*}
V_+(0)=\Proj(S),\quad V_+(S)=V_+(S_+)=\emp,\\
V_+\Big(\bigcup_\lambda E_\lambda\Big)=\bigcap_\lambda V_+(E_\lambda),\\
V_+(EF)=V_+(E)\cup V_+(F).
\end{gather*}
Again, the set $V_+(E)$ remain unchanged if we replace $E$ by the graded ideal it generates; moreover, if $\mathfrak{I}$ is a graded ideal of $S$, we have
\begin{align}\label{scheme Proj V(a) unchanged if truncation on start}
V_+(\mathfrak{I})=V_+\Big(\bigcup_{i\geq n}(\mathfrak{I}\cap S_i)\Big)
\end{align}
for any $n>0$: in fact, if $\p\in\Proj(S)$ contains the homogeneous elements of $\mathfrak{I}$ with degrees $\geq n$, as by hypothesis there exists a homogeneous element $f\in S_d$ not contained in $\p$, for any $m\geq 0$ and any $x\in S_m\cap\mathfrak{I}$, we have $f^rx\in\mathfrak{I}\cap S_{m+rd}$ for $r$ sufficiently large, hence $f^rx\in\p\cap S_{m+rd}$, which implies $x\in\p\cap S_m$. Finally, for any graded ideal $\mathfrak{I}$ of $S$, we have
\[V_+(\mathfrak{I})=V_+(\r_+(\mathfrak{I}))\]
where $\r_+(\mathfrak{I})$ is the radical of $\mathfrak{I}$ in $S_+$.\par
By definition, $V_+(E)$ is a closed subset of $X=\Proj(S)$ for the topology induced by $\Spec(S)$. For each element $f\in S$, we set
\[D_+(f)=D(f)\cap\Proj(S)=\Proj(S)\setminus V_+(f).\]
Then for two elements $f,g\in S$, $D_+(fg)=D_+(f)\cap D_+(g)$, and the subsets $D_+(f)$, with $f\in S_+$, form a basis for the topology of $X=\Proj(S)$.\par
Let $f$ be a homogeneous element of $S_+$ with degree $d>0$. For any prime ideal $\p$ of $S$ not containing $f$, we see the set of $x/f^n$, where $x\in\p$ and $n\geq 0$, is a prime ideal of the fraction ring $S_f$. Its trace on $S_{(f)}$ is then a prime ideal of this ring, which we denote by $\psi_f(\p)$: this is the set of elements $x/f^n$, for $n\geq 0$, $x\in\p_{nd}$. We have therefore defined a map
\[\psi_f:D_+(f)\to\Spec(S_{(f)});\]
moreover, if $g$ is another homogeneous element of $S_+$ with degree $e>0$, we have a commutative diagram
\begin{equation}\label{scheme Proj standard open inclusion diagram}
\begin{tikzcd}
D_+(fg)\ar[d]\ar[r,"\psi_{fg}"]&\Spec(S_{(fg)})\ar[d]\\
D_+(f)\ar[r,"\psi_f"]&\Spec(S_{(f)})
\end{tikzcd}
\end{equation}
where the left vertical maps are inclusions, and the right one is the map $^{a}\!\omega_{fg,f}$ induced from the canonical homomorphism $\omega_{fg,f}:S_{(f)}\to S_{(fg)}$. In fact, if $x/f^n\in\omega^{-1}(\psi_{fg}(\p))$, where $fg\notin\p$, we then have $g^nx/(fg)^n\in\psi_{fg}(\p)$, so $g^nx\in\p$ and therefore $x\in\p$, and the converse inclusion is evident.
\begin{proposition}\label{scheme Proj standard open is affine}
The map $\psi_f$ is a homeomorphism from $D_+(f)$ to $\Spec(S_{(f)})$.
\end{proposition}
\begin{proof}
For $h\in S_{nd}$ is such that $h/f^n\in\psi_f(\p)$, by definition it is necessary and sufficient that $h\in\p$, so $\psi^{-1}(D(h/f^n))=D_+(fh)=D_+(h)\cap D_+(f)$ and the map $\psi_f$ is therefore continuous. Moreover, the sets $D_+(hf)$, where $h$ runs through the set $S_{nd}$, form a basis of the topology of $D_+(f)$, so the preceding argument proves, in view of the $T_0$-axiom for $D_+(f)$ and $\Spec(S_{(f)})$, that $\psi_f$ is injective and the inverse map $\psi_f(D_+(f))\to D_+(f)$ is continuous. Finally, to show that $\psi_f$ is surjective, we remark that, if $\q_0$ is a prime ideal of $S_{(f)}$ and if, for any $n>0$, we denote by $\p_n$ the set of elements $x\in _Sn$ such that $x^d/f^n\in\q_n$, the $\p_n$ then verify the conditions \cref{graded ring coincide partly with prime ideal iff}: if $x\in S_n$, $y\in S_n$ are such that $x^d/f^n\in\q_0$ and $y^d/f^n\in\q_0$, we have $(x+y)^{2d}/f^{2n}\in\q_0$, whence $(x+y)^d/f^n\in\q_0$ since $\q_0$ is prime; this proves that $\p_n$ is a subgroup of $S_n$, and the verification of other conditions of \cref{graded ring coincide partly with prime ideal iff} is immediate. If $\p$ is the corresponding graded ideal of $S$, then $\psi_f(\p)=\q_0$, since if $x\in S_{nd}$, the relations $x/f^n\in\q_0$ and $x^d/f^{nd}\in\q_0$ are equivalent.
\end{proof}
\begin{corollary}\label{scheme Proj D_+(f) empty iff nilpotent}
For $D_+(f)\neq\emp$, it is necessary and sufficient that $f$ is nilpotent.
\end{corollary}
\begin{proof}
For $\Spec(S_{(f)})=\emp$, it is necessary and sufficient that $S_{(f)}=0$, which means $1=0$ in $S_f$, and this is equivalent to that $f$ is nilpotent.
\end{proof}
\begin{corollary}\label{scheme Proj V_+ is total space iff}
Let $E$ be a subset of $S_+$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $V_+(E)=X=\Proj(S)$.
\item[(\rmnum{2})] Every element of $E$ is nilpotent.
\item[(\rmnum{3})] The homogeneous components of every element of $E$ are nilpotent.
\end{enumerate}
\end{corollary}
\begin{proof}
It is clear that (\rmnum{3})$\Rightarrow$(\rmnum{2})$\Rightarrow$(\rmnum{1}). If $\mathfrak{I}$ is the graded ideal of $S$ generated by $E$, conditions (\rmnum{1}) is equivalent to that $V_+(\mathfrak{I})=X$, and a fortiori, (\rmnum{1}) implies that any homogeneous element $f\in\mathfrak{I}$ is such that $V_+(f)=X$, so $f$ is nilpotent by \cref{scheme Proj D_+(f) empty iff nilpotent}. 
\end{proof}
\begin{corollary}\label{scheme Proj radical is intersection of V}
If $\mathfrak{I}$ is a graded ideal of $S_+$, $\r_+(\mathfrak{I})$ is the intersection of graded prime ideals in $V_+(\mathfrak{I})$.
\end{corollary}
\begin{proof}
By considering the ring $S/\mathfrak{I}$, we may assume that $\mathfrak{I}=0$. It then suffices to prove that if $f\in S_+$ is not nilpotent, then there exists a graded prime ideal of $S$ not containing $f$. Now, since there exists at least homogeneous component of $f$ that is not nilpotent, we may assume that $f$ is homogeneous, the result then follows from \cref{scheme Proj D_+(f) empty iff nilpotent}.
\end{proof}
For any subset $Y$ of $X=\Proj(S)$, we denote by $I_+(Y)$ the subset of $f\in S_+$ such that $Y\sub V_+(f)$, which is in other words $I(Y)\cap S_+$; the set $I_+(Y)$ is then a radical ideal of $S_+$.
\begin{proposition}\label{scheme Proj IV and VI char}
Let $E$ be a subset of $S$ and $Y$ be a subset of $X$.
\begin{enumerate}
\item[(a)] The ideal $I_+(V_+(E))$ is the radical in $S_+$ of the graded ideal of $S_+$ generated by $E$.
\item[(b)] The set $V_+(I_+(Y))$ is the closure of $Y$ in $X$.
\end{enumerate}
\end{proposition}
\begin{proof}
If $\mathfrak{I}$ is the graded ideal of $S_+$ generated by $E$, we have $V_+(E)=V_+(\mathfrak{I})$ and the first assertion follows from \cref{scheme Proj radical is intersection of V}. As for (b), since $V_+(\mathfrak{I})=\bigcap_{f\in\mathfrak{I}}V_+(f)$, the relation $Y\sub V_+(\mathfrak{I})$ implies $Y\sub V_+(f)$ for any $f\in\mathfrak{I}$, and therefore $I_+(Y)\sups\mathfrak{I}$, so $V_+(I_+(Y))\sub V_+(\mathfrak{I})$, which implies (b) by the definition of closure.
\end{proof}
\begin{corollary}\label{scheme Proj closed subset and radical ideal}
The closed subsets $Y$ of $X=\Proj(S)$ and the graded radical ideals of $S_+$ correspond bijectively via $Y\mapsto I_+(Y)$ and $\mathfrak{I}\mapsto V_+(\mathfrak{I})$. Also, the union $Y_1\cup Y_2$ of two closed subsets of $X$ corresponds to $I_+(Y_1)\cap I_+(Y_2)$, and the intersection of a family $(Y_\lambda)$ of closed subsets corresponds to the radical of the sum of $I_+(Y_\lambda)$.
\end{corollary}
\begin{corollary}\label{scheme Proj standard set cover iff generate}
Let $(f_\alpha)$ be a family of homogeneous elements of $S_+$ and $f$ be an element of $S_+$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $D_+(f)\sub\bigcup_\alpha D_+(f_\alpha)$;
\item[(\rmnum{2})] $V_+(f)\sups\bigcap_\alpha V_+(f_\alpha)$;
\item[(\rmnum{2})] a power of $f$ is contained in the ideal generated by the $f_\alpha$.  
\end{enumerate}
In particular, if $\mathfrak{I}$ is a graded ideal of $S_+$, then $V_+(\mathfrak{I})=\emp$ if and only if $\r_+(\mathfrak{I})=S_+$.
\end{corollary}
\begin{corollary}
For $X=\Proj(S)$ to be empty, it is necessary and sufficient that every element of $S_+$ is nilpotent.
\end{corollary}
\begin{corollary}\label{scheme Proj closed irre subset and prime ideal}
The closed irreducible subset of $X=\Proj(S)$ correspond to graded prime ideals of $S_+$.
\end{corollary}
\begin{proof}
In fact, if $Y=Y_1\cup Y_2$, where $Y_1,Y_2$ are closed and distinct in $Y$, then
\[I_+(Y)=I_+(Y_1)\cap I_+(Y_2)\]
the ideals $I_+(Y_1)$ and $I_+(Y_2)$ are distinct from $I_+(Y)$, so $I_+(Y)$ can not be prime. Conversely, if $\mathfrak{I}$ is a graded non-prime ideal of $S_+$, there exist elements $f,g$ of $S_+$ such that $fg\in\mathfrak{I}$ but $f,g\notin\mathfrak{I}$. Then $V_+(f)\nsubseteq V_+(\mathfrak{I})$, $V_+(g)\nsubseteq V_+(\mathfrak{I})$, but $V_+(\mathfrak{I})\sub V_+(f)\cup V_+(g)$. We then conclude that $V_+(\mathfrak{I})$ is the union of the closed subsets $V_+(f)\cap V_+(\mathfrak{I})$ and $V_+(g)\cap V_+(\mathfrak{I})$, both are distinct from $V_+(\mathfrak{I})$.
\end{proof}
We now define the scheme structure on the homogeneous specturm $\Proj(S)$. Let $f,g$ be two homogeneous elements of $S_+$ and consider the affine schemes $Y_f=\Spec(S_{(f)})$, $Y_g=\Spec(S_{(g)})$, and $Y_{fg}=\Spec(S_{(fg)})$. In view of \cref{graded ring localization of fg prop}, the morphism $w_{fg,f}:Y_{fg}\to Y_{f}$ corresponding to the canonical homomorphism $\omega_{fg,f}:S_{(f)}\to S_{(fg)}$, is an open immersion. By the homeomorphism $\psi_f:D_+(f)\to Y_f$ (\cref{scheme Proj standard open is affine}), we can transport to $D_+(f)$ the affine scheme structure of $Y_f$; in view of the commutative diagram (\ref{scheme Proj standard open inclusion diagram}), the affine scheme $D_+(fg)$ is identified with the subscheme induced over the open subset $D_+(fg)$ by the affine scheme $D_+(f)$. It is then clear that $X=\Proj(S)$ is endowed with a unique scheme structure such that each $D_+(f)$ is an affine open subscheme of $X$. When we speak of the homogeneous spectrum $\Proj(S)$ as a scheme, it will always be the structure defined in this way.
\begin{proposition}\label{scheme Proj is separated}
The scheme $\Proj(S)$ is separated.
\end{proposition}
\begin{proof}
By \cref{scheme separated over affine iff intersection of affine open cover}, it suffices to show that for any homogeneous elements $f,g$ of $S_+$, $D_+(f)\cap D_+(g)=D_+(fg)$ is affine and the canonical images of the rings of $D_+(f)$ and $D_+(g)$ in $D_+(fg)$ generate the ring of $D_+(fg)$. The first one is clear by definition, and the second one follows from \cref{graded ring localization of fg generated by f and g},
\end{proof}
\begin{example}
Let $S=K[T_1,T_2]$ where $K$ is a field and $T_1,T_2$ are indeterminates. Then it follows from \cref{scheme Proj standard set cover iff generate} that $\Proj(S)$ is the union of $D_+(T_1)$ and $D_+(T_2)$. We see that each of these affine subscheme is isomorphic to $K[T]$, and that $\Proj(S)$ is obtained by glueing these two schemes as described in \cref{scheme P^1 glueing construction}.
\end{example}
\begin{proposition}\label{scheme Proj reduced integral iff}
Let $S$ be a graded ring with positive degrees and $X=\Proj(S)$.
\begin{enumerate}
\item[(\rmnum{1})] If $\n_+$ is the nilradical of $S_+$, the scheme $X_{\red}$ is canonically isomorphic to $\Proj(S/\n_+)$. In particular, if $S$ is essentially reduced, then $\Proj(S)$ is reduced. 
\item[(\rmnum{2})] Suppose that $S$ is essentially reduced, then for $X$ to be integral, it is necessary and sufficient that $S$ is essentially integral.
\end{enumerate}
\end{proposition}
\begin{proof}
Let $\widebar{S}=S/\n_+$, and denote by $x\mapsto\bar{x}$ the canonical homomorphism $S\to\widebar{S}$, of degree $0$. For any $f\in S_d$ ($d>0$), the canonical homomorphism $S_f\to\widebar{S}$ is surjective and of degree $0$, hence restricts to a surjection $S_{(f)}\to\widebar{S}_{(\bar{f})}$. If we suppose that $f\notin\n_+$, then $\widebar{S}_{(\bar{f})}$ is reduced and the kenrel of the preceding homomorphism is the nilradical of $S_{(f)}$, whence $\widebar{S}_{(\bar{f})}=(S_{(f)})_{\red}$. This homomorphism then corresponds to a closed immersion $D_+(\bar{f})\to D_+(f)$ which identifies $D_+(\bar{f})$ with $(D_+(f))_{\red}$ (\cref{scheme reduced scheme structure given by nilradical}), and in particular is a homeomorphism of affine scheme. Further, if $g\notin\n_+$ is another homogeneous element of $S_+$, the diagram
\[\begin{tikzcd}
S_{(f)}\ar[d]\ar[r]&\widebar{S}_{(\bar{f})}\ar[d]\\
S_{(fg)}\ar[r]&\widebar{S}_{(\widebar{fg})}
\end{tikzcd}\]
is commutative. As the sets $D_+(f)$ for $f$ homogeneous in $S_+$ and $f\notin\n_+$ form a covering for $X=\Proj(S)$, we conclude that the morphisms $D_+(\bar{f})\to D_+(f)$ glue together to a closed immersion $\Proj(\widebar{S})\to\Proj(S)$ which is a homeomorphism on the underlying spaces, whence the conclusion of (\rmnum{1}) by \cref{scheme reduced scheme structure given by nilradical}.\par
Suppose now that $S$ is essentially integral, which means $(0)$ is a graded ideal of $S_+$ distinct from $S_+$. Then $X$ is reduced by (a) and irreducible by \cref{scheme Proj closed irre subset and prime ideal}. Conversely, if $S$ is essentially reduced and $X$ is integral, then for any $f\neq 0$ homogeneous in $S_+$, we have $D_+(f)\neq\emp$ by \cref{scheme Proj D_+(f) empty iff nilpotent}; the hypothesis that $X$ is irreducible implies that $D_+(f)\cap D_+(g)\neq\emp$ for any $f,g$ homogeneous and nonzero in $S_+$, so in particular $fg\neq 0$, and we then conclude that $S_+$ is integral. 
\end{proof}
\begin{proposition}\label{scheme Proj over a ring A}
Suppose that $S$ is a graded $A$-algebra where $A$ is a ring. Then over $X=\Proj(S)$ the structural sheaf $\mathscr{O}_X$ is an $A$-algebra, which means $X$ is a scheme over $\Spec(A)$.
\end{proposition}
\begin{proof}
It suffices to note that for any $f$ homogeneous in $S_+$, $S_{(f)}$ is an $A$-algebra and the homomorphism $S_{(f)}\to S_{(fg)}$ is an $A$-algebra homomorphism for any $f,g$ homogeneous in $S_+$.
\end{proof}
\begin{proposition}\label{scheme Proj unchanged if alter ring}
Let $S$ be a graded ring with positive degrees.
\begin{enumerate}
\item[(a)] For any integer $d>0$, there exists a canonical isomorphism $\Proj(S)\cong\Proj(S^{(d)})$.
\item[(b)] Let $S'$ be the graded ring such that $S_0'=\Z$ and $S'_n=S_n$ for $n>0$, then there exists a canonical isomorphism $\Proj(S)\cong\Proj(S')$.
\end{enumerate}
\end{proposition}
\begin{proof}
We have already seen in \cref{graded ring essential prime of A^(d)} that the map $\p\mapsto\p\cap S^{(d)}$ is a bijection from $\Proj(S)$ to $\Proj(S^{(d)})$. As for any $f$ homogeneous in $S_+$, we have $V_+(f)=V_+(f^d)$, this bijection is a homeomorphism of topological spaces. Finally, with the same notations, $S_{(f)}$ and $S_{(f^d)}$ are canonically identified by \cref{graded ring localization of fg prop}, so $\Proj(S)$ and $\Proj(S^{(d)})$ are canonically identified as schemes.\par
If to any $\p\in\Proj(S)$, we correspond the unique prime ideal $\p'\in\Proj(S')$ such that $\p'\cap S_n=\p\cap S_n$ for $n>0$, then it is clear that this defines a homeomorphism $\Proj(S)\cong\Proj(S')$ of the underlying spaces, since $V_+(f)$ is the same set for $S$ and $S'$ if $f$ is a homogeneous element of $S_+$. We also note that $S_{(f)}=S_{(f)}'$: to see this it suffices to note that if $x/1$ is an element of $S_{(f)}$ with $x\in S_0$, then $x/1=xf/f\in S'_{(f)}$; we then conclude that $\Proj(S)$ and $\Proj(S')$ are identified as schemes.
\end{proof}
\begin{corollary}
Let $S$ be a graded $A$-algebra and $S_A$ be the graded $A$-algebra such that $(S_A)_0=A$ and $(S_A)_n=S_n$ for $n>0$, then there exists a canonical isomorphism $\Proj(S)\cong\Proj(S_A)$.
\end{corollary}
\begin{proof}
In fact, these two schemes are isomorphic to $\Proj(S')$, where $S'_0=\Z$ and $S'_n=S_n$ for $n>0$, in view of \cref{scheme Proj unchanged if alter ring}.
\end{proof}
\subsection{Sheaf associated with a graded module}
Let $M$ be a graded $S$-module. For any homogeneous element $f$ of $S_+$, $M_{(f)}$ is an $S_{(f)}$-module, and it therefore corresponds to a quasi-coherent sheaf $\widetilde{M_{(f)}}$ over the affine $\Spec(S_{(f)})$, identified with $D_+(f)$.
\begin{proposition}\label{scheme Proj qcoh associated with module}
There existss a unique quasi-coherent $\mathscr{O}_X$-module $\widetilde{M}$ such that for any homogeneous element $f\in S_+$, we have $\Gamma(D_+(f),\widetilde{M})=M_{(f)}$, and the restriction homomorphism $\Gamma(D_+(f),\widetilde{M})\to\Gamma(D_+(fg),\widetilde{M})$ for $f,g$ homogeneous in $S_+$ corresponds to the canonical homomorphism $M_{(f)}\to M_{(fg)}$.
\end{proposition}
\begin{proof}
Suppose that $f\in S_d$, $g\in S_e$. As $D_+(fg)$ is identified with the prime specturm $(S_{(f)})_{g^d/f^e}$ by \cref{graded ring localization of fg prop}, the restriction of $\widetilde{M_{(f)}}$ to $D_+(fg)$ is canonically identified with the sheaf associated with the module $(M_{(f)})_{(g^d/f^e)}$, hence to $\widetilde{M_{(fg)}}$ (\cref{graded ring localization of fg prop}). We then conclude that there is a canonical isomorphism
\[\theta_{g,f}:\widetilde{M_{(f)}}|_{D_+(fg)}\to\widetilde{M_{(g)}}|_{D_+(fg)}\]
such that, if $g$ is another homogeneous element of $S_+$, we have $\theta_{f,h}=\theta_{f,g}\circ\theta_{g,h}$ over $D_+(fgh)$. By glueing, there then exists a quasi-coherent sheaf $\mathscr{F}$ over $X$ such that for any homogeneous element $f\in S_+$, we have an isomorphism $\eta_f:\mathscr{F}|_{D_+(f)}\cong\widetilde{M_{(f)}}$ and $\theta_{g,f}=\eta_g\circ\eta_f^{-1}$. Since over $D_+(f)$ we have $\Gamma(D_+(f),\widetilde{M})$, $\mathscr{F}$ can be identified with the sheaf extended from the presheaf $D_+(f)\mapsto M_{(f)}$ over the basis of standard open sets of $X$, whence the assertions of the proposition. In particular, we have $\widetilde{S}=\mathscr{O}_X$.
\end{proof}
We say the quasi-coherent $\mathscr{O}_X$-module $\widetilde{M}$ is \textbf{associted} with the graded $S$-module $M$. Recall that the graded $S$-modules form a category whose morphisms are graded homomorphisms of degrees. With this convention:
\begin{proposition}\label{scheme Proj qcoh associated functor exact}
The functor $\widetilde{M}$ is a covariant exact functor from the category of graded $S$-modules to the category of quasi-coherent $\mathscr{O}_X$-modules, which commutes with inductive limits and direct sums.
\end{proposition}
\begin{proof}
Since the properties are local, it suffices to verify over the sheaf $\widetilde{M}|_{D_+(f)}=\widetilde{M_{(f)}}$. Now the functor $M_f$ on $M$, the functor $N_0$ on $N$, and the functor $\widetilde{P}$ on $P$ all satisfy the stated properties, whence the claim.
\end{proof}
We denote by $\tilde{u}:\widetilde{M}\to\widetilde{N}$ the homomorphism corresponding to a graded homomorphism $u:M\to N$ of degree $0$. We also deduce from \cref{scheme Proj qcoh associated functor exact} that the results of \cref{scheme affine associated sheaf ker and coker} and \cref{scheme affine associated sheaf of submodule sum and inter} are also true for graded $S$-modules and homomorphism of degree $0$, via the same demonstration.
\begin{proposition}\label{scheme Proj qcoh stalk char}
For any $\p\in X=\Proj(S)$, we have $\widetilde{M}_\p=M_{(\p)}$.
\end{proposition}
\begin{proof}
By definition we have $\widetilde{M}_\p=\rlim\Gamma(D_+(f),\widetilde{M})$, where $f$ runs through homogeneous elements $f\in S_+$ such that $f\notin\p$. As $\Gamma(D_+(f),\widetilde{M})=M_{(f)}$, the proposition follows from the definition of $M_{(\p)}$.
\end{proof}
In particular, the local ring $\mathscr{O}_{X,\p}$ is just the ring $S_{(\p)}$, the set of elements $x/f$ where $f$ is homogeneous in $S_+$ and not contained in $\p$, and $x$ is homogeneous with the same degree as $f$. If moreover $S$ is essentially integral, then $\Proj(S)=X$ is integral (\cref{scheme Proj reduced integral iff}), and if $\xi=(0)$ is the generic point of $X$, the rational function field $K(X)=\mathscr{O}_{X,\xi}$, is the field formed by $f/g$ where $f,g$ are homogeneous elements of $S_+$ and $g\neq 0$.
\begin{proposition}\label{scheme Proj qcoh associated iff}
If, for any $z\in M$ and any homogeneous element $f\in S_+$, there exists a power of $f$ annihilating $z$, then $\widetilde{M}=0$. This condition is also necessary if $S=S_0[S_1]$.
\end{proposition}
\begin{proof}
The condition $\widetilde{M}=0$ is equivalent to $M_{(f)}=0$ for any homogeneous element of $S_+$. Now if $f\in S_d$, the condition $M_{(f)}=0$ signifies that for any $z\in M$ homogeneous whose degree is a multiple of $d$, there exists power $f^n$ such that $f^nz=0$; this implies the first claim. Conversely, if moreover $S$ is generated by $S_1$, then condition then implies that $f^nz=0$ for any $z\in M$ and any $f\in S_+$, since any element $f\in S_+$ is a finite linear combination of elements of $S_1$.
\end{proof}
\begin{proposition}\label{scheme Proj qcoh S(nd) local is O_X}
Let $f\in S_d$ with $d>0$. Then for any $n\in\Z$, the $(\mathscr{O}_X|_{D_+(f)})$-module $\widetilde{S(nd)}|_{D_+(f)}$ is canonically isomorphic to $\mathscr{O}_X|_{D_+(f)}$.
\end{proposition}
\begin{proof}
The multiplication by the invertible element $(f/1)^n$ of $S_f$ defines a bijection from $S_{(f)}=(S_f)_0$ to the ring 
\[(S_f)_{nd}=(S_f(nd))_0=(S(nd)_f)_0=S(nd)_{(f)},\]
whence the assertion.
\end{proof}
\begin{corollary}\label{scheme Proj qcoh S(nd) invertible over open}
Over the open subset $U=\bigcup_{f\in S_d}D_+(f)$, the restriction of the $\mathscr{O}_X$-module $\widetilde{S(nd)}$ is an invertible $(\mathscr{O}_X|_U)$-module.
\end{corollary}
\begin{corollary}\label{scheme Proj qcoh S(n) invertible if}
If the ideal $S_+$ of $S$ is generated by $S_1$, then the $\mathscr{O}_X$-module $\widetilde{S(n)}$ is invertible for any $n\in\Z$.
\end{corollary}
\begin{proof}
It suffices to note that under the hypothesis we have $X=\bigcup_{f\in S_1}D_+(f)$ by \cref{scheme Proj standard set cover iff generate}.
\end{proof}
The quasi-coherent $\mathscr{O}_X$-modules $\widetilde{S(n)}$ is of particular interest in the theory of projective schemes, so for each $n\in\Z$, we put $\mathscr{O}_X(n)=\widetilde{S(n)}$ and for an open subset $U$ of $X$ and any $(\mathscr{O}_X|_U)$-module $\mathscr{F}$, set
\[\mathscr{F}(n)=\mathscr{F}\otimes_{\mathscr{O}_X|_U}(\mathscr{O}_X(n)|_U).\]
If the ideal $S_+$ is generated by $S_1$, the functor $\mathscr{F}(n)$ is exact on $\mathscr{F}$ for any $n\in\Z$, since $\mathscr{O}_X(n)$ is then an invertible $\mathscr{O}_X$-module.
\begin{example}\label{scheme P^n twist sheaf global section char}
Let $k$ be a field and consider the graded algebra $S=k[x_0,\dots,x_n]$; let $X=\Proj(S)$. Let $d$ be an inter and consider the twist sheaf $\mathscr{O}_X(d)$. We compute the global sections for $\mathscr{O}_X(d)$: by definition, for each $x_i\in S$, the section of $\mathscr{O}_X(d)$ over $U_i=D_+(x_i)$ is given by
\[\Gamma(U_i,\mathscr{O}_X(d))=S(d)_{(x_i)}=(S_{(x_i)})_d=\{f/x_i^n:f\in S_{n+d}\}=\{x_i^df:f\in S^{(i)}\},\]
where $S^{(i)}=k[x_0/x_i,\dots,x_n/x_i]$. Therefore a section of $\mathscr{O}_X(d)$ is a family of rational polynomials $(f_i)$ with $f_i\in S^{(i)}$ such that $x_i^df_i=x_j^df_j$ for each $i\neq j$; let $f$ be this common rational polynomial. Then by construction, we have $f/x_i^d\in S^{(i)}$ for each $i$, which implies that $f$ is a polynomial in $S$ of degree $d$ when $d\geq 0$. If on the other hand $d<0$, then $f$ can only have poles at $x_i$ for each $i$, which is impossible, so there is no global sections for $\mathscr{O}_X(d)$ when $d<0$.
\end{example}
Let $M,N$ be graded $S$-modules. For any $f\in S_d$ we define a canonical homomorphism of $S_{(f)}$-modules
\[\lambda_f:M_{(f)}\otimes_{S_{(f)}}N_{(f)}\to (M\otimes_SN)_{(f)}\]
by composing the homomorphism $M_{(f)}\otimes_{S_{(f)}}N_{(f)}\to M_f\otimes_{S_f}N_f$ (induced from the canonical injections) with the canonical isomorphism $M_f\otimes_{S_f}N_f\cong(M\otimes_SN)_{(f)}$, and note that by the definition of the grading of tensor products, these isomorphisms preserve degrees. Unwinding the definitions, for $x\in M_{md}$, $y\in N_{nd}$, we have
\[\lambda_f((x/f^m)\otimes(y/f^n))=(x\otimes y)/f^{m+n}.\]
It then follows that, if $g\in S_e$ is another homogeneous element, the diagram
\[\begin{tikzcd}
M_{(f)}\otimes_{S_{(f)}}N_{(f)}\ar[d]\ar[r,"\lambda_f"]&(M\otimes_SN)_{(f)}\ar[d]\\
M_{(fg)}\otimes_{S_{(fg)}}N_{(fg)}\ar[r,"\lambda_{fg}"]&(M\otimes_SN)_{(fg)}
\end{tikzcd}\]
(wher the vertical homomorphism are canonical) is commutative. We then deduce that $\lambda$ is a canonical homomorphism of $\mathscr{O}_X$-modules
\[\lambda:\widetilde{M}\otimes_{\mathscr{O}_X}\widetilde{N}\to\widetilde{M\otimes_SN}.\]

Consider in particular two graded ideals $\mathfrak{I},\mathfrak{K}$ of $S$. As $\widetilde{\mathfrak{I}}$ and $\widetilde{\mathfrak{K}}$ are two quasi-coherent ideals of $\mathscr{O}_X$, we have a canonical homomorphism $\widetilde{\mathfrak{I}}\otimes_{\mathscr{O}_X}\widetilde{\mathfrak{K}}\to\mathscr{O}_X$, and the diagram
\begin{equation}\label{scheme Proj associated sheaf tensor commutativity-1}
\begin{tikzcd}
\widetilde{\mathfrak{I}}\otimes_{\mathscr{O}_X}\widetilde{\mathfrak{K}}\ar[rd]\ar[rr,"\lambda"]&&\widetilde{\mathfrak{I}\otimes_S\mathfrak{K}}\ar[ld]\\
&\mathscr{O}_X&
\end{tikzcd}
\end{equation}
is commutative. Finally, note that if $M,N,P$ are graded $S$-modules, the diagram
\begin{equation}\label{scheme Proj associated sheaf tensor commutativity-2}
\begin{tikzcd}
\widetilde{M}\otimes_{\mathscr{O}_X}\widetilde{N}\otimes_{\mathscr{O}_X}\widetilde{P}\ar[d,swap,"1\otimes\lambda"]\ar[r,"\lambda\otimes 1"]&\widetilde{M\otimes_SN}\otimes_{\mathscr{O}_X}\widetilde{P}\ar[d,"\lambda"]\\
\widetilde{M}\otimes_{\mathscr{O}_X}\widetilde{N\otimes_SP}\ar[r,"\lambda"]&(M\otimes_SN\otimes_SP)\widetilde{\hspace{3mm}}
\end{tikzcd}
\end{equation}
is commutative. Simialrly, we define a canonical homomorphism of $S_{(f)}$-modules
\[\mu_f:\Hom_S(M,N)_{(f)}\to\Hom_{S_{(f)}}(M_{(f)},N_{(f)})\]
which sends an element $u/f^n$, where $u$ is a homomorphism of degre $nd$, the homomorphism $M_{(f)}\to N_{(f)}$ which sends $x/f^m$ ($x\in M_{md}$) to $u(x)/f^{m+n}$. For $g\in S_e$, we have the following commutative diagram
\begin{equation}\label{scheme Proj associated sheaf Hom commutativity-1}   
\begin{tikzcd}
\Hom_S(M,N)_{(f)}\ar[d]\ar[r,"\mu_f"]&\Hom_{S_{(f)}}(M_{(f)},N_{(f)})\ar[d]\\
\Hom_S(M,N)_{(fg)}\ar[r,"\mu_{fg}"]&\Hom_{S_{(fg)}}(M_{(fg)},N_{(fg)})
\end{tikzcd}
\end{equation}
We then conclude that the $\mu_f$ define a canonical homomorphism
\[\mu:(\Hom_S(M,N))\widetilde{\hspace{3mm}}\to\sHom_{\mathscr{O}_X}(\widetilde{M},\widetilde{N}).\]
\begin{proposition}\label{scheme Proj associated tensor and Hom char}
Suppose that the ideal $S_+$ is generated by $S_1$. Then the homomorphism $\lambda$ is an isomorphism; this holds for $\mu$ if the graded $S$-module $M$ is of finite presentation.
\end{proposition}
\begin{proof}
As $X$ is the union of $D_+(f)$ for $f\in S_1$, we are reduced to prove tht $\lambda_f$ and $\mu_f$ are isomorphisms for $f$ homogeneous of degree $1$. We then define a $\Z$-linear map $M_n\times N_n\to M_{(f)}\otimes_{S_{(f)}}N_{(f)}$ that send a pair $(x,y)$ to the element $(x/f^m)\otimes(y/f^n)$. This then defines a $\Z$-linear map $M\otimes_{\Z}N\to M_{(f)}\otimes_{S_{(f)}}N_{(f)}$, and if $s\in S_q$, this map send $(sx)\otimes y$ to $(s/f^q)((x/f^m)\otimes(y/f^n))$ (where $x\in M_m$, $y\in N_n$), so we get a bi-homomorphism $\gamma_f:M\otimes_SN\to M_{(f)}\otimes_{S_{(f)}}N_{(f)}$ relative to the canonical homomorphism $S\to S_{(f)}$ (sending $s\in S_q$ to $s/f^q$). Suppose that for an element $\sum_i(x_i\otimes y_i)$ of $M\otimes_SN$ (where $x_i,y_i$ are homogeneous elements of degrees $m_i,n_i$, respectively) we have $f^r\sum_i(x_i\otimes y_i)=0$, which means $\sum_i(f^rx_i\otimes y_i)=0$. Then we deduce from the isomorphism $M_{f}\otimes_{S_f}N_{f}\cong(M\otimes_SN)_{f}$ that $\sum_i(f^rx^i/f^{m_i+r})\otimes(y_i/f^{n_i})=0$, which means $\gamma_i(\sum_i(x_i\otimes y_i))=0$. Therefore $\gamma_f$ factors through $(M\otimes_SN)_f$ and give a homomorphism $\tilde{\gamma}_f:(M\otimes_SN)_f\to M_{(f)}\otimes_{S_{(f)}}N_{(f)}$; if $\tilde{\lambda}_f$ is the restriction of $\tilde{\gamma}_f$ to $(M\otimes_SN)_{(f)}$, we then verify that $\lambda_f$ and $\tilde{\lambda}_f$ are inverses of each other, so the first assertion follows.\par
To demonstrate the second assertion, we now assume that $M$ is of finite presentation, so is the cokernel of a homomorphism $P\to Q$ of graded $S$-module, $P,Q$ being direct sums of finitely many modules of the form $S(n)$. By using the left exactness of $\Hom_S(-,N)$ and the exactness of $M_{(f)}$ on $M$, we are reduced to prove that $\mu_f$ is an isomorphism in the case $M=S(n)$. Now for any homogeneous $z\in N$, let $u_z$ be the homomorphism from $S(n)$ to $N$ such that $u_z(1)=z$; we then see that $\eta:z\mapsto u_z$ is an isomorphism of degree $0$ from $N(-n)$ to $\Hom_S(S(n),N)$. It thus corresponds to an isomorphism
\[\eta_f:N(-n)_{(f)}\to\Hom_S(S(n),N)_{(f)}.\]
On the other hand, let $\tilde{\eta}_f$ be the isomorphism $N_{(f)}\to\Hom_{S_{(f)}}(S(n)_{(f)},N_{(f)})$ which send $z'\in N_{(f)}$ to the homomorphism $v_{z'}$ such that $v_{z'}(s/f^k)=sz'/f^{n+k}$ (for $s\in S_{n+k}=S(n)_k$). We consider the composition
\[\begin{tikzcd}
N(-n)_{(f)}\ar[r,"\eta_f"]&\Hom_S(S(n),N)_{(f)}\ar[r,"\mu_f"]&\Hom_{S_{(f)}}(S(n)_{(f)},N_{(f)})\ar[r,"\tilde{\eta}_{f}^{-1}"]&N_{(f)}
\end{tikzcd}\]
is the isomorphism $z/f^h\mapsto z/f^{h-n}$ from $N(-n)_{(f)}\to N_{(f)}$, so $\mu_f$ is an isomorphism.
\end{proof}
If the ideal $S_+$ is generated by $S_1$, we deduce from \cref{scheme Proj associated tensor and Hom char} that for any graded ideal $\mathfrak{I}$ of $S$ and any graded $S$-module $M$, we have $\widetilde{\mathfrak{I}}\widetilde{M}=\widetilde{\mathfrak{I}M}$.
\begin{corollary}\label{scheme Proj twisted sheaf tensor prop}
Suppose that the ideal $S_+$ is generated by $S_1$. Then for integers $m,n$, we have canonical isomorphisms
\[\mathscr{O}_X(m)\otimes_{\mathscr{O}_X}\mathscr{O}_X(n)=\mathscr{O}_X(m+n),\quad \mathscr{O}_X(n)=(\mathscr{O}_X(1))^{\otimes n}.\]
\end{corollary}
\begin{proof}
The first formula follows from \cref{scheme Proj associated tensor and Hom char} and the existence of the canonical isomorphism $S(m)\otimes_SS(n)\cong S(m+n)$, which sends the element $1\otimes 1\in S(m)_{-m}\otimes S(n)_{-n}$ to the element $1\in S(m+n)_{-(m+n)}$. It then suffices to demonstrate the second formula for $n=-1$, and in view of \cref{scheme Proj associated tensor and Hom char}, this follows from the fact that $\Hom_S(S(1),S)$ is canonically isomorphic to $S(-1)$.
\end{proof}
\begin{corollary}\label{scheme Proj twisted qcoh prop}
Suppose that the ideal $S_+$ is generated by $S_1$. For any graded $S$-module $M$ and $n\in\Z$, we have a canonical isomorphism $\widetilde{M(n)}=\widetilde{M}(n)$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme Proj associated tensor and Hom char} and the canonical isomorphism $M(n)\cong M\otimes_SS(n)$ which send $z\in M(n)_h=M_{n+h}$ to $z\otimes 1\in M_{n+h}\otimes S(n)_{-n}\sub(M\otimes_SS(n))_h$.
\end{proof}
\begin{example}\label{scheme Proj S' and S^(d) twisted qcoh prop}
Let $S'$ be the graded ring such that $S'_0=\Z$ and $S'_n=S_n$ for $n>0$. Then if $f\in S_d$ ($d>0$), we have $S(n)_{(f)}=S'(n)_{(f)}$ for any $n\in\Z$, because an element of $S'(n)_{(f)}$ is of the form $x/f^k$ where $x\in S'_{n+kd}$ ($k>0$), and we can always choose $k$ such that $n+kd\neq 0$. As $X=\Proj(S)$ and $X'=\Proj(S')$ are canonically identified, we see that for any $n\in\Z$, $\mathscr{O}_X(n)$ and $\mathscr{O}_{X'}(n)$ are canonically isomorphic under this identification.\par
On the other hand, for any $d>0$ and $n\in\Z$, we have
\[S^{(d)}(n)_h=S_{(n+h)d}=S(nd)_{hd};\]
so for any $f\in S_d$ we have $S^{(d)}(n)_{(f)}=S(nd)_{(f)}$. We have seen that the schemes $X=\Proj(S)$ and $X^{(d)}=\Proj(S^{(d)})$ are canonically identified, so under this identification, $\mathscr{O}_X(nd)$ and $\mathscr{O}_{X^{(d)}}(n)$ are canonically isomorphic, for any $n\in\Z$.
\end{example}
\begin{proposition}\label{scheme Proj O(nd) duality is O(-nd)}
Let $d>0$ be an integer and $U=\bigcup_{f\in S_d}D_+(f)$. Then the restriction to $U$ of the canonical homomorphism $\mathscr{O}_X(nd)\otimes_{\mathscr{O}_X}\mathscr{O}_X(-nd)\to\mathscr{O}_X$ is an isomorphism for each $n\in\Z$.
\end{proposition}
\begin{proof}
In view of \cref{scheme Proj twisted qcoh prop}, we can assume that $d=1$, and the conclusion then follows the proof of \cref{scheme Proj qcoh S(nd) local is O_X}.
\end{proof}
\subsection{Graded \texorpdfstring{$S$}{S}-module associated with a sheaf}
In this paragraph, for simplicity, we always assume that the ideal $S_+$ is generated by $S_1$, which also means that $S=S_0[S_1]$ by \cref{graded ring generating set iff}. The $\mathscr{O}_X$-module $\mathscr{O}_X(1)$ is then inveritble by \cref{scheme Proj qcoh S(n) invertible if}; we then put, for any $\mathscr{O}_X$-module $\mathscr{F}$, that
\[\Gamma_*(\mathscr{F})=\Gamma_*(\mathscr{O}_X(1),\mathscr{F})=\bigoplus_{n\in\Z}\Gamma(X,\mathscr{F}(n))\]
Recall that $\Gamma_*(\mathscr{O}_X)$ is endowed with a graded ring structure and $\Gamma_*(\mathscr{F})$ is a graded module over $\Gamma_*(\mathscr{O}_X)$. Since $\mathscr{O}_X(n)$ is locally free, $\Gamma_*(\mathscr{F})$ is a covariant left-exact functor on $\mathscr{F}$; in particular, if $\mathscr{I}$ is a sheaf of ideals of $\mathscr{O}_X$, $\Gamma_*(\mathscr{F})$ is canonically a graded ideal of $\Gamma_*(\mathscr{O}_X)$.\par
Suppose that $M$ is a graded $S$-module. For any $f\in S_d$ with $d>0$, $x\mapsto x/1$ is a homomorphism of abelian groups $M_0\mapsto M_{(f)}$, and as $M_{(f)}$ is canonically identified with $\Gamma(D_+(f),\widetilde{M})$, we obtain a homomorphism $\alpha_0^f:M_0\to\Gamma(D_+(f),\widetilde{M})$ of abelian groups. It is clear that, for any $g\in S_e$ with $e>0$, the diagram
\[\begin{tikzcd}[row sep=8pt, column sep=8pt]
&\Gamma(D_+(f),\widetilde{M})\ar[dd]\\
M_0\ar[ru,"\alpha_0^f"]\ar[rd,swap,"\alpha_0^{fg}"]&\\
&\Gamma(D_+(fg),\widetilde{M})
\end{tikzcd}\]
is commutative, and this signifies that for any $x\in M_0$, the sections $\alpha_0^f(x)$ and $\alpha_0^{fg}(x)$ of $M$ coincide over $D_+(fg)$, and therefore there exists a unique section $\alpha_0(x)\in\Gamma(X,\widetilde{M})$ whose restriction on $D_+(f)$ is $\alpha_0^f(x)$. We then define (under the hypothesis that $S_+$ is generated by $S_1$) a homomorphism
\[\alpha_0:M_0\to\Gamma(X,\widetilde{M}).\]
By applying this result on each graded $S$-module $M(n)$ (where $n\in\Z$), we then obtain homomorphisms of abelian groups
\[\alpha_n:M_n=M(n)_0\to\Gamma(X,\widetilde{M}(n))\]
and therefore a homomorphism of graded abelian groups
\[\alpha:M\to\Gamma_*(\widetilde{M})\]
(also denoted by $\alpha_M$) such that $\alpha_M$ coincides with $\alpha_n$ on each $M_n$.\par
If we consider in particular $M=S$, then it is easy to see that (by the definition of the multiplication of $\Gamma_*(\mathscr{O}_X)$) $\alpha:S\to\Gamma_*(\mathscr{O}_X)$ is a homomorphism of graded rings, therefore, for any $S$-module $M$, $\alpha$ is a bi-homomorphism of graded modules.
\begin{proposition}\label{scheme Proj D_+(f) nonzero lucus char}
For any $f\in S_d$ with $d>0$, $D_+(f)$ is identified with the subset of $\p\in X$ such that the section $\alpha_d(f)$ of $\mathscr{O}_X(d)$ is nonzero at $\p$.
\end{proposition}
\begin{proof}
As $X=\bigcup_{g\in S_1}D_+(g)$, it suffices to prove that for any $g\in S_d$, the set $\p\in D_+(g)$ where $\alpha_d(f)$ is nonzero is identified with $D_+(fg)$. Now the restriction of $\alpha_d(f)$ to $D_+(g)$ is by defnition the section corresponding to the element $f/1$ of $S(d)_{(g)}$; by the canonical isomorphism $S(d)_{(g)}\cong S_{(g)}$, this section of $\mathscr{O}_X(d)$ over $D_+(g)$ is identified with the section of $\mathscr{O}_X$ over $D_+(g)$ corresponding to the element $f/g^d$ of $S_{(g)}$. To see that this section is zero on $\p\in D_+(g)$ then signifies that $f/g^d\in\q$, where $\q$ is the prime ideal of $S_{(g)}$ corresponding to $\p$; by definition this means $f\in\p$, whence the proposition.
\end{proof}
Now let $\mathscr{F}$ be an $\mathscr{O}_X$-module and put $M=\Gamma_*(\mathscr{F})$. In view of the homomorphism $\alpha:S\to\Gamma_*(\mathscr{O}_X)$ of graded rings, $M$ can also be considered as a graded $S$-module. For any $f\in S_d$ ($d>0$), it follows from \cref{scheme Proj D_+(f) nonzero lucus char} that the restriction of the section $\alpha_d(f)$ of $\mathscr{O}_X(d)$ to $D_+(f)$ is invertible, and so is the restriction to $D_+(f)$ of $\alpha_d(f^n)$ for any $n>0$. Let $z\in M_{nd}=\Gamma(X,\mathscr{F}(nd))$, if there existss an integer $k\geq 0$ such that the restriction to $D_+(f)$ of $f^kz$, which is the section $(\alpha_d(f^k)z)|_{D_+(f)}$ of $\mathscr{F}((n+k)d)$, is zero, then we conclude that $z|_{D_+(f)}=0$. This shows that we can define an $S_{(f)}$-homomorphism $\beta_f:M_{(f)}\to\Gamma(D_+(f),\mathscr{F})$ which corresponds the element $z/f^n\in M_{(f)}$ the section $(z|_{D_+(f)})(\alpha_d(f^n)|_{D_+(f)})^{-1}$ of $\mathscr{F}$ over $D_+(f)$. We also verify that for $g\in S_e$ ($e>0$), the diagram
\[\begin{tikzcd}
M_{(f)}\ar[d]\ar[r,"\beta_f"]&\Gamma(D_+(f),\mathscr{F})\ar[d]\\
M_{(fg)}\ar[r,"\beta_{fg}"]&\Gamma(D_+(fg),\mathscr{F})
\end{tikzcd}\]
is commutative. Since $M_{(f)}$ is canonically identified with $\Gamma(D_+(f),\widetilde{M})$ and the $D_+(f)$ form a basis for the topological space $X$, the homomorphisms $\beta_f$ glue together to a unique canonical homomorphism of $\mathscr{O}_X$-modules
\[\beta:\widetilde{\Gamma_*(\mathscr{F})}\to\mathscr{F}\]
(also denoted by $\beta_{\mathscr{F}}$) which is evidently functorial.
\begin{proposition}\label{scheme Proj associated module alpha and beta prop}
Let $M$ be a graded $S$-module and $\mathscr{F}$ be an $\mathscr{O}_X$-module. Then the composition homomorphisms
\begin{gather}
\widetilde{M}\stackrel{\tilde{\alpha}}{\to}(\Gamma_*(\widetilde{M}))\widetilde{\hspace{3mm}}\stackrel{\beta}{\to}\widetilde{M}\label{scheme Proj associated module functor prop-1}\\
\Gamma_*(\mathscr{F})\stackrel{\alpha}{\to}\Gamma_*(\widetilde{\Gamma_*(\mathscr{F})})\stackrel{\Gamma_*(\beta)}{\to}\Gamma_*(\mathscr{F})\label{scheme Proj associated module functor prop-2}
\end{gather}
are isomorphisms.
\end{proposition}
\begin{proof}
The verification of (\ref{scheme Proj associated module functor prop-1}) is local: on an open subset $D_+(f)$, this result follows from the definition and the fact that the action of $\beta$ is determined by its action of sections over $D_+(f)$ (\cref{scheme affine associated sheaf Hom bijection}). The verification of (\ref{scheme Proj associated module functor prop-2}) can be done at each degree: if we put $M=\Gamma_*(\mathscr{F})$, we have $M_n=\Gamma(X,\mathscr{F}(n))$ and $\Gamma_*(\widetilde{M})_n=\Gamma(X,\widetilde{M}(n))=\Gamma(X,\widetilde{M(n)})$. If $f\in S_1$ and $z\in M_n$, $\alpha_n^f(z)$ is the element $z/1$ of $M(n)_{(f)}$, and equals to $(f/1)^n(z/f^n)$; it then corresponds by $\beta_f$ to the section
\[(\alpha_1(f)^n|_{D_+(f)})(z|_{D_+(f)})(\alpha_1(f)^n|_{D_+(f)})^{-1}\]
over $D_+(f)$, which is the restriction of $z$ to $D_+(f)$. 
\end{proof}
In general, the homomorphisms $\alpha$ and $\beta$ are not isomorphisms (for example, a graded $S$-module $M$ can be nonzero with $\widetilde{M}$ being zero). To obtain some nice results about these two homomorphisms, we need to impose further conditions on the graded ring $S$ and the graded $S$-module $M$.
\begin{proposition}\label{scheme Proj Noe and ft if}
Let $S$ be a graded ring and $A$ be a ring.
\begin{enumerate}
\item[(a)] If $S$ is Noetherian, then $X=\Proj(S)$ is a Noetherian scheme.
\item[(b)] If $S$ is a graded $A$-algebra of finite type, then $X=\Proj(S)$ is a scheme of finite type over $Y=\Spec(A)$. 
\end{enumerate}
\end{proposition}
\begin{proof}
If $S$ is Noetherian, the ideal $S_+$ is generated by finitely many homogeneous elements $(f_i)_{1\leq i\leq p}$, so the space $X$ is the union of $D_+(f_i)=\Spec(S_{(f_i)})$, and since each $S_{(f_i)}$ is Noetherian by \cref{graded ring Noe S_(f) is Noe}, we see $X$ is Noetherian.\par
Now assume that $S$ is an $A$-algebra of finite type, then $S_0$ is an $A$-algebra of finite type and $S$ is an $S_0$-algebra of finite type, so $S_+$ is a finitely generated ideal by \cref{graded ring finitely generated criterion}. We are then reduced to prove as in (a) that for any $f\in S_d$, $S_{(f)}$ is an $A$-algebra of finite type. In view of \cref{graded ring S_(f) isomorphic to quotient by f-1}, it suffices to show that $S^{(d)}$ is an $A$-algebra of finite type, which follows from \cref{graded ring finiteness of alter ring}.
\end{proof}
Let $M$ be a graded $S$-module. We say $M$ is \textbf{eventually null} if there exists an integer $n$ such that $M_i=0$ for $i\neq n$, and is \textbf{eventually finite} if there exists an integer $n$ such that $\bigoplus_{i\geq n}M_i$ is a finitely generated $S$-module, or equivalently, that there exists a finitely generated graded sub-$S$-module $M'$ of $M$ such that $M/M'$ is eventually null. We also note that if $M$ is eventually null, then $M_{(f)}=0$ for any homogeneous element $f$ in $S_+$, so $\widetilde{M}=0$.\par
Let $M,N$ be two graded $S$-modules. We say a homomorphism $u:M\to N$ of degree $0$ is \textbf{eventually injective} (resp. \textbf{eventually surjective}, \textbf{eventually bijective}) if there exists an integer $n$ such that $u_i:M_i\to N_i$ is injective (resp. surjective, bijective) for $i\geq n$. Equivalently, the homomorphism $u$ is eventually injective (resp. eventually surjective) if and only if $\ker u$ (resp. $\coker u$) is eventually null. If $u$ is eventually bijective, we say it is an \textbf{eventual isomorphism}.
\begin{proposition}\label{scheme Proj qc associated ft zero iff}
Let $S$ be a graded ring such that $S_+$ is finitely generated and $M$ be a graded $S$-module.
\begin{enumerate}
\item[(a)] If $M$ is eventually finite, the $\mathscr{O}_X$-module $\widetilde{M}$ is of finite type.
\item[(b)] Suppose that $M$ is eventually finite, then for $\widetilde{M}=0$, it is necessary and sufficient that $M$ is eventually null.
\end{enumerate}
\end{proposition}
\begin{proof}
If $M_n=0$ for $n\geq n_0$ then $M_{(f)}=0$ for any homogeneous element $f\in S_+$, so if $M$ is eventually null, then $\widetilde{M}=0$. On the other hand, if $M$ is eventually finite, then for $n\gg 0$ the graded submodule $M'=\bigoplus_{k\geq n}M_k$ is finitely generated by hypothesis, and $M/M'$ is eventually null, so $(\widetilde{M/M'})=0$ and therefore $\widetilde{M}=\widetilde{M}'$ by the exactness of the functor $\widetilde{M}$ (\cref{scheme Proj qcoh associated functor exact}). Therefore, to prove that $\widetilde{M}$ is of finite type, we may assume that $M$ is finitely generated. Now since this question is local, we only need to show that $M_{(f)}$ is finitely genrated over $S_{(f)}$ for any homogeneous $f\in S_d$ with $d>0$. But $M^{(d)}$ is a finitely generated $S^{(d)}$ module by \cref{graded ring finiteness of alter ring}, and the assertion follows from \cref{graded ring S_(f) isomorphic to quotient by f-1}.\par
Suppose now that $M$ is eventually finite and $\widetilde{M}=0$; then we have $\widetilde{M}'=0$, so the condition that $M'$ is eventually null is equivalent to that of $M$. We may therefore assume that $M$ is finitely generated over $S$ by homogeneous elements $x_i$ ($1\leq i\leq p$); let $(f_j)_{1\leq j\leq q}$ be a system of generators of the ideal $S_+$. We have by hypothesis $M_{(f_j)}=0$ for any $j$, so there exists an integer $n$ such that $f_j^nx_i=0$ for any $i,j$. Let $n_j=\deg(f_j)$ and $m$ be the supremum of $\sum_jr_jn_j$ for any finite system of integers $(r_j)$ such that $\sum_jr_j\leq nq$. It is then clear that if $k>m$, we have $S_kx_i=0$ for any $i$; if $d$ is the supremum of the degrees of $x_i$, we then conclude that $M_k=0$ for $k>d+m$, which proves our assertion.
\end{proof}
\begin{corollary}\label{scheme Proj qc zero iff eventually null}
Let $S$ be a graded ring such that $S_+$ is finitely generated. For $X=\Proj(S)=\emp$, it is necessary and sufficient that $S$ is eventually null.
\end{corollary}
\begin{proof}
The condition $X=\emp$ is in fact equivalent to $\mathscr{O}_X=\widetilde{S}=0$, and $S$ is clearly a finite generated $S$-module.
\end{proof}
\begin{example}\label{Proj associated sheaf zero non eventually null eg-1}
To give a counterexample of \cref{scheme Proj qc associated ft zero iff}, let $k$ be a field and $S=k[X_1,\dots,X_n]$ be the polynomial ring with $n$ variables. Consider the graded $S$-module $M$ given by
\[M=k[X_1,X_2,\dots,X_n,\dots]/(X_1,X_2^2,\dots,X_n^n,\dots)\]
with the usual multiplication of polynomials. Then $M$ is not finitely generated over $S$, and for every homogeneous polynomial $f$ of degree $1$, we see $f^NM=0$ for sufficiently large $N$. Therefore $\widetilde{M}=0$. However, note that $M_n\neq 0$ for every $n$. 
\end{example}
\begin{theorem}\label{scheme Proj qc beta isomorphism}
Suppose that $S$ is a graded ring such that the ideal $S_+$ is finitely generated by $S_1$, and let $X=\Proj(S)$. Then, for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphisms $\beta:\widetilde{\Gamma_*(\mathscr{F})}\to\mathscr{F}$ is an isomorphism.
\end{theorem}
\begin{proof}
If $S_+$ is generated by finitely many $f_i\in S_1$, then $X$ is the union of $\Spec(S_{(f_i)})$ which are quasi-compact, so $X$ is quasi-compact. Also, $\mathscr{O}_X(n)$ is invertible for any $n\in\Z$ by \cref{scheme Proj twisted sheaf tensor prop}, and since $X$ is separated, by \cref{scheme qcqs section of qcoh over X_s char} and \cref{scheme Proj D_+(f) nonzero lucus char}, we have for any $f\in S_d$ a canonical isomorphism $\Gamma_*(\mathscr{F})_{(\alpha_d(f))}\cong\Gamma(D_+(f),\mathscr{F})$ (the first module (considered as a $\Gamma_*(\mathscr{O}_X)$-module) is none other than $\Gamma_*(\mathscr{F})_{(f)}$ (considered as an $S$-module)). If we trace the definition of this isomorphism, we see that it coincides with $\beta_f$, whence our assertion.
\end{proof}
\begin{corollary}\label{scheme Proj qcoh iso associated ft}
Under the hypotheses of \cref{scheme Proj qc beta isomorphism}, any quasi-coherent $\mathscr{O}_X$-module (of finite type) is isomorphic to an $\mathscr{O}_X$-module of the form $\widetilde{M}$, where $M$ is a (finitely generated) graded $S$-module.
\end{corollary}
\begin{proof}
Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module, then $\mathscr{F}=\widetilde{M}$ for a graded $S$-module $M$ by \cref{scheme Proj qc beta isomorphism}. Let $(f_\lambda)_{\lambda\in I}$ be a system of homogeneous generators of $M$; for each finite subset $H$ of $I$, let $M_H$ be the graded submodule of $M$ generated by $f_\lambda$ for $\lambda\in H$. It is clear that $M$ is the inductive limit of the submodules $M_H$, so $\mathscr{F}$ is the inductive limit of the sub-$\mathscr{O}_X$-modules $\widetilde{M}_H$ (\cref{scheme Proj qcoh associated functor exact}). If $\mathscr{F}$ is of finite type, we conclude from \cref{sheaf of module ft over qc surjective homomorphism prop}.
\end{proof}
\begin{corollary}\label{scheme Proj qcoh iso to quotient of O_X^r}
Under the hypotheses of \cref{scheme Proj qc beta isomorphism}, for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type, there exists an integer $n_0$ such that for any $n\geq n_0$, $\mathscr{F}(n)$ is isomorphic to a quotient of $\mathscr{O}_X^r$ (where $r>0$ depends on $n$), and therefore is generated by finitely many global sections.
\end{corollary}
\begin{proof}
By \cref{scheme Proj qcoh iso associated ft}, we can assume that $\mathscr{F}=\widetilde{M}$ where $M$ is a quotient of a finite dierct sum of $S(m_i)$. By \cref{scheme Proj qcoh associated functor exact}, we are therefore reduced to the case where $M=S(m)$, so $\mathscr{F}(n)=(S(m+n))\widetilde{\hspace{3mm}}=\mathscr{O}_X(m+n)$. It then suffices to prove that for each $n\geq 0$ there exists $r$ and a surjective homomorphism $\mathscr{O}_X^r\to\mathscr{O}_X(n)$. For this, it suffcies to prove that, for a suitable $r$, there exists an eventually surjective homomorphism $u:S^r\to S(n)$ of degree zero. Now we have $S(n)_0=S_n$, and by hypothesis $S_h=S_1^h$ for any $h>0$, so $SS_n=\bigoplus_{h\geq n}S_h$. As $S_n$ is a finitely generated $S_0$-module (\cref{graded ring finitely generated criterion}), consider a system $(a_i)_{1\leq i\leq r}$ of generators of this module, and let $u:S^r\to S(n)$ be the homomorphism that sends the $i$-th basis $e_i$ of $S^r$ to $a_i$. Then the image of $u$ contains $\bigoplus_{h\geq 0}S(n)_h$, so $u$ satisfies the requirement and the proof is complete.
\end{proof}
\begin{corollary}\label{scheme Proj qcoh iso to quotient of O_X(-n)^r}
Under the hypotheses of \cref{scheme Proj qc beta isomorphism}, for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type, there exists an integer $n_0$ such that for any $n\geq n_0$, $\mathscr{F}$ is isomorphic to a quotient of an $\mathscr{O}_X$-module of the form $\mathscr{O}_X(-n)^r$ (where $r>0$ depends on $n$).
\end{corollary}
\begin{proof}
This follows from \cref{scheme Proj qcoh iso to quotient of O_X^r} by tensoring with the invertible sheaf $\mathscr{O}_X(-n)$, which preserves the exactness.
\end{proof}
\begin{proposition}\label{scheme Proj qc alpha assocaited isomorphism}
Assume the hypotheses of \cref{scheme Proj qc beta isomorphism} and let $M$ be a graded $S$-module.
\begin{enumerate}
\item[(a)] The cannical homomorphism $\tilde{\alpha}:\widetilde{M}\to(\Gamma_*(\widetilde{M}))\widetilde{\hspace{3mm}}$ is an isomorphism.
\item[(b)] Let $\mathscr{G}$ be a quasi-coherent sub-$\mathscr{O}_X$-module of $\widetilde{M}$ and let $N$ be the graded sub-$S$-module of $M$ which is the inverse image of $\Gamma_*(\mathscr{G})$ under $\alpha$. Then we have $\widetilde{N}=\mathscr{G}$.
\end{enumerate}
\end{proposition}
\begin{proof}
As $\beta:(\Gamma_*(\widetilde{M}))\widetilde{\hspace{3mm}}\to\widetilde{M}$ is an isomorphism, $\tilde{\alpha}$ is its inverse isomorphism in view of (\ref{scheme Proj associated module functor prop-1}), whence (a). Let $P$ be the graded submodule $\alpha(M)$ of $\Gamma_*(\widetilde{M})$; as $\widetilde{M}$ is an exact functor, the image of $\widetilde{M}$ under $\tilde{\alpha}$ is equal to $\widetilde{P}$, so in view of (a), $\widetilde{P}=(\Gamma_*(\widetilde{M}))\widetilde{\hspace{3mm}}$. Put $Q=\Gamma_*(\mathscr{G})\cap P$, so that $N=\alpha^{-1}(Q)$. Then by the preceding argument and \cref{scheme Proj qcoh associated functor exact}, the image of $\widetilde{N}$ under $\tilde{\alpha}$ is $\widetilde{Q}$, and we have $\widetilde{Q}=\widetilde{\Gamma_*(\mathscr{G})}$. Since the image of $\widetilde{\Gamma_*(\mathscr{G})}$ under $\beta$ is $\mathscr{G}$ and $\tilde{\alpha}$ is the inverse of $\beta$, we conclude that $\widetilde{N}=\mathscr{G}$.
\end{proof}
\subsection{Functorial properties of \texorpdfstring{$\Proj(S)$}{Proj}}
Let $S,S'$ be two graded rings with positive degree and $\varphi:S'\to S$ be a homomorphisms of graded rings. We denote by $G(\varphi)$ the open subset of $X=\Proj(S)$ which is the complement of $V_+(\varphi(S'_+))$, or, the union of $D_+(\varphi(f'))$ where $f'$ runs through homogeneous elements of $S'_+$. The restriction to $G(\varphi)$ of the continuous map $^{a}\!\varphi:\Spec(S')\to\Spec(S)$ is then a continuous map from $G(\varphi)$ to $\Proj(S')$, which is still denoted by $^{a}\!\varphi$. If $f'\in S_+'$ is homogeneous, we have
\begin{align}\label{scheme Proj induced morphism standard open inverse image}
^{a}\!\varphi^{-1}(D_+(f'))=D_+(\varphi(f'))
\end{align}
since $^{a}\!\varphi$ maps $G(\varphi)$ into $\Proj(S')$. On the other hand, the homomorphism $\varphi$ defines canonically a homomorphism of graded rings $S'_{f'}\to S_f$ of degree $0$ (where $f=\varphi(f')$), whence a homomorphism $S'_{(f')}\to S_{(f)}$, which we denote by $\varphi_{(f)}$. It then corresponds to a morphism $({^{a}\!\varphi_{(f)}},\tilde{\varphi}_{(f)}):\Spec(S_{(f)})\to\Spec(S'_{(f')})$ of affine schemes. If we identify $\Spec(S_{(f)})$ with the open subscheme $D_+(f)$ of $\Proj(S)$, we then obtain a morphism $\Phi_f:D_+(f)\to D_+(f')$ and $^{a}\!\varphi_{(f)}$ is identified with the restriction of $^{a}\!\varphi$ to $D_+(f)$. If $g'$ is another homogeneous element of $S'_+$ and $g=\varphi(g')$, it is immediate that the diagram
\[\begin{tikzcd}
D_+(fg)\ar[d]\ar[r,"\Phi_{fg}"]&D_+(f'g')\ar[d]\\
D_+(f)\ar[r,"\Phi_f"]&D_+(f')
\end{tikzcd}\]
is commutative.
\begin{proposition}\label{scheme Proj morphism associated with ring homomorphism}
Let $\varphi:S'\to S$ be a homomorphism of graded rings. There exists a unique morphism $({^{a}\!\varphi},\tilde{\varphi}):G(\varphi)\to\Proj(S')$ (called the morphism associated with $\varphi$ and denoted by $\Proj(\varphi)$), such that for any homogeneous element $f'\in S'_+$, the restriction of this morphism to $D_+(\varphi(f'))$ coincides with the morphism associated with the homomorphism $\varphi_{(f)}:S'_{(f')}\to S_{(\varphi(f'))}$.
\end{proposition}
\begin{proof}
The morphism $({^{a}\!\varphi},\tilde{\varphi})$ is obtained form glueing the morphisms $\Phi_f$ over $D_+(f)$, and the claim property is immediate.
\end{proof}
\begin{corollary}\label{scheme Proj morphism associated prop}
Let $\varphi:S'\to S$ be a homomorphism of graded rings.
\begin{enumerate}
\item[(a)] The morphism $\Proj(\varphi)$ is affine.
\item[(b)] If $\ker\varphi$ is nilpotent (and in particular if $\varphi$ is injective), the morphism $\Proj(\varphi)$ is dominant.
\item[(c)] If $\varphi$ is eventually surjective, then $G(\varphi)=\Proj(S)$. 
\end{enumerate}
\end{corollary}
\begin{proof}
The first assertion follows from \cref{scheme Proj morphism associated prop} and the relation $^{a}\!\varphi^{-1}(D_+(f'))=D_+(\varphi(f'))$. On the other hand, if $\ker\varphi$ is nilpotent, for any $f'$ homogeneous in $S'_+$, we verify that $\ker\varphi_f$ is also nilpotent, and so is $\ker\varphi_{(f)}$. The conclusion then follows from \cref{Spec of ring map dominant iff ker nilpotent}. Finally, if $\varphi$ is eventually surjective, then every homogeneous element $f\in S_+$ has some power contained in the image of $\varphi$, so by \cref{scheme Proj standard set cover iff generate} we conclude that $G(\varphi)=\bigcup_{f'\in S'_+}D_+(\varphi(f'))=\Proj(S)$, whence the claim.
\end{proof}
\begin{remark}
Note that there are in general morphisms from $\Proj(S)$ to $\Proj(S')$ which are not affine, and therefore do not come from graded ring homomorphisms $S'\to S$; an example is the structural morphism $\Proj(S)\to\Spec(A)$, where $A$ is field ($\Spec(A)$ being identified with $\Proj(A[T])$ (cf. \cref{scheme Proj of qcoh polynomial algebra})).
\end{remark}
Let $\varphi':S''\to S'$ be another homomorphism of graded rings, and put $\varphi''=\varphi\circ\varphi'$. Then by the formula ${^{a}\!\varphi''}={^{a}\!\varphi'}\circ{^{a}\!\varphi}$ and $G(\varphi'')\sub G(\varphi)$, if $\Phi$, $\Phi'$, and $\Phi''$ are the associated morphisms of $\varphi,\varphi'$ and $\varphi''$, we have $\Phi''=\Phi'\circ(\Phi|_{G(\varphi'')})$.\par
Suppose that $S$ (resp. $S'$) is a graded $A$-algebra (resp. a graded $A'$-algebra), and let $\psi:A'\to A$ be a homomorphism of rings such that the diagram
\[\begin{tikzcd}
A'\ar[d]\ar[r,"\psi"]&A\ar[d]\\
S'\ar[r,"\varphi"]&S
\end{tikzcd}\]
is commutative. We can then consider $G(\varphi)$ and $\Proj(S')$ as schemes over $\Spec(A)$ and $\Spec(A')$, respectively. If $\Phi$ and $\Psi$ are the associated morphisms of $\varphi$ and $\psi$, respectively, the diagram
\[\begin{tikzcd}
G(\varphi)\ar[d]\ar[r,"\Phi"]&\Proj(S')\ar[d]\\
\Spec(A)\ar[r,"\Psi"]&\Spec(A')
\end{tikzcd}\]
is commutative.\par
Now let $M$ be a graded $S$-module and consider the $S'$-module $\varphi^*(M)$, which is clearly graded. Let $f'$ be a homogeneous element in $S'_+$, and set $f=\varphi(f')$. We then have a canonical isomorphism $(\varphi^*(M))_{f'}\cong\varphi_f^*(M_f)$, and it is clear that this isomorphism preserves degrees, so induces an isomorphism $(\varphi^*(M))_{(f')}\cong\varphi_{(f)}^*(M_{(f)})$. There is then canonically an isomorphism of sheaves $\widetilde{\varphi^*(M)}|_{D_+(f')}\cong(\Phi_f)_*(\widetilde{M}|_{D_+(f)})$ (\cref{scheme affine associated sheaf direct image char}). Moreover, if $g'$ is another homogeneous element of $S'_+$ and $g=\varphi(g')$, the diagram
\[\begin{tikzcd}
(\varphi^*(M))_{(f')}\ar[d]\ar[r,"\sim"]&(M_{(f)})_{(\varphi_{(f)})}\ar[d]\\
(\varphi^*(M))_{(f'g')}\ar[r,"\sim"]&(M_{(fg)})_{(\varphi_{(fg)})}
\end{tikzcd}\]
is commutative, whence we conclude that the isomorphism
\[\widetilde{\varphi^*(M)}|_{D_+(f'g')}\cong(\Phi_{fg})_*(\widetilde{M}|_{D_+(fg)})\]
is the restriction to $D_+(f'g')$ of the isomorphism $\widetilde{\varphi^*(M)}|_{D_+(f')}\cong(\Phi_f)_*(\widetilde{M}|_{D_+(f)})$. As $\Phi_f$ is the restriction of $\Phi$ on $D_+(f)$, we then obtain the following result:
\begin{proposition}\label{scheme Proj associated sheaf direct image char}
There exists a canonical isomorphism $\widetilde{\varphi^*(M)}\cong\Phi_*(\widetilde{M}|_{G(\varphi)})$ of $\mathscr{O}_X$-modules.
\end{proposition}
We also deduce a canonical functorial map from the set of $\varphi$-homomorphisms $M'\to M$ from a graded $S'$-module to a graded $S$-module $M$, to the set of $\Phi$-morphisms $\widetilde{M}'\to\widetilde{M}|_{G(\varphi)}$. If $\varphi':S''\to S'$ is another ring homomorphism and $M''$ is a graded $S''$-module, the composition of a $\varphi$-morphism $M'\to M$ and a $\varphi'$-morphism $M''\to M'$ canonically corresponds to the composition of $\widetilde{M}'|_{G(\varphi')}\to\widetilde{M}|_{G(\varphi'')}$ and $\widetilde{M}''\to\widetilde{M}'|_{G(\varphi')}$.
\begin{proposition}\label{scheme Proj associated sheaf inverse image char}
Let $\varphi:S'\to S$ be a homomorphism of graded rings and $M'$ be a graded $S'$-module. Then there exists a canonical homomorphism $\nu:\Phi^*(\widetilde{M}')\to\widetilde{\varphi_*(M)}|_{G(\varphi)}$. If the ideal $S'_+$ is generated by $S'_1$, then $\nu$ is an isomorphism.
\end{proposition}
\begin{proof}
For $f'\in S'_d$ with $d>0$, we define a canonical homomorphism of $S_{(f)}$-modules (where $f=\varphi(f')$)
\[\nu_f:M'_{(f)}\otimes_{S'_{(f)}}S_{(f)}\to(M'\otimes_{S'}S)_{(f)}\]
by composing the homomorphism $M'_{(f)}\otimes_{S'_{(f)}}S_{(f)}\to M_{f'}\otimes_{S'_{f'}}S_f$ with the canonical homomorphism $M'_{f'}\otimes_{S'_{f'}}S_f\cong(M'\otimes_{S'}S)_f$. It is immediate to verify that compatibility of $\nu_f$ with the restriction homomorphisms $D_+(f)$ to $_+(fg)$ (for $g'\in S'_+$ and $g=\varphi(g')$), so we obtain a homomorphism
\[\nu:\Phi^*(\widetilde{M}')\to \widetilde{\varphi_*(M)}|_{G(\varphi)}.\]
For the second assertion, it suffices to prove that $\nu_f$ is an isomorphism for each $f'\in S'_1$, since $G(\varphi)$ is the union of $D_+(\varphi(f'))$. We first define a $\Z$-bilinear map $M'_m\times S_n\to M'_{(f')}\otimes_{S'_{f'}}S_{(f)}$ which sends $(x',s)$ to the element $(x'/f'^m)\otimes(s/f^n)$. As in the proof of \cref{scheme Proj associated tensor and Hom char}, this map then induces a bi-homomorphism
\[\eta_f:M'\otimes_{S'}S\to M'_{(f')}\otimes_{S'_{(f')}}S_{(f)}.\]
Moreover, if, for $r>0$, we have $f^r\sum_i(x'_i\otimes s_i)=0$, then $\sum_i(f'^rx_i'\otimes s_i)=0$, so $\sum_i(f'^rx_i/f'^{m_i+r})\otimes(s_i/f^{n_i})=0$, which means $\eta_f(\sum_ix_i\otimes y_i)=0$; the homomorphism then factors through $(M'\otimes_{S'}S)_f$ and gives a homomorphism $\tilde{\eta}_f:(M'\otimes_{S'}S)_f\to M'_{(f')}\otimes_{S'_{(f')}}S_{(f)}$. It is easy to verify that $\tilde{\eta}_f$ is the inverse of $\nu_f$, whence our assertion.
\end{proof}
In particular, since $\varphi_*(S'(n))=S(n)$ for each $n\in\Z$, it follows from \cref{scheme Proj associated sheaf inverse image char} that we have a canonical homomorphism $\Phi^*(\mathscr{O}_{X'}(n))\to\mathscr{O}_X(n)|{G(\varphi)}$, and this an isomorphism if $S'_+$ is generated by $S'_1$.
\begin{remark}
We note that it follows from \cref{scheme Proj unchanged if alter ring} that the morphism $\Phi$ is unchanged if we replace $S$ by $S^{(d)}$, $S'$ by $S'^{(d)}$, and $\varphi$ by $\varphi^{(d)}$. Also, it is also unchanged if we replace $S_0$ and $S'_0$ by $\Z$ and $\varphi_0$ be the identity map.
\end{remark}
Let $A,A'$ be two rings and $\psi:A'\to A$ be a homomorphism of rings, which defines a morphism $\Psi:\Spec(A)\to\Spec(A')$. Let $S'$ be an $A'$-algebra with positive degrees, and put $S=S'\otimes_{A'}A$, which is a graded $A$-algebra by setting $S_n=S'_n\otimes_{A'}A$. The map $s'\mapsto s'\otimes 1$ is then a homomorphism of graded rings and also a bi-homomorphism. Since $S_+$ is the $A$-module generated by $\varphi(S'_+)$, we have $G(\varphi)=\Proj(S)=X$, so, if we put $X'=\Proj(S')$, we have a commutative diagram
\begin{equation}\label{scheme Proj base ring change prop-1}
\begin{tikzcd}
X\ar[r,"\Phi"]\ar[d,swap,"p"]&X'\ar[d]\\
Y\ar[r,"\Psi"]&Y'
\end{tikzcd}
\end{equation}
Now let $M'$ be a graded $S'$-module, and set $M=M'\otimes_{A'}A=M'\otimes_{S'}S$.
\begin{proposition}\label{scheme Proj base ring change prop}
The commutative diagram (\ref{scheme Proj base ring change prop-1}) is cartesian and the canonical homomorphism $\nu:\Phi^*(\widetilde{M}')\to\widetilde{M}$ in \cref{scheme Proj associated sheaf inverse image char} is an isomorphism.
\end{proposition}
\begin{proof}
The first assertion follows if we can prove that for any $f'$ homogeneous in $S'_+$ and $f=\varphi(f')$, the restriction of $\Phi$ and $p$ to $D_+(f)$ identify this scheme as $D_+(f')\times_{Y'}Y$; in other words, it suffices to prove that $S_{(f)}$ is canonically identified with $S'_{(f')}\otimes_{A'}A$, which is immedaite from the fact that the canonical isomorphism $S_f\cong S'_{f'}\otimes_{A'}A$ preserves degrees. The second assertion follows from the isomorphism $M'_{(f')}\otimes_{S'_{(f')}}S_{(f)}\cong M'_{(f')}\otimes_{A'}A$, and the later one is isomorphic to $M_{(f)}$ since $M_f$ is canonically identified with $M'_{f'}\otimes_{A'}A$.
\end{proof}
\begin{corollary}\label{scheme Proj base ring change twisted sheaf prop}
For any integer $n\in\Z$, $\widetilde{M}(n)$ is identified with $\Phi^*(\widetilde{M}'(n))=\widetilde{M}'(n)\otimes_{Y'}\mathscr{O}_Y$. In particular, $\mathscr{O}_X(n)=\Phi^*(\mathscr{O}_{X'}(n))=\mathscr{O}_{X'}(n)\otimes_{Y'}\mathscr{O}_Y$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme Proj base ring change prop} and \cref{scheme Proj twisted qcoh prop}.
\end{proof}
Now let $\mathscr{F}'$ be an $\mathscr{O}_{X'}$-module and $\mathscr{F}=\Phi^*(\mathscr{F}')$. Then we have for each $n\in\Z$ that $\mathscr{F}(n)=\Phi^*(\mathscr{F}'(n))$ in view of \cref{scheme Proj base ring change twisted sheaf prop}. Therefore, by the definition of $\Phi^*$, we have a canonical homomorphism
\[\Gamma(\rho):\Gamma(X',\mathscr{F}'(n))\to\Gamma(X,\mathscr{F}(n))\]
which then gives a canonical bi-homomorphism $\Gamma_*(\mathscr{F}')\to\Gamma_*(\mathscr{F})$ of graded modules.\par
Suppose that the ideal $S'_+$ is generated by $S'_1$ and $\mathscr{F}'=\widetilde{M}'$, so $\mathscr{F}=\widetilde{M}$ where $M=M'\otimes_{A'}A$. If $f'$ is homogeneous in $S'_+$ and $f=\varphi(f')$, we have $M_{(f)}=M'_{(f')}\otimes_{A'}A$ and the diagram
\[\begin{tikzcd}
M'_0\ar[d]\ar[r]&M'_{(f')}=\Gamma(D_+(f),\widetilde{M}')\ar[d]\\
M_0\ar[r]&M_{(f)}=\Gamma(D_+(f),\widetilde{M})
\end{tikzcd}\]
is commutative. We then conclude from the definition of the homomorphism $\alpha:M\to\Gamma_*(\widetilde{M})$ that the following diagram
\begin{equation}\label{scheme Proj qcoh associated alpha diagram}
\begin{tikzcd}
M'\ar[d]\ar[r,"\alpha_{M'}"]&\Gamma_*(\widetilde{M}')\ar[d]\\
M\ar[r,"\alpha_M"]&\Gamma_*(\widetilde{M})
\end{tikzcd}
\end{equation}
is commutative. Similarly, the diagram
\begin{equation}\label{scheme Proj qcoh associated beta diagram}
\begin{tikzcd}
\widetilde{\Gamma_*(\mathscr{F}')}\ar[d]\ar[r,"\beta_{\mathscr{F}'}"]&\mathscr{F}'\ar[d]\\
\widetilde{\Gamma_*(\mathscr{F})}\ar[r,"\beta_{\mathscr{F}}"]&\mathscr{F}
\end{tikzcd}
\end{equation}
is commutative (where the vertical is the canonical $\Phi$-morphism $\mathscr{F}'\to\Phi^*(\mathscr{F}')=\mathscr{F}$).\par
Now let $N'$ be another graded $S'$-module and $N=N'\otimes_{A'}A$. It is immediate that the canonical bi-homomorphisms $M'\to M$, $N'\to N$ give a bi-homomorphism $M'\otimes_{S'}N'\to M\otimes_SN$, and therefore an $S$-homomorphism $(M'\otimes_{S'}N')\otimes_{A'}A\to M\otimes_SN$ of degree $0$, which then corresponds to an $\mathscr{O}_X$-homomorphism
\[\Phi^*((M'\otimes_{S'}N')\widetilde{\hspace{3mm}})\to (M\otimes_SN)\widetilde{\hspace{3mm}}.\]
Moreover, it is immedaite to verify that the following diagram 
\begin{equation}\label{scheme Proj base ring change tensor diagram}
\begin{tikzcd}
\Phi^*(\widetilde{M}'\otimes_{\mathscr{O}_{X'}}\widetilde{N}')\ar[r,"\sim"]\ar[d,"\Phi^*(\lambda)"]&\widetilde{M}\otimes_{\mathscr{O}_X}\widetilde{N}=\Phi^*(\widetilde{M}')\otimes_{\mathscr{O}_X}\Phi^*(\widetilde{N}')\ar[d,"\lambda"]\\
\Phi^*((M'\otimes_{S'}N')\widetilde{\hspace{3mm}})\ar[r]&(M\otimes_SN)\widetilde{\hspace{3mm}}
\end{tikzcd}
\end{equation}
is commutative (where the first row is an isomorphism by (\ref{ringed space inverse image and tensor})). If the ideal $S'_+$ is generated by $S'_1$, it is clear that $S_+$ is generated by $S_1$, so the two vertical homomorphisms are isomorphisms, so the second row is also an isomorphism.\par
We have similarly a cannical bi-homomorphism $\Hom_{S'}(M',N')\to\Hom_S(M,N)$, which sends a homomorphism $u'$ of degree $k$ the homomorphism $u'\otimes 1$, which is also of degree $k$. We then deduce an $S$-homomorphism of degree $0$:
\[\Hom_{S'}(M',N')\otimes_{A'}A\to\Hom_S(M,N)\]
which corresponds to a homomorphism of $\mathscr{O}_X$-modules:
\[\Phi^*((\Hom_{S'}(M',N'))\widetilde{\hspace{3mm}})\to(\Hom_S(M,N))\widetilde{\hspace{3mm}}.\]
Similarly, the diagram
\begin{equation}\label{scheme Proj base ring change Hom diagram}
\begin{tikzcd}
\Phi^*((\Hom_{S'}(M',N'))\widetilde{\hspace{3mm}})\ar[r]\ar[d,"\Phi^*(\mu)"]&(\Hom_S(M,N))\widetilde{\hspace{3mm}}\ar[d,"\mu"]\\
\Phi^*(\sHom_{\mathscr{O}_{X'}}(\widetilde{M}',\widetilde{N}'))\ar[r]&\sHom_{\mathscr{O}_X}(\widetilde{M},\widetilde{N})
\end{tikzcd}
\end{equation}
is commutative (where the second row is the canonical homomorphism of (\ref{ringed space inverse image and sheaf Hom})).
\subsection{Closed subschemes of \texorpdfstring{$\Proj(S)$}{Proj}}
Recall that if $\varphi:S\to S'$ is a homomorphism of graded rings, we say that $\varphi$ is eventually surjective (resp. eventually injective, eventually bijective) if $\varphi_i:S_i\to S'_i$ is surjective (resp. injective, bijective) for sufficiently large $i$. It follows from \cref{scheme Proj unchanged if alter ring} that the study of $\Phi$ can be reduced to the case where $\varphi$ is surjective (resp. injectij, bijective). Instead of saying that $\varphi$ is eventually bijective, we also say that it is then an eventual isomorphism.
\begin{proposition}\label{scheme Proj closed immersion char}
Let $S,S'$ be graded rings with positive degrees and set $X=\Proj(S)$, $X'=\Proj(S')$.
\begin{enumerate}
\item[(a)] If $\varphi:S\to S'$ is an eventually surjective homomorphism of graded rings, the corresponding morphism $\Phi$ is defined over $\Proj(S')$ and is a closed immersion. If $\mathfrak{I}$ is the kernel of $\varphi$, the closed subscheme of $X$ associated with $\Phi$ is defined by the quasi-coherent ideal $\widetilde{\mathfrak{I}}$ of $\mathscr{O}_X$.
\item[(b)] Suppose moreover that the ideal $S_+$ is finitely generated by $S_1$. Let $X'$ be a closed subscheme of $X$ defined by a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$. Let $\mathfrak{I}$ be the graded ideal of $S$ which is the inverse image of $\Gamma_*(\mathscr{I})$ under the canonical homomorphism $\alpha:S\to\Gamma_*(\mathscr{O}_X)$, and put $S'=S/\mathfrak{I}$. Then $X'$ is the subscheme associated with the closed immersion $\Proj(S')\to X$ corresponding to the canonical homomorphism $S\to S'$ of graded rings.
\end{enumerate}
\end{proposition}
\begin{proof}
Let $\varphi:S\to S'$ be an eventually surjective homomorphism of graded rings. We can suppose that $\varphi$ is surjective, so $\varphi(S_+)$ is generated by $S'_+$, we have $G(\varphi)=\Proj(S')$. Now the second assertion in (a) can be verified locally over $X$; let $f$ be a homogeneous element of $S_+$ and put $f'=\varphi(f)$. As $\varphi$ is a surjective homomorphism of rings, $\varphi_{(f')}:S_{(f)}\to S'_{(f')}$ is surjective with kernel $\mathscr{I}_{(f)}$, so the corresponding morphism is closed.\par
We now consider the case of (b); in view of (a), we only need to verify that the homomorphism $\tilde{j}:\widetilde{\mathscr{I}}\to\mathscr{O}_X$ induced from the injection $j:\mathscr{I}\to S$ is an isomorphism from $\widetilde{\mathscr{I}}$ to $\mathscr{I}$, which follows from \cref{scheme Proj qc alpha assocaited isomorphism}(b).
\end{proof}
\begin{remark}
Note that $\mathfrak{I}$ is the largest graded ideal $\mathfrak{I}'$ of $S$ such that $\widetilde{\mathscr{I}}'=\mathscr{I}$ (where we identify $\widetilde{\mathscr{I}}'$ as a subsheaf of $\mathscr{O}_X$), since one immedaitely verify that this relation implies $\alpha(\mathfrak{I}')\sub\Gamma_*(\mathscr{I})$.
\end{remark}
\begin{corollary}\label{scheme Proj closed immersion twisted sheaf direct image}
Assume the hypotheses of \cref{scheme Proj closed immersion char}(a) and that $S_+$ is generated by $S_1$. Then $\Phi^*(\widetilde{S(n)})$ is canonically isomorphic to $\widetilde{S'(n)}$ for any $n\in\Z$, and therefore $\Phi^*(\mathscr{F}(n))$ is isomorphic to $\Phi^*(\mathscr{F})(n)$ for any $\mathscr{O}_X$-module $\mathscr{F}$.
\end{corollary}
\begin{proof}
This is a partiuclar case of \cref{scheme Proj associated sheaf inverse image char}, in view of the definition of $\mathscr{F}(n)$ and \cref{scheme Proj closed immersion char}(a).
\end{proof}
\begin{corollary}\label{scheme Proj closed immersion integral image iff}
Assume the hypotheses of \cref{scheme Proj closed immersion char}(a). Then for the closed subscheme $X'$ of $X$ to be integral, it is necessary and sufficient that the graded ideal $\mathfrak{I}$ is prime in $S$.
\end{corollary}
\begin{proof}
As $X'$ is isomorphic to $\Proj(S/\mathfrak{I})$, this condition is sufficient in view of \cref{scheme Proj reduced integral iff}. To see the necessity, assume that $\Proj(S')$ is integral and consider the exact sequence $0\to\mathscr{I}\to\mathscr{O}_X\to\mathscr{O}_X/\mathscr{I}\to 0$, which gives an exact sequence
\[\begin{tikzcd}
0\ar[r]&\Gamma_*(\mathscr{I})\ar[r]&\Gamma_*(\mathscr{O}_X)\ar[r]&\Gamma_*(\mathscr{O}_X/\mathscr{I})
\end{tikzcd}\]
by the left-exactness of the global section functor. In view of the canonical homomorphism $\alpha:S/\mathfrak{I}\to\Gamma_*(\mathscr{O}_X/\mathscr{I})$, it then suffices to prove that if $f\in S_m$, $g\in S_n$ are such that the image in $\Gamma_*(\mathscr{O}_X/\mathscr{I})$ of $\alpha_{n+m}(fg)$ is zero, then one of the images of $\alpha_m(f)$, $\alpha_n(g)$ is zero. Now by definition, these images are sectins of the invertible $(\mathscr{O}_X/\mathscr{I})$-modules $\mathscr{L}=(\mathscr{O}_X/\mathscr{I})(m)$ and $\mathscr{L}'=(\mathscr{O}_X/\mathscr{I})(n)$ over the integral scheme $X'$. The hypotheses implies that their product is zero in $\mathscr{L}\otimes\mathscr{L}'$ (\cref{scheme Proj twisted sheaf tensor prop}), so one of them is zero by \cref{scheme integral section tensor zero iff}.
\end{proof}
\begin{corollary}\label{scheme Proj surjective module homomorphism induced immersion}
Let $A$ be a ring, $M$ be an $A$-module, and $S$ be a graded $A$-algebra generated by $S_1$. Let $u:M\to S_1$ be a surjective homomorphism of $A$-modules and $\bar{u}:\bm{S}(M)\to S$ be the unique homomorphism of $A$-algebras extending $u$. Then the morphism corresponding to $\bar{u}$ is a closed immersion from $\Proj(S)$ to $\Proj(\bm{S}(M))$.
\end{corollary}
\begin{proof}
The homomorphism $\bar{u}$ is surjective by hypothesis, so it suffices to apply \cref{scheme Proj closed immersion char}.
\end{proof}
\section{Homogeneous spectrum of sheaves of graded algebras}
Let $Y$ be a scheme and $\mathscr{S}$ be an $\mathscr{O}_Y$-algebra. We say that $\mathscr{S}$ is \textbf{graded} if $\mathscr{S}$ is the direct sum of a family $(\mathscr{S}_n)$ of $\mathscr{O}_Y$-algebras such that $\mathscr{S}_m\mathscr{S}_n\sub\mathscr{S}_{m+n}$. If $\mathscr{S}$ is a graded $\mathscr{O}_Y$-algebra, by a \textbf{graded $\mathscr{S}$-module} $\mathscr{M}$ we mean an $\mathscr{S}$-module $\mathscr{M}$ which is the direct sum of a family $(\mathscr{M}_n)_{n\in\Z}$ such that $\mathscr{S}_m\mathscr{M}_n\sub\mathscr{M}_{m+n}$. We say $\mathscr{S}$ is a graded $\mathscr{O}_Y$-algebra with positive degrees if $\mathscr{S}_n=0$ for $n<0$, and $\mathscr{M}$ is a graded $\mathscr{S}$-module if $\mathscr{M}_n=0$ for $n<0$. In this section, without further specifications, we will only consider graded algebras with positive degree.
\subsection{Homogeneous spectrum of a graded \texorpdfstring{$\mathscr{O}_Y$}{O}-algebra}
Let $\mathscr{S}$ be a graded $\mathscr{O}_Y$-algebra (with positive degrees) and $\mathscr{M}$ be a graded $\mathscr{S}$-module. If $\mathscr{S}$ is quasi-coherent, each homogeneous component $\mathscr{S}_n$ is also a quasi-coherent $\mathscr{O}_Y$-module, since it is the image of $\mathscr{S}$ under the projection of $\mathscr{S}$ onto $\mathscr{S}_n$. Similarly, if $\mathscr{M}$ is quasi-coherent as an $\mathscr{O}_Y$-module, so is each of its homogeneous components, and the converse also holds. If $d>0$ is an integer, we denote by $\mathscr{S}^{(d)}$ the direct sum of the $\mathscr{O}_Y$-modules $\mathscr{S}_{nd}$, which is quasi-coherent if $\mathscr{S}$ is; for any integer $k$ such that $0\leq k\leq d-1$, we denote by $\mathscr{M}^{(d,k)}$ (or $\mathscr{M}^{(d)}$ if $k=0$) the direct sum of $\mathscr{M}_{nd+k}$ (for $n\in\Z$). If $\mathscr{S}$ and $\mathscr{M}$ are quasi-coherent sheaves, $\mathscr{M}(n)$ is a quasi-coherent $\mathscr{S}$-module by \cref{scheme qcoh over qcoh algebra char}.\par
We say that $\mathscr{M}$ is a graded $\mathscr{S}$-module \textbf{of finite type} (resp. \textbf{of finite presentation}) if for any $y\in Y$, there exists an open neighborhood $U$ of $y$ and integers $n_i$ (resp. integers $m_i$ and $n_i$) such that there exists a surjective homomorphism $\bigoplus_{i=1}^{r}(\mathscr{S}(n_i)|_U)\to\mathscr{M}|_U$ of degree $0$ (resp. such that $\mathscr{M}|_U$ is isomorphic to the cokernel of a homomorphism $\bigoplus_{i=1}^{r}\mathscr{S}(m_i)|_U\to\bigoplus_{j=1}^{r}\mathscr{S}(n_j)|_U$ of degree $0$).\par
Let $U$ be an affine open of $Y$ and $A=\Gamma(U,\mathscr{O}_Y)$ by its ring. By hypothesis, the graded $(\mathscr{O}_Y|_U)$-algebra $\mathscr{S}|_U$ is isomorphic to $\widetilde{S}$ where $S=\Gamma(U,\mathscr{S})$ is a graded $A$-algebra; we put $X_U=\Proj(\Gamma(U,\mathscr{S}))$. Let $U'\sub U$ be another affine open subset of $Y$ and $j:U'\to U$ the canonical injection, which corresponds to a homomorphism $A\to A'$, we have $\mathscr{S}|_{U'}=j^*(\mathscr{S}|_U)$, and therefore $S'=\Gamma(U',\mathscr{S})$ is identified with $S\otimes_AA'$ by \cref{scheme affine associated sheaf inverse image char}. We then conclude from \cref{scheme Proj base ring change prop} that $X_{U'}$ is canonically identified with $X_U\times_UU'$, and therefore with $p_U^{-1}(U')$, where $p_U$ is the structural morphism $X_U\to U$. Let $\sigma_{U',U}$ be the canonical isomorphism $p_U^{-1}(U')\cong X_{U'}$ thus defined, and $\rho_{U',U}$ be the open immersion $X_{U'}\to X_U$ obtained by composing $\sigma_{U',U}^{-1}$ with the canonical injectin $p_U^{-1}(U')\to X_U$. It is immediate that if $U''\sub U'$ is a third affine open of $Y$, we have $\rho_{U'',U}=\rho_{U'',U'}\circ\rho_{U',U}$.
\begin{proposition}\label{scheme qcoh graded algebra Proj def}
Let $Y$ be a scheme and $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra. Then there exists a unique scheme $X$ over $Y$ such that, if $p:X\to Y$ is the structural morphism, for any affine open $U$ of $Y$, there exists an isomorphism $\eta_U:p^{-1}(U)\stackrel{\sim}{\to}X_U=\Proj(\Gamma(U,\mathscr{S}))$ such that, if $V$ is another affine open of $Y$ contained in $U$, the following diagram
\[\begin{tikzcd}
p^{-1}(V)\ar[r,"\eta_V"]\ar[d]&X_V\ar[d,"\rho_{V,U}"]\\
p^{-1}(U)\ar[r,"\eta_U"]&X_U
\end{tikzcd}\]
is commutative. The scheme $X$ is called the \textbf{homogeneous specturm} of the quasi-coherent $\mathscr{O}_Y$-algebra $\mathscr{S}$ and denoted by $\Proj(\mathscr{S})$.
\end{proposition}
\begin{proof}
For two affine opens $U,V$ of $Y$, let $X_{U,V}$ be the scheme induced over $p_U^{-1}(U\cap V)$ by $X_U$; we shall define a $Y$-isomorphism $\theta_{U,V}:X_{V,U}\to X_{U,V}$. For this, consider an affine open $W\sub U\cap V$; by composing the isomorphisms
\[\begin{tikzcd}
p_U^{-1}(W)\ar[r,"\sigma_{W,U}"]&X_W\ar[r,"\sigma_{W,V}^{-1}"]&p_V^{-1}(W)
\end{tikzcd}\]
we obtain an isomorphism $\tau_W:p_U^{-1}(W)\to p_V^{-1}(W)$, and we can verify that if $W'\sub W$ is an affine open, $\tau_{W'}$ is the restriction of $\tau_W$ to $p_U^{-1}(W')$; the morphisms $\tau_W$ then glue together to a $Y$-isomorphism $\theta_{V,U}$, which is what we want. Moreover, if $U,V,W$ are affine opens of $Y$ and $\theta'_{U,V}$, $\theta_{V,W}'$, and $\theta_{U,W}'$ are restrictions of $\theta_{U,V},\theta_{V,W}$, $\theta_{U,W}$ on the inverse images of $U\cap V\cap W$ in $X_V$, $X_W$, $X_W$, respectively, it follows from the preceding definition that $\theta'_{U,V}\circ\theta'_{V,W}=\theta'_{U,W}$. The existence of $X$ then follows from glueing these schemes via the isomorphisms $\theta_{U,V}$, and the uniqueness is clear.  
\end{proof}
It is clear that the $Y$-scheme $\Proj(\mathscr{S})$ is separated over $Y$ since homogeneous specturms are separated. If $\mathscr{S}$ is an $\mathscr{O}_Y$-algebra of finite type, it follows from \cref{scheme Proj Noe and ft if} and \cref{scheme morphism ft def} that $\Proj(\mathscr{S})$ is of finite type over $Y$. If $p:X\to Y$ is the structural morphism, it is immediate that for any open subschem $U$ of $Y$, $p^{-1}(U)$ is identified with the homogeneous specturm $\Proj(\mathscr{S}|_U)$.
\begin{proposition}\label{scheme Proj of qcoh graded algebra X_f def}
Let $f\in\Gamma(Y,\mathscr{S}_d)$ with $d>0$ and $X=\Proj(\mathscr{S})$. Then there exists an open subset $X_f$ of $X$ such that, for any affine open subset $U$ of $Y$, we have $X_f\cap p^{-1}(U)=D_+(f|_U)$ in $X_U=\Proj(\Gamma(U,\mathscr{S}))$ (where $p:X\to Y$ is the structural morphism). Moreover, the $Y$-scheme induced over $X_f$ by $X$ is canonically isomorphic to $\Spec(\mathscr{S}^{(d)}/(f-1)\mathscr{S}^{(d)})$.
\end{proposition}
\begin{proof}
For any affine open $U$, we have $f|_U\in\Gamma(U,\mathscr{S}_d)=\Gamma(U,\mathscr{S})_d$ since $U$ is quasi-compact. If $U,U'$ are two affine opens of $Y$ such that $U'\sub U$, $f|_{U'}$ is the image of $f|_U$ by the restriction homomorphism $\Gamma(U,\mathscr{S})\to\Gamma(U',\mathscr{S})$, so $D_+(f|_{U'})$ is equal to the open subscheme $\rho_{U',U}^{-1}(D_+(f|_U))$ of $X_{U'}$. The subset $X_f$ can be then defined by glueing these subschemes, and the first assertion is then obvious. On the other hand, the open subscheme $D_+(f|_U)$ of $X_U$ is canonically identified with $\Spec(\Gamma(U,\mathscr{S})_{(f|_U)})$, and this identification is clearly compatible with restrictions; the second assertion then follows from \cref{graded ring S_(f) isomorphic to quotient by f-1}.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh graded algebra X_fg char}
If $f\in\Gamma(Y,\mathscr{S}_d)$ and $g\in\Gamma(Y,\mathscr{S}_e)$, we have $X_{fg}=X_f\cap X_g$.
\end{corollary}
\begin{proof}
It suffices to consider the intersection of two members of $p^{-1}(U)$, where $U$ is an affine open of $Y$, and the assertion follows from $D_+(fg)=D_+(f)\cap D_+(g)$ for a graded ring $S$.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh graded algebra cover by X_f if}
Let $(f_\alpha)$ be a family of sections of $\mathscr{S}$ over $Y$ such that $f_\alpha\in\Gamma(Y,\mathscr{S}_{d_\alpha})$. If the sheaf of ideals of $\mathscr{S}$ generated by this family containes all the $\mathscr{S}_n$ for sufficiently large $n$, then the underlying space $X$ is the union of $X_{f_\alpha}$.
\end{corollary}
\begin{proof}
In fact, for any affine open $U$ of $Y$, $p^{-1}(U)$ is the union of $X_{f_\alpha}\cap p^{-1}(U)$ by \cref{scheme Proj standard set cover iff generate}, so the claim follows from the construction of $X_{f_\alpha}$.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh polynomial algebra}
Let $\mathscr{A}$ be a quasi-coherent $\mathscr{O}_Y$-algebra and put 
\[\mathscr{S}=\mathscr{A}[T]=\mathscr{A}\otimes_{\Z}\Z[T]\]
where $T$ is an indeterminate. Then $X=\Proj(\mathscr{S})$ is canonically identified with $\Spec(\mathscr{A})$. In particular, $\Proj(\mathscr{O}_Y[T])$ is identified with $Y$.
\end{corollary}
\begin{proof}
By applying \cref{scheme Proj of qcoh graded algebra cover by X_f if} to the unique section $f\in\Gamma(Y,\mathscr{S})$ equal to $T$ on each point of $Y$, we see that $X_f=X$. Moreover, we have $f\in\mathscr{S}_1$, and $\mathscr{S}^{(1)}/(f-1)\mathscr{S}^{(1)}=\mathscr{S}/(f-1)\mathscr{S}$ is canonically isomorphic to $\mathscr{A}$, whence the corollary
\end{proof}
Let $g\in\Gamma(Y,\mathscr{O}_Y)$; if we put $\mathscr{S}=\mathscr{O}_Y[T]$, then $g\in\Gamma(Y,\mathscr{S}_0)$; let
\[h=gT\in\Gamma(Y,\mathscr{S}_1).\]
If $X=\Proj(\mathscr{S})$, the canonical identification of \cref{scheme Proj of qcoh polynomial algebra} identifies $X_h$ with the open subset $Y_g$ of $Y$: in fact, we can assume that $Y=\Spec(A)$ is affine, and this then follows from the fact that the ring $A_g$ is canonically identified with $A[T]/(gT-1)A[T]$.
\begin{proposition}\label{scheme Proj of qcoh graded algebra altering prop}
Let $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra.
\begin{enumerate}
\item[(a)] For any $d>0$, there exists a canonical $Y$-isomorphism from $\Proj(\mathscr{S})$ to $\Proj(\mathscr{S}^{(d)})$.
\item[(b)] Let $\mathscr{S}'$ be the graded $\mathscr{O}_Y$-algebra $\mathscr{O}_Y\oplus\bigoplus_{n>0}\mathscr{S}_n$, then the schemes $\Proj(\mathscr{S}')$ and $\Proj(\mathscr{S})$ are canonically $Y$-isomorphic.
\item[(c)] Let $\mathscr{L}$ be an invertible $\mathscr{O}_Y$-module and $\mathscr{S}_{(\mathscr{L})}$ be the graded $\mathscr{O}_Y$-algebra $\bigoplus_{d>0}\mathscr{S}_d\otimes\mathscr{L}^{\otimes d}$; then the schemes $\Proj(\mathscr{S})$ and $\Proj(\mathscr{S}_{(\mathscr{L})})$ are canonically $Y$-isomorphic.
\end{enumerate}
\end{proposition}
\begin{proof}
In all three cases, it suffices to define an isomorphism locally over $Y$ and verifying the compatibility of restriction morphisms is immediate. We can then assume that $Y$ is affine, and assertions (a) and (b) then follow from \cref{scheme Proj unchanged if alter ring}. As for (c), if the invertible sheaf $\mathscr{L}$ is just isomorphic to $\mathscr{O}_Y$ then the isomorphism between $\Proj(\mathscr{S})$ and $\Proj(\mathscr{S}_{(\mathscr{L})})$ is evident. To define a canonical isomorphism, let $Y=\Spec(A)$, $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra, and let $c$ be a generator of the free $A$-module $L$ such that $\mathscr{L}=\widetilde{L}$. Then for any $n>0$, $x_n\mapsto x_n\otimes c^{\otimes n}$ is an $A$-isomorphism from $S_n$ to $S_n\otimes L^{\otimes n}$, and these $A$-isomorphisms define an $A$-isomorphism of graded algebras
\[p_c:S\to S_{(L)}=\bigoplus_{n\geq 0}S_n\otimes L^{\otimes n}.\]
Let $f\in S_+$ be homogeneous of degree $d$; for any $x\in S_{nd}$, we have $(x\otimes c^{nd})/(f\otimes c^d)^n=(x\otimes(\eps c)^{nd})/(f\otimes(\eps c)^d)^n$ for any invertible element $\eps\in A$, which implies that the isomorphism $S_{(f)}\to (S_{(L)})_{(f\otimes c^d)}$ induced by $p_c$ is independent from the generator $c$ of $L$, whence the assertion.
\end{proof}
Recall that for the quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{L}$ to be \textit{generated} by the $\mathscr{O}_Y$-module $\mathscr{S}_1$, it is necessary and sufficient that there exists a covering $(U_\alpha)$ of $Y$ by affine opens such that the graded algebra $\Gamma(U_\alpha,\mathscr{S})$ over $\Gamma(U_\alpha,\mathscr{S}_0)$ is generated by $\Gamma(U_\alpha,\mathscr{S}_1)$. If this is true, then for any open subset $V$ of $Y$, $\mathscr{S}|_V$ is then generated by $(\mathscr{O}_Y|_V)$-algebra $\mathscr{S}_1|_{V}$.
\begin{proposition}\label{scheme qcoh algebra S^(d) generated by S_d if}
Suppose that there exists a finite affine open cover $(U_i)$ of $Y$ such that the graded algebra $\Gamma(U_i,\mathscr{S})$ is of finite type over $\Gamma(U_i,\mathscr{O}_Y)$. Then there exists $d>0$ such that $\mathscr{S}^{(d)}$ is generated by $\mathscr{S}_d$, which is an $\mathscr{O}_Y$-module of finite type.
\end{proposition}
\begin{proof}
In fact, it follows from \cref{graded ring bounded algebra S^(d)=S_0[S_d]} that for each $i$, there exist an integer $m_i$ such that $\Gamma(U_i,\mathscr{S}_{nm_i})=(\Gamma(U_i,\mathscr{S}_{m_i}))^n$ for all $n>0$; it suffices to take $d$ a common multiple of the $m_i$.
\end{proof}
\begin{corollary}\label{scheme qcoh algebra Proj isomorphic to generated by S_1 ft}
Under the hypotheses of \cref{scheme qcoh algebra S^(d) generated by S_d if}, $\Proj(\mathscr{S})$ is $Y$-isomorphic to a homogeneous specturm $\Proj(\mathscr{S}')$, where $\mathscr{S}'$ is a graded $\mathscr{O}_Y$-algebra generated by $\mathscr{S}'_1$, where $\mathscr{S}'$ is an $\mathscr{O}_Y$-algebra of finite type.
\end{corollary}
\begin{proof}
It suffices to take $\mathscr{S}'=\mathscr{S}^{(d)}$, where $d$ is determined by the properties of \cref{scheme qcoh algebra S^(d) generated by S_d if}, and apply \cref{scheme Proj of qcoh graded algebra altering prop}(a).
\end{proof}
If $\mathscr{S}$ is a quasi-coherent graded $\mathscr{O}_Y$-algebras, we have seen in \cref{scheme qcoh algebra nilradical sheaf exist} that its nilradical is a quasi-coherent $\mathscr{O}_Y$-module. We say that $\mathscr{N}_+=\mathscr{N}\cap\mathscr{S}_+$ is the nilradical of $\mathscr{S}_+$, which is a quasi-coherent graded $\mathscr{S}_0$-module, since this is the case if $Y$ is affine. For any $y\in Y$, $(\mathscr{N}_+)_y$ is then the nilradical of $(\mathscr{S}_+)_y=(\mathscr{S}_y)_+$. Similar to the local case, we say the graded $\mathscr{O}_Y$-algebra $\mathscr{S}$ is \textbf{essentially reduced} if $\mathscr{N}_+=0$, which means $\mathscr{S}_y$ is an essentially reduced graded $\mathscr{O}_{Y,y}$-algebra for any $y\in Y$. It is clear that for any quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}$, $\mathscr{S}/\mathscr{N}_+$ is essentially reduced. Finally, we say $\mathscr{S}$ is \textbf{integral} if $\mathscr{S}_y$ is an integral ring for each $y\in Y$ and if $(\mathscr{S}_+)_y=(\mathscr{S}_y))_+\neq 0$ for all $y\in Y$.
\begin{proposition}\label{scheme Proj of qcoh graded algebra red char}
Let $\mathscr{S}$ be a graded $\mathscr{O}_Y$-algebra. If $X=\Proj(\mathscr{S})$, the $Y$-scheme $X_{\red}$ is canonically isomorphic to $\Proj(\mathscr{S}/\mathscr{N}_+)$. In particular, if $\mathscr{S}$ is essentially reduced, then $X$ is reduced.
\end{proposition}
\begin{proof}
The fact that $X'=\Proj(\mathscr{S}/\mathscr{N}_+)$ is reduced follows from \cref{scheme Proj reduced integral iff}, since the question is local. Moreover, for any affine open $U\sub Y$, $p'^{-1}(U)$ is equal to $(p^{-1}(U))_{\red}$ (where $p$ and $p'$ are the structural morphisms $X\to Y$, $X'\to Y$, respectively); we also verify t hat the canonical $U$-morphisms $p'^{-1}(U)\to p^{-1}(U)$ is compatible with restrictions and define therefore a closed immersion $X'\to X$, which is a homeomorphism on underlying spaces. Our assertion then follows from \cref{scheme reduced scheme structure given by nilradical}.
\end{proof}
\begin{proposition}\label{scheme Proj of qcoh alg over integral prop}
Let $Y$ be an integral scheme and $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra such that $\mathscr{S}_0=\mathscr{O}_Y$.
\begin{enumerate}
\item[(a)] If $\mathscr{S}$ is integral then $X=\Proj(\mathscr{S})$ is integral and the structural morphism $p:X\to Y$ is dominant.
\item[(b)] Suppose moreover that $\mathscr{S}$ is essentially reduced. Then, conversely, if $X$ is integral and $p$ is dominant, then $\mathscr{S}$ is integral.
\end{enumerate}
\end{proposition}
\begin{proof}
We first assume that $\mathscr{S}$ is integral. Then if $(U_\alpha)$ is a basis of $Y$ formed by affine opens, it suffices to prove for $Y$ being replaced by $U_\alpha$ and $\mathscr{S}$ by $\mathscr{S}|_{U_\alpha}$: in fact, is this is true, the underlying space $p^{-1}(U_\alpha)$ is an open irreducible subset of $X$ such that $p^{-1}(U_\alpha)\cap p^{-1}(U_\beta)\neq\emp$ for any couple of indices $\alpha,\beta$ (since $U_\alpha\cap U_\beta$ contains an $U_\gamma$ and $\mathscr{S}$ is integral), so $X$ is irreducible by \cref{topo space open cover of irreducible is irreducible if}; it is clear that $X$ is reduced since $\mathscr{S}$ is reduced, so $X$ is integral. It is clear that $p(X)$ is dense in $Y$ since this holds for each $U_\alpha$.\par
Suppose then that $Y=\Spec(A)$ where $A$ is integral (\cref{scheme affine reduced integral iff}) and $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra; the hypotheses on $\mathscr{S}$ is that for any $y\in Y$, $\widetilde{S}_y=S_y$ is an integral graded ring such that $(S_y)_+\neq 0$. It then suffices to prove that $S$ is an integral ring, since then $S_+\neq 0$ and we can apply \cref{scheme Proj reduced integral iff}. Now, let $f,g$ be two nonzero elements of $S$ and suppose that $fg=0$; for any $y\in Y$ we have $(f/1)(g/1)=$ in $S_y$, so $f/1=0$ or $g/1=0$ by hypothesis. Suppose for example that $f/1=0$ in $S_y$, so there exists $a\in A$ such that $a\notin\p_y$ and $af=0$. We then see that for each $z\in Y$, $(a/1)(f/1)=0$ in the integral ring $S_z$, and as $a/1\neq 0$ (since $A$ is integral), $f/1=0$, which implies $f=0$.\par
Now consider the hypothesis in (b) and assume that $X$ is integral and $p$ is dominant. Since the question is local over $Y$, we can assume that $Y=\Spec(A)$, where $A$ is an integral ring, and $\mathscr{S}=\widetilde{S}$. By hypothesis for any $y\in Y$, $(S_y)_+$ is reduced, and so is $(S_0)_y=A_y$ by hypothesis, so $S_y$ is a reduced ring and we conclude that $S$ is reduced. The hypothesis that $X$ is integral implies that $S$ is essentially integral (\cref{scheme Proj reduced integral iff}). The proposition then boils down to see that the annihilator $\mathfrak{I}$ of $S_+$ over $A=S_0$ is reduced to zero. In the contrary case, we would have $(S_h)_+=0$ for an $h\neq 0$ in $\mathfrak{I}$, which implies $p^{-1}(D(h))=\emp$ by \cref{scheme qcoh graded algebra Proj def}, and $p(X)$ is then not dense in $Y$, contradicting the hypothesis (since $D(h)\neq\emp$, $h$ is not nilpotent). We then see that the ring $S$ is integral, which conclude our assertion.
\end{proof}
\subsection{Sheaves associated with a graded \texorpdfstring{$\mathscr{S}$}{S}-module}
Let $Y$ be a scheme, $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra, and $\mathscr{M}$ be a quasi-coherent graded $\mathscr{S}$-module over the ringed space $(Y,\mathscr{S})$. With the notations of \cref{scheme qcoh graded algebra Proj def}, we denote by $\bigtilde{\mathscr{M}}_U$ the quasi-coherent $\mathscr{O}_{X_U}$-module $\widetilde{\Gamma(U,\mathscr{M})}$. For $U'\sub U$, $\Gamma(U',\mathscr{M})$ is canonically identified with $\Gamma(U,\mathscr{M})\otimes_AA'$ by \cref{scheme affine associated sheaf inverse image char}, so $\widetilde{M}_{U'}=\rho_{U',U}^*(\bigtilde{\mathscr{M}}_U)$ by \cref{scheme Proj base ring change prop}.
\begin{proposition}\label{scheme Proj of qcoh module def}
There exists over $\Proj(\mathscr{S})=X$ a unique quasi-coherent $\mathscr{O}_X$-module $\bigtilde{\mathscr{M}}$ such that, for any affine open $U$ of $Y$, we have $\eta_U^*(\bigtilde{\mathscr{M}}_U)=\bigtilde{\mathscr{M}}|_{p^{-1}(U)}$ , where $p:X\to Y$ is the structural morphism and $\eta_U$ is the isomorphism $p^{-1}(U)\cong\Proj(\Gamma(U,\mathscr{S}))$. We say that $\bigtilde{\mathscr{M}}$ is the $\mathscr{O}_X$-module associated with $\mathscr{M}$.
\end{proposition}
\begin{proof}
As $\rho_{U',U}$ is identified with the injection morphism $p^{-1}(U')\to p^{-1}(U)$, the proposition follows from the relation $\widetilde{M}_{U'}=\rho_{U',U}^*(\bigtilde{\mathscr{M}}_U)$ and glueing the $\bigtilde{\mathscr{M}}_U$.
\end{proof}
\begin{proposition}\label{scheme Proj of qcoh module on X_f prop}
Let $\mathscr{M}$ be a quasi-coherent $\mathscr{S}$-module and $f\in\Gamma(Y,\mathscr{S}_d)$ with $d>0$. If $\xi_f$ is the canonical isomorphism from $X_f$ to the $Y$-scheme $Z_f=\Spec(\mathscr{S}^{(d)}/(f-1)\mathscr{S}^{(d)})$ in \cref{scheme Proj of qcoh graded algebra X_f def}, then $(\xi_f)_*(\bigtilde{\mathscr{M}}|_{X_f})$ is the $\mathscr{O}_{Z_f}$-module $(\mathscr{M}^{(d)}/(f-1)\mathscr{M}^{(d)})\widetilde{\hspace{3mm}}$.
\end{proposition}
\begin{proof}
The question is local over $Y$ we we are reduced to \cref{graded ring S_(f) isomorphic to quotient by f-1}, and its compatibility with restrictions.
\end{proof}
\begin{proposition}\label{scheme Proj of qcoh alg associated functor exact}
The $\mathscr{O}_X$-module $\bigtilde{\mathscr{M}}$ is an additive exact covariant functor from the category of quasi-coherent graded $\mathscr{S}$-modules to the category of quasi-coherent $\mathscr{O}_X$-modules, which commutes with direct sums and inductive limits.
\end{proposition}
\begin{proof}
This follows from \cref{scheme affine associated sheaf ker and coker} and \cref{scheme Proj associated module alpha and beta prop}, since the question is local on $Y$.
\end{proof}
In particular, if $\mathscr{N}$ is a quasi-coherent graded sub-$\mathscr{S}$-module of $\mathscr{M}$, $\widetilde{\mathscr{N}}$ is cannically identified with a quasi-coherent sub-$\mathscr{O}_X$-module of $\bigtilde{\mathscr{M}}$; if we take $\mathscr{M}=\mathscr{S}$, then for any quasi-coherent ideal $\mathscr{I}$ of $\mathscr{S}$, $\widetilde{\mathscr{I}}$ is a quasi-coherent ideal of $\mathscr{O}_X$.\par
If $\mathscr{M}$ is a quasi-coherent graded $\mathscr{S}$-module and $\mathscr{I}$ is a quasi-coherent ideal of $\mathscr{O}_Y$, then $\mathscr{I}\mathscr{M}$ is a quasi-coherent graded sub-$\mathscr{S}$-module of $\mathscr{M}$ and we have $\widetilde{\mathscr{I}\mathscr{M}}=\mathscr{I}\cdot\bigtilde{\mathscr{M}}$: it suffices to verify this formula if $Y=\Spec(A)$, $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra, $\mathscr{M}=\widetilde{M}$ where $M$ is a graded $S$-module, and $\mathscr{I}=\widetilde{\a}$, where $\a$ is an ideal of $A$. For any homogeneous element $f$ of $S_+$, the restriction to $D_+(f)=\Spec(S_{(f)})$ of $\widetilde{\mathscr{I}\mathscr{M}}$ is the assocaited sheaf of $(\a M)_{(f)}=\a\cdot M_{(f)}$, and the identification is compatible with restrictions.
\begin{proposition}\label{scheme Proj of qcoh alg S(nd) on X_f prop}
Let $f\in\Gamma(Y,\mathscr{S}_d)$ with $d>0$. Over the open subset $X_f$, the $(\mathscr{O}_X|_{X_f})$-module $\widetilde{\mathscr{S}(nd)}|_{X_f}$ is canonically isomorphic to $\mathscr{O}_X|_{X_f}$ for any $n\in\Z$. In particular, if the $\mathscr{O}_Y$-algebra $\mathscr{S}$ is generated by $\mathscr{S}_1$, the $\mathscr{O}_X$-module $\widetilde{\mathscr{S}(n)}$ is invertible for all $n\in\Z$. 
\end{proposition}
\begin{proof}
For any affine open $U$ of $Y$, by \cref{scheme Proj qcoh S(nd) local is O_X} we have a canonical isomorphism $\widetilde{\mathscr{S}(nd)}|_{X_f\cap p^{-1}(U)}\cong\mathscr{O}_X|_{X_f\cap p^{-1}(U)}$, in view of \cref{scheme Proj of qcoh graded algebra X_f def} (where $p:X\to Y$ is the structural morphism). It is immediate that this isomorphism is compatible with restrictions, whence the first assertion. For the second one, if $\mathscr{S}$ is generated by $\mathscr{S}_1$, there exists an affine open cover $(U_\alpha)$ of $Y$ such that $\Gamma(U_\alpha,\mathscr{S})$ is generated by $\Gamma(U_\alpha,\mathscr{S}_1)=\Gamma(U_\alpha,\mathscr{S})_1$, and we can then use \cref{scheme Proj qcoh S(n) invertible if}.
\end{proof}
Again, for any integer $n\in\Z$ and any $\mathscr{O}_X$-module $\mathscr{F}$, we set
\[\mathscr{O}_X(n)=\widetilde{\mathscr{S}(n)},\quad \mathscr{F}(n)=\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{O}_X(n).\]
It follows from this definition that, for any open subset $U$ of $Y$,
\[\widetilde{\mathscr{S}|_U(n)}=\mathscr{O}_X|_{p^{-1}(U)},\]
where $p:X\to Y$ is the structural morphism.
\begin{proposition}\label{scheme Proj of qcoh module tensor and Hom prop}
Let $\mathscr{M}$ and $\mathscr{N}$ be quasi-coherent graded $\mathscr{S}$-modules. Then there exists cannical homomorphisms
\begin{equation*}
\begin{gathered}
\lambda:\widetilde{M}\otimes_{\mathscr{O}_X}\widetilde{\mathscr{N}}\to(\mathscr{M}\otimes_{\mathscr{S}}\mathscr{N})\widetilde{\hspace{3mm}}\\
\mu:(\sHom_{\mathscr{S}}(\mathscr{M},\mathscr{N}))\widetilde{\hspace{3mm}}\to\sHom_{\mathscr{O}_X}(\bigtilde{\mathscr{M}},\widetilde{\mathscr{N}}).
\end{gathered}
\end{equation*}
If $\mathscr{S}$ is generated by $\mathscr{S}_1$, then $\lambda$ is an isomorphism; if moreover $\mathscr{M}$ is of finite presentation, $\mu$ is an isomorphism. 
\end{proposition}
\begin{proof}
The isomorphisms $\lambda$ and $\mu$ are defined in the arguments before \cref{scheme Proj associated tensor and Hom char} if $Y$ is affine, and this definition is local and then glue together to define global morphisms, in view of the diagrams (\ref{scheme Proj base ring change tensor diagram}) and (\ref{scheme Proj base ring change Hom diagram}).
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh alg twisted sheaf tensor prop}
If $\mathscr{S}$ is generated by $\mathscr{S}_1$, for any integers $m,n\in\Z$, we have
\[\mathscr{O}_X(m)\otimes_{\mathscr{O}_X}\mathscr{O}_X(n)=\mathscr{O}_X(m+n),\quad \mathscr{O}_X(n)=\mathscr{O}_X^{\otimes 1}.\]
\end{corollary}
\begin{corollary}\label{scheme Proj of qcoh module twisted prop}
If $\mathscr{S}$ is generated by $\mathscr{S}_1$, for any quasi-coherent graded $\mathscr{S}$-module $\mathscr{M}$ and $n\in\Z$, we have 
\[\widetilde{\mathscr{M}(n)}=\bigtilde{\mathscr{M}}(n).\]
\end{corollary}
\begin{remark}\label{scheme Proj of polynomial algebra char}
If $\mathscr{S}=\mathscr{A}[T]$ where $\mathscr{A}$ is a quasi-coherent $\mathscr{O}_Y$-algebra, we verify immediately that the invertible $\mathscr{O}_X$-module $\mathscr{O}_X(n)$ is canonically isomorphic to $\mathscr{O}_X$. Moreover, let $\mathscr{N}$ be a quasi-coherent $\mathscr{A}$-module, and put $\mathscr{M}=\mathscr{N}\otimes_{\mathscr{A}}\mathscr{A}[T]$. It follows from \cref{scheme Proj of qcoh module on X_f prop} and \cref{scheme Proj of qcoh polynomial algebra} that under the canonical isomorphism of $X=\Proj(\mathscr{A}[T])$ and $X'=\Spec(\mathscr{A})$, the $\mathscr{O}_X$-module $\bigtilde{\mathscr{M}}$ is identified with the $\mathscr{O}_X$-module $\widetilde{\mathscr{N}}$.
\end{remark}
\begin{remark}\label{scheme Proj of alg alter ring twisted sheaf char}
Let $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra and define $\mathscr{S}'$ to be the $\mathscr{O}_Y$-algebra such that $\mathscr{S}'=\mathscr{O}_Y$ and $\mathscr{S}'_n=\mathscr{S}_n$ for $n>0$. Then the canonical isomorphism of $X=\Proj(\mathscr{S})$ and $\Proj(\mathscr{S}')$ identifies $\mathscr{O}_X(n)$ and $\mathscr{O}_{X'}(n)$ for any $n\in\Z$: this follows from the corresponding result in the affine case (\cref{scheme Proj S' and S^(d) twisted qcoh prop}) and the fact that this identification is compatible with restrictions. Similarly, let $X^{(d)}=\Proj(\mathscr{S}^{(d)})$; the canonical isomorphism of $X$ and $X^{(d)}$ identifies $\mathscr{O}_X(nd)$ with $\mathscr{O}_{X^{(d)}}(n)$ for any $n\in\Z$.
\end{remark}
\begin{proposition}\label{scheme Proj of qcoh alg ext by inv twisted prop}
Let $\mathscr{L}$ be an invertible $\mathscr{O}_Y$-module and $\psi$ be the structural morphism from $X_{(\mathscr{L})}=\Proj(\mathscr{S}_{(\mathscr{L})})$ to $X=\Proj(\mathscr{S})$. Then for any integer $n\in\Z$, $\psi_*(\mathscr{O}_{X_{(\mathscr{L})}}(n))$ is canonically isomorphic to $\mathscr{O}_X(n)\otimes_Y\mathscr{L}^{\otimes n}$.
\end{proposition}
\begin{proof}
Suppose first that $Y$ is affine with ring $A$ and $\mathscr{L}=\widetilde{L}$, where $L$ is a free $A$-module of rank $1$. With the notations of \cref{scheme Proj of qcoh graded algebra altering prop}(c), we define for each $f\in S_d$ an isomorphism from $S(n)_{(f)}\otimes_AL^{\otimes n}$ to $S_{(L)}(n)_{(f\otimes c^d)}$ which sends $(x/f^k)\otimes c^n$, where $x\in S_{kd+n}$, to the element $(x\otimes c^{n+kd})/(f\otimes c^d)^k$. It is immedaite that this isomorphism is independent of the generator $c$ of $L$, and is compatible with restrictions $D_+(f)\to D_+(fg)$. The general case then follows from glueing these isomorphisms.
\end{proof}
\subsection{Graded \texorpdfstring{$\mathscr{S}$}{S}-module assocaited with a sheaf}
For simplicity, in the following discussion, we always assume that the quasi-coherent $\mathscr{O}_Y$-algebra $\mathscr{S}$ is generated by $\mathscr{S}_1$, which by \cref{scheme Proj of qcoh graded algebra altering prop} is not at all essential if we impose the finiteness conditions of \cref{scheme qcoh algebra S^(d) generated by S_d if} on $Y$. Let $p:X\to Y$ be the structural morphism where $X=\Proj(\mathscr{S})$, which is separated by \cref{scheme Proj is separated}. For any $\mathscr{O}_X$-module $\mathscr{F}$, we define
\[\Gamma_*(\mathscr{F})=\bigoplus_{n\in\Z}p_*(\mathscr{F}(n))\]
and in particular
\[\Gamma_*(\mathscr{O}_X)=\bigoplus_{n\in\Z}p_*(\mathscr{O}_X(n)).\]
We have seen in (\ref{ringed space direct image and tensor-1}) that there exists a canonical homomorphism
\[p_*(\mathscr{F})\otimes_{\mathscr{O}_Y}p_*(\mathscr{G})\to p_*(\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{G})\]
for any $\mathscr{O}_X$-modules $\mathscr{F}$ and $\mathscr{G}$, so we deduce from \cref{scheme Proj of qcoh alg twisted sheaf tensor prop} that $\Gamma_*(\mathscr{O}_X)$ is endowed with a graded $\mathscr{O}_Y$-algebra structure and $\Gamma_*(\mathscr{F})$ is a graded module over $\Gamma_*(\mathscr{O}_X)$.\par
In view of \cref{scheme Proj of qcoh alg S(nd) on X_f prop} and the left-exactness of the functor $f_*$, $\Gamma_*(\mathscr{F})$ is an additive left-exact covariant functor from the category of $\mathscr{O}_X$-modules to the category of graded $\mathscr{O}_Y$-modules. In particular, if $\mathscr{I}$ is a sheaf of ideals of $\mathscr{O}_X$, $\Gamma_*(\mathscr{I})$ is identified with a sheaf of graded ideals of $\Gamma_*(\mathscr{O}_X)$.\par
Now let $\mathscr{M}$ be a quasi-coherent graded $\mathscr{S}$-module. For any affine open $U$ of $Y$, we have defined a homomorphism of abelian groups
\[\alpha_{0,U}:\Gamma(U,\mathscr{M}_0)\to\Gamma(p^{-1}(U),\bigtilde{\mathscr{M}}).\]
It is immediate that these homomorphisms commutes with restrictions and define (which do not use the hypothesis that $\mathscr{S}$ is generated by $\mathscr{S}_1$) a homomorphism of sheaf of abelian groups
\[\alpha_0:\mathscr{M}_0\to\bigtilde{\mathscr{M}}.\]
Apply this result to $\mathscr{M}_n=(\mathscr{M}(n))_0$ and use \cref{scheme Proj of qcoh module twisted prop}, we define a homomorphism of abelian groups
\begin{align}\label{scheme Proj of qcoh alg homomorphism alpha_n}
\alpha_n:\mathscr{M}_n\to p_*(\bigtilde{\mathscr{M}}(n))
\end{align}
for each $n\in\Z$, whence a functorial homomorphism of graded sheaves of abelian groups
\begin{align}\label{scheme Proj of qcoh alg homomorphism alpha}
\alpha:\mathscr{M}\to\Gamma_*(\bigtilde{\mathscr{M}})
\end{align}
(we also denote it by $\alpha_{\mathscr{M}}$). In the particular case $\mathscr{M}=\mathscr{S}$, we verify that $\alpha:\mathscr{S}\to\Gamma_*(\mathscr{O}_X)$ is a homomorphism of graded $\mathscr{O}_Y$-algebra and is a bi-homomorphism of graded modules, relative to this homomorphism of graded homomorphism of algebras.\par
We also remark that the homomorphism $\alpha_n$ corresponds to a canonical homomorphism of $\mathscr{O}_X$-modules
\[\alpha_n^{\sharp}:p^*(\mathscr{M}_n)\to\bigtilde{\mathscr{M}}(n).\]
Moreover, it is easy to verify that this homomorphism is none other than the associated homomorphism (by \cref{scheme Proj of qcoh alg associated functor exact}) of the canonical homomorphism $\mathscr{M}_n\otimes_{\mathscr{O}_Y}\mathscr{S}\to\mathscr{M}(n)$ of $\mathscr{O}_Y$-modules, where the $\mathscr{O}_Y$-module $\mathscr{M}_n\otimes_{\mathscr{O}_Y}\mathscr{S}$ is given the natrual graduation. To see this, we can in fact assume that $Y=\Spec(A)$ is affine, $\mathscr{M}=\widetilde{M}$ and $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra generated by $S_1$. Returning to the definition of $\alpha$, we see that the restriction to $D_+(f)$ of the homomorphism $\alpha_n^{\sharp}$ corresponds to the homomorphism $M_n\otimes_AS_{(f)}\to M(n)_{(f)}$, where $x\otimes 1$ is maped to $x/1$.
\begin{proposition}\label{scheme Proj of qcoh alg X_f char}
For any section $f\in\Gamma(Y,\mathscr{S}_d)$ with $d>0$, $X_f$ is identified with the set of points of $X$ on which $\alpha_d(f)$ is nonzero.
\end{proposition}
\begin{proof}
The element $\alpha_d(f)$ is a section of $p_*(\mathscr{O}_X(d))$ over $Y$, and by definition is then a section of $\mathscr{O}_X(d)$ over $X$. The definition of $X_f$ (\cref{scheme Proj of qcoh graded algebra X_f def}) proves our claim in the affine case, in view of \cref{scheme Proj D_+(f) nonzero lucus char}.
\end{proof}
We shall henceforth suppose, in addition to the hypothesis at the beginning of this paragraph, that for every quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $p_*(\mathscr{F}(n))$ is quasi-coherent over $Y$, and therefore $\Gamma_*(\mathscr{F})=\bigoplus_{n\in\Z}p_*(\mathscr{F}(n))$ is also a quasi-coherent $\mathscr{O}_Y$-module; this circumstance will always occur if $X$ is of finite type on $Y$ (\cref{scheme morphism qcqs qcoh direct image}). We then conclude that $\widetilde{\Gamma_*(\mathscr{F})}$ is defined and is a quasi-coherent $\mathscr{O}_X$-module. For any affine open subset $U$ of $Y$, we have (\cref{scheme affine associated sheaf ker and coker}, \cref{scheme Proj of qcoh alg associated functor exact}, and note that $U$ is quasi-compact)
\begin{align*}
\big(\Gamma(U,\bigoplus_{n\in\Z}p_*(\mathscr{F}(n)))\big)\widetilde{\hspace{3mm}}&=\bigoplus_{n\in\Z}\big(\Gamma(U,p_*(\mathscr{F}(n)))\big)\widetilde{\hspace{3mm}}=\bigoplus_{n\in\Z}\big(\Gamma(p^{-1}(U),\mathscr{F}(n))\big)\widetilde{\hspace{3mm}}\\
&=\Big(\bigoplus_{n\in\Z}\Gamma(p^{-1}(U),\mathscr{F}(n))\Big)\widetilde{\hspace{3mm}}=(\Gamma_*(\mathscr{F}|_{p^{-1}(U)}))\widetilde{\hspace{3mm}}
\end{align*}
and therefore a canonical homomorphism
\[\beta_U:\big(\Gamma(U,\bigoplus_{n\in\Z}p_*(\mathscr{F}(n)))\big)\widetilde{\hspace{3mm}}\to\mathscr{F}|_{p^{-1}(U)}.\]
Moreover, the diagram (\ref{scheme Proj qcoh associated beta diagram}) shows that these homomorphisms are compatible with restrictions on $Y$, so we deduce a canonical homomorphism
\[\beta:\widetilde{\Gamma_*(\mathscr{F})}\to\mathscr{F}\]
(also denoted by $\beta_{\mathscr{F}}$) for the quasi-coherent $\mathscr{O}_X$-modules.
\begin{proposition}\label{scheme Proj qcoh associated alpha and beta prop}
Let $\mathscr{M}$ be a quasi-coherent $\mathscr{S}$-module and $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module. Then the composition homomorphisms
\begin{gather}
\bigtilde{\mathscr{M}}\stackrel{\tilde{\alpha}}{\to}(\Gamma_*(\bigtilde{\mathscr{M}}))\widetilde{\hspace{3mm}}\stackrel{\beta}{\to}\bigtilde{\mathscr{M}}\label{scheme Proj qcoh associated alpha and beta prop-1}\\
\Gamma_*(\mathscr{F})\stackrel{\alpha}{\to}\Gamma_*(\widetilde{\Gamma_*(\mathscr{F})})\stackrel{\Gamma_*(\beta)}{\to}\Gamma_*(\mathscr{F})\label{scheme Proj qcoh associated alpha and beta prop-2}
\end{gather}
\end{proposition}
\begin{proof}
The question is local over $Y$, so we can apply \cref{scheme Proj associated module alpha and beta prop}.
\end{proof}
Again, the homomorphisms $\alpha$ and $\beta$ are in general not isomorphisms, and further finiteness conditions must be imposed. We note also that the homomorphism $\beta$ is not always defined, unlike the affine case. However, we shall see that if $\mathscr{S}$ is of finite type and generated by $\mathscr{S}_1$, the homomorphisms $\alpha$ and $\beta$ are well defined and the corresponding results of the affine cases carry over without difficulties.
\begin{proposition}\label{scheme Proj of qcoh alg ft if S_1 ft}
Let $Y$ be a scheme and $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra generated by $\mathscr{S}_1$. Suppose that $\mathscr{S}_1$ is of finite type, then $X=\Proj(\mathscr{S})$ is of finite type over $Y$.
\end{proposition}
\begin{proof}
Again we can assume that $Y$ is affine with ring $A$, so $\mathscr{S}=\widetilde{S}$ where $S$ is a graded $A$-algebra generated by $S_1$, and $S_1$ is a finitely generated $A$-module by hypothesis. Then $S$ is an $A$-algebra of finite type, and the proposition follows from \cref{scheme Proj Noe and ft if}.
\end{proof}
Let $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra and $\mathscr{M}$ be a quasi-coherent $\mathscr{S}$-module. We say that $\mathscr{M}$ is \textbf{eventually null} if there exists an integer $n$ such that $\mathscr{M}_k=0$ for $k\geq n$, and is \textbf{eventually finite} if there exists an integer $n$ such that the $\mathscr{S}$-module $\bigoplus_{k\geq n}\mathscr{M}_k$ is of finite type. If $\mathscr{M}$ is eventually null, it is clear that $\bigtilde{\mathscr{M}}=0$, as in the affine case.\par
Let $\mathscr{M}$ and $\mathscr{N}$ be quasi-coherent graded $\mathscr{S}$-modules. We say a homomorphism $u:\mathscr{M}\to\mathscr{N}$ of degree $0$ is eventually injective (resp. eventually sujective, eventually bijective) if there exists an integer $n$ such that $u_k:\mathscr{M}_k\to\mathscr{N}_k$ is injective (resp. surjective, bijective) for $k\geq n$. It is clear that in this case, $\tilde{u}:\bigtilde{\mathscr{M}}\to\widetilde{\mathscr{N}}$ is injective (resp. surjective, bijective), since this can be checked locally over $Y$ and we can apply \cref{scheme Proj of qcoh alg associated functor exact}. If $u$ is eventually bijective, we also say that it is an eventual isomorphism.
\begin{proposition}\label{scheme Proj of qcoh alg qc associated ft zero iff}
Let $Y$ be a scheme and $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra generated by $\mathscr{S}_1$ and such that $\mathscr{S}_1$ is of finite type. Let $\mathscr{M}$ be a quasi-coherent graded $\mathscr{S}$-module.
\begin{enumerate}
\item[(a)] If $\mathscr{M}$ is eventually finite, $\bigtilde{\mathscr{M}}$ is of finite type.
\item[(b)] If $\mathscr{M}$ is eventually finite, for $\bigtilde{\mathscr{M}}=0$, it is necessary and sufficient that $\mathscr{M}$ is eventually null.
\end{enumerate}
\end{proposition}
\begin{proof}
The question is local over $Y$, so we can assume that $Y=\Spec(A)$, and the proposition then follows from \cref{scheme Proj qc associated ft zero iff}.
\end{proof}
\begin{theorem}\label{scheme Proj of qcoh alg qc beta isomorphism}
Let $Y$ be a scheme and $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra generated by $\mathscr{S}_1$ and such that $\mathscr{S}_1$ is of finite type. Let $X=\Proj(\mathscr{S})$, then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphism $\beta:\widetilde{\Gamma(\mathscr{F})}\to\mathscr{F}$ is an isomorphism.
\end{theorem}
\begin{proof}
We first note that the homomorphism $\beta$ is defined because of \cref{scheme Proj of qcoh alg ft if S_1 ft}. To see that $\beta$ is an isomorphism, we can assume $Y=\Spec(A)$ is affine, and then apply \cref{scheme Proj qc beta isomorphism}.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh alg qc qcoh iso to assocaited ft}
Under the hypotheses of \cref{scheme Proj of qcoh alg qc beta isomorphism}, any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ is isomorphic to an $\mathscr{O}_X$-module of the form $\bigtilde{\mathscr{M}}$, where $\mathscr{M}$ is a quasi-coherent $\mathscr{S}$-module. If moreover $\mathscr{F}$ is of finite type, and if we suppose that $Y$ is a quasi-compact scheme, then we can choose $\mathscr{M}$ to be of finite type.
\end{corollary}
\begin{proof}
The first assertion follows from \cref{scheme Proj of qcoh alg qc beta isomorphism} by take $\mathscr{M}=\Gamma_*(\mathscr{F})$. For the second one, it suffices to prove that $\mathscr{M}$ is the inductive limit of graded sub-$\mathscr{S}$-modules of finite type $\mathscr{N}_\lambda$: in fact, it then follows that $\bigtilde{\mathscr{M}}$ is the inductive limit of the $\widetilde{\mathscr{N}}_\lambda$ (\cref{scheme Proj of qcoh alg associated functor exact}), hene $\mathscr{F}$ is the inductive limit of the $\beta(\mathscr{N}_\lambda)$. As $X$ is quasi-compact (\cref{scheme Proj of qcoh alg ft if S_1 ft}) and $\mathscr{F}$ is of finite type, $\mathscr{F}$ then necessarily equal to one of the $\beta(\widetilde{\mathscr{N}}_\lambda)$ (\cref{sheaf of module ft over qc surjective homomorphism prop}).\par
To define the $\mathscr{N}_\lambda$, it suffices to consider for each $n\in\Z$ the quasi-coherent $\mathscr{O}_Y$-module $\mathscr{M}_n$, which is the inductive limit of its sub-$\mathscr{O}_Y$-modules $\mathscr{M}_n^{(\mu_n)}$ of finite type (by \cref{scheme local Noe qcoh is inductive limit ft}). It is immediate that $\mathscr{P}_{\mu_n}=\mathscr{S}\cdot\mathscr{M}_n^{(\mu_n)}$ is a graded $\mathscr{S}_n$-module of finite type, and $\mathscr{M}$ is then the inductive limit of finite direct sums of these $\mathscr{S}$-modules.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh alg twisted sigma surjective}
Suppose the hypotheses of \cref{scheme Proj of qcoh alg qc beta isomorphism} and that $Y$ is quasi-compact. Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module of finite type. There exists an integer $n_0$ such that for $n\geq n_0$, the canonical homomorphism $\sigma:p^*(p_*(\mathscr{F}(n)))\to\mathscr{F}(n)$ is surjective.
\end{corollary}
\begin{proof}
For any $y\in Y$, let $U$ be an affine open neighborhood of $y$ in $Y$. There then exists an inter $n_0(U)$ such that, for $n\geq n_0(U)$, $\mathscr{F}(n)|_{p^{-1}(U)}$ is generated by finitely many sections over $p^{-1}(U)$ (\cref{scheme Proj qcoh iso to quotient of O_X^r}); but these are canonical images of sections of $p^*(p_*(\mathscr{F}(n)))$ over $p^{-1}(U)$, so $\mathscr{F}(n)|_{p^{-1}(U)}$ is equal to the canonical image of $p^*(p_*(\mathscr{F}(n)))|_{p^{-1}(U)}$. Finally, as $Y$ is quasi-compact, there is a finite affine open cover $(U_i)$ of $Y$, and we can choose $n_0$ to be the largest of the $n_0(U_i)$. 
\end{proof}
\begin{remark}\label{scheme qcoh sigma surjective iff global generation}
If $p:X\to Y$ is a morphism of ringed spaces and $\mathscr{F}$ is an $\mathscr{O}_X$-module, the fact that the canonical homomorphism $\sigma:p^*(p_*(\mathscr{F}))\to\mathscr{F}$ is surjective is explained as follows: for any $x\in X$ and any sections of $\mathscr{F}$ over an open neighborhood $V$ of $x$, there exists an open neighborhood $U$ of $p(x)$ in $Y$, finitely many sections $(t_i)_{1\leq i\leq m}$ of $\mathscr{F}$ over $p^{-1}(U)$, a neighborhood $W\sub V\cap p^{-1}(U)$ of $x$ and sections $(a_i)_{1\leq i\leq m}$ of $\mathscr{O}_X$ over $W$ such that
\[s|_W=\sum_ia_i\cdot(t_i|_W).\]

If $Y$ is an affine scheme and $p_*(\mathscr{F})$ is \textit{quasi-coherent}, this condition is equivalent to the fact that $\mathscr{F}$ is generated by its sections over $X$: in fact, if $Y=\Spec(A)$, we can suppose that $U=D(f)$ with $f\in A$. Since $p_*(\mathscr{F})$ is quasi-coherent, by \cref{scheme affine qcoh sheaf on qc open char} there exists an integer $n>0$ and sections $s_i$ of $\mathscr{F}$ over $X$ such that $g^nt_i$ is the restriction of $s_i$ (where $g=\rho(f)$, and $\rho:A\to\Gamma(X,\mathscr{O}_X)$ is the homomorphism corresponding to $p$ by \cref{scheme morphism to affine correspond}) to $p^{-1}(U)$. As $g$ is invertible over $p^{-1}(U)$, we then have
\[s|_W=\sum_ib_i\cdot(s_i|_W)\]
where $b_i=a_i\cdot(g|_W)^{-n}$, whence our assertion. Therefore, if $Y$ is affine, \cref{scheme Proj of qcoh alg twisted sigma surjective} then recovers \cref{scheme Proj qcoh iso to quotient of O_X^r}, in view of \cref{sheaf of module ft over qc global generated then finite}.\par
We finally conclude that if $Y$ is a scheme, then the following three conditions are equivalent for a quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ such that $p_*(\mathscr{F})$ is quasi-coherent:
\begin{enumerate}
\item[(\rmnum{1})] The canonical homomorphism $\sigma:p^*(p_*(\mathscr{F}))\to\mathscr{F}$ is surjective.
\item[(\rmnum{2})] There is a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{G}$ and a surjective homomorphism $p^*(\mathscr{G})\to\mathscr{F}$.
\item[(\rmnum{3})] For any affine open $U$ of $Y$, $\mathscr{F}|_{p^{-1}(U)}$ is generated by its sections over $p^{-1}(U)$.
\end{enumerate}
We have already established the equivalence of (\rmnum{1}) and (\rmnum{3}), and (\rmnum{1}) clearly implies (\rmnum{2}). conversely, any homomorphism $u:p^*(\mathscr{G})\to\mathscr{F}$ factors into $p^*(\mathscr{G})\to p^*(p_*(\mathscr{F}))\stackrel{\sigma}{\to}\mathscr{F}$ by (\ref{ringed space u^sharp factorization by sigma}), so if $u$ is surjective, so is the canonical homomorphism $\sigma:p^*(p_*(\mathscr{F}))\to\mathscr{F}$.
\end{remark}
\begin{corollary}\label{scheme Proj of qcoh alg qcoh ft is quotient}
Suppose the hypotheses of \cref{scheme Proj of qcoh alg qc beta isomorphism} and that $Y$ is quasi-compact. Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module of finite type. There then exists an integer $n_0$ such that for $n\geq n_0$, $\mathscr{F}$ is isomorphic to a quotient of an $\mathscr{O}_X$-module of the form $(p^*(\mathscr{G}))(-n)$, where $\mathscr{G}$ is a quasi-coherent $\mathscr{O}_Y$-module of finite type (dependent on $n$).
\end{corollary}
\begin{proof}
As the structural morphism $X\to Y$ is separated and of finite type, $p_*(\mathscr{F}(n))$ is quasi-coherent by \cref{scheme morphism qcqs qcoh direct image}, and so is the inductive limits of its sub-$\mathscr{O}_Y$-modules of finite type, in view of \cref{scheme local Noe qcoh is inductive limit ft}. Since $p^*$ commutes with inductive limits, we deduce from \cref{scheme Proj of qcoh alg twisted sigma surjective} and \cref{sheaf of module ft over qc surjective homomorphism prop} that $\mathscr{F}(n)$ is the canonical image under $\sigma_{\mathscr{F}(n)}$ of an $\mathscr{O}_X$-module of the form $p^*(\mathscr{G})$, where $\mathscr{G}$ is a quasi-coherent sub-$\mathscr{O}_Y$-module of $p_*(\mathscr{F}(n))$ of finite type. The corollary then follows from \cref{scheme Proj of qcoh alg twisted sheaf tensor prop} and \cref{scheme Proj of qcoh module twisted prop}.
\end{proof}
\subsection{Functorial properties of \texorpdfstring{$\Proj(\mathscr{S})$}{Proj}}
Let $Y$ be a scheme and $\mathscr{S},\mathscr{S}'$ be two quasi-coherent graded $\mathscr{O}_Y$-algebras with positive degrees. Let $X=\Proj(\mathscr{S})$, $X'=\Proj(\mathscr{S}')$, and $p,p'$ be the structural morphisms of $X$ and $X'$, respectively. Let $\varphi:\mathscr{S}'\to\mathscr{S}$ be an $\mathscr{O}_Y$-homomorphism of graded algebras. For any affine open $U$ of $Y$, let $S_U=\Gamma(U,\mathscr{S})$, $S'_U=\Gamma(U,\mathscr{S}')$; the homomorphism $\varphi$ defines a homomorphism $\varphi_U:S'_U\to S_U$ of graded $A_U$-algebras, where $A_U=\Gamma(U,\mathscr{O}_Y)$. It then corresponds to an open subset $G(\varphi_U)$ of $p^{-1}(U)$ and a morphism $\Phi_U:G(\varphi_U)\to p'^{-1}(U)$. Moreover, if $V\sub U$ is another affine open subset, the diagram
\begin{equation}\label{scheme Proj of qcoh alg S_U diagram}
\begin{tikzcd}
S'_U\ar[d]\ar[r,"\varphi_U"]&S_U\ar[d]\\
S'_V\ar[r,"\varphi_V"]&S_V
\end{tikzcd}
\end{equation}
is commutative, and we also verify, by the definition of $G(\varphi_U)$, that
\[G(\varphi_V)=G(\varphi_U)\cap p^{-1}(V)\]
and that $\Phi_V$ is the restriction of $\Phi_U$ to $G(\varphi_V)$. We thus define an open subset $G(\varphi)$ of $X$ such that $G(\varphi)\cap p^{-1}(U)=G(\varphi_U)$ for any affine open $U\sub Y$, and an affine $Y$-morphism $\Phi:G(\varphi)\to X'$, which is called the morphism associated with $\varphi$ and denoted by $\Proj(\varphi)$. If for any $y\in Y$, there exists an affine open neighborhood $U$ of $Y$ such that $\Gamma(U,\mathscr{O}_Y)$-module $\Gamma(U,\mathscr{S}_+)$ is generated by $\varphi(\Gamma(U,\mathscr{S}'_+))$, we then have $G(\varphi_U)=p^{-1}(U)$, and thus $G(\varphi)=X$.
\begin{proposition}\label{scheme Proj of qcoh alg inverse and direct char}
Let $\mathscr{M}$ (resp. $\mathscr{M}'$) be a quasi-coherent graded $\mathscr{S}$-module (resp. $\mathscr{S}'$-module). Then there exist a canonical isomorphism $\widetilde{\varphi^*(\mathscr{M})}\stackrel{\sim}{\to}\Phi_*(\bigtilde{\mathscr{M}}|_{G(\varphi)})$ of $\mathscr{O}_{X'}$-modules and a canonical homomorphism $\nu:\Phi^*(\bigtilde{\mathscr{M}}')\to\widetilde{\varphi_*(\mathscr{M}')}|_{G(\varphi)}$. If $\mathscr{S}'$ is generated by $\mathscr{S}'_1$, $\nu$ is an isomorphism. 
\end{proposition}
\begin{proof}
The homomorphisms considered are in fact already defined locally over $Y$ (see \cref{scheme Proj associated sheaf direct image char} and \cref{scheme Proj associated sheaf inverse image char}), and the general case then follows from their compatibility with restrictions, and diagram (\ref{scheme Proj of qcoh alg S_U diagram}).
\end{proof}
In particular, for any $n\in\Z$, we have a canonical homomorphism $\Phi^*(\mathscr{O}_{X'}(n))\to\mathscr{O}_X(n)|_{G(\varphi)}$, and this is a homomorphism if $\mathscr{S}'$ is generated by $\mathscr{S}'_1$.
\begin{proposition}\label{scheme Proj of qcoh alg base change prop}
Let $Y$, $Y'$ be schemes, $\psi:Y'\to Y$ be a morphism, $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra, and put $\mathscr{S}'=\psi^*(\mathscr{S})$. Then the $Y'$-scheme $X'=\Proj(\mathscr{S}')$ is canonically identified with $\Proj(\mathscr{S})\times_YY'$. Moreover, if $\mathscr{M}$ is a quasi-coherent graded $\mathscr{S}$-module, the $\mathscr{O}_{X'}$-module $\widetilde{\psi^*(\mathscr{M})}$ is identified with $\bigtilde{\mathscr{M}}\otimes_Y\mathscr{O}_{Y'}$.
\end{proposition}
\begin{proof}
We first note that $\psi^*(\mathscr{S})$ and $\psi^*(\mathscr{M})$ are quasi-coherent $\mathscr{O}_{Y'}$-modules. Let $U$ be an affine open of $Y$, $U'\sub\psi^{-1}(U)$ an affine open of $Y'$, and $A,A'$ the ring of $U,U'$, respectively. We then have $\mathscr{S}|_U=\widetilde{S}$ where $S$ is a graded $A$-algebra, and $\mathscr{S}'|_{U'}$ is identified with $\widetilde{S\otimes_AA'}$ by \cref{scheme affine associated sheaf inverse image char}. The first assertion then follows from \cref{scheme Proj base ring change prop} and \cref{scheme product inverse image of base open}, since we can easily verify that the projection $\Proj(\mathscr{S}'|_{U'})\to\Proj(\mathscr{S}|_{U})$ defined by this identification is compatible with restrictions over $U$ and $U'$ and therefore define a morphism $\Proj(\mathscr{S}')\to\Proj(\mathscr{S})$. Now let $p:\Proj(\mathscr{S})\to Y$ and $p':\Proj(\mathscr{S}')\to Y'$ be the structural morphisms; $p'^{-1}(U')$ is identified with $p^{-1}(U)\times_UU'$, and the two sheaves $\widetilde{\psi^*(\mathscr{M})}|_{p'^{-1}(U')}$ and $\bigtilde{\mathscr{M}}\otimes_{Y}\mathscr{O}_{Y'}|_{p'^{-1}(U')}$ are then canonically identified to $\widetilde{M\otimes_AA'}$, where $M=\Gamma(U,\mathscr{M})$, in view of \cref{scheme Proj base ring change prop} and \cref{scheme affine associated sheaf inverse image char}; whence the second assertion, since these identifications are compatible with restrictions.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh alg base change twisted sheaf prop}
With the notations of \cref{scheme Proj of qcoh alg base change prop}, $\mathscr{O}_{X'}(n)$ is canonically identified with $\mathscr{O}_X(n)\otimes_{Y}\mathscr{O}_{Y'}$ for any $n\in\Z$.
\end{corollary}
\begin{proof}
With the notations of \cref{scheme Proj of qcoh alg base change prop}, it is clear that $\psi^*(\mathscr{S}(n))=\mathscr{S}'(n)$ for any $n\in\Z$, whence the corollary.
\end{proof}
Retain the notations in \cref{scheme Proj of qcoh alg base change prop}, denote by $\Psi:X'\to X$ the canonical projection, and put $\mathscr{M}'=\psi^*(\mathscr{M})$. We suppose that $\mathscr{S}$ is generated by $\mathscr{S}_1$ and that $X$ is of finite type over $Y$ (for example if $\mathscr{S}_1$ is of finite type, cf. \cref{scheme Proj of qcoh alg ft if S_1 ft}). Then $\mathscr{S}'$ is generated by $\mathscr{S}'_1$ (as can be checked locally on affine opens of $Y$) and $X'$ is of finite type over $Y$ by \cref{scheme morphism ft permanence prop}. Let $\mathscr{F}$ be an $\mathscr{O}_X$-module and set $\mathscr{F}'=\Psi^*(\mathscr{F})$; it then follows from \cref{scheme Proj of qcoh alg base change twisted sheaf prop} that we have $\mathscr{F}'(n)=\Psi^*(\mathscr{F})$ for each $n\in\Z$. We define a canonical $\Psi$-homomorphism $\theta_n:p_*(\mathscr{F}(n))\to p'_*(\mathscr{F}'(n))$ as follows: from the commutative diagram
\[\begin{tikzcd}
X'\ar[d,swap,"p'"]\ar[r,"\Psi"]&X\ar[d,"p"]\\
Y'\ar[r,"\psi"]&Y
\end{tikzcd}\]
we see that it suffices to define a homomorphism
\[p_*(\mathscr{F}(n))\to\psi_*(q'_*(\Psi^*(\mathscr{F}(n))))=q_*(\Psi_*(\Psi^*(\mathscr{F}(n)))),\]
and we can take $\theta_n=p_*(\rho_n)$, where $\rho_n$ is the canonical homomorphism $\rho_n:\mathscr{F}(n)\to\Psi_*(\Psi^*(\mathscr{F}(n)))$. It is immediate that for any affine open $U$ of $Y$ and any affine open $U'$ of $Y$ such that $U'\sub\psi^{-1}(U)$, the homomorphism $\theta_n$ thus defined gives a canonical homomorphism $\Gamma(p^{-1}(U),\mathscr{F}(n))\to\Gamma(p'^{-1}(U'),\mathscr{F}'(n))$, and the commutative diagram (\ref{scheme Proj qcoh associated beta diagram}) shows that if $\mathscr{F}$ is quasi-coherent, the diagram
\[\begin{tikzcd}
\widetilde{\Gamma_*(\mathscr{F})}\ar[d,swap,"\beta_{\mathscr{F}}"]\ar[r,"\tilde{\theta}"]&\widetilde{\Gamma_*(\mathscr{F}')}\ar[d,"\beta_{\mathscr{F}'}"]\\
\mathscr{F}\ar[r,"\rho"]&\mathscr{F}'
\end{tikzcd}\]
is commutative (where the send row is the canonical $\Psi$-morphism $\mathscr{F}\to\Phi^*(\mathscr{F})$).\par
Similarly, the commutative diagram (\ref{scheme Proj qcoh associated alpha diagram}) shows that the diagram
\[\begin{tikzcd}
\mathscr{M}\ar[d,"\alpha_{\mathscr{M}}"]\ar[r,"\rho"]&\mathscr{M}'\ar[d,"\alpha_{\mathscr{M}'}"]\\
\Gamma_*(\bigtilde{\mathscr{M}})\ar[r,"\theta"]&\Gamma_*(\widetilde{\mathscr{M}'})
\end{tikzcd}\]
is commutative (where the first row is the canonical $\psi$-morphism $\mathscr{M}\to\psi^*(\mathscr{M})$).\par
Consider now a morphism $\psi:Y'\to Y$ of schemes, a quasi-coherent graded $\mathscr{O}_Y$-algebra (resp. $\mathscr{O}_{Y'}$-algebra) $\mathscr{S}$ (resp. $\mathscr{S}'$), and a $\psi$-morphism $u:\mathscr{S}\to\mathscr{S}'$ of graded algebras. This is equivalent to giving an $\mathscr{O}_{Y'}$-homomorphism of graded algebras $u^{\sharp}:\psi_*(\mathscr{S})\to\mathscr{S}'$, and we deduce from $u^{\sharp}$ an $Y'$-morphism
\[w=\Proj(u^{\sharp}):G(u^{\sharp})\to\Proj(\psi^*(\mathscr{S})),\]
where $G(u^{\sharp})$ is an open subset of $X'=\Proj(\mathscr{S}')$. On the other hand, $\Proj(\psi^*(\mathscr{S}))$ is canonically identified with $X\times_YY'$, where $X=\Proj(\mathscr{S})$ (\cref{scheme Proj of qcoh alg base change prop}). By composing the morphism $\Proj(u^{\sharp})$ with the first projection $\pi:X\times_YY'\to X$, we then obtain a morphism $v=\Proj(u):G(u^{\sharp})\to X$ such that the diagram
\begin{equation}\label{scheme Proj qcoh of algebra homomorphism induce morphism diagram}
\begin{tikzcd}
G(u^{\sharp})\ar[d]\ar[r,"v"]&X\ar[d]\\
Y'\ar[r,"\psi"]&Y
\end{tikzcd}
\end{equation}
is commutative. Moreover, for any quasi-coherent $\mathscr{O}_Y$-module $\mathscr{M}$, we have a canonical $v$-morphism
\begin{align}\label{scheme Proj qcoh of algebra homomorphism induce nu}
\nu:\bigtilde{\mathscr{M}}\to (\psi^*(\mathscr{M})\otimes_{\psi^*(\mathscr{S})}\mathscr{S}')\widetilde{\hspace{3mm}}|_{G(u^{\sharp})}
\end{align}
such that $\nu^{\sharp}$ is the composition
\begin{align}\label{scheme Proj qcoh of algebra homomorphism induce nu^sharp}
v^*(\bigtilde{\mathscr{M}})=w^*(\pi^*(\bigtilde{\mathscr{M}}))\stackrel{\sim}{\to}w^*(\widetilde{\psi^*(\mathscr{M})})\stackrel{\nu}{\to}(\psi^*(\mathscr{M})\otimes_{\psi^*(\mathscr{M})}\mathscr{S}')\widetilde{\hspace{3mm}}|_{G(u^{\sharp})}
\end{align}
where the first arrow is the isomorphism in \cref{scheme Proj of qcoh alg base change prop} and the second one is the homomorphism $\nu$ of \cref{scheme Proj of qcoh alg inverse and direct char}. If $\mathscr{S}$ is generated by $\mathscr{S}_1$, then it follows from \cref{scheme Proj of qcoh alg inverse and direct char} that $\nu^{\sharp}$ is an isomorphism. As a particular case, for any $n\in\Z$ we have a canonical $v$-homomorphism
\begin{align}\label{scheme Proj qcoh of algebra homomorphism induce nu on twisted}
\nu:\mathscr{O}_X(n)\to\mathscr{O}_{X'}(n)|_{G(u^{\sharp})}.
\end{align}
\subsection{Closed subschemes of \texorpdfstring{$\Proj(\mathscr{S})$}{Proj}}
Let $Y$ be a scheme and $\varphi:\mathscr{S}\to\mathscr{S}'$ be a homomorphism of quasi-coherent graded $\mathscr{O}_Y$-algebras of degree $0$. We say that $\varphi$ is \textbf{eventually injective} (resp. \textbf{eventually surjective}, \textbf{eventually bijective}) if there exists an integer $n$ such that, for $k\geq n$, $\varphi_k:\mathscr{S}_k\to\mathscr{S}_k'$ is surjective (resp. injective, bijective). If this is the case, we can then reduce the study of the morphism $\Phi:\Proj(\mathscr{S}')\to\Proj(\mathscr{S})$ to the case where $\varphi$ is surjective (resp. injective, bijective) (this follows from \cref{scheme Proj of qcoh graded algebra altering prop}). If $\varphi$ is eventually bijective, we also say that $\varphi$ is an \textbf{eventual isomorphism}.
\begin{proposition}\label{scheme Proj of qcoh algera closed subscheme char}
Let $Y$ be a scheme, $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra, and $X=\Proj(\mathscr{S})$.
\begin{enumerate}
\item[(a)] If $\varphi:\mathscr{S}\to\mathscr{S}'$ is a eventually surjective homomorphism of graded $\mathscr{O}_Y$-algebra, the corresponding morphism $\Phi=\Proj(\varphi)$ is defined over $\Proj(\mathscr{S}')$ and is a closed immersion from $\Proj(\mathscr{S}')$ into $X$. If $\mathscr{I}$ is the kernel of $\varphi$, the closed subscheme of $X$ associated with $\Phi$ is defined by the quasi-coherent ideal $\widetilde{\mathscr{I}}$ of $\mathscr{O}_X$.
\item[(b)] Suppose moreover that $\mathscr{S}_0=\mathscr{O}_Y$ and $\mathscr{S}$ is generated by $\mathscr{S}_1$ where $\mathscr{S}_1$ is of finite type. Let $X'$ be a closed subscheme of $X$ defined by a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$. Let $\mathscr{J}$ be the inverse image of $\Gamma_*(\mathscr{I})$ under the canonical homomorphism $\alpha:\mathscr{S}\to\Gamma_*(\mathscr{O}_X)$ and put $\mathscr{S}'=\mathscr{S}/\mathscr{J}$. Then $X'$ is the subscheme associated with the closed immersion $\Proj(\mathscr{S}')\to X$ corresponding to the canonical homomorphism $\mathscr{S}\to\mathscr{S}'$ of graded $\mathscr{O}_Y$-algebras. 
\end{enumerate}
\end{proposition}
\begin{proof}
For the assertion of (a), we can assume that $\varphi$ is surjective. Then for any affine open $U$ of $Y$, $\Gamma(U,\mathscr{S})\to\Gamma(U,\mathscr{S}')$ is surjective by \cref{scheme affine associated sheaf ker and coker}, so we have $G(\varphi)=X$.  We are immediately reduced to the case where $Y$ is affine, and the assertion follows from \cref{scheme Proj closed immersion char}(a).\par
As for case (b), we are reduced to prove that the homomorphism $\widetilde{\mathscr{J}}\to\mathscr{O}_X$ induced from the canonical injection $\mathscr{J}\to\mathscr{S}$ is an isomorphism from $\widetilde{\mathscr{J}}$ to $\mathscr{I}$. As the question is local, we can assume that $Y$ is affine with ring $A$, which implies $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra generated by $S_1$ and $S_1$ is of finite type over $A$. It then suffices to apply \cref{scheme Proj closed immersion char}(b).
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh algera closed subscheme twisted sheaf char}
Under the hypotheses of \cref{scheme Proj of qcoh algera closed subscheme char}(a), suppose that $\mathscr{S}$ is generated by $\mathscr{S}_1$. Then $\Phi^*(\mathscr{O}_X(n))$ is canonically identified with $\mathscr{O}_{X'}(n)$ for any $n\in\Z$.
\end{corollary}
\begin{proof}
We have defined such an isomorphism if $Y$ is affine; in the general case, it suffices to verify that these isomorphisms are compatible with restrictions.
\end{proof}
\begin{corollary}\label{scheme Proj of qcoh algera homomorphism to sym}
Let $Y$ be a scheme, $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra generated by $\mathscr{S}_1$, $\mathscr{M}$ be a quasi-coherent $\mathscr{O}_Y$-module, and $u:\mathscr{M}\to\mathscr{S}_1$ be a surjective $\mathscr{O}_Y$-homomorphism. If $\bar{u}:\bm{S}(\mathscr{M})\to\mathscr{S}$ is the canonical homomorphism of $\mathscr{O}_Y$-algebras extending $u$, then the morphism corresponding to $\bar{u}$ is a closed immersion from $\Proj(\mathscr{S})$ into $\Proj(\bm{S}(\mathscr{M}))$.
\end{corollary}
\begin{proof}
In fact, $\bar{u}$ is surjective by hypothesis, so we can apply \cref{scheme Proj of qcoh algera closed subscheme char}(a). 
\end{proof}
\subsection{Morphisms into \texorpdfstring{$\Proj(\mathscr{S})$}{Proj}}
Let $q:X\to Y$ be a morphism of schemes, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, and $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra with positive degrees. Then $q^*(\mathscr{S})$ is a quasi-coherent graded $\mathscr{O}_X$-algebra with positive degrees. Suppose that we are given a graded homomorphism of $\mathscr{O}_X$-algebras
\[\psi:q^*(\mathscr{S})\to\bm{S}(\mathscr{L})=\bigoplus_{n\geq 0}\mathscr{L}^{\otimes n}\]
(recall that for an invertible $\mathscr{O}_X$-module $\mathscr{L}$ we have $\bm{T}(\mathscr{L})=\bm{S}(\mathscr{L})$) or equivalently, a $\mathscr{O}_Y$-homorphism of graded algebras
\[\psi^{\flat}:\mathscr{S}\to q_*(\bm{S}(\mathscr{L})).\]
Since $\mathscr{L}$ is invertible and $\bm{T}(\mathscr{O}_X)=\bm{S}(\mathscr{O}_X)=\mathscr{O}_X[T]$, by \cref{scheme Proj of qcoh graded algebra altering prop} and \cref{scheme Proj of qcoh polynomial algebra} we know that $\Proj(\bm{S}(\mathscr{L}))$ is canonically identified with $X$. We then conclude that the homomorphism $\psi$ induces a $Y$-morphism
\[r_{\mathscr{L},\psi}:G(\psi)\to\Proj(\mathscr{S})=P,\]
where $G(\psi)$ is an open subset of $X$. Recall that this morphism is by definition obtained by composing the first projection $\pi:\Proj(q^*(\mathscr{S}))=P\times_YX\to P$ with the $Y$-morphism $\tau=\Proj(\psi):G(\psi)\to\Proj(q^*(\mathscr{S}))$, which is shown in the following diagram:
\[\begin{tikzcd}[row sep=15mm,column sep=15mm]
&P\times_YX\ar[d]\ar[r,"\pi"]&P\ar[d,"p"]\\
G(\psi)\ar[rru,bend left=60pt,"r_{\mathscr{L},\psi}"description]\ar[ru,"\tau=\Proj(\psi)"description]\ar[r]&X\ar[r,"q"]&Y
\end{tikzcd}\]
\begin{remark}\label{scheme morphism into Proj affine discription}
Let us explain the morphism $r=r_{\mathscr{L},\psi}$ when $Y=\Spec(A)$ is affine, and therefore $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra with positive degrees. First suppose that $X=\Spec(B)$ is also affine and $\mathscr{L}=\widetilde{L}$, where $L$ is a free $B$-module of rank $1$. We then have $q^*(\mathscr{S})=\widetilde{S\otimes_AB}$ by \cref{scheme affine associated sheaf inverse image char}. If $c$ is a generator of $L$, the homomorphism $\psi_n:q^*(\mathscr{S}_n)\to\mathscr{L}^{\otimes n}$ then corresponds to a $B$-homomorphism 
\begin{align}\label{scheme morphism to Proj affine morphism w and v}
w_n:S_n\otimes_AB\to L^{\otimes n},\quad s\otimes b\mapsto bv_n(s)c^{\otimes n},
\end{align}
where $v_n:S_n\to B$ is the $n$-th component of a homomorphism $v:S\to B$ of algebras. Let $f\in S_d$ with positive degree and put $g=v_d(f)$. We have $\pi^{-1}(D_+(f))=D_+(f\otimes 1)$ in view of \cref{scheme Proj base ring change prop} and the identification of $D_+(f)$ with $\Spec(S_{(f)})$. On the other hand, the formula (\ref{scheme Proj induced morphism standard open inverse image}) and (\ref{scheme morphism to Proj affine morphism w and v}) shows that (using the canonical isomorphism of $X$ and $\Proj(\bm{S}(\mathscr{L}))$)
\[\tau^{-1}(D_+(f\otimes 1))=D(g)\]
whence $r^{-1}(D_+(f))=D(g)$. Furthermore, the restriction of the morphism $\tau=\Proj(\psi)$ to $D(g)$ corresponds to the homomorphism $(S\otimes_AB)_{(f\otimes 1)}\to B_g$, which send $(s\otimes 1)/(f\otimes 1)^n$ (for $s\in S_{nd}$) to $v_{nd}(s)/g^n$, and the restriction of the projection $\pi$ to $D_+(f\otimes 1)$ corresponds to the homomorphism $S_{(f)}\to(S\otimes_AB)_{(f\otimes 1)}$ given by $s/f^n\mapsto(s\otimes 1)/(f\otimes 1)^n$. We then conclude that the restriction of the morphism $r$ to $D(g)$ corresponds to the homomorphisms $\omega:S_{(f)}\to B_g$ of $A$-algebras such that $\omega(s/f^n)=v_{nd}(s)/g^n$ for $s\in S_{nd}$.
\end{remark}
\begin{proposition}\label{scheme morphism into Proj affine D_+(f) preimage char}
Let $Y=\Spec(A)$ be affine and $\mathscr{S}=\widetilde{S}$, where $S$ is a graded $A$-algebra. For any $f\in S_d=\Gamma(Y,\mathscr{S}_d)$, we have (where $\psi^{\flat}(f)\in\Gamma(X,\mathscr{L}^{\otimes d})$)
\begin{align}\label{scheme morphism into Proj affine D_+(f) preimage char-1}
r_{\mathscr{L},\psi}^{-1}(D_+(f))=X_{\psi^{\flat}(f)}.
\end{align}
Moreover, under the canonical isomorphism of $X$ and $\Proj(\bm{S}(\mathscr{L}))$, the restriction morphism $r_{\mathscr{L},\psi}:X_{\psi^{\flat}(f)}\to D_+(f)=\Spec(S_{(f)})$ corresponds to the homomorphism
\[\psi_{(f)}^{\flat}:S_{(f)}\to\Gamma(X_{\psi^{\flat}(f)},\mathscr{O}_X)\]
such that, for any $s\in S_{nd}=\Gamma(Y,\mathscr{S}_{nd})$, we have
\[\psi^{\flat}_{(f)}(s/f^n)=(\psi^{\flat}(s)|_{X_{\psi^{\flat}(f)}})(\psi^{\flat}(f)|_{X_{\psi^{\flat}(f)}})^{-n}.\]
\end{proposition}
\begin{proof}
This follows from \cref{scheme morphism into Proj affine discription} by passing to the general case.
\end{proof}
We say the morphism $r_{\mathscr{L},\psi}$ is \textbf{everywhere defined} if $G(\psi)=X$. For this to be the case, it is necessary and sufficient that $G(\psi)\cap q^{-1}(U)=q^{-1}(U)$ for any affine open $U\sub Y$, so this question is local over $Y$. If $Y$ is affine, $G(\psi)$ is then the union of $r^{-1}(D_+(f))$ for $f\in S_+$, so by (\ref{scheme morphism into Proj affine D_+(f) preimage char-1}) the $X_{\psi^{\flat}(f)}$ then form a covering of $X$. In other words:
\begin{corollary}\label{scheme morphism into Proj affine everywhere defined iff}
Under the hypotheses of \cref{scheme morphism into Proj affine D_+(f) preimage char}, for the morphism $r_{\mathscr{L},\psi}$ to be everywhere defined, it is necessary and sufficient that for any $x\in X$, there exists an integer $n>0$ and a section $s\in S_n$ such that $t=\psi^{\flat}(s)\in\Gamma(X,\mathscr{L}^{\otimes n})$ is nonzero at $x$. In particular, this is true if $\psi$ is eventually surjective.
\end{corollary}
\begin{corollary}\label{scheme morphism into Proj affine dominant iff}
Under the hypotheses of \cref{scheme morphism into Proj affine D_+(f) preimage char}, for the morphism $r_{\mathscr{L},\psi}$ to be dominant, it is necessary and sufficient that for any integer $n>0$, any section $s\in S_n$ such that $\psi^{\flat}(b)\in\Gamma(X,\mathscr{L}^{\otimes n})$ is locally nilpotent, is itself nilpotent.
\end{corollary}
\begin{proof}
We must check that $r_{\mathscr{L},\psi}^{-1}(D_+(s))$ is nonempty if $D_+(s)$ is nonempty, and the corollary follows from (\ref{scheme morphism into Proj affine D_+(f) preimage char-1}) and \cref{scheme Proj D_+(f) empty iff nilpotent}. 
\end{proof}
\begin{proposition}\label{scheme morphism into Proj algebra homomorphism prop}
Let $q:X\to Y$ be a morphism, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, and $\mathscr{S}$, $\mathscr{S}'$ be quasi-coherent graded $\mathscr{O}_Y$-algebras. Let $u:\mathscr{S}'\to\mathscr{S}$ be a homomorphism of graded algebras, $\psi:q^*(\mathscr{S})\to\bm{S}(\mathscr{L})$ be a homomorphism of graded algebras, and $\psi'=\psi\circ q^*(u)$ be the composition.
\begin{enumerate}
\item[(\rmnum{1})] If $r_{\mathscr{L},\psi'}$ is everywhere defined, then $r_{\mathscr{L},\psi}$ is everywhere defined;
\item[(\rmnum{2})] If $u$ is eventually surjective and $r_{\mathscr{L},\psi'}$ is dominant, then $r_{\mathscr{L},\psi}$ is dominant;
\item[(\rmnum{3})] If $u$ is eventually injective and $r_{\mathscr{L},\psi}$ is dominant, then $r_{\mathscr{L},\psi}$ is dominant.
\end{enumerate}
\end{proposition}
\begin{proof}
We have $G(\psi')\sub G(\psi)$, whence the first assertion. If $u$ is eventually surjective, $\Proj(u):\Proj(S)\to\Proj(S')$ is everywhere defined and is a closed immersion; as $r_{\mathscr{L},\psi'}$ is the composition of $\Proj(u)$ and the restriction of $r_{\mathscr{L},\psi}$ to $G(\psi')$, we then conclude that if $r_{\mathscr{L},\psi'}$ is dominant, so is $r_{\mathscr{L},\psi}$. Finally, if $u$ is eventually injective, then $\Proj(u)$ is a dominant morphism from $G(u)$ into $\Proj(\mathscr{S}')$ (\cref{scheme Proj morphism associated prop}); as $G(\psi')$ is the inverse image of $G(u)$ under $r_{\mathscr{L},\psi}$, we see that if $r_{\mathscr{L},\psi}$ is dominant, so is $r_{\mathscr{L},\psi'}$.
\end{proof}
\begin{proposition}\label{scheme morphism into Proj limit everywhere defined prop}
Let $Y$ be a quasi-compact scheme, $q:X\to Y$ be a quasi-compact morphism, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, and $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra which is the filtered limit of a system $(\mathscr{S}^\lambda)$ of quasi-coherent $\mathscr{O}_Y$-algebras. Let $\varphi_\lambda:\mathscr{S}^\lambda\to\mathscr{S}$ be the canonical homomorphism, $\psi:q^*(\mathscr{S})\to\bm{S}(\mathscr{L})$ be a homomorphism of graded algebras, and put $\psi_\lambda=\psi\circ q^*(\varphi_\lambda)$. Then for the morphism $r_{\mathscr{L},\psi}$ to be everywhere defined, it is necessary and sufficient that there exists an index $\lambda$ such that $r_{\mathscr{L},\psi_\lambda}$ is everywhere defined; in this case, $r_{\mathscr{L},\psi_\mu}$ is everywhere defined for $\mu\geq\lambda$.
\end{proposition}
\begin{proof}
The condition is sufficient in view of \cref{scheme morphism into Proj algebra homomorphism prop}. Conversely, suppose that $r_{\mathscr{L},\psi}$ is everywhere defined; we can assume that $Y$ is affine, because if for any affine open $U\sub Y$ there exists $\lambda(U)$ such that the restriction of $r_{\mathscr{L},\psi_{\lambda_{\lambda(U)}}}$ to $q^{-1}(U)$ is defined everywhere, it then suffices to cover $Y$ by finitely many affine opens $U_i$ (recall that $Y$ is quasi-compact) and choose $\lambda\geq\lambda(U_i)$ for all $i$, by \cref{scheme morphism into Proj algebra homomorphism prop}. If $Y$ is affine (so $\mathscr{S}=\widetilde{S}$ where $S=\Gamma(Y,\mathscr{S})$) the hypotheses implies that for any $x\in X$, there exists a section $s^{(x)}\in S_n$ for some integer $n$ such that, if $t^{(x)}=\psi^{\flat}(s^{(x)})$, then $t^{(x)}(x)\neq 0$ (where $t^{(x)}$ is a section of $\mathscr{L}^{\otimes n}$ over $X$), which implices $t^{(x)}(z)\neq 0$ for $z$ in a neighborhood $V(x)$ of $X$. As the morphism $q:X\to Y$ is quasi-compact, we see $X$ is quasi-compact, so we can cover $X$ by finitely many $V(x_i)$ and let $s^{(i)}$ be the corresponding section of $S$. There is then an index $\lambda$ such that $s^{(i)}$ is of the form $\varphi_\lambda(s^{(i)}_\lambda)$, where $s^{(i)}_\lambda\in S^\lambda$ for all $i$, and it follows from \cref{scheme morphism into Proj affine everywhere defined iff} that $r_{\mathscr{L},\psi_\lambda}$ is everywhere defined. The second assertion is trival by \cref{scheme morphism into Proj algebra homomorphism prop}.
\end{proof}
\begin{corollary}\label{scheme morphism into Proj limit dominant iff}
Under the hypotheses of \cref{scheme morphism into Proj limit everywhere defined prop}, if the morphisms $r_{\mathscr{L},\psi_\lambda}$ are dominant, so is $r_{\mathscr{L},\psi}$. The converse is also true if the homomorphisms $\varphi_\lambda$ are eventually injective.
\end{corollary}
\begin{proof}
The second assertion is a particular case of \cref{scheme morphism into Proj algebra homomorphism prop}. To show that $r_{\mathscr{L},\psi}$ is dominant if each $r_{\mathscr{L},\psi_\lambda}$ is, we can assume that $Y$ is affine and thus $\mathscr{S}=\widetilde{S}$ where $S=\Gamma(Y,\mathscr{S})$. If $s\in S$ is such that $\psi^{\flat}(s)$ is locally nilpotent, as we can write $s=\varphi_\lambda(s_\lambda)$ for some $\lambda$, from the definition of $\psi_\lambda$ and by \cref{scheme morphism into Proj affine dominant iff}, we conclude that $s_\lambda$ is nilpotent, so $s$ is nilpotent, and the assertion follows by applying \cref{scheme morphism into Proj affine dominant iff}.
\end{proof}
\begin{remark}\label{scheme morphism into Proj twisted sheaf}
With the hypotheses and notations of \cref{scheme morphism into Proj affine D_+(f) preimage char}, for each $n\in\Z$ we have a homomorphism
\begin{align}\label{scheme morphism into Proj twisted sheaf-1}
\nu:r_{\mathscr{L},\psi}^*(\mathscr{O}_P(n))\to\mathscr{L}^{\otimes n}|_{G(\psi)}
\end{align}
which is in fact the homomorphism $\nu$ defined in (\ref{scheme Proj qcoh of algebra homomorphism induce nu}) on $\mathscr{O}_P(n)$. We also see that under the hypotheses of \cref{scheme morphism into Proj affine D_+(f) preimage char}, the restriction of $\nu$ to $X_{\psi^{\flat}(f)}$ corresponds to the homomorphism sending the element $s/f^k$ (with $s\in S_{n+kd}$) to the section
\[(\psi^{\flat}(s)|_{X_{\psi^\flat(f)}})(\psi^\flat(f)|_{X_{\psi^\flat(f)}})^{-k}\in\Gamma(X_{\psi^\flat(f)},\mathscr{L}^{\otimes n}),\]
where we also use the notations of \cref{scheme morphism into Proj affine D_+(f) preimage char}.
\end{remark}
\begin{remark}\label{scheme morphism into Proj qcoh module}
Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module and suppose that $q$ is quasi-compact and quasi-separated, so for each $n\geq 0$, $q_*(\mathscr{F}\otimes\mathscr{L}^{\otimes n})$ is a quasi-coherent $\mathscr{O}_Y$-module (\cref{scheme morphism qcqs qcoh direct image}). Let $\mathscr{M}'=\bigoplus_{n\geq 0}\mathscr{F}\otimes\mathscr{L}^{\otimes n}$, which is a quasi-coherent $\mathscr{O}_Y$-module, and consider the image $\mathscr{M}=q_*(\mathscr{M}')=\bigoplus_{n\geq 0}q_*(\mathscr{F}\otimes\mathscr{L}^{\otimes n})$ (which is a quasi-coherent $\mathscr{S}$-module via the homomorphism $\psi^{\flat}$). We shall see that there is a canonical homomorphism of $\mathscr{O}_X$-modules
\begin{align}\label{scheme morphism into Proj qcoh module-1}
\xi:r_{\mathscr{L},\psi}^*(\bigtilde{\mathscr{M}})\to\mathscr{F}|_{G(\psi)}.
\end{align}
For this, recall that we have defined a canonical homomorphism (\ref{scheme Proj qcoh of algebra homomorphism induce nu}):
\[\nu:r_{\mathscr{L},\psi}^*(\bigtilde{\mathscr{M}})\to(q^*(\mathscr{M})\otimes_{q^*(\mathscr{S})}\bm{S}(\mathscr{L}))\widetilde{\hspace{3mm}}|_{G(\psi)},\]
where the right hand side is considered as a quasi-coherent sheaf over $X$. On the other hand, for any quasi-coherent graded $\bm{S}(\mathscr{L})$-module $\mathscr{M}'$, we have a canonical homomorphism
\[q^*(q_*(\mathscr{M}'))\otimes_{q^*(\mathscr{S})}\bm{S}(\mathscr{L})\to\mathscr{M}'\]
which, for any open subset $U$ of $X$, any section $t'$ of $q^*(q_*(\mathscr{M}'_h))$ over $U$ and any section $b'$ of $\mathscr{L}^{\otimes k}$ over $U$, sends the section $t'\otimes b'$ to the section $b'\sigma(t')$ of $\mathscr{M}'_{h+k}$, where $\sigma$ is the canonical homomorphism $q^*(q_*(\mathscr{M}'))\to\mathscr{M}'$. We then conclude a canonical homomorphism
\[(q^*(q_*(\mathscr{M}'))\otimes_{q^*(\mathscr{S})}\bm{S}(\mathscr{L}))\widetilde{\hspace{3mm}}|_{G(\psi)}\to\bigtilde{\mathscr{M}}'|_{G(\psi)}\]
and as $\bigtilde{\mathscr{M}}'$ is canonically identified with $\mathscr{F}$ by \cref{scheme Proj of polynomial algebra char}, we obtain the canonical homomorphism $\xi$.\par
Under the hypotheses and notations of \cref{scheme Proj of qcoh alg ext by inv twisted prop}, the restriction of this homomorphism to $X_{\psi^{\flat}(f)}$ is defined as follows: giving a section $t_{nd}$ of $\mathscr{F}\otimes\mathscr{L}^{\otimes d}$ over $X$ (which is also a section of $q_*(\mathscr{F}\otimes\mathscr{L}^{\otimes n})$ over $Y$), we send the element $t_{nd}/f^n$ to the sectin $(t_{nd}|_{X_{\psi^\flat(f)}})(\psi^{\flat}(f)|_{X_{\psi^\flat}(f)})^{-n}$ of $\mathscr{F}$ over $X_{\psi^{\flat}(f)}$.
\end{remark}
We now consider the important question that whether the induced morphism $r_{\mathscr{L},\psi}$ is an immersion (reps. an open immersion, a closed immersion). It is clear that this question is local over $Y$, and we shall give a criterion in this situation together with the condition that $r_{\mathscr{L},\psi}$ is defined everywhere.
\begin{proposition}\label{scheme morphism into Proj affine immersion iff}
Under the hypothesis and notations of \cref{scheme morphism into Proj affine D_+(f) preimage char}, for the morphism $r_{\mathscr{L},\psi}$ be everywhere defined and an immersion, it is necessary and sufficient that there exists a family of sections $s_\alpha\in S_{n_\alpha}$ (with $n_\alpha>0$) such that, if $f_\alpha=\psi^{\flat}(s_\alpha)$, the following conditions are satisfied:
\begin{enumerate}
\item[(\rmnum{1})] The $X_{f_\alpha}$ form a covering of $X$.
\item[(\rmnum{2})] The $X_{f_\alpha}$ are affine open subset of $X$.
\item[(\rmnum{3})] For any index $\alpha$ and any section $t\in\Gamma(X_{f_\alpha},\mathscr{O}_X)$, there exists an integer $n>0$ and $s\in S_{mn_\alpha}$ such that $t=(\psi^{\flat}(s)|_{X_{f_\alpha}})(f_\alpha|_{X_{f_\alpha}})^{-m}$.   
\end{enumerate}
For the morphism $r_{\mathscr{L},\psi}$ to be everywhere defined and an open immersion, it is necessary and sufficient that the family $(s_\alpha)$ satisfies the following additional condition:
\begin{enumerate}
\item[(\rmnum{4})] For any integer $m>0$ and any $s\in S_{mn_\alpha}$ such that $\psi^{\flat}(s)|_{X_{f_\alpha}}=0$, there exists an integer $n>0$ such that $s_\alpha^ns=0$.
\end{enumerate}
Similarly, for the morphism $r_{\mathscr{L},\psi}$ to be everywhere defined and a closed immersion, it is necessary and sufficient that the family $(s_\alpha)$ satisfies the following additional condition:
\begin{enumerate}
\item[(\rmnum{5})] The $D_+(s_\alpha)$ form a covering of $P=\Proj(S)$.
\end{enumerate}
\end{proposition}
\begin{proof}
By \cref{scheme morphism immersion iff stalk}, for the morphism $r=r_{\mathscr{L},\psi}$ to be an immersion (resp. a closed immersion), it is necessary and sufficent that there exists a covering of $r(G(\psi))$ (resp. of $P$) by the sets $D_+(s_\alpha)$ such that if $V_\alpha=r^{-1}(D_+(s_\alpha))$, the restriction of $r$ on $V_\alpha$ is a closed immersion of $V_\alpha$ into $D_+(s_\alpha)$ (cf. \cref{scheme immersion open covering prop}). Now condition (\rmnum{1}) just means that $r$ is everywhere defined and that $D_+(s_\alpha)$ cover $r(X)$, by (\ref{scheme morphism into Proj affine D_+(f) preimage char-1}). As each $D_+(s_\alpha)$ is affine, condition (\rmnum{2}) and (\rmnum{3}) express that the restriction of $r$ to $X_{f_\alpha}$ is a closed immersion into $D_+(s_\alpha)$ (\cref{scheme affine closed subscheme is affine}). Finally, as (\rmnum{3}) and (\rmnum{4}) means the ring homomorphism $\psi^{\flat}_{(s_\alpha)}:S_{(s_\alpha)}\to\Gamma(X_{f_\alpha},\mathscr{O}_X)$ is an isomorphism, (\rmnum{2}), (\rmnum{3}), (\rmnum{4}) mean that the restriction of $r$ to $X_{f_\alpha}$ is an isomorphism from $X_{f_\alpha}$ to $D_+(s_\alpha)$ for each $\alpha$, so together with (\rmnum{1}), they mean that $r$ is an open immersion.
\end{proof}
\begin{corollary}\label{scheme morphism to Proj algebra homomorphism induce immersion if}
Under the hypothesis and notations of \cref{scheme morphism into Proj algebra homomorphism prop}, if $r_{\mathscr{L},\psi'}$ is everywhere defined and is an immersion, so is $r_{\mathscr{L},\psi}$. If we suppose that $u$ is eventually surjective and if $r_{\mathscr{L},\psi'}$ is everywhere defined and is a closed immersion (resp. open), then so is $r_{\mathscr{L},\psi}$.
\end{corollary}
\begin{proof}
We first suppose that $r_{\mathscr{L},\psi'}$ is everywhere defined and and is an immersion. Then by \cref{scheme morphism into Proj affine immersion iff}, there is a family $s'_\alpha\in S'_{n_\alpha}$ such that, if $f_\alpha=\psi'^{\flat}(s'_\alpha)$, the conditions (\rmnum{1}), (\rmnum{2}), (\rmnum{3}) are satisfied. Set $s_\alpha=u(s'_\alpha)$, then $f_\alpha=\psi^{\flat}(s_\alpha)$, and we have a commutative diagram
\[\begin{tikzcd}
S'_{(s'_\alpha)}\ar[d,swap,"u_{(s'_\alpha)}"]\ar[r,"\psi'^\flat_{(s'_\alpha)}"]&\Gamma(X_{f_\alpha},\mathscr{O}_X)\\
S_{(s_\alpha)}\ar[ru,swap,"\psi^\flat_{(s_\alpha)}"]
\end{tikzcd}\]
The hypothesis then implies that $\psi'^\flat_{(s'_\alpha)}$ is surjective, so the homomorphism $\psi^\flat_{(s_\alpha)}$ is also surjective. This shows that $r_{\mathscr{L},\psi}$ is everywhere defined and is an immersion, in view of \cref{scheme morphism into Proj affine immersion iff}. If $r_{\mathscr{L},\psi'}$ is moreover an open immersion, then the homomorphism $\psi'^\flat_{(s'_\alpha)}$ is also injective, and this implies the homomorphism $\psi^\flat_{(s_\alpha)}$ is injective if $u$ is eventually surjective, since in this case the homomorphism $u_{(s'_\alpha)}$ is just surjective.\par
Finally, if $r_{\mathscr{L},\psi'}$ is a closed immersion, then condition (\rmnum{5}) is satisfied for $(s_\alpha')$, and hence satisfied for $(s_\alpha)$ if $u$ is eventually surjective (since in this case $\Proj(u)$ is a closed immersion from $\Proj(S)$ to $\Proj(S')$); this implies $r_{\mathscr{L},\psi}$ is a closed immersion.
\end{proof}
\begin{proposition}\label{scheme morphism to Proj inductive limit immersion iff}
Suppose the hypotheses of \cref{scheme morphism into Proj limit everywhere defined prop} and moreover that $q:X\to Y$ is a morphism of finite type. Then, for the morphism $r_{\mathscr{L},\psi}$ to be everywhere defined and an immersion, it is necessary and sufficient that there exists an index $\lambda$ such that $r_{\mathscr{L},\psi_{\lambda}}$ is everywhere defined and is an immersion; in this case, $r_{\mathscr{L},\psi_\lambda}$ is everywhere defined and an immersion for $\mu\geq\lambda$.
\end{proposition}
\begin{proof}
By \cref{scheme morphism to Proj algebra homomorphism induce immersion if}, it suffices to prove that if $r_{\mathscr{L},\psi}$ is defined everywhere and is an immersion, then there exists an index $\lambda$ such that $r_{\mathscr{L},\psi_\lambda}$ is defined everywhere and is an immersion. By the same reasoning of \cref{scheme morphism into Proj limit everywhere defined prop} and using the quasi-compactness of $Y$, we are reduced to the case where $Y=\Spec(A)$ is affine. As $X$ is then quasi-compact, \cref{scheme morphism into Proj affine immersion iff}  shows that there exists a finite family $(s_i)$ of elements of $S$ ($s_i\in S_{n_i}$) satisfying the conditions (\rmnum{1}), (\rmnum{2}), and (\rmnum{3}). The morphism $X_{f_i}\to Y$ (where $f_i=\psi^{\flat}(s_i)$) is of finite type since $X_{f_i}$ is affine and the morphism $q:X\to Y$ is locally of finite type. The ring $B_i$ of $X_{f_i}$ is therefore an $A$-algebra of finite type by \cref{scheme affine ft and fp iff ring}, and we choose $(t_{ij})$ to be a family of generators of this algebra. There are then elements $s_{ij}\in S_{m_{ij}n_i}$ such that
\[t_{ij}=(\psi^{\flat}(s_{ij})|_{X_{f_i}})(\psi^{\flat}(s_i)|_{X_{f_i}})^{-m_{ij}}\]
We can choose an index $\lambda$ and elements $s_{i\lambda}\in S^\lambda_{n_i}$, $s_{ij\lambda}\in S^\lambda_{m_{ij}n_i}$ such that their images under $\varphi_\lambda$ is $s_i$ and $s_{ij}$, respectively. It is then clear that the family $(s_{i\lambda})$ satisfies the conditions (\rmnum{1}), (\rmnum{2}), and (\rmnum{3}), so $r_{\mathscr{L},\psi}$ is everywhere defined and an immersion.
\end{proof}
\begin{proposition}\label{scheme morphism to Proj over qc ft iso to generated by S_1}
Let $Y$ be a quasi-compact scheme, $q:X\to Y$ be a morphism of finite type, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra, and $\psi:q^*(\mathscr{S})\to\bm{S}(\mathscr{L})$ be a homomorphism of graded algebras. For the morphism $r_{\mathscr{L},\psi}$ to be defined everywhere and an immersion, it is necessary and sufficient that there exists an integer $n>0$ and a quasi-coherent sub-$\mathscr{O}_Y$-module $\mathscr{E}$ of $\mathscr{S}_n$ of finite type such that:
\begin{enumerate}
\item[(a)] the homomorphism $\psi_n\circ q^*(j_n):q^*(\mathscr{E})\to\mathscr{L}^{\otimes n}$ (where $j_n:\mathscr{E}\to\mathscr{S}_n$ is the canonical injection) is surjective.
\item[(b)] if $\mathscr{S}'$ is the graded sub-$\mathscr{O}_Y$-algebra of $\mathscr{S}$ genrated by $\mathscr{E}$ and $\psi'$ is the homomorphism $\psi\circ q^*(j')$, where $j':\mathscr{S}'\to\mathscr{S}$ is the canonical injection, $r_{\mathscr{L},\psi'}$ is everywhere defined and an immersion.
\end{enumerate}
If these are true, any quasi-coherent sub-$\mathscr{O}_Y$-module $\mathscr{E}'$ of $\mathscr{S}_n$ containing $\mathscr{E}$ possesses the same properties, and so does the sub-$\mathscr{O}_Y$-module $\mathscr{S}'_{kn}$ of $\mathscr{S}_{kn}$ for any $k>0$.
\end{proposition}
\begin{proof}
The sufficiency of these conditions is a particular case of \cref{scheme morphism to Proj algebra homomorphism induce immersion if} in view of the isomorphism between $\Proj(\mathscr{S})$ and $\Proj(\mathscr{S}^{(d)})$ (\cref{scheme Proj of qcoh graded algebra altering prop}). We now prove the necessity, so let $(U_i)$ be a finite affine open covering of $Y$ and set $A_i=\Gamma(U_i,\mathscr{O}_Y)$. As $q^{-1}(U_i)$ is compact, the hypotheses that $r_{\mathscr{L},\psi}$ is an immersion defined on $X$ implies by \cref{scheme morphism into Proj affine immersion iff} the existence of a finite family $(s_{ij})$ of elements of $S^{(i)}=\Gamma(U_i,\mathscr{S})$ (where $s_{ij}\in S_{n_{ij}}^{(i)}$) satisfying conditions (\rmnum{1}), (\rmnum{2}), and (\rmnum{3}). Since $q:X\to Y$ is of finite type, the restricted homomorphism $X_{f_{ij}}\to U_i$ is of finite type (where $f_{ij}=\psi^\flat(s_{ij})$), so the ring $B_{ij}$ of $X_{f_{ij}}$ is an $A_i$-algebra of finite type, and we choose $(\psi^\flat(t_{ijk})|_{X_{f_{ij}}})(f_{ij}|_{X_{f_{ij}}})^{-m_{ijk}}$ to be a system of generators of $B_{ij}$, where $t_{ijk}\in S^{(i)}_{m_{ijk}n_{ij}}$. Let $n$ be a common multiple of all the $m_{ijk}n_{ij}$ and put $s'_{ij}=s_{ij}^{h_{ij}}\in S_n^{(i)}$, where $h_{ij}=n/n_{ij}$. For any given piar $(i,j,k)$, the element $t'_{ij}=s_{ij}^{h-m_{ijk}}t_{ijk}$ belongs to $S^{(i)}_{n}$, and it is clear that the $(\psi^\flat(t'_{ijk})|_{X_{f'_{ij}}})(f'_{ij}|_{X_{f'_{ij}}})^{-1}$ also generate $B_{ij}$ (where $f_{ij}'=\psi^{\flat}(s'_{ij})$, and we note that $X_{f'_{ij}}=X_{f_{ij}}$). Let $E_i$ be the sub-$A_i$-module of $S^{(i)}$ generated by these $s'_{ij}$ and $t'_{ijk}$; then there exists a quasi-coherent sub-$\mathscr{O}_Y$-module $\mathscr{E}_i$ of $\mathscr{S}_n$ of finite type such that $\mathscr{E}_i|_{U_i}=\widetilde{E}_i$ (\cref{scheme local Noe qcoh extension}). It is then clear that the sub-$\mathscr{O}_Y$-module $\mathscr{E}$ of $\mathscr{E}$, which is the sum of the $\mathscr{E}_i$, satisfies the required properties.
\end{proof}
\begin{remark}
The point of \cref{scheme morphism to Proj over qc ft iso to generated by S_1} is that, for a scheme $X$ of finite type over a quasi-compact scheme $Y$, if $X$ can be embedded into $\Proj(\mathscr{S})$ via a morphism $r_{\mathscr{L},\psi}$, then we can choose $\mathscr{S}$ so that it is generated by $\mathscr{S}_1$ and $\mathscr{S}_1$ of finite type (we already know that in this case the twisted sheaves over $\Proj(\mathscr{S})$ have nice properties).
\end{remark}
\section{Projective bundles and ample sheaves}
\subsection{Projective bundles}
Let $Y$ be a scheme, $\mathscr{E}$ be a quasi-coherent $\mathscr{O}_Y$-module, and $\bm{S}(\mathscr{E})$ be the symmetric $\mathscr{O}_Y$-algebra of $\mathscr{E}$, which is quasi-coherent by \cref{scheme qcoh sym ft fp iff}. The \textbf{projective bundle} over $Y$ associated with $\mathscr{E}$ is defined to be the $Y$-scheme $P=\Proj(\bm{S}(\mathscr{E}))$. The $\mathscr{O}_P$-module $\mathscr{O}_P(1)$ is called the \textbf{fundamental sheaf} of $P$.\par
If $\mathscr{E}=\mathscr{O}_Y^n$, we then denote by $\P_Y^{n-1}$ instead of $\P(\mathscr{E})$; if moreover $Y$ is affine with ring $A$, we then denote this scheme by $\P_A^{n-1}$. As $\bm{S}(\mathscr{O}_Y)$ is canonically isomorphic to $\mathscr{O}_Y[T]$, we see $\P_Y^0$ is canonically identified with $Y$.\par
If $Y=\Spec(A)$ and $\mathscr{E}=\widetilde{E}$ where $E$ is an $A$-module, we also denote by $\P(E)$ the projective bundle $\P(E)$. The simplest example is $\P(E)$ where $E$ is a vector space over a field $k$. In this case, we see $\P(E)$ is isomorphic to $\P_k^{n-1}$, where $n$ is the dimension of $E$.\par
Let $\mathscr{E}$, $\mathscr{F}$ be two qusi-coherent $\mathscr{O}_Y$-modules and $u:\mathscr{E}\to\mathscr{F}$ be an $\mathscr{O}_Y$-homomorphism. Then $u$ corresponds canonically to a homomorphism $\bm{S}(u):\bm{S}(\mathscr{E})\to\bm{S}(\mathscr{F})$ of graded $\mathscr{O}_Y$-algebras. If $u$ is surjective, so is $\bm{S}(u)$, and therefore $\Proj(\bm{S}(u))$ is a closed immersion $\P(\mathscr{F})\to\P(\mathscr{E})$, which we then denoted by $\P(u)$. We can then say that $\P(\mathscr{E})$ is a contravariant functor on the category of quasi-coherent $\mathscr{O}_Y$-modules with \textit{surjective homomorphisms}. Suppose that $u$ is surjective and put $P=\P(\mathscr{E})$, $Q=\P(\mathscr{F})$, and $j=\P(u)$. We then have an isomorphism
\[j^*(\mathscr{O}_P(n))=\mathscr{O}_Q(n)\]
by \cref{scheme Proj of qcoh algera closed subscheme twisted sheaf char}.\par
If $\psi:Y'\to Y$ is a morphism and $\mathscr{E}'=\psi^*(\mathscr{E})$, we then have $\bm{S}_{\mathscr{O}_{Y'}}(\mathscr{E}')=\psi^*(\bm{S}_{\mathscr{O}_Y}(\mathscr{E}))$ by \cref{ringed space sym inverse image prop}, so from \cref{scheme Proj of qcoh alg base change prop} we deduce that
\begin{align}\label{scheme prjective bundle base change prop}
\P(\psi^*(\mathscr{E}))=\P(\mathscr{E})\times_YY'.
\end{align}
Moreover, it is clear that $\psi^*((\bm{S}_{\mathscr{O}_Y}(\mathscr{E}))(n))=(\bm{S}_{\mathscr{O}_{Y'}}(\mathscr{E}'))(n)$ for each $n\in\Z$, so if $P=\P(\mathscr{E})$ and $P'=\P(\mathscr{E}')$, we have a canonical isomorphism
\begin{align}\label{scheme prjective bundle base change twisted prop}
\mathscr{O}_{P'}(n)=\mathscr{O}_P(n)\otimes_Y\mathscr{O}_{Y'}.
\end{align}
\begin{proposition}\label{scheme projective bundle of tensor with invertible prop}
Let $\mathscr{L}$ be an invertible $\mathscr{O}_Y$-module. For any quasi-coherent $\mathscr{O}_Y$-module, there exists a canonical $Y$-isomorphism $i_{\mathscr{L}}:Q=\P(\mathscr{E}\otimes\mathscr{L})\stackrel{\sim}{\to}P=\P(\mathscr{E})$. Moreover, $(i_{\mathscr{L}})_*(\mathscr{O}_Q(n))$ is cannically isomorphic to $\mathscr{O}_P(n)\otimes_Y\mathscr{L}^{\otimes n}$ for any $n\in\Z$.
\end{proposition}
\begin{proof}
If $A$ is a ring, $E$ is an $A$-module, $L$ is an $A$-module free of rank $1$, we can define a canonical homomorphism
\[\bm{S}_n(E\otimes L)\to\bm{S}_n(E)\otimes L^{\otimes n}\]
which maps an element $(x_1\otimes y_1)\cdots(x_n\otimes y_n)$ to
\[(x_1\cdots x_n)\otimes(y_1\otimes\cdots\otimes y_n)\]
where $x_i\in E$ and $y_i\in L$. This is easily seen to be an isomorphism, so we get an isomorphism $\bm{S}(E\otimes L)\cong\bigoplus_{n\geq 0}\bm{S}_n(E)\otimes L^{\otimes n}$. In the situation of the proposition, the preceding remark allows us to define a canonical isomorphism of graded $\mathscr{O}_Y$-algebras
\[\bm{S}(\mathscr{E}\otimes_{\mathscr{O}_Y}\mathscr{L})\stackrel{\sim}{\to}\bigoplus_{n\geq 0}\bm{S}_n(\mathscr{E})\otimes_{\mathscr{O}_Y}\mathscr{L}^{\otimes n}\]
The proposition then follows from \cref{scheme Proj of qcoh graded algebra altering prop} and \cref{scheme Proj of qcoh alg ext by inv twisted prop}.
\end{proof}
Let $P=\P(\mathscr{E})$ and denote by $p:P\to Y$ the structural morphism. As by definition $\mathscr{E}=(\bm{S}(\mathscr{E}))_1$, we have a canonical homomorphism $\alpha_1:\mathscr{E}\to p_*(\mathscr{O}_P(1))$, and therefore a canonical homomorphism
\[\alpha_1^{\sharp}:p^*(\mathscr{E})\to\mathscr{O}_P(1).\]
\begin{proposition}\label{scheme projective bundle alpha_1 surjective}
The canonical homomorphism $\alpha_1^{\sharp}$ is surjective.
\end{proposition}
\begin{proof}
We have seen that $\alpha_1^{\sharp}$ corresponds to the functorial homomorphism $\mathscr{E}\otimes_{\mathscr{O}_Y}\bm{S}(\mathscr{E})\to(\bm{S}(\mathscr{E}))(1)$ (see the remark before \cref{scheme Proj of qcoh alg X_f char}). Since $\mathscr{E}$ generates $\bm{S}(\mathscr{E})$, this homomorphism is surjective, whence our assertion in view of \cref{scheme Proj of qcoh alg associated functor exact}.
\end{proof}
\subsection{Morphisms into \texorpdfstring{$\P(\mathscr{E})$}{P}}
With the notations of the last subsection, we now let $X$ be an $Y$-scheme, $q:X\to Y$ be the structural morphism, and $r:X\to P$ be an $Y$-morphism, which gives a commutative diagram
\[\begin{tikzcd}
X\ar[rd,swap,"q"]\ar[r,"r"]&P\ar[d,"p"]\\
&Y
\end{tikzcd}\]
As the functor $r^*$ is right-exact, we deduce from the surjective homomorphism $\alpha_1^{\sharp}$ in \cref{scheme projective bundle alpha_1 surjective} a surjective homomorphism
\[r^*(\alpha_1^{\sharp}):r^*(p^*(\mathscr{E}))\to r^*(\mathscr{O}_P(1)).\]
But $r^*(p^*(\mathscr{E}))=q^*(\mathscr{E})$ and $r^*(\mathscr{O}_P(1))$ is locally isomorphic to $r^*(\mathscr{O}_P)=\mathscr{O}_X$, which is then an invertible sheaf $\mathscr{L}_r$ over $X$, so we obtain a canonical surjective $\mathscr{O}_X$-homomorphism
\[\varphi_r:q^*(\mathscr{E})\to\mathscr{L}_r.\]

If $Y=\Spec(A)$ is affine and $\mathscr{E}=\widetilde{E}$, we can explicitly explain this homomorphism: given $f\in E$, it follows from \cref{scheme Proj D_+(f) nonzero lucus char} that 
\[r^{-1}(D_+(f))=X_{\varphi_r^\flat(f)}.\]
Let $V$ be an affine open of $X$ contained in $r^{-1}(D_+(f))$, and let $B$ be its ring, which is an $A$-algebra; put $S=\bm{S}_A(E)$. The restriction of $r$ to $V$ then corresponds to an $A$-homomorphism $\omega:S_{(f)}\to B$, and we have $q^*(\mathscr{E})|_V=\widetilde{E\otimes_AB}$ and $\mathscr{L}_r|_{V}=\widetilde{L}_r$, where by \cref{scheme affine associated sheaf inverse image char}, $L_r=S(1)_{(f)}\otimes_{S_{(f)}}B$. In view of the definition of $\alpha_1$, the restriction of $\varphi_r$ to $q^*(\mathscr{E})|_V$ therefore corresponds to the $B$-homomorphism 
\[u:E\otimes_AB\to L_r,\quad x\otimes 1\mapsto (x/1)\otimes 1=(f/1)\otimes\omega(x/f)\]
The canonical extension of $\varphi_r$ to a homomorphism of $\mathscr{O}_X$-algebras (recall that $(\mathscr{O}_P(1))^{\otimes n}=\mathscr{O}_P(n)$ by \cref{scheme Proj twisted sheaf tensor prop})
\[\psi_r:q^*(\bm{S}(\mathscr{E}))=\bm{S}(q^*(\mathscr{E}))\to\bm{S}(\mathscr{L}_r)=\bigoplus_{n\geq 0}\mathscr{L}_r^{\otimes n}=\bigoplus_{n\geq 0}r^*(\mathscr{O}_P(n))\]
is then such that the restriction of $\psi_r$ to $q^*(\bm{S}_n(\mathscr{E}))|_V$ corresponds to the $B$-homomorphism
\[\bm{S}_n(\mathscr{E}\otimes_AB)=\bm{S}_n(E)\otimes_AB\to L_r^{\otimes n}=(S(1)_{(f)})^{\otimes n}\otimes_{S_{(f)}}B\]
which send the element $s\otimes 1$ to $(f/1)^{\otimes n}\otimes\omega(s/f^n)$.\par
Conversely, given an invertible $\mathscr{O}_X$-module $\mathscr{L}$ and a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$, then any homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$ corresponds to a canonical homomorphism of quasi-coherent $\mathscr{O}_X$-algebras
\[\psi:\bm{S}(q^*(\mathscr{E}))=q^*(\bm{S}(\mathscr{E}))\to\bm{S}(\mathscr{L})=\bigoplus_{n\geq 0}\mathscr{L}^{\otimes n}\]
which then gives an $Y$-morphism $r_{\mathscr{L},\psi}:G(\psi)\to\Proj(\bm{S}(\mathscr{E}))\to\P(\mathscr{E})$, which we also denoted by $r_{\mathscr{L},\varphi}$. If $\varphi$ is surjective, then so is $\psi$ and by \cref{scheme morphism into Proj affine everywhere defined iff} the morphism $r_{\mathscr{L},\psi}$ is everywhere defined.
\begin{proposition}\label{scheme morphism into projective bundle surjective hommorphism}
Let $q:X\to Y$ be a morphism and $\mathscr{E}$ be a quasi-coherent $\mathscr{O}_Y$-module. Then the maps $r\mapsto(\mathscr{L}_r,\varphi_r)$ and $(\mathscr{L},\varphi)\mapsto r_{\mathscr{L},\varphi}$ form a bijective correspondence between the set of $Y$-morphisms $r:X\to\P(\mathscr{E})$ to the set of equivalence classes of couples $(\mathscr{L},\varphi)$ formed by an invertible $\mathscr{O}_X$-module and a surjective homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$, where two couples $(\mathscr{L},\varphi)$, $(\mathscr{L}',\varphi')$ are equivalent if there exists an $\mathscr{O}_X$-isomorphism $\tau:\mathscr{L}\to\mathscr{L}'$ such that $\varphi'=\tau\circ\varphi$.
\end{proposition}
\begin{proof}
Let us start with an $Y$-morphism $r:X\to\P(\mathscr{E})$, form $\mathscr{L}_r$ and $\varphi_r$, and put $r'=r_{\mathscr{L}_r,\varphi_r}$. To see the morphisms $r$ and $r'$ coincide, we may assume that $Y=\Spec(A)$ is affine, so $\mathscr{E}=\widetilde{E}$, and let $S=\bm{S}_A(E)$. Let $V=\Spec(B)$ be an affine open of $X$ contained in $r^{-1}(D_+(f))$, where $f\in E$. Then as we have already seen, the restriction of $r$ to $V$ corresponds to an $A$-homomorphism $\omega:S_{(f)}\to B$, and the restriction of $\psi_r$ to $q^*(\bm{S}_n(\mathscr{E}))|_{V}$ corresponds to the $B$-homomorphism $\bm{S}_n(E)\otimes_AB\to L_r^{\otimes n}$ which sends $s\otimes 1$ to $(f/1)^{\otimes n}\otimes\omega(s/f^n)$. The restriction of $\psi_r^{\flat}$ to $\bm{S}(\mathscr{E})|_V$ then corresponds to the homomorphism $\bm{S}_n(E)\to L_r^{\otimes n}$ which sends $s\in\bm{S}_n(E)$ to $(f/1)^{\otimes n}\otimes\omega(s/f^n)$, and by \cref{scheme morphism into Proj affine D_+(f) preimage char}, the restriction of $r_{\mathscr{L}_r,\psi_r}$ to $V$ corresponds to the homomorphism $(\psi_r^\flat)_{(f)}$, which send $s\in S_n$ to
\[(\psi_r^\flat(s))(\psi_r^\flat(f))^{-n}=[(f/1)^{\otimes n}\otimes\omega(s/f^n)][(f/1)\otimes 1]^{-n}=1\otimes\omega(s/f^n).\]
Therefore, under the identification of $X$ with $\Proj(\bm{S}(\mathscr{L}))$, $r_{\mathscr{L},\psi_r}$ coincides with $r$ over $V$, so they coincide on $X$.\par
Conversely. let $(\mathscr{L},\varphi)$ be a couple and form $r=r_{\mathscr{L},\varphi}$, $\mathscr{L}_{r}$, and $\varphi_r$. We show that there is a canonical isomorphism $\tau:\mathscr{L}_r\to\mathscr{L}$ such that $\varphi=\tau\circ\varphi_r$. For this, we can assume that $Y=\Spec(A)$ and $X=\Spec(B)$ are affine, and (with the notations of \cref{scheme morphism into Proj affine discription}) define $\tau$ be sending an element $(x/1)\otimes 1$ of $L_r$ (where $x\in E$) to the element $v_1(x)c$ of $L$. It is easy to verify that $\tau$ is independent of the choice of the generator $c$ of $L$. As $v_1$ is surjective, to show that $\tau$ is an isomorphism, it suffices to prove that if $x/1=0$ in $S(1)_{(f)}$, then $v_1(x)/1=0$ in $B_g$. But the first condition means that $f^nx=0$ in $S_{n+1}$ for some $n$, and we then deduce that $v_{n+1}(f^{n}x)=g^nv_1(x)=0$ in $B$, whence the conclusion. Finally, it is immediate that for two equivalent couples $(\mathscr{L},\varphi)$, $(\mathscr{L}',\varphi')$, we have $r_{\mathscr{L},\varphi}=r_{\mathscr{L}',\varphi'}$.
\end{proof}
\begin{theorem}\label{scheme projective bundle section char}
The set of $Y$-sections of $\P(\mathscr{E})$ is in bijective correspondence to the set of quasi-coherent sub-$\mathscr{O}_Y$-modules $\mathscr{F}$ of $\mathscr{E}$ such that $\mathscr{E}/\mathscr{F}$ is invertible.
\end{theorem}
\begin{proof}
This is a particular case of \cref{scheme morphism into projective bundle surjective hommorphism} by taking $X=Y$ and note that if two pairs $(\varphi,\mathscr{L})$ and $(\varphi',\mathscr{L}')$ are equivalent, then $\ker\varphi$ and $\ker\varphi'$ are identical.
\end{proof}
Note that this property corresponds to the classical definition of the "projective space" as the set of hyperplanes of a vector space (the classical case corresponding to $Y=\Spec(k)$, where $k$ is a field, and $\mathscr{E}=\widetilde{E}$, $E$ being a finite dimensional $k$-vector. The sheaves $\mathscr{F}$ having the property stated in \cref{scheme projective bundle section char} corresponds then to the hyperplanes of $E$.
\begin{remark}
As there is a canonical correspondence between $Y$-morphisms from $X$ to $P$ and their graph morphisms, which are $X$-sections of $P\times_YX$, we see conversely that \cref{scheme morphism into projective bundle surjective hommorphism} can be deduced from \cref{scheme projective bundle section char}. Let $\mathrm{Hyp}_Y(X,\mathscr{E})$ be the set of quasi-coherent sub-$\mathscr{O}_X$-modules $\mathscr{F}$ of $\mathscr{E}\otimes_Y\mathscr{O}_X=q^*(\mathscr{E})$ such that $q^*(\mathscr{E})/\mathscr{F}$ is an invertible $\mathscr{O}_X$-module. If $g:X'\to X$ is an $Y$-morphism, then $g^*(q^*(\mathscr{E})/\mathscr{F})=g^*(q^*(\mathscr{E}))/g^*(\mathscr{F})$ by the right exactness of $g^*$, so the second sheaf is invertible, and therefore $\mathrm{Hyp}_Y(X,\mathscr{E})$ is a covariant functor over the category of $Y$-schemes. We can then interprete \cref{scheme projective bundle section char} by saying that the $Y$-scheme $\P(\mathscr{E})$ representes the functor $\mathrm{Hyp}_Y(-,\mathscr{E})$. This also provides a characterization of the projective bundle $P=\P(\mathscr{E})$ by the following universal property, more close to the geometric intuition that the constructions of $r_{\mathscr{L},\psi}$: for any morphism $q:X\to Y$ and any invertible $\mathscr{O}_X$-module $\mathscr{L}$ which is a quotient of $q^*(\mathscr{E})$, there exists a unique $Y$-morphism $r:X\to P$ such that $\mathscr{L}$ is isomorphic to $r^*(\mathscr{O}_P(1))$.
\end{remark}
\begin{corollary}\label{scheme projective bundle over picard trivial prop}
Suppose that any invertible $\mathscr{O}_Y$-module is trivial. Let $E=\Hom_{\mathscr{O}_Y}(\mathscr{E},\mathscr{O}_Y)$ considered as a module over the ring $A=\Gamma(Y,\mathscr{O}_Y)$, and let $E^\times$ be the subset of $E$ formed by surjective homomorphisms. Then the set of $Y$-sections of $\P(\mathscr{E})$ is canonically identified with $E^\times/A^\times$, where $A^\times$ is the group of units of $A$.
\end{corollary}
\begin{example}\label{scheme projective bundle fiber char}
Let $Y$ be a scheme, $y$ be a point of $Y$, and $Y'=\Spec(\kappa(y))$. The fiber $p^{-1}(y)$ of $\P(\mathscr{E})$ is, in view of (\ref{scheme prjective bundle base change prop}), identified with $\P(\mathscr{E}^y)$, where $\mathscr{E}^y=\mathscr{E}_y\otimes_{\mathscr{O}_{Y,y}}\kappa(y)=\mathscr{E}_y/\m_y\mathscr{E}_y$ is considered as a vector space over $\kappa(y)$. More generally, if $K$ is an extension of $\kappa(y)$, $p^{-1}(y)\otimes_{\kappa(y)}K$ is identified with $\P(\mathscr{E}^y\otimes_{\kappa(y)}K)$. Since any invertible sheaves over a local scheme is trivial, \cref{scheme projective bundle over picard trivial prop} shows that the points of $\P(\mathscr{E})$ lying over $y$ with values in $K$, which are called the \textbf{rational geometric fibers} of $\P(\mathscr{E})$ over $K$ lying over $y$, is identified with the projective space of the dual of the vector $K$-space $\mathscr{E}^y\otimes_{\kappa(y)}K$.
\end{example}
\begin{example}\label{scheme projective bundle over affine char}
Suppose now that $Y$ is affine with ring $A$, and any invertible sheaf on $Y$ is trivial; we put $\mathscr{E}=\mathscr{O}_Y^n$. Then with the notations of \cref{scheme projective bundle over picard trivial prop}, $E$ is identified with $A^n$ by \cref{scheme affine associated sheaf Hom bijection} and $E^\times$ is identified with the set of systems $(f_i)_{1\leq i\leq n}$ of elements of $A$ which generate the unit ideal of $A$. By \cref{scheme projective bundle over picard trivial prop}, two such systems determine the same $Y$-section of $\P_Y^{n-1}=\P_A^{n-1}$, which means the same point of $\P_A^{n-1}$ with values in $A$, if and only if one is deduced from the other by multiplication by an invertible element of $A$.
\end{example}
\begin{remark}\label{scheme morphism into projective bundle correspondence functoriality}
Let $u:X'\to X$ be a morphism. If the $Y$-morphism $r:X\to P$ corresponds to the homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$, then by definition, the morphism $r\circ u$ corresponds to $u^*(\varphi):u^*(q^*(\mathscr{E}))\to u^*(\mathscr{L})$. On the other hand, let $\mathscr{E},\mathscr{F}$ be two quasi-coherent $\mathscr{O}_Y$-modules and $j=\P(v)$ be the closed immersion $\P(\mathscr{F})\to\P(\mathscr{E})$ corresponding to a surjective homomorphism $v:\mathscr{E}\to\mathscr{F}$. If the $Y$-morphism $r:X\to\P(\mathscr{E})$ corresponds to the homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$, then $j\circ r$ corresponds to the composition
\[\begin{tikzcd}
q^*(\mathscr{E})\ar[r,"q^*(v)"]&q^*(\mathscr{F})\ar[r,"\varphi"]&\mathscr{L}
\end{tikzcd}\]

Let $\psi:Y'\to Y$ be a morphism and put $\mathscr{E}'=\psi^*(\mathscr{E})$. If the $Y$-morphism $r:X\to P$ corresponds to the homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$, the $Y'$-morphism
\[r_{(Y')}:X_{(Y')}\to P'=\P(\mathscr{E}')\]
correspond to $\varphi_{(Y')}:q_{(Y')}^*(\mathscr{E}')=q^*(\mathscr{E})\otimes_Y\mathscr{O}_{Y'}\to\mathscr{L}\otimes_Y\mathscr{O}_{Y'}$. In fact, by (\ref{scheme prjective bundle base change prop}), we have the following commutative diagram
\[\begin{tikzcd}
X_{(Y')}\ar[r,"r_{(Y')}"]\ar[d,"v"]&P'=P_{(Y')}\ar[d,"u"]\ar[r,"p_{(Y')}"]&Y'\ar[d,"\psi"]\\
X\ar[r,"r"]&P\ar[r,"p"]&Y
\end{tikzcd}\]
In view of (\ref{scheme prjective bundle base change twisted prop}), we have
\[(r_{(Y')})^*(\mathscr{O}_{P'}(1))=(r_{(Y')})^*(u^*(\mathscr{O}_P(1)))=v^*(r^*(\mathscr{O}_P(1)))=v^*(\mathscr{L})=\mathscr{L}\otimes_Y\mathscr{O}_{Y'}.\]
Also, $u^*(\alpha_1^{\sharp})$ is equal to the canonical homomorphism $\alpha_1^{\sharp}:(p_{(Y')})^*(\mathscr{E}')\to\mathscr{O}_{P'}(1)$, in view of the definition of $\alpha_1$, whence our assertion.
\end{remark}
\subsection{The Segre morphism}
Let $Y$ be a scheme and $\mathscr{E},\mathscr{F}$ be two quasi-coherent $\mathscr{O}_Y$-modules. Put $P_1=\P(\mathscr{E})$, $P_2=\P(\mathscr{F})$, and denote by $p_1,p_2$ their morphisms; let $Q=P_1\times_YP_2$ and $q_1,q_2$ be the canonical projections. The $\mathscr{O}_Q$-module
\[\mathscr{L}=\mathscr{O}_{P_1}(1)\times_{Y}\mathscr{O}_{P_2}(1)=q_1^*(\mathscr{O}_{P_1}(1))\times_{\mathscr{O}_Q}q_2^*(\mathscr{O}_{P_2}(1))\] is invertible as a tensor product of invertible modules. On the other hand, if $r=p_1\circ q_1=p_2\circ q_2$ is the structural morphism of $Q$, we have $r^*(\mathscr{E}\otimes_{\mathscr{O}_Y}\mathscr{F})\otimes_{\mathscr{O}_Q}q_2^*(p_2^*(\mathscr{F}))$; the canonical surjective homomorphism $p_1^1(\mathscr{E})\to\mathscr{O}_{P_1}(1)$ and $p_2^*(\mathscr{F})\to\mathscr{O}_{P_2}(1)$ then give a canonical surjective homomorphism
\begin{align}\label{scheme Proj Segre homomorphism}
s:r^*(\mathscr{E}\otimes_{\mathscr{O}_Y}\mathscr{F})\to\mathscr{L}
\end{align}
we then deduce a canonical homomorphism, called the Segre morphism:
\begin{align}\label{scheme Proj Segre morphism}
\zeta:\P(\mathscr{E})\times_Y\P(\mathscr{F})\to\P(\mathscr{E}\otimes_{\mathscr{O}_Y}\mathscr{F}).
\end{align}

To explain this morphism $\zeta$, let us consider the case where $Y=\Spec(A)$ is affine, $\mathscr{E}=\widetilde{E}$, $\mathscr{F}=\widetilde{F}$, where $E$ and $F$ are two $A$-module; whence $\mathscr{E}\otimes_{\mathscr{O}_Y}\mathscr{F}=\widetilde{E\otimes_AF}$. Put $R=\bm{S}(E)$, $S=\bm{S}(F)$, and $T=\bm{S}(E\otimes_AF)$. Let $f\in E$, $g\in F$, and consider the affine open
\[D_+(f)\times_YD_+(g)=\Spec(B)\]
of $Q$, where $B=R_{(f)}\otimes_AS_{(g)}$. The restriction of $\mathscr{L}$ on this affine open is $\widetilde{L}$, where
\[L=(R(1)_{(f)})\otimes_A(S(1)_{(g)})\]
and the element $c=(f/1)\otimes(g/1)$ is a generator of $L$ as a free $B$-module (\cref{scheme Proj qcoh S(nd) local is O_X}). The homomorphism (\ref{scheme Proj Segre homomorphism}) then corresponds to the homomorphism
\[(x\otimes y)\otimes b\mapsto b((x/1)\otimes(y/1))\]
from $(E\otimes_AF)\otimes_AB$ to $L$. With the notations of \cref{scheme morphism into Proj affine discription}, we then have $v_1(x\otimes y)=(x/f)\otimes(y/g)$, so the restriction of the morphism $\zeta$ to $D_+(f)\times_YD_+(g)$ is a morphism from this affine scheme to $D_+(f\otimes g)$, which corresponds to the ring homomorphism
\begin{align}\label{scheme Proj Segre morphism over affine ring homomorphism}
\omega((x\otimes y)/(f\otimes g))=(x/f)\otimes(y/g)
\end{align}
for $x\in E$ and $y\in F$.\par
From \cref{scheme morphism into projective bundle surjective hommorphism}, there is a canonical isomorphism
\[\tau:\zeta^*(\mathscr{O}_P(1))\stackrel{\sim}{\to}\mathscr{O}_{P_1}(1)\otimes_Y\mathscr{O}_{P_2}(1)\]
where we put $P=\P(\mathscr{E}\otimes_{\mathscr{O}_Y}\mathscr{F})$. Moreover, for $x\in\Gamma(Y,\mathscr{E})$ and $y\in\Gamma(Y,\mathscr{F})$, we have
\begin{align}\label{scheme Proj Segre morphism tau and alpha prop}
\tau(\alpha_1(x\otimes y))=\alpha_1(x)\otimes\alpha_1(y)
\end{align}
To see this, we can assume that $Y$ is affine, so with the notations above and the definition of $\alpha_1$, we have $\alpha_1^{f\otimes g}(x\otimes y)=(x\otimes y)/1$, $\alpha_1^f(x)=x/1$, and $\alpha_1^g(y)=y/1$. The definition of $\tau$ given in the proof of \cref{scheme morphism into projective bundle surjective hommorphism} says $\tau$ maps $(x/1)\otimes 1$ to $v_1(x)c$. Since we have seen that $v_1(x\otimes y)=(x/f)\otimes(y/g)$, this implies the assertion by a simple computation. From this, we then deduce the formula 
\begin{align}\label{scheme Proj Segre morphism fiber product of standard open prop}
\zeta^{-1}(P_{x\otimes y})=(P_1)_x\times_Y(P_2)_y
\end{align}
where we need to use the following lemma:
\begin{lemma}\label{Spec of ring fiber product of standard open prop}
Let $B$, $B'$ be two $A$-algebras, and let $Y=\Spec(A)$, $Z=\Spec(B)$, $Z'=\Spec(B')$. Then for $t\in B$, $t'\in B'$, we have $D(t\otimes t')=D(t)\times_YD(t')$.
\end{lemma}
\begin{proof}
Let $p,p'$ be the canonical projections of $Z\times_YZ'$. Then it follows from \cref{Spec of ring induced map prop} that $p^{-1}(D(t))=D(t\otimes 1)$ and $p'^{-1}(D(t'))=D(1\otimes t')$. \cref{scheme product inverse image of base open} then implies the lemma, since $(t\otimes 1)(1\otimes t')=t\otimes t'$.
\end{proof}
\begin{proposition}\label{scheme Proj Segre morphism closed immersion}
The Segre morphism is a closed immersion.
\end{proposition}
\begin{proof}
Since the question is local on $Y$, we can assume that $Y$ is affine. With the previous notations, the $D_+(f\otimes g)$ form a basis for $P$, since the elements $f\otimes g$ generate $T$ for $f\in E$, $g\in F$. On the other hand, we have $\zeta^{-1}(D_+(f\otimes g))=D_+(f)\times_YD_+(g)$ in view of (\ref{scheme Proj Segre morphism fiber product of standard open prop}). It then suffices to use \cref{scheme immersion open covering prop} to prove that the restriction of $\zeta$ to $D_+(f)\times_YD_+(g)$ is a closed immersion into $D_+(f\otimes g)$. But this is a morphism between affine schemes whose corresponding ring homomorphism $\omega$ is surjective in view of the formula (\ref{scheme Proj Segre morphism over affine ring homomorphism}), so our assertion follows.
\end{proof}
The Segre morphism is functorial on $\mathscr{E}$ and $\mathscr{F}$ if we restrict ourselves to quasi-coherent $\mathscr{O}_Y$-modules with \textit{surjective} homomorphisms. To see this, it suffices to consider a surjective $\mathscr{O}_Y$-homomorphism $\mathscr{E}\to\mathscr{E}'$ and prove that the following diagram is commutative
\[\begin{tikzcd}
\P(\mathscr{E}')\times\P(\mathscr{F})\ar[d,swap,"\zeta"]\ar[r,"j\times 1"]&\P(\mathscr{E}')\times\P(\mathscr{F})\ar[d,"\zeta"]\\
\P(\mathscr{E}'\otimes\mathscr{F})\ar[r]&\P(\mathscr{E}\otimes\mathscr{F})
\end{tikzcd}\]
where $j$ is the canonical closed immersion $\P(\mathscr{E}')\to\P(\mathscr{E})$. Put $P_1'=\P(\mathscr{E}')$ and retain the previous notations; $j\times 1$ is a closed immersion by \cref{scheme Proj of qcoh algera closed subscheme char} and we have
\[(j\times 1)^*(\mathscr{O}_{P_1}(1)\otimes\mathscr{O}_{P_2}(1))=j^*(\mathscr{O}_{P_1}(1))\otimes\mathscr{O}_{P_2}(1)=\mathscr{O}_{P_1'}(1)\otimes\mathscr{O}_{P_2}(1)\]
in view of (\ref{scheme prjective bundle base change twisted prop}) and \cref{scheme inverse image of general tensor under product morphism}. The assertion then follows from \cref{scheme morphism into projective bundle correspondence functoriality}.
\begin{proposition}\label{scheme Proj Segre morphism base change prop}
Let $\psi:Y\to Y'$ be a morphism and put $\mathscr{E}'=\psi^*(\mathscr{E})$, $\mathscr{F}'=\psi^*(\mathscr{F})$. Then the Segre morphism $\P(\mathscr{E}')\times\P(\mathscr{F}')\to\P(\mathscr{E}'\otimes\mathscr{F}')$ is identified with $\zeta_{(Y')}$.
\end{proposition}
\begin{proof}
Put $P_1'=\P(\mathscr{E}')$ and $P_2'=\P(\mathscr{F}')$. Then by \cref{scheme morphism into projective bundle correspondence functoriality}, $P_i'$ is identified with $(P_i)_{(Y')}$ for $i=1,2$, so the structural morphism $P_1'\times_{Y'}P_2'\to Y'$ is identified with $r_{(Y')}$, where $r$ is the structural morphism of $P_1\times_YP_2$. On the other hand, $\mathscr{E}'\otimes\mathscr{F}'$ is identified with $\psi^*(\mathscr{E}\otimes\mathscr{F})$, so $\P(\mathscr{E}'\otimes\mathscr{F}')$ is identified with $\P(\mathscr{E}\otimes\mathscr{F})_{(Y')}$ by \cref{scheme Proj of qcoh alg base change prop}. Finally, $\mathscr{O}_{P_1'}(1)\otimes_{Y'}\mathscr{O}_{P_2'}(1)=\mathscr{L}$ is identified with $\mathscr{L}\otimes_Y\mathscr{O}_{Y'}$ in view of (\ref{scheme prjective bundle base change twisted prop}) and \cref{scheme inverse image of general tensor char}. The canonical homomorphism $(r_{(Y')})^*(\mathscr{E}'\otimes\mathscr{F}')\to\mathscr{L}'$ is then identified with $s_{(Y')}$, and our assertion follows from \cref{scheme morphism into projective bundle surjective hommorphism}.
\end{proof}
\begin{remark}\label{scheme projective bundle sum immersion}
The coproduct of $\P(\mathscr{E})$ and $\P(\mathscr{F})$ is similarly canonical isomorphic to a closed subscheme of $\P(\mathscr{E}\oplus\mathscr{F})$. In fact, the surjective homomorphisms $\mathscr{E}\oplus\mathscr{F}\to\mathscr{E}$, $\mathscr{E}\oplus\mathscr{F}\to\mathscr{F}$ correspond to closed immersions $\P(\mathscr{E})\to\P(\mathscr{E}\oplus\mathscr{F})$, $\P(\mathscr{E})\to\P(\mathscr{E}\oplus\mathscr{F})$; it then boils down to showing that the underlying spaces of these closed subschemes of $\P(\mathscr{E}\oplus\mathscr{F})$ thus obtained have no common point. The question being local on $Y$, we can assume that $Y$ is affine adapt our previous notations. Now $\bm{S}_n(E)$ and $\bm{S}_n(F)$ are identified with submodules of $S_n(E\oplus F)$ with intersection reduced to $0$, and if $\p$ is a graded prime ideal of $\bm{S}(E)$ such that $\p\cap S_n(E)\neq S_n(E)$ for all $n\geq 0$, then it corresponds to a unique graded prime ideal in $\bm{S}(E\oplus F)$ whose trace on $\bm{S}_n(E)$ is $\p\cap S_n(E)$, but which contains $S_+(F)$. Therefore, two distinct points of $\Proj(\bm{S}(E))$ and $\Proj(\bm{S}(F))$ can not have same image in $\Proj(\bm{S}(E\oplus F))$.
\end{remark}
\subsection{Very ample sheaves}
\begin{proposition}\label{scheme morphism into P(E) ft reduction}
Let $Y$ be a quasi-compact scheme, $q:X\to Y$ a morphism of finite type, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module.
\begin{enumerate}
\item[(a)] Let $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra and $\psi:q^*(\mathscr{S})\to\bm{S}(\mathscr{L})$ be a graded homomorphism of algebras. For the morphism $r_{\mathscr{L},\psi}$ to be everywhere defined and an immersion, it is necessary and sufficent that there exists an integer $n\geq 0$ and a quasi-coherent sub-$\mathscr{O}_Y$-module of finite type $\mathscr{E}$ of $\mathscr{S}_n$ such that the homomorphism $\varphi'=\psi_n\circ q^*(j):q^*(\mathscr{E})\to\bm{S}(\mathscr{L})=\mathscr{L}'$ ($j:\mathscr{E}\to\mathscr{S}_n$ being the canonical injection) is surjective and the morphism $r_{\mathscr{L}',\varphi'}:X\to\P(\mathscr{E})$ is an immersion.
\item[(b)] Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_Y$-module and $\varphi:q^*(\mathscr{F})\to\mathscr{L}$ be a surjective homomorphism. For the morphism $r_{\mathscr{L},\varphi}:X\to\P(\mathscr{F})$ to be an immersion, it is necessary and sufficent that there exists a quasi-coherent sub-$\mathscr{O}_Y$-module of finite type $\mathscr{E}$ of $\mathscr{F}$ such that the homomorphism $\varphi'=\varphi\circ q(j):q^*(\mathscr{E})\to\mathscr{L}$ (where $j:\mathscr{E}\to\mathscr{F}$ is the canonical injection) is surjective and such that $r_{\mathscr{L},\varphi'}:X\to\P(\mathscr{E})$ is an immersion.
\end{enumerate}
\end{proposition}
\begin{proof}
We first consider case (a). The fact that $r_{\mathscr{L},\psi}$ is everywhere defined and an immersion is equivalent by \cref{scheme morphism to Proj over qc ft iso to generated by S_1} to the existence of an integer $n>0$ and $\mathscr{E}$ such that, if $\mathscr{S}'$ is the subalgebra of $\mathscr{S}$ generated by $\mathscr{E}$, the homomorphism $q^*(\mathscr{E})\to\mathscr{L}^{\otimes n}$ is surjective and $r_{\mathscr{L},\psi'}:X\to\Proj(\mathscr{S}')$ is everywhere defined and an immersion. We also have a closed immersion corresponding to the surjective homomorphism $\bm{S}(\mathscr{E})\to\mathscr{S}'$, so these the morphism $X\to\P(\mathscr{E})$ is an immersion.\par
Now consider the situation of (b). As $\mathscr{F}$ is the inductive limit of its quasi-coherent submodules of finite type $\mathscr{E}_\lambda$ (\cref{scheme local Noe qcoh is inductive limit ft}), $\bm{S}(\mathscr{F})$ is the inductive limit of the $\bm{S}(\mathscr{E}_\lambda)$, so by \cref{scheme morphism to Proj inductive limit immersion iff} there exists $\lambda$ such that $r_{\mathscr{L},\varphi_\mu}$ is everywhere defined and an immersion for $\mu\geq\lambda$. Also, since the functor $f^*$ is left-adjoint, it commutes with inductive limits and therefore $q^*(\mathscr{F})$ is the inductive limits of the $q^*(\mathscr{E}_\lambda)$. Since $\mathscr{L}$ is an $\mathscr{O}_X$-module of finite type and $q^*(\mathscr{F})\to\mathscr{L}$ is surjective, it follows from \cref{sheaf of module ft over qc surjective homomorphism prop} that there exists $\lambda'$ such that $q^*(\mathscr{E}_\mu)\to\mathscr{L}$ is surjective for $\mu\geq\lambda'$. It then suffices to choose $\mathscr{E}=\mathscr{E}_\mu$ for $\mu\geq\lambda$ and $\mu\geq\lambda'$.
\end{proof}
Let $Y$ be a scheme and $q:X\to Y$ be a morphism. We say an invertible $\mathscr{O}_X$-module $\mathscr{L}$ is \textbf{very ample for $\bm{q}$} (or \textbf{very ample relative to $\bm{q}$}, or simple \textbf{very ample}) if there exists a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ and a $Y$-immersion $r:X\to\P(\mathscr{E})$ such that $\mathscr{L}$ is isomorphic to $r^*(\mathscr{O}_P(1))$. In view of \cref{scheme morphism into projective bundle surjective hommorphism}, this is equivalent to the existence of a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ and a surjective homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$ such that the associated morphism $r_{\mathscr{L},\varphi}:X\to\P(\mathscr{E})$ is an immersion. We also note that the existence of a very ample $\mathscr{O}_X$-module relative to $Y$ implies that $q$ is separated (\cref{scheme Proj is separated} and \cref{scheme morphism separated permanence prop}).
\begin{corollary}\label{scheme very ample if inverse of immersion Proj}
Suppose that there exists a quasi-coherent $\mathscr{O}_Y$-algebra $\mathscr{S}$ genrated by $\mathscr{S}_1$ and a $Y$-immersion $r:X\to P=\Proj(\mathscr{S})$ such that $\mathscr{L}\cong r^*(\mathscr{O}_P(1))$. Then $\mathscr{L}$ is very ample relative to $q$.
\end{corollary}
\begin{proof}
If $\mathscr{F}=\mathscr{S}_1$, the canonical homomorphism $\bm{S}(\mathscr{F})\to\mathscr{S}$ is surjective, so by composing $r$ with the corresponding closed immersion $\Proj(\mathscr{S})\to\P(\mathscr{F})$, we obtain an immersion $r':X\to\P(\mathscr{F})=P'$ such that $\mathscr{L}$ is isomorphic to $r'^*(\mathscr{O}_{P'}(1))$.
\end{proof}
\begin{proposition}\label{scheme very ample iff direct image}
Let $q:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. Then $\mathscr{L}$ is very ample relative to $q$ if and only if $q_*(\mathscr{L})$ is quasi-coherent, the cannical homomorphism $\sigma:q^*(q_*(\mathscr{L}))\to\mathscr{L}$ is surjective, and the morphism $r_{\mathscr{L},\sigma}:X\to\P(q_*(\mathscr{L}))$ is an immersion.
\end{proposition}
\begin{proof}
As $q$ is quasi-compact, $q_*(\mathscr{L})$ is quasi-coherent if $q$ is separated (\cref{scheme morphism qcqs qcoh direct image}). By \cref{scheme qcoh sigma surjective iff global generation}, the existence of a surjective homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$ ($\mathscr{E}$ being a quasi-coherent $\mathscr{O}_Y$-module) implies that $\sigma$ is surjective. Moreover, the factorization $\varphi:q^*(\mathscr{E})\to q^*(q_*(\mathscr{L}))\stackrel{\sigma}{\to}\mathscr{L}$ of (\ref{ringed space u^sharp factorization by sigma}) corresponds to a canonical factorization (recall that $q^*$ commutes with $\bm{S}$)
\[\begin{tikzcd}
q^*(\bm{S}(\mathscr{E}))\ar[r]&q^*(\bm{S}(q_*(\mathscr{L})))\ar[r]&\bm{S}(\mathscr{L})
\end{tikzcd}\]
so by \cref{scheme morphism to Proj algebra homomorphism induce immersion if} the hypothesis that $r_{\mathscr{L},\varphi}$ is an immersion implies that $j=r_{\mathscr{L},\sigma}$ is an immersion. Moreover, by \cref{scheme morphism into projective bundle surjective hommorphism}, $\mathscr{L}$ is isomorphic to $j^*(\mathscr{O}_{P'}(1))$ where $P'=\P(q_*(\mathscr{L}))$. The converse of this is clear by the definition of very ampleness.
\end{proof}
\begin{corollary}\label{scheme very ample local on target}
Let $q:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. For $\mathscr{L}$ to be very ample relative to $Y$, it is necessary and sufficent that there exists an open covering $(U_\alpha)$ of $Y$ such that $\mathscr{L}|_{q^{-1}(U_\alpha)}$ is very ample relative to $U_\alpha$ for each $\alpha$.
\end{corollary}
\begin{proof}
This follows from the fact that the criterion of \cref{scheme very ample iff direct image} is local over $Y$.
\end{proof}
\begin{proposition}\label{scheme very ample iff immersion into Proj}
Let $Y$ be a quasi-compact scheme, $q:X\to Y$ a morphism of finite type, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. Then the following conditions are equivalent: 
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{L}$ is very ample relative to $Y$.
\item[(\rmnum{2})] There exists a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ of finite type and a surjective homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$ such that $r_{\mathscr{L},\varphi}$ is an immersion.
\item[(\rmnum{3})] There exists a coherent sub-$\mathscr{O}_Y$-module of finite type $\mathscr{E}$ of $q_*(\mathscr{L})$ and a surjective homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$ such that $r_{\mathscr{L},\varphi}$ is an immersion.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{2}) or (\rmnum{3}) implies (\rmnum{1}); but (\rmnum{1}) implies (\rmnum{2}) by \cref{scheme morphism into P(E) ft reduction}, and similarly (\rmnum{1}) implies (\rmnum{3}) in view of \cref{scheme very ample iff direct image}.
\end{proof}
\begin{corollary}\label{scheme very ample iff open dominant immersion}
Suppose that $Y$ is a quasi-compact scheme. If $\mathscr{L}$ is very ample relative to $Y$, there exists a quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}$ generated by $\mathscr{S}_1$ and such that $\mathscr{S}_1$ is of finite type, and a dominant open $Y$-immersion $i:X\to P=\Proj(\mathscr{S})$ such that $\mathscr{L}$ is isomorphic to $i^*(\mathscr{O}_P(1))$.
\end{corollary}
\begin{proof}
Since $\mathscr{L}$ is very ample, by \cref{scheme very ample iff immersion into Proj} there exists a coherent sub-$\mathscr{O}_Y$-module of finite type $\mathscr{E}$ of $q_*(\mathscr{L})$ and a surjective homomorphism $\varphi:q^*(\mathscr{E})\to\mathscr{L}$ such that $r_{\mathscr{L},\varphi}$ is an immersion. The structural morphism $p:P'=\P(\mathscr{E})\to Y$ is then separated and of finite type (\cref{scheme Proj of qcoh alg ft if S_1 ft}), so $P'$ is a quasi-compact scheme if $Y$ is quasi-compact. Let $Z$ be scheme theoretic image of $X$ in $P'$, with underlying space $\widebar{j(X)}$, where $j=r_{\mathscr{L},\varphi}$; then $j$ factors through $Z$ into a dominant open immersion $i:X\to Z$. But $Z$ is identified with the scheme $\Proj(\mathscr{S})$, where $\mathscr{S}$ is the quotient graded $\mathscr{O}_Y$-algebra of $\bm{S}(\mathscr{E})$ by a quasi-coherent graded ideal (\cref{scheme Proj of qcoh algera closed subscheme char}), and it is clear that $\mathscr{S}_1$ is generated by $\mathscr{S}$ (since $\bm{S}(\mathscr{E})$ satisfies this condition). Moreover, by \cref{scheme Proj of qcoh algera closed subscheme twisted sheaf char}, $\mathscr{O}_Z(1)$ is the inverse image of $\mathscr{O}_{P'}(1)$ under the canonical injection, so $\mathscr{L}=i^*(\mathscr{O}_Z(1))$.
\end{proof}
\begin{proposition}\label{scheme very ample tensor with free}
Let $q:X\to Y$ be a morphism, $\mathscr{L}$ be a very ample $\mathscr{O}_X$-module relative to $q$, and $\mathscr{L}'$ be an invertible $\mathscr{O}_X$-module such that there exists a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}'$ and a surjective homomorphism $q^*(\mathscr{E}')\to\mathscr{L}'$. Then $\mathscr{L}\otimes_{\mathscr{O}_X}\mathscr{L}'$ is very ample relative to $q$. 
\end{proposition}
\begin{proof}
The hypothesis on $\mathscr{L}'$ implies the existence of an $Y$-morphism $r':X\to P'=\P(\mathscr{E}')$ such that $\mathscr{L}'$ is isomorphic to $r'^*(\mathscr{O}_{P'}(1))$ (\cref{scheme morphism into projective bundle surjective hommorphism}). There is by hypothesis a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ and a $Y$-immersion $r:X\to P=\P(\mathscr{E})$ such that $\mathscr{L}$ is isomorphic to $r^*(\mathscr{O}_P(1))$. Consider the Segre morphism $\zeta:P\times_YP'\to Q$ where $Q=\P(\mathscr{E}\otimes\mathscr{E}')$. As $r$ is an immersions, so is the morphism $(r,r')_Y:X\to P\times_YP'$ by \cref{scheme local immersion stable under target product}, and therefore we get an immersion
\[r'':X\stackrel{(r,r')_Y}{\to}P\times_YP'\stackrel{\zeta}{\to}Q.\]
Since $\zeta^*(\mathscr{O}_Q(1))$ is isomorphic to $\mathscr{O}_P(1)\otimes_Y\mathscr{O}_{P'}(1)$, we conclude from \cref{scheme inverse image of general tensor under product morphism} that $r''^*(\mathscr{O}_Q(1))$ is isomorphic to $\mathscr{L}\otimes\mathscr{L}'$, this proves the assertion.
\end{proof}
\begin{remark}
Note that $q^*(\mathscr{O}_Y^{\oplus I})=\mathscr{O}_X^{\oplus I}$ and there exists a surjection $\mathscr{O}_X^{\oplus I}\to\mathscr{L}'$ if and only if $\mathscr{L}'$ is generated by global sections, so \cref{scheme very ample tensor with free} is applicable if $\mathscr{L}'$ is generated by global sections.
\end{remark}
\begin{corollary}\label{scheme very ample tensor prop}
Let $q:X\to Y$ be a morphism.
\begin{enumerate}
\item[(a)] Let $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module and $\mathscr{K}$ be an invertible $\mathscr{O}_Y$-module. For $\mathscr{L}$ to be very ample relative to $q$, it is necessary and sufficent that $\mathscr{L}\otimes q^*(\mathscr{K})$ is very ample relative to $q$.
\item[(b)] If $\mathscr{L}$ and $\mathscr{L}'$ are two invertible $\mathscr{O}_X$-modules that are very ample relative to $q$, then so is $\mathscr{L}\otimes\mathscr{L}'$. In particular, $\mathscr{L}^{\otimes n}$ is very ample relative to $q$ for any $n>0$.
\end{enumerate}
\end{corollary}
\begin{proof}
The assertions in (b) is an immediate concequence of \cref{scheme very ample tensor with free}, so is the half implication of (a). Now assume that $\mathscr{L}\otimes q^*(\mathscr{K})$ is very ample; then so is $(\mathscr{L}\otimes q^*(\mathscr{K}))\otimes q^*(\mathscr{K}^{-1})$ by \cref{scheme very ample tensor with free}, which is isomorphic to $\mathscr{L}$.
\end{proof}
\begin{proposition}\label{scheme very ample sigma surjective}
Let $f:X\to Y$ be a quasi-compact morphism where $Y$ is quasi-compact, and $\mathscr{L}$ be a very ample $\mathscr{O}_X$-module relative to $f$. Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module of finite type and for each $n\in\Z$, set $\mathscr{F}(n)=\mathscr{F}\otimes\mathscr{L}^{\otimes n}$. Then there exists an integer $n_0$ such that for $n\geq n_0$, the canonical homomorphism $\sigma:f^*(f_*(\mathscr{F}(n)))\to\mathscr{F}(n)$ is surjective.
\end{proposition}
\begin{proof}

\end{proof}
\begin{proposition}\label{scheme very ample qcoh ft is quotient}
Let $f:X\to Y$ be a quasi-compact morphism where $Y$ is quasi-compact, and $\mathscr{L}$ be a very ample $\mathscr{O}_X$-module relative to $f$. Let $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module of finite type. Then there exists an integer $n_0$ such that, for $n\geq n_0$, $\mathscr{F}$ is isomorphic to a quotient of an $\mathscr{O}_X$-module $f^*(\mathscr{G})\otimes_{\mathscr{O}_X}\mathscr{L}^{\otimes(-n)}$, where $\mathscr{G}$ is a quasi-coherent $\mathscr{O}_Y$-module of finite type (dependent on $n$).
\end{proposition}
\begin{proof}
Since $\mathscr{L}$ is very ample, $f$ is separated and by \cref{scheme very ample sigma surjective} the canonical homomorphism $\sigma:f^*(f_*(\mathscr{F}(n)))\to\mathscr{F}(n)$ is surjective for $n$ sufficiently large. The proposition is then a generalization of \cref{scheme Proj of qcoh alg qcoh ft is quotient}, and can be proved similarly.
\end{proof}
\begin{proposition}[\textbf{Properties of Very Ample Sheaves}]\label{scheme very ample permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] For any scheme $Y$, any invertible $\mathscr{O}_Y$-module $\mathscr{L}$ is very ample relative to the identify morphism $1_Y$.
\item[(\rmnum{2})] Let $f:X\to Y$ be a morphism and $j:X'\to X$ be an immersion. If $\mathscr{L}$ is a very ample $\mathscr{O}_X$-module relative to $f$, then $j^*(\mathscr{L})$ is very ample relative to $f\circ j$.
\item[(\rmnum{3})] Let $f:X\to Y$ be a morphism of finite type and $g:Y\to Z$ be a quasi-compact morphism where $Z$ is quasi-compact. Let $\mathscr{L}$ a very ample $\mathscr{O}_X$-module relative to $f$ and $\mathscr{K}$ be a very ample $\mathscr{O}_Y$-module relative to $g$. Then there exists an integer $n_0>0$ such that for any $n\geq n_0$, $\mathscr{L}\otimes f^*(\mathscr{K}^{\otimes n})$ is very ample relative to $g\circ f$.
\item[(\rmnum{4})] Let $f:X\to Y$, $g:Y'\to Y$ be two morphisms, and put $X'=X_{(Y')}$. If $\mathscr{L}$ is a very ample $\mathscr{O}_X$-module relative to $f$, $\mathscr{L}'=\mathscr{L}\otimes_Y\mathscr{O}_{Y'}$ is very ample relative to $f_{(Y')}$.   
\item[(\rmnum{5})] Let $f_i:X_i\to Y_i$ ($i=1,2$) be two $S$-morphisms. If $\mathscr{L}_i$ is a very ample $\mathscr{O}_{X_i}$-module relative to $f_i$, then $\mathscr{L}_1\otimes_S\mathscr{L}_2$ is very ample relative to $f_1\times_Sf_2$.
\item[(\rmnum{6})] Let $f:X\to Y$, $g:Y\to Z$ be two morphisms. If an $\mathscr{O}_X$-module $\mathscr{L}$ is very ample relative to $g\circ f$, then $\mathscr{L}$ is very ample relative to $f$.
\item[(\rmnum{7})] Let $f:X\to Y$ be a morphism and $j:X_{\red}\to X$ be the canonical injection. If $\mathscr{L}$ is a very ample $\mathscr{O}_X$-module relative to $f$, then $j^*(\mathscr{L})$ is very ample relative to $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
The property (\rmnum{2}) follows from the definition and it is immedaite that (\rmnum{7}) is deduced from (\rmnum{2}) and (\rmnum{6}). To prove (\rmnum{6}), consider the factorization
\[\begin{tikzcd}
X\ar[r,"\Gamma_f"]&X\times_ZY\ar[r,"p_2"]&Y
\end{tikzcd}\]
and note that $p_2=(g\circ f)\times 1_Y$. It follows from the hypothesis and from (\rmnum{1}) and (\rmnum{5}) that $\mathscr{L}\otimes_{\mathscr{O}_Z}\mathscr{O}_Y$ is very ample relative to $p_2$. On the other hand, we have $\mathscr{L}=\Gamma_f^*(\mathscr{L}\otimes_{\mathscr{O}_Z}\mathscr{O}_Y)$ by \cref{scheme inverse image of general tensor under product morphism}, and $\Gamma_f$ is an immersion (\cref{scheme morphism graph is immersion}), so we can apply (\rmnum{2}). As for (\rmnum{1}), we can apply the definition with $\mathscr{E}=\mathscr{L}$, and note that $\P(\mathscr{L})$ is identified with $Y$ (\cref{scheme Proj of qcoh graded algebra altering prop}).\par
We now prove (\rmnum{4}). Under the hypothesis of (\rmnum{4}), there exists a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ and a $Y$-immersion $i:X\to P=\P(\mathscr{E})$ such that $\mathscr{L}=i^*(\mathscr{O}_P(1))$. Then, if $\mathscr{E}'=g^*(\mathscr{E})$, $\mathscr{E}'$ is a quasi-coherent $\mathscr{O}_Y$-module and we have $P'=\P(\mathscr{E}')=P_{(Y')}$, $i_{(Y')}$ is an immersion from $X_{(Y')}$ to $P'$, and $\mathscr{L}'$ is isomorphic to $(i_{(Y')})^*(\mathscr{O}_{P'}(1))$ (\cref{scheme morphism into projective bundle correspondence functoriality}).\par
To prove (\rmnum{5}), remark that there exists by hypothesis a $Y_i$-immersion $r_i:X_i\to P_i=\P(\mathscr{E}_i)$, where $\mathscr{E}_i$ is a quasi-coherent $\mathscr{O}_{Y_i}$-module, and $\mathscr{L}_i=r_i^*(\mathscr{O}_{P_i}(1))$. Then $r_1\times_Sr_2$ is an $S$-immersion of $X_1\times_SX_2$ to $P_1\times_SP_2$ (\cref{scheme immersion stable under product}) and the inverse image of $\mathscr{O}_{P_1}(1)\otimes_S\mathscr{O}_{P_2}(1)$ by this immersion is $\mathscr{L}_1\otimes_S\mathscr{L}_2$. On the other hand, put $T=Y_1\times_SY_2$, and let $p_1,p_2$ be the projection of $T$, respectively. If $P'_i=\P(p_i^*(\mathscr{E}_i))$, we have $P_i'=P_i\times_{Y_i}T$, whence
\[P'_1\times_TP'_2=(P_1\times_{Y_1}T)\times_T(P_2\times_{Y_2}T)=P_1\times_{Y_1}(T\times_{Y_2}P_2)=P_1\times_{Y_1}(Y_1\times_SP_2)=P_1\times_SP_2.\]
Similarly, we have $\mathscr{O}_{P'_i}(1)=\mathscr{O}_{P'_i}(1)\otimes_{Y_i}\mathscr{O}_T$, and $\mathscr{O}_{P'_1}(1)\otimes_T\mathscr{O}_{P'_2}(1)$ is identified with $\mathscr{O}_{P_1}(1)\otimes_S\mathscr{O}_{P_2}(1)$. We can then consider $r_1\times_Sr_2$ as an $T$-immersion from $X_1\times_SX_2$ to $P'_1\times_TP_2'$, the inverse image of $\mathscr{O}_{P'_1}(1)\otimes_T\mathscr{O}_{P'_2}(1)$ by this immersion being $\mathscr{L}_1\otimes_S\mathscr{L}_2$. We can then conclude as in \cref{scheme very ample tensor with free} that $\mathscr{L}_1\otimes_S\mathscr{L}_2$ is very ample.\par
It remains to prove (\rmnum{3}). We can first restrict to the case where $Z$ is an affine scheme, since there exists a finite covering $(U_i)$ of $Z$ by affine opens; if the property is proved for $\mathscr{K}|_{g^{-1}(U_i)}$, $\mathscr{L}|_{f^{-1}(g^{-1}(U_i))}$ and an integer $n_i$, it suffices to choose $n_0$ to be the largest $n_i$ to prove the property for $\mathscr{K}$ and $\mathscr{L}$ (\cref{scheme very ample local on target}). The hypotheses imply that $f,g$ are spearated morphisms, so $X$ and $Y$ are quasi-compact schemes. Since $\mathscr{L}$ is very ample relative to $f$, there exists an immersion $r:X\to P=\P(\mathscr{E})$, where $\mathscr{E}$ is a quasi-coherent $\mathscr{O}_Y$-module of finite type and $\mathscr{L}=r^*(\mathscr{O}_P(1))$, in view of \cref{scheme very ample iff immersion into Proj}. We claim that there exists an integer $m_0$ such that for any $m\geq m_0$, there is a very ample $\mathscr{O}_P$-module $\mathscr{M}$ relative to the composition morphism $j:P\to Y\stackrel{g}{\to}Z$ such that $\mathscr{O}_P(1)$ is isomorphic to $\mathscr{M}\otimes_Y\mathscr{K}^{\otimes(-m)}$. For $n\geq m+1$, $\mathscr{O}_P(1)\otimes_Y\mathscr{K}^{\otimes n}$ will then be very ample relative to $Z$ in view of the hypothesis and applying (\rmnum{5}) to the morphism $j:P\to Z$ and $1_Z$; as $r$ is an immersion and $\mathscr{L}\otimes f^*(\mathscr{K}^{\otimes n})=r^*(\mathscr{O}_P(1)\otimes_Y\mathscr{K}^{\otimes n})$, the conclusion then follows from (\rmnum{2}).\par
To estabilsh the claim, we can use \cref{scheme very ample qcoh ft is quotient} to obtain a closed immersion $j_1$ of $P$ to $P_1=\P(g^*(\mathscr{F})\otimes\mathscr{K}^{\otimes(-m)})$ such that $\mathscr{O}_P(1)$ is isomorphic to $j_1^*(\mathscr{O}_{P_1}(1))$ (\cref{scheme Proj of qcoh algera closed subscheme char}). On the other hand, there is an isomorphism from $P_1$ to $P_2=\P(g^*(\mathscr{F}))$, identifying $\mathscr{O}_{P_1}(1)$ with $\mathscr{O}_{P_2}(1)\otimes_Y\mathscr{K}^{\otimes(-m)}$ (\cref{scheme projective bundle of tensor with invertible prop}); we then have a closed immersion $j_2:P\to P_2$ such that $\mathscr{O}_P(1)$ is isomorphic to $j_2^*(\mathscr{O}_{P_2}(1))\otimes_Y\mathscr{K}^{\otimes(-m)}$. Finally, $P_2$ is identified with $P_3\times_ZY$ where $P_3=\P(\mathscr{F})$, and $\mathscr{O}_{P_2}(1)$ is identified with $\mathscr{O}_{P_3}(1)\otimes_Z\mathscr{O}_Y$ (\ref{scheme prjective bundle base change twisted prop}). By definition, $\mathscr{O}_{P_3}(1)$ is very ample for $Z$, and so is $\mathscr{K}$, so it follows from (\rmnum{5}) that the $\mathscr{O}_{P_2}$-module $\mathscr{O}_{P_3}(1)\otimes_Y\mathscr{K}$ is very ample for $Z$. In view of (\rmnum{2}), $\mathscr{M}=j_2^*(\mathscr{O}_{P_3}(1)\otimes_Y\mathscr{K})$ is then very ample for $Z$, and $\mathscr{O}_P(1)$ is isomorphic to $\mathscr{M}\otimes_Y\mathscr{K}^{\otimes(-m-1)}$, whence the demonstration.
\end{proof}
\begin{proposition}\label{scheme very ample and coproduct}
Let $f:X\to Y$, $f':X'\to Y$ be two morphisms, $X''=X\amalg X'$, and $f''=f\amalg f'$. Let $\mathscr{L}$ (resp. $\mathscr{L}'$) be an invertible $\mathscr{O}_X$-module (resp. $\mathscr{O}_{X'}$-module), and let $\mathscr{L}''$ be the invertible $\mathscr{O}_{X''}$-module which coincides with $\mathscr{L}$ over $X$ and with $\mathscr{L}'$ over $X'$. For $\mathscr{L}''$ to be very ample relative to $f''$, it is necessary and sufficent that $\mathscr{L}$ is very ample relative to $f$ and $\mathscr{L}'$ is very ample relative to $f'$.
\end{proposition}
\begin{proof}
We can assume that $Y$ is affine. If $\mathscr{L}''$ is very ample then so is $\mathscr{L}$ and $\mathscr{L}'$ in view of \cref{scheme very ample permanence prop}(\rmnum{2}). Conversely, if $\mathscr{L}$ and $\mathscr{L}'$ are very ample, it follows from \cref{scheme projective bundle sum immersion} that $\mathscr{L}''$ is very ample.
\end{proof}
\subsection{Ample sheaves}
Let $X$ be a scheme, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, and $\mathscr{F}$ be an $\mathscr{O}_X$-module. For any $n\in\Z$, we set $\mathscr{F}(n)=\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{L}^{\otimes n}$ (if there is no confusion), and $S=\bigoplus_{n\geq 0}\Gamma(X,\mathscr{L}^{\otimes n})$. If we consider $X$ as a $\Z$-scheme and let $p:X\to Y=\Spec(\Z)$ be the structural morphism, there are bijections
\[\Hom_{\mathsf{Qcoh}(X)}(p^*(\bigtilde{S}),\bm{S}(\mathscr{L}))\stackrel{\sim}{\to}\Hom_{\mathsf{Qcoh}(Y)}(\widetilde{S},p_*(\bm{S}(\mathscr{L})))\stackrel{\sim}{\to}\Hom_{\Z}(S,\Gamma(X,\bm{S}(\mathscr{L})))\]
where we use \cref{scheme morphism to affine qcoh sheaf}. The homomorphism $\eps:p^*(\bigtilde{S})\to\bm{S}(\mathscr{L})$ corresponding to the canonical injection of $S$ into $\Gamma(X,\bm{S}(\mathscr{L}))$ is called the \textbf{canonical homomorphism associated with $\mathscr{L}$}. It then corresponds to a canonical morphism
\begin{align}\label{scheme invertible sheaf canonical morphism to Proj(S)}
r_{\mathscr{L},\eps}:G(\eps)\to\Proj(S).
\end{align}
\begin{theorem}\label{scheme ample sheaf iff}
Let $X$ be a quasi-compact and quasi-separated scheme, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module and $S=\bigoplus_{n\geq 0}\Gamma(X,\mathscr{L}^{\otimes n})$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] The subsets $X_f$, as $f$ runs through the set of homogeneous elements of $S_+$, form a basis for $X$.
\item[(\rmnum{1}')] The subsets $X_f$ which are affine, as $f$ runs through the set of homogeneous elements of $S_+$, form a basis for $X$.
\item[(\rmnum{2})] The canonical morphism $r_{\mathscr{L},\eps}:G(\eps)\to\Proj(S)$ is everywhere defined and a dominant open immersin.
\item[(\rmnum{2}')] The canonical morphism $r_{\mathscr{L},\eps}:G(\eps)\to\Proj(S)$ is everywhere defined and a homeomorphism from $X$ onto a subspace of $\Proj(S)$.
\item[(\rmnum{3})] For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, if $\mathscr{F}_n$ is the sub-$\mathscr{O}_X$-module of $\mathscr{F}(n)$ generated by the sections of $\mathscr{F}(n)$ over $X$, then $\mathscr{F}$ is the direct sum of the sub-$\mathscr{O}_X$-modules $\mathscr{F}_n(-n)$ for $n>0$.
\item[(\rmnum{3}')] Property (\rmnum{3}) holds for any quasi-coherent ideal of $\mathscr{O}_X$.
\end{enumerate}
Moreover, in this case, if $(f_\alpha)$ is a family of homogeneous elements of $S_+$ such that $X_{f_\alpha}$ is affine, then the restriction to $\bigcup_\alpha X_{f_\alpha}$ of the canonical morphism $r_{\mathscr{L},\eps}:X\to\Proj(S)$ is an isomorphism from $\bigcup_\alpha X_{f_\alpha}$ to $\bigcup_\alpha(\Proj(S))_{f_\alpha}$.
\end{theorem}
\begin{proof}
It is clear that (\rmnum{2}) implies (\rmnum{2}'), and (\rmnum{2}') implies (\rmnum{1}) in view of the formula (\ref{scheme morphism into Proj affine D_+(f) preimage char-1}). Condition (\rmnum{1}) implies (\rmnum{1}'), because any $x\in X$ admits an affine neighborhood $U$ such that $\mathscr{L}|_U$ is isomorphic to $\mathscr{O}_X|_U$; if $f\in\Gamma(X,\mathscr{L}^{\otimes n})$ is such that $x\in X_f\sub U$, $X_f$ is also the set of $x'\in U$ such that $(f|_U)(x')\neq 0$, and this is an affine open subset of $U$ (hence of $X$). To prove that (\rmnum{1}') implies (\rmnum{2}), it suffices to show the last assertion of the statement, hence to check that if $X=\bigcup_\alpha X_{f_\alpha}$, the condition (\rmnum{4}) of \cref{scheme morphism into Proj affine immersion iff} is satisfied; this follows immediately from \cref{scheme qcqs qcoh extension by invertible sheaf}(a). To see that $r_{\mathscr{L},\eps}$ is dominant, we note that for $f\in S_+$ homogeneous, $X_f$ is the inverse image of $D_+(f)$ by $r_{\mathscr{L},\eps}$ and by \cref{scheme qcqs section of qcoh over X_s char} we have $\Gamma(X_f,\mathscr{O}_X)=S_{(f)}$ is nonzero if $f$ is not nilpotent, so $X_f$ is nonempty if $D_+(f)$ is not empty.\par
To prove that (\rmnum{1}') implies (\rmnum{3}), note that if $X_f$ is affine (where $f\in S_d$), $\mathscr{F}|_{X_f}$ is generated by its sections over $X_f$ (\cref{scheme affine qcoh sheaf on qc open char}); on the other hand, by \cref{scheme qcqs qcoh extension by invertible sheaf} such a section $s$ is of the form $(t|_{X_f})\otimes(f|_{X_f})^{-m}$ where $t\in\Gamma(X,\mathscr{F}(md))$. By definition, $t$ is also a section of $\mathscr{F}_{md}$, so $s$ is a section of $\mathscr{F}_{md}(-md)$ over $X_f$, which proves (\rmnum{3}). It is clear that (\rmnum{3}) implies (\rmnum{3}'), and it rests to show that (\rmnum{3}') implies (\rmnum{1}). Now let $U$ be an open neighborhood of $x\in X$, and let $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_X$ defining a closed subscheme of $X$ with underlying subspace $X-U$. The hypothesis of (\rmnum{3}') implies that there exists an integer $n>0$ and a section $\mathscr{I}(n)$ over $X$ such that $f(x)\neq 0$. Then we have evidently $f\in S_n$ and $x\in X_f\sub U$, this proves (\rmnum{1}).
\end{proof}
If $X$ is a quasi-compact and quasi-separated scheme, the equivalent conditions of \cref{scheme ample sheaf iff} implies that $X$ is separated, since it is isomorphic to a subscheme of $\Proj(S)$. We say an invertible $\mathscr{O}_X$-module $\mathscr{L}$ is \textbf{ample} if $X$ is a qausi-compact and quasi-separated scheme and the equivalent conditions of \cref{scheme ample sheaf iff} are satisfied. It follows from \cref{scheme ample sheaf iff}(\rmnum{1}) that if $\mathscr{L}$ is an ample $\mathscr{O}_X$-module, then for any open subset $U$ of $X$, $\mathscr{L}|_U$ is an ample $(\mathscr{O}_X|_U)$-module.
\begin{corollary}\label{scheme ample sheaf X_f affine nbhd of finite}
Let $\mathscr{L}$ be an ample $\mathscr{O}_X$-module. For any finite subspace $Z$ of $X$ and any open neighborhood $U$ of $Z$, there exists an integer $n>0$ and a section $f\in\Gamma(X,\mathscr{L}^{\otimes n})$ such that $X_f$ is an affine neighborhood of $Z$ contained in $U$.
\end{corollary}
\begin{proof}
In view of \cref{scheme ample sheaf iff}(\rmnum{2}), we can view $X$ as a subscheme of $\Proj(S)$ and we only need to prove that for any finite subset $Z'$ of $\Proj(S)$ and any open neighborhood $U$ of $Z'$, there exists a homogeneous element $f\in S_+$ such that $Z\sub D_+(f)\sub U$. Now by definition the closed set $Y$, which is the complement of $U$ in $\Proj(S)$, is of the form $V_+(\mathfrak{I})$ where $\mathfrak{I}$ is a graded ideal of $S$, not containing $S_+$; on the other hand, the points of $Z'$ are by definition graded prime ideals $\p_i$ of $S_+$ not containing $\mathfrak{I}$. There then exists an element $f\in\mathfrak{I}$ not contained in each $\p_i$ (\cref{Spec of ring minimal prime and compact open}), and as the $\p_i$ are graded, we can assume that $f$ is homogeneous. This element $f$ then satisfies the required.
\end{proof}
\begin{proposition}\label{scheme ample sheaf iff global generation}
Suppose that $X$ is a quasi-compact and quasi-separated scheme. Then the conditions of \cref{scheme ample sheaf iff} are equivalent to the following conditions:
\begin{enumerate}
\item[(\rmnum{4})] For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type, there exists an integer $n_0>0$ such that, for any $n\geq n_0$, $\mathscr{F}(n)$ is generated by its sections over $X$. 
\item[(\rmnum{4}')] For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type, there exists integers $n>0,k>0$ such that $\mathscr{F}$ is isomorphic to a quotient of the $\mathscr{O}_X$-module $\mathscr{L}^{\otimes(-n)}\otimes\mathscr{O}_X^k$. 
\item[(\rmnum{4}'')] Property (\rmnum{4}') holds for any quasi-coherent ideal of $\mathscr{O}_X$ of finite type.
\end{enumerate}
\end{proposition}
\begin{proof}
As $X$ is quasi-compact, if a quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type is such that $\mathscr{F}(n)$ is generated by global sections, $\mathscr{F}(n)$ is then generated by finitely many global sections (\cref{sheaf of module ft over qc global generated then finite}), so (\rmnum{4}) impliess (\rmnum{4}') and it is clear that (\rmnum{4}') implies (\rmnum{4}''). As any quasi-coherent $\mathscr{O}_X$-module $\mathscr{G}$ is the inductive limit of its sub-$\mathscr{O}_X$-modules of finte type (\cref{scheme local Noe qcoh is inductive limit ft}), to verify conditin (\rmnum{3}') of \cref{scheme ample sheaf iff}, it suffices to verify that for a quasi-coherent ideal of $\mathscr{O}_X$ that is of finite type, and this is clear if condition (\rmnum{4}'') holds. It remains to prove that if $\mathscr{L}$ is an ample $\mathscr{O}_X$-module, then condition (\rmnum{4}) holds. Consider a finite affine open covering $(X_{f_i})$ of $X$ with $f_i\in S_{n_i}$; by changing $f_i$ by its power, we can assume that the integers $n_i$ equal to the same integer $m$. The sheaf $\mathscr{F}|_{X_{f_i}}$, being of finite type by hypotheses, is generated by a finitely number of sections $h_{ij}$ over $X_{f_i}$ (\cref{scheme affine qcoh ft and fp iff}). By \cref{scheme qcqs qcoh extension by invertible sheaf}, there then exists an integer $k_0$ such that the section $h_{ij}\otimes f_i^{k_0}$ extend to a section of $\mathscr{F}(k_0m)$ over $X$ for any couple $(i,j)$. A fortiori the $h_{ij}\otimes f_i^{k}$ extend to sections of $\mathscr{F}(km)$ over $X$ for $k\geq k_0$, and for such values of $k$, $\mathscr{F}(km)$ is then generated by global sections. For any integer $p$ such that $0<p<m$, $\mathscr{F}(p)$ is also of finite type, so there exist an integer $k_p$ such that $\mathscr{F}(p)(km)=\mathscr{F}(p+km)$ is generated by global sections for $k\geq k_p$. Let $n_0$ be the largest of the $k_pm$ for $0<p<m$; we then conclude that $\mathscr{F}(n)$ is generated by global sections for $n\geq n_0$.
\end{proof}
\begin{proposition}\label{scheme ample sheaf iff power ample}
Let $X$ be a quasi-compact and quasi-separated scheme and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module.
\begin{enumerate}
\item[(a)] Let $n>0$ be an integer. For $\mathscr{L}$ to be ample, it is necessary and sufficent that $\mathscr{L}^{\otimes n}$ is ample.
\item[(b)] Let $\mathscr{L}'$ be an inveritble $\mathscr{O}_X$-module such that, for any $x\in X$, there exists a section $s'$ of $\mathscr{L}'^{\otimes n}$ over $X$ such that $s'(x)\neq 0$. Then, if $\mathscr{L}$ is ample, so is $\mathscr{L}\otimes\mathscr{L}'$.
\end{enumerate}
\end{proposition}
\begin{proof}
Property (a) is a concequence of (\rmnum{1}) of \cref{scheme ample sheaf iff} since $X_{f^{\otimes n}}=X_f$. On the other hand, if $\mathscr{L}$ is ample, for any $x\in X$ and any neighborhood $U$ of $x$, there exists $m>0$ and $f\in\Gamma(X,f^{\otimes m})$ such that $x\in X_f\sub U$; if $f'\in\Gamma(X,\mathscr{L}'^{\otimes n})$ is such that $f'(x)\neq 0$, then $s(x)\neq 0$ for $s=f^{\otimes n}\otimes f'^{\otimes m}\in\Gamma(X,(\mathscr{L}\otimes\mathscr{L}')^{\otimes mn})$, so $x\in X_s\sub X_f\sub U$, and therefore $\mathscr{L}\otimes\mathscr{L}'$ is ample.
\end{proof}
\begin{corollary}\label{scheme ample sheaf tensor ample}
The tensor product of two ample $\mathscr{O}_X$-modules is ample.
\end{corollary}
\begin{proof}
An ample $\mathscr{O}_X$-module satisfies the condition of \cref{scheme ample sheaf iff power ample}(b).
\end{proof}
\begin{corollary}\label{scheme ample sheaf archimedean prop}
Let $\mathscr{L}$ be an ample $\mathscr{O}_X$-module and $\mathscr{L}'$ be an invertible $\mathscr{O}_X$-module. There then exists an integer $n_0>0$ such that $\mathscr{L}^{\otimes n}\otimes\mathscr{L}'$ is ample and generated by global sections for $n\geq n_0$.
\end{corollary}
\begin{proof}
It follows from \cref{scheme ample sheaf iff global generation} that there exists an integer $m_0$ such that for $m\geq m_0$, $\mathscr{L}^{\otimes m}\otimes\mathscr{L}'$ is generated by global sections, and therefore satisfies the condition of \cref{scheme ample sheaf iff power ample}(b); we can then choose $n_0=m_0+1$.
\end{proof}
\begin{remark}
Let $P=\Pic(X)=H^1(X,\mathscr{O}_X^{\times})$ be the picard group of $\mathscr{O}_X$-modules, and let $P^+$ be the subset of $P$ formed by ample sheaves. Suppose that $P^+$ is nonempty. Then it follows from \cref{scheme ample sheaf tensor ample} and \cref{scheme ample sheaf archimedean prop} that we have
\[P^++P^+\sub P^+,\quad P^+-P^+=P.\]
which means $P^+\cup\{0\}$ is the set of positive elements of $P$ for an order structure over $P$ compatible with the group structure, which is archimedean in view of \cref{scheme ample sheaf archimedean prop}.
\end{remark}
\begin{proposition}\label{scheme ample sheaf over affine iff power very ample}
Let $q:X\to Y$ be a quasi-compact and quasi-separated morphism where $Y$ is affine, and $\mathscr{L}$ be an inveritble $\mathscr{O}_X$-module.
\begin{enumerate}
\item[(a)] If $\mathscr{L}$ is very ample relative to $q$ then $\mathscr{L}$ is ample.
\item[(b)] Suppose that $q$ is of finite type. Then for $\mathscr{L}$ to be ample, it is necessary and sufficent that it satisfies the following equivalent conditions:
\begin{enumerate}
\item[(\rmnum{5})] There exists $n_0>0$ such that for any integer $n\geq n_0$, $\mathscr{L}^{\otimes n}$ is very ample relative to $q$.
\item[(\rmnum{5}')] There exists $n>0$ such that $\mathscr{L}^{\otimes n}$ is very ample relative to $q$.
\end{enumerate} 
\end{enumerate}
\end{proposition}
\begin{proof}
The first assertion follows from the definition of very ample: if $A$ is the ring of $Y$, there exists an $A$-module $E$ and a surjective homomorphism
\[\psi:q^*(\widetilde{\bm{S}(E)})\to\bm{S}(\mathscr{L})\]
such that $i=r_{\mathscr{L},\psi}$ is an immersion from $X$ to $P=\P(\widetilde{E})$ such that $\mathscr{L}\cong i^*(\mathscr{O}_P(1))$. As the $D_+(f)$ for $f\in\bm{S}(E)_+$ homogeneous form a basis for $P$ and $i^{-1}(D_+(f))=X_{\psi^\flat(f)}$, we see that condition (\rmnum{1}) of \cref{scheme ample sheaf iff} holds, so $\mathscr{L}$ is ample.\par
Now assume that $q$ is of finite type and $\mathscr{L}$ is ample. It follows from \cref{scheme ample sheaf iff}(\rmnum{2}) and \cref{scheme morphism into P(E) ft reduction}(a) that there exists an integer $k_0>0$ such that $\mathscr{L}^{\otimes k_0}$ is very ample relative to $q$. On the other hand, in view of \cref{scheme ample sheaf iff global generation}, there exists an integer $m_0$ such that, for $m\geq m_0$, $\mathscr{L}^{\otimes m}$ is generated by global sections. Put $n_0=k_0+m_0$; if $n\geq n_0$, we can write $n=k_0+m$ where $m\geq m_0$, whence $\mathscr{L}^{\otimes n}=\mathscr{L}^{\otimes k_0}\otimes\mathscr{L}^{\otimes m}$. As $\mathscr{L}^{\otimes m}$ is generated by global sections, it follow from \cref{scheme very ample tensor with free} and \cref{scheme qcoh sigma surjective iff global generation} that $\mathscr{L}^{\otimes n}$ is very ample relative to $q$. Finally, it is clear that (\rmnum{5}) implies (\rmnum{5}'), and (\rmnum{5}') implies that $\mathscr{L}$ is ample in view of (a) and \cref{scheme ample sheaf iff power ample}. 
\end{proof}
\begin{corollary}\label{scheme ample tensor with power is very ample}
Let $q:X\to Y$ be a quasi-compact and quasi-separated morphism of finite type where $Y$ is affine, $\mathscr{L}$ be an ample $\mathscr{O}_X$-module, and $\mathscr{L}'$ be an invertible $\mathscr{O}_X$-module. Then there exists an integer $n_0>0$ such that for $n\geq n_0$, $\mathscr{L}^{\otimes n}\otimes\mathscr{L}'$ is very ample relative to $q$.
\end{corollary}
\begin{proof}
In fact, there exists integer $m_0$ such that for $m\geq m_0$, $\mathscr{L}^{\otimes m}\otimes\mathscr{L}'$ is generated by global section (\cref{scheme ample sheaf archimedean prop}); on the other hand, there exists $k_0$ such that $\mathscr{L}^{\otimes k}$ is very ample relative to $q$ for $k\geq k_0$. Thus $\mathscr{L}^{\otimes(k+m_0)}\otimes\mathscr{L}'$ is very ample for $k\geq k_0$ (\cref{scheme very ample iff open dominant immersion}).
\end{proof}
\begin{proposition}\label{scheme ample sheaf iff over nilpotent subscheme}
Let $X$ be a quasi-compact scheme, $Z$ be a closed subscheme of $X$ defined by a qausi-coherent nilpotent ideal $\mathscr{I}$ of $\mathscr{O}_X$, and $j:Z\to X$ be the canonical injectin. For an inveritble $\mathscr{O}_X$-module $\mathscr{L}$ to be ample, it is necessary and sufficient that $\mathscr{L}'=j^*(\mathscr{L})$ is an ample $\mathscr{O}_Z$-module.
\end{proposition}
\begin{proof}
This conditions is necessary. In fact, for any section $f$ of $\mathscr{L}^{\otimes n}$ over $X$, let $f'$ be the image $f\otimes 1$, which is a section of $\mathscr{L}'^{\otimes n}=\mathscr{L}^{\otimes n}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I})$ over the subspace $Z$ (identified with $X$); it is clear that $Z_{f'}=X_f$, hence condition (\rmnum{1}) of \cref{scheme ample sheaf iff} shows that $\mathscr{L}'$ is ample.\par
To prove the sufficiency, note first that we can reduce to the case $\mathscr{I}^2=0$ by considering the finite sequence of schemes $X_k=(X,\mathscr{O}_X/\mathscr{I}^{k+1})$, which is a closed subscheme of the previous one and is defined by a square zero ideal. Now $X$ is quasi-separated if $X_{\red}$ is quasi-separated (\cref{scheme morphism qs permanence prop}(\rmnum{6})). Criterion (\rmnum{1}) of \cref{scheme ample sheaf iff} shows that it will suffice to prove that, if $g$ is a section of $\mathscr{L}'^{\otimes n}$ over $Z$ such that $Z_g$ is affine, then there exists $m>0$ such that $g^{\otimes m}$ is the canonical image of a section $f$ of $\mathscr{L}^{\otimes nm}$ over $X$. For this, we consider the exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{I}(n)\ar[r]&\mathscr{O}_X(n)=\mathscr{L}^{\otimes n}\ar[r]&\mathscr{O}_Z(n)=\mathscr{L}'^{\otimes n}\ar[r]&0
\end{tikzcd}\]
since $\mathscr{F}(n)$ is an exact functor on $\mathscr{F}$; whence an exact sequence on cohomology:
\[\begin{tikzcd}
0\ar[r]&\Gamma(X,\mathscr{I}(n))\ar[r]&\Gamma(X,\mathscr{L}^{\otimes n})\ar[r]&\Gamma(X,\mathscr{L}'^{\otimes n})\ar[r,"\delta"]&H^1(X,\mathscr{I}(n))
\end{tikzcd}\]
which associates in particular $g$ to an element $\delta g\in H^1(X,\mathscr{I}(n))$.\par
Note that since $\mathscr{I}^2=0$, $\mathscr{I}$ can be considered as a quasi-coherent $\mathscr{O}_Z$-module and we have, for any $k$, $\mathscr{L}'^{\otimes k}\otimes_{\mathscr{O}_Z}\mathscr{I}(n)=\mathscr{I}(n+k)$. For any section $s\in\Gamma(X,\mathscr{L}'^{\otimes k})$, tensoring by $s$ is then a homomorphism $\mathscr{I}(n)\to\mathscr{I}(n+k)$ of $\mathscr{O}_Z$-modules, which gives a homomorphism $H^i(X,\mathscr{I}(n))\to H^i(X,\mathscr{I}(n+k))$ of cohomology groups. We claim that
\begin{align}\label{scheme ample sheaf iff over nilpotent subscheme-1}
g^{\otimes m}\otimes\delta g=0
\end{align}
for $m>0$ sufficiently large. In fact, $Z_g$ is an affine open of $Z$ and we have $H^1(Z_g,\mathscr{I}(n))=0$ where $\mathscr{I}(n)$ is considered as an $\mathscr{O}_Z$-module. In particular, if we put $g'=g|_{Z_g}$, and if we consider its image under $\delta:\Gamma(Z_g,\mathscr{L}'^{\otimes n})\to H^1(Z_g,\mathscr{I}(n))$, we have $\delta g'=0$. To explain this relation, observe that the first cohomology group of a sheaf coincides with the Cech cohomology; to form $\delta g$, it is necessary to consider an open covering $(U_\alpha)$ of $X$, which we can assume that is finite and formed by affine opens, and choose for each $\alpha$ a section $g_\alpha\in\Gamma(U_\alpha,\mathscr{L}^{\otimes n})$ whose image in $\Gamma(U_\alpha,\mathscr{L}'^{\otimes n})$ is $g|_{U_\alpha}$, and consider the class of cocycle $(g_{\alpha\beta}-g_{\beta\alpha})$, where $g_{\alpha\beta}$ is the restriction of $g_\alpha$ to $U_\alpha\cap U_\beta$ (a cocycle with values in $\mathscr{I}(n)$). We can moreover suppose that $\delta g'$ is in the same manner using the covering formed by $U_\alpha\cap Z_g$ and the restrictions $g_\alpha|_{U_\alpha\cap Z_g}$; the relation $\delta g'=0$ signifies then that there exists for each $\alpha$ a section $h_\alpha\in\Gamma(U_\alpha\cap Z_g,\mathscr{I}(n))$ such that $(g_{\alpha\beta}-g_{\beta\alpha})|_{U_\cap\cap U_\beta\cap Z_g}=h_{\alpha\beta}-h_{\eta\alpha}$, where $h_{\alpha\beta}$ denotes the restriction of $h_\alpha$ to $U_{\alpha}\cap U_\beta\cap Z_g$. Now by \cref{scheme qcqs qcoh extension by invertible sheaf} there exists an integer $m>0$ such that $g^{\otimes m}\otimes h_\alpha$ is the restriction to $U_\alpha\cap Z_g$ of a section $t_\alpha\in\Gamma(U_\alpha,\mathscr{I}(n+nm))$ for each $\alpha$; we then have $g^{\otimes m}\otimes(g_{\alpha\beta}-g_{\beta\alpha})=t_{\alpha\beta}-t_{\beta\alpha}$ for any couple of indices, which proves $g^{\otimes m}\otimes\delta g=0$.\par
We remark on the other hand that if $s\in\Gamma(X,\mathscr{O}_Z(p))$, $t\in\Gamma(X,\mathscr{O}_Z(q))$, we have, in the group $H^1(X,\mathscr{I}(p+q))$, that
\begin{align}\label{scheme ample sheaf iff over nilpotent subscheme-2}
\delta(s\otimes t)=(\delta s)\otimes t+s\otimes(\delta t).
\end{align}
For this, we can still consider an open cover $(U_\alpha)$ of $X$, and for each $\alpha$ a section $s_\alpha\in\Gamma(U_\alpha,\mathscr{O}_X(p))$ (resp. a section $t_\alpha\in\Gamma(U_\alpha,\mathscr{O}_X(q))$) whose canonical image in $\Gamma(U_\alpha,\mathscr{O}_Z(p))$ (resp. in $\Gamma(U_\alpha,\mathscr{O}_Z(q))$) is $s|_{U_\alpha}$; the relation (\ref{scheme ample sheaf iff over nilpotent subscheme-2}) then follows from
\[(s_{\alpha\beta}\otimes t_{\alpha\beta})-(s_{\beta\alpha}\otimes t_{\beta\alpha})=(s_{\alpha\beta}-s_{\beta\alpha})\otimes t_{\alpha\beta}+s_{\beta\alpha}\otimes(t_{\alpha\beta}-t_{\beta\alpha})\]
with the same notations before. By recurrence on $k$, we then have
\begin{align}\label{scheme ample sheaf iff over nilpotent subscheme-3}
\delta(g^{\otimes k})=(kg^{\otimes(k-1)})\otimes(\delta g)
\end{align}
and in view of (\ref{scheme ample sheaf iff over nilpotent subscheme-1}) and (\ref{scheme ample sheaf iff over nilpotent subscheme-3}), we have $\delta(g^{\otimes(m+1)})=0$, so $g^{\otimes(m+1)}$ is the canonical image of a section $f$ of $\mathscr{L}^{\otimes n(m+1)}$ over $X$, whence our demonstration. 
\end{proof}
\begin{corollary}\label{scheme ample sheaf iff over X_red}
Let $X$ be a Noetherian scheme and $j:X_{\red}\to X$ be the canonical injection. For an inveritble $\mathscr{O}_X$-module $\mathscr{L}$ to be ample, it is necessary and sufficient that $j^*(\mathscr{L})$ is an ample $\mathscr{O}_{X_{\red}}$-module.
\end{corollary}
\begin{proof}
The nilradical $\mathscr{N}_X$ is nilpotent and we can apply \cref{scheme ample sheaf iff over nilpotent subscheme}.
\end{proof}
\subsection{Relatively ample sheaves}
Let $f:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. We say that $\mathscr{L}$ is \textbf{ample relative to $\bm{f}$}, or relative to $Y$, or \textbf{$\bm{f}$-ample}, or \textbf{$\bm{Y}$-ample}, if there exists an affine open covering $(U_\alpha)$ of $Y$ such that if $X_\alpha=f^{-1}(U_\alpha)$, $\mathscr{L}|_{X_\alpha}$ is an ample $\mathscr{O}_{X_\alpha}$-module for each $\alpha$. Again, the existence of an $f$-ample $\mathscr{O}_X$-module implies that $X$ is separated, so $f$ is necessarily separated by \cref{scheme morphism separated permanence prop}.
\begin{proposition}\label{scheme very ample is relative ample}
Let $f:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. If $\mathscr{L}$ is very ample relative to $f$, then it is ample relative to $f$.
\end{proposition}
\begin{proof}
If $\mathscr{L}$ is very ample relative to $f$ then the morphism $f$ is separated, so by \cref{scheme ample sheaf over affine iff power very ample}(a) the restriction $\mathscr{L}|_{f^{-1}(U)}$ for any affine open $U$ of $Y$ is very ample, hence ample.
\end{proof}
Let $f:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. We consider the graded $\mathscr{O}_Y$-algebra $\mathscr{S}=\bigoplus_{n\geq 0}f_*(\mathscr{L}^{\otimes n})$. Then the canonical homomorphisms $\sigma_n:f^*(f_*(\mathscr{L}^{\otimes n}))\to\mathscr{L}^{\otimes n}$ induce a canonical homomorphism
\[\sigma:f^*(\mathscr{S})\to\bigoplus_{n\geq 0}\mathscr{L}^{\otimes n}=\bm{S}(\mathscr{L}).\]
On the other hand, it is easy to see that $\sigma^{\flat}$ is the canonical injection from $\mathscr{S}$ into $f_*(\bm{S}(\mathscr{L}))$. The homomorphism $\sigma$ gives an $Y$-morphism
\[r_{\mathscr{L},\sigma}:G(\sigma)\to\Proj(\mathscr{S})=P.\]
\begin{proposition}\label{scheme relative ample and direct image algebra}
Let $f:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{L}$ is $f$-ample.
\item[(\rmnum{2})] $\mathscr{S}$ is quasi-coherent and the $Y$-morphism $r_{\mathscr{L},\sigma}$ is everywhere defined and a dominant open immersion.
\item[(\rmnum{2}')] The morphism $f$ is separated, the $Y$-morphism $r_{\mathscr{L},\sigma}$ is everywhere defined and is a homeomorphism from $X$ onto a subspace of $\Proj(\mathscr{S})$.
\end{enumerate}
Moreover, if these are satisfied, for any $n\in\Z$ the canonical homomorphism of (\ref{scheme morphism into Proj twisted sheaf-1})
\begin{align}\label{scheme relative ample and direct image algebra-1}
\nu:r_{\mathscr{L},\sigma}^*(\mathscr{O}_P(n))\to\mathscr{L}^{\otimes n}
\end{align}
is an isomorphism. Finally, for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, if we put $\mathscr{M}=\bigoplus_{n\geq 0}f_*(\mathscr{F}\otimes\mathscr{L}^{\otimes n})$, the canonical homomorphism of (\ref{scheme morphism into Proj qcoh module-1})
\begin{align}\label{scheme relative ample and direct image algebra-2}
\xi:r_{\mathscr{L},\sigma}^*(\bigtilde{\mathscr{M}})\to\mathscr{F}
\end{align}
is an isomorphism.
\end{proposition}
\begin{proof}
We have remarked that (\rmnum{1}) implies that $f$ is separated, so $\mathscr{S}$ is quasi-coherent by \cref{scheme morphism qcqs qcoh direct image}. As the fact that $r_{\mathscr{L},\sigma}$ is an open immersion everywhere defined is local over $Y$, to shows that (\rmnum{1}) implies (\rmnum{2}), we can assume that $Y$ is affine and $\mathscr{L}$ is ample; the assertion then follows from \cref{scheme ample sheaf iff}. It is clear that (\rmnum{2}) implies (\rmnum{2}'); finally, to show that (\rmnum{2}') implies (\rmnum{1}), it suffices to consider an affine open cover $(U_\alpha)$ of $Y$ and use \cref{scheme ample sheaf iff}(\rmnum{2}') to $\mathscr{L}|_{X_\alpha}$.\par
To prove the last two assertions, we use the fact that $\sigma^{\flat}$ is the canonical injection of $\mathscr{S}$ to $f_*(\bm{S}(\mathscr{L}))$ and the expression of the morphisms $\nu$ and $\xi$ in \cref{scheme morphism into Proj twisted sheaf} and \cref{scheme morphism into Proj qcoh module}. It then follows that $\nu$ and $\xi$ are injective. As for the surjectivity, we can assume that $Y$ is affine, so $\mathscr{L}$ is ample; the criterion of \cref{scheme ample sheaf iff}(\rmnum{3}) then shows that $\nu$ and $\xi$ are surjective, whence the assertion.
\end{proof}
\begin{remark}
From \cref{scheme relative ample and direct image algebra} and its proof, we conclude that if $\mathscr{L}$ is $f$-ample then $f_*(\bm{S}(\mathscr{L}))$ is equal to $\mathscr{S}$, so the homomorphism $\sigma^{\flat}$ is the identity on $\mathscr{S}$. This can also be seen from \cref{scheme morphism qcqs direct image and colimit} since in this case $f$ is separated.
\end{remark}
\begin{corollary}\label{scheme relative ample local on target}
Let $(U_\alpha)$ be an open covering of $Y$. For $\mathscr{L}$ to be $Y$-ample, it is necessary and sufficient that $\mathscr{L}|_{f^{-1}(U_\alpha)}$ is $U_\alpha$-ample for each $\alpha$.
\end{corollary}
\begin{proof}
This is true since the condition (\rmnum{2}) of \cref{scheme relative ample and direct image algebra} is local over $Y$.
\end{proof}
\begin{corollary}\label{scheme relative ample iff tensor with f^*(K)}
Let $\mathscr{K}$ be an invertible $\mathscr{O}_Y$-module. For $\mathscr{L}$ to be $Y$-ample, it is necessary and sufficient that $\mathscr{L}\otimes f^*(\mathscr{K})$ is $Y$-ample.
\end{corollary}
\begin{proof}
This is a concequence of \cref{scheme relative ample local on target} by taking $U_\alpha$ to be such that $\mathscr{K}|_{U_\alpha}$ is isomorphic to $\mathscr{O}_Y|_{U_\alpha}$ for each $\alpha$.
\end{proof}
\begin{corollary}\label{scheme relative ample over affine iff ample}
Suppose that $Y$ is affine. For $\mathscr{L}$ to be $Y$-ample, it is necessary and sufficient that $\mathscr{L}$ is ample.
\end{corollary}
\begin{proof}
This is immediate from the definition of $Y$-ample, and \cref{scheme relative ample and direct image algebra}(\rmnum{2}) and \cref{scheme ample sheaf iff}(\rmnum{2}), since
\[\Proj(\mathscr{S})=\Proj(\Gamma(Y,\mathscr{S}))=\Proj(\bigoplus_{n\geq 0}\Gamma(Y,f_*(\mathscr{L}^{\otimes n})))=\Proj(S)\]
in this case (note that $Y$ is quasi-compact).
\end{proof}
\begin{corollary}\label{scheme relative ample if inverse image of O_P(1)}
Let $f:X\to Y$ be a quasi-compact morphism. Suppose that there exists a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ and a $Y$-morphism $i:X\to P=\P(\mathscr{E})$ which is a homeomorphism from $X$ onto a subspace of $P$. Then $\mathscr{L}=i^*(\mathscr{O}_P(1))$ is $Y$-ample.
\end{corollary}
\begin{proof}
We can assume that $Y$ is affine, and the corollary then follows from the criterion (\rmnum{1}) of \cref{scheme ample sheaf iff} and the formula (\ref{scheme morphism into Proj affine D_+(f) preimage char-1}).
\end{proof}
\begin{proposition}\label{scheme qcqs relative ample iff sigma surjective}
Let $X$ be a quasi-compact and quasi-separated scheme and $f:X\to Y$ be a quasi-compact and quasi-separated morphism. For an invertible $\mathscr{O}_X$-module $\mathscr{L}$ to be $f$-ample, it is necessary and sufficient that following equivalent conditions are satisfied:
\begin{enumerate}
\item[(\rmnum{3})] For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of finite type, there exists an integer $n_0>0$ such that, for any $n\geq n_0$, the canonical homomorphism $\sigma:f^*(f_*(\mathscr{F}\otimes\mathscr{L}^{\otimes n}))\to\mathscr{F}\otimes\mathscr{L}^{\otimes n}$ is surjective.
\item[(\rmnum{3}')] For any ideal $\mathscr{I}$ of $\mathscr{O}_X$ of finite type, there exist an integer $n>0$ such that the canonical homomorphism $\sigma:f^*(f_*(\mathscr{I}\otimes\mathscr{L}^{\otimes n}))\to\mathscr{I}\otimes\mathscr{L}^{\otimes n}$ is surjective.
\end{enumerate}
\end{proposition}
\begin{proof}

\end{proof}
\begin{proposition}\label{scheme qc morphism relative ample iff power ample}
Let $f:X\to Y$ be a quasi-compact morphism and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module.
\begin{enumerate}
\item[(a)] Let $n>0$ be an integer. For $\mathscr{L}$ to be $f$-ample, it is necessary and necessary that $\mathscr{L}^{\otimes n}$ is $f$-ample.
\item[(b)] Let $\mathscr{L}'$ be an invertible $\mathscr{O}_X$-module, and suppose that there exists an integer $n>0$ such that the canonical homomorphism $\sigma:f^*(f_*(\mathscr{L}'^{\otimes n}))\to\mathscr{L}'^{\otimes n}$ is surjective. Then, if $\mathscr{L}$ is $f$-ample, so is $\mathscr{L}\otimes\mathscr{L}'$. 
\end{enumerate}
\end{proposition}
\begin{corollary}\label{scheme relative ample tensor product is relative ample}
The tensor product of two $f$-ample $\mathscr{O}_X$-modules is $f$-ample.
\end{corollary}
\begin{proposition}\label{scheme qc relative ample iff power very ample}
Let $f:X\to Y$ be a morphism of finite type where $Y$ is quasi-compact, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. For $\mathscr{L}$ to be $f$-ample, it is necessary and sufficient that the following equivalent conditions are satisfied:
\begin{enumerate}
\item[(\rmnum{4})] There exists $n_0>0$ such that, for any integer $n\geq n_0$, $\mathscr{L}^{\otimes n}$ is very ample relative to $f$.
\item[(\rmnum{4}')] There exist $n>0$ such that $\mathscr{L}^{\otimes n}$ is very ample relative to $f$.
\end{enumerate}
\end{proposition}
\begin{lemma}\label{scheme invertible module X_s inverse image char}
Let $u:Z\to S$ be a morphism, $\mathscr{L}$ be an invertible $\mathscr{O}_S$-module, $s$ a section of $\mathscr{L}$ over $S$, and $t$ be the inverse image of $s$ under $u$. Then $Z_{t}=u^{-1}(S_s)$.
\end{lemma}
\begin{proof}

\end{proof}
\begin{lemma}\label{scheme invertible module X_s fiber product char}
Let $Z,Z'$ be two $S$-schemes, $p,p'$ be the projections of $T=Z\times_SZ'$, $\mathscr{L}$ (resp. $\mathscr{L}'$) be an invertible $\mathscr{O}_Z$-module (resp. $\mathscr{O}_{Z'}$-module), $t$ (resp. $t'$) be a section of $\mathscr{L}$ (resp. $\mathscr{L}'$) over $Z$ (resp. $Z'$), $s$ (resp. $s'$) be the inverse image of $t$ (resp. $t'$) under $p$ (resp. $p'$). Then we have $T_{s\otimes s'}=Z_t\times_S Z'_{t'}$.
\end{lemma}
\begin{proof}

\end{proof}
\begin{proposition}[\textbf{Properties of Relative Ample Sheaves}]\label{scheme relative ample permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] For any scheme $Y$, any invertible $\mathscr{O}_Y$-module $\mathscr{L}$ is relative ample relative to the identify morphism $1_Y$.
\item[(\rmnum{2})] Let $f:X\to Y$ be a quasi-compact morphism and $j:X'\to X$ be a quasi-compact morphism that is a homeomorphism from $X'$ onto a subspace of $X$. If $\mathscr{L}$ is an $\mathscr{O}_X$-module relative to $f$, then $j^*(\mathscr{L})$ is relative relative to $f\circ j$.
\item[(\rmnum{3})] Let $f:X\to Y$ and $g:Y\to Z$ be quasi-compact morphisms where $Z$ is quasi-compact. Let $\mathscr{L}$ an ample $\mathscr{O}_X$-module relative to $f$ and $\mathscr{K}$ be an ample $\mathscr{O}_Y$-module relative to $g$. Then there exists an integer $n_0>0$ such that for any $n\geq n_0$, $\mathscr{L}\otimes f^*(\mathscr{K}^{\otimes n})$ is ample relative to $g\circ f$.
\item[(\rmnum{4})] Let $f:X\to Y$ be a quasi-compact morphism, $g:Y'\to Y$ be a morphism, and put $X'=X_{(Y')}$. If $\mathscr{L}$ is an ample $\mathscr{O}_X$-module relative to $f$, $\mathscr{L}'=\mathscr{L}\otimes_Y\mathscr{O}_{Y'}$ is ample relative to $f_{(Y')}$.   
\item[(\rmnum{5})] Let $f_i:X_i\to Y_i$ ($i=1,2$) be two quasi-compact $S$-morphisms. If $\mathscr{L}_i$ is an ample $\mathscr{O}_{X_i}$-module relative to $f_i$, then $\mathscr{L}_1\otimes_S\mathscr{L}_2$ is ample relative to $f_1\times_Sf_2$.
\item[(\rmnum{6})] Let $f:X\to Y$, $g:Y\to Z$ be two morphisms such that $g\circ f$ is quasi-compact. If an $\mathscr{O}_X$-module $\mathscr{L}$ is ample relative to $g\circ f$ and if $g$ is separated or $X$ is locally Noetherian, then $\mathscr{L}$ is ample relative to $f$.
\item[(\rmnum{7})] Let $f:X\to Y$ be a quasi-compact morphism and $j:X_{\red}\to X$ be the canonical injection. If $\mathscr{L}$ is an ample $\mathscr{O}_X$-module relative to $f$, then $j^*(\mathscr{L})$ is ample relative to $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}

\end{proof}
\begin{proposition}\label{scheme relative ample iff over nilpotent subscheme}
Let $f:X\to Y$ be a quasi-compact morphism, $\mathscr{I}$ be a locally nilpotent ideal of $\mathscr{O}_X$, $Z$ the closed subscheme of $X$ defined by $\mathscr{I}$, and $j:Z\to X$ be the cannical injection. For an invertible $\mathscr{O}_X$-module to be ample relative to $f$, it is necessary and sufficient that $j^*(\mathscr{L})$ is ample relative to $f\circ j$.
\end{proposition}
\begin{corollary}\label{scheme relative ample iff inverse on X_red}
Let $X$ be a locally Noetherian scheme and $f:X\to Y$ be a quasi-compact morphism. For an invertible $\mathscr{O}_X$-module $\mathscr{L}$ to be ample relative to $f$, it is necessary and sufficient that its inverse image $\mathscr{L}'$ under the canonical injection $X_{\red}\to X$ is ample relative to $f_{\red}$.
\end{corollary}
\begin{proposition}\label{scheme relative ample and coproduct}
Let $f:X\to Y$, $f':X'\to Y$ be two morphisms, $X''=X\amalg X'$, and $f''=f\amalg f'$. Let $\mathscr{L}$ (resp. $\mathscr{L}'$) be an invertible $\mathscr{O}_X$-module (resp. $\mathscr{O}_{X'}$-module), and let $\mathscr{L}''$ be the invertible $\mathscr{O}_{X''}$-module which coincides with $\mathscr{L}$ over $X$ and with $\mathscr{L}'$ over $X'$. For $\mathscr{L}''$ to be ample relative to $f''$, it is necessary and sufficent that $\mathscr{L}$ is ample relative to $f$ and $\mathscr{L}'$ is ample relative to $f'$.
\end{proposition}
\begin{proposition}
Let $Y$ be a quasi-compact scheme, $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra of finite type, $X=\Proj(\mathscr{S})$, and $f:X\to Y$ be the structural morphism. Then $f$ is of finite type and there exists an integer $n>0$ such that $\mathscr{O}_X(d)$ is invertible and $f$-ample.
\end{proposition}
\section{Projective morphisms and Chow's lemma}
\subsection{Quasi-affine morphisms}
We say a scheme is \textbf{quasi-affine} if it is isomorphic to the subscheme induced over a quasi-compact open subset of an affine scheme. We say a morphism $f:X\to Y$ is quasi-affine, or that $X$ is a quasi-affine $Y$-scheme, if there exists an affine open cover $(U_\alpha)$ of $Y$ such that $f^{-1}(U_\alpha)$ is a quasi-affine scheme. Since any quasi-compact open subscheme of an affine scheme is separated, it is clear that quasi-affine morphisms are separated and quasi-compact, and any affine morphism is quasi-affine.\par
Recall that for any scheme $X$, if $A=\Gamma(X,\mathscr{O}_X)$, the identify homomorphism $A\to A$ induces a canonical morphism $q:X\to\Spec(A)$ by \cref{scheme morphism to affine correspond}. This is also the morphism $r_{\mathscr{L},\eps}:X\to\Proj(S)$ in (\ref{scheme invertible sheaf canonical morphism to Proj(S)}) defined for $\mathscr{L}=\mathscr{O}_X$, since $\Gamma(X,-)$ commutes with taking tensor product with $\mathscr{O}_X$ and we have $S=\bigoplus_{n\geq 0}\Gamma(X,\mathscr{O}_X)^{\otimes n}=A[T]$, and $\Proj(A[T])$ is canonically identified with $\Spec(A)$.
\begin{proposition}\label{scheme qc quasi-affine iff}
Let $X$ be a quasi-compact scheme and $A=\Gamma(X,\mathscr{O}_X)$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is a quasi-affine scheme.
\item[(\rmnum{2})] The canonical morphism $q:X\to\Spec(A)$ is an open immersion.
\item[(\rmnum{2}')] The canonical morphism $q:X\to\Spec(A)$ is a homeomorphism from $X$ onto a subspace of $\Spec(A)$.
\item[(\rmnum{3})] The $\mathscr{O}_X$-module $\mathscr{O}_X$ is very ample relative to $q$.
\item[(\rmnum{3}')] The $\mathscr{O}_X$-module $\mathscr{O}_X$ is ample.
\item[(\rmnum{4})] The subsets $X_f$, as $f$ runs through $A$, form a basis for $X$.
\item[(\rmnum{4}')] The subsets $X_f$ which are affine, as $f$ runs through $A$, form a basis for $X$.
\item[(\rmnum{5})] Any quasi-coherent $\mathscr{O}_X$-module is generated by its global sections.
\item[(\rmnum{5}')] Any quasi-coherent ideal of finite type of $\mathscr{O}_X$ is generated by its global sections.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{2})$\Rightarrow$(\rmnum{1}) by definition, and (\rmnum{3})$\Rightarrow$(\rmnum{3}') by \cref{scheme ample sheaf over affine iff power very ample}. Since the canonical morphisms $q:X\to\Spec(A)$ and $r_{\mathscr{O}_X,\eps}:X\to\Proj(S)$ are identified, we see that (\rmnum{3}')$\Leftrightarrow$(\rmnum{2})$\Leftrightarrow$(\rmnum{2}')$\Leftrightarrow$(\rmnum{4})$\Leftrightarrow$(\rmnum{4}') by \cref{scheme ample sheaf iff}. Also, (\rmnum{3}')$\Leftrightarrow$(\rmnum{5})$\Leftrightarrow$(\rmnum{5}') in view of \cref{scheme ample sheaf iff global generation}.\par
We also note that if $X$ is quasi-affine, then it can be identified as an open subscheme of an affine scheme $Y=\Spec(B)$. Let $\varphi:B\to A$ be the correspond homomorphism (\cref{scheme morphism to affine correspond}). Since the affine opens $D(g)$, with $g\in B$, form a basis of $Y$, and we have $X_f=D(g)\cap X$ where $f=\varphi(g)$, it follows that the subsets $X_f$ which are affine, with $f\in A$, form a basis for $X$, which proves (\rmnum{1})$\Rightarrow$(\rmnum{4}').\par
Finally, it remains to show that (\rmnum{1})$\Rightarrow$(\rmnum{3}). For this we first note that if $X$ is quasi-affine then it is quasi-compact and separated, so by \cref{scheme qcqs section of qcoh over X_s char}, for $f\in A$ we have $\Gamma(X_f,\mathscr{O}_X)=A_f$. Since we have $q^{-1}(D_+(f))=X_f$, we conclude that the canonical morphism $q:X\to\Spec(A)$ is of finite type, and by \cref{scheme ample sheaf over affine iff power very ample}, since $\mathscr{O}_X^{\otimes n}$ is isomorphic to $\mathscr{O}_X$ for any integer $n>0$, $\mathscr{O}_X$ is very ample relative to $q$. This completes the proof.
\end{proof}
\begin{remark}\label{scheme quasi-affine direct image of O_X}
Let $X$ be a quasi-affine scheme and $A=\Gamma(X,\mathscr{O}_X)$. By \cref{scheme qc quasi-affine iff} we know that $\mathscr{O}_X$ is very ample relative to $q:X\to\Spec(A)$. Since $X$ is separated and quasi-compact, $q_*(\mathscr{O}_X)$ is quasi-coherent by \cref{scheme morphism qcqs qcoh direct image}, and from $\Gamma(\Spec(A),q_*(\mathscr{O}_X))=A$ we conclude that $q_*(\mathscr{O}_X)=\widetilde{A}$, so $q^*(q_*(\mathscr{O}_X))=\mathscr{O}_X$ and the canonical homomorphism $\sigma:q^*(q_*(\mathscr{O}_X))\to\mathscr{O}_X$ is identified with the identity on $\mathscr{O}_X$. This being so, the canonical morphism $r_{\mathscr{O}_X,\sigma}:X\to\P(q_*(\mathscr{O}_X))$ is then identified with $q:X\to\Spec(A)$, because we have
\[\P(q_*(\mathscr{O}_X))=\Proj(\bm{S}(q_*(\mathscr{O}_X)))=\Proj(\bm{S}(A))=\Proj(A[T])=\Spec(A);\]
and we conclude from \cref{scheme qc quasi-affine iff} that this is an open immersion, which justifies \cref{scheme very ample iff direct image}.
\end{remark}
\begin{corollary}\label{scheme qc quasi-affine if open embedding to affine}
Let $X$ be a quasi-compact scheme. If there exists a morphism $r:X\to Y$ from $X$ into an affine scheme $Y$ which is a homeomorphism onto an open subspace of $Y$, then $X$ is quasi-affine.
\end{corollary}
\begin{proof}
In fact, there then exists a family $(g_\alpha)$ of sections of $\mathscr{O}_Y$ over $Y$ such that the $D(g_\alpha)$ form a basis for the topology of $r(X)$. If we put $f_\alpha=\theta(g_\alpha)$ where $\theta:\Gamma(Y,\mathscr{O}_Y)\to\Gamma(X,\mathscr{O}_X)$ is the corresponding ring homomorphism, then we have $X_{f_\alpha}=r^{-1}(D(g_\alpha))$, so the $X_{f_\alpha}$ form a basis for $X$, and by \cref{scheme qc quasi-affine iff} $X$ is then quasi-affine.
\end{proof}
\begin{corollary}\label{scheme quasi-affine invertible is very ample}
If $X$ is a quasi-affine scheme, any invertible $\mathscr{O}_X$-module is very ample (relative to the canonical morphism $q:X\to\Spec(A)$) and a fortiori ample.
\end{corollary}
\begin{proof}
In fact any such module $\mathscr{L}$ is generated by its global sections (\cref{scheme qc quasi-affine iff}(\rmnum{5})), so $\mathscr{L}\otimes\mathscr{O}_X$ is very ample by \cref{scheme very ample tensor with free}. We also note that the morphism $q$ is of finite type.
\end{proof}
\begin{corollary}\label{scheme qc quasi-affine if L and L^-1 are ample}
Let $X$ be a quasi-compact scheme. If there exists an invertible $\mathscr{O}_X$-module $\mathscr{L}$ such that $\mathscr{L}$ and $\mathscr{L}^{-1}$ are ample, then $X$ is quasi-affine.
\end{corollary}
\begin{proof}
In fact, $\mathscr{O}_X=\mathscr{L}\otimes\mathscr{L}^{-1}$ is then ample by \cref{scheme ample sheaf tensor ample}.
\end{proof}
\begin{proposition}\label{scheme morphism qc quasi-affine iff}
Let $f:x\to Y$ be a quasi-compact morphism. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is quasi-affine.
\item[(\rmnum{2})] The $\mathscr{O}_Y$-algebra $f_*(\mathscr{O}_X)=\mathscr{A}(X)$ is quasi-coherent and the canonical morphism $X\to\Spec(\mathscr{A}(X))$ corresponding to the identity homomorphism of $\mathscr{A}(X)$ is an open immersion.
\item[(\rmnum{2}')] The $\mathscr{O}_Y$-algebra $\mathscr{A}(X)$ is quasi-coherent and the canonical morphism $X\to\Spec(\mathscr{A}(X))$ is a homeomorphism from $X$ onto a subspace of $\Spec(\mathscr{A}(X))$. 
\item[(\rmnum{3})] The $\mathscr{O}_X$-module $\mathscr{O}_X$ is very ample relative to $f$.
\item[(\rmnum{3}')] The $\mathscr{O}_X$-module $\mathscr{O}_X$ is ample relative to $f$.
\item[(\rmnum{4})] The morphism $f$ is separated and for any quasi-coherent $\mathscr{O}_X$-modle $\mathscr{F}$, the canonical homomorphism $\sigma:f^*(f_*(\mathscr{F}))\to\mathscr{F}$ is surjective.
\end{enumerate}
Morever, if $f$ is quasi-affine, any invertible $\mathscr{O}_X$-module $\mathscr{L}$ is very ample relative to $f$.
\end{proposition}
\begin{proof}
The equivalence of these properties follows from the fact that they are all local over $Y$ and the criteria of \cref{scheme qc quasi-affine iff}. Also, we note that $f_*(\mathscr{F})$ is quasi-coherent if $f$ is separated (\cref{scheme morphism qcqs qcoh direct image}). The last assertion follows from \cref{scheme quasi-affine invertible is very ample}.
\end{proof}
\begin{corollary}\label{scheme qc morphism quasi-affine over affine iff}
Let $Y$ be an affine scheme and $f:X\to Y$ be a quasi-compact morphism. For $f$ to be quasi-affine, it is necessary and sufficient that $X$ is quasi-affine scheme.
\end{corollary}
\begin{proof}
This is an immediate concequence of \cref{scheme morphism qc quasi-affine iff} and \cref{scheme relative ample over affine iff ample}.
\end{proof}
\begin{corollary}\label{scheme quasi-affine over qcqs immersion to Spec(B)}
Let $Y$ be a quasi-compact and quasi-separated scheme, $f:X\to Y$ be a morphism of finite type. If $f$ is quasi-affine, there exists a quasi-coherent sub-$\mathscr{O}_Y$-algebra $\mathscr{B}$ of $\mathscr{A}(X)$ of finite type such that the morphism $X\to\Spec(\mathscr{B})$ corresponding to the canonical injection $\mathscr{B}\to\mathscr{A}(X)$ is an immersion. Moreover, any quasi-coherent sub-$\mathscr{O}_Y$-algebra of finite type $\mathscr{B}'$ of $\mathscr{A}(X)$, containing $\mathscr{B}$, has the same property.
\end{corollary}
\begin{proof}
In fact, $\mathscr{A}(X)$ is the inductive limit of its quasi-coherent sub-$\mathscr{O}_Y$-algebras of finite type (\cref{scheme local Noe qcoh is inductive limit ft}); the assertion is then a particular case of \cref{scheme morphism to Proj inductive limit immersion iff}, in view of the identification of $\Spec(\mathscr{A}(X))$ and $\Proj(\mathscr{A}(X)[T])$ (\cref{scheme Proj of qcoh polynomial algebra}) and the canonical morphisms from $X$ into them (cf. \cref{scheme quasi-affine direct image of O_X}).
\end{proof}
\begin{proposition}[\textbf{Properties of Quasi-affine Morphisms}]\label{scheme morphism quasi-affine permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A quasi-compact morphism $f:X\to Y$ that is a homeomorphism from $X$ onto a subspace of $Y$ (and in particular a quasi-compact immersion) is quasi-affine.
\item[(\rmnum{2})] The composition of two quasi-affine morphisms is quasi-affine.
\item[(\rmnum{3})] If $f:x\to Y$ is a quasi-affine $S$-morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is a quasi-affine morphism for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $g:X'\to Y'$ are two quasi-affine $S$-morphisms, so is $f\times_Sg$.
\item[(\rmnum{5})] If $f:X\to Y$, $g:Y\to Z$ are two morphisms such that $g\circ f$ is quasi-affine and if $g$ is separated or $X$ is locally Noetherian, then $f$ is quasi-affine.
\item[(\rmnum{6})] Let $f:X\to Y$ be a quasi-compact morphism and $j:X_{\red}\to X$ the canonical injection. If an $\mathscr{O}_X$-module $\mathscr{L}$ is ample relative to $f$, then $j^*(\mathscr{L})$ is ample relative to $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
In view of the criterion (\rmnum{3}') of \cref{scheme morphism qc quasi-affine iff}, (\rmnum{1}), (\rmnum{3}), (\rmnum{4}), (\rmnum{5}) and (\rmnum{6}) are concequences of \cref{scheme relative ample permanence prop}. To prove (\rmnum{2}), we can assume that $Z$ is affine, and the assertion then follows from \cref{scheme relative ample permanence prop}(\rmnum{3}), applied to $\mathscr{L}=\mathscr{O}_X$ and $\mathscr{K}=\mathscr{O}_Y$.
\end{proof}
\begin{remark}
Let $f:X\to Y$, $g:Y\to Z$ be two morphisms such that $X\times_ZY$ is locally Noetherian. Then the graph morphism $\Gamma_f:X\to X\times_ZY$ is a quasi-compact immersion, hence quasi-affine, and the reasoning of \cref{scheme morphism arbitrary calcelled if} shows that the conclusion of (\rmnum{5}) remains valid if we remove the hypothesis that $g$ is separated.
\end{remark}
\begin{proposition}\label{scheme inverse of ample on quasi-affine is ample}
Let $f:X\to Y$ be a quasi-compact morphism and $g:X'\to X$ be a quasi-affine morphism. If $\mathscr{L}$ is an $f$-ample $\mathscr{O}_X$-module, then $g^*(\mathscr{L})$ is ample relative to $f\circ g$.
\end{proposition}
\begin{proof}
By hypothesis $\mathscr{O}_{X'}$ is very ample relative to $f$, and since the question is local over $Y$, it follows from \cref{scheme relative ample permanence prop}(\rmnum{3}) that there exists (for $Y$ affine) an integer $n$ such that $g^*(\mathscr{L}^{\otimes n})=(g^*(\mathscr{L}))^{\otimes n}$ is ample relative to $f\circ g$, whence $g^*(\mathscr{L})$ is ample relative to $f\circ g$.
\end{proof}
\subsection{Serre's criterion on affineness}
\begin{theorem}[\textbf{Serre's criterion}]\label{Serre's criterion for affineness}
For a quasi-compact and quasi-separated scheme $X$, then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is an affine scheme.
\item[(\rmnum{2})] There exists a family $(f_\alpha)$ of elements of $A=\Gamma(X,\mathscr{O}_X)$ such that $X_{f_\alpha}$ are affine and the ideal generated by the $f_\alpha$ equals to $A$.
\item[(\rmnum{3})] The functor $\Gamma(X,-)$ is exact on the category of quasi-coherent $\mathscr{O}_X$-modules.
\item[(\rmnum{3}')] For any exact sequence of quasi-coherent $\mathscr{O}_X$-modules
\[\begin{tikzcd}
0\ar[r]&\mathscr{F}'\ar[r]&\mathscr{F}\ar[r]&\mathscr{F}''\ar[r]&0
\end{tikzcd}\] 
where $\mathscr{F}$ is isomorphic to a sub-$\mathscr{O}_X$-module of a finite product $\mathscr{O}_X^n$, the induced sequence
\[\begin{tikzcd}
0\ar[r]&\Gamma(X,\mathscr{F}')\ar[r]&\Gamma(X,\mathscr{F})\ar[r]&\Gamma(X,\mathscr{F}'')\ar[r]&0
\end{tikzcd}\]
is exact.
\item[(\rmnum{4})] $H^1(X,\mathscr{F})=0$ for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$.
\item[(\rmnum{4}')] $H^1(X,\mathscr{I})=0$ for any quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$.
\end{enumerate}
\end{theorem}
\begin{proof}
It is clear that (\rmnum{1}) implies (\rmnum{2}); (\rmnum{2}) implies on the oter hand that the $X_{f_\alpha}$ cover $X$, since by hypothesis the unit section $1$ is a linear combination of $f_\alpha$, and that the $D(f_\alpha)$ cover $\Spec(A)$. The last assertion of \cref{scheme ample sheaf iff} then implies that $X\to\Spec(A)$ is an isomorphism.\par
We have seen that (\rmnum{1}) implies (\rmnum{3}), and it is trivial that (\rmnum{3}) implies (\rmnum{3}'). On the other hand, (\rmnum{3}') implies that, for any closed point $x\in X$ and any open neighborhood $U$ of $x$, there exists $f\in A$ such that $x\in X_f\sub X-U$. To see this, let $\mathscr{I}$ (resp. $\mathscr{I}'$) be the quasi-coherent ideal of $\mathscr{O}_X$ defining the reduced closed subscheme of $X$ with underlying space $X-U$ (resp. $(X-U)\cup\{x\}$). It is clear that $\mathscr{I}'\sub\mathscr{I}$, and the quotient $\mathscr{I}''=\mathscr{I}/\mathscr{I}'$ is a quasi-coherent $\mathscr{O}_X$-module. By hypothesis, the stalk of $\mathscr{O}_X/\mathscr{I}$ and $\mathscr{O}_X/\mathscr{I}'$ are zero at any point $x\in U-\{x\}$. Moreover, since $\{x\}$ is closed in $X$, the subscheme $X-U$ is \textit{open and closed} in $(X-U)\cup\{x\}$, so we conclude that $(\mathscr{O}_X/\mathscr{I})_z=(\mathscr{O}_X/\mathscr{I}')_z$ for $z\in X-U$, and therefore $\mathscr{I}''_z=0$. At the point $x$, we have $\mathscr{I}_x=\mathscr{O}_X$, while $\mathscr{I}'_x=\m_x$ (cf. \cref{scheme reduced subscheme on closed point eg}), so $\mathscr{I}''$ is supported at $\{x\}$ and $\mathscr{I}''_x=\kappa(x)$. The hypothesis of (\rmnum{3}') applied to the exact sequence $0\to\mathscr{I}'\to\mathscr{I}\to\mathscr{I}''\to 0$ shows that $\Gamma(X,\mathscr{I})\to\Gamma(X,\mathscr{I}'')$ is surjective, so the section of $\mathscr{I}''$ whose germ at $x$ equals to $1_x$ is the image of a section $f\in\Gamma(X,\mathscr{I})\sub\Gamma(X,\mathscr{O}_X)$, and we have by definition $f(x)=1_x$ and $f(y)=0$ over $X-U$, which proves the assertion. Moreover, if $U$ is affine, so is $X_f$, and the union $X'$ of these affine opens $X_f$ (with $f\in A$) is then an open subset of $X$ containing any closed point of $X$. As $X$ is a quasi-compact Kolmogoroff space, we then have $X'=X$ (\cite{EGA1} new, $0_{\text{\Rmnum{1}}}$, 2.1.3). Since $X$ is quasi-compact, there are finitely many elements $f_i\in A$ ($1\leq i\leq n$) such that $(X_{f_i})$ is an affine open cover of $X$. Consider the homomorphism $\mathscr{O}_X^n\to\mathscr{O}_X$ defined by the sections $f_i$; since for any $x\in X$ at least one of the $(f_i)_x$ is invertible, this homomorphism is surjective, and we then get an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{R}\ar[r]&\mathscr{O}_X^n\ar[r]&\mathscr{O}_X\ar[r]&0
\end{tikzcd}\] 
where $\mathscr{R}$ is a quasi-coherent sub-$\mathscr{O}_X$-module of $\mathscr{O}_X$. It then follows from (\rmnum{3}') that the corresponding homomorphism $\Gamma(X,\mathscr{O}_X^n)\to\Gamma(X,\mathscr{O}_X)$ is surjective, which proves (\rmnum{2}).\par
Finally, (\rmnum{1}) implies (\rmnum{4}) and (\rmnum{4}) implies (\rmnum{4}'). We show that (\rmnum{4}') implies (\rmnum{3}'). Now, if $\mathscr{F}'$ is a quasi-coherent sub-$\mathscr{O}_X$-module of $\mathscr{O}_X^n$, the filtration $0\sub\mathscr{O}_X\sub\mathscr{O}_X^2\cdots\sub\mathscr{O}_X^n$ defines over $\mathscr{F}'$ a filtration of the form $\mathscr{F}'_k=\mathscr{F}\cap\mathscr{O}_X^k$ ($0\leq k\leq n$), which are quasi-coherent $\mathscr{O}_X$-modules (\cref{scheme qcoh and exact sequence prop}(\rmnum{2})), and $\mathscr{F}'_{k+1}/\mathscr{F}'_k$ is isomorphic to a quasi-coherent sub-$\mathscr{O}_X$-module of $\mathscr{O}_X^{k+1}/\mathscr{O}_X^k=\mathscr{O}_X$, which is thus a quasi-coherent ideal of $\mathscr{O}_X$. In the exact sequence
\[\begin{tikzcd}
H^1(X,\mathscr{F}'_k)\ar[r]&H^1(X,\mathscr{F}'_{k+1})\ar[r]&H^1(\mathscr{F}'_{k+1}/\mathscr{F}'_k)=0
\end{tikzcd}\]
by hypothesis of (\rmnum{4}') we have $H^1(\mathscr{F}'_{k+1}/\mathscr{F}'_k)=0$; since $H^0(X,\mathscr{F}'_0)=0$, we conclude by recurrence on $k$ that $H^1(X,\mathscr{F}_k')=0$ for each $k$, whence the claim.
\end{proof}
\begin{remark}
Note that if $X$ is a covering of $(X_{f_i})$ with $X_{f_i}$ being affine, then $X$ is automatically quasi-separated, since for any couple $(i,j)$ of indices we have $X_{f_i}\cap X_{f_j}=D_{X_{f_i}}(f_j|_{X_{f_i}})$, which is an affine open of $X_{f_i}$ and hence quasi-compact (\cref{scheme qs iff intersection of qc open}).
\end{remark}
\begin{remark}
If $X$ is a Noetherian scheme, then in conditions (\rmnum{3}') and (\rmnum{4}') we can replace "quasi-coherent" by "coherent." In fact, in the demonstration that (\rmnum{3}') implies (\rmnum{2}), $\mathscr{I}$ and $\mathscr{I}'$ are then coherent ideals, and moreover, any quasi-coherent submodule of a coherent module is coherent (\cref{scheme affine Noe coh sheaf char}), whence the assertion. 
\end{remark}
\begin{corollary}\label{scheme qcqs morphism affine iff f_* exact}
Let $f:X\to Y$ be a quasi-compact and quasi-separated morphism. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is an affine morphism.
\item[(\rmnum{2})] The functor $f_*$ is exact on the cateogry of quasi-coherent $\mathscr{O}_X$-modules.
\item[(\rmnum{3})] For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, we have $R^1f_*(\mathscr{F})=0$.
\item[(\rmnum{3}')] For any quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$, we have $R^1f_*(\mathscr{I})=0$. 
\end{enumerate}
\end{corollary}
\begin{proof}
Any of these conditions are local over $Y$, by the definition of $R^1f_*(\mathscr{F})$ (that is, the sheaf associated with the presheaf $U\mapsto H^1(f^{-1}(U),\mathscr{F})$), so we may assume that $Y$ is affine. If $f$ is affine, $X$ is then affine and (\rmnum{2}) follows from \cref{scheme affine direct image exact on qcoh sheaf}. Conversely, we prove that (\rmnum{2}) implies (\rmnum{1}): for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $f_*(\mathscr{F})$ is a quasi-coherent $\mathscr{O}_Y$-module by \cref{scheme morphism qcqs qcoh direct image}. By hypothesis the fonctor $f_*$ is exact; $\Gamma(Y,-)$ is exact since $Y$ is affine, so we conclude that $\Gamma(Y,f_*(-))=\Gamma(X,-)$ is exact, which proves that $X$ is affine in view of \cref{Serre's criterion for affineness}.\par
If $f$ is affine, $f^{-1}(U)$ is affine for any affine open $U$ of $Y$, so $H^1(f^{-1}(U),\mathscr{F})=0$ by \cref{Serre's criterion for affineness}, which means $R^1f_*(\mathscr{F})=0$. Finally, suppose that (\rmnum{3}') is satisfied; the exact sequence of low-degree terms in the Leray spectral sequence gives
\[\begin{tikzcd}
0\ar[r]&H^1(Y,f_*(\mathscr{I}))\ar[r]&H^1(X,\mathscr{I})\ar[r]&H^0(Y,R^1f_*(\mathscr{I}))
\end{tikzcd}\]
As $Y$ is affine and $f_*(\mathscr{I})$ is quasi-coherent (\cref{scheme morphism qcqs qcoh direct image}), we have $H^1(Y,f_*(\mathscr{I}))=0$, so the hypothesis of (\rmnum{3}') imlies that $H^1(X,\mathscr{I})=0$, and we conclude from \cref{Serre's criterion for affineness} that $X$ is an affine scheme.
\end{proof}
\begin{corollary}\label{scheme morphism affine H^1 and direct image}
If $f:X\to Y$ is an affine morphism then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphism $H^1(Y,f_*(\mathscr{F}))\to H^1(X,\mathscr{F})$ is bijective.
\end{corollary}
\begin{proof}
In fact, we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&H^1(Y,f_*(\mathscr{F}))\ar[r]&H^1(X,\mathscr{F})\ar[r]&H^0(Y,R^1f_*(\mathscr{F}))
\end{tikzcd}\]
which comes from the lower terms of the Leray spectral sequence, and the conclusion follows from \cref{scheme qcqs morphism affine iff f_* exact}.
\end{proof}
\subsection{Quasi-projective morphisms}
We say a morphism $f:X\to Y$ is \textbf{quasi-projective}, of that $X$ is \textbf{quasi-projective over $\bm{Y}$}, or that $X$ is a \textbf{quasi-projective $\bm{Y}$-scheme}, if $f$ is of finite type and there exists an invertible $\mathscr{O}_X$-module that is $f$-ample. It is clear that a quasi-projective morphism is necessarily separated. If $Y$ is quasi-compact, it is also equivalent to say that $f$ is of finite type and there exists a very ample $\mathscr{O}_X$-module relative to $f$ (\cref{scheme very ample is relative ample}).
\begin{remark}
It should be noted that this definition is not local over $Y$. There exist examples where $X$ and $Y$ are nonsingular algebraic schemes over an algebraically closed field such that any point of $Y$ admits an affine neighborhood $U$ such that $f^{-1}(U)$ is quasi-projective over $U$, but $f$ is not quasi-projective.
\end{remark}
\begin{proposition}\label{scheme quasi-projective over qcqs iff P(E)}
Let $Y$ be a quasi-compact and quasi-separated scheme and $X$ be a $Y$-scheme. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is a quasi-projective $Y$-scheme.
\item[(\rmnum{2})] $X$ is of finite type over $Y$ and there exists a quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}$ of finite type such that $X$ is $Y$-isomorphic to a subscheme of $\P(\mathscr{E})$. 
\item[(\rmnum{3})] $X$ is of finite type over $Y$ and there exists a quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}$ that is generated by $\mathscr{S}_1$ and $\mathscr{S}_1$ is of finite type such that $X$ is isomorphic to a dense open subscheme of $\Proj(\mathscr{S})$. 
\end{enumerate}
\end{proposition}
\begin{proof}
This follows from \cref{scheme very ample if inverse of immersion Proj}, \cref{scheme very ample iff immersion into Proj} and \cref{scheme very ample iff open dominant immersion}.
\end{proof}
\begin{corollary}\label{scheme quasi-projective over qcqs iff subscheme of P^n}
Let $Y$ be a quasi-compact and quasi-separated scheme such that there exists an ample $\mathscr{O}_Y$-module $\mathscr{L}$. For a $Y$-scheme $X$ to be quasi-projective, it is necessary and sufficient that $X$ is of finite type over $Y$ and is isomorphic to a sub-$Y$-scheme of a projective bundle of the form $\P_Y^r$.
\end{corollary}
\begin{proof}
By the hypothesis on $Y$, if $\mathscr{E}$ is a quasi-coherent $\mathscr{O}_Y$-module of finite type, $\mathscr{E}$ is isomorphic to a quotient of an $\mathscr{O}_Y$-module $\mathscr{L}^{\otimes(-n)}\otimes_{\mathscr{O}_Y}\mathscr{O}_Y^k$ (\cref{scheme ample sheaf iff global generation}), so $\P(\mathscr{E})$ is isomorphic to a closed subscheme of $\P_Y^{k-1}$ (\cref{scheme projective bundle of tensor with invertible prop}).
\end{proof}
\begin{proposition}[\textbf{Properties of Quasi-projective Morphisms}]\label{scheme morphism quasi-projective permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A quasi-affine morphism of finite type (in particular a quasi-compact immersion or an affine morphism of finite type) is quasi-projective.
\item[(\rmnum{2})] If $f:X\to Y$ and $g:Y\to Z$ are quasi-projective and if $Z$ is quasi-compact, $g\circ f$ is quasi-projective.
\item[(\rmnum{3})] If $f:X\to Y$ is a quasi-projective $S$-morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is quasi-projective for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $g:X'\to Y'$ are two quasi-projective $S$-morphisms, $f\times_Sg$ is quasi-projective.
\item[(\rmnum{5})] If $f:X\to Y$, $g:y\to Z$ are two morphisms such that $g\circ f$ is quasi-projective and if $g$ is separated or $X$ is locally Noetherian, then $f$ is quasi-projective. 
\item[(\rmnum{6})] If $f$ is quasi-projective, so is $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
Property (\rmnum{1}) follows from \cref{scheme morphism qc quasi-affine iff} and \cref{scheme relative ample permanence prop}(\rmnum{1}). The other parts follows from the definition of quasi-projective morphism and \cref{scheme relative ample permanence prop}, with the corresponding properties of morphisms of finite type (\cref{scheme morphism ft permanence prop}).
\end{proof}
\begin{remark}
Note that it may happen that $f_{\red}$ is quasi-projective without $f$ being so, even we assume that $Y$ is the spectrum of a finite dimensional algebra over $C$ and $f$ is proper.
\end{remark}
\begin{corollary}\label{scheme quasi-projective coproduct}
If $X$ and $X'$ are two quasi-projective $Y$-schemes, $X\amalg X'$ is quasi-projective over $Y$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme relative ample and coproduct}.
\end{proof}
\subsection{Universally closed and proper morphisms}
As the terminology indicates, we say a morphism $f:X\to Y$ is \textbf{universally closed} if the projection $f\times_Y1_{Y'}:X\times_YY'\to Y'$ is closed for any base change $Y'\to Y$. By \cref{scheme immersion stable under base change}, we know that a closed immersion is universally closed. We say a morphism $f:X\to Y$ is \textbf{proper} if it is separated, of finite type, and universally closed, and in this case $X$ is said to be \textbf{proper over $\bm{Y}$}, or a \textbf{proper $\bm{Y}$-scheme}. It is clear that all these notations are local over $Y$. We also note that, to verify that the image of a closed subset $Z$ of $X\times_YY'$ under the projection $q:X\times_YY'\to Y'$ is closed in $Y'$, it suffices to shows that $q(Z)\cap U'$ is closed in $U'$ for any affine open subset $U'$ of $Y'$. As $q(Z)\cap U'=q(Z\cap q^{-1}(U'))$ and $q^{-1}(U')$ is identified with $X\times_YU'$ (\cref{scheme product inverse image of base open}), we see that to verify the universally closedness of $f$, it suffices to limit the case where $Y'$ is affine. We will see later that if $Y$ is locally Noetherian, we can even assume that $Y'$ is of finite type over $Y$.
\begin{proposition}[\textbf{Properties of Proper Morphisms}]\label{scheme morphism proper permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A closed immersion is proper.
\item[(\rmnum{2})] The composition of two proper morphisms is proper. 
\item[(\rmnum{3})] If $f:X\to Y$ is a proper $S$-morphism, then $f_{(S')}:X_{(S')}\to Y_{(S')}$ is proper for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $g:X'\to Y'$ are two proper $S$-morphisms, then $f\times_Sg$ is proper.  
\end{enumerate}
\end{proposition}
\begin{proof}
It suffices to prove the first three properties. In view of \cref{scheme morphism separated permanence prop} and \cref{scheme morphism ft permanence prop}, it suffices to verify the universally closedness in each cases. This is trivial in (\rmnum{1}) since closed immersions are universal. For (\rmnum{2}), consider two proper morphisms $X\to Y$, $Y\to Z$, and a morphism $Z'\to Z$. We have $X\times_ZZ'=X\times_Y(Y\times_ZZ')$ and therefore the projection $X\times_ZZ'\to Z'$ factors into $X\times_Y(Y\times_ZZ')\to Y\times_ZZ'\to Z'$. By hypothesis, this is a composition of two closed morphisms, hence closed. Finally, in (\rmnum{3}), for any morphism $S'\to S$, $X_{(S')}$ is identified with $X\times_YY_{(S')}$; for any morphism $Z\to Y_{(S')}$, we have 
\[X_{(S')}\times_{Y_{(S')}}Z=(X\times_YY_{(S')})\times_{Y_{(S')}}Z=X\times_YZ\]
and $X\times_YZ\to Z$ is closed by hypothesis, so (\rmnum{3}) follows.
\end{proof}
\begin{corollary}\label{scheme morphism proper cancelled prop}
Let $f:X\to Y$, $g:Y\to Z$ be two morphisms such that $g\circ f$ is proper.
\begin{enumerate}
\item[(a)] If $g$ is separated, $f$ is proper.
\item[(b)] If $g$ is separated and of finite type and $f$ is surjective, then $g$ is proper.
\end{enumerate}
\end{corollary}
\begin{proof}
The first claim follows from \cref{scheme morphism cancelled by separated if}. To prove (b), we only need to verify that $g$ is universally closed. For any morphism $Z'\to Z$, the diagram
\[\begin{tikzcd}
X\times_ZZ'\ar[rd,swap,"p"]\ar[r,"f\times 1_{Z'}"]&Y\times_ZZ'\ar[d,"p'"]\\
&Z'
\end{tikzcd}\]
(where $p$ and $p'$ are projections) is commutative. Moreover, $f\times 1_{Z'}$ is surjective if $f$ is (\cref{scheme surjective stable under base change}), and $p$ is a closed immersion by hypothesis. Any closed subset $F$ of $Y\times_ZZ'$ is then the image under $f\times 1_{Z'}$ of a closed subset $E$ of $X\times_ZZ'$, so $p'(F)=p(E)$ is closed in $Z'$ by hypothesis, whence the corollary.
\end{proof}
\begin{corollary}\label{scheme proper morphism into Proj is proper}
If $X$ is a proper scheme over $Y$ and $\mathscr{S}$ is a quasi-coherent $\mathscr{O}_Y$-algebra, any $Y$-morphism $f:X\to\Proj(\mathscr{S})$ is proper (and a fortiori closed).
\end{corollary}
\begin{proof}
In fact, the structural morphism $p:\Proj(\mathscr{S})\to Y$ is separated, and $p\circ f$ is proper by hypothesis.
\end{proof}
\begin{corollary}\label{scheme morphism proper over closed subscheme}
Let $f:X\to Y$ be a separated morphism of finite type. Let $(X_i)_{1\leq i\leq n}$ (resp. $(Y_i)_{1\leq i\leq n}$) be a family of closed subscheme of $X$ (Resp. $Y$), $j_i:X_i\to X$ (resp. $h_i:Y_i\to Y$) be the canonical injection. Suppose that $(X_i)$ forms a covering of $X$ and for each $i$, let $f_i:X_i\to Y_i$ be a morphism such that the diagram
\[\begin{tikzcd}
X_i\ar[r,"f_i"]\ar[d,swap,"j_i"]&Y_i\ar[d,"h_i"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
is commutative. Then, for $f$ to be proper, it is necessary and sufficient that each $f_i$ is proper.
\end{corollary}
\begin{proof}
If $f$ is proper, so is each $f\circ j_i$, since $j_i$ is a closed immersion; as each $h_i$ is a closed immersion, hence separated, $f_i$ is proper by \cref{scheme morphism proper cancelled prop}. Suppose conversely that each $f_i$ is proper, and consider the sum $Z$ of $X_i$; let $u:Z\to X$ be the morphism that induces $j_i$ on $X_i$. The restriction of $f\circ u$ to each $X_i$ is equal to $f\circ j_i=h_i\circ f_i$, hence proper; it then follows that $f\circ u$ is proper. Since $u$ is surjective by hypothesis, we conclude from \cref{scheme morphism proper cancelled prop} that $f$ is proper.
\end{proof}
\begin{corollary}\label{scheme morphism proper iff f_red}
Let $f:X\to Y$ be a separated morphism of finite type. For $f$ to be proper, it is necessary and sufficient that $f_{\red}:X_{\red}\to Y_{\red}$ is proper.
\end{corollary}
\begin{proof}
This is a particular case where $n=1$, $X_1=X_{\red}$ and $Y_1=Y_{\red}$.
\end{proof}
If $X$ and $Y$ and Noetherian schemes and $f:X\to Y$ is a separated morphism of finite type, to verify that $f$ is proper, we can reduce to dominant morphisms of integral schemes. In fact, let $X_i$ ($1\leq i\leq n$) be the irreducible components of $X$ and consider for each $i$ the unique reduced closed subscheme structure on $X_i$. Let $Y_i$ be the reduced closed subscheme with underlying space $\widebar{f(X_i)}$. If $j_i:X_i\to X$ (resp. $h_i:Y_i\to Y$) are the canonical injections, we then have $f\circ j_i=h_i\circ f_i$, where $f_i$ is a dominant morphism $f_i:X_i\to Y_i$. We then see that the conditions of \cref{scheme morphism proper over closed subscheme} are satisfied, and for $f$ to be proper, it is necessary and sufficient that each $f_i$ is.
\begin{corollary}\label{scheme separated morphism proper iff base change closed}
Let $X$ and $Y$ be separated $S$-schemes of finite type and $f:X\to Y$ be an $S$-morphism. For $f$ to be proper, it is necessary and sufficient that for any $S$-scheme $S'$, the morphism $f_{(S')}:X_{(S')}\to Y_{(S')}$ is closed.
\end{corollary}
\begin{proof}
We note that if $\varphi:X\to S$ and $\psi:Y\to S$ are the structural morphisms, we have $\varphi=\psi\circ f$, so $f$ is separated and of finite type (\cref{scheme morphism separated permanence prop} and \cref{scheme morphism ft permanence prop}). If $f$ is proper, so is $f_{(S')}$, and is a fortiori closed. Conversely, assume this condition and let $Y'$ be a $Y$-scheme; $Y'$ can be considered as an $S$-scheme, and the morphism $Y\to S$ is separated. In the commutative diagram
\[\begin{tikzcd}
X\times_YY'\ar[d]\ar[r,"f\times_Y1_{Y'}"]&Y\times_YY'=Y'\ar[d]\\
X\times_SY'\ar[r,"f_{(Y')}"]&Y\times_SY'
\end{tikzcd}\]
the vertical morphisms are a closed immersion by \cref{scheme product over separate base cochange and diagonal canonical closed}. It follows from the assumption that $f_{(Y')}$ is closed, and so is $f\times_Y1_{Y'}$.
\end{proof}
Let $f:X\to Y$ be a morphism of finit type. We say that a closed subset $Z$ of $X$ is \textbf{proper over $Y$} (or \textbf{$\bm{Y}$-proper}, or \textbf{$\bm{f}$-proper}) if the restriction of $f$ to a closed subscheme of $X$ with underlying space $Z$ is proper. As this restriction is then separated, it follows from \cref{scheme morphism proper iff f_red} and \cref{scheme morphism separated permanence prop}(\rmnum{6}) the property that $Z$ is proper over $Y$ is independent of the closed subscheme structural chosen for $Z$.\par
Let $Z$ be a proper subset of $X$ for $f$ and let $g:X'\to X$ be a proper morphism. Then $g^{-1}(Z)$ is then a proper subset of $X'$: if $T$ is a subscheme of $X$ with underlying space $Z$, it suffices to note that the restriction of $g$ to the closed subscheme $g^{-1}(T)$ of $X'$ is a proper morphism $g^{-1}(T)\to T$ by \cref{scheme morphism proper permanence prop}(\rmnum{3}), and we can apply \cref{scheme morphism proper permanence prop}(\rmnum{2}) to conclude that $g^{-1}(T)$ is proper.\par
On the other hand, if $X''$ is a $Y$-scheme of finite type and $h:X\to X''$ is a $Y$-morphism, $h(Z)$ is also a proper subset of $X''$: in fact, for any reduced closed subscheme $T$ of $X$ with underlying space $Z$. The restriction of $f$ to $T$ is proper, and so is the restriction of $h$ to $T$ (\cref{scheme morphism proper cancelled prop}(a)), so $h(Z)$ is closed in $X''$. Let $T''$ be a closed subscheme of $X''$ with underlying space $h(Z)$ so that the morphism $h|_T$ factors into (cf. \cref{scheme morphism from reduced factorization})
\[\begin{tikzcd}
T\ar[r,"h|_T"]&T''\ar[r,"j"]&X''
\end{tikzcd}\]
where $j$ is the canonical injection. Then $h|_T$ is proper by \cref{scheme morphism proper over closed subscheme} and surjective. If $\psi:X''\to Y$ is the structural morphism, $\psi|_{T''}$ is then separated of finite type (\cref{scheme morphism separated permanence prop} and \cref{scheme morphism ft permanence prop}), and we have $f|_T=(\psi|_{T''})\circ(h|_T)$; it then follows from \cref{scheme morphism proper permanence prop}(\rmnum{2}) that $\psi|_{T''}$ is proper, whence the assertion.\par
In particular, for a $Y$-proper subset of $X$, we have the following:
\begin{enumerate}
\item[(a)] For any closed subset $X'$ of $X$, $Z\cap X'$ is a $Y$-proper subset of $X'$.
\item[(b)] If $X$ is a subscheme of a $Y$-scheme of finite type $X''$, $Z$ is also a $Y$-proper subset of $X''$ (and in particular is closed in $X''$).
\end{enumerate}
\subsection{Projective morphisms}
\begin{proposition}\label{scheme closed subscheme of P(E) iff Proj}
Let $X$ be a $Y$-scheme. The following conditins are equivalent:
\begin{enumerate}
\item[(a)] $X$ is $Y$-isomorphic to a closed subscheme of a projective bundle $\P(\mathscr{E})$, where $\mathscr{E}$ is a quasi-coherent $\mathscr{O}_Y$-module of finite type.
\item[(b)] There exists a quasi-coherent graded $\mathscr{O}_Y$-algebra such that $\mathscr{S}_1$ is of finite type and generates $\mathscr{S}$, and that $X$ is $Y$-isomorphic to a $\Proj(\mathscr{S})$.
\end{enumerate}
\end{proposition}
\begin{proof}
Condition (a) implies (b) by \cref{scheme Proj of qcoh algera closed subscheme char}(b): if $\mathscr{I}$ is the quasi-coherent graded ideal of $\bm{S}(\mathscr{E})$, the quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}=\bm{S}(\mathscr{E})/\mathscr{I}$ is generateed by $\mathscr{S}_1$ and the later, which is the canonical image of $\mathscr{E}$, is an $\mathscr{O}_X$-module of finite type. Condition (b) implies (a) in view of \cref{scheme Proj of qcoh algera homomorphism to sym} applied to the case where $\mathscr{M}\to\mathscr{S}_1$ is the identify homomorphism.
\end{proof}
We say a $Y$-scheme $X$ is \textbf{projective over $\bm{Y}$} or a projective \textbf{$\bm{Y}$-scheme} if it satisfies the equivalent conditions of \cref{scheme closed subscheme of P(E) iff Proj}. We say a morphism $f:X\to Y$ is \textbf{projective} if $X$ is a projective $Y$-scheme via this morphism. It is clear that if $f:X\to Y$ is projective, then there exists a very ample $\mathscr{O}_X$-module relative to $f$ (\cref{scheme very ample if inverse of immersion Proj}).
\begin{theorem}\label{scheme projective and quasi-projective}
Any projective morphism is quasi-projective and proper. Conversely, if $Y$ is a quasi-compact and quasi-separated scheme, any quasi-projective and proper morphism $f:X\to Y$ is projective.
\end{theorem}
\begin{proof}
It is clear that any projective morphism is of finite type and quasi-projective. On the other hand, it follows from \cref{scheme closed subscheme of P(E) iff Proj}(b) and \cref{scheme Proj of qcoh alg base change prop} that if $f$ is projective, so is $f\times_Y1_{Y'}:X\times_YY'\to Y'$ for any morphism $Y'\to Y$. The proof that $f$ is universally closed then boils down to show that a projective morphism $f$ is closed. The question is local over $Y$, so we can suppose that $Y=\Spec(A)$ is affine, so by \cref{scheme closed subscheme of P(E) iff Proj} $X=\Proj(S)$ where $S$ is a graded $A$-algebra generated by finitely many elements of $S_1$. For any $y\in Y$, the fiber $f^{-1}(y)$ is identified with $\Proj(S)\times_Y\Spec(\kappa(y))$, hence to $\Proj(S\otimes_A\kappa(y))$ (\cref{scheme Proj base ring change prop}). Therefore, $f^{-1}(y)$ is empty if and only if $S\otimes_A\kappa(y)$ is eventually zero, which meaens $S_n\otimes_A\kappa(y)=0$ for $n$ sufficiently large. Now as $(S_n)_y$ is an $\mathscr{O}_{Y,y}$-module of finite type, the preceding condition signifies that $(S_n)_y=0$ for $n$ sufficiently large, in view of Nakayama lemma. If $\a_n$ is the annihilator in $A$ of the $A$-module $S_n$, the preceding condition is then equivalent to that $\a_n\sub\p_y$ for $n$ sufficiently large. Now as $S_nS_1=S_{n+1}$ by hypothesis, we have $\a_n\sub\a_{n+1}$, and if $\a$ is the sum of $\a_n$, we then have $f(X)=V(\a)$, so $f(X)$ is closed in $Y$. If now $X'$ is a closed subset of $X$, there exists a closed subscheme of $X$ with underlying space $X'$ and it is clear (by \cref{scheme closed subscheme of P(E) iff Proj}(a)) that the composition morphism $X'\to X\to Y$ is projective, so $f(X')$ is closed in $Y$.\par
Now conversely, assume that $Y$ is quasi-compact and quasi-separated. The hypothesis that $f$ is quasi-projective implies the existence of a quasi-coherent $\mathscr{O}_Y$-module of finite type $\mathscr{E}$ and a $Y$-immersion $j:X\to\P(\mathscr{E})$ (\cref{scheme quasi-projective over qcqs iff P(E)}). Since $f$ is proper and the structural morphism $\P(\mathscr{E})\to Y$ is separated, $j$ is proper (hence closed) by \cref{scheme morphism proper cancelled prop}(a), so $f$ is projective.
\end{proof}
\begin{remark}\label{scheme morphism proper very ample A(X) ft is projective}
Let $f:X\to Y$ be a morphism such that 
\begin{enumerate}
\item[(\rmnum{1})] $f$ is proper;
\item[(\rmnum{2})] there exists a very ample $\mathscr{O}_X$-module $\mathscr{L}$ relative to $f$;
\item[(\rmnum{3})] the quasi-coherent $\mathscr{O}_Y$-module $\mathscr{E}=f_*(\mathscr{L})$ is of finite type.
\end{enumerate}
Then $f$ is projective: there then exists a $Y$-immersion $j:X\to\P(\mathscr{E})$, and since $f$ is proper, $j$ is a closed immersion by \cref{scheme morphism proper cancelled prop}(a). We will see that if $Y$ is locally Noetherian, the last condition (\rmnum{3}) is a concequence of the others, and conditions (\rmnum{1}) and (\rmnum{2}) characterize projective morphisms. If $Y$ is Noetherian, we can further repalce in (\rmnum{2}) that there exists a \textit{ample} $\mathscr{O}_X$-module relative to $f$ (\cref{scheme qc relative ample iff power very ample}). We also note that there are proper morphisms that is not projective.
\end{remark}
\begin{remark}
Let $Y$ be a quasi-compact scheme such that there exists an ample $\mathscr{O}_Y$-module. For a $Y$-scheme $X$ to be projective, it is necessary and sufficient that it is isomorphic to a closed subscheme of a projective bundle of the form $\P_Y^r$. This conditions is clearly sufficient. Conversely, if $X$ is projective over $Y$, it is quasi-projective, so there exists a $Y$-immersion $j:X\to\P_Y^r$ by \cref{scheme quasi-projective over qcqs iff subscheme of P^n}, which is closed by \cref{scheme morphism proper cancelled prop}(a) and \cref{scheme projective and quasi-projective}.
\end{remark}
\begin{remark}
The reasoning of \cref{scheme projective and quasi-projective} shows that for any scheme $Y$, and any integer $r\geq 0$, the structural morphism $\P_Y^r\to Y$ is surjective, because if we put $\mathscr{S}_{\mathscr{O}_Y}=\bm{S}(\mathscr{O}_Y^{r+1})$, we have evidently $\mathscr{S}_y=\bm{S}_{\kappa(y)}(\kappa(y)^{r+1})$, so $(\mathscr{S}_n)_y\neq 0$ for any $y\in Y$ and $n\geq 0$.
\end{remark}
\begin{proposition}[\textbf{Properties of Projective Morphisms}]\label{scheme morphism projective permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A closed immersion is projective.
\item[(\rmnum{2})] If $f:X\to Y$ and $g:Y\to Z$ are projective morphisms and if $Z$ is quasi-compact and quasi-separated, then $g\circ f$ is projective.
\item[(\rmnum{3})] If $f:X\to Y$ is a projective morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is projective for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $g:X'\to Y'$ are projective $S$-morphisms, so is $f\times_Sg$.
\item[(\rmnum{5})] If $g\circ f$ is a projective morphism and if $g$ is separated, $f$ is projective.
\item[(\rmnum{6})] If $f$ is projective, so is $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
Property (\rmnum{1}) follows from \cref{scheme Proj of qcoh polynomial algebra}. It is necessary here to prove (\rmnum{3}) and (\rmnum{4}) separately, because of the restriction introduced on $Z$ in (\rmnum{2}). To prove (\rmnum{3}), we can reduce to the case where $S=Y$ (\cref{scheme base change base morphism prop}) and the assertion then follows immediately from \cref{scheme closed subscheme of P(E) iff Proj}(b) and from \cref{scheme Proj of qcoh alg base change prop}. To prove (\rmnum{4}), we can assume that $X=\P(\mathscr{E})$, $X'=\P(\mathscr{E}')$, where $\mathscr{E}$ (resp. $\mathscr{E}'$) is a quasi-coherent $\mathscr{O}_Y$-module of finite type. Let $p,p'$ be the projection of $T=Y\times_SY'$ to $Y$ and $Y'$ respectively; by (\ref{scheme prjective bundle base change prop}), we have $\P(p^*(\mathscr{E}))=\P(\mathscr{E})\times_YT$ and $\P(p'^*(\mathscr{E}))=\P(\mathscr{E}')\times_{Y'}T$, whence
\begin{align*}
\P(p^*(\mathscr{E}))\times_T\P(p'^*(\mathscr{E}'))&=(\P(\mathscr{E})\times_YT)\times_T(T\times_{Y'}\P(\mathscr{E}'))=\P(\mathscr{E})\times_Y(T\times_{Y'}\P(\mathscr{E}'))\\
&=\P(\mathscr{E})\times_Y((Y\times_SY')\times_{Y'}\P(\mathscr{E}'))=\P(\mathscr{E})\times_S\P(\mathscr{E}').
\end{align*}
Now $p^*(\mathscr{E})$ and $p'^*(\mathscr{E}')$ are of finite type over $T$ (\cref{sheaf of module ft inverse image is ft}), and so is $p^*(\mathscr{E})\otimes_{\mathscr{O}_T}p'^*(\mathscr{E}')$; as $\P(p^*(\mathscr{E}))\times_T\P(p'^*(\mathscr{E}'))$ is identified with a closed subscheme of $\P(p^*(\mathscr{E})\otimes_{\mathscr{O}_T}p'^*(\mathscr{E}'))$ (\cref{scheme Proj Segre morphism base change prop}), this proves (\rmnum{4}). For (\rmnum{5}) and (\rmnum{6}), we can apply \cref{scheme morphism cancelled by separated if}, since any closed subscheme of a projective $Y$-scheme is projective by \cref{scheme closed subscheme of P(E) iff Proj}(a).
\end{proof}
\begin{proposition}\label{scheme projective coproduct}
If $X$ and $X'$ are two projective $Y$-schemes, so is $X\amalg X'$.
\end{proposition}
\begin{proof}
This is clear from \cref{scheme projective bundle sum immersion}.
\end{proof}
\begin{proposition}\label{scheme projective ample sheaf X_f Y-affine}
Let $X$ be a projective $Y$-scheme, $\mathscr{L}$ be a $Y$-ample $\mathscr{O}_Y$-module. For any section $f$ of $\mathscr{L}$ over $X$, $X_f$ is affine over $Y$.
\end{proposition}
\begin{proof}
Since the question is local over $Y$, we can assume that $Y=\Spec(A)$ is affine; since $X_{f^{\otimes n}}=X_f$, by replacing $\mathscr{L}$ by $\mathscr{L}^{\otimes n}$ we can assume that $\mathscr{L}$ is very ample for the structural morphism $q:X\to Y$ (\cref{scheme ample sheaf over affine iff power very ample}). The canonical homomorphism $\sigma:q^*(q_*(\mathscr{L}))\to\mathscr{L}$ is then surjective and the corresponding morphism
\[r=r_{\mathscr{L},\sigma}:X\to P=\P(q_*(\mathscr{L}))\]
is an immersion such that $\mathscr{L}\cong r^*(\mathscr{O}_P(1))$ (\cref{scheme very ample iff direct image}). Moreover, as $X$ is proper over $Y$, the immersion $r$ is closed by \cref{scheme morphism proper cancelled prop}. By definition $f\in\Gamma(Y,q_*(\mathscr{L}))$ and $\sigma^{\flat}$ is the identity of $q_*(\mathscr{L})$; it then follows from the formula (\ref{scheme morphism into Proj affine D_+(f) preimage char-1}) that we have $X_f=r^{-1}(D_+(f))$. Then $X_f$ is a closed subscheme of the affine scheme $D_+(f)$, and therefore is affine.
\end{proof}
\begin{remark}
If we take $Y=X$ in \cref{scheme projective ample sheaf X_f Y-affine}, we obtain that, for any scheme $X$ and any invertible $\mathscr{O}_X$-module $\mathscr{L}$, the open subset $X_f$ is affine over $X$.
\end{remark}
\begin{proposition}\label{scheme projective isomorphic to Proj of canonical ring}
Let $X$ be a projective $Y$-scheme and $\mathscr{L}$ be a $Y$-ample $\mathscr{O}_Y$-module. Then $X$ is $Y$-isomorphic to $\Proj(\mathscr{S})$, where $\mathscr{S}=\bigoplus_{n\geq 0}f_*(\mathscr{L}^{\otimes n})$.
\end{proposition}
\begin{proof}
By \cref{scheme relative ample and direct image algebra} we see that the canonical morphism $r_{\mathscr{L},\sigma}:X\to\Proj(\mathscr{S})$ is a dominant open immersion. Since $X$ is proper over $Y$ and $\Proj(\mathscr{S})$ is separated over $Y$, the image of $r_{\mathscr{L},\sigma}$ is closed by \cref{scheme morphism proper cancelled prop}, so $r_{\mathscr{L},\sigma}:X\to\Proj(\mathscr{S})$ is an isomorphism.
\end{proof}
\subsection{Chow's lemma}
\begin{theorem}[\textbf{Chow's lemma}]\label{scheme morphism ft over Now Chow lemma}
Let $X$ be a separated $S$-scheme of finite type and suppose that one of the following conditions is satisfied:
\begin{enumerate}
\item[(a)] $S$ is Noetherian.
\item[(b)] $S$ is quasi-compact and $X$ has finitely many irreducible components.
\end{enumerate}
Then there exists a quasi-projective $S$-scheme $X'$ and a surjective projective $S$-morphism $f:X'\to X$ that induces an isomorphism an isomorphism $f^{-1}(U)\cong U$ for some open dense subset of $X$. If $X$ is reduced (resp. irreducible), we can also choose $X'$ to be reduced (resp. irreducible).
\end{theorem}
\begin{proof}
The proof is divided into several steps. First of all, we can assume that $X$ is irreducible. To see this, we note that in both cases the scheme $X$ has finitely many irreducible components $X_i$. If the theorem is demonstrated for each reduced subscheme $X_i$, and if $f_i:X'_i:X_i$ is the corresponding hommorphism which induces an isomorphism $f_i^{-1}(U_i)\cong U_i$ with $U_i\sub X_i$, the sum $X'=\coprod_iX'_i$ is then quasi-projective over $S$ (\cref{scheme quasi-projective coproduct} and \cref{scheme morphism quasi-projective permanence prop}) and the morphism $f:X'\to X$ whose restriction on $X'_i$ equals to $j_i\circ f_i$ (where $j_i:X_i\to X$ is the canonical injection), is then surjective and projective (\cref{scheme projective coproduct}); it is immediate to see that $X'$ is reduced if each $X'_i$ is. We now choose $U$ to be the union of $U_i\cap(\bigcup_{j\neq i}X_j)^c$; since $U_i$ is dense in $X_i$ and $X_i$ is maximal irreducible, we conclude that each $U_i\cap(\bigcup_{j\neq i}X_j)$ is nonempty. The open subset $U$ is then dense in $X$ and $f$ clearly induces an isomorphism $f^{-1}(U)\cong U$.\par
So suppose now that $X$ is irreducible. As the structural morphism $\eta:X\to S$ is of finite type, there exists a finite covering $(S_i)$ of $S$ by affine opens, and for each $i$ there is a finite covering $(T_{ij})$ of $\eta^{-1}(S_i)$ by affine opens, with the morphism $T_{ij}\to S_i$ being affine and of finite type, hence quasi-projective (\cref{scheme morphism quasi-projective permanence prop}(\rmnum{1})). As in both hypotheses the immersion $S_i\to S$ is quasi-compact, it is quasi-projective by \cref{scheme morphism quasi-projective permanence prop}(\rmnum{1}), so the restriction of $\eta$ to $T_{ij}$ is quasi-projective (\cref{scheme morphism quasi-projective permanence prop}(\rmnum{2})). We relabel the $T_{ij}$ by $U_k$ with $1\leq k\leq n$. There exists, for each index $k$, an open immersion $\varphi_k:U_k\to P_k$, where $P_k$ is projective over $S$ (\cref{scheme quasi-projective over qcqs iff P(E)}). Let $U=\bigcap_kU_k$; as $X$ is irreducible and the $U_k$ is nonempty, $U$ is nonempty, and therefore is dense in $X$; the restrictions of $\varphi_k$ to $U$ together define a morphism
\[\varphi:U\to P=P_1\times_SP_2\times_S\cdots\times_SP_n\]
which fits into the diagram
\begin{equation}\label{scheme morphism ft over Now Chow lemma-1}
\begin{tikzcd}
U\ar[d,swap,"j_k"]\ar[r,"\varphi"]&P\ar[d,"p_k"]\\
U_k\ar[r,"\varphi_k"]&P_k
\end{tikzcd}
\end{equation}
where $j_k$ is the canonical injection and $p_k$ is the canonical projection. If $j:U\to X$ is the canonical injection, the morphism $\psi=(j,\varphi)_S:U\to X\times_SP$ is then an immersion by \cref{scheme local immersion stable under target product}. Under the hypotheses of (a), $X\times_SP$ is locally Noetherian (\cref{scheme Proj of qcoh alg ft if S_1 ft} and \cref{scheme morphis local ft local Noe base change is local Noe}), and under the hypotheses of (b), $X\times_SP$ is quasi-compact. In both cases the scheme-theoretic image $X'$ of $\psi$ in $X\times_SP$ exists (which is the closure of $\psi(U)$ in $X\times_SP$) and $\psi$ factors into
\[\psi:U\stackrel{\psi'}{\to}X'\stackrel{h}{\to}X\times_SP\]
where $\psi'$ is a dominant open immersion and $h$ is a closed immersion. Let $q_1:X\times_SP\to X$ and $q_2:X\times_P\to P$ be the canonical projections; we put
\begin{align}\label{scheme morphism ft over Now Chow lemma-2}
f:X'\stackrel{h}{\to}X\times_SP\stackrel{q_1}{\to}X,\quad g:X'\stackrel{h}{\to}X\times_SP\stackrel{q_2}{\to}P.
\end{align}
We shall verify that the scheme $X'$ and the morphism $f$ satisfy the requirements. First we show that $f$ is projective and surjective, and that the restriction of $U'=f^{-1}(U)$ is an isomorphism from $U'$ to $U$. As the $P_k$ are projective over $S$, so is $P$ (\cref{scheme morphism projective permanence prop}(\rmnum{4})), and $X\times_SP$ is projective over $X$ by \cref{scheme morphism projective permanence prop}(\rmnum{3}); then $X'$ is also projective over $X$, since it is a closed subscheme of $X\times_SP$. On the other hand, we have $f\circ\psi'=q_1\circ(h\circ\psi')=q_1\circ\psi=j$, so $f(X')$ contains the dense open subset $U$ of $X$; but $f$ is proper by \cref{scheme projective and quasi-projective}, so $f(X')=X$. Now $q_1^{-1}(U)=U\times_SP$ is an open subscheme of $X\times_SP$, and the the immersion $\psi$ factors into
\[\psi:U\stackrel{\Gamma_\varphi}{\to}U\times_SP\stackrel{j\times 1}{\to}X\times_SP.\]
By \cref{scheme theoretic over open subset char}, $U'=h^{-1}(U\times_SP)$ is the scheme-theoretic image of $\psi^{-1}(U\times_SP)=U$ under $\psi_U:U\to U\times_SP$, and therefore the closure of the image of $\Gamma_\varphi$ in $U\times_SP$. As $P$ is separted over $S$, $\Gamma_\varphi$ is a closed immersion (\cref{scheme morphism to separated graph is closed}), so we conclude that $U'=\psi(U)$. As $\psi$ is an immersion, the restriction of $f$ to $U'$ is then an isomorphism, with inverse $\psi'$. Finally, by definition, $U'=\psi(U)=\psi'(U)$ is open and dense in $X'$.\par
We now show that $g$ is an immersion, which implies that $X'$ is quasi-projective over $S$, since $P$ is projective over $S$. Let $V_k=\varphi_k(U_k)$ be the image of $U_k$ in $P_k$, $W_k=p_k^{-1}(V_k)$ be the inverse image in $P$, and put $U'_k=f^{-1}(U_k)$, $U''_k=g^{-1}(W_k)$. Since the $U_k$ cover $X$, it clear that the $U'_k$ form an open covering of $X'$; we first shows that this is also true for the $U''_k$, by proving that $U'_k\sub U''_k$. For this, it suffices to estabilsh the commutativity of the diagram
\begin{equation}\label{scheme morphism ft over Now Chow lemma-3}
\begin{tikzcd}
U'_k\ar[r,"g|_{U'_k}"]\ar[d,swap,"f|_{U'_k}"]&P\ar[d,"p_k"]&\\
U_k\ar[r,"\varphi_k"]&P_k
\end{tikzcd}
\end{equation}
Since $U'_k=h^{-1}(U_k\times_SP)$ and $\psi^{-1}(U_k\times_SP)=U$, by \cref{scheme theoretic over open subset char} $U'_k$ is the scheme-theoretic image of $U$ in $U_k\times_SP$ under the morphism $\psi_k:U\to U_k\times_SP$ induced by $\psi$. It then suffices to prove the commutativity of the diagram obtained by composing (\ref{scheme morphism ft over Now Chow lemma-3}) with the morphism $\psi_k$ (\cref{scheme theoretic dense is epimorphism}), and this comes from the commutative diagram (\ref{scheme morphism ft over Now Chow lemma-1}).\par
The $W_k$ then form an open covering of $g(X')$, so to show that $g$ is an immersion, it suffices to show the restriction $g|_{U''_k}$ is an immersion into $W_k$ (\cref{scheme immersion open covering prop}). For this, consider the morphism
\[u_k:W_k\stackrel{p_k}{\to}V_k\stackrel{\varphi_k^{-1}}{\to}U_k\to X\]
which fits into the following commutative diagram
\[\begin{tikzcd}[row sep=12mm,column sep=12mm]
U'\ar[rd]\ar[r,hook]&U'_k\ar[rd]\ar[r,hook]&U''_k\ar[rr,bend left=50pt,"g|_{U''_k}"]\ar[r,hook,"h|_{U''_k}"]\ar[rd,swap,"f|_{U''_k}"description]&X\times_SW_k\ar[d,"q_1"description]\ar[r,"q_2"]&W_k\ar[d,"p_k"]\ar[l,bend right=30pt,swap,"\Gamma_{u_k}"]\ar[ld,"u_k"description]\\
&U\ar[r,hook]&U_k\ar[rr,bend right=30pt,swap,"\varphi_k","\cong"']\ar[r,hook]&X&V_k
\end{tikzcd}\]

By the definition of $g$ (formula (\ref{scheme morphism ft over Now Chow lemma-2})), we have $U''_k=h^{-1}(X\times_SW_k)\sub X'$ and $\psi^{-1}(X\times_SW_k)=U$, so by \cref{scheme theoretic over open subset char}, $U''_k$ is the scheme-theoretic image of $U$ under the morphism $U\to X\times_SW_k$ induced by $\psi$; since $U'=\psi(U)$, it is therefore dense in $U''_k$. On the other hand, as $X$ is separted over $S$, the graph morphism $\Gamma_{u_k}:W_k\to X\times_SW_k$ is a closed immersion, so the graph $T_k=\Gamma_{u_k}(W_k)$ is a closed subscheme of $X\times_SW_k$. If we can prove that $T_k$ dominates the canonical image of the open subscheme $U'$ in $X\times_SW_k$, it will then dominates the subscheme $U''_k$. As the restriction of $q_2$ to $T_k$ is an isomorphism onto $W_k$ and $h$ is a closed immersion, the restriction of $g$ to $X''_k$ will then be an immersion in $W_k$, and our assertion will be proved. For this, we let $v_k:U'\to X\times_SW_k$ be the canonical injection, and $w_k=q_2\circ v_k$; then from the definition of $\Gamma_{u_k}$ we have $v_k=\Gamma_{u_k}\circ w_k$, and the image of $U'$ in $X\times_SW_k$ is therefore contained in $T_k$, verifying our claim.\par
It is clear that $U$, and therefore $U'$, are irreducible, and so is $X'$ by our construction, and that $f$ is birational. If $X$ is reduced, so is $U'$, and $X'$ is then reduced (\cref{scheme theoretic image exist if}). This completes the proof.
\end{proof}
\begin{corollary}\label{scheme proper iff projective Chow lemma}
Suppose the hypotheses of \cref{scheme morphism ft over Now Chow lemma}. For $X$ to be proper over $S$, it is necessary and sufficient that there exists a projective $S$-scheme $X'$ and a surjective $S$-morphism $f:X'\to X$ (which is projective by \cref{scheme morphism projective permanence prop}(\rmnum{5})). If this is the case, we can choose an open dense subset $U$ of $X$ such that $f$ induces an isomorphism $f^{-1}(U)\cong U$ and that $f^{-1}(U)$ is dense in $X'$. If $X$ is irreducible (resp. reduced), we can choose $X'$ to be irreducible (resp. reduced). If $X$ and $X'$ are irreducible, $f$ is then a birational morphism.
\end{corollary}
\begin{proof}
The conditions is sufficient by \cref{scheme projective and quasi-projective} and \cref{scheme morphism proper cancelled prop}(b). This is necessary because with the notations of \cref{scheme morphism ft over Now Chow lemma}, if $X$ is proper over $S$, $X'$ is then proper over $S$ (since it is proper over $X$ by \cref{scheme projective and quasi-projective}), and our assertion follows from \cref{scheme morphism proper permanence prop}(\rmnum{2}). Moreover, as $X'$ is quasi-projective over $S$, it is projective over $S$ in view of \cref{scheme projective and quasi-projective}.
\end{proof}
\begin{corollary}\label{scheme proper over local Noe iff base change closed}
Let $S$ be a locally Noetherian scheme, $X$ be an $S$-scheme of finite type, and $\varphi:X\to S$ be the structural morphism. For $X$ to be proper over $S$, it is necessary and sufficient that for any morphism of finite type $S'\to S$, the morphism $\varphi_{(S')}:X_{(S')}\to S'$ is closed. Moreover, it suffices to verify this condition for any $S$-scheme of the form $S'=S\otimes_{\Z}\Z[T_1,\dots,T_n]$.
\end{corollary}
\begin{proof}
The conditions is clearly necessary, and we now prove the sufficiency. The question is local over $S$ and $S'$, so we may assume that $S$, $S'$ are affine and Noetherian. By Chow's lemma, there exists a projective $S$-scheme $P$, an immersion $j:X'\to P$, and a projective surjective morphism $f:X'\to X$ such that the diagram
\[\begin{tikzcd}
X'\ar[rd,"\psi"]\ar[rdd,bend right=20pt,swap,"j"]\ar[rrd,bend left=20pt,"f"]&&\\
&X\times_SP\ar[d,swap,"q_2"]\ar[r,"q_1"]&X\ar[d,"\varphi",description]\\
&P\ar[r,"r"]&S
\end{tikzcd}\]
is commutative; let $\psi=(f,j)_S$. As $P$ is of finite type over $S$, the projection $q_2:X\times_SP\to P$ is a closed morphism by hypotheses. On the other hand, since $f$ is projective and the projection $q_1:X\times_SP\to X$ is separated (since $P$ is separated over $S$), we conclude from \cref{scheme morphism projective permanence prop}(\rmnum{5}) that $\psi$ is projective, hence closed. Since the immersion $j$ is the composition of $q_2$ with $\psi$, it is therefore a closed immersion, whence proper. Moreover, the structural morphism $r:P\to S$ is projective, hence proper (\cref{scheme projective and quasi-projective}), so $\varphi\circ f=r\circ j$ is proper. As $f$ is surjective, we conclude by \cref{scheme morphism proper cancelled prop}(b) that $\varphi$ is proper.\par
To estabilsh the second assertion of the proposition, it suffices to prove that it implies that $\varphi_{(S')}$ is closed for any morphism $S'\to S$ of finite type. Now if $S'$ is affine and of finite type over $S=\Spec(A)$, we have $S'=\Spec(A[x_1,\dots,x_n])$, and $S'$ is then isomorphic to a closed subscheme of $S''=\Spec(A[T_1,\dots,T_n])$ (where $T_i$ are indeterminates). In the following commutative diagram
\[\begin{tikzcd}
X\times_SS'\ar[r,"1_X\times j"]\ar[d,swap,"\varphi_{(S'')}"]&X\times_SS''\ar[d,"\varphi_{(S'')}"]\\
S'\ar[r,"j"]&S''
\end{tikzcd}\]
where $j$ and $q_X\times j$ are closed immersions (\cref{scheme immersion stable under base change}) and $\varphi_{(S'')}$ is closed by hypothesis. We then conclude that $\varphi_{(S')}$ is closed, whence the claim.
\end{proof}
\section{Integral morphisms and finite morphisms}
\subsection{Integral and finite morphisms}
Let $X$ be an $S$-scheme and $f:X\to S$ be the structural morphism. We say that $X$ is \textbf{integral over $\bm{S}$}, or that $f$ is an \textbf{integral morphism}, if there exists an affine open covering $(S_\alpha)$ of $S$ such that for each $\alpha$, the open subscheme $f^{-1}(S_\alpha)$ of $X$ is affine and its ring $B_\aleph$ is an integral algebra over the ring $A_\alpha$ of $S_\alpha$. We say that $X$ is \textbf{finite over $S$}, or that $f$ is a \textbf{finite morphism}, if $X$ is integral and of finite type over $S$. If $S$ is affine with ring $A$, we also say that $X$ is inegral or finite over $A$.\par
It is clear that any integral $S$-scheme is affine over $S$. Conversely, form the definition of integral morphisms, we see that for an affine $S$-scheme $X$ to be integral over $S$ (resp. finite), it is necessary and sufficient that the associated quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{A}(X)$ is such that there exists an affine open covering $(S_\alpha)$ of $S$ such that for each $\alpha$, $\Gamma(S_\alpha,\mathscr{A}(X))$ is an integral algebra (resp. an integral algebra of finite type) over $\Gamma(S_\alpha,\mathscr{O}_S)$. A quasi-coherent $\mathscr{O}_S$-algebra satisfying this property is said to be \textbf{integral} (resp. \textbf{finite}) over $\mathscr{O}_S$. We note that a quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{B}$ is finite if and only if it is an $\mathscr{O}_S$-module of finite type; it amounts to the same thing to say that $\mathscr{B}$ is an integral $\mathscr{O}_S$-algebra of finite type, because an integer algebra of finite type over a ring $A$ is an $A$-module of finite type.
\begin{proposition}\label{scheme finite over local Noe iff A(X) coh}
Let $S$ be a locally Noetherian scheme. For an $S$-scheme $X$ affine over $S$ to be finite over $S$, it is necessary and sufficient that the $\mathscr{O}_S$-algebra $\mathscr{A}(X)$ is coherent.
\end{proposition}
\begin{proof}
With the preceding remark, this follows from the fact that if $S$ is locally Noetherian, then a quasi-coherent $\mathscr{O}_S$-module is of finite type if and only if it is coherent (\cref{scheme affine Noe coh sheaf char}). 
\end{proof}
\begin{proposition}\label{scheme integral iff integral algebra on affine}
Let $X$ be an integral (resp. finite) scheme over $S$ with $f:X\to S$ the structural morphism. Then for any affine open subset $U\sub S$ with ring $A$, $f^{-1}(U)$ is affine and its ring $B$ is an integral (resp. finite) algebra over $A$.
\end{proposition}
\begin{proof}
To prove this proposition, we need \cref{Spec finite standard open cov glue property}. We now that $f^{-1}(U)$ is affine by \cref{scheme S-affine preimage of open is affine}. If $\varphi:A\to B$ is the corresponding homomorphism, there exists a finite covering of $U$ by open subsets $D(g_i)$ ($g_i\in A$) such that, if $h_i=\varphi(g_i)$, then $B_{h_i}$ is an integral (resp. finite) algebra over $A_{g_i}$. In fact, by assumption, there is a covering of $U$ by affine open subsets $V_\alpha\sub U$ such that if $A_\alpha=\Gamma(V_\alpha,\mathscr{O}_S)$ and $B_\alpha=\Gamma(f^{-1}(V_\alpha),\mathscr{O}_X)$, then $B_\alpha$ is an integral (resp. finite) algebra over $A_\alpha$. Any $x\in U$ belongs to one $V_\alpha$, so there exists $g\in A$ such that $x\in D(g)\sub V_\alpha$. If $g_\alpha$ is the image of $g$ in $A_\alpha$, we have $\Gamma(D(g),\mathscr{O}_S)=A_g=(A_\alpha)_{g_\alpha}$; let $h=\varphi(g)$, and let $h_\alpha$ be the image of $g_\alpha$ in $B_\alpha$. We have
\[\Gamma(D(h),\mathscr{O}_S)=B_h=(B_\alpha)_{h_\alpha}\]
and as $B_\alpha$ is integral over $A_\alpha$, $(B_\alpha)_{h_\alpha}$ is integral (resp. finite) over $(A_\alpha)_{g_\alpha}$. Since $U$ is quasi-compact, we obtain a finite cover.\par
If we suppose first that each $B_{h_i}$ is a finite algebra over $A_{g_i}$, then as an $A_{g_i}$-module, $B_{h_i}$ is finitely generated, so \cref{Spec finite standard open cov glue property} shows that $B$ is a finitely generated $A$-module. Now assume that each $B_{h_i}$ is integral over $A_{g_i}$; let $b\in B$, and let $C$ be a sub-$A$-algebra of $B$ generated by $b$. For each $i$, $C_{h_i}$ is the $A_{g_i}$-algebra generated by $b/1$ over $B_{h_i}$. It then follows from the hypothesis that each $C_{h_i}$ is finitely generated $A_{g_i}$-module, so by \cref{Spec finite standard open cov glue property} $C$ is a finitely generated $A$-module. This shows that $B$ is integral over $A$.
\end{proof}
\begin{proposition}[\textbf{Properties of Integral and Finite morphisms}]\label{scheme morphism integral finite permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A closed immersion is finite (and a fortiori integral).
\item[(\rmnum{2})] The composition of two integral morphisms (resp. finite) is integral (resp. finite).
\item[(\rmnum{3})] If $f:X\to Y$ is an integral (resp. finite) $S$-morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is integral (resp. finite) for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $g:X'\to Y'$ are two integral (resp. finite) $S$-morphisms, so is $f\times_Sg$.
\item[(\rmnum{5})] If $f:X\to Y$ and $g:Y\to Z$ are two morphisms such that $g\circ f$ is integral (resp. finite) and $g$ is separated, then $f$ is integral (resp. finite).
\item[(\rmnum{6})] If $f:X\to Y$ is an integral (resp. finite) morphism, so is $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
In view of \cref{scheme morphism cancelled by separated if}, it suffices to prove (\rmnum{1}), (\rmnum{2}), and (\rmnum{3}). To prove that a closed immersion $X\to S$ is finite, we can assume that $S=\Spec(A)$, and this then follows from the fact that a quotient ring $A/\a$ is a finitely generated $A$-module. To prove the composition of two integral (resp. finite) morphisms $X\to Y$, $Y\to Z$ is integral (finite), we can assume that $Z$ (and therefore $X$ and $Y$) is affine, and the assertion is then equivalent to that if $B$ is an integral (resp. finite) $A$-algebra and $C$ is an integral (resp. finite) $B$-algebra, then $C$ is an integral (resp. finite) $A$-algebra, which is immediate. Finally, to prove (\rmnum{3}), we can Simialrly assume that $S=\Spec(A)$, $S'=\Spec(A')$; then $X$ is affine with ring $B$ (\cref{scheme integral iff integral algebra on affine}), $X_{(S')}$ is affine with ring $A'\otimes_AB$, and it suffices to note that if $B$ is an integral (resp. finite) $A$-algebra, then $A'\otimes_AB$ is an integral (resp. finite) $A'$-algebra.
\end{proof}
Note also that if $X$ and $Y$ are two integral (resp. finite) $S$-schemes, the sum $X\amalg Y$ is an integral (resp. finite) over $S$, because a product of two integral (resp. finite) $A$-algebras is still integral (resp. finite).
\begin{corollary}\label{scheme integral stable under restriction to affine}
If $X$ is an integral (resp. finite) scheme over $S$, then for any open subset $U\sub S$, $f^{-1}(U)$ is integral (resp. finite) over $U$.
\end{corollary}
\begin{proof}
This is a particular case of \cref{scheme morphism integral finite permanence prop}(\rmnum{3}).
\end{proof}
\begin{corollary}\label{scheme morphism integral fiber finite discrete}
Let $f:X\to Y$ be a finite morphism. Then for any $y\in Y$, the fiber $f^{-1}(y)$ is a finite algebraic scheme over $\kappa(y)$, and a fortiori with discrete and finite underlying space.
\end{corollary}
\begin{proof}
The $\kappa(y)$-scheme $f^{-1}(y)$ is identified with $X\times_Y\Spec(\kappa(y))$, so is finite over $\kappa(y)$ by \cref{scheme morphism integral finite permanence prop}(\rmnum{3}). This is then an affine scheme whose ring is a finite dimensional $\kappa(y)$-algebra, so is Artinian. The proposition then follows from \cref{scheme artinian iff}.
\end{proof}
\begin{corollary}\label{scheme integral finite function field extension}
Let $X$ and $S$ be integral schemes and $f:X\to S$ be a dominant morphism. If $f$ is integral (resp. finite), then the rational function field $K(X)$ of $X$ is an algebraic (resp. finite) extension of $K(S)$. 
\end{corollary}
\begin{proof}
Let $s$ be the generic point of $S$; the $\kappa(s)$-scheme $f^{-1}(s)$ is integral (resp. finite) over $\Spec(\kappa(s))$ by \cref{scheme morphism integral finite permanence prop}(\rmnum{3}), and contains by hypothesis the generic point of $x$ of $X$; the local ring of $f^{-1}(s)$ at $x$, equal to $\kappa(x)$ (\cref{scheme morphism base change by local scheme prop}), is a localization of an integral (resp. finite) algebra over $\kappa(s)$, whence the corollary.  
\end{proof}
\begin{proposition}\label{scheme morphism integral is universally closed}
Any integral morphism is universally closed. 
\end{proposition}
\begin{proof}
Let $f:X\to Y$ be an integral morphism. In view of \cref{scheme morphism integral finite permanence prop}(\rmnum{3}), it suffices to prove that $f$ is closed. Let $Z$ be a closed subset of $X$. In view of \cref{scheme morphism integral finite permanence prop}(\rmnum{6}), we can suppose that $X$ and $Y$ are reduced; moreover, if $T$ is the reduced closed subscheme of $Y$ with underlying space $\widebar{f(X)}$, we see that $f$ factors into
\[f:X\stackrel{g}{\to}T\stackrel{j}{\to}Y,\]
where $j:T\to Y$ is the canonical injection, and as $j$ is separated, it follows from \cref{scheme morphism integral finite permanence prop}(\rmnum{5}) that $g$ is an integral morphism. We can then assume that $f(X)$ is dense in $Y$, and prove that $f(X)=Y$. Since the question is local over $Y$, we can assume that $Y=\Spec(A)$ is affine, so $X=\Spec(B)$ where $B$ is an integral algebra over $A$ (\cref{scheme integral iff integral algebra on affine}); moreover $A$ is reduced and the hypothesis that $f(X)$ is dense in $Y$ implies that the corresponding homomorphism $\varphi:A\to B$ is injective (\cref{Spec of ring map dominant iff ker nilpotent}). The condition that $f(X)=Y$ then follows from \cref{integral prime ideal is contracted}.
\end{proof}
\begin{remark}
The hypothesis that $g$ is separated is essential for the validity of \cref{scheme morphism integral finite permanence prop}(\rmnum{5}): in fact, if $Y$ is not separated over $Z$, the identity $1_Y$ is the composition morphism
\[\begin{tikzcd}
Y\ar[r,"\Delta_Y"]&Y\times_ZY\ar[r,"p_1"]&Y
\end{tikzcd}\]
but $\Delta_Y$ is not integral, since it is not closed (\cref{scheme morphism integral is universally closed}).
\end{remark}
\begin{corollary}\label{scheme morphism finite is projective}
Any finite morphism $f:X\to Y$ is projective.
\end{corollary}
\begin{proof}
As $f$ is affine, $\mathscr{O}_X$ is a very ample $\mathscr{O}_X$-module relative to $f$; moreover $f_*(\mathscr{O}_X)$ is a quasi-coherent $\mathscr{O}_Y$-algebra of finite type by hypothesis. Finally, $f$ is separated, of finite type, and universally closed (\cref{scheme morphism integral is universally closed}), and we then have the conditions of \cref{scheme morphism proper very ample A(X) ft is projective}.
\end{proof}
\begin{lemma}\label{scheme locally free trivialization on finite subset}
Let $Y$ be a scheme, $\mathscr{E}$ be a locally free $\mathscr{O}_Y$-module of rank $r$, and $Z$ be a finite subset of $Y$ contained in an affine open subset $V$. Then there exists an open neighborhood $U\sub V$ of $Z$ such that $\mathscr{E}|_U$ is isomorphic to $\mathscr{O}_Y^r|_U$.
\end{lemma}
\begin{proof}

\end{proof}
\begin{proposition}\label{scheme morphism finite locally free iff direct image}
Let $f:X'\to X$ be a finite morphism, and let $\mathscr{B}=f_*(\mathscr{O}_{X'})$ (which is a quasi-coherent finite $\mathscr{O}_X$-algebra). Let $\mathscr{F}'$ be a quasi-coherent $\mathscr{O}_{X'}$-module; for $\mathscr{F}'$ to be locally free of rank $r$, it is necessary and sufficient that $f_*(\mathscr{F}')$ is a locally free $\mathscr{B}$-module of rank $r$.
\end{proposition}
\begin{proof}
It is clear that if $f_*(\mathscr{F}')|_U$ is isomorphic to $\mathscr{B}^r|_U$ (where $U$ is open in $X$), $\mathscr{F}'|_{f^{-1}(U)}$ is isomorphic to $\mathscr{O}_{X'}^r|_{f^{-1}(U)}$ (\cref{scheme S-affine qcoh isomorphism iff}). Conversely, suppose that $\mathscr{F}'$ is locally free of rank $r$ and we prove that $f_*(\mathscr{F}')$ is locally isomorphic to $\mathscr{B}^r$ as $\mathscr{B}$-modules. Let $x$ be a point of $X$; if $U$ runs through affine neighborhoods of $x$, $f^{-1}(U)$ form a fundamental system of affine neighborhoods (\cref{scheme S-affine preimage of open is affine}) of the finite subset $f^{-1}(x)$, since $f$ is closed (\cref{scheme morphism integral is universally closed}). The proposition then follows from \cref{scheme locally free trivialization on finite subset}.
\end{proof}
\begin{proposition}\label{scheme integral morphism rational map domain}
Let $g:X'\to X$ be an integral morphism of schemes, $Y$ be a locally integral and normal scheme, $f$ be a rational map from $Y$ to $X'$ such that $g\circ f$ is a everywhere defined rational map; then $f$ is everywhere defined.
\end{proposition}
\begin{proof}
Recall that we say a scheme $X$ is normal if it is normal as a ringed space, which means the stalk $\mathscr{O}_{X,x}$ is an integrally closed domain for every $x\in X$. If $f_1$ and $f_2$ are two morphisms (densely defined from $Y$ to $X'$) in the class of $f$, it is clear that $g\circ f_1$ and $g\circ f_2$ are equivalent morphisms, which justifies the notation $g\circ f$ for their equivalent class. We recall also that if $Y$ is locally Noetherian, then the hypothesis on $Y$ implies that $Y$ is locally integral (\cref{scheme local Noe reduced integral stalk lift}).\par
To prove the proposition, we first note that the question is local over $Y$ and we can assume that there exists a morphism $h:Y\to X$ in the class of $g\circ f$. Consider the inverse image $Y'=X'_{(h)}=X'_{(Y)}$, and note that the morphism $g'=g_{(Y)}:Y'\to Y$ is integral by \cref{scheme morphism integral finite permanence prop}(\rmnum{3}). Via the correspondence of rational maps from $Y$ to $X'$ with rational $Y$-sections of $Y'$, we see that we are reduced to the case $X=Y$.
\end{proof}
\begin{corollary}
Let $X$ be a locally integral and normal scheme, $g:X'\to X$ be an integral morphism, and $f$ be a rational $X$-section of $X'$. Then $f$ is everywhere defined.
\end{corollary}
\begin{corollary}
Let $X$ be a normal and integral scheme, $X'$ be an integral scheme, and $g:X'\to X$ be an integral morphism. If there exists a rational $X$-section $f$ of $X'$, $g$ is an isomorphism.
\end{corollary}
\subsection{Quasi-finite morphisms}
\begin{proposition}\label{scheme morphism local ft isolated in fiber iff}
Let $f:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$ and $y=f(x)$. The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] The point $x$ is isolated in the fiber $X_y$. 
\item[(\rmnum{2})] The point $x$ is closed in $X_y$ and there is no generalization of $x$ in $X_y$.
\item[(\rmnum{3})] The $\mathscr{O}_{Y,y}$-module $\mathscr{O}_{X,x}$ is quasi-finite.
\end{enumerate}
\end{proposition}
\begin{proof}
The question is local over $X$ and $Y$, so we can suppose that $X=\Spec(B)$ and $Y=\Spec(A)$ are affine, where $B$ is finite $A$-algebra. Moreover, replacing $X$ by $X\times_Y\Spec(\mathscr{O}_{Y,y})$ does not change the fiber $X_y$ and the local ring $\mathscr{O}_{X,x}$ (\cref{scheme morphism base change by local scheme prop}), so we can suppose that $A$ is a local ring with maximal ideal $\m$ (which equals to the local ring $\mathscr{O}_{Y,y}$). The fiber $X_y$ is then the affine sheme of the ring $B/\m B$, of finite type over $\kappa(y)=A/\m$ (\cref{scheme morphism ft fiber algebraic}). Let $\mathfrak{P}$ be the prime ideal of $B$ corresponding to $x$.\par
We note that the fiber $X_y=X\times_Y\Spec(\kappa(y))=\Spec(B\otimes_A\kappa(y))$ is Jacobson. If (\rmnum{1}) is satisfied, then $\{x\}$ is an open subset of $X_y$, hence contains a closed point (by the Jacobson property) which must be $x$, and $x$ is therefore closed in $X_y$. Also, since $\{x\}$ is open in $X_y$, it is clear that there is no further generalization $x'$ of $x$ (which means $x\in\widebar{\{x'\}}$) in $X_y$; this proves (\rmnum{1})$\Rightarrow$(\rmnum{2}).\par
We now consider the conditions in (\rmnum{2}) and (\rmnum{3}). Consider the ring $\widebar{B}=B\otimes_A\kappa(y)=B/\m B$ and let $\widebar{\mathfrak{P}}$ be the prime ideal corresponding to $\mathfrak{P}$. If $x$ is closed in $X_y$, we see that $\widebar{\mathfrak{P}}$ is maximal in $\widebar{B}$ and by condition (\rmnum{2}) there is no prime ideal of $\widebar{B}$ contained in $\widebar{\mathfrak{P}}$. This shows that $\widebar{B}_{\widebar{\mathfrak{P}}}$ is Artinian, so we conclude that the ring homomorphism $A\to B$ is quasi-finite at $\mathfrak{P}$; that is, the $\mathscr{O}_{Y,y}$-module $\mathscr{O}_{X,x}$ is quasi-finite. Conversely, if $\widebar{B}_{\widebar{\mathfrak{P}}}$ is Artinian, then $\widebar{\mathfrak{P}}$ is maximal and there is no prime ideal of $\widebar{B}$ contained in $\widebar{\mathfrak{P}}$; we then conclude that $x$ is closed in $X_y$ and there is no generalization of $x$ in $X_y$. This shows that (\rmnum{2})$\Leftrightarrow$(\rmnum{3}).\par
We finally prove that (\rmnum{2}) implies (\rmnum{1}). If (\rmnum{2}) is satisfied, then the prime ideal $\mathfrak{P}$ is both maximal and minimal in $B$ since $\widebar{B}_{\widebar{\mathfrak{P}}}$ is Artinian. Let $\widebar{\mathfrak{P}}_1=\widebar{\mathfrak{P}},\widebar{\mathfrak{P}}_2,\dots,\widebar{\mathfrak{P}}_r$ be the minimal prime ideals of $\widebar{B}$. Then the intersection $\bigcap_{i=1}^{r}\widebar{\mathfrak{P}}_i$ is equal to the nilradical of $\widebar{B}$, and $\bigcap_{i=2}^{r}\widebar{\mathfrak{P}}_i$ is contained in this intersection in view of \cref{prime ideal contain intersection}, so there exists an element $\bar{b}\in\bigcap_{i=2}^{r}\widebar{\mathfrak{P}}_i$ that is not nilpotent. The open subset $D_{\widebar{B}}(\bar{b})$ of $X_y=\Spec(\widebar{B})$ then reduces to $\{x\}$, which shows that $x$ is isolated.
\end{proof}
\begin{corollary}\label{scheme morphism ft quasi-finite iff fiber discrete}
Let $f:X\to Y$ be a morphism of finite type. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] Any point $x\in X$ is isolated in the fiber $X_{f(x)}$ (that is, $X_{f(x)}$ is discrete).
\item[(\rmnum{2})] For any $x\in X$, $X_{f(x)}$ is a finite $\kappa(f(x))$-scheme.
\item[(\rmnum{3})] For any $x\in X$, the $\mathscr{O}_{Y,y}$-module $\mathscr{O}_{X,x}$ is quasi-finite.
\end{enumerate}
\end{corollary}
\begin{proof}
The equivalence of (\rmnum{1}) and (\rmnum{3}) follows from \cref{scheme morphism local ft isolated in fiber iff}. On the other hand, as $X_{f(x)}$ is an algebraic $\kappa(f(x))$-scheme, the equivalence of (\rmnum{1}) and (\rmnum{2}) follows from \cref{scheme algebraic Artinian iff}.
\end{proof}
We say a morphism $f:X\to Y$ of finite type is \textbf{quasi-finite}, or $X$ is \textbf{quasi-finite} over $Y$, if it satisfies the equivalent conditions of \cref{scheme morphism ft quasi-finite iff fiber discrete}. We say a morphism $f:X\to Y$ is quasi-finite at a point $x\in X$ if there exists an affine open neighborhood $V$ of $y=f(x)$ and an affine open neighborhood $U$ of $x$ such that $f(U)\sub V$ and the restriction $f|_U:U\to V$ is quasi-finite. We say that $f:X\to Y$ is locally quasi-finite if it is quasi-finite at every point of $X$. From \cref{scheme morphism integral fiber finite discrete}, it is clear that any finite morphism is quasi-finite.
\begin{proposition}[\textbf{Properties of Quasi-finite Morphisms}]\label{scheme morphism quasi-finite permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] Any quasi-compact immersion (in particular any closed immersion) is quasi-finite.
\item[(\rmnum{2})] If $f:X\to Y$ and $g:Y\to Z$ are quasi-finite morphisms, $g\circ f$ is quasi-finite.
\item[(\rmnum{3})] If $f:X\to Y$ is a quasi-finite $S$-morphism, $f_{(S')}:X_{(S')}\to Y_{(S')}$ is quasi-finite for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to Y$ and $g:X'\to Y'$ are quasi-finite $S$-morphisms, $f\times_Sg$ is quasi-finite.
\item[(\rmnum{5})] Let $f:X\to Y$ and $g:Y\to Z$ be two morphisms such that $g\circ f$ is quasi-finite; if $g$ is separated, or $X$ is Noetherian, or $X\times_ZY$ is locally Noetherian, then $f$ is quasi-finite.
\item[(\rmnum{6})] If $f$ is quasi-finite, so is $f_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
If $f:X\to Y$ is an immersion, any fiber is reduced to a singleton, so (\rmnum{1}) follows from \cref{scheme morphism ft permanence prop}(\rmnum{1}). For (\rmnum{2}), we note that $h=g\circ f$ is of finite type by \cref{scheme morphism ft permanence prop}(\rmnum{2}); if $z=h(x)$ and $y=f(x)$, $y$ is isolated in $g^{-1}(z)$, so there exists an open neighborhood $V$ of $y$ in $Y$ not containing other points of $g^{-1}(z)$; $f^{-1}(V)$ is then an open neighborhood of $x$ not containing other points of $f^{-1}(y')$, where $y'\neq y$ is in $g^{-1}(z)$, and therefore not containing points $x'\neq x$ in $h^{-1}(z)$ that is not in $f^{-1}(y)$. As $x$ is isolated in $f^{-1}(y)$ by hypothesis, it is then isolated in $h^{-1}(z)=f^{-1}(g^{-1}(z))$. As for (\rmnum{3}), we can limit ourselves to the case where $Y=S$ (\cref{scheme base change base morphism prop}); we first note that $f'=f_{(S')}$ is of finite type (\cref{scheme morphism ft permanence prop}(\rmnum{3})). On the other hand, if $x'\in X'=X_{(S')}$ and $y'=f'(x')$, $X'_{y'}$ is identified with $X_y\otimes_{\kappa(y)}\kappa(y')$ by \cref{scheme fiber transitivity}. As $X_y$ is of finite dimension over $\kappa(y)$ by hypothesis, $X'_{y'}$ is of finite dimension over $\kappa(y')$, hence discrete. The assertions (\rmnum{4}), (\rmnum{5}), (\rmnum{6}) then follows from the first three assertions in view of the general principle \cref{scheme morphism cancelled by separated if}, where in (\rmnum{5}) we assume that $g$ is separated. The other cases, we first remark that if $x$ is isolated in $X_{g(f(x))}$, it is also isolated in $X_{f(x)}$; the fact that $f$ is of finite type follows from \cref{scheme morphism ft permanence prop}.
\end{proof}
\begin{proposition}\label{scheme local ft over complete Noe locla sum}
Let $A$ be a complete Noetherian local ring, $Y=\Spec(A)$, $X$ be a separated $Y$-scheme locally of finite type, $x$ be a point over the closed point $y$ of $Y$, and suppose that $x$ is isolated in the fiber $X_y$. Then $\mathscr{O}_{X,x}$ is a finitely generated $A$-module and $X$ is $Y$-isomorphic to the sum of $X'=\Spec(\mathscr{O}_{X,x})$ (which is a finite $Y$-scheme) and an $A$-scheme $X''$.
\end{proposition}
\begin{proof}
It follows from \cref{scheme morphism local ft isolated in fiber iff} that $\mathscr{O}_{X,x}$ is a quasi-finite $A$-module. As $\mathscr{O}_{X,x}$ is Noetherian (\cref{scheme local Noe local ft iff fp}) and the homomorphism $A\to\mathscr{O}_{X,x}$ is local, the hypothesis that $A$ is complete implies that $\mathscr{O}_{X,x}$ is a finitely generated $A$-module (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 7.4.3). Let $X'=\Spec(\mathscr{O}_{X,x})$ be the local scheme of $X$ at $x$ and $g:X'\to X$ be the canonical morphism. The composition $f\circ g:X'\to Y$ is then finite, and since $f$ is separated, $g$ is finite by \cref{scheme morphism integral finite permanence prop}, so $g(X')$ is closed in $X$ (\cref{scheme morphism finite is projective}). On the other hand, as $g$ is of finite type and $A$ is Noetherian, it is of finite presentation, and hence a local immersion at the closed point $x'$ of $X'$ (\cref{scheme morphism local ft fp local immersion iso iff} and the definition of $g$). But $X'$ is the only open neighborhood of $x'$ in $X'$, so it follows that $g(X')$ is open in $X$, which proves our assertion.
\end{proof}
\begin{corollary}\label{scheme qf sp over complete Noe locla sum}
Let $A$ be a complete Noetherian local ring, $Y=\Spec(A)$, $f:X\to Y$ be a quasi-finite and separted morphism. Then $X$ is $Y$-isomorphic to a sum $X'\amalg X''$, where $X'$ is a finite $Y$-scheme and $X''$ is a quasi-finite $Y$-scheme such that, if $y$ is the closed point of $y$, $X''\cap f^{-1}(y)\neq\emp$.
\end{corollary}
\begin{proof}
The fiber $f^{-1}(y)$ is finite and discrete by hypothesis, and the corollary then follows by recurrence on the number of points of $f^{-1}(y)$, using \cref{scheme local ft over complete Noe locla sum}.
\end{proof}
\subsection{Integral closure of a scheme}
\begin{proposition}\label{ringed space section of alg integral iff}
Let $(X,\mathscr{A})$ be a ringed space, $\mathscr{B}$ be an $\mathscr{A}$-algebra, and $f$ be a section of $\mathscr{B}$ over $X$. The following properties are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] The sub-$\mathscr{A}$-algebra of $\mathscr{B}$ generated by $f$ is finite (that is, of finite type as an $\mathscr{A}$-module).
\item[(\rmnum{2})] There exists a sub-$\mathscr{A}$-algebra $\mathscr{C}$ of $\mathscr{B}$, which is an $\mathscr{A}$-module of finite type, such that $f\in\Gamma(X,\mathscr{C})$. 
\item[(\rmnum{3})] For any $x\in X$, $f_x$ is integral over the fiber $\mathscr{A}_x$.
\end{enumerate}
If these equivalent conditions are satisfied, the section $f$ is said to be \textbf{integral} over $\mathscr{A}$.
\end{proposition}
\begin{proof}
As the sub-$\mathscr{A}$-module of $\mathscr{B}$ genearted by $f^n$ is an $\mathscr{A}$-algebra, it is clear that (\rmnum{1}) implies (\rmnum{2}). On the other hand, (\rmnum{2}) implies that for any $x\in X$, the $\mathscr{A}_x$-module $\mathscr{C}_x$ is of finite type, which implies that any element of the algebra $\mathscr{C}_x$, and in particular $f_x$, is integral over $\mathscr{A}_x$. Finally, if for any point $x\in X$, we have a relation
\[f_x^n+(a_1)_xf_x^{n-1}+\cdots+(a_n)_x=0\]
where $a_i$ are sections of $\mathscr{A}$ over an open neighborhood $U$ of $x$, the section $f^n|_U+a_1\cdot f^{n-1}|_U+\cdots+a_n$ is zero over an open neighborhood $V\sub U$ of $x$, so $f^k|_V$ (for $k\geq 0$) is a linear combination over $\Gamma(V,\mathscr{A})$ of $f^j|_V$ with $0\leq j\leq n-1$. We then conclude that (\rmnum{3}) implies (\rmnum{1}). 
\end{proof}
\begin{corollary}\label{ringed space algebra integral closure exist}
Under the hypothesis of \cref{ringed space section of alg integral iff}, there exists a (unique) sub-$\mathscr{A}$-algebra $\mathscr{A}'$ of $\mathscr{B}$ such that for any $x\in X$, $\mathscr{A}'_x$ is the set of germs $f_x\in\mathscr{B}_x$ that is integral over $\mathscr{A}_x$. For any open subset $U\sub X$, the sections of $\mathscr{A}'$ over $U$ is the sections of $\Gamma(U,\mathscr{B})$ that is integral over $\mathscr{A}|_U$. We say that $\mathscr{A}'$ is the \textbf{integral closure} of $\mathscr{A}$ in $\mathscr{B}$.
\end{corollary}
\begin{proof}
The existence of $\mathscr{A}'$ is immediate, by setting $\Gamma(U,\mathscr{A}')$ to be the set of $f\in\Gamma(U,\mathscr{B})$ such that $f_x$ is integral over $\mathscr{A}_x$ for any $x\in U$. It is clear that $\mathscr{A}'$ is an algebra, and the second assertion follows from \cref{ringed space section of alg integral iff}. 
\end{proof}
Let $(X,\mathscr{A})$, $(Y,\mathscr{B})$ be two ringed space and $f:X\to Y$ be a morphism. Let $\mathscr{C}$ (resp. $\mathscr{D}$) be an $\mathscr{A}$-algebra (resp. $\mathscr{B}$-algebra) and let $u:\mathscr{D}\to\mathscr{C}$ be a $f$-morphism. Then, if $\mathscr{A}'$ (resp. $\mathscr{B}'$) is the integral closure of $\mathscr{A}$ (resp. $\mathscr{B}$) in $\mathscr{C}$ (resp. $\mathscr{D}$), the restriction of $u$ to $\mathscr{B}'$ is then a $f$-morphism $u':\mathscr{B}'\to\mathscr{A}'$. In fact, if $j$ is the canonical injection $\mathscr{B}'\to\mathscr{D}$, it suffices to show that
\[v=u^{\sharp}\circ f^*(j):f^*(\mathscr{B}')\to\mathscr{C}'\]
maps $f^*(\mathscr{B}')$ into $\mathscr{A}'$. Now an element of $(f^*(\mathscr{B}'))_x=\mathscr{B}'_{f(x)}\otimes_{\mathscr{B}_{(f(x))}}\mathscr{A}_x$ is integral over $\mathscr{A}_x$ by the definition of $\mathscr{B}'$, and hence so is its image under $v_x$, which proves our assertion.
\begin{proposition}\label{scheme integral closure in qcoh alg over affine char}
Let $X$ be a scheme and $\mathscr{A}$ be a quasi-coherent $\mathscr{O}_X$-algebra. The integral closure $\mathscr{O}'_X$ of $\mathscr{O}_X$ in $\mathscr{A}$ is then a quasi-coherent $\mathscr{O}_X$-algebra, and for any affine open $U$ of $X$, $\Gamma(X,\mathscr{O}'_X)$ is the integral closure of $\Gamma(U,\mathscr{O}_X)$ in $\Gamma(U,\mathscr{A})$.
\end{proposition}
\begin{proof}
We can assume that $X=\Spec(B)$ is affine and $\mathscr{A}=\widetilde{A}$, where $A$ is an $B$-algebra. Let $B'$ be the integral closure of $B$ in $A$. It then boils down to seeing that for any $x\in X$, an element of $A_x$, integer over $B_x$, necessarily belongs to $B'_x$, which follows from the fact that taking integral closure commutes with localization (\cref{integral closure and localization}).
\end{proof}
Under the hypothesis of \cref{scheme integral closure in qcoh alg over affine char}, the $X$-scheme $X'=\Spec(\mathscr{O}_X')$ is then called the \textbf{integral closure of $\bm{X}$ relative to $\mathscr{A}$}. We also deduce from \cref{scheme integral closure in qcoh alg over affine char} that if $f:X'\to X$ is the structural morphism, then for any open subset $U$ of $X$, $f^{-1}(U)$ is the integral closure of the induced subscheme $U$ by $X$, relative to $\mathscr{A}|_U$. In particular, we conclude that $f$ is integral.\par
Let $X$ and $Y$ be schemes, $f:X\to Y$ be a morphism, $\mathscr{A}$ (resp. $\mathscr{B}$) be a quasi-coherent $\mathscr{O}_X$-algebra (resp. a $\mathscr{O}_Y$-algebra), and $u:\mathscr{B}\to\mathscr{A}$ be an $f$-morphism. We have seen that we have an induced $f$-morphism $u':\mathscr{O}_Y'\to\mathscr{O}_X'$, where $\mathscr{O}_X'$ (resp. $\mathscr{O}_Y'$) is the integral closure of $\mathscr{O}_X$ (resp. $\mathscr{O}_Y$) relative to $\mathscr{A}$ (resp. $\mathscr{B}$), we deduce a canonical morphism $f':\Spec(u'):X'\to Y'$ (\cref{scheme qcoh algebra spec universal property}) fitting into the following commutative diagram
\begin{equation}\label{scheme integral closure induced morphism}
\begin{tikzcd}
X'\ar[r,"f'"]\ar[d]&Y'\ar[d]\\
X\ar[r,"f"]&Y
\end{tikzcd}
\end{equation}

Suppose that $X$ has only finitely many irreducible components $(X_i)_{1\leq i\leq r}$, with generic points $(\xi_i)_{1\leq i\leq r}$, and consider in particular the integral closure of $X$ relative to a quasi-coherent $\mathscr{K}_X$-algebra $\mathscr{A}$. By \cref{scheme reduced rational sheaf direct product} and \cref{scheme irreducible qcoh K(X) module simple}, $\mathscr{A}$ is the direct product of $r$ quasi-coherent $\mathscr{O}_X$-algebras $\mathscr{A}_i$, the support of $\mathscr{A}_i$ being contained in $X_i$, and the induced sheaf of $\mathscr{A}_i$ over $X_i$ is the constant sheaf whose fiber $A_i$ is an algebra over $\mathscr{O}_{X,\xi_i}$. It is clear that the integral closure $\mathscr{O}_X'$ of $\mathscr{O}_X$ is the direct product of the integral closures $\mathscr{O}_X^{(i)}$ of $\mathscr{O}_X$ in each $\mathscr{A}_i$, and therefore the integral closure $X'=\Spec(\mathscr{O}_X')$ of $X$ relative to $\mathscr{A}$ is an $X$-scheme which is the sum of $\Spec(\mathscr{O}_X^{(i)})=X'_i$.\par
Now suppose that the $\mathscr{O}_X$-algebra $\mathscr{A}$ is reduced, or equivalently, each algebra $A_i$ is reduced, and therefore can be considered as an algebra over the field $\kappa(\xi_i)$ (equal to the rational function field of the reduced subscheme $X_i$ of $X$); then the $X'_i$ is a reduced $X$-scheme and $X'$ is also the integral closure of $X_{\red}$. Suppose moreover that the algebras $A_i$ is a direct product of finitely many field $K_{ij}$ ($1\leq j\leq s_i$); if $\mathscr{K}_{ij}$ is the subalgebra of $\mathscr{A}_i$ corresponding to $K_{ij}$, it is clear that $\mathscr{O}_X^{(i)}$ is the direct product of integral closures $\mathscr{O}_{X}^{(ij)}$ of $\mathscr{O}_X$ in $\mathscr{K}_{ij}$. Therefore, $X_i'$ is the sum of $X'_{ij}=\Spec(\mathscr{O}_{X}^{(ij)})$. Moreover, under this hypothesis, we have the following:
\begin{proposition}\label{scheme integral closure fraction field char}
Each $X'_{ij}$ is an integral and normal $X$-scheme, and its rational function field $K(X'_{ij})$ is canonically identified with the algebraic closure $K'_{ij}$ of $\kappa(\xi_i)$ in $K_{ij}$. 
\end{proposition}
\begin{proof}
In view of the preceding remarks, we can assume that $X$ is integral, so $r=1$, $s_1=1$, so that the unique algebra $A_1$ is a field $K$; let $\xi$ be the generic point of $X$, and let $f:X'\to X$ be the structural morphism. For any nonempty affine open $U$ of $X$, $f^{-1}(U)$ is identified with the integral closure $B'_U$ in the field $K$ of the intagral ring $B_U=\Gamma(U,\mathscr{O}_X)$ (\cref{scheme integral closure in qcoh alg over affine char}); as the ring $B'_U$ is integrally closed, so is its localizations, and $f^{-1}(U)$ is by definition an integral and normal scheme. Moreover, as $(0)$ is the unique prime ideal of $B'_U$ lying over the prime ideal $(0)$ of $B_U$, $f^{-1}(\xi)$ is reduced to a singleton $\xi'$, and $\kappa(\xi')$ is the fraction field $K'$ of $B_U'$, which is none other than the algebraic closure of $\kappa(\xi)$ in $K$. Finally, $X'$ is irreducible, because if $U$ runs through the nonempty affine open subsets of $X$, the $f^{-1}(U)$ constitute an open covering of $X'$ formed by irreducible open subsets; moreover the intersection $f^{-1}(U\cap V)$ two two opens contains $\xi'$, hence nonempty, and we conclude from \cref{topo space open cover of irreducible is irreducible if} that $X'$ is irreducible.
\end{proof}
\begin{corollary}\label{scheme normalization generic point prop}
Let $X$ be a reduced scheme with finitely many irreducible components $(X_i)$, and let $\xi_i$ be the generic point of $X_i$. The integral closure $X'$ of $X$ relative to $\mathscr{K}_X$ is the sum of $r$ separated $X$-schemes $X'_i$ which are integral and normal. If $f:X'\to X$ is the structural morphism, $f^{-1}(\xi_i)$ is reduced to the generic point $\xi'_i$ of $X'_i$ and we have $\kappa(\xi'_i)=\kappa(\xi_i)$, which means $f$ is birational.
\end{corollary}
\begin{proof}
This is a particular case of \cref{scheme integral closure fraction field char} by taking $K'_{ij}=\kappa(\xi_i)$. The rational function field of $X'_i$ (which is $\kappa(\xi'_i)$) is then equal to $\kappa(\xi_i)$, whence our claim.
\end{proof}
The integral closure $X'$ of $X$ relative to $\mathscr{K}_X$ is called that \textbf{normalization} of the reduced scheme $X$. We note that the morphism $f:X'\to X$, being birational and integral, is closed by \cref{scheme morphism integral is universally closed}, hence surjective (recall that a birational morphism is dominant). For $X'=X$, it is necessary and sufficient that $X$ is normal. If $X$ is an integral scheme, it follows from \cref{scheme normalization generic point prop} that its normalization $X'$ is integral.\par
Let $X,Y$ be integral schemes, $f:X\to Y$ be a dominant morphism, $L=K(X)$, $K=K(Y)$ be the rational function field of $X$ and $Y$. The morphism $f$ corresponds to an injection $K\to L$, and if we identify $K$ (resp. $L$) with the simple sheaf $\mathscr{K}_Y$ (resp. $\mathscr{K}_X$), this injection is an $f$-morphism. Let $K_1$ (resp. $L_1$) be an extension of $K$ (resp. $L$) and suppose that we are given a monomorphism $K_1\to L_1$ such that the diagram
\[\begin{tikzcd}
K_1\ar[r]&L_1\\
K\ar[u]\ar[r]&L\ar[u]
\end{tikzcd}\] 
is commutative; if $K_1$ (resp. $L_1$) is considered as a simple sheaf over $Y$ (resp. $X$), hence a $\mathscr{K}_Y$-algebra (resp. a $\mathscr{K}_X$-algebra), this signifies that $K_1\to L_1$ is an $f$-morphism. Now if $X'$ (resp. $Y'$) is the integral closure of $X$ (resp. $Y$) relative to $L_1$ (resp. $K_1$), $X'$ (resp. $Y'$) is a normal and integral scheme (\cref{scheme integral closure fraction field char}) and its rational function field is canonically identified with the algebraic closure $L'$ (resp. $K'$) of $L$ (resp. $K$) in $L_1$ (resp. $K_1$), and there exists a canonical morphism (necessarily dominant) $f':X'\to Y'$ rendering the diagram (\ref{scheme integral closure induced morphism}). The important case is that $L_1=L$, $K_1$ is an extension of $K$ contained in $L$, and where we suppose that $X$ is integral and normal, hence $X'=X$.\par
The preceding arguments then show that if $X$ is a normal scheme and $Y'$ is integrally closure of $Y$ relative to a field $K_1\sub L=K(X)$, any dominant morphism $f:X\to Y$ factors into
\[f:X\stackrel{f'}{\to}Y'\to Y\]
where $f'$ is dominant; if the monomorphism $K_1\to L$ is fixed, $f'$ is necessarily unique (this can be verified when $X$ and $Y$ are both affine). We then say that given $Y$, $L$, and a $K$-monomorphism $K_1\to L$, the integral closure $Y'$ of $Y$ relative to $K_1$ is a universal object.
\begin{remark}\label{scheme normalization finite if Japanese}
Retain the hypothesis of \cref{scheme integral closure fraction field char} and suppose moreover that each algebra $A_i$ is of finite dimension over $\kappa(\xi_i)$ (which implies that $A_i$ is a direct product of finitely many fields); we can prove that the structural morphism $X'\to X$ is finite. For this, we can reduce to the case where $X$ is reduced and affine with ring $C$, and that $C$ has finitely many minimal prime ideals $\p_i$ ($1\leq i\leq r$) with $C_i=C/\p_i$. Then by \cref{scheme integral closure in qcoh alg over affine char} $X'$ is finite over $X$ if the integral closure of each $C_i$ in finite extension of its fraction field is a finitely generated $C$-module, or equivalently, if $C_i$ is Japanese for each $i$. We know that this condition is true if $C$ is an algebra of finite type over a field, or over $\Z$, or over a complete Noetherian local ring. We then conclude that $X'\to X$ is a finite morphism if $X$ is a scheme of finite type over a field, or over $\Z$, or over a complete Noetherian local ring.
\end{remark}
\subsection{Determinant of an endomorphism of \texorpdfstring{$\mathscr{O}_X$}{OX}-modules}
Let $A$ be a ring, $E$ be a free $A$-module of rank $n$, and $u:E\to E$ be an endomorphism of $E$; recall that in order to define the characteristic polynomial of $u$, we consider the endomorphism $u\otimes 1$ of free the $A[T]$-module $E\otimes_AA[T]$ (which is of rank $n$), and we put
\[P(u,T)=\det(T\cdot I-(u\otimes 1))\]
($I$ is the identity morphism on $E\otimes_AA[T]$). We have 
\[P(u,T)=T^n-\sigma_1(u)T^{n-1}+\cdots+(-1)^n\sigma_n(u)\]
where $\sigma_i(u)$ is an element of $A$, equal to a homogeneous polynomial of degree $i$ (with integer coefficients) with entries the elements of the matrix of $u$ relative to any basis of $E$. We say that the $\sigma_i(u)$ are the \textbf{elementray symmetric functions} of $u$, and we have in particular $\sigma_1(u)=\tr(u)$ and $\sigma_n(u)=\det(u)$. By Hamilton-Cayley theorem, we have
\begin{align}\label{sheaf of module Hamilton-Cayley equation-1}
P(u,u)=u^n-\sigma_1(u)u^{n-1}+\cdots+(-1)^n\sigma_n(u)=0
\end{align}
which can also be written as
\begin{align}\label{sheaf of module Hamilton-Cayley equation-2}
(\det(u))\cdot 1_E=uQ(u)
\end{align}
($1_E$ is the identity morphism on $E$), where
\begin{align}\label{sheaf of module Hamilton-Cayley equation-3}
Q(u)=(-1)^{n+1}(u^{n-1}-\sigma_1(u)u^{n-2}+\cdots+(-1)^{n-1}\sigma_{n-1}(u))
\end{align}

Let $\varphi:A\to B$ be a homomorphism of rings; consider the $B$-module $E_{(B)}=E\otimes_AB$ which is free of rank $n$, and the extension $u\otimes 1$ of $u$ to an endomorphism on $E_{(B)}$. It is immediate that we have $\sigma_i(u\otimes 1)=\varphi(\sigma_i(u))$ for all $i$.\par
Suppose now that $A$ is an integral domain, with fraction field $K$, and $E$ is a finitely generated $A$-module (not necessarily free now). Let $n$ be the rank of $E$, which equals to the dimension of $E\otimes_AK$ over $K$. Any endomorphism $u$ of $E$ corresponds canonically to the endomorphism $u\otimes 1$ of $E\otimes_AK$. By abuse of language, we call $P(u\otimes 1,T)$ the characteristic polynomial of $u$ and denoted by $P(u,T)$, and the coefficients $\sigma_i(u\otimes 1)$ is called the elementray symmetric functions of $u$ and denoted by $\sigma_i(u)$. In particular the determinant $\det(u)=\det(u\otimes 1)$ is defiend. With these notations, the formulas (\ref{sheaf of module Hamilton-Cayley equation-1}) and (\ref{sheaf of module Hamilton-Cayley equation-2}) are meaningful and still valid, if we interpret the $u^i$ as the homomorphism $E\to E\otimes_AK$ whici is the composition of the endomorphism $u^j\otimes 1=(u\otimes 1)^j$ of $E\otimes_AK$ and the canonical homomorphism $x\mapsto x\otimes 1$.\par
If $F$ is the torsion module of $R$ and $E_0=E/F$, we have $u(F)\sub F$, hence, by taking quotient, $u$ induces an endomorphism $u_0$ of $E_0$; moreover $E\otimes_AK$ is identified with $E_0\otimes_AK$ and $u\otimes 1$ is identified with $u_0\otimes 1$, hence $\sigma_i(u)=\sigma_i(u_0)$ for $1\leq i\leq n$.\par
If $E$ is torsion-free, $E$ is identified with a sub-$A$-module of $E\otimes_AK$, and the relation $u\otimes 1=0$ is equivalent to $u=0$. If $E$ is a free $A$-module, the two definitions of $\sigma_i(u)$ given above coincide according to the preceding remarks, which justifies the notations adopted. We also note that if $E$ is a torsion module then $E_0=\{0\}$, the exterior algebra of $E_0$ is reduced to $K$ and the determinant of the endomorphism $u_0$ of $E_0$ is equal to $1$.
\begin{proposition}\label{module endo symmetric function integral}
Let $A$ be an integral domain, $E$ be a finitely generated $A$-module, $u$ be an endomorphism of $u$. Then the elementray symmetric functions $\sigma_i(u)$ of $u$ (and in particular $\det(u)$) are integral elements of $K$ over $A$.
\end{proposition}
\begin{proof}
This is a particular case of \cref{integral squre matrix iff}, where we set $B=K$ and note that condition (\rmnum{2}) is satisfied for $M=E$.
\end{proof}
\begin{corollary}
Under the hypothesis of \cref{module endo symmetric function integral}, if $A$ is normal, the $\sigma_i(u)$ belong to $A$.
\end{corollary}
\begin{proposition}\label{module endo invertible iff det}
Let $A$ be an integral domain, $E$ be a finitely generated $A$-module, of rank $n$, and $u$ be an endomorphism of $E$ such that the $\sigma_i(u)$ belong to $A$ for each $i$. For $u$ to be an automorphism of $E$, it is necessary that $\det(u)$ is invertible in $A$; this condition is sufficient if $E$ is torsion free.
\end{proposition}
\begin{proof}
This conditions is sufficient by (\ref{sheaf of module Hamilton-Cayley equation-2}) and (\ref{sheaf of module Hamilton-Cayley equation-3}), if $E$ is torsion free, since $E$ is then a sub-$A$-module of $E\otimes_AK$, and $(\det(u))^{-1}Q(u)$ is the inverse of $u$. Conversely, this is necessary, because if $u$ is invertible, it follows from \cref{module endo symmetric function integral} that $\det(u^{-1})$ belongs to the integral closure $A'$ of $A$ in $K$, and is clearly the inverse of $\det(u)$ in $A'$. If $\det(u)$ is not invertible in $A$, then it belongs to a maximal ideal $\m$ of $A$, which is the contraction of a maximal ideal of $A'$ (\cref{integral prime ideal is contracted}), contradiction.
\end{proof}
We note a generalization of the preceding results. Consider a reduced Noetherian ring $A$ and let $\p_i$ ($1\leq i\leq r$) be the minimal prime ideals of $A$, and $K_i$ be the fractional field of $A_i=A/\p_i$. Then the total fraction field $K$ of $A$ is the direct product of the fields $K_i$ (\cref{Noe ring minimal prime and Ass localization prop}). Let $E$ be a finitely generated $A$-module, and suppose that $E\otimes_AK$ is a $K$-module of dimension $n$. Then each $K_i$-vector space $E_i=E\otimes_AK_i$ is of dimension $n$. If $u$ is an endomorphism of $E$, we put $P(u,T)=P(u\otimes 1,T)$ and $\sigma_j(u)=\sigma_j(u\otimes 1)$, and in particular $\det(u)=\det(u\otimes 1)$; the $\sigma_j(u)$ are then elements of $K$. It is immediate that $E\otimes_AK$ is a direct sum of $E_i$ and each of them is stable under $u\otimes 1$. The restriction of $u\otimes 1$ to $E_i$ is just the extension of $u$ to $E_i$, and we conclude that $\sigma_j(u)$ is the element of $K$ with component in $K_i$ being $\sigma_j(u_i)$. As the integral closure of $A$ in $K$ is the direct product of that of $A$ in $K_i$ (\cref{integral closure of product of ring}), the $\sigma_j(u)$ are integral over $A$.
\begin{lemma}
The sub-$A$-algebra of $K$ genrated by the elements $\sigma_j(u)$ ($1\leq j\leq n$) for $u\in\Hom_A(E,E)$, is a finitely generated $A$-module.
\end{lemma}
Let $(X,\mathscr{A})$ be a ringed space, $\mathscr{E}$ be a locally free $\mathscr{A}$-module (of finite rank). There is then by hypothesis a basis $\mathfrak{B}$ of $X$ such that for any $V\in\mathfrak{B}$, $\mathscr{E}|_V$ is isomorphic to $\mathscr{A}^n|_V$ (the integer $n$ may vary with $V$). Let $u$ be an endomorphism of $\mathscr{E}$; for any $V\in\mathfrak{B}$, $u_V$ is then an endomorphism of the $\Gamma(V,\mathscr{A})$-module $\Gamma(V,\mathscr{E})$, which is free by hypothesis; the determinant of $u_V$ is then defined and belongs to $\Gamma(V,\mathscr{A})$. Moreover, if $e_1,\dots,e_n$ is a basis of $\Gamma(V,\mathscr{E})$, their restriction to any open subset $W\sub V$ form a basis of $\Gamma(W,\mathscr{E})$ over $\Gamma(W,\mathscr{A})$, so $\det(u_W)$ is the restriction of $\det(u_V)$ to $W$. There then exists a unique section of $\mathscr{A}$ over $X$, which we denote by $\det(u)$ and call the \textbf{determinant} of $u$, such that the restriction of $\det(u)$ to any $V\in\mathfrak{B}$ is $\det(u_V)$. It is clear that for any $x\in X$, we have $\det(u)_x=\det(u_x)$; for two endomorphisms $u,v$ of $\mathscr{E}$, we have
\[\det(u\circ v)=(\det(u))(\det(v)),\quad \det(1_{\mathscr{E}})=1_{\mathscr{A}}.\]
If $\mathscr{E}$ is of rank $n$ (for example if $X$ is connected), we have 
\[\det(s\cdot u)=s^n\det(u)\]
for any $s\in\Gamma(X,\mathscr{A})$ (we note that $\det(0)=0_{\mathscr{A}}$ if $n\geq 1$, but $\det(0)=1_{\mathscr{A}}$ if $n=0$). Moreover, for $u$ to be an automorphism of $\mathscr{E}$, it is necessary and sufficient that $\det(u)$ is invertible in $\Gamma(X,\mathscr{A})$ (\cref{module endo invertible iff det}).\par
If $\mathscr{E}$ is of rank $n$, we can similarly define the elementary symmetric functions $\sigma_i(u)$ for $u$, which are elements of $\Gamma(X,\mathscr{A})$, and we also have the relations (\ref{sheaf of module Hamilton-Cayley equation-2}) and (\ref{sheaf of module Hamilton-Cayley equation-3}).\par
We have then define a homomorphism $\det:\Hom_{\mathscr{A}}(\mathscr{E},\mathscr{E})\to\Gamma(X,\mathscr{A})$ of multiplicative monoids. Note that $\Hom_{\mathscr{A}}(\mathscr{E},\mathscr{E})=\Gamma(X,\sHom_{\mathscr{A}}(\mathscr{E},\mathscr{E}))$ by definition, so we can replace $X$ by any open subset $U$ in this definition of $\det$, and therefore obtain a homomorphism $\det:\sHom_{\mathscr{A}}(\mathscr{E},\mathscr{E})\to\mathscr{A}$ of sheaves of multiplicative monoids. If $\mathscr{E}$ is of constant rank, we can similarly define the homomorphisms $\sigma_i:\sHom_{\mathscr{A}}(\mathscr{E},\mathscr{E})\to\mathscr{A}$ of sheaves of sets; for $i=1$, the homomorphism $\sigma_1=\tr$ is a homomorphism of $\mathscr{A}$-modules.\par
Let $(Y,\mathscr{B})$ be a second ringed space and $f:(X,\mathscr{A})\to(Y,\mathscr{B})$ be a morphism of ringed spaces; if $\mathscr{F}$ is a locally free $\mathscr{B}$-module, $f^*(\mathscr{F})$ is a locally free $\mathscr{A}$-module (with the same rank of $\mathscr{F}$). For any endomorphism $v$ of $\mathscr{F}$, $f^*(v)$ is then an endomorphism of $f^*(\mathscr{F})$, and it follows from these definitions that $\det(f^*(v))$ is the section of $\mathscr{A}=f^*(\mathscr{B})$ over $X$ which corresponds canonically to $\det(v)\in\Gamma(Y,\mathscr{B})$. We can then say that the homomorphism $f^*(\det):f^*(\sHom_{\mathscr{B}}(\mathscr{F},\mathscr{F}))\to f^*(\mathscr{B})=\mathscr{A}$ is the composition
\begin{align}\label{ringed space determinant inverse image factorization}
f^*(\sHom_{\mathscr{B}}(\mathscr{F},\mathscr{F}))\stackrel{\gamma^{\sharp}}{\to}\sHom_{\mathscr{A}}(f^*(\mathscr{F}),f^*(\mathscr{F}))\stackrel{\det}{\to}\mathscr{A}
\end{align}
(formula (\ref{ringed space inverse image and sheaf Hom})). We have a similar result for $\sigma_i$.\par
Suppose now that $X$ is a locally integral scheme, so its sheaf of rational function $\mathscr{K}_X$ is locally simple over $X$ (\cref{scheme reduced rational sheaf direct product}) and quasi-coherent as $\mathscr{O}_X$-module. If $\mathscr{E}$ is a qausi-coherent $\mathscr{O}_X$-module of finite type, $\mathscr{E}'=\mathscr{E}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is then a locally free $\mathscr{K}_X$-module (\cref{scheme irreducible qcoh tensor with K(X) simple}). For any endomorphism $u$ of $\mathscr{E}$, $u\otimes 1_{\mathscr{K}_X}$ is then an endomorphism of $\mathscr{E}'$, and $\det(u\otimes 1)$ is a section of $\mathscr{K}_X$ over $X$, which is called the \textbf{determinant} of $u$ and denoted by $\det(u)$. It follows from \cref{module endo symmetric function integral} that $\det(u)$ is a section of the integral closure of $\mathscr{O}_X$ in $\mathscr{K}_X$; if $X$ is also normal, $\det(u)$ is then a section of $\mathscr{O}_X$ over $X$, and if we suppose moreover that $\mathscr{E}$ is torsion free, for $u$ to be an automorphism of $\mathscr{E}$, it is necessary and sufficient that $\det(u)$ is invertible (\cref{module endo invertible iff det}). The formulae (\ref{sheaf of module Hamilton-Cayley equation-2}) and (\ref{sheaf of module Hamilton-Cayley equation-3}) are still valid; the homomorphism $u\mapsto\det(u)$ then defines a homomorphism $\det:\sHom_{\mathscr{O}_X}(\mathscr{E},\mathscr{E})\to\mathscr{K}_X$, which has values in $\mathscr{O}_X$ if $X$ is normal. We have analogous results for the elementary symmetric function functions $\sigma_j(u)$, if $\mathscr{E}'$ has constant rank; if moreover $X$ is normal, the $\sigma_j(u)$ are sections of $\mathscr{O}_X$ over $X$.\par
Finally, let $X$ and $Y$ be integral schemes, and $f:X\to Y$ be a dominant morphism. We see that there exists a canonical homomorphism $f^*(\mathscr{K}_Y)\to\mathscr{K}_X$, whence induces, for any quasi-coherent $\mathscr{O}_Y$-module $\mathscr{F}$ of finite type, a canonical homomorphism $\theta:f^*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y)\to f^*(\mathscr{F})\otimes_{\mathscr{O}_X}\mathscr{K}_X$. If $v$ is an endomorphism of $\mathscr{F}$, $f^*(v\otimes 1_{\mathscr{K}_Y})$ is an endomorphism of $f^*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y)$, and we have a commutative diagram
\[\begin{tikzcd}
f^*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y)\ar[r,"f^*(v\otimes 1)"]\ar[d,swap,"\theta"]&f^*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y)\ar[d,"\theta"]\\
f^*(\mathscr{F})\otimes_{\mathscr{O}_X}\mathscr{K}_X\ar[r,"f^*(v)\otimes 1"]&f^*(\mathscr{F})\otimes_{\mathscr{O}_X}\mathscr{K}_X
\end{tikzcd}\]
We then conclude that $\det(f^*(v))$ is the canonical image of the section $\det(v)$ of $\mathscr{K}_Y$ under the canonical homomorphism $f^*(\mathscr{K}_Y)\to\mathscr{K}_X$. In fact, it is immediate that we are reduced to the case where $X=\Spec(B)$ and $Y=\Spec(A)$ are affine, $A$, $B$ being integral domains with fraction fields $K$, $L$ respectively, the hommorphism $A\to B$ being injective and extends to a monomorphism $K\to L$. If $\mathscr{F}=\widetilde{M}$ where $M$ is a finitely generated $A$-module, the dimension of $M\otimes_AK$ is equal to that of $(M\otimes_AB)\otimes_BL$ over $L$, and $\det((u\otimes 1)\otimes 1)$ is the image of $\det(u\otimes 1)$ in $L$ for any endomorphism $u$ of $M$, whence our conclusion.\par
Finally, suppose that $X$ is a reduced locally Noetherian scheme, whose sheaf of rational functions $\mathscr{K}_X$ is quasi-coherent by \cref{scheme local finite K(X) qcoh and injection}. Let $\mathscr{E}$ be a coherent $\mathscr{O}_X$-module such that $\mathscr{E}'=\mathscr{E}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is locally free of rank $n$. We can then define for each endomorphism $u$ of $\mathscr{E}$ the elementary symmetric functions $\sigma_j(u)$, which are sections of $\mathscr{K}_X$ over $X$.
\subsection{Norm of invertible sheafs}\label{scheme norm of invertible sheaf subsection}
Let $(X,\mathscr{A})$ be a ringed space and $\mathscr{B}$ be an $\mathscr{A}$-algebra. The $\mathscr{A}$-module $\mathscr{B}$ is canonically identified with a sub-$\mathscr{A}$-module of $\sHom_{\mathscr{A}}(\mathscr{B},\mathscr{B})$, where a section $f$ of $\mathscr{B}$ over an open subset $U$ of $X$ is identified with the multiplication by this section. Assume that $(X,\mathscr{A})$ and $\mathscr{B}$ satisfies the conditions given in the previous subsection, so that we can define $\det(f)$ (resp. $\sigma_j(f)$) to be a section of $\mathscr{K}_X$ over $U$, which is called the \textbf{norm} of $f$ (resp. the elementary symmetric functions) of $f$ and denoted by $N_{\mathscr{B}/\mathscr{A}}(f)$. We suppose that one of the following conditions is satisfied:
\begin{enumerate}
\item[($\alpha$)] $\mathscr{B}$ is a locally free $\mathscr{A}$-module of finite rank $n$.
\item[($\beta$)] $(X,\mathscr{A})$ is a reduced locally Noetherian scheme, $\mathscr{B}$ is a coherent $\mathscr{A}$-module such that $\mathscr{B}\otimes_{\mathscr{A}}\mathscr{K}_X$ is a locally free $\mathscr{K}_X$-module of rank $n$, and for any section $f\in\Gamma(U,\mathscr{B})$ over an open subset $U\sub X$, $\sigma_j(f)$ ($1\leq j\leq n$) is a section of $\mathscr{A}$ over $U$ (this is true for example if $X$ is normal).
\end{enumerate}
The hypothesis that $\mathscr{B}\otimes_{\mathscr{A}}\mathscr{K}_X$ is locally free can be expressed by the following: denote by $X_i$ the reduced closed subschemes of $X$ with underlying space the irreducible components of $X$, which are then locally Noetherian integral schemes. Any $x\in X$ belongs to finitely many $X_i$, and $\mathscr{B}\otimes_{\mathscr{A}}\mathscr{K}_{X_i}$ is a locally free $\mathscr{K}_{X_i}$-module of constant rank $k_i$ (\cref{scheme irreducible qcoh K(X) module simple}); to say that $\mathscr{B}\otimes_{\mathscr{A}}\mathscr{K}_X$ is locally free $\mathscr{K}_X$-module signifies that, for any $x\in X$, the ranks $k_i$ such that $x\in X_i$ are all equal. This question is in fact local, and we can assume that $X=\Spec(A)$, where $A$ is a reduced Noetherian ring, and $\mathscr{B}=\widetilde{B}$ where $B$ is a finite $A$-algebra. If $\p_i$ ($1\leq i\leq r$) are the minimal prime ideals of $A$, the total fraction ring $K$ of $A$ is then the direct product of $K_i$, where $K_i$ is the fraction field of $A_i=A/\p_i$, and $B\otimes_AK$ is then the direct sum of $B\otimes_AK_i$, whence our conclusion.\par
It is clear that under the hypotheses ($\alpha$) or $(\beta$), we then define a homomorphism $N_{\mathscr{B}/\mathscr{A}}:\mathscr{B}\to\mathscr{A}$ of sheaves of multiplicative monoids, which is also denoted by $N$ if there is no confusion, and called the norm homomorphism. For two sections $f,g$ of $\mathscr{B}$ over an open subset $U$, we then have
\begin{align}\label{ringed space norm homomorphism prop-1}
N_{\mathscr{B}/\mathscr{A}}(fg)=N_{\mathscr{B}/\mathscr{A}}(f)N_{\mathscr{B}/\mathscr{A}}(g),\quad N_{\mathscr{B}/\mathscr{A}}(1_{\mathscr{B}})=1_{\mathscr{A}}
\end{align}
for the corresponding sections of $\mathscr{A}$ over $U$. Also, for any section $s$ of $\mathscr{A}$ over $U$, we have
\begin{align}\label{ringed space norm homomorphism prop-2}
N_{\mathscr{B}/\mathscr{A}}(s\cdot 1_{\mathscr{B}})=s^n.
\end{align}

In case ($\alpha$), for any $f\in\Gamma(U,\mathscr{B})$ to be invertible, it is necessary and sufficient that $N(f)\in\Gamma(U,\mathscr{A})$ is invertiblel; in case ($\beta$), this condition is necessary, and is sufficient if $\mathscr{B}$ is a torsion free $\mathscr{A}$-module.\par
Suppose the one of the hypotheses ($\alpha$), ($\beta$) is satisfied, and let $\mathscr{L}'$ be an invertible $\mathscr{B}$-module. We can canonically associate an invertible $\mathscr{A}$-module by the following. Denote by $\mathscr{A}^{\times}$ (resp. $\mathscr{B}^{\times}$) the subsheaf of $\mathscr{A}$ (resp. $\mathscr{B}$) such that $\Gamma(U,\mathscr{A}^{\times})$ (resp. $\Gamma(U,\mathscr{B}^{\times})$) is the set of invertible elements of $\Gamma(U,\mathscr{A})$ (resp. $\Gamma(U,\mathscr{B})$) for any open subset $U\sub X$; this is a sheaf of multiplicative groups, and $N_{\mathscr{B}/\mathscr{A}}$, restricted to $\mathscr{B}^{\times}$, is a homomorphism $\mathscr{B}^{\times}\to\mathscr{A}^{\times}$ of sheaves of groups. Let $\mathfrak{L}$ be the set of couples $(U_\lambda,\eta_\lambda)$, with the following property: $U_\lambda$ is an open subset of $X$ and $\eta_\lambda:\mathscr{L}'|_{U_\lambda}\stackrel{\sim}{\to}\mathscr{B}|_{U_\lambda}$ is an isomorphism of $(B|_{U_\lambda})$-modules. By hypothesis, the $U_\lambda$ for an open covering og $X$; for two indices $\lambda,\mu$, we put $\omega_{\lambda\mu}=(\eta_\lambda|_{U_\lambda\cap U_\mu})\circ(\eta_\mu|_{U_\lambda\cap U_\mu})^{-1}$, which is an automorphism of $\mathscr{B}|_{U_\lambda\cap U_\mu}$, and canonically identified with a section of $\mathscr{B}^{\times}$ over $U_\lambda\cap U_\mu$, and $(\omega_{\lambda\mu})$ is a $1$-cocycle over the covering $\mathfrak{U}=(U_\lambda)$ with values in $\mathscr{B}^{\times}$. The fact that $N_{\mathscr{B}/\mathscr{A}}:\mathscr{B}^{\times}\to\mathscr{A}^{\times}$ is a homomorphism implies that $(N_{\mathscr{B}/\mathscr{A}}(\omega_{\lambda\mu}))$ is a $1$-cocycle of $\mathfrak{U}$ with values in $\mathscr{A}^{\times}$, which then corresponds (up to isomorphism) to an invertible $\mathscr{A}$-module. This invertible $\mathscr{A}$-module is denoted by $N_{\mathscr{B}/\mathscr{A}}(\mathscr{L}')$ and is called the norm of the invertible $\mathscr{B}$-module $\mathscr{L}'$. \par
Let $\mathfrak{M}$ be a subset of $\mathfrak{L}$ such that the $U_\lambda$ form an open covering of $X$, and let $\mathfrak{B}$ be a covering of $X$. The restriction of the cocycle $(\omega_{\lambda\mu})$ to $\mathfrak{B}$ defines a $1$-cocycle $(N_{\mathscr{B}/\mathscr{A}}(\omega_{\lambda\mu}))$, which is the restriction of the $1$-cocycle $(N_{\mathscr{B}/\mathscr{A}}(\omega_{\lambda\mu}))$ to $\mathfrak{U}$; it is clear that there is a canonical isomorphism of the invertible $\mathscr{A}$-modules thus defined, and we can therefore define $N_{\mathscr{B}/\mathscr{A}}(\mathscr{L}')$ by a refinement of the covering $\mathfrak{U}$. This shows that, if $\mathscr{L}'$ and $\mathscr{K}'$ are two invertible $\mathscr{B}$-modules, by (\ref{ringed space norm homomorphism prop-1}) we have
\begin{align}\label{ringed space norm of invertible sheaf prop-1}
N(\mathscr{L}'\otimes_{\mathscr{B}}\mathscr{K}')=N(\mathscr{L}')\otimes_{\mathscr{A}}N(\mathscr{K}'),\quad N_{\mathscr{B}/\mathscr{A}}(\mathscr{B})=\mathscr{A},
\end{align}
and therefore $N(\mathscr{L}'^{-1})=N(\mathscr{L}')^{-1}$. Also, it follows from (\ref{ringed space norm homomorphism prop-2}) that if $\mathscr{L}$ is an invertible $\mathscr{A}$-module, we have
\begin{align}\label{ringed space norm of invertible sheaf prop-2}
N_{\mathscr{B}/\mathscr{A}}(\mathscr{L}\otimes_{\mathscr{A}}\mathscr{B})=\mathscr{L}^{\otimes n}.
\end{align}

We show that $N_{\mathscr{B}/\mathscr{A}}$ is a covariant functor on the category of invertible $\mathscr{B}$-modules. Let $u':\mathscr{L}'\to\mathscr{K}'$ be a homomorphism of invertible $\mathscr{B}$-modules, and let $\mathfrak{B}=(U_\lambda)$ be an open covering of $X$ such that for any $\lambda$, we have an isomorphism $\eta_\lambda:\mathscr{L}'|_{U_\lambda}\stackrel{\sim}{\to}\mathscr{B}|_{U_\lambda}$ and $\tau_\lambda:\mathscr{K}'|_{U_\lambda}\stackrel{\sim}{\to}\mathscr{B}|_{U_\lambda}$; there is then for each $\lambda$ an endomorphism $u'_\lambda$ of $\mathscr{B}|_{U_\lambda}$ such that $u'_\lambda\circ\eta_\lambda=\tau_\lambda\circ(u'|_{U_\lambda})$, and we can evidently identify $u'_\lambda$ with a section of $\mathscr{B}$ over $U_\lambda$. Hence, for any couple $(\lambda,\mu)$ of indices, the restriction of $(\tau_\lambda)^{-1}\circ u'_\lambda\circ\eta_\lambda$ and $(\tau_\mu)^{-1}\circ u'_\mu\circ\eta_\mu$ to $U_\lambda\cap U_\mu$ coincide. We then deduce for the $1$-cocycle $(\omega_{\lambda\mu})$ corresponding to $\mathscr{L}'$ and the $1$-cocycle $(\gamma_{\lambda\mu})$ corresponding to $\mathscr{K}'$ the relation
\[\gamma_{\lambda\mu}u'_\mu=u'_\lambda\omega_{\lambda\mu}.\]
If we put $u_\lambda=N(u'_\lambda)$, we then have the analogous relation
\[N(\gamma_{\lambda\mu})u_\mu=u_\lambda N(\omega_{\lambda\mu})\]
and therefore the $u_\lambda$ define a homomorphism $N(\mathscr{
L}')\to N(\mathscr{K}')$, which is denoted by $N_{\mathscr{B}/\mathscr{A}}(u)$ or $N(u)$. In view of \cref{module endo invertible iff det}, it is clear that under the hypothesis ($\alpha$), $u'$ is an isomorphism if and only if $u$ is, and this is true under the hypothesis ($\beta$) if $\mathscr{B}$ is moreover torsion free. In particular, if consider the hommorphisms $\mathscr{B}\to\mathscr{L}'$, which correspond to global sections of $\mathscr{L}'$, since $N_{\mathscr{B}/\mathscr{A}}(\mathscr{B})=\mathscr{A}$, we get a canonical homomorphism
\[N_{\mathscr{B}/\mathscr{A}}:\Gamma(X,\mathscr{L}')\to\Gamma(X,N_{\mathscr{B}/\mathscr{A}}(\mathscr{L}')).\]
It also follows from (\ref{ringed space norm homomorphism prop-1}) that if $f'\in\Gamma(X,\mathscr{L}')$, $g'\in\Gamma(X,\mathscr{K}')$, we have
\begin{align}\label{ringed space norm of section of invertible sheaf prop-1}
N(f'\otimes g')=N(f')\otimes N(g').
\end{align}
Also, for any invertible $\mathscr{A}$-module $\mathscr{L}$ and any section $f\in\Gamma(X,\mathscr{L})$, we have 
\begin{align}\label{ringed space norm of section of invertible sheaf prop-2}
N_{\mathscr{B}/\mathscr{A}}(f\otimes 1_{\mathscr{B}})=f^{\otimes n}.
\end{align}
Finally, for the homomorphism $\mathscr{B}\to\mathscr{L}'$ corresponding to a section $f'$ of $\mathscr{L}'$ over $X$ to be an isomorphism, it is necessary and sufficient that $f'_x$ generates $\mathscr{L}_x'$ for any $x\in X$; under condition ($\alpha$), this is equivalent to that $N(f')_x$ generates $(N(\mathscr{L}'))_x$ for any $x$, and this is true for condition ($\beta$) if $\mathscr{B}$ is torsion free.\par
Let $(X,\mathscr{A})$, $(X',\mathscr{A}')$ be two ringed spaces and $\varphi:X'\to X$ be a morphism, $\mathscr{B}$ be an $\mathscr{A}$-algebra, and $\mathscr{B}'=\varphi^*(\mathscr{B})$. Suppose that one of the following conditions is satisfied:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{B}$ satisfies condition ($\alpha$).
\item[(\rmnum{2})] $(X,\mathscr{A})$ and $\mathscr{B}$ satisfy condition ($\beta)$, $(X',\mathscr{A}')$ is a reduced locally Noehterian scheme, and if we denote by $X_\alpha$ and $X_\beta'$ the reduced closed subschemes of $X$ and $X'$ with underlying space the irreducible components of these spaces, the restriction of $\varphi$ to $X_\beta'$ is a dominant morphism from $X'_\beta$ to $X_\alpha$.
\end{enumerate}

Under these conditions, we claim that $\mathscr{B}'$ verifies the conditions ($\alpha$) or $(\beta$); the first case is clear, and to prove the second one, it suffices to prove that for any $x'\in X'$, the ranks of $\mathscr{B}'\otimes_{\mathscr{O}_{X'}}\mathscr{K}_{X'_\beta}$ for the indices $\beta$ such that $x'\in X'_\beta$ are the same. Now, if the restriction of $\varphi$ to $X'_\beta$ is a dominant morphism into $X_\alpha$, the rank of $\mathscr{B}'\otimes_{\mathscr{O}_{X'}}\mathscr{K}_{X'_\beta}$ is equal to that of $\mathscr{B}\otimes_{\mathscr{O}_X}\mathscr{K}_{X_\alpha}$ (which can be seen from the affine case), whence our claim.\par
This being established, it follows that if $f$ is a section of $\mathscr{B}$ over an open subset $U\sub X$, and $f'$ is the inverse image of $f$ under $\varphi$, $N_{\mathscr{B}'/\mathscr{A}'}(f')$ is the section of $\mathscr{A}'$ over $\varphi^{-1}(U)$ which is the inverse image of $N_{\mathscr{B}/\mathscr{A}}(f)$ under $\varphi$. If $\mathscr{L}$ is an invertible $\mathscr{B}$-module and if $\mathscr{L}'=\varphi^*(\mathscr{L})$ (which is an invertible $\mathscr{B}'$-module), we have
\begin{align}\label{ringed space norm of invertible sheaf and inverse image commute}
N_{\mathscr{B}'/\mathscr{A}'}(\mathscr{L}')=\varphi^*(N_{\mathscr{B}/\mathscr{A}}(\mathscr{L})).
\end{align}

Suppose now that $(X,\mathscr{A})$ is a scheme. Then giving a quasi-coherent finite $\mathscr{A}$-algebra $\mathscr{B}$ is equivalent to giving a finite morphism $\varphi:X'\to X$ such that $\varphi_*(\mathscr{O}_{X'})=\mathscr{B}$, defined up to $X$-isomorphisms (\cref{scheme qcoh algebra spec universal property}), and in this case $X'$ is isomorphic to the affine specturm $\Spec(\mathscr{B})$. Moreover, if this morphism $\varphi:X'\to X$ is fixed, then giving a quasi-coherent $\mathscr{O}_{X'}$-module $\mathscr{F}'$ is equivalent to giving a quasi-coherent $\mathscr{B}$-module such that $\varphi_*(\mathscr{F}')=\mathscr{F}$ (\cref{scheme S-affine functor A on qcoh dense}), and for $\mathscr{F}'$ to be invertible, it is necessary and sufficient that $\mathscr{F}$ is (\cref{scheme morphism finite locally free iff direct image}). To utilize the preceding results for the finite morphism $\varphi$, it is then necessary to assume that $\mathscr{B}=\varphi_*(\mathscr{O}_{X'})$ satisfies condition ($\alpha$) or ($\beta$). For any invertible $\mathscr{O}_{X'}$-module $\mathscr{L}'$, we then set
\begin{align}\label{scheme morphism finite invertible sheaf norm def-1}
N_{X'/X}(\mathscr{L}'):=N_{\varphi_*(\mathscr{O}_{X'})/\mathscr{O}_X}(\varphi_*(\mathscr{L}'))
\end{align}
which is called the \textbf{norm} (relative to $\varphi$) of $\mathscr{L}'$. Similarly, if $u':\mathscr{L}'\to\mathscr{K}'$ is a homomorphism of invertible $\mathscr{O}_{X'}$-modules, we put
\begin{align}\label{scheme morphism finite invertible sheaf norm def-2}
N_{X'/X}(u')=N_{\varphi_*(\mathscr{O}_X)/\mathscr{O}_X}(\varphi_*(u')):N_{X'/X}(\mathscr{L}')\to N_{X'/X}(\mathscr{K}').
\end{align}
In particular, if we consider homomorphisms $\mathscr{O}_{X'}\to\mathscr{L}'$, we obtain a canonical homomorphism
\begin{align}\label{scheme morphism finite N_X'/X on global section}
N_{X'/X}:\Gamma(X',\mathscr{L}')\to\Gamma(X,N_{X'/X}(\mathscr{L}')).
\end{align}
\begin{proposition}\label{scheme morphism finite N(u') isomorphism iff}
Let $\varphi:X'\to X$ be a finite morphism and suppose that condition (\rmnum{1}) or (\rmnum{2}) is satisfied. For a homomorphism $u':\mathscr{L}'\to\mathscr{K}'$ of invertible $\mathscr{O}_{X'}$-modules to be an isomorphism, it is necessary and sufficient that, in the first case, that $N_{X'/X}(u')$ is an isomorphism; in the second case, this condition is necessary, and is sufficient if $\varphi_*(\mathscr{O}_{X'})$ is torsion free.
\end{proposition}
\begin{proof}
This is a particular case of our previous discussions, where we put $\mathscr{B}=\varphi_*(\mathscr{O}_{X'})$, which is a quasi-coherent finite $\mathscr{O}_X$-algebra. We also note that by \cref{scheme S-affine qcoh isomorphism iff}, for $\varphi_*(u')$ to be an isomorphism, it is necessary and sufficient that $u'$ is an isomorphism. 
\end{proof}
\begin{corollary}\label{scheme morphism finite section norm X_f prop}
Retain the hypothesis of \cref{scheme morphism finite N(u') isomorphism iff} and suppose that $\varphi_*(\mathscr{O}_{X'})$ is torsion free. Let $\mathscr{L}'$ be an invertible $\mathscr{O}_{X'}$-module, $f'$ be a section of $\mathscr{L}'$ over $X'$, and $f=N_{X'/X}(f')$ the section of $\mathscr{L}=N_{X'/X}(\mathscr{L}')$ over $X$ corresponding to $f'$. Then we have $\varphi(X'-X'_{f'})=X-X_f$ and $X_f$ is the largest open subset of $X$ such that $\varphi^{-1}(U)\sub X'_{f'}$.
\end{corollary}
\begin{proof}
In fact, $\varphi(X'-X'_{f'})$ is closed in $X$ by \cref{scheme morphism integral is universally closed}, and it then suffices to prove the second assertion. Now the relation $U\sub X_f$ is equivalent to that the hommorphism $\mathscr{O}_X|_U\to\mathscr{L}|_U$ defined by $f|_U$ is an isomorphism. In view of \cref{scheme morphism finite N(u') isomorphism iff}, this is equivalent to that the homomorphism $\mathscr{O}_{X'}|_{\varphi^{-1}(U)}\to\mathscr{L}'|_{\varphi^{-1}(U)}$ defined by $f'|_{\varphi^{-1}(U)}$ is an isomorphism, which means $\varphi^{-1}(U)\sub X'_{f'}$.
\end{proof}
\begin{proposition}\label{scheme morphism finite base change N_X'/X prop}
Let $\varphi:X'\to X$ be a finite morphism, $\psi:Y\to X$ be a morphism; let $Y'=X'_{(Y)}$, $\varphi'=\varphi_{(Y)}$, $\psi'=\psi_{(X')}$ such that the following diagram is commutative
\[\begin{tikzcd}
Y'\ar[r,"\psi'"]\ar[d,swap,"\varphi'"]&X'\ar[d,"\varphi"]\\
Y\ar[r,"\psi"]&X
\end{tikzcd}\]
Assume the hypotheses of \cref{scheme morphism finite N(u') isomorphism iff}. Then for any invertible $\mathscr{O}_{X'}$-module $\mathscr{L}'$, we have
\[N_{Y'/Y}(\psi'^*(\mathscr{L}'))=\psi^*(N_{X'/X}(\mathscr{L}')).\]
\end{proposition}
\begin{proof}
Note that we have $\psi^*(\varphi_*(\mathscr{L}'))=\varphi'_*(\psi'^*(\mathscr{L}'))$ in view of \cref{scheme S-affine algebra under base change prop}, and in particular $\varphi'_*(\mathscr{O}_{Y'})=\psi^*(\varphi_*(\mathscr{O}_{X'}))$; if $\varphi_*(\mathscr{O}_{X'})$ is locally free, so is $\varphi'_*(\mathscr{O}_{Y'})$. The conclusion then follows from the definition of $N_{X'/X}$, $N_{Y'/Y}$, and (\ref{ringed space norm of invertible sheaf and inverse image commute}).
\end{proof}
\subsection{A criterion for ample sheaves}
\begin{proposition}\label{scheme morphism finite surjective norm of ample}
Let $f:X\to Y$ be a quasi-compact morphism, $g:X'\to X$ be a finite and surjective morphism such that $(X,\mathscr{O}_X)$ and $g_*(\mathscr{O}_{X'})$ satisfy condition ($\beta$). Then, for an ample invertible $\mathscr{O}_{X'}$-module $\mathscr{L}'$ relative to $f\circ g$, $N_{X'/X}(\mathscr{L}')=\mathscr{L}$ is ample relative to $f$.
\end{proposition}
\begin{proof}
We can suppose that $Y$ is affine, and then, in view of \cref{scheme relative ample over affine iff ample}, it suffices to prove that, if $\mathscr{L}'$ is ample, then $\mathscr{L}=N_{X'/X}(\mathscr{L}')$ is ample. For this, we can assume that $g_*(\mathscr{O}_{X'})$ is torsion free. In fact, let $\mathscr{T}$ be the kernel of the homomorphism $g_*(\mathscr{O}_{X'})\to g_*(\mathscr{O}_{X'})\otimes_{\mathscr{O}_X}\mathscr{K}_X$, which is a coherent ideal of $\mathscr{B}=g_*(\mathscr{O}_{X'})$ by hypothesis, and put $X''=\Spec(\mathscr{B}/\mathscr{T})$; we then have a commutative diagram
\[\begin{tikzcd}
X''\ar[rr,"j"]\ar[rd,swap,"g'"]&&X'\ar[ld,"g"]\\
&X&
\end{tikzcd}\]
where $j$ is a closed immersion (\cref{scheme S-affine closed subscheme char}). Moreover, since $\mathscr{T}$ is a torsion sheaf, by \cref{scheme integral qcoh ft torsion iff} and \cref{sheaf of module ft local prop} we see that the support of $\mathscr{T}$ is a closed subset that is rare in $X$, so for the generic point $x$ of an irreducible component of $X$, there exists an affine open neighborhood $U$ of $x$ such that $\mathscr{B}|_U=(\mathscr{B}/\mathscr{T})|_U$. As $g$ is by hypothesis surjective, we then conclude that $x\in g'(X'')$; $g'$ is then dominant, and hence surjective by \cref{scheme morphism integral is universally closed} since it is a finite morphism. By definition we have
\[g'_{*}(\mathscr{O}_{X''})\otimes\mathscr{K}_X=(\mathscr{B}/\mathscr{T})\otimes_{\mathscr{O}_X}\mathscr{K}_X=g_*(\mathscr{O}_{X'})\otimes_{\mathscr{O}_X}\mathscr{K}_X,\]
so $(X,\mathscr{O}_X)$ and $g'_*(\mathscr{O}_{X''})$ satisfies condition ($\beta$), and $g'_*(\mathscr{O}_{X''})$ is torsion free. Finally, $j^*(\mathscr{L}')=\mathscr{L}''$ is an ample $\mathscr{O}_{X''}$-module (\cref{scheme relative ample permanence prop}(\rmnum{2})), and $N_{X''/X}(\mathscr{L}'')=N_{X'/X}(\mathscr{L}')$. To see this, we note that to define these two invertible $\mathscr{O}_X$-modules we can utilize an affine open covering $(U_\lambda)$ of $X$ such that $g_*(\mathscr{L}')$ and $g'_*(\mathscr{L}'')$ to $U_\lambda$ are respectively isomorphic to $\mathscr{B}|_{U_\lambda}$ and $(\mathscr{B}/\mathscr{T})|_{U_\lambda}$. By \cref{scheme S-affine qcoh algebra of inverse image char}, we immediately see that for any isomorphism $\eta_\lambda:g_*(\mathscr{L}')|_{U_\lambda}\to\mathscr{B}|_{U_\lambda}$ corresponds canonically to an isomorphism
\[\eta'_\lambda:g'_*(\mathscr{L}'')|_{U_\lambda}\to(\mathscr{B}/\mathscr{T})|_{U_\lambda}\]
so that, if $(\omega_{\lambda\mu})$ and $(\omega'_{\lambda\mu})$ are the $1$-cocycles corresponding to the isomorphisms $(\eta_\lambda)$ and $(\eta'_\lambda)$, $\omega'_{\lambda\mu}$ is the canonical image of $\omega_{\lambda\mu}\in\Gamma(U_\lambda\cap U_\mu,\mathscr{B})$ to $\Gamma(U_\lambda\cap U_\mu,\mathscr{B}/\mathscr{T})$. In view of the definition of $\mathscr{T}$, we conclude that
\[N_{\mathscr{B}/\mathscr{A}}(\omega_{\lambda\mu})=N_{(\mathscr{B}/\mathscr{T})/\mathscr{A}}(\omega'_{\lambda\mu})\]
(where $\mathscr{A}=\mathscr{O}_X$), whence the equality.\par
Suppose then that $g_*(\mathscr{O}_{X'})$ is torsion free. It then suffices to prove that if $f$ runs through the sections of $\mathscr{L}^{\otimes n}$ ($n>0$) over $X$, the $X_f$ form a basis of $X$ (\cref{scheme ample sheaf iff}). Now, let $x\in X$, and let $U$ be an open neighborhood of $x$; as $g^{-1}(x)$ is finite by \cref{scheme morphism integral fiber finite discrete} and $\mathscr{L}'$ is ample, there exists an integer $n>0$ and a section $f'$ of $\mathscr{L}'^{\otimes n}$ over $X'$ such that $X'_{f'}$ is an open neighborhood of $g^{-1}(x)$ contained in $g^{-1}(U)$. As we have $\mathscr{L}^{\otimes n}=N_{X'/X}(\mathscr{L}'^{\otimes n})$, it then suffices to choose $f=N_{X'/X}(f')$: in fact, we have $X-X_f=g(X'-X'_{f'})$ by \cref{scheme morphism finite section norm X_f prop}, so $x\in X_f\sub U$.
\end{proof}
\begin{corollary}\label{scheme morphism finite surjective ample iff inverse}
Under the hypotheses of \cref{scheme morphism finite surjective norm of ample}, for an invertible $\mathscr{O}_X$-module $\mathscr{L}$ to be ample relative to $f$, it is necessary and sufficient that $\mathscr{L}'=g^*(\mathscr{L})$ is ample relative to $f\circ g$.
\end{corollary}
\begin{proof}
This condition is necessary, since $g$ is affine (\cref{scheme inverse of ample on quasi-affine is ample}). To see the sufficiency, we can assume that $Y$ is affine, so $X$ and $X'$ are quasi-compact and $\mathscr{L}'$ is ample (\cref{scheme relative ample over affine iff ample}). Now the set of points $x\in X$ such that there is a neighborhood of $x$ over which $g_*(\mathscr{O}_{X'})$ (resp. $g_*(\mathscr{O}_{X'})\otimes_{\mathscr{O}_X}\mathscr{K}_X$) is of rank $n$ is open and closed in $X$ by hypotheses, so $X$ is a finite sum of such open subschemes (recall that $X$ is quasi-compact), and we can therefore suppose that it is equal to one of them (\cref{scheme relative ample and coproduct}). But we then have $N_{X'/X}(\mathscr{L}')=\mathscr{L}^{\otimes n}$, so $\mathscr{L}^{\otimes n}$ is ample in view of \cref{scheme morphism finite surjective norm of ample}, and $\mathscr{L}$ is therefore ample.
\end{proof}
\begin{corollary}\label{scheme morphism quasi-projective iff compose with g}
Under the hypotheses of \cref{scheme morphism finite surjective norm of ample}, suppose moreover that $f:X\to Y$ is of finite type. Then, for $f$ to be quasi-projective, it is necessary and sufficient that $f\circ g$ is quasi-projective. If we suppose that $Y$ is quasi-compact and quasi-compact, then, for $f$ to be projective, it is necessary and sufficient that $f\circ g$ is projective.
\end{corollary}
\begin{proof}
The hypotheses implies that $f\circ g$ is of finite type. By the definition of quasi-projective morphisms, the first assertion then follows from \cref{scheme morphism finite surjective norm of ample} and \cref{scheme morphism finite surjective ample iff inverse}. In view of this result and \cref{scheme projective and quasi-projective}, it remains to prove that if $f$ is quasi-projective, then for $f$ to be proper, it is necessary and sufficient that $f\circ g$ is proper. But $f$ is then separated and of fintie type, and as $g$ is surjective, this follows from \cref{scheme morphism proper cancelled prop}(\rmnum{2}).
\end{proof}
\begin{corollary}\label{scheme ft over field quasi-projective iff base change}
Let $X$ be a scheme of finite type over a field $K$ and $K'$ be finite extension of $K$. For $X$ to be projective (resp. quasi-projective) over $K$, it is necessary and sufficient that $X'\otimes_KK'$ is projective (resp. quasi-projective) over $K'$.
\end{corollary}
\begin{proof}
This condition is necessary by \cref{scheme morphism quasi-projective permanence prop}(\rmnum{3}) and \cref{scheme morphism projective permanence prop}(\rmnum{3}). Conversely, suppose that $X'$ is projective (resp. quasi-projective), and let $g:X'\to X$ be the canonical projective. Since $K'$ is finite over $K$, it is clear that $g$ is a finite morphism by \cref{scheme morphism integral finite permanence prop} and is surjective (\cref{scheme surjective stable under base change}). Moreover, $g_*(\mathscr{O}_{X'})$ is a locally free $\mathscr{O}_X$-module, being isomorphic to $\mathscr{O}_X\otimes_KK'$ (\cref{scheme base change by affine morphism prop}). It then follows from the hypotheses and \cref{scheme morphism finite is projective} and \cref{scheme morphism projective permanence prop}(\rmnum{2}) that $X'$ is projective (resp. quasi-projective) over $K$. We then deduce from \cref{scheme morphism quasi-projective iff compose with g} that $X$ is projective (resp. quasi-projective) over $K$.
\end{proof}
\begin{remark}
In fact, later we will see that the statement of \cref{scheme ft over field quasi-projective iff base change} is valid for arbitrary extension $K'$ of $K$.
\end{remark}
The end of this subsection is devoted to the proof of the criterion in \cref{scheme Noe reduced ample relative fg and fh}, which is a refinement of the techniques we have currently used.
\begin{lemma}\label{scheme reduced Noe coh image of symmetric function prop}
Let $X$ be a reduced Noetherian scheme and $\mathscr{E}$ be a coherent $\mathscr{O}_X$-module such that $\mathscr{E}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is locally free of rank $n$. Then there exists a reduced Noetherian scheme $Z$ and a birational and finite morphism $h:Z\to X$ such that the homomorphisms $\sigma_i:\sHom_{\mathscr{O}_X}(\mathscr{E},\mathscr{E})\to\mathscr{K}_X$ send $\sHom_{\mathscr{O}_X}(\mathscr{E},\mathscr{E})$ into the coherent $\mathscr{O}_X$-algebra $h_*(\mathscr{O}_Z)$.
\end{lemma}
\begin{corollary}\label{scheme reduced Noe induced scheme Z birational}
Under the hypotheses of \cref{scheme reduced Noe coh image of symmetric function prop}, let $W$ be an open subset of $X$ such that for any $x\in W$, either $X$ is normal at $x$ or $\mathscr{E}_x$ is a free $\mathscr{O}_{X,x}$-module. Then we can choose $h$ so that the restriction of $h$ to $h^{-1}(W)$ is an isomorphism $h^{-1}(W)\cong W$.
\end{corollary}
\begin{proof}
In fact, the hypotheses imply that if $U\sub W$ is an affine open subset, we have, in the notations of \cref{scheme reduced Noe coh image of symmetric function prop}, that $(\sigma_i(u))_x\in A_x$ for any $x\in U$ (\cref{module endo symmetric function integral}), hence $\sigma_i(u)\in A$, and the conclusion follows from the definition of $h$ given in \cref{scheme reduced Noe coh image of symmetric function prop}.
\end{proof}
\begin{proof}
Let $X$ be a reduced Noetherian scheme, $g:X'\to X$ be a finite and surjective morphism such that $\mathscr{B}=g_*(\mathscr{O}_{X'})$ is a coherent $\mathscr{O}_X$-module. Suppose that $\mathscr{B}\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is locally free of rank $n$. Then we can apply \cref{scheme reduced Noe coh image of symmetric function prop} on $\mathscr{E}=\mathscr{B}$, with the same notations, to obtain a homomorphism $\sigma_n:\sHom_{\mathscr{O}_X}(\mathscr{B},\mathscr{B})\to h_*(\mathscr{O}_Z)$, and by composing with the canonical injection $\mathscr{B}\to\sHom_{\mathscr{O}_X}(\mathscr{B},\mathscr{B})$, we obtain a homomorphism of sheaves of multiplicative monoids:
\begin{align}\label{scheme reduced Noe augmented norm def}
\widetilde{N}:\mathscr{B}=g_*(\mathscr{O}_{X'})\to h_*(\mathscr{O}_Z)=\mathscr{C}.
\end{align}
For any invertible $\mathscr{O}_{X'}$-module $\mathscr{L}'$, $g_*(\mathscr{L}')$ is an invertible $\mathscr{B}$-module by \cref{scheme morphism finite locally free iff direct image}, and using the same method, we can define an invertible $\mathscr{C}$-module $\widetilde{N}(g_*(\mathscr{L}'))$, which is functorial on $\mathscr{L}'$.
\end{proof}
\begin{lemma}\label{scheme reduced Noe finite morphism ample iff augmented norm}
Let $X$ be a reduced Noetherian scheme, $g:X'\to X$ be a finite and surjective morphism such that $g*(\mathscr{O}_{X'})\otimes_{\mathscr{O}_X}\mathscr{K}_X$ is locally free of rank $n$. Then there exists a reduced Noetherian scheme $Z$ and a finite and birational morphism $h:Z\to X$ such that for any ample $\mathscr{O}_X$-module $\mathscr{L}'$, the invertible $\mathscr{O}_Z$-module $\mathscr{M}$ such that $h_*(\mathscr{M})=\widetilde{N}(g_*(\mathscr{L}'))$ is ample.
\end{lemma}
\begin{corollary}\label{scheme reduced Noe finite morphism ample iff inverse by h}
Under the hypotheses of \cref{scheme reduced Noe finite morphism ample iff augmented norm}, for any invertible $\mathscr{O}_X$-module $\mathscr{L}$ such that $g^*(\mathscr{L})$ is ample, $h^*(\mathscr{L})$ is ample.
\end{corollary}
\begin{proposition}\label{scheme Noe reduced ample relative fg and fh}
Let $Y$ be an affine scheme, $X$ be a reduced Noetherian scheme, $f:X\to Y$ be a quasi-compact morphism, and $g:X'\to X$ be a finite and surjective morphism. Let $W$ be an open subset of $X$ such that, for any $x\in W$, either $X$ is normal at $x$, or there exists an open neighborhood $T\sub W$ of $x$ such that $(g_*(\mathscr{O}_{X'}))|_T$ is a locally free $(\mathscr{O}_X|_T)$-module. Then there exists a reduced $Y$-scheme $Z$ and a finite and birational $Y$-morphism $h:Z\to X$ such that the restriction of $h$ to $h^{-1}(W)$ is an isomorphism $h^{-1}(W)\cong W$ and satisfies the following property: for any invertible $\mathscr{O}_X$-module such that $g^*(\mathscr{L})$ is ample relative to $f\circ g$, $h^*(\mathscr{L})$ is ample relative to $f\circ h$.
\end{proposition}
\begin{corollary}\label{scheme Noe reduced relative ample iff inverse if W=X}
If in \cref{scheme Noe reduced ample relative fg and fh} we have $W=X$, then for an invertible $\mathscr{O}_X$-module $\mathscr{L}$ to be ample relative to $f$, it is necessary and sufficient that $g^*(\mathscr{L})$ is ample relative to $f\circ g$.
\end{corollary}
\begin{remark}
We shall see in \cref{scheme cohomology chapter} that if $Y$ is Noetherian, $f$ is of finite type, and if the restriction of $f$ to the reduced closed subscheme of $X$ having $X-W$ as underlying space is proper, then the conclusion of \cref{scheme Noe reduced relative ample iff inverse if W=X} is still valid. But we will also give examples of algebraic schemes $X$ over a field $K$ (the structural morphism $X\to\Spec(K)$ not being proper) whose normalize $X'$ is quasi-affine, but which is not quasi-affine (so that $\mathscr{O}_X$ is not ample, although $\mathscr{O}_{X'}$ is, cf. \cref{scheme qc quasi-affine iff}, and that the morphism $g:X'\to X$ is finite and surjective (cf. \cref{scheme normalization finite if Japanese})). We will also see that this circumstance cannot occur when we replace "quasi-affine" by "affine" (by Chevalley's theorem).
\end{remark}
\subsection{Chevally's theorem}
\begin{lemma}\label{scheme morphism integral Noe finite surjective X_s prop}
Let $X,Y$ be integral Noetherian schemes, $x$ (resp. $y$) be the generic point of $X$ (resp. $Y$), and $f:X\to Y$ be a finite and surjective morphism. Let $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module such that there exists an affine neighborhood $U$ of $y$ and a section $s\in\Gamma(X,\mathscr{L})$ such that $x\in X_s\sub f^{-1}(U)$. Then there exist integers $m,n>0$, a homomorphism $u:\mathscr{O}_Y^m\to f_*(\mathscr{L}^{\otimes n})$ and an open neighborhood $V$ of $y$ such that the restriction $u|_V$ is an isomorphism $\mathscr{O}_Y^m|_V\stackrel{\sim}{\to} f_*(\mathscr{L}^{\otimes n})|_V$.
\end{lemma}
\begin{theorem}[\textbf{Chevalley}]\label{scheme affine Chevalley theorem}
Let $X$ be an affine scheme, $Y$ be a Noetherian scheme, and $f:X\to Y$ be a finite and surjective morphism. Then $Y$ is an affine scheme.
\end{theorem}
\begin{proof}
It is clear that $f_{\red}:X_{\red}\to Y_{\red}$ is fiite (\cref{scheme morphism integral finite permanence prop}(\rmnum{6})); as $X_{\red}$ is an affine scheme, and $Y$ is affine if and only if $Y_{\red}$ is (\cref{scheme Noetherian affine iff red is}), we can assume that $X,Y$ are reduced. For any closed subset $Y'$ of $Y$, there is then a unique reduced subscheme subscheme structure on $Y'$ whose inverse image $f^{-1}(Y')$, canonically isomorphic to $X\times_YY'$, is affine as a closed subscheme of $X$, and the restriction of $f$ to $f^{-1}(Y')$, which is identified with $f\times_Y1_{Y'}$, is a finite and surjective morphism (\cref{scheme surjective stable under base change} and \cref{scheme morphism integral finite permanence prop}(\rmnum{4})). In view of the Noetherian induction principle (\cref{topo Noe induction principle}), we are then (in view of \cref{scheme Noetherian affine iff red is}) reduced to prove the theorem under the hypothesis that for any closed subset $Y'\neq Y$, any closed subscheme of $Y$ with underlying space $Y'$ is affine. With this hypothesis, we first note that, for any coherent $\mathscr{O}_Y$-module $\mathscr{F}$ whose support (closed) $Z$ is distinct from $Y$, we have $H^1(Y,\mathscr{F})=0$. In fact, there exists a closed subscheme structure on $Z$ such that, if $j:Z\to Y$ is the canonical injection, we have $\mathscr{F}=j_*(j^*(\mathscr{F}))$ (\cref{scheme qc qcoh ft direct image of inverse prop} and \cref{scheme affine Noe coh sheaf char}), and therefore $H^1(Y,\mathscr{F})=H^1(Z,j^*(\mathscr{F}))=0$ (\cref{scheme morphism affine H^1 and direct image}, since $j$ is affine).\par
Suppose first that $Y$ is not irreducible, and let $Y'$ be an irreducible component of $Y$; we endow $Y'$ with the reduced subscheme structure, and let $j:Y'\to Y$ be the canonical injection. Let $\mathscr{F}$ be a coherent $\mathscr{O}_Y$-module, and consider the canonical homomorphism
\[\rho:\mathscr{F}\to\mathscr{F}'=j_*(j^*(\mathscr{F}));\]
Since $j$ is proper and $Y',Y$ are Noetherian schemes, $\mathscr{F}'$ is a coherent $\mathscr{O}_Y$-module by \cref{sheaf of module coh pullback if coh sheaf of ring} (since we have $j_*(\mathscr{O}_{Y'})=\mathscr{O}_Y/\mathscr{I}$, where $\mathscr{I}$ is the quasi-coherent ideal of $\mathscr{O}_Y$ defining the subscheme $Y'$), so $\mathscr{G}=\ker\rho$ and $\mathscr{K}=\im\rho$ are coherent $\mathscr{O}_Y$-modules (\cref{sheaf of module coh prop}). On the other hand, by definition the fiber $\mathscr{F}'_y$ of $\mathscr{F}'$ at the generic point $y$ of $Y'$ is equal to $\mathscr{F}_y/\mathscr{I}_y\mathscr{F}_y$, and hence to $\mathscr{F}_y$ (\cref{scheme Noe stalk of ideal defining irre component}), so $y$ is not contained in the support of $\mathscr{G}$ and we conclude that $H^1(Y,\mathscr{G})=0$. Since the support of $\mathscr{F}'$ (and a fortiori that of $\mathscr{K}$) is contained in $Y'$, it is distinct from $Y$, and we also conclude that $H^1(Y,\mathscr{K})=0$. From the exact sequence $0\to\mathscr{G}\to\mathscr{F}\to\mathscr{K}\to 0$ we then get $H^1(Y,\mathscr{F})=0$, so by Serre's criterion $Y$ is then affine.\par
Suppose now that $Y$ is irreducible, and therefore integral. We can also assume that $X$ is integral: in fact, if we denote by $X_i$ the reduced closed subschemes of $X$ with underlying spaces the irreducible components of $X$ and by $f_i:X_i\to Y$ the restriction of $f$ to $X_i$, then one of $f_i$ is dominant ($Y$ is irreducible, so if its generic point is contained in the image of $f_i$, then $f_i$ is dominant, and we note that $f$ is surjective), and as there are finite morphisms (\cref{scheme morphism integral finite permanence prop}), it is surjective (\cref{scheme morphism integral is universally closed}); as $X_i$ is an affine scheme, we see that we can replace $X$ by $X_i$. In this case, we can apply \cref{scheme morphism integral Noe finite surjective X_s prop} to $\mathscr{L}=\mathscr{O}_X$, since $X$ is affine, to obtain a homomorphism $u:\mathscr{O}_Y^m\to f_*(\mathscr{L})=\mathscr{B}$ and an open neighborhood $V$ of $y$ such that $u|_V$ is an isomorphism. In view of Serre's criterion, it suffices to prove that for any coherent $\mathscr{O}_Y$-module $\mathscr{F}$ such that $\mathscr{F}\sub\mathscr{O}_Y$, we have $H^1(Y,\mathscr{F})=0$. We note that then $\mathscr{F}$ is torsion free since $Y$ is integral, and we only need to show that $H^1(Y,\mathscr{F})=0$ for any torsion free coherent $\mathscr{O}_Y$-module $\mathscr{F}$. Now the homomorphism $u$ defines a homomorphism
\[v:\mathscr{G}=\sHom_{\mathscr{O}_Y}(\mathscr{B},\mathscr{F})\to\sHom_{\mathscr{O}_Y}(\mathscr{O}_Y^m,\mathscr{F})=\mathscr{F}^m.\]
By hypotheses the support of $\mathscr{T}=\coker u$ does not meet $V$, so is a torsion $\mathscr{O}_Y$-module (\cref{scheme integral qcoh ft torsion iff}). From the exact sequence $\mathscr{O}_Y^m\to\mathscr{B}\to\mathscr{T}\to 0$ induces, by the left exactness of $\sHom_{\mathscr{O}_Y}$, an exact sequence
\[\begin{tikzcd}
0\ar[r]&\sHom_{\mathscr{O}_Y}(\mathscr{T},\mathscr{F})\ar[r]&\mathscr{G}\ar[r,"v"]&\mathscr{F}^m
\end{tikzcd}\]
But as $\mathscr{F}$ is torsion free and $\mathscr{T}$ is torsion, we have $\sHom_{\mathscr{O}_Y}(\mathscr{T},\mathscr{F})=0$, so $v$ is injective. We then obtain an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{G}\ar[r]&\mathscr{F}^m\ar[r]&\coker v\ar[r]&0
\end{tikzcd}\]
where $\mathscr{G}$ and $\coker v$ are coherent $\mathscr{O}_Y$-modules (\cref{sheaf of module coh prop}). In view of the exact sequence on cohomology, it suffices to prove that $H^1(Y,\mathscr{F})=H^1(Y,\coker v)=0$ since this implies $H^1(Y,\mathscr{F}^m)=(H^1(Y,\mathscr{F}))^m=0$, so $H^1(Y,\mathscr{F})=0$. Now the restriction $v|_V$ is an isomorphism, so the support of $\coker v$ is distinct from $Y$, and we have $H^1(Y,\coker v)=0$ by our hypothesis. On the other hand, $\mathscr{G}$ is a coherent $\mathscr{B}$-module by \cref{scheme local Noe qcoh finite type algebra coh module iff}; as $X$ is affine over $Y$, there exists a quasi-coherent $\mathscr{O}_X$-module $\mathscr{K}$ such that $\mathscr{G}$ is isomorphic to $f_*(\mathscr{K})$ (\cref{scheme S-affine functor A on qcoh dense}), and since $H^1(X,\mathscr{K})=0$ ($X$ is affine), we then have $H^1(Y,\mathscr{G})=0$ by \cref{scheme qc qcoh ft direct image of inverse prop}, which completes the proof.
\end{proof}
\begin{corollary}\label{scheme Noe affine iff over closed finite covering}
Let $X$ be a Noetherian scheme and $(X_i)_{1\leq i\leq n}$ be a finite covering of $X$ by closed subsets. Then for $X$ to be affine, it is necessary and sufficient that for each $i$, there exists a closed subscheme of $X$ that is affine and has underlying space $X_i$. 
\end{corollary}
\begin{proof}
Let $X'$ be the sum of the $X_i$, then it is clear that $X'$ is affine if each $X_i$ is affine, and we have a surjective morphism $f:X'\to X$ whose restriction to $X_i$ is the canonical injection. To apply \cref{scheme affine Chevalley theorem}, it remains to verifying that $f$ is finite, and this follows from \cref{scheme morphism integral finite permanence prop}(\rmnum{1}).
\end{proof}
\section{Valuative criterion}
In this section we give the valuative criterion of sparation and properness of a morphis, which are criteria which involve a auxiliary scheme $\Spec(A)$, where $A$ is a valuation ring. With a convenient "Noetherian" hypothesis, these criterion can be refined to the case where $A$ is a discrete valuation ring, and this will probably be the only case that we will apply later.
\subsection{Remainders for valuation rings}
Among the vast properties that characterize valuation rings, we shall use the following one: a ring $A$ is called a valuation ring if it is an integral domain which is not a field, and if in the set of proper local rinng contained in the fraction field $K$ of $A$, $A$ is maximal under the dominant relation. Recall that a valuation ring is integrally closed. If $A$ is a valuation ring, then $A_\p$ is also a valuation ring for any nonzero prime ideal $\p\neq 0$.\par
Let $K$ be a field, $A$ be a proper local subring of $K$; then there exists a valuation ring of $K$ dominating $A$ (\cref{valuation ring dominate prop}). On the other hand, let $B$ be a valuation ring, $k$ be its residue field, and $K$ be the fraction field, $L$ be an extension of $k$. Then there exists a complete valuation ring $C$ dominating $B$ with residue field equals to $L$. In fat, $L$ is an algebraic extension of a purely transcendental extension $L'=k(T_\mu)_{\mu\in M}$; we can extend the valuation of $K$ corresponding to $B$ to a valuation of $K'=K(T_\mu)_{\mu\in M}$ with residue field $L'$; replace $B$ by this complete valuation ring $C$, we can assume then that $B$ is complete that $L$ is an algebraic closure of $k$. If $\widebar{K}$ is an algebraic closure of $K$, we can then extend the defining valuation of $B$ to $\widebar{K}$, and the corresponding residue field is an algebraic closure of $k$, as can be seen by lifting the coefficients of a monic polynomial of $k[T]$ to $\widebar{K}$. We are therefore finally reduced to the case where $L=k$ and it suffices then to take for $C$ the completion of $B$ to answer the question.\par
Let $K$ be a field and $A$ be a subring of $K$; the integral closure $A'$ of $A$ in $K$ is the intersection of valuation rings of the fraction field of $A$ containing $A$ (\cref{integral closure is intersection of valuation ring}). The preceding argument then have the following geometric form:
\begin{proposition}\label{scheme morphism from valuation specturm char}
Let $Y$ be a scheme, $p:X\to Y$ be a morphism, $x$ be a point of $X$, $y=p(x)$, and $y'\neq y$ be a specialization of $y$. Then there exists a local scheme $Y'$, which is the specturm of a valuation ring, and a separated morphism $f:Y'\to Y$ such that, if $a$ is the unique closed point of $Y'$ and $b$ is the generic point of $Y'$, we have $f(a)=y'$ and $f(b)=y$. We can moreover suppose that one of the following additional conditions are satisfied:
\begin{enumerate}
\item[(\rmnum{1})] $Y'$ is the specturm of a complete valuation ring whose residue field is algebraically closed, and there exists a $\kappa(y)$-homomorphism $\kappa(x)\to\kappa(b)$.
\item[(\rmnum{2})] There exists a $\kappa(y)$-isomorphism $\kappa(x)\cong\kappa(b)$.
\end{enumerate}
\end{proposition}
\begin{proof}
Let $Y_1$ be the reduced closed subscheme of $Y$ with $\widebar{\{y\}}$ as underlying space, and $X_1$ be the closed subscheme $p^{-1}(Y_1)$; as $y'\in\widebar{\{y\}}$ by hypothesis and $\kappa(x)$ is the same for $X$ and $X_1$, by replacing $Y$ with $Y_1$ and $X$ with $X_1$, we can suppose that $Y$ is integral with generic point $y$; $\mathscr{O}_{Y,y'}$ is then an integral local ring which is not a field, whose fraction field is $\mathscr{O}_{Y,y}=\kappa(y)$, and $\kappa(x)$ is an extension of $\kappa(y)$. To realize the conditions $f(a)=y'$ and $f(b)=y$ with the additional condition (\rmnum{1}) (resp. (\rmnum{2})), we choose $Y'=\Spec(A')$, where $A'$ is a valuation ring dominating $\mathscr{O}_{Y,y'}$ and which is complete and with residue field an algebraically closed extension of $\kappa(x)$ (resp. a valuation ring dominating $\mathscr{O}_{Y,y'}$ with fraction field $\kappa(x)$); the existence of such rings are proved by the above remarks.
\end{proof}
Recall that a local ring $(A,\m)$ is of dimension if and only if any prime ideal of $A$ distinct from $\m$ is minimal; if $A$ is integral, this means $\m$ and $(0)$ are the only prime ideals, and $\m\neq(0)$; equivalent, $Y=\Spec(A)$ is reduced to two points $a,b$: $a$ is the closed point, $\p_a=\m$, and $\kappa(a)=k$ is the residue field $A/\m$;
$b$ is the generic point of $Y$, $\p_b=(0)$, the set $\{b\}$ is the unique nontrivial open subset of $Y$, and $\kappa(b)=K$ is the fraction field of $A$. For an integral Noetherian local ring $A$ of dimension $1$, the following conditions are then equivalent: 
\begin{enumerate}
\item[(\rmnum{1})] $A$ is normal;
\item[(\rmnum{2})] $A$ is regular;
\item[(\rmnum{3})] $A$ is a valuation ring.
\end{enumerate}
Moreover, if these are ture, $A$ is then a discrete valuation ring.
\begin{proposition}\label{DVR dominating exist for local Noe domain}
Let $A$ be a Noetherian local integral domain which is not a field, $K$ be its fraction field, $L$ be a extension of $K$ of finite type. There then exists a discrete valuation ring of $L$ dominating $A$.
\end{proposition}
\begin{proof}

\end{proof}
\begin{corollary}\label{integral closure of Noe intersection of DVR}
Let $A$ be an integral Noetherian ring, $K$ be its fraction field, and $L$ be an extension of $K$ of finite type. Then the integral closure of $A$ in $L$ is the intersection of discrete valuation rings of $L$ containing $A$.
\end{corollary}
\begin{proposition}\label{scheme morphism from DVR specturm char}
Let $Y$ be a locally Noetherian scheme, $p:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$, $y=p(x)$, $y'\neq y$ be a specialization of $y$. Then there exists a local scheme $Y'$, which is a specturm of a discrete valuation ring, and a separated morphism $f:Y'\to Y$ and rational $Y$-map $g:Y'\dashrightarrow X$ such that, if $a$ is the closed point of $Y'$ and $b$ is the generic point, we have $f(a)=y'$, $f(b)=y$, $g(b)=x$, and in the following commutative diagram
\[\begin{tikzcd}
&\kappa(x)\ar[ld,swap,"\gamma"]\\
\kappa(b)&\kappa(y)\ar[u,swap,"\pi"]\ar[l,"\varphi"]
\end{tikzcd}\]
(whee $\pi,\varphi,\gamma$ are the homomorphisms corresponding to $p,f$ and $g$), $\gamma$ is a bijection.
\end{proposition}
\begin{proof}

\end{proof}
\subsection{Valuative criterion of separation}
\begin{proposition}[\textbf{Valuative Criterion of Separation}]\label{scheme morphism qs valuative criterion}
Let $Y$ be a scheme (resp. a locally Noetherian scheme), $f:X\to Y$ be a morphism (resp. a morphism locally of finite type). The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is separated.
\item[(\rmnum{2})] $f$ is quasi-separated and for any $Y$-scheme of the form $Y'=\Spec(A)$, where $A$ is a valuation ring (resp. a discrete valuation ring), two $Y$-morphisms of $Y'$ to $X$ which coincide at the generic point of $Y'$ are equal.
\item[(\rmnum{3})] $f$ is quasi-seaprated and for any $Y$-scheme of the form $Y'=\Spec(A)$, where $A$ is a valuation ring (resp. a discrete valuation ring), two $Y'$-sections of $X'=X_{(Y')}$ which coincide at the generic point of $Y'$ are equal.
\end{enumerate}
\end{proposition}
\begin{proof}
The equivalence of (\rmnum{2}) and (\rmnum{3}) follows from the correspondence of $Y$-morphisms $Y'\to X$ and $Y'$-sections of $X'$. If $X$ is separated over $Y$, condition (\rmnum{2}) follows from the proof of \cref{scheme reduced to separated rational extend to domain}, since $Y'$ is integral. It then remains to prove that condition (\rmnum{2}) implies that the diagonal morphism $\Delta:X\to X\times_YX$ is closed, and for this we can use \cref{scheme morphism qc closed iff specialization}. Now, let $z$ be a point of the diagonal $\Delta(X)$, $z'\neq z$ be a specialization of $z$ in $X\times_YX$. Then there exists by \cref{scheme morphism from valuation specturm char} a valuation ring $A$ and a morphism $g:Y'\to X\times_YX$ such that $g(a)=z'$, $g(b)=z$ (with the notations of \cref{scheme morphism from valuation specturm char}, $a$ is the closed point of $Y'$ and $b$ is the generic point of $Y'$); this morphism makes $Y'$ an $(X\times_YX)$-scheme, and a fortiori a $Y$-scheme. If we compose $g$ with the two projections of $X\times_YX$, we obtain two $Y$-morphisms $g_1,g_2:Y'\to X$, which by hypotheses send the point $b$ to the same point in $X$; in view of (\rmnum{2}), these two morphisms coincide with a morphism $h:Y'\to X$, which signifies that $g$ factors into $g=\Delta\circ h$, and therefore $z'\in\Delta(X)$. If we suppose that $Y$ is locally Noetherian and $f$ is of finite type, $X\times_YX$ is locally Noetherian by \cref{scheme morphis local ft local Noe base change is local Noe}, and we can therefore replace \cref{scheme reduced to separated rational extend to domain} by \cref{scheme morphism from DVR specturm char}.
\end{proof}
The condition (\rmnum{2}) of \cref{scheme morphism qs valuative criterion} signifies that if $Y'=\Spec(A)$ and $X'=\Spec(K)$ where $K$ is the fraction field of $A$, the canonical map
\[\Hom_Y(Y',X)\to\Hom_Y(X',X)\]
is injective. Equivalently, this means in the following diagram
\[\begin{tikzcd}
X'\ar[d]\ar[r]&X\ar[d,"f"]\\
Y'\ar[ru,dashed]\ar[r]&Y
\end{tikzcd}\]
the dashed morphism $Y'\to X$, if exists, is necessarily unique.
\begin{remark}
In the criterion (\rmnum{2}) of \cref{scheme morphism qs valuative criterion}, we can restrict ourselves to valuation rings $A$ which is complete whose residue field is algebraically closed; this follows from the additional condition (\rmnum{1}) of \cref{scheme reduced to separated rational extend to domain}.
\end{remark}
\subsection{Valuative criterion of properness}
\begin{proposition}\label{scheme morphism from valuation specturm iso if}
Let $A$ be a valuation ring, $Y=\Spec(A)$, $b$ be the generic point of $Y$. Let $X$ be an integral and separated scheme and $f:X\to Y$ be a closed morphism such that $f^{-1}(b)$ is reduced to a point $x$ and the corresponding homomorphism $\kappa(b)\to\kappa(x)$ is bijective. Then $f$ is an isomorphism.
\end{proposition}
\begin{proof}
As $f$ is closed and dominant, we have $f(X)=Y$; it then suffices to prove that for any $y'\neq b$ in $Y$, there exists a unique point $x'$ such that $f(x')=y'$ and the corresponding homomorphism $\mathscr{O}_{Y,y'}\to\mathscr{O}_{X,x'}$ is bijective, because $f$ is then a homeomorphism. Now, if $f(x')=y'$, $\mathscr{O}_{X,x'}$ is a local ring contained in $K=\kappa(x)=\kappa(y)$ and dominates $\mathscr{O}_{Y,y'}$; the later is the local ring $A_{y'}$, which a valuation ring for the fraction field $K$ of $A$. But $\mathscr{O}_{X,x'}\neq K$ since $x'$ is not the generic point of $X$, and we then conclude that $\mathscr{O}_{X,x'}=\mathscr{O}_{Y,y'}$ by maximality. As $X$ is an integral scheme, the relation $\mathscr{O}_{X,x'}=\mathscr{O}_{X,x''}$ implies $x'=x''$ by \cref{scheme integral separate criterion}, which proves our claim.
\end{proof}
Let $A$ be a valuation ring, $Y=\Spec(A)$, $b$ the generic point of $Y$, so that $\mathscr{O}_{Y,b}=\kappa(b)$ is equal to the fraction field $K$ of $A$. Let $f:X\to Y$ be a morphism. We have seen that the rational $Y$-sections of $X$ correspond to the germs of $Y$-sections (defined over a neighborhood of $b$) at $b$, whence a canonical map
\begin{align}\label{scheme rational section over valuation ring map-1}
\Gamma_{\rat}(X/Y)\to\Gamma(f^{-1}(b)/\Spec(K))
\end{align}
where the elements of $\Gamma(f^{-1}(b)/\Spec(K))$ are identified with the rational points of $f^{-1}(b)=X\otimes_AK$ over $K$. If $f$ is separted, it then follows from \cref{scheme separated over integral base section uniquely determine} that the map of (\ref{scheme rational section over valuation ring map-1}) is injective, since $Y$ is integral.\par
Composing (\ref{scheme rational section over valuation ring map-1}) with the canonical map $\Gamma(X/Y)\to\Gamma_{\rat}(X/Y)$, we then obtain a canonical map
\begin{align}\label{scheme rational section over valuation ring map-2}
\Gamma(X/Y)\to\Gamma(f^{-1}(b)/\Spec(K)).
\end{align}
If $f$ is separated, this map is injective by \cref{scheme separated over integral base section uniquely determine}.
\begin{proposition}\label{scheme section over valaution bijective if}
Let $A$ be a valuation ring with fraction field $K$, $Y=\Spec(A)$, $b$ be the generic point of $Y$, and $f:X\to Y$ be a separated and closed morphism. Then the canonical map (\ref{scheme rational section over valuation ring map-2}) is bijective.
\end{proposition}
\begin{proof}
Let $x$ be a rational point of $f^{-1}(b)$ over $K$. As $f$ is separated, so is the morphism $f^{-1}(b)\to\Spec(K)$ corresponding to $f$ (\cref{scheme morphism separated permanence prop}(\rmnum{4})), since and any section of $f^{-1}(b)$ a closed immersion by \cref{scheme morphism to separated graph is closed}, $\{x\}$ is closed in $f^{-1}(b)$. Consider the reduced closed subscheme $X'$ of $X$ with underlying space $\widebar{\{x\}}$ of $\{x\}$ in $X$. It is clear that the restriction of $f$ to $X'$ satisfies the conditions of \cref{scheme morphism from valuation specturm iso if} (note that since $x$ is rational over $K$, we have $\kappa(x)=K$), hence an isomorphism from $X'$ to $Y$, whose inverse isomorphism is the $Y$-section of $X$ we want.
\end{proof}
Recall that if $F$ is a subset of the scheme $Y$, the codimension of $F$ in $Y$ is equal to the infimum of $\dim(\mathscr{O}_{Y,z})$ where $z\in F$ (this can be easily verified after reducing to affine case), and we denote this number by $\codim_Y(F)$.
\begin{corollary}\label{scheme local Noe section not defined codim prop}
Let $Y$ be a reduced locally Noetherian scheme such that the subset $N$ of $y\in Y$ where $Y$ is not regular has codimension $\geq 2$. Let $f:X\to Y$ be a separted and closed morphism of finite type and $g$ be a rational $Y$-section of $X$. If $Y'$ is the set of points of $Y$ where $g$ is not defined, then $\codim_Y(Y')\geq 2$.
\end{corollary}
\begin{proof}
It suffices to prove that $g$ is defined at any point $y\in Y$ such that $\dim(\mathscr{O}_{Y,y})\leq 1$. If $\dim(\mathscr{O}_{Y,y})=0$, then $y$ is the generic point of an irreducible component of $Y$. For any open dense subset $V$ of $Y$, by restricting to an affine neighborhood of $y$ and apply \cref{topo space open dense intersect irre component}, we conclude that $V$ contains $y$. In particular, $y$ belongs to the defining domain of $g$. Suppose now that $\dim(\mathscr{O}_{Y,y})=1$; then $\mathscr{O}_{Y,y}$ is a regular local ring, hence a discrete valuation ring. Let $Z=\Spec(\mathscr{O}_{Y,y})$; as $U=Y-Y'$ is open and dense, by \cref{scheme local scheme correspond generalization} and our preceding arguments, $U\cap Z$ is nonempty (contains the generic of an irreducible component of $Y$ containing $y$), so we can consider the rational map $g':Z\dashrightarrow X$ induced by $g$. It then suffices to prove that $g'$ is a morphism (\cref{scheme reduced to separated rational map define iff on local}). Now, $g'$ can be considered as a rational $Z$-section of the $Z$-scheme $f^{-1}(Z)=X\times_YZ$; it is clear that the morphism $f^{-1}(Z)\to Z$ corresponding to $f$ is closed, and is separted by \cref{scheme morphism separated permanence prop}(\rmnum{1}). We then conclude from \cref{scheme section over valaution bijective if} that $g'$ is everywhere defined, and as $Z$ is reduced and $X$ is separated over $Y$, $g'$ is a morphism (\cref{scheme reduced to separated rational extend to domain}).
\end{proof}
\begin{corollary}\label{scheme local Noe rational map not defined codim prop}
Let $S$ be a locally Noetherian scheme, $X,Y$ be $S$-scheme, and assume that $X$ is proper over $X$. Suppose that $Y$ is reduced and the subset $N$ of $y\in Y$ where $Y$ is not regular has codimension $\geq 2$. Let $f:Y\dashrightarrow X$ be a rational map and $Y'$ be the set of points where $f$ is not defined, then $\codim_Y(Y')\geq 2$.
\end{corollary}
\begin{proof}
The rational $S$-maps $Y\dashrightarrow X$ correspond to rational $Y$-sections of $X\times_SY$; as the structural morphism $X\times_SY\to Y$ is closed by \cref{scheme morphism proper permanence prop}, we can apply \cref{scheme local Noe section not defined codim prop}, whence the corollary.
\end{proof}
\begin{remark}
The hypothesis on $Y$ in \cref{scheme local Noe section not defined codim prop} and \cref{scheme local Noe rational map not defined codim prop} are satisfied in particular if $Y$ is normal (by Serre's criterion for normality). 
\end{remark}
\begin{theorem}[\textbf{Valuative Criterion of Properness}]\label{scheme morphism qc sp proper valuative criterion}
Let $Y$ be a (resp. locally Noetherian) scheme  and $f:X\to Y$ be a quasi-compact and separted morphism (resp. a quasi-compact morphism of finite type). The following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is universally closed (resp. proper)
\item[(\rmnum{2})] For any $Y$-scheme $Y'=\Spec(A)$ where $A$ is a valuation ring (resp. a discrete valuation ring) with fraction field $K$, the canonical map (where $X'=\Spec(K)$)
\[\Hom_Y(Y',X)\to\Hom_Y(\Spec(K),X)\]
corresponding to the cannical injection $A\to K$, is surjective (resp. bijective).
\item[(\rmnum{3})] For any $Y$-scheme $Y'=\Spec(A)$ where $A$ is a valuation ring (resp. a discrete valuation ring) with fraction field $K$, the canonical map of (\ref{scheme rational section over valuation ring map-2}) relative to the $Y'$-scheme $X'=X_{(Y')}$ is surjective (resp. bijective).
\end{enumerate}
\end{theorem}
\begin{proof}
The equivalence of (\rmnum{2}) and (\rmnum{3}) follows from the correspondence of $Y$-morphisms $Y'\to X$ and $Y'$-morphisms $Y'\to X'$. If $f$ is universally closed then $f_{(Y')}$ is closed and separated, and it then suffices to apply \cref{scheme section over valaution bijective if}. It remains to prove that (\rmnum{2}) implies (\rmnum{1}). Consider first the case where $Y$ is arbitrary, $f$ is separated and quasi-compact. If the condition of (\rmnum{2}) is satisfied for $f$, it is also true for $f_{(Y'')}:X_{(Y'')}\to Y''$, where $Y''$ is an arbitrary $Y$-scheme, in view of the equivalent of (\rmnum{2}) and (\rmnum{3}), and the fact that $X_{(Y'')}\times_{Y''}Y'=X\times_YY'$ for any morphism $Y'\to Y''$; as $f_{(Y'')}$ is also quasi-compact and separated, we then conclude that we only need to prove (\rmnum{2}) implies $f$ is closed, and for this we shall use \cref{scheme morphism qc closed iff specialization}. Let $x\in X$, $y'\neq y$ be a specialization of $y=f(x)$; in view of \cref{scheme morphism from valuation specturm char}, there is a scheme $Y'=\Spec(A)$ where $A$ is a valuation ring, and a separated morphism $g:Y'\to Y$ such that, if $a$ is the closed point and $b$ is the generic point of $Y$, we have $g(a)=y'$, $g(b)=y$, and there exists a $\kappa(y)$-hommorphism $\kappa(x)\to\kappa(b)$. This homomorphism corresponds to a canonical $Y$-morphism $\Spec(\kappa(b))\to X$ (\cref{scheme local of field morphism factors through prop}), and it then follows from condition (\rmnum{2}) that there exists a $Y$-morphism $h:Y'\to X$ which corresponds the previous morphism such that the following diagram commutes
\[\begin{tikzcd}
\Spec(\kappa(b))\ar[d]\ar[r]&X\ar[d,"f"]\\
\Spec(A)\ar[r,"g"]&Y
\end{tikzcd}\]
We then have $h(b)=x$, and if we put $h(a)=x'$, $x'$ is then a specialization of $x$, and we have $f(x')=f(h(a))=g(a)=y'$.\par
If now $Y$ is locally Noetherian and $f$ is a quasi-compact morphism of finite type, then condition (\rmnum{2}) implies that $f$ is separated (\cref{scheme morphism qs valuative criterion}), so the diagonal morphism $\Delta:X\to X\times_YX$ is quasi-compact. Moreover, to verify that $f$ is proper, it suffices to show that $f_{(Y'')}:X_{(Y'')}\to Y''$ is closed for any $Y$-scheme $Y''$ of finite type (\cref{scheme proper over local Noe iff base change closed}). As then $Y''$ is locally Noetherian, we can resume the reasoning given in the first case by taking for $Y'$ the specturm of discrete valuation ring, and applying \cref{scheme morphism from valuation specturm char} instead of \cref{scheme morphism from DVR specturm char}.
\end{proof}
\begin{remark}
We deduce from the criterion (\rmnum{3}) of \cref{scheme morphism qc sp proper valuative criterion} a new proof of the fact that a projective morphism $X\to Y$ is closed, which is closer to classical methods. We can in fact assume that $Y$ is affine, and $X$ is therefore a closed subscheme of a projective bundle $\P^n_Y$ (\cref{scheme quasi-projective over qcqs iff subscheme of P^n}). To show that $X\to Y$ is closed, it suffices to verify that the structural morphism $\P^n_Y\to Y$ is closed. The criterion (\rmnum{3}) of \cref{scheme morphism qc sp proper valuative criterion}, together with (\ref{scheme prjective bundle base change prop}), show that we are reduced to proving the following fact: if $Y$ is the spectrum of a valuation ring $A$ with fraction field $K$, every point of $\P^n_Y$ with values in $K$ comes (by restriction to the generic point of $Y$) from a point of $\P^n_Y$ with values in $A$. Now, any invertible $\mathscr{O}_Y$-module is trivial, so it follows from \cref{scheme projective bundle over affine char} that a point of $\P^n_Y$ with values in $K$ is identified with a class of elements $(\xi c_0,\xi c_1,\dots,\xi c_n)$ of $K^{n+1}$, where $\xi\neq 0$ and the $c_i$ are elements of $K$ which generate the unit ideal of $K$. By multiplying the $c_i$ with an element of $A$, we can suppose that the $c_i$ belong to $A$, and generate the unit ideal of $A$. But then (\cref{scheme projective bundle over affine char}) the system $(c_0,\dots,c_n)$ defines a point of $\P^n_Y$ with values in $A$, whence our assertion.
\end{remark}
\begin{remark}
The criteria \cref{scheme morphism qs valuative criterion} and \cref{scheme morphism qc sp proper valuative criterion} are especially convenient when we consider a $Y$-scheme $X$ as a functor
\[X(Y')=\Hom_Y(Y',X)\]
where $Y'$ is a $Y$-scheme. These criteria will allow us, for example, to prove that under certain conditions the "Picard schemas" are proper.
\end{remark}
\begin{corollary}\label{scheme morphism over integral scheme valuative criterion}
Let $Y$ be a separated integral scheme (resp. a separated integral locally Noetherian scheme) and $f:X\to Y$ be a dominant morphism.
\begin{enumerate}
\item[(a)] If $f$ is quasi-compact and universally closed, any valuation ring with fraction field the rational function field $K(X)$ and which dominates a local ring of $Y$, also dominates a local ring of $X$.
\item[(b)] Conversely, suppose that $f$ is of finite type, and the property of (a) is satisfied for any valuation ring (resp. any discrete valuation ring) with fraction field $K(X)$. Then $f$ is proper.
\end{enumerate}
\end{corollary}
\begin{proof}
Assume the hypotheses of (a) and let $K=K(Y)$, $L=K(X)$, $y$ be a point of $Y$, $A$ be a valuation ring with $L$ the fraction field and dominate $\mathscr{O}_{Y,y}$. The injection $\mathscr{O}_{Y,y}\to A$ is local, so it defines a morphism
\[h:Y'=\Spec(A)\to\Spec(\mathscr{O}_{Y,y})\to Y\]
(\cref{scheme local morphism factors through prop}) such that $h(a)=y$, where $a$ is the closed point of $Y'$. Moreover, since $K\sub L$, the morphism $\Spec(A)\to\Spec(\mathscr{O}_{Y,y})$ is dominant, so if $\eta$ is the generic point of $Y$ (which is also that of $\Spec(\mathscr{O}_{Y,y})$), we have $h(b)=\eta$, where $b$ is the generic point of $Y'$. If $\xi$ is the generic point of $X$, we have $\kappa(\xi)=\kappa(b)=L$ by hypothesis, so there is a $Y$-morphism $g:\Spec(L)\to X$ such that $g(b)=\xi$. In view of \cref{scheme morphism qc sp proper valuative criterion}, we obtain a $Y$-morphism $g':Y'\to X$ such that $g(b)=\xi$. If we set $x=g'(a)$, then $A$ dominates $\mathscr{O}_{X,x}$.\par
We now prove (b); since the question is local over $Y$, we can assume that $Y$ is affine (resp. affine and Noetherian). As $f$ is of finite type, we can apply Chow's lemma, so there exists a projective morphism $p:P\to Y$, an immersion $j:X'\to P$, and a projective and surjective birational morphism $g:X'\to X$ (where $X'$ is integral) such that the diagram
\[\begin{tikzcd}
X'\ar[r,"j"]\ar[d,swap,"g"]&P\ar[d,"\pi"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
is commutative. It suffices to prove that $j$ is a closed immersion, because then $f\circ g=p\circ j$ is projective, hence proper, and as $g$ is surjective we conclude that $f$ is proper by \cref{scheme morphism proper cancelled prop}. Let $Z$ be a reduced closed subscheme of $P$ with underlying space $\widebar{j(X')}$; as $X'$ is integral, $j$ factors into
\[j:X'\stackrel{h}{\to}Z\stackrel{i}{\to}P\]
where $i:Z\to P$ is the canonical injection and $h:X'\to Z$ is a dominant open immersion. Since $Z$ is integral and projective over $Y$ by \cref{scheme morphism projective permanence prop}, we are then reduced to the case where $P$ is integral, $j$ is dominant and birational, and prove that $j$ is surjective. Now let $z\in P$; $\mathscr{O}_{Z,z}$ is an integral local ring (resp. Noetherian integral) whose fraction field is
\[L=K(P)=K(X')=K(X).\]
We can assume that $z$ is not the generic point of $P$ (since the later is contained in $j(Z)$ as $j$ is dominant), so $\mathscr{O}_{Z,z}\neq L$ and by \cref{valuation ring dominate prop} and \cref{DVR dominating exist for local Noe domain}, there exists a valuation ring (resp. a discrete valuation ring) $A$ with fraction field $L$ that dominates $\mathscr{O}_{Z,z}$. A fortiori $A$ dominates the local ring $\mathscr{O}_{Y,y}$ where $y=p(z)$, and by hypotheses there is then a point $x\in X$ such that $A$ dominates $\mathscr{O}_{X,x}$. As the morphism $g$ is proper, it satisfies the conditions of (a), so our previous arguments then prove that $A$ also dominates $\mathscr{O}_{X,x'}$, for some $x'\in X'$. Then the local rings $\mathscr{O}_{Z,z}$ and $\mathscr{O}_{Z,j(x')}=\mathscr{O}_{X,x'}$ are related, and by \cref{scheme integral separate criterion}, as $P$ is separated, we have $z=j(x')$, which completes the proof. 
\end{proof}
\begin{corollary}\label{scheme morphism dominant qcuc subring of integral closure}
Let $A$ be an integral domain, $Y=\Spec(A)$, and $f:X\to Y$ be a dominant morphism of integral schemes which is quasi-compact and universally closed. Then $\Gamma(X,\mathscr{O}_X)$ is canonically isomorphic to a subring of the integral closure of $A$ in $K(X)$. 
\end{corollary}
\begin{proof}
Recall that by (\ref{scheme integral section is intersection of stalk}), $B=\Gamma(X,\mathscr{O}_X)$ is indeitified with the intersection of $\mathscr{O}_{X,x}$ for $x\in X$. If $R$ is a valuation ring of $K(X)$ containing $A$, then it dominates the local ring $A_{\mathfrak{P}}$ where $\mathfrak{P}=\m_R\cap B$, and therefore by \cref{scheme morphism over integral scheme valuative criterion} dominates a local ring of $X$. Then $B$ is contained in $R$, and the conclusion follows from \cref{integral closure is intersection of valuation ring}.
\end{proof}
\begin{remark}
Under the hypothesis of \cref{scheme morphism dominant qcuc subring of integral closure}, if we suppose that $K(X)$ is a finite extension of $K(Y)$, then we can in many cases conclude that $\Gamma(X,\mathscr{O}_X)$ is a finitely generated module over the ring $B=\Gamma(Y,\mathscr{O}_X)$. This is the case for example if $B$ is a Japanese ring. In particular, if $X=\Spec(A)$ and $Y=\Spec(k)$ where $k$ is a algebraically closed field, then the the corresponding homomorphism $k\to A$ is injective by \cref{Spec of ring map dominant iff ker nilpotent} and since the integral closure of $k$ in $K(X)$ is equal to $k$, we conclude that $\Gamma(X,\mathscr{O}_X)=k$.
\end{remark}
\subsection{Algebraic curves}
Let $k$ be a field. In this paragraph, all schemes are considered to be separated $k$-schemes of finite type, and any morphism are $k$-morphism.
\begin{proposition}\label{scheme algebraic dimension 1 iff}
Let $X$ be a scheme of finite type over $k$; let $x_i$ ($1\leq i\leq n$) be the generic points of the irreducible components $X_i$ of $X$, and $K_i=\kappa(x_i)$. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] For each $i$, the transcendence degre of $K_i$ over $k$ is equal to $1$.
\item[(\rmnum{2})] For any closed point $x$ of $X$, the local ring $\mathscr{O}_{X,x}$ is of dimension $1$.
\item[(\rmnum{3})] The closed irreducible subsets of $X$ distinct from the $X_i$ are closed points of $X$.
\end{enumerate}
\end{proposition}
\begin{proof}
As $X$ is quasi-compact, any irreducible closed subset $F$ of $X$ contains a closed point (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 2.1.3). Let $x$ be a closed point of $X$; in view of \cref{scheme local scheme correspond generalization}, there is a correspondence between prime ideals of $\mathscr{O}_{X,x}$ and the irreducible closed subsets of $X$ containing $x$. The equivalence of (\rmnum{2}) and (\rmnum{3}) then follows. On the other hand, if $\p_\alpha$ ($1\leq\alpha\leq r$) is the minimal prime ideals of the local Noetherian ring $\mathscr{O}_{X,x}$, the local ring $\mathscr{O}_{X,x}/\p_\alpha$ are integral, whose fraction fields are the $K_i$ such that $x\in X_i$. Moreover, the dimension of a $k$-algebra of finite type is equal to its transcendental degree over $k$. Finally, the dimension of $\mathscr{O}_{X,x}$ is the supremum of the $\mathscr{O}_{X,x}/\p_\alpha$, and a $k$-algebra of finite type is catenary, so (\rmnum{1}) and (\rmnum{2}) are equivalent. 
\end{proof}
We note that under the conditions of \cref{scheme algebraic dimension 1 iff}, by \cref{scheme algebraic Artinian iff} that set $X$ is either empty of finite. We define an algebraic curve over $k$ to be a nonempty scheme $X$ over $k$ satisfying the conditions of \cref{scheme algebraic dimension 1 iff}. Equivalently, we will see that this condition is equivalent to that the irreducible components of $X$ has dimension $1$. In particular, we note that if $X$ is an algebraic curve over $k$, the reduced closed subschemes $X_i$ of $X$ with underlying spaces the irreducible components of $X$ are also algebraic curves over $k$.
\begin{corollary}\label{scheme algerbraic curve topology prop}
Let $X$ be an irreducible algebraic curve. Then the only non-closed point of $X$ is its generic point, the proper closed subsets of $X$ are the finite subsets of $X$, which are also the non dense subsets of $X$.
\end{corollary}
\begin{proof}
If a point $x\in X$ is not closed, then its closure is an irreducible closed subset of $X$, hence equal to $X$ by \cref{scheme algebraic dimension 1 iff}, so $x$ is the generic point of $X$. A proper closed subset $F$ of $X$ can not contain the generic point of $X$, so its points are all closed, hence T1, and by \cref{scheme artinian iff} we conclude that $F$ is finite and discrete. The closure of an infinite subset of $X$ is therefore necessarily equal to $X$, which proves the last assertion.
\end{proof}
If $X$ is an arbitrary algebraic curve, then by applying \cref{scheme algerbraic curve topology prop}, we conclude that the only non-closed points of $X$ are the generic points of the irreducible components of $X$.
\begin{corollary}\label{scheme morphism of curves dominant iff quasi-finite}
Let $X$ and $Y$ be irreducible algebraic curves over $k$ and $f:X\to Y$ be a $k$-morphism. Then for $f$ to be dominant, it is necessary and sufficient that $f^{-1}(y)$ is finite for any $y\in Y$.
\end{corollary}
\begin{proof}
If $f$ is not dominant, $f(X)$ is necessarily a finite subset of $Y$ by \cref{scheme algerbraic curve topology prop}, so it is not possible that $f^{-1}(y)$ is finite for any $y\in Y$ (since $X$ is an infinite set). Conversely, if $f$ is dominant, for any $y\in Y$ which is not the generic point $\eta$ of $Y$, $f^{-1}(y)$ is closed in $X$ since $\{y\}$ is closed in $Y$ (\cref{scheme algerbraic curve topology prop}); on the other hand, by hypotheses, $f^{-1}(y)$ does not contain the generic point of $X$, so is finite by \cref{scheme algerbraic curve topology prop}. Finally, to see that $f^{-1}(\eta)$ is finite, we note that the morphism $f$ is of finite type by \cref{scheme ft over local Noe base morphism is ft}, so the fiber $f^{-1}(\eta)$ is an irreducible scheme of finite type over $\kappa(\eta)$ with generic point $\xi$ (\cref{scheme morphism ft permanence prop}). As $\kappa(\xi)$ and $\kappa(\eta)$ are extensions of $k$ of finite type with transcendental degree $1$, it follows that $\kappa(\xi)$ is a finite extension of $\kappa(\eta)$, so $\xi$ is closed in $f^{-1}(\eta)$ by \cref{scheme morphism integral fiber finite discrete}, and $f^{-1}(\eta)$ is therefore reduced to a point $\xi$.
\end{proof}
\begin{remark}
We will see later that a proper morphism $f:X\to Y$ of Noetherian schemes, such that $f^{-1}(y)$ is finite for any $y\in Y$, is necessarily finite. It then follows from \cref{scheme algerbraic curve topology prop} that such a dominant proper morphism of irreducible algebraic curves is finite.
\end{remark}
\begin{corollary}\label{scheme algebraic curve regular iff normal}
Let $X$ be an algebraic curve over $k$. For $X$ to be regular, it is necessary and sufficient that $X$ is normal, or the local ring of its closed points are discrete valuation rings.
\end{corollary}
\begin{proof}
This comes from conditions (\rmnum{2}) of \cref{scheme algebraic dimension 1 iff}.
\end{proof}
\begin{corollary}\label{scheme algebraic curve integral closure norma finite}
Let $X$ be a reduced algebraic curve, $\mathscr{A}$ be a reduced coherent $\mathscr{K}_X$-algebra. Then the integral closure $X'$ of $X$ relative to $\mathscr{A}$ is a normal algebraic curve, and the canonical morphism $X'\to X$ is finite.  
\end{corollary}
\begin{proof}
The fact that $X'\to X$ is finite follows from \cref{scheme normalization finite if Japanese}, and $X'$ is then a normal algebraic scheme over $k$. Moreover, we note that if $X$ is irreducible with generic point $\xi$ and its integral closure $X'$ has generic point $\xi'$, then $\kappa(\xi')=\kappa(\xi)$ by \cref{scheme normalization generic point prop}, so $X'$ is also an algebraic curve over $k$.
\end{proof}
\begin{corollary}\label{scheme algebraic curve complete iff normalization}
For a reduced algebraic curve $X$ to be proper over $k$ (which is called \textbf{complete}), it is necessary and sufficient that the normalization $X'$ of $X$ is proper over $k$.
\end{corollary}
\begin{proof}
The canonical morphism $f:X'\to X$ is finite by \cref{scheme algebraic curve integral closure norma finite}, hence proper (\cref{scheme morphism finite is projective}) and surjective (\cref{scheme normalization generic point prop}). If $g:X\to\Spec(k)$ is the structural morphism, $g$ and $g\circ f$ are then simultaneously proper, in view of \cref{scheme morphism proper permanence prop} and \cref{scheme morphism proper cancelled prop}. 
\end{proof}
\begin{proposition}\label{scheme rational map curve to proper everywhere defined}
Let $X$ be a normal algebraic curve over $k$ and $Y$ be a proper algebraic scheme over $k$. Then any rational $k$-map $f:X\dashrightarrow Y$ is everywhere defined, hence a morphism.
\end{proposition}
\begin{proof}
It follows from \cref{scheme local Noe rational map not defined codim prop} that the set of points $x\in X$ where this rational map is not defined, the dimnesion of $\mathscr{O}_{X,x}$ is $\geq 2$, hence is empty. The assertion then follows from \cref{scheme reduced to separated rational extend to domain}. 
\end{proof}
\begin{corollary}\label{scheme normal algebraic curve quasi-projective}
A normal algebraic curve over $k$ is quasi-projective over $k$.
\end{corollary}
\begin{proof}
As $X$ is the sum of finitely many integral and normal algerbaic curves (\cref{scheme normalization generic point prop}), we can assume that $X$ is integral (\cref{scheme quasi-projective coproduct}). As $X$ is quasi-compact, it can be covered by finitely many affine opens $U_i$ ($1\leq i\leq n$), and as each of this is of finite type over $k$, there exists an integer $n_i$ and a $k$-immersion $f_i:U_i\to\P_k^{n_i}$ (\cref{scheme quasi-projective over qcqs iff subscheme of P^n} and \cref{scheme morphism quasi-projective permanence prop}(\rmnum{1})). As $U_i$ is dense in $X$ (recall that $X$ is integral by our assumption), it follows from \cref{scheme rational map curve to proper everywhere defined} that $f_i$ extends to a $k$-morphism $g_i:X\to\P_k^{n_i}$, and we obtain a $k$-morphism $g=(g_1,\dots,g_n)_k$ from $X$ into the product $P$ of the $\P_k^{n_i}$ over $k$. Moreover, for each index $i$, as the restriction of $g_i$ to $U_i$ is an immersion, so is the restriction of $g$ to $U_i$ (\cref{scheme local immersion stable under target product}). As the $U_i$ cover $X$ and $g$ is separated by \cref{scheme morphism separated permanence prop}(\rmnum{5}), $g$ is an immersion from $X$ into $P$ by \cref{scheme irre local immersion sp is immersion}. The Segre morphism then provides from $g$ an immersion of $X$ into a projective bundle $\P^n_k$, so $X$ is quasi-projective.
\end{proof}
\begin{corollary}\label{scheme normal algebraic curve completion exist}
A normal algebraic curve $X$ is isomorphic to a dense open subscheme of a normal and complete algebraic curve $\widehat{X}$, determined up to isomorphisms.
\end{corollary}
\begin{proof}
If $X_1,X_2$ are two normal and complete algebraic curves containing $X$ as open dense subscheme, it follows from \cref{scheme rational map curve to proper everywhere defined} there is an isomorphism of $X_1$ and $X_2$, whence the uniqueness of $\widehat{X}$. To prove the existence of $\widehat{X}$, it suffices to remark that we can consider $X$ as a subscheme of a projective bundle $\P_k^n$ (\cref{scheme normal algebraic curve quasi-projective}). Let $\widebar{X}$ be the scheme-theoretic closure of $X$ in $\P^n_k$ (\cref{scheme theoretic closure exist if qc}); as $X$ is an open and dense subscheme of $\widebar{X}$, the generic points $x_i$ of the irreducible components of $X$ are those of $\widebar{X}$, and the residue fields $\kappa(x_i)$ are the same for both schemes, so $\widebar{X}$ is an algebraic curve over $k$, which is reduced (\cref{scheme theoretic image exist if}) and projective over $k$ (\cref{scheme Proj closed immersion char}), hence complete by \cref{scheme projective and quasi-projective}. We then take $\widehat{X}$ to be the noramlization of $\widebar{X}$, which is complete by \cref{scheme algebraic curve complete iff normalization}. If $h:\widehat{X}\to\widebar{X}$ is the canonical morphism, the restriction of $h$ to $h^{-1}(X)$ is an isomorphism since $X$ is normal (\cref{scheme integral closure in qcoh alg over affine char}), and as $h^{-1}(X)$ contains the generic point of the irreducible components of $\widehat{X}$ (\cref{scheme normalization generic point prop}), it is therefore dense in $\widehat{X}$, which proves the assertion.
\end{proof}
\begin{remark}
We will later see that the conclusion of \cref{scheme normal algebraic curve completion exist} is still valid without assuming the algebraic curve to be normal (or even reduced); we will also see that for an algebraic curve (reduced or not) to be affine, it is necessary and sufficient that its irreducible (reduced) components are not complete.
\end{remark}
\begin{corollary}\label{scheme algebraic curve morphism and rational field extension}
Let $X$ be an irreducible normal algebraic curve with $L=K(X)$, $Y$ be a complete and integral algebraic curve with $K=K(Y)$. Then there exists a canonical correspondence between dominant $k$-morphisms $X\to Y$ and $k$-monomorphisms $K\to L$.
\end{corollary}
\begin{proof}
By \cref{scheme rational map curve to proper everywhere defined}, the rational $k$-maps $X\dashleftarrow Y$ are identified with $k$-morphisms $f:X\to Y$. The morphism $f$ is dominante if and only if $f(x)=y$, where $x$ and $y$ are the generic points of $X$ and $Y$, respectively. The corollary then follows from \cref{scheme irre rational map and local ring homomorphism}.
\end{proof}
\begin{example}\label{scheme algebraic curve P^1 eg}
We can precise the result of \cref{scheme algebraic curve morphism and rational field extension} if $Y$ is the projective line $\P^1_k=\Proj(k[T_0,T_1])$, where $T_0$ and $T_1$ are indeterminates. This is an integral and separated $k$-scheme, and the induced subscheme $D_+(T_0)$ of $Y$ is isomorphic to $\Spec(k[T])$, so the generic point of $Y$ is the ideal $(0)$ of $k[T]$ and its rational function field is $k(T)$, which shows that $Y$ is a complete algebraic cuver over $k$. Moreover, the only graded ideal of $S=k[T_0,T_1]$ containing $T_0$ and distinct from $S_+$ is the principal ideal $(T_0)$, so the complement of $D_+(T_0)$ in $Y$ is reduced to a closed point, called the "infinite point" and denoted by $\infty$. 
\end{example}
\begin{corollary}\label{scheme algebraic curve morphism to P^1 correspond}
Let $X$ be an irreducible normal algebraic curve with $K=K(X)$. Then there exists a canonical correspondence between $K$ and the set of morphisms $u:X\to\P_k^1$ which is distinct from the constant morphism with value $\infty$. For $u$ to be dominant, it is necessary and sufficient that the corresponding element in $K$ is transcendental over $k$.
\end{corollary}
\begin{proof}
By \cref{scheme irre rational map and local ring homomorphism} and \cref{scheme algebraic curve P^1 eg}, the rational maps $X\dashrightarrow\P^1_k$ (hence morphisms $X\to\P^1_k$, in view of \cref{scheme rational map curve to proper everywhere defined}) correspond to points of $\P^1_k$ with values in $K$. For any element $\xi\in K$, we have a induced homomorphism $k[T_0]\to K$ which maps $T_0$ to $\xi$, and therefore a morphism $\Spec(K)\to D_+(T_0)$. By composing with the canonical injection $D_+(T_0)\to\P^1_k$, we obtain a point of $\P^1_k$ with values in $K$ which is not located at $\infty$, which is completely determined by $\xi$ in view of \cref{scheme morphism to affine correspond}. On the other hand, by \cref{scheme local of field morphism factors through prop}, any constant morphism $u:\Spec(K)\to\P^1_k$ with value $y$ factors into
\[u:\Spec(K)\to\Spec(\kappa(y))\to\P^1_k.\]
Since $y\in D_+(T_0)$, the morphism $\Spec(\kappa(y))\to\P^1_k$ factors through the canonical injection $D_+(T_0)\to\P^1_k$, and $u$ therefore is obtained by morphism $\Spec(K)\to D_+(T_0)$, which corresponds to an element $\xi\in K$; this proves the first part of the corollary. For the morphism $u$ to be dominant, it is necessary that the morphism $\Spec(K)\to\Spec(k[T_0])\cong D_+(T_0)$ is dominant, which means the homomorphism $k[T]\to K$ is injective (\cref{Spec of ring map dominant iff ker nilpotent}), and this is true if and only if $\xi$ is transcendental.
\end{proof}
\begin{remark}\label{scheme algebraic curve morphism to P^1 correspond to rational field eg}
With the notations of \cref{scheme algebraic curve morphism to P^1 correspond}, we now determine the image of the morphism $\Spec(K)\to\P^1_k$ induced by an algerbaic element $\xi\in K$ over $k$. By definition, if $y\in\P^1_k$ is this image, the morphism factors into
\[\Spec(K)\to\Spec(\kappa(y))\to\Spec(k[T])\to\P^1_k\]
where we write $\Spec(k[T])$ for $D_+(T_0)$. We first note that any prime ideal in $k[T]$ is maximal, so $\kappa(y)=k[T]/\p_y$, and the morphism $\Spec(K)\to\Spec(\kappa(y))$ is identified with the canonical injection $k[T]/\p_y\to K$. By definition, this homomorphism is induced by the homomorphism $k[T]\to K,T\mapsto\xi$, so if $f(T)$ is the irreducible polynomial of $\xi$ over $k$, we have $\p_y=(f)$, and $y$ is therefore the point of $\Spec(k[T])$ corresponding to $(f)$. In particular, if $\xi\in k$, then $\p_y=(T-\xi)$, and if $k$ is an algebraically closed field, we conclude that any element $\xi\in k$ corresponds to a morphism $\Spec(K)\to\P^1_k$ with image $\xi$ (identified with its corresponding maximal ideal $(T-\xi)$), and any element $\xi\in K-k$ corresponds to a dominant morphism $\Spec(K)\to\P^1_k$.
\end{remark}
\begin{corollary}\label{scheme normal complete irr curve isomorphism char}
Let $X$ and $Y$ be normal, complete and irreducible algebraic curves, with $K=K(Y)$, $L=K(X)$. Then there exist a bijective correspondense between the set of $k$-isomorphisms $X\stackrel{\sim}{\to}Y$ and the set of $k$-isomorphisms $K\stackrel{\sim}{\to}L$.
\end{corollary}
\cref{scheme normal complete irr curve isomorphism char} shows that a normal, complete and irreducible algerbaic curves over $k$ is determined by its rational function field $K$ up to an isomorphism. By definition, $K$ is a field of finite type over $k$ with transcendental degree $1$ (which is called a algerbaic function field of one variable).
\begin{proposition}\label{scheme normal complete irr curve with given field exist}
For any extension $K$ of $k$ of finite type and transcendental degree $1$, there exists a normal, complete and irreducible algebraic curve $X$ such that $K(X)=K$. The set of local rings of $X$ is identified with the set formed by $K$ and the valuation rings containing $k$ with fraction field $K$.
\end{proposition}
\begin{proof}
In fact, $K$ is a finite extension of a purely transcendental extension $k(T)$ of $k$, which is identified with the rational function field of $Y=\P^1_k$. Let $X$ be the inegral closure of $Y$ relative to $K$; $X$ is then a normal algebraic curve with field $K$ (\cref{scheme integral closure fraction field char}), and it is complete since the morphism $X\to Y$ is finite (\cref{scheme algebraic curve integral closure norma finite}). For $x\in X$, the local ring $\mathscr{O}_{X,x}$ is equals to $K$ if $x$ is the generic of $X$, and otherwise it is a discrete valuation ring of $K$. Conversely, let $A$ be a discrete valuation ring with fraction field $K$; as the morphism $X\to\Spec(k)$ is proper and $A$ dominates $k$, it also dominates a local ring $\mathscr{O}_{X,x}$ of $X$ by \cref{scheme morphism over integral scheme valuative criterion}, and therefore equals to $\mathscr{O}_{X,x}$.
\end{proof}
\begin{remark}
It follows from \cref{scheme normal complete irr curve with given field exist} and \cref{scheme normal complete irr curve isomorphism char} that giving a normal, complete and irreducible algebraic curve over $k$ is essentially equivalent to giving a extension $K$ of $k$ of finite type and transcendental degree $1$. We note that if $k'$ is an extension of $k$, $X\otimes_kk'$ is also a complete algebraic curve over $k'$ (\cref{scheme morphism proper permanence prop}(\rmnum{3})), but in general it is neither reduced nor irreducible. However, this will be the case if $K$ is a separable extension of $k$ and if $k$ is algebraically closed in $K$ (which is expressed, in a classical terminology, that $K$ is a "regular extension" of $k$). But even in this case, it may happen that $X\otimes_kk'$ is not normal.
\end{remark}
\section{Blow up of schemes, projective cones and closures}
\subsection{Blow up of schemes}
Let $Y$ be a scheme and $(\mathscr{I}_n)_{n\geq 0}$ be a decreasing sequence of quasi-coherent ideal of $\mathscr{O}_Y$. Suppose that the following conditions are satisfied:
\[\mathscr{I}_0=\mathscr{O}_Y,\quad\mathscr{I}_n\mathscr{I}_n\sub\mathscr{I}_{m+n}\]
where $m,n$ are integers. If this is true, we say that the sequence $(\mathscr{I}_n)_{n\geq 0}$ is \textbf{filtered}, or that $(\mathscr{I}_n)_{n\geq 0}$ is a \textbf{filtered sequence of quasi-coherent ideals of $\mathscr{O}_Y$}. We note that this hypothesis implies that $\mathscr{I}_1^n\sub\mathscr{I}_n$. Put
\[\mathscr{S}=\bigoplus_{n\geq 0}\mathscr{I}_n.\]
It follows the assumption that $\mathscr{S}$ is a quasi-coherent $\mathscr{O}_Y$-algebra, hence defines a $Y$-scheme $X=\Proj(\mathscr{S})$. If $\mathscr{I}$ is an invertible ideal of $\mathscr{O}_Y$, $\mathscr{I}_n\otimes_{\mathscr{O}_Y}\mathscr{I}^{\otimes n}$ is canonically idealtified with $\mathscr{I}_n\mathscr{J}^n$, and if we replace $\mathscr{I}_n$ by $\mathscr{I}_n\mathscr{J}^n$, then the obtained $\mathscr{O}_Y$-algebra $\mathscr{S}_{(\mathscr{J})}$ satisfies that $X_{(\mathscr{J})}=\Proj(\mathscr{S}_{(\mathscr{J})})$ is canonically isomorphic to $X$ (\cref{scheme Proj of qcoh graded algebra altering prop}).\par
Suppose that $Y$ is locally integral, so that $\mathscr{K}_Y$ is a quasi-coherent $\mathscr{O}_Y$-algebra (\cref{scheme local finite K(X) qcoh and injection}). We say a sub-$\mathscr{O}_Y$-module $\mathscr{I}$ of $\mathscr{K}_Y$ is a \textbf{fractional ideal} of $\mathscr{K}_Y$ if it is of finite type. Given a filtered sequence $(\mathscr{I}_n)_{n\geq 0}$ of quasi-coherent fractional ideal of $\mathscr{K}_Y$, we can then define the quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}$ and the corresponding $Y$-scheme $X=\Proj(\mathscr{S})$. We then see that for an invertible fractional ideal $\mathscr{J}$ of $\mathscr{K}_Y$, there is a canonical isomorphism of $X$ and $X_{(\mathscr{J})}$.\par
Let $Y$ be a scheme (resp. a locally integral scheme), and $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_Y$ (resp. a quasi-coherent fractional ideal of $\mathscr{K}_Y$); put $\mathscr{S}=\bigoplus_{n\geq 0}\mathscr{I}^n$. The $Y$-scheme $X=\Proj(\mathscr{S})$ is said to be the scheme obtained by \textbf{blowing up along the ideal $\mathscr{I}$}, or the \textbf{blow up} of $Y$ relative to $\mathscr{I}$. If $\mathscr{I}$ is a quasi-coherent ideal of $\mathscr{O}_Y$ and $Y'$ is the closed subscheme defined by $\mathscr{I}$, we also say that $X$ is the $Y$-scheme obtained by blowing up $Y'$. By definition, $\mathscr{S}$ is generated by $\mathscr{S}_1=\mathscr{I}$; if $\mathscr{I}$ is a $\mathscr{O}_Y$-module of finite type, $X$ is then projective over $Y$. By the hypotheses on $\mathscr{I}$, the $\mathscr{O}_X$-module $\mathscr{O}_X(1)$ is invertible (\cref{scheme Proj of qcoh alg S(nd) on X_f prop}) and very ample in view of \cref{scheme very ample if inverse of immersion Proj} for the structural morphism $j:X\to Y$. We also note that the restriction of $f$ to $f^{-1}(Y-Y')$ is an isomorphism if $\mathscr{I}$ is the quasi-coherent ideal of $\mathscr{O}_Y$ defining $Y'$: in fact, this question is local over $Y$, so it suffice to suppose $\mathscr{I}=\mathscr{O}_Y$, and this then follows from \cref{scheme Proj of polynomial algebra char}.\par
If we replace $\mathscr{I}$ by $\mathscr{I}^d$ for some $d>0$, the blow up $Y$-scheme $X$ is then replaced by a $Y$-scheme canonically isomorphic to $X'$ (\cref{scheme Proj of qcoh graded algebra altering prop}). Simialrly, for any invertible ideal (resp. fractional ideal) $\mathscr{J}$, the blow up scheme $X_{(\mathscr{J})}$ relative to $\mathscr{I}\mathscr{J}$ is canonically isomorphic to $X$. In particular, if $\mathscr{I}$ is an invertible ideal (resp. fractional ideal), the blow up $Y$-scheme relative to $\mathscr{I}$ is isomorphic to $Y$.
\begin{proposition}\label{scheme integral blow up scheme prop}
Let $Y$ be an integral scheme.
\begin{enumerate}
\item[(\rmnum{1})] For any filtered sequence $(\mathscr{I}_n)$ of quasi-coherent fractional ideals of $\mathscr{K}_Y$, the $Y$-scheme $X=\Proj(\bigoplus_{n\geq 0}\mathscr{I}_n)$ is integral and the structural morphism $f:X\to Y$ is dominant.
\item[(\rmnum{2})] Let $\mathscr{I}$ be a quasi-coherent fractional ideal of $\mathscr{K}_Y$ and $X$ be the blow up $Y$-scheme relative to $\mathscr{I}$. If $\mathscr{I}\neq 0$, the structural morphism $f:X\to Y$ is surjective and birational.
\end{enumerate}
\end{proposition}
\begin{proof}
In case (\rmnum{1}) the quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}=\bigoplus_{n\geq 0}\mathscr{I}_n$ is integral since for any $y\in Y$, $\mathscr{O}_{Y,y}$ is an integral domain, so the claim follows from \cref{scheme Proj of qcoh alg over integral prop}. For (\rmnum{2}), we obtain from (\rmnum{1}) that $X$ is integral; if morever $x$ and $y$ are generic points of $X$ and $Y$, we have $f(x)=y$, and it is necessary to prove that $\kappa(x)=\kappa(y)$. Now $x$ is also the generic point of the fiber $f^{-1}(y)$; if $\psi:Z\to Y$ is the canonical morphism, where $Z=\Spec(\kappa(y))$, then the scheme $f^{-1}(y)$ is identified with $\Proj(\mathscr{S}')$, where $\mathscr{S}'=\psi^*(\mathscr{S})$ (\cref{scheme Proj of qcoh alg base change prop}). But it is clear that $\mathscr{S}'=\bigoplus_{n\geq 0}(\widetilde{\mathscr{I}_y})^n$, and as $\mathscr{I}$ is a nonzero quasi-coherent fractional ideal of $\mathscr{K}_Y$, $\mathscr{I}_y\neq 0$ (\cref{scheme irreducible qcoh tensor with K(X) simple}), so $\mathscr{I}_y=\kappa(y)$ (since $y$ is the generic point of $Y$, $\mathscr{I}_y$ is a $\kappa(y)$-vector space). The scheme $\Proj(\mathscr{S}')$ is then identified with $\Spec(\kappa(y))$ (\cref{scheme Proj of polynomial algebra char}), whence the assertion.
\end{proof}
Retain the notations of \cref{scheme integral blow up scheme prop}. By definition, the injection $\mathscr{I}_{n+1}\to\mathscr{I}_n$ defines for each $k\in\Z$ a injective homomorphism of degree $0$ of graded $\mathscr{S}$-modules
\begin{align}\label{scheme blow up morphism u_k}
u_k:\mathscr{S}_+(k+1)\to\mathscr{S}(k).
\end{align}
As $\mathscr{S}_+(k+1)$ and $\mathscr{S}(k+1)$ are eventually isomorphic $\mathscr{S}$-modules, the hommorphism $u_k$ corresponds to a canonical injective homomorphism of $\mathscr{O}_X$-modules (\cref{scheme Proj of qcoh alg qc associated ft zero iff}):
\begin{align}\label{scheme blow up morphism induced u_k}
\tilde{u}_k:\mathscr{O}_X(k+1)\to\mathscr{O}_X(k).
\end{align}
Recall on the other hand that we have defined a canonical homomorphism
\[\lambda:\mathscr{O}_X(d)\otimes_{\mathscr{O}_X}\mathscr{O}_X(k)\to\mathscr{O}_{X}(d+k)\]
and as the diagram
\[\begin{tikzcd}
\mathscr{S}(d)\otimes_{\mathscr{S}}\mathscr{S}(k)\otimes_{\mathscr{S}}\mathscr{S}(l)\ar[r]\ar[d]&\mathscr{S}(d+k)\otimes_{\mathscr{S}}\mathscr{S}(l)\ar[d]\\
\mathscr{S}(d)\otimes_{\mathscr{S}}\mathscr{S}(k+l)\ar[r]&\mathscr{S}(d+k+l)
\end{tikzcd}\]
is commutative, it follows from the functoriality of $\lambda$ that the homomorphism $\lambda$ define a quasi-coherent graded $\mathscr{O}_X$-algebra structure on $\mathscr{S}_X=\bigoplus_{n\in\Z}\mathscr{O}_X(n)$. Moreover, the diagram
\[\begin{tikzcd}
\mathscr{S}(d)\otimes_{\mathscr{S}}\mathscr{S}_+(k+1)\ar[d,swap,"1\otimes u_k"]\ar[r]&\mathscr{S}_+(d+k+1)\ar[d,"u_{k+d}"]\\
\mathscr{S}(d)\otimes_{\mathscr{S}}\mathscr{S}(k)\ar[r]&\mathscr{S}(d+k)
\end{tikzcd}\]
is commutative; the functoriality of $\lambda$ shows that we have a commutative diagram
\begin{equation}\label{scheme blow up homomorphism u_k and lambda}
\begin{tikzcd}
\mathscr{O}_X(d)\otimes_{\mathscr{O}_X}\mathscr{O}_X(k+1)\ar[r,"\lambda"]\ar[d,swap,"1\otimes\tilde{u}_k"]&\mathscr{O}_X(d+k+1)\ar[d,"\tilde{u}_{d+h}"]\\
\mathscr{O}_X(d)\otimes_{\mathscr{O}_X}\mathscr{O}_X(k)\ar[r,"\lambda"]&\mathscr{O}_X(d+k)
\end{tikzcd}
\end{equation}
where the horizontal arrows are the canonical homomorphisms. We can then say that the $\tilde{u}_k$ define an injective homomorphism (of degree $0$) of graded $\mathscr{S}_X$-modules
\begin{align}\label{scheme blow up sheaf S_X contraction}
\tilde{u}:\mathscr{S}_X(1)\to\mathscr{S}_X
\end{align}

Now we consider for each $n\geq 0$ the homomorphism $\tilde{v}_n=\tilde{u}_{n-1}\circ\cdots\tilde{u}_0$, which is an injective homomorphism $\mathscr{O}_X(n)\to\mathscr{O}_X$; we denote its image by $\mathscr{I}_{n,X}$, which is a quasi-coherent ideal $\mathscr{O}_X$ isomorphic to $\mathscr{O}_X(n)$. Moreover, the diagram
\[\begin{tikzcd}
\mathscr{O}_X(m)\otimes_{\mathscr{O}_X}\mathscr{O}_X(n)\ar[d,swap,"\tilde{v}_m\otimes\tilde{v}_n"]\ar[r,"\lambda"]&\mathscr{O}_X(m+n)\ar[d,"\tilde{v}_{m+n}"]\\
\mathscr{O}_X\ar[r,"\id"]&\mathscr{O}_X
\end{tikzcd}\]
is commutative for $m,n\geq 0$. We also conclude that $(\mathscr{I}_{n,X})_{n\geq 0}$ is a filtered sequence of quasi-coherent ideals of $\mathscr{O}_X$.
\begin{proposition}\label{scheme blow up twisted sheaf isomorphic to power}
Let $Y$ be a scheme, $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_Y$, and $X$ be the blow up $Y$-scheme relative to $\mathscr{I}$. Then for each $n>0$ we have a canonical isomorphism
\[\mathscr{O}_X(n)\stackrel{\sim}{\to}\mathscr{I}^n\mathscr{O}_X=\mathscr{I}_{n,X}\]
and therefore $\mathscr{I}^n\mathscr{O}_X$ is a very ample invertible $\mathscr{O}_X$-module relative to $Y$ for $n>0$.
\end{proposition}
\begin{proof}
The last assertion is immediate since $\mathscr{O}_X(1)$ is invertible (\cref{scheme Proj of qcoh alg S(nd) on X_f prop}) and very ample relative to $Y$ by definition. On the other hand, the image of the homomorphism $v_n:S_+(n)\to S$ is none other than $\mathscr{I}^n\mathscr{S}$, and the first assertion then follows from the exactness of the functor $\bigtilde{\mathscr{M}}$ (\cref{scheme Proj of qcoh alg associated functor exact}) and the formula $\widetilde{\mathscr{I}\mathscr{M}}=\mathscr{I}\cdot\bigtilde{\mathscr{M}}$.
\end{proof}
\begin{corollary}\label{scheme blow up twisted sheaf exact sequence}
Under the hypotheses of \cref{scheme blow up twisted sheaf isomorphic to power}, if $f:X\to Y$ is the structural morphism and $Y'$ is the closed subscheme of $Y$ defined by $\mathscr{I}$, the closed subscheme $X'=f^{-1}(Y')$ of $X$ is defined by $\mathscr{I}\mathscr{O}_X$ (isomorphic to $\mathscr{O}_X(1)$), so we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{O}_X(1)\ar[r]&\mathscr{O}_X\ar[r]&\mathscr{O}_{X'}\ar[r]&0
\end{tikzcd}\]
\end{corollary}
\begin{proof}
This follows from \cref{scheme blow up twisted sheaf isomorphic to power} and \cref{scheme inverse image of subscheme}(b). 
\end{proof}
Under the hypotheses of \cref{scheme blow up twisted sheaf isomorphic to power}, we can specify that structure of $\mathscr{I}_{n,X}$. Note that that the homomorphism
\[\tilde{u}_{-1}:\mathscr{O}_X\to\mathscr{O}_X(-1)\]
corresponds canonically to a section $s$ of $\mathscr{O}_X(-1)$ over $X$, which is called the canonical section (relative to $\mathscr{I}$). In the diagram (\ref{scheme blow up homomorphism u_k and lambda}), the horizontal homomorphisms are isomorphisms (\cref{scheme Proj of qcoh alg twisted sheaf tensor prop}), so by replacing $d$ by $k$ and $k$ by $-1$ in that diagram, we obtain $\tilde{u}_k=1_k\otimes\tilde{u}_{-1}$ (where $1_k$ is the identity of $\mathscr{O}_X(k)$), which means the homomorphism $\tilde{u}_k$ is none other than the tensor product by the canonical section $k$ (for any $k\in\Z$). The homomorphism $\tilde{u}$ of (\ref{scheme blow up sheaf S_X contraction}) can be interpreted in the same manner, and we then deduce that, for any $n\geq 0$, the homomorphism $\tilde{v}_n:\mathscr{O}_X(n)\to\mathscr{O}_X$ is the tensor product by $s^{\otimes n}$.
\begin{corollary}\label{scheme blow up inverse of Y' char by canonical section}
With the notations of \cref{scheme blow up twisted sheaf exact sequence}, the underlying of $X'$ is the set of $x\in X$ such that $s(x)=0$, where $s$ is the canonical section of $\mathscr{O}_X(-1)$.
\end{corollary}
\begin{proof}
In fact, if $c_x$ is a generator for the fiber $(\mathscr{O}_X(1))_x$ at a point $x$, $s_x\otimes c_x$ is canonically identified with a generator for the fiber $\mathscr{I}_{1,X}$ at the point $x$, and is therefore invertible if and only if $s_x\notin\m_x(\mathscr{O}_X(-1))_x$, which means $s(x)\neq 0$.
\end{proof}
\begin{proposition}\label{scheme integral blow up of fractional ideal very ample}
Let $Y$ be an integral scheme, $\mathscr{I}$ be a quasi-coherent fractional ideal of $\mathscr{K}_Y$, and $X$ be the blow up $Y$-scheme relative to $\mathscr{I}$. Then there is an isomorphism $\mathscr{O}_X\stackrel{\sim}{\to}\mathscr{I}\mathscr{O}_X$, and in particular $\mathscr{I}\mathscr{O}_X$ is a very ample invertible $\mathscr{O}_X$-module relative to $Y$.
\end{proposition}
\begin{proof}
The question is local over $Y$ (\cref{scheme very ample local on target}), so we can assume that $Y=\Spec(A)$ is affine, where $A$ is an integral domain with fraction field $K$ and $\mathscr{I}=\tilde{\mathfrak{I}}$, where $\mathfrak{I}$ is a fractional ideal of $K$. Then there exists an element $a\neq 0$ such that $a\mathfrak{I}\sub A$. Put $S=\bigoplus_n\mathfrak{I}^n$; the map $x\mapsto ax$ is an $A$-isomorphism of $\mathfrak{I}^{n+1}=S(1)_n$ to $a\mathfrak{I}^{n+1}=a\mathfrak{I}S_n\sub\mathfrak{I}^n=S_n$, so defines a eventual isomorphism of degree $0$ of graded $S$-modules $S_+(1)\to a\mathfrak{I}S$. But $x\mapsto a^{-1}x$ is an isomorphism of degree $0$ of graded $S$-modules $a\mathfrak{I}S\stackrel{\sim}{\to}\mathfrak{I}S$, so we obtain an isomorphism $\mathscr{O}_X(1)\stackrel{\sim}{\to}\mathscr{I}\mathscr{O}_X$. As $S$ is generated by $S_1=\mathfrak{I}$, $\mathscr{O}_X(1)$ is invertible and very ample, whence the conclusion.
\end{proof}
\begin{proposition}\label{scheme local Noe blow up universal prop}
Let $Y$ be a locally Noetherian scheme, $\mathscr{I}$ ba a quasi-coherent ideal of $\mathscr{O}_Y$, and $X$ be the blow up $Y$-scheme relative to $\mathscr{I}$. Let $f:X\to Y$ be the structural morphism. If $g:Z\to Y$ is any morphism such that $g^*(\mathscr{I})\mathscr{O}_Z$ is an invertible $\mathscr{O}_Z$-module, then there exists a unique morphism $\tilde{g}:Z\to X$ such that the following diagram is commutative:
\[\begin{tikzcd}
Z\ar[rd,swap,"g"]\ar[r,dash,"\tilde{g}"]&X\ar[d,"f"]\\
&Y
\end{tikzcd}\] 
\end{proposition}
\begin{proof}
The question is local over $Y$, so we can assume that $Y=\Spec(A)$ is affine, where $A$ is Noetherian, and $\mathscr{I}=\widetilde{\mathfrak{I}}$ where $\mathfrak{I}$ is an ideal of $A$. Then $X=\Proj(S)$ where $S=\bigoplus_{n\geq 0}\mathfrak{I}^{n}$, and we note that since $A$ is Noetherian, $\mathfrak{I}$ is finitely generated, so $S$ is of finite type over $A$. Let $a_0,\dots,a_n\in\mathfrak{I}$ be a set of generators for $\mathfrak{I}$, so that we have a surjective homomorphism $\varphi:A[T_0,\dots,T_n]\to S$ which maps $T_i$ to $a_i$, and this gives a closed immersion $i:X\to\P^n_A$, and we can identify $X$ with its image. If $g:Z\to Y$ is a morphism such that $\mathscr{L}=g^*(\mathscr{I})\mathscr{O}_Z$ is invertible, then the inverse images of the $a_i$, which are global sections of $\mathscr{I}$, give global sections $s_0,\dots,s_n$ of $\mathscr{L}$ which generate $\mathscr{L}$. Then by \cref{scheme morphism into projective bundle surjective hommorphism} $r:Z\to P=\P_A^n$ such that $\mathscr{L}\cong r^*(\mathscr{O}_P(1))$ and $s_i=r^{-1}(T_i)$. We now claim that this morphism factors through the closed subscheme $X$ of $\P^n_A$: this follows from the fact that if $F(T_0,\dots,T_n)$ is a homogeneous polynomial of degree $d$ of $\ker\varphi$, then $F(a_0,\dots,a_n)=0$ in $A$ and so $F(s_0,\dots,s_n)=0$ in $\Gamma(Z,\mathscr{L}^{\otimes d})$. This gives the desired morphism $\tilde{g}:Z\to X$, and for any such morphism we necessarily have
\[g^*(\mathscr{I})\mathscr{O}_Z=\tilde{g}^*(f^*(\mathscr{I})\mathscr{O}_X)\mathscr{O}_Z=\tilde{g}^*(\mathscr{O}_X(1))\mathscr{O}_Z\]
by \cref{scheme blow up twisted sheaf isomorphic to power}, so we obtain a surjective hommorphism $\tilde{g}^*(\mathscr{O}_X(1))\to g^*(\mathscr{I})\mathscr{O}_Z=\mathscr{L}$, hence an isomorphism by \cref{sheaf of module local free same rank inj iff bij}. Clearly the sections $s_i$ of $\mathscr{L}$ are the inverse images of the sections $T_i$ of $\mathscr{O}_P(1)$ on $\P^n_A$, so the uniqueness of $\tilde{g}$ follows from \cref{scheme morphism into projective bundle surjective hommorphism}.
\end{proof}
\begin{corollary}\label{scheme local Noe blow up functorial}
Let $q:Y'\to Y$ be a morphism of locally Noetherian schemes and $\mathscr{I}$ be a quasi-coherent ideal of $\mathscr{O}_Y$. Let $X$ be the blow up $Y$-scheme relative to $\mathscr{I}$ and $X'$ be the blow up $Y'$-scheme relative to $\mathscr{J}=q^*(\mathscr{I})\mathscr{O}_Y$. Then there exists a unique morphism $p:X'\to X$ such that the diagram
\begin{equation}\label{scheme local Noe blow up functorial-1}
\begin{tikzcd}
X'\ar[r,"p"]\ar[d]&X\ar[d]\\
Y'\ar[r,"q"]&Y
\end{tikzcd}
\end{equation}
is commutative. Moreover, if $q$ is a closed immersion, so is $p$.
\end{corollary}
\begin{proof}
The existence and uniqueness of $q$ follows from \cref{scheme local Noe blow up universal prop} and \cref{scheme blow up twisted sheaf isomorphic to power}. To show that $p$ is a closed immersion if $q$ is, we trace the definition of the blow up: $X=\Proj(\mathscr{S})$ where $\mathscr{S}=\bigoplus_{n\geq 0}\mathscr{I}^n$ and $X'=\Proj(\mathscr{S}')$ where $\mathscr{S}'=\bigoplus_{n\geq 0}\mathscr{J}^n$. Since $Y'$ is a closed subscheme of $Y$, we can consider $\mathscr{S}'$ as a sheaf of graded algebras over $Y$. Then there exists a natrual surjective homomorphism $\mathscr{S}\to\mathscr{S}'$, which gives rise to the closed immersion $p$.
\end{proof}
In the situation of \cref{scheme local Noe blow up functorial}, if $Y'$ is a closed subscheme of $Y$, we call the closed subscheme $X'$ of $X$ the \textbf{strict transform} of $Y'$ under the blowing-up $f:X\to Y$.
\begin{example}\label{scheme A^n blow up at origin eg}
Let $Y=\A^n_k$ be the affine space over a field $k$ and we consider the blow up of $Y$ at the origin $y$ of $Y$. Then $Y=\Spec(A)$ where $A=k[X_1,\dots,X_n]$, $y$ corresponds to the ideal $\mathfrak{I}=(X_1,\dots,X_n)$, and $X=\Proj(S)$ where $S=\bigoplus_{n\geq 0}\mathfrak{I}^n$. We can define a surjective homomorphism
\[\varphi:A[Y_0,\dots,Y_n]\to S\]
of graded rings by sending $Y_i$ to $X_i$ as an element of degree $1$ in $S$, which gives a closed immersion of $X$ into $\P^{n-1}_A$. It is not hard to see that the kernel of $\varphi$ is generated by the homogeneous polynomials $X_iY_j-X_jY_i$, where $i,j=1,\dots,n$, so this definition is compatible with the definition of the blow up of the affine variety $\A^n_k$. \par
Now if $Y'$ is a closed subscheme of $Y$ passing through $y$, then the strict transform $X'$ of $Y'$ is a closed subscheme of $X$. Hence, provided that $Y'$ is not reduced to the point $y$, we can recover $X'$ as the closure of $f^{-1}(Y'-\{y\})$, where $f:f^{-1}(Y'-\{y\})\to Y'-\{y\}$ is an isomorphism. Again this definition is compatible with the definition of blow up of closed subvarieties of $\A^n_k$.
\end{example}
\begin{example}
As an example of the general concept of blowing up a coherent sheaf of ideals, we show how to eliminate the points of indeterminacy of a rational map determined by an invertible sheaf. So let $A$ be a ring, $X$ be a Noetherian scheme over $A$, $\mathscr{L}$ be an invertible sheaf on $X$, and $s_0,\dots,s_n$ be global sections of $\mathscr{L}$. Let $U$ be the open subset of $X$ where the $s_i$ generate the sheaf $\mathscr{L}$ (that is, the subset where the corresponding homomorphism $\mathscr{O}_X^{n+1}\to\mathscr{L}$ is surjective, cf. \cref{sheaf of module ft local prop}(\rmnum{3})). Then the invertible sheaf $\mathscr{L}|_U$ on $U$ and the global sections $s_0,\dots,s_n$ determine an $A$-morphism $\varphi:U\to\P_A^n$, which is also a rational map $X\dashrightarrow\P^n_A$. We will now show how to blow up a certain sheaf of ideals $\mathscr{I}$ on $X$, whose corresponding closed subsheme $Y$ has support equal to $X-U$ (i.e., the underlying topological space of $Y$ is $X-U$), so that the morphism $\varphi$ extends to a morphism $\tilde{\varphi}:\widetilde{X}\to\P^n_A$.
\[\begin{tikzcd}
\widetilde{X}\ar[d,swap,"\pi"]\ar[rd,dashed,"\tilde{\varphi}"]\\
X&\P^n_A\\
U\ar[u,hook]\ar[ru,swap,"\varphi"]
\end{tikzcd}\]

Let $\mathscr{F}$ be the quasi-coherent sub-$\mathscr{O}_X$-module of $\mathscr{L}$ generated by $s_0,\dots,s_n$. We define a coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$ as follows: for any open subset $V\sub X$ and an isomorphism $\psi:\mathscr{L}|_V\cong\mathscr{O}_X|_V$, we take $\mathscr{I}|_V=\psi(\mathscr{F}|_V)$. It is clear that $\mathscr{I}_V$ is independent of the choice of $\psi$, so we get a well-defined coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$. We also note that $\mathscr{I}_x=\mathscr{O}_{X,x}$ if and only if $x\in U$, so the corresponding closed subscheme $Y$ has support $X-U$. Let $\pi:\widetilde{X}\to X$ be the corresponding blow up relative to $\mathscr{I}$. We claim that $\pi^*(\mathscr{I})$ is a coherent ideal of $\mathscr{O}_{\widetilde{X}}$, so is invertible by \cref{scheme blow up twisted sheaf isomorphic to power}. This can be verified on each affine open $X_{s_i}$. Then the global sections $\pi^*(s_i)$ of $\pi^*(\mathscr{L})$ generate an invertible sub-$\mathscr{O}_{\widetilde{X}}$-module $\mathscr{L}'$ of $\pi^*(\mathscr{L})$. Now $\mathscr{L}'$ and the sections $\pi^*(s_i)$ define a morphism $\tilde{\varphi}:\widetilde{X}\to\P^n_A$ whose restriction on $\pi^{-1}(U)$ corresponds to the morphism $\varphi$ under the isomorphism $\pi:\pi^{-1}(U)\stackrel{\sim}{\to}U$.
\end{example}
\subsection{Homogenization of graded rings}
Let $S$ be a graded ring, which we do not suppose to be with positive degrees. We set
\[S^{\geqslant}=\bigoplus_{n\geq 0}S_n,\quad S^{\leqslant}=\bigoplus_{n\leq 0}S_n\]
which are subrings of $S$, with positive of negative degrees respectively. If $f$ is a homogeneous element of degree $d$ (positive of negative) of $S$, the localization $S_f=S'$ is endowed with a graded ring structure, where $S'_n$ is the set of elements $x/f^k$, where $x\in S_{n+kd}$ ($k\geq 0$); we also note that $S_{(f)}=S'_0$, and we denote $S_f^{\geqslant}$ and $S_{f}^{\geqslant}$ for $S'^{\geqslant}$ and $S'^{\leqslant}$, respectively. This notation is justified by the fact that if $d>0$, then we have
\begin{align}\label{graded ring localization positive part-1}
(S^{\geqslant})_f=S_f;
\end{align}
in fact, if $x\in S_{n+kd}$ where $n+kd<0$, we can write $x/f^k=xf^h/f^{h+k}$ so that $n+(h+k)d>0$ for $h>0$ large enough. We then conclude by definition that
\begin{align}\label{graded ring localization positive part-2}
(S^{\geqslant})_{(f)}=(S_{f}^{\geqslant})_0=S_{(f)}.
\end{align}
If $M$ is a graded $S$-module, we put similarly
\[M^{\geqslant}=\bigoplus_{n\geq 0}M_n,\quad M^{\leqslant}=\bigoplus_{n\leq 0}M_n\]
which are respectively $S^{\geqslant}$-module and $S^{\geqslant}$-module, with intersection the $S_0$-module $M_0$. If $f\in S_d$, we also define $M_f$ as the graded $S_f$-module such that $(M_f)_n$ is the set of elements $z/f^k$, where $z\in M_{n+kd}$. We denote by $M_{(f)}$ the set of degree $0$ elements in $M_f$, which is an $S_{(f)}$-module, and we write $M_f^{\geqslant}$ and $M_{f}^{\leqslant}$ for $(M_{f})^{\geqslant}$ and $(M_{f})^{\leqslant}$ respectively. If $d>0$, we also have
\begin{align}\label{graded module localization positive part}
(M^{\geqslant})_f=M_f,\quad (M^{\geqslant})_{(f)}=(M_f^{\geqslant})_0=M_{(f)}.
\end{align}

Let $\bm{z}$ be an indeterminate, which is called the \textbf{homogenization variable}. If $S$ is a graded ring, the polynomial algebra
\[\widehat{S}=S[\bm{z}]\]
is a graded $S$-algebra, where for $f$ homogeneous we put
\[\deg(f\bm{z}^n)=n+\deg(f).\]
\begin{lemma}\label{graded ring homogenization prop}
Let $f\in S_d$ with $d>0$. We have canonical isomorphisms
\begin{gather}
\widehat{S}_{(\bm{z})}\cong\widehat{S}/(\bm{z}-1)\widehat{S}\cong S,\label{graded ring homogenization prop-1}\\
\widehat{S}_{(f)}\cong S_f^{\leqslant}.\label{graded ring homogenization prop-2}
\end{gather}
\end{lemma}
\begin{proof}
The first isomorphism of (\ref{graded ring homogenization prop-1}) is already defined in \cref{graded ring S_(f) isomorphic to quotient by f-1} and the second one is trivial; the isomorphism $\widehat{S}_{(z)}\cong S$ thus defined then send an element $x\bm{z}^n/\bm{z}^{n+k}$ (where $\deg(x)=k$ for $k\geq -n$) to the element $x$. The homomorphism (\ref{graded ring homogenization prop-2}) is defined by sending $x\bm{z}^n/f^k$ (where $\deg(x)=kd-n$) to the element $x/f^k$, of degree $-k$ in $S_f^{\leqslant}$, and it is easy to verify that this is an isomorphism.
\end{proof}
Let $M$ be a graded $S$-module. It is clear that the $S$-module
\[\widehat{M}=M\otimes_S\widehat{S}=M\otimes_SS[\bm{z}]\]
is the direct sum of the $S$-modules $M\otimes S\bm{z}^n$, whence the abelian groups $M_k\otimes S\bm{z}^n$. We define over $\widehat{M}$ an $\widehat{S}$-module structure by
\[\deg(x\otimes\bm{z}^n)=n+\deg(x)\]
for $x$ homogeneous in $M$.
\begin{lemma}\label{graded module homogenization prop}
Let $f\in S_d$ with $d>0$. We have a canonical isomorphism
\begin{gather}
\widehat{M}_{(\bm{z})}\cong\widehat{M}/(\bm{z}-1)\widehat{M}\cong M,\label{graded module homogenization prop-1}\\
\widehat{M}_{(f)}\cong M_f^{\leqslant}.\label{graded module homogenization prop-2}
\end{gather}
\end{lemma}
\begin{proof}
This can be proved as \cref{graded ring homogenization prop} by using the second part of \cref{graded ring S_(f) isomorphic to quotient by f-1}. 
\end{proof}
Let $S$ be a graded ring with positive degrees. Then for each $n\geq 0$, we can consider $S(n)=\bigoplus_{m\geq n}S_m$ as a graded iedal of $S$ (in particular $S(0)=S$ and $S(1)=S_+$). As it is clear that $S(m)S(n)\sub S(m+n)$, we can then define a graded ring
\[S^{\natural}=\bigoplus_{n\geq 0}S(n)\]
whence $S_n^{\natural}=S(n)$. Then $S_0^{\natural}$ is equal to $S$ considered as a nongraded ring, and $S^{\natural}$ is therefore an $S$-algebra. For any homogeneous element $f\in S_d$ with $d>0$, we denote by $f^{\natural}$ the element $f$ considered as an element of $S(d)=S_d^{\natural}$.
\begin{lemma}\label{graded ring natural isomorphism prop}
Let $S$ be a graded ring with positive degrees, $f$ be a homogeneous element with $d>0$. We have canonical isomorphisms:
\begin{gather}
S_f\cong\bigoplus_{n\in\Z}S(n)_{(f)},\label{graded ring natural isomorphism prop-1}\\
(S_f^{\geqslant})_{f/1}\cong S_f,\label{graded ring natural isomorphism prop-2}\\
S^{\natural}_{(f^{\natural})}\cong S_f^{\geqslant}.\label{graded ring natural isomorphism prop-3}
\end{gather}
the first two of which are bi-isomorphisms of graded rings.
\end{lemma}
\begin{proof}
It is immediate that we have $(S_f)_n=(S(n)_f)_0=S(n)_f$, whence the first isomorphism. On the other hand, as $f/1$ is invertible in $S_f$, there is a canonical isomorphism $S_f\cong S_f^{\geqslant}=(S_f)_{f/1}$ in view of (\ref{graded ring localization positive part-1}) applide to $S_f$. Finally, if $x=\sum_{m\geq n}y_n$ is an element of $S(n)$, where $n=kd$, we can correspond the element $x/(f^{\natural})^k$ to the element $\sum_my_m/f^k$ of $S^{\geqslant}_f$, and we verify that this is an isomorphism.
\end{proof}
If $M$ is a graded $S$-module, we can similarly put for $n\in\Z$
\[M^{\natural}=\bigoplus_{n\in\Z}M(n)\]
as $S(m)M(n)\sub M(m+n)$. Then $M^{\natural}$ is a graded $S^{\natural}$-module, and similarly we have the following:
\begin{lemma}\label{graded module natural isomorphism prop}
Let $f\in S_d$ be a homogeneous element with $d>0$. We have the following bi-homomorphisms
\begin{gather}
M_f\cong\bigoplus_{n\in\Z}M(n)_{(f)},\label{graded module natural isomorphism prop-1}\\
(M_f^{\geqslant})_{f/1}\cong M_f,\label{graded module natural isomorphism prop-2}\\
M^{\natural}_{(f^{\natural})}\cong M_f^{\geqslant}.\label{graded module natural isomorphism prop-3}
\end{gather}
the first two of which are bi-isomorphisms of graded modules.
\end{lemma}
\begin{remark}
We can think that $S^{\natural}$ is obtained from $S$ by adding a "phantom" element $\bm{y}$ of degree $-1$. The component $S(n)$ can be then considered as the $S$-module $(S\bm{y}^n)_0$, which is the set of degree $0$ elements in $S\bm{y}^n$. With this understanding, we can then relate the results of \cref{graded ring homogenization prop} and \cref{graded ring natural isomorphism prop}.
\end{remark}
\begin{lemma}\label{graded ring positive degree S^natural prop}
Let $S$ be a graded ring with positive degrees.
\begin{enumerate}
\item[(\rmnum{1})] For $S^{\natural}$ to be an $S_0^{\natural}$-algebra of finite type (resp. Noetherian), it is necessary and sufficient that $S$ is an $S_0$-algebra of finite type (resp. Noetherian).
\item[(\rmnum{2})] For $S^{\natural}_{n+1}=S_1^{\natural}S_n^{\natural}$ for $n\geq n_0$, it is necessary and sufficient that $S_{n+1}=S_1S_n$ for $n\geq n_0$.
\item[(\rmnum{3})] For $S^{\natural}_n=(S_1^{\natural})^n$ for $n\geq n_0$, it is necessary and sufficient that $S_n=S_1^n$ for $n\geq n_0$.
\item[(\rmnum{4})] If $(f_\alpha)$ is a set of homogeneous elements of $S_+$ such that the radical in $S_+$ of the ideal of $S_+$ generated by the $f_\alpha$ is equal to $S_+$, then $S_+^{\natural}$ is the radical in $S_+^{\natural}$ of the ideal of $S_+^{\natural}$ generated by the $f_\alpha^{\natural}$.
\end{enumerate}
\end{lemma}
\begin{proof}
If $S^{\natural}$ is an $S_0^{\natural}$-algebra of finite type, $S_+=S_1^{\natural}$ is a finitely generated module over $S=S_0^{\natural}$ by \cref{graded ring generating set iff}, so $S$ is an $S_0$-algebra of finite type by \cref{graded ring finitely generated criterion}. If $S^{\natural}$ is a Noetherian ring, so is the ring $S_0^{\natural}=S$ by \cref{graded ring finitely generated criterion}. Conversely, if $S$ is an $S_0$-algebra of finite type, then by \cref{graded ring finite module M_n+d=A_dM_n} there exists $d>0$ and $n_0>0$ such that $S_{n+d}=S_hS_n$ for any $n\geq n_0$; we can clearly suppose that $n_0\geq d$. Moreover, the $S_n$ are finitely generated $S_0$-modules (\cref{graded ring finitely generated criterion}(c)), so if $n\geq n_0+d$, we have $S_n^{\natural}=S_nS_{n-d}^{\natural}=S_d^{\natural}S_{n-d}^{\natural}$; and if $n<n_0+d$, we have 
\[S_n^{\natural}=S_n+\cdots+S_{n_0+d-1}+S_dE+S_d^2E+\cdots\]
where $E=S_{n_0}+\cdots+S_{n_0+d-1}$. For $1\leq n\leq n_0$, let $G_n$ be the union of the generators of the $S_0$-module $S_i$ where $n\leq i\leq n_0+d-1$, considered as subsets of $S(n)$. For $n_0+1\leq n\leq n_0+d-1$, similarly let $G_n$ be the union of the generators of the $S_0$-module $S_i$ where $n\leq i\leq n_0+d-1$ and of $S_dE$, considered as subsets of $S(n)$. Then it is clear that we have $S_n^{\natural}=S_0^{\natural}G_n$ for $1\leq n\leq n_0+d-1$, and therefore the union $G$ of the $G_n$ for $1\leq n\leq n_0+d-1$ is a system of generators of the $S_0^{\natural}$-algebra $S^{\natural}$. We then conclude that if $S=S_0^{\natural}$ is Noehterian, then so is $S^{\natural}$.\par
It is clear that if $S_{n+1}=S_1S_n$ for $n\geq n_0$, then we have $S_{n+1}^{\natural}=S_1S_n^{\natural}$, and a fortiori $S_{n+1}^{\natural}=S_1^{\natural}S_n^{\natural}$ for $n\geq n_0$. Conversely, the latter relation means that 
\[S_{n+1}+S_{n+2}+\cdots=(S_1+S_2+\cdots)(S_n+S_{n+1}+\cdots);\]
by comparing the degree $n+1$ component of both sides, we conclude that $S_{n+1}=S_1S_n$. This proves the assertion (\rmnum{2}).\par
If $S_n=S_1^n$ for $n\geq n_0$, we have $S_n^{\natural}=\bigoplus_{m\geq n}S_1^m$, and as $S_1^{\natural}$ contains $\bigoplus_{m\geq 1}S_1^m$, we then have $S_n^{\natural}\sub(S_1^{\natural})^n$ for $n\geq n_0$. Conversely, the degree $n$ component of $(S_1^\natural)^n=(S_1+S_2+\cdots)^n$ considered as elements of $S$ is equal to $S_1^n$; so the relation $S_n^\natural=(S_1^\natural)^n$ implies $S_n=S_1^n$.\par
Finally, to prove (\rmnum{4}), it suffices to show that if an element $g\in S_{k+d}$ is considered as an element of $S_k^{\natural}$ ($k>0$, $d\geq 0$), then there exists an integer $n>0$ such that in $S_{kn}^{\natural}$, $g^n$ is a linear combination of the $f_\alpha^{\natural}$ with coefficients in $S^\natural$. By hypothesis, there exists an integer $n_0$ such that for $n\geq n_0$, we have $g^n=\sum_\alpha c_{\alpha n}f_\alpha$ in $S$, where the indices $\alpha$ appearing in this formula are independent of $n$. Moreover, we can evidently suppose that the $c_{\alpha n}$ are homogeneous, with
\[\deg(c_{\alpha n})=n(k+d)-\deg(f_\alpha)\]
in $S$. Let $n_0$ be large enough such that we have $kn_0>deg(f_\alpha)$ for the $f_\alpha$ appearing in the formula of $g^n$; for any $\alpha$, let $c'_{\alpha n}$ be the element $c_{\alpha n}$ considered as an element of degree $kn-\deg(f_\alpha)$ in $S^{\natural}$. We then have $g^n=\sum_\alpha c'_{\alpha m}f_\alpha^{\natural}$ in $S^{\natural}$, which proves our assertion.
\end{proof}
Consider the graded $S_0$-algebra
\[S^{\natural}\otimes_SS_0=S^{\natural}/S_+S^{\natural}=\bigoplus_{n\geq 0}S(n)/S_+S(n).\]
As $S_n$ is a quotient $S_0$-module of $S(n)/S_+S(n)$, we have a canonical hommorphism of graded $S_0$-algebras
\begin{align}\label{graded ring S^natural tensor S_0 homomorphism}
S^{\natural}\otimes_SS_0\to S
\end{align}
which is evidently surjective, and corresponds to a canonical closed immersion
\begin{align}\label{graded ring S^natural tensor S_0 induced morphism}
\Proj(S)\to\Proj(S^{\natural}\otimes_SS_0)
\end{align}
\begin{proposition}\label{scheme Proj of S^natural tensor S_0 prop}
The canonical morphism (\ref{graded ring S^natural tensor S_0 induced morphism}) is bijective. For the homomorphism (\ref{graded ring S^natural tensor S_0 homomorphism}) to be eventually bijective, it is necessary and sufficient that there exists an integer $n_0$ such that $S_{n+1}=S_1S_n$ for $n\geq n_0$. If this is satisfied, then the morphism (\ref{graded ring S^natural tensor S_0 induced morphism}) is an isomorphism, and the converse of this is also true if $S$ is Noetherian.
\end{proposition}
\begin{proof}
To prove the first assertion, it suffices (\cref{scheme Proj morphism associated prop}) to prove that the kernel $\mathfrak{I}$ of the homomorphism (\ref{graded ring S^natural tensor S_0 homomorphism}) is formed by nilpotent elements. Now if $f\in S(n)$ is an element whose class mod $S_+S(n)$ belongs to this kernel, then $f\in S(n+1)$ (by the definition of (\ref{graded ring S^natural tensor S_0 homomorphism})); the element $f^{n+1}$, considered as an element of $S(n(n+1))$, then belongs to $S_+S(n(n+1))$, if we write it as $f\cdot f^n$. Then the class of $f^{n+1}$ mod $S_+S(n(n+1))$ is zero, which proves our assertion.\par
As the hypothesis $S_{n+1}=S_1S_n$ for $n\geq n_0$ is equivalent to $S_{n+1}^{\natural}=S_1^{\natural}S_n^{\natural}$ for $n\geq n_0$ (\cref{graded ring positive degree S^natural prop}(\rmnum{2})), these hypotheses are equivalent to that (\ref{graded ring S^natural tensor S_0 homomorphism}) is eventually injective, hence eventually bijective, and then (\ref{graded ring S^natural tensor S_0 induced morphism}) is an isomorphism by \cref{scheme Proj of qcoh graded algebra altering prop}(a). Conversely, assume that $S$ is Noetherian, hence so is $S^\natural$ and $S^\natural\otimes_SS_0$ (\cref{graded ring positive degree S^natural prop}(\rmnum{1})). If (\ref{graded ring S^natural tensor S_0 induced morphism}) is an isomorphism, the sheaf $\widetilde{\mathscr{I}}$ over $\Proj(S^\natural\otimes_SS_0)$ is zero (\cref{scheme Proj of qcoh algera closed subscheme char}(a)); as $S^\natural\otimes_SS_0$ is Noetherian, we then conclude from \cref{scheme Proj qc associated ft zero iff}(b) that $\mathfrak{I}$ is eventually null, so $S_{n+1}^{\natural}=S_1^{\natural}S_n^{\natural}$ for $n\geq n_0$.
\end{proof}
Consider now the canonical injection $(S_+)^n\to S(n)$, which defines an injective homomorphism of degree $0$ of graded rings
\begin{align}\label{graded ring S_+^n to S^natural homomorphism}
\bigoplus_{n\geq 0}(S_+)^n\to S^{\natural}.
\end{align}
\begin{proposition}\label{graded ring S_+^n to S^natural prop}
For the homomorphism (\ref{graded ring S_+^n to S^natural homomorphism}) to be an eventual isomorphism, it is necessary and sufficient that there exists an integer $n_0$ such that $S_n=S_1^n$ for $n\geq n_0$. If this is the case, the corresponding morphism
\begin{align}\label{graded ring S_+^n to S^natural prop-1}
\Proj(S^{\natural})\to\Proj(\bigoplus_{n\geq 0}(S_+)^n)
\end{align}
is everywhere defined and an isomorphism, and the converse is also true if $S$ is Noetherian.
\end{proposition}
\begin{proof}
The first two conditions are equivalent in view of \cref{graded ring positive degree S^natural prop}(\rmnum{3}). The third assertion follows from \cref{graded ring positive degree S^natural prop}(\rmnum{1}), (\rmnum{3}) and \cref{graded ring S_+^n to S isomorphism on Proj then}. 
\end{proof}
\begin{lemma}\label{graded ring S_+^n to S isomorphism on Proj then}
Let $S$ be a graded ring with positive degrees which is a $S_0$-algebra of finite type. If the morphism corresponding to the canonical injection $S'=\bigoplus_{n\geq 0}S_1^n\to S$ is everywhere defined and an isomorphism, then there exists $n_0>0$ such that $S_n=S_1^n$ for $n\geq n_0$.
\end{lemma}
\begin{proof}
In fact, let $f_i$ ($1\leq i\leq r$) be a system of generators for the $S_0$-module $S_1$. Then the hypotheses implies that the $D_+(f_i)$ cover $\Proj(S)$. Let $(g_j)_{1\leq j\leq n}$ be a system of homogeneous elements of $S_+$, with $n_j=\deg(g_j)$, which together with the $f_i$ form a system of generators of the ideal $S_+$, or a system of generators of $S$ as an $S_0$-algebra. The elements $g_j/f_i^{n_j}$ of the ring $S_{(f_i)}$ then by hypotheses belong to the subring $S'_{(f_i)}$, so there exists an integer $k$ such that $S_1^kg_j\sub(S_1)^{k+n_j}$ for any $j$. We then conclude by recurrence on $r$ that $S_1^kg_j^r\sub S'$ for any $r\geq 1$, and by the choice of the $g_j$, we then have $S_1^kS\sub S'$. On the other hand there exists for any $j$ an integer $m_j$ such that $g_j^{m_j}$ belongs to the ideal of $S$ generated by the $f_i$ (\cref{scheme Proj standard set cover iff generate}), so $g_j^{m_j}\in S_1S$, and $g_j^{m_jk}\in S_1^kS\sub S'$. Therefore there exists an integer $m_0\geq k$ such that $g_j^m\in S_1^{mn_j}$ for $m\geq m_0$. Now if $d$ is the largest of the $n_j$, the number $n_0=dm_0+k$ then satisfies the requirement. In fact, an element of $S_n$, for $n\geq n_0$, is a sum of elements of $S_1^\alpha u$, where $u$ is a product of powers of $g_j$; if $\alpha\geq k$, it follows from the choice of $k$ that $S_1^\alpha u\sub S_1^n$; in the contrary case, at least one of the exponent of $g_j$ is $\geq m_0$, so $u\in S_1^\beta v$ where $\beta\geq m_0\geq k$ and $v$ is a product of powers of $g_j$, so we are reduced to the previous case, and $S_1^\alpha u\sub S_1^n$. This completes the proof.
\end{proof}
\begin{remark}\label{graded ring S_n=S_1^n and S_n+1=S_1S_n}
The condition $S_n=S_1^n$ for $n\geq n_0$ clearly implies that $S_{n+1}=S_1S_n$ for $n\geq n_0$, but the converse is not ture, even we assume that $S$ is Noetherian. For example, let $K$ be a field, $A=K[\bm{x}]$, $B=K[\bm{y}]/\bm{y}^2K[\bm{y}]$, where $\bm{x},\bm{y}$ are two indeterminates, with $\deg(\bm{x})=1$ and $\deg(\bm{y})=2$, and let $S=A\otimes_KB$, so that $S$ is a graded algebra over $K$ having a basis formed by the elements $\bm{x}^n$ and $\bm{x}^n\bm{y}$. It is immediate that $S_{n+1}=S_1S_n$ for $n\geq 2$, but $S_1^n=K\bm{x}^n$ while $S_n=K\bm{x}^n+K\bm{x}^{n-2}\bm{y}$ for $n\geq 2$.
\end{remark}
\subsection{Projective cones}
Let $Y$ be a scheme; in this subsection, we only consider $Y$-schemes and $Y$-morphisms. Let $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra with positive degrees, which we suppose that $\mathscr{S}_0=\mathscr{O}_Y$. According to the notations of the previous part, we put
\begin{align}\label{scheme qcoh alg homogenization}
\widehat{\mathscr{S}}=\mathscr{S}[\bm{z}]=\mathscr{S}\otimes_{\mathscr{O}_Y}\mathscr{O}_Y[\bm{z}]
\end{align}
which we consider as a graded $\mathscr{O}_Y$-algebra with positive degrees, so that for any affine open subset $U$ of $Y$, we have
\[\Gamma(U,\mathscr{S})=\Gamma(U,\mathscr{S})[\bm{z}].\]
In the following, we put
\[P=\Proj(\mathscr{S}),\quad C=\Spec(\mathscr{S}),\quad\widehat{C}=\Proj(\widehat{\mathscr{S}})\]
(where in the definition of $C$, $\mathscr{S}$ is considered as a nongraded $\mathscr{O}_Y$-algebra), and we say that $C$ (resp. $\widehat{C}$) is the \textbf{affine cone} (resp. \textbf{projective cone}) defined by $\mathscr{S}$; we will also say "cone" instead of "cone affine." By abuse of language, we sat that $C$ (resp. $\widehat{C}$) is the \textbf{affine projecting cone} of $P$ (resp. the \textbf{projective projecting cone} of $P$), which $P$ is understood to be given of the form $\Proj(\mathscr{S})$. Finally, we say that $\widehat{C}$ is the projective closure of $C$, where $C$ is understood to be a scheme of the form $\Spec(\mathscr{S})$.
\begin{lemma}\label{scheme Proj X_f=D_+(f) smallest closed subscheme}
Let $S$ be a graded ring with positive degrees, $X=\Proj(S)$, and $f$ be a homogeneous element of $S$ with degree $d>0$. If $f$ is not a divisor of zero in $S$, $X$ is the smallest closed subscheme of $X$ such that $X_f=D_+(f)$.
\end{lemma}
\begin{proof}
This question is clearly local on $X$; for any homogeneous element $g\in S_h$ ($h>0$), it suffices to prove that $X_g$ is the smallest closed subscheme of $X_g$ which dominates $X_{fg}$. It follows from the definition and \cref{Spec of ring map dominant iff ker nilpotent} that this condition is equivalent to the fact that the canonical homomorphism $S_{(g)}\to S_{(fg)}$ is injective. Now this homomorphism is identified canonically with the homomorphism $S_{(g)}\to (S_{(g)})_{f^h/g^d}$ (\cref{graded ring localization of fg prop}). But as $f^h$ is not a zero divisor of $S$, $f^h/g^e$ is not a zero divisor in $S_g$ (and a fortiori in $S_{(g)}$), because the relation $(f^h/g^d)(t/g^m)=0$ with $t\in S$ and $m>0$ implies the existence of an integer $n>0$ such that $g^nf^ht=0$, whence $g^nt=0$, and therefore $t/g^m=0$ in $S_g$. This proves the claim.
\end{proof}
\begin{proposition}\label{scheme cone canonical morphism}
There is a commutative diagram
\[\begin{tikzcd}
&\widehat{C}\ar[dd]&\\
P\ar[rd]\ar[ru,"j"]&&C\ar[lu,swap,"i"]\ar[ld]\\
&Y\ar[ru,bend left=20pt,"\eps"]&
\end{tikzcd}\]
where $\eps$ and $j$ are closed immersions and $i$ is an affine morphism which is an open dominant immersion such that
\begin{align}\label{scheme cone canonical morphism-1}
i(C)=\widehat{C}-j(P).
\end{align}
Moreover $\widehat{C}$ is the smallest closed subscheme of $\widehat{C}$ dominating $i(C)$.
\end{proposition}
\begin{proof}
To define $i$, we consider the open subset $\widehat{C}_{\bm{z}}=\Spec(\widehat{\mathscr{S}}/(\bm{z}-1)\widehat{\mathscr{S}})$ of $\widehat{C}$ (by (\ref{graded ring homogenization prop-1})), where $\bm{z}$ is canonically identified with a section of $\widehat{\mathscr{S}}$ over $Y$. The isomorphism $i:C\stackrel{\sim}{\to}\widehat{C}_{\bm{z}}$ corresponds then to the canonical isomorphism
\[\widehat{\mathscr{S}}/(\bm{z}-1)\widehat{\mathscr{S}}\cong\mathscr{S}\]
of (\ref{graded ring homogenization prop-1}). The morphism $\eps$ corresponds to the augmentation hommorphism $\mathscr{S}\to\mathscr{S}_0=\mathscr{O}_Y$ with kernel $\mathscr{S}_+$, which is surjective so $\eps$ is a closed immersion (\cref{scheme S-affine closed subscheme char}). Finally, $j$ corresponds similar to the surjective homomorphism $\widehat{\mathscr{S}}\to\mathscr{S}$ of degree $0$, which is the identity on $\mathscr{S}$ and zero on $\bm{z}\widehat{\mathscr{S}}$. By \cref{scheme Proj of qcoh algera closed subscheme char} it is clear that $j$ is everywhere defined and a closed immersion.\par
To prove the other assertions of the proposition, we can evidently assume that $Y=\Spec(A)$ is affine, $\mathscr{S}=\widetilde{S}$ where $S$ is a graded $A$-algebra, whence $\widehat{\mathscr{S}}=(\widehat{S})\widetilde{\hspace*{3mm}}$); the homogeneous elements $f$ of $S_+$ are then identified with the sections of $\widehat{\mathscr{S}}$ over $Y$, and the open subset $D_+(f)$ of $\widehat{C}$ is identified with $\widehat{C}_f$ (\cref{scheme Proj standard open is affine}); similarly the open subset $D(f)$ of $C$ is identified with $C_f$. It then follows from \cref{scheme Proj standard set cover iff generate} and the definition of $\widehat{S}$ that the open subset $\widehat{C}_{\bm{z}}=i(C)$ together with $\widehat{C}_f$ (where $f$ is homogeneous in $S_+$) constitute an open covering of $\widehat{C}$. Moreover, we have
\begin{align}\label{scheme cone canonical morphism-2}
i^{-1}(\widehat{C}_f)=C_f.
\end{align}
In fact, if we identify $i(C)$ with $\widehat{C}_{\bm{z}}$, then
\[\widehat{C}_f\cap i(C)=\widehat{C}_f\cap\widehat{C}_{\bm{z}}=\widehat{C}_{f\bm{z}}=\Spec(\widehat{S}_{(f\bm{z})}).\]
Now if $d=\deg(f)$, $\widehat{S}_{(f\bm{z})}$ is canonically isomorphic to $(\widehat{S}_{(\bm{z})})_{(f/\bm{z}^d)}$ (\cref{graded ring localization of fg prop}), and it follows from the definition of the isomorphism (\ref{graded ring homogenization prop-1}) that the image of $(\widehat{S}_{(\bm{z})})_{(f/\bm{z}^d)}$ under the corresponding isomorphism is exactly $S_f$. As $C_f=\Spec(S_f)$, this proves (\ref{scheme cone canonical morphism-2}) and also shows that the morphism $i$ is affine. Moreover, the restriction of $i$ to $C_f$, considered as a morphism into $\widehat{C}_f$, corresponds (\cref{scheme morphism to affine correspond}) to the canonical homomorphism $\widehat{S}_{(f)}\to\widehat{S}_{(f\bm{z})}\cong S_f$. We also note that under the isomorphism (\ref{graded ring homogenization prop-2}), $\widehat{C}_f$ is canonically idnetified with $\Spec(S_f^{\leqslant})$ and the morphism restriction $i|_{C_f}:C_f\to\widehat{C}_f$ corresponds to the canonical injection $S_f^{\leqslant}\to S_f$. The complement of $\widehat{C}_{\bm{z}}$ in $\widehat{C}=\Proj(\widehat{S})$ is, by definition, the set of graded prime ideals of $\widehat{S}$ containing $\bm{z}$, which is $j(P)$ from the defintion of $j$, whence (\ref{scheme cone canonical morphism-1}).\par
To prove the final assertion, we can still assume that $Y$ is affine. With the preceding notations, we note that $\bm{z}$ is not a zero divisor in $\widehat{S}$, so we can apply \cref{scheme Proj X_f=D_+(f) smallest closed subscheme}.
\end{proof}
We now identify the affine cone $C$ with the open subscheme $i(C)$ of the projective cone $\widehat{C}$, which is dense in $\widehat{C}$. The closed subscheme of $C$ associated with the closed immersion $\eps$ is called the \textbf{sommet scheme} of $C$. We also say that $\eps$, which is a $Y$-section of $C$, is the \textbf{sommet section} or the \textbf{zero section} of $C$; we can then identify $Y$ with the sommet scheme of $C$ via the morphism $\eps$. The composition $i\circ\eps$ is a $Y$-section of $\widehat{C}$, which is also a closed immersion (\cref{scheme morphism to separated graph is closed}), corresponding to the canonical surjective homomorphism $\widehat{\mathscr{S}}=\mathscr{S}[\bm{z}]\to\mathscr{O}_Y[\bm{z}]$ (cf. \cref{scheme Proj of polynomial algebra char}), with kernel $\mathscr{S}_+[\bm{z}]=\widehat{\mathscr{S}}_+$. The closed subscheme of $\widehat{C}$ associated with this closed immersion is called the \textbf{sommet scheme} of $\widehat{C}$, which can be identified with $Y$ via $i\circ\eps$, and $i\circ\eps$ is called the \textbf{sommet section} of $\widehat{C}$. Finally, the closed subscheme of $\widehat{C}$ associated with $j$ is called the \textbf{place of infinity} of $C$, which is identified with $P$ via $j$.\par
The subscheme of $C$ (resp. $\widehat{C}$) induced respectively over the open subsets
\begin{align}\label{scheme blunt cone def}
E=C-\eps(Y),\quad \widehat{E}=\widehat{C}-i(\eps(Y))
\end{align}
are called respectively (by abuse of language) the \textbf{blunt affine cone} (resp. \textbf{blunt projective cone}) defined by $\mathscr{S}$. We note that with this terminology, $E$ is not necessarily affine over $Y$, nor is it projective over $Y$ (cf. \cref{scheme projective closure of A^n eg}). If we identify $C$ with $i(C)$, we then have
\begin{align}\label{scheme blunt cone prop-1}
C\cup\widehat{E}=\widehat{C},\quad C\cap\widehat{E}=E.
\end{align}
so that $\widehat{C}$ can be considered as obtaining by gluing the open subschemes $C$ and $\widehat{E}$ along $E$; moreover, in view of (\ref{scheme cone canonical morphism-1}), 
\begin{align}\label{scheme blunt cone prop-2}
E=\widehat{E}-j(P).
\end{align}
If $Y=\Spec(A)$ is affine, we then have (with the notations of \cref{scheme cone canonical morphism}),
\begin{align}\label{scheme blunt cone prop-3}
E=\bigcup C_f,\quad \widehat{E}=\bigcup\widehat{C}_f,\quad C_f=C\cap\widehat{C}_f
\end{align}
where $f$ runs through homogeneous elements of $S_+$ (or a family of homogeneous elements of $S_+$ generating the ideal $S_+$). The glueing of $C$ and the $\widehat{C}_f$ along the $C_f$ is then determined by the injections $C_f\to C$, $C_f\to\widehat{C}_f$, which correspond to the cannical homomorphisms $S\to S_f$, $S_f^{\leqslant}\to S_f$. On the other hand, we note that $\bigcup\widehat{E}_f$ is the defining domain $G(\varphi)$ of the morphism associated with the canonical injection $\varphi:\mathscr{S}\to\widehat{\mathscr{S}}=\mathscr{S}[\bm{z}]$, so we obtain a morphism $p:\widehat{E}\to P$.
\begin{proposition}\label{scheme projective cone canonical retraction prop}
The associated morphism $p:\widehat{E}\to P$ is an affine and surjective morphism (called the \textbf{canonical retraction}) such that
\begin{align}\label{scheme projective cone canonical retraction prop-1}
p^{-1}(P_f)=\widehat{C}_f
\end{align}
and we have $p\circ j=1_P$. Moreover, if $Y$ is affine and $f\in S_1$, then $\widehat{C}_f$ is isomorphic to $P_f\otimes_{\Z}\Z[T]$ ($T$ is an indeterminate).
\end{proposition}
\begin{proof}
To prove the proposition we may assume that $Y$ is affine, so $\mathscr{S}=\widetilde{S}$. For any $f\in S_+$ homogeneous, by (\ref{scheme Proj induced morphism standard open inverse image}) we have (\ref{scheme projective cone canonical retraction prop-1}) and the restriction $p:\widehat{C}_f\to P_f$ corresponds to the canonical injection $S_{(f)}\to S_f^{\leqslant}$. The formula $p\circ j=1_P$ and the fact that $p$ is surjective follows from the fact that the composition $\mathscr{S}\to\widehat{\mathscr{S}}\to\mathscr{S}$ is the identity on $\mathscr{S}$. Finally, the last assertion follows from the fact that $S_f^{\leqslant}$ is isomorphic to $S_{(f)}[T]$ (cf. (\ref{graded ring localization S_f isomorphic to polynomial})).
\end{proof}
\begin{corollary}\label{scheme projective cone canonical retraction restriction prop}
The restriction $\pi:E\to P$ of $p$ to $E$ is a surjective and affine morphism. If $Y$ is affine and $f\in S_+$ is homogeneous, we have
\begin{align}\label{scheme projective cone canonical retraction restriction prop-1}
\pi^{-1}(P_f)=C_f
\end{align}
and the restriction of $\pi|_{C_f}:C_f\to P_f$ corresponds to the cannical injection $S_{(f)}\to S_f$. If $f\in S_1$, then $C_f$ is isomorphic to $P_f\otimes_{\Z}\Z[T,T^{-1}]$ ($T$ is an indeterminant). 
\end{corollary}
\begin{proof}
The formula (\ref{scheme projective cone canonical retraction restriction prop-1}) follows from (\ref{scheme projective cone canonical retraction prop-1}) and (\ref{scheme cone canonical morphism-2}), which also proves the surjectivity of $\pi$. We also have seen that the canonical injection $C_f\to\widehat{C}_f$ corresponds to $S_{(f)}\to S_f$, whence the second assertion. Finally, the last assertion is a concequence of the fact that for $f\in S_1$, $S_f$ is isomorphic to $S_{(f)}[T,T^{-1}]$ (cf. (\ref{graded ring localization S_f isomorphic to polynomial})).
\end{proof}
\begin{remark}
If $Y$ is affine, the elements of the underlying space of $E$ are the prime ideals $\p$ (not necessarily graded) of $S$ not containing $S_+$, in ivew of the definition of the immersion $\eps$. For such a prime ideal $\p$, the intersections $\p\cap S_n$ satisfy the conditions of \cref{graded ring coincide partly with prime ideal iff}, so there exists a graded prime ideal $\q$ of $S$ such that $\q\cap S_n=\p\cap S_n$ for any $n$. The map $\pi:E\to P$ on the underlying topological space is then interpreted by the relation
\[\pi(\p)=\q.\]
In fact, to verify this relation, it suffices to consider a homogeneous element $f$ of $S_+$ such that $\p\in D(f)$, and we then observe that $\q_{(f)}$ is the inverse image of $\p_f$ under the canonical injection $S_{(f)}\to S_f$.
\end{remark}
\begin{corollary}\label{scheme projective cone morphism p, pi fiber char}
If $\mathscr{S}$ is generated by $\mathscr{S}_1$, the morphism $p$ and $\pi$ are of finite type. Moreover, for any $x\in P$, the fiber $p^{-1}(x)$ is isomorphic to $\Spec(\kappa(x)[T])$ and $\pi^{-1}(x)$ is isomorphic to $\Spec(\kappa(x)[T,T^{-1}])$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme projective cone canonical retraction prop} and \cref{scheme projective cone canonical retraction restriction prop}, since if $Y$ is affine and $S$ is genrated by $S_1$, then the $P_f$ for $f\in S_1$ form an open covering of $P$.
\end{proof}
\begin{remark}
The blunt affine cone $E$ corresponding to the graded $\mathscr{O}_Y$-algebra $\mathscr{O}_Y[T]$ (where $T$ is an indeterminate) is identified with $G_m=\Spec(\mathscr{O}_Y[T,T^{-1}])$, since it is none other than $C_T$ as we have seen in \cref{scheme cone canonical morphism}. This scheme is canonically endowed with an abelian group $Y$-scheme structure.
\end{remark}
\begin{example}\label{scheme projective cone of variety eg}
Let $k$ be a field, $k[T_0,\dots,T_n]$ be the polynomial ring, and $\p$ be a graded prime ideal of $k[T_0,\dots,T_n]$ not containing the irrelevant ideal. Consider the quotient graded ring $S=k[T_0,\dots,T_n]/\p$, and set
\[P=\Proj(S),\quad C=\Spec(S),\quad\widehat{C}=\Spec(\widehat{S}).\]
In the language of varieties, if $V\sub\P^n_k$ is the variety defined by $S$, $C$ can be viewed as the affine cone obtained by considering the lines connecting the origin with points of $V$. Moreover, $\widehat{C}$ is the closure of $C$ in $\P^{n+1}_k$ if we embed $\A^{n+1}_k$ into $\P^{n+1}_k$ via the map $(x_0,\dots,x_n)\to[x_0:\dots:x_n:1]$. Also, the morphism $j:P\to\widehat{C}$ corresponds to the injection $[x_0:\cdots:x_n]\mapsto[x_0:\cdots:x_n:0]$. With these, the projective closure $\widehat{C}$ of $C$ in $\P^{n+1}$ is given by the equivalent classes $[x_0:\cdots:x_n:x_{n+1}]$ in $\P^{n+1}$ such that $[x_0:\dots:x_n]\in P$, and we can divide into two cases depending on whether $x_{n+1}\neq 0$:
\begin{enumerate}
\item[(a)] $(x_0,\dots,x_n)\in C$, $x_{n+1}\neq 0$;
\item[(b)] $[x_0:\dots:x_n]\in P$, $x_{n+1}=0$.
\end{enumerate}
Thus we see that the variety $\widehat{C}$ can be viewed as a union of $P$ with $C$, which justifies the formula (\ref{scheme cone canonical morphism-1}). Also, by definition the blunt affine cone $E$ is the subvariety of $C$ obtained by removing the origin of $\A^{n+1}$, and $\widehat{E}$ can be considered as a union of $E$ and $P$, which is also the projective cone $\widehat{C}$ removing the point $[0:\cdots:0:1]$ in $\P^{n+1}$. We also remark that if we base change $C$ through the structural morphism $P\to Y$, then the projection $C_{(P)}\to C$ can be viewed as the projection from $\A^{n+1}\times\P^n$ to $\P^n_k$ which maps $(x,\xi)$ to $\xi$ (where the class of $x\in\A^{n+1}_k$ is equal to $\xi$), and this is the blow up map of $\A^{n+1}_k$ at the origin.
\end{example}
Let $Y$ be a scheme, $\mathscr{E}$ be a quasi-coherent $\mathscr{O}_Y$-module. If $\mathscr{S}$ is the graded $\mathscr{O}_Y$-algebra $\bm{S}_{\mathscr{O}_Y}(\mathscr{E})$, then $\widehat{\mathscr{S}}$ is identified with $\bm{S}_{\mathscr{O}_Y}(\mathscr{E}\oplus\mathscr{O}_Y)$. The affine cone $\Spec(\mathscr{S})$ defined by $\mathscr{S}$ is by definition the vector bundle $\bm{V}(\mathscr{E})$, and $\Proj(\mathscr{S})$ is by definition $\P(\mathscr{E})$, so we see that:
\begin{proposition}\label{scheme projective closure of V(E) char}
The projective closure of a vector bundle $\bm{V}(\mathscr{E})$ over $Y$ is canonically isomorphic to $\P(\mathscr{E}\oplus\mathscr{O}_Y)$, and the place of infinity of this is canonically isomorphic to $\P(\mathscr{E})$.
\end{proposition}
\begin{example}\label{scheme projective closure of A^n eg}
Put for example $\mathscr{E}=\mathscr{O}_Y^r$ where $r\geq 2$. Then the blunt cones $E,\widehat{E}$ defined by $\mathscr{S}$ are neither affine nor projective over $Y$ if $Y\neq\emp$. The second assertion is immediate, since $\widehat{C}=\P(\mathscr{O}_Y^{r+1})$ is projective over $Y$ and the underlying spaces of $E$ and $\widehat{E}$ are not closed in $\widehat{C}$, so the canonical immersions $E\to\widehat{C}$ and $\widehat{E}\to\widehat{C}$ are not projective (\cref{scheme projective and quasi-projective} and \cref{scheme morphism projective permanence prop}(\rmnum{5})). On the other hand, suppose that $Y=\Spec(A)$ is affine and for example $r=2$; we have $C=\Spec(A[T_1,T_2])$ and $E$ is the open subscheme $D(T_1)\cup D(T_2)$ of $C$, and we have seen that this is not affine (\cref{scheme nonseparated eg}); a fortiori $\widehat{E}$ is not affine, since $E$ is the open subset of $\widehat{E}$ where the section $\bm{z}$ is nonzero (\ref{scheme blunt cone prop-1}).
\end{example}
\begin{proposition}\label{scheme blunt cone of V(L) isomorphism}
Let $\mathscr{L}$ be an invertible $\mathscr{O}_Y$-module, we have canonical isomorphisms for the blunt cones corresponding to $C=V(\mathscr{L})$:
\begin{align}\label{scheme blunt cone of V(L) isomorphism-1}
\Spec(\bigoplus_{n\in\Z}\mathscr{L}^n)\stackrel{\sim}{\to}E,\quad\bm{V}(\mathscr{L}^{-1})\stackrel{\sim}{\to}\widehat{E}.
\end{align}
Moreover, there exists a canonical isomorphism from the projective closue of $V(\mathscr{L})$ to that of $V(\mathscr{L}^{-1})$, which transform the sommet scheme (resp. the place of infinity) of the first one to the place of infinity (resp. the sommet scheme) of the second one.
\end{proposition}
\begin{proof}
Here we have $\mathscr{S}=\bigoplus_{n\geq 0}\mathscr{L}^{\otimes n}$; the canonical injection $\mathscr{S}\to\bigoplus_{n\in\Z}\mathscr{L}^{\otimes n}$ defines a cannical dominant morphism
\begin{align}\label{scheme blunt cone of V(L) isomorphism-2}
\Spec(\bigoplus_{n\in\Z}\mathscr{L}^{\otimes n})\to \bm{V}(\mathscr{L})=\Spec(\bigoplus_{n\geq 0}\mathscr{L}^{\otimes n})
\end{align}
and it suffices to prove that this morphism is an isomorphism from $\Spec(\bigoplus_{n\in\Z}\mathscr{L}^{\otimes n})$ to $E$. The question is local over $Y$, so we can suppose that $Y=\Spec(A)$ is affine and $\mathscr{L}=\mathscr{O}_Y$, so $\mathscr{S}=\widetilde{A[T]}$ and $\bigoplus_{n\in\Z}\mathscr{L}^{\otimes n}=\widetilde{A[T,T^{-1}]}$. Now $A[T,T^{-1}]$ is the fraction ring $A[T]_T$ of $A[T]$, so (\ref{scheme blunt cone of V(L) isomorphism-2}) identify $\Spec(\bigoplus_{n\in\Z}\mathscr{L}^{\otimes n})$ as the open subscheme $D(T)$ of $C=\bm{V}(\mathscr{L})$, which by definition is $E$.\par
The isomorphism $\bm{V}(\mathscr{L}^{-1})\cong\widehat{E}$ will on the other hand be a consequence of the last assertion, since $\bm{V}(\mathscr{L}^{-1})$ is the complement of the place of infinity of its integral closure and $\widehat{E}$ is the complement of the sommet scheme of projective closure of $C=\bm{V}(\mathscr{E})$. Now these projective closures are respectively $\P(\mathscr{L}^{-1}\oplus\mathscr{O}_Y)$ and $\P(\mathscr{L}\oplus\mathscr{O}_Y)$; but we have
\[\mathscr{L}\oplus\mathscr{O}_Y=\mathscr{L}\oplus(\mathscr{L}\otimes\mathscr{L}^{-1})=\mathscr{L}\otimes(\mathscr{L}^{-1}\oplus\mathscr{O}_Y),\]
so the existence of the isomorphism follows from \cref{scheme projective bundle of tensor with invertible prop}, and it remains to see that this isomorphism exchanges the sommet scheme and the place of infinity. For this we can assume that $Y=\Spec(A)$ is affine, $\mathscr{L}=\widetilde{L}$, with $L=Ac$, $L^{-1}=Ac'$, and the canonical isomorphism $L\otimes L^{-1}\to A$ sends $c\otimes c'$ to $1$. Then
\[\bm{S}(L\oplus A)=A[\bm{z}]\otimes\bigoplus_{n\geq 0}Ac^{\otimes n},\quad\bm{S}(L^{-1}\oplus A)=A[\bm{z}]\otimes\bigoplus_{n\geq 0}Ac'^{\otimes n},\]
and the isomorphism defined in \cref{scheme projective bundle of tensor with invertible prop} sends $\bm{z}^h\otimes c'^{\otimes(n-h)}$ to the element $\bm{z}^{n-h}\otimes c^{\otimes h}$. Now, in $\P(\mathscr{L}^{-1}\oplus\mathscr{O}_Y)$ the place of infinity is the set of points where the section $\bm{z}$ vanishes, and the sommet section is the set of points where the section $c'$ vanishes. As we have a similary description for $\P(\mathscr{L}\oplus\mathscr{O}_Y)$, our conclusion follows immediately from the preceding explanations.
\end{proof}
\subsection{Functorial properties}
Let $Y,Y'$ be two schemes, $q:Y'\to Y$ be a morphism, $\mathscr{S}$ (resp. $\mathscr{S}'$) be a quasi-coherent $\mathscr{O}_Y$-algebra (resp. $\mathscr{O}_{Y'}$-algebra) with positive degrees. Consider a $q$-morphism of graded algebras
\[\varphi:\mathscr{S}\to\mathscr{S}'.\]
We have seen that this corresponds canonically to a morphism
\[\Phi=\Spec(\varphi)=\Spec(\mathscr{S}')\to\Spec(\mathscr{S})\]
such that the diagram
\begin{equation}\label{scheme projective closure functorial-1}
\begin{tikzcd}
C'\ar[r,"\Phi"]\ar[d]&C\ar[d]\\
Y'\ar[r,"q"]&Y
\end{tikzcd}
\end{equation}
where $C=\Spec(\mathscr{S})$, $C'=\Spec(\mathscr{S}')$, is commutative. Suppose moreover that $\mathscr{S}_0=\mathscr{O}_Y$ and $\mathscr{S}'_0=\mathscr{O}_{Y'}$; let $\eps:Y\to C$ and $\eps':Y'\to C'$ be the cannical immersions, we then have a commutative diagram
\begin{equation}\label{scheme projective closure functorial-2}
\begin{tikzcd}
C'\ar[r,"\Phi"]&C\\
Y'\ar[r,"q"]\ar[u,"\eps'"]&Y\ar[u,swap,"\eps"]
\end{tikzcd}
\end{equation}
which corresponds to the diagram
\[\begin{tikzcd}
\mathscr{S}\ar[r,"\varphi"]\ar[d]&\mathscr{S}'\ar[d]\\
\mathscr{O}_Y\ar[r]&\mathscr{O}_{Y'}
\end{tikzcd}\]
where the vertical are augmentation homomorphisms, and the commutativity follows from the hypotheses that $\varphi$ is a homomorphism of graded algebras.
\begin{proposition}\label{scheme blunt affine cone induced morphism prop}
If $E$ (resp. $E'$) is the blunt affine cone defined by $\mathscr{S}$ (resp. $\mathscr{S}'$), we have $\Phi^{-1}(E)\sub E'$. Moreover, the morphism $\Proj(\varphi):G(\varphi)\to\Proj(\mathscr{S})$ is everywhere defined (in other words $G(\varphi)=\Proj(\mathscr{S}')$) if and only if $\Phi^{-1}(E)=E'$.
\end{proposition}
\begin{proof}
The first assertion followsfrom (\ref{scheme projective closure functorial-2}), since $E=C-\eps(Y)$ and $E'=C'-\eps'(Y')$. To prove the second assertion, we can assume that $Y=\Spec(A)$ and $Y'=\Spec(A')$ are affine, $\mathscr{S}=\widetilde{S}$, $\mathscr{S}'=\widetilde{S}'$. For $f$ homogeneous in $S_+$, if we put $f'=\varphi(f)$, we have $\Phi^{-1}(C_f)=C'_{f'}$ (\ref{scheme Proj induced morphism standard open inverse image}); to say that $G(\varphi)=\Proj(S')$ signifies that in $S'_+$ the radical of the ideal generated by the $f'=\varphi(f)$ is equal to $S'_+$ (\cref{scheme Proj standard set cover iff generate}), and this is equivalent to that the $C'_{f'}$ cover $E'$ (\ref{scheme blunt cone prop-3}).
\end{proof}
The $q$-morphism $\varphi$ extends canonically to a $q$-morphism of graded algebras
\[\hat{\varphi}:\widehat{\mathscr{S}}\to\widehat{\mathscr{S}}'\]
which satisfies $\hat{\varphi}(\bm{z})=\bm{z}$. We then deduce a morphism
\[\hat{\Phi}=\Proj(\hat{\varphi}):G(\hat{\varphi})\to\widehat{C}=\Proj(\widehat{\mathscr{S}})\]
such that the diagram
\[\begin{tikzcd}
G(\hat{\varphi})\ar[d]\ar[r,"\hat{\Phi}"]&\widehat{C}\ar[d]\\
Y'\ar[r,"q"]&Y
\end{tikzcd}\]
is commutative. It then follows from the definition that if we denote by $i:C\to\widehat{C}$ and $i':C'\to\widehat{C}'$ are the canonical immersions, we have $i'(C')\sub G(\hat{\varphi})$ and the diagram
\begin{equation}\label{scheme projective closure functorial-3}
\begin{tikzcd}
G(\hat{\varphi})\ar[r,"\hat{\Phi}"]&\widehat{C}\\
C'\ar[u,"i'"]\ar[r,"\Phi"]&C\ar[u,swap,"i"]
\end{tikzcd}
\end{equation}
is commutative. Finally, if we put $P=\Proj(\mathscr{S})$, $P'=\Proj(\mathscr{S}')$, and if $j:P\to\widehat{C}$, $j':P'\to\widehat{C}'$ are the canonical closed immersions, we have $j'(G(\varphi))\sub G(\hat{\varphi})$ and the diagram
\begin{equation}
\begin{tikzcd}
G(\hat{\varphi})\ar[r,"\hat{\Phi}"]&\widehat{C}\\
G(\varphi)\ar[r,"\Proj(\varphi)"]\ar[u,"j"]&P\ar[u,swap,"j"]
\end{tikzcd}
\end{equation}
is commutative.
\begin{proposition}\label{scheme blunt projective cone induced morphism prop}
If $\widehat{E}$ (resp. $\widehat{E}'$) is the blunt projective cone defined by $\mathscr{S}$ (resp. $\mathscr{S}'$), we have $\hat{\Phi}^{-1}(\widehat{E})\sub\widehat{E}'$. Moreover, if $p:\widehat{E}\to P$ and $p':\widehat{E}'\to P'$ are the canonical retractions, we have $p'(\hat{\Phi}^{-1}(\widehat{E}))\sub G(\varphi)$, and the diagram
\[\begin{tikzcd}
\hat{\Phi}^{-1}(\widehat{E})\ar[r,"\hat{\Phi}"]\ar[d,swap,"p'"]&E\ar[d,"p"]\\
G(\varphi)\ar[r,"\Proj(\varphi)"]&P
\end{tikzcd}\]
is commutative. If $\Proj(\varphi)$ is everywhere defined, so is $\hat{\Phi}$ and we have $\hat{\Phi}^{-1}(\widehat{E})=\widehat{E}'$.
\end{proposition}
\begin{proof}
The first assertion follows from the commutative diagrams (\ref{scheme projective closure functorial-1}) and (\ref{scheme projective closure functorial-3}), and the next two follow from the definition of the canonical retraction, the definition of $\hat{\varphi}$, and the fact that $\widehat{E}$ is the defining domain of the morphism induced by the canonical injection $\mathscr{S}\to\widehat{\mathscr{S}}$. On the other hand, to see that $\hat{\Phi}$ is everywhere defined if $\Proj(\varphi)$ is, we can assume that $Y=\Spec(A)$, $Y'=\Spec(A')$ are affine, $\mathscr{S}=\widetilde{S}$, $\mathscr{S}'=\widetilde{S}'$; the hypothesis is that if $f$ runs through homogeneous elements of $S_+$, the ideal in $S'_+$ generated by the $\varphi(f)$ has radical in $S'_+$ equal to $S'_+$. We then conclude that the radical of the ideal genrated by $\bm{z}$ and the $\varphi(f)$ in $(S'[\bm{z}])_+$ is equal to $(S'[\bm{z}])_+$, whence our assertion. This proves similarly that $\widehat{E}'$ is the union of the $\widehat{C}'_{(\varphi(f))}$, which is equal to $\hat{\Phi}^{-1}(\widehat{E})$. 
\end{proof}
\begin{corollary}\label{scheme infinite place and sommet scheme inverse image char}
If $\Phi$ is everywhere defined, the inverse image under $\hat{\Phi}$ of underlying space of the place of infinity (resp. the sommet scheme) of $\widehat{C}'$ is the underlying space of the place of infinity (resp. the sommet scheme) of $\widehat{C}$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme blunt projective cone induced morphism prop} and \cref{scheme blunt affine cone induced morphism prop}, in ivew of the relations (\ref{scheme blunt cone def}) and (\ref{scheme blunt cone def}).
\end{proof}
\subsection{Blunt cones over a homogeneous specturm}
Let $Y$ be a scheme, $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra with positive degrees such that $\mathscr{S}_0=\mathscr{O}_Y$, and $X=\Proj(\mathscr{S})$. We now apply the previous results to the structure morphism $q:X\to Y$. Let
\begin{align}\label{scheme cones over Proj qcoh alg S_X def}
\mathscr{S}_X=\bigoplus_{n\in\Z}\mathscr{O}_X(n)
\end{align}
which is a quasi-coherent $\mathscr{O}_X$-algebra, the multiplication $\gamma$ being defined by the canonical homomorphisms
\[\mathscr{O}_X(m)\otimes\mathscr{O}_X(n)\to\mathscr{O}_X(m+n)\]
which satisfies the associativity in view of \cref{scheme Proj of qcoh module tensor and Hom prop}. Let $\mathscr{S}'$ be the quasi-coherent sub-algebra
\[\mathscr{S}_X^{\geqslant}=\bigoplus_{n\geq 0}\mathscr{O}_X(n)\]
of $\mathscr{S}_X$, with positive degrees. For each $n\in\Z$, we have a canonical $q$-morphisms $\alpha_n:\mathscr{S}_n\to\mathscr{O}_X(n)$ defined in (\ref{scheme Proj of qcoh alg homomorphism alpha_n}), which together give a homomorphism
\[\alpha:\mathscr{S}\to\bigoplus_{n\geq 0}q_*(\mathscr{O}_X(n)).\]
By composing with the canonical homomorphism $\bigoplus_{n\geq 0}q_*(\mathscr{O}_X(n))\to q_*(\mathscr{S}_X^{\geqslant})$, this gives a $q$-homomorphism $\mathscr{S}\to\mathscr{S}_X^{\geqslant}$, still denoted by $\alpha$. We set
\[C_X=\Spec(\mathscr{S}_X^{\geqslant}),\quad \widehat{C}_X=\Proj(\mathscr{S}_X^{\geqslant}[\bm{z}]),\quad P_X=\Proj(\mathscr{S}_X^{\geqslant})\]
and denote by $E_X$ and $\widehat{E}_X$ the corresponding blunt cones. We then have the canonical morphisms
\[\begin{tikzcd}
&\widehat{C}_X\ar[dd]&\\
P_X\ar[rd]\ar[ru,"j_X"]&&C_X\ar[lu,swap,"i_X"]\ar[ld]\\
&X\ar[ru,bend left=20pt,"\eps_X"]&
\end{tikzcd}\]
and $p_X:\widehat{E}_X\to P_X$, $\pi_X:E_X\to P_X$.
\begin{proposition}\label{scheme blunt cone over Proj isomorphism prop}
The structural morphism $\psi:P_X\to X$ is an isomorphism, and the morphism $\Proj(\alpha)$ is everywhere defined and equals to $\psi$. The morphism $\Proj(\hat{\alpha}):\widehat{C}_X\to\widehat{C}$ is everywhere defined and its restriction to $\widehat{E}_X$ and $E_X$ are isomorphisms into $\widehat{E}$ and $E$, respectively. Finally, if we identify $P_X$ and $X$ via $\psi$, the morphisms $p_X$ and $\pi_X$ are identified with the structural morphisms of the $X$-schemes $\widehat{E}_X$ and $E_X$.
\end{proposition}
\begin{proof}
We can clearly assume that $Y=\Spec(A)$ is affine and $\mathscr{S}=\widetilde{S}$; then $X$ is the union of the affine opens $X_f$, where $f\in S_+$ is homogeneous, the ring of $X_f$ being $S_{(f)}$. It follows from the isomorphism (\ref{graded ring natural isomorphism prop-1}) that
\begin{align}\label{scheme blunt cone over Proj isomorphism prop-1}
\Gamma(X_f,\mathscr{S}_X^{\geqslant})=S_f^{\geqslant}.
\end{align}
We then have $\psi^{-1}(X_f)=\Proj(S_f^{\geqslant})$. But if $f\in S_d$ with $d>0$, $\Proj(S_f^{\geqslant})$ is canonically isomorphic to $\Proj((S_f^{\geqslant})^{(d)})$ by \cref{scheme Proj of alg alter ring twisted sheaf char}, and $(S_f^{\geqslant})^{(d)}=(S^{(d)})_f^{\geqslant}$ is identified with $S_{(f)}[T]$ by the map $T\mapsto f/1$ (cf. (\ref{graded ring localization S_f isomorphic to polynomial})), so we conclude from \cref{scheme Proj of polynomial algebra char} that the structural morphism $\psi^{-1}(X_f)\to X_f$ is an isomorphism, whence the first assertion. To prove the second one, we first note that $\Proj(\alpha)$ is everywhere defined by \cref{graded ring positive degree S^natural prop}. Since $\psi^{-1}(X_f)=(\psi^{-1}(X_f))_{f/1}$, it follows from (\ref{scheme Proj induced morphism standard open inverse image}) that the image of $\psi^{-1}(X_f)$ under $\Proj(\alpha)$ is contained in $X_f$, and the restriction of $\Proj(\alpha)$ to $\psi^{-1}(X_f)$, considered as a morphism into $X_f=\Spec(S_{(f)})$, is identified with $\psi$. Finally, the formula (\ref{scheme projective cone canonical retraction prop-1}) and (\ref{graded ring homogenization prop-2}) show that $p_X^{-1}(\psi^{-1}(X_f))=\Spec((S_f^{\geqslant})_{f/1}^{\leqslant})$, and this open subset is, by \cref{scheme blunt projective cone induced morphism prop} and formula (\ref{scheme projective cone canonical retraction prop-1}), the inverse image of $p^{-1}(X_f)=\Spec(S_f^{\leqslant})$ under $\Proj(\hat{\alpha})$. By the isomorphism (\ref{graded ring homogenization prop-2}), the restriction of $\Proj(\hat{\alpha})$ to $p_X^{-1}(\psi^{-1}(X_f))$ corresponds to the isomorphism $S_f^{\leqslant}\cong (S_f^{\geqslant})_{f/1}^{\leqslant}$, whence the third assertion. The last assertion is clear by definition.
\end{proof}
We note that by (\ref{scheme projective closure functorial-3}) the restriction of $\Proj(\hat{\alpha})$ to $C_X$ is equal to $\Spec(\alpha)$.
\begin{corollary}\label{scheme blunt cone over Proj isomorphic to Spec}
Considered as $X$-schemes, $\widehat{E}_X$ is canonically isomorphic to $\Spec(\mathscr{S}_X^{\leqslant})$, $E_X$ is canonically isomorphic to $\Spec(\mathscr{S}_X)$, and $C_X$ is canonically isomorphic to $\Spec(\mathscr{S}_X^{\geqslant})$.
\end{corollary}
\begin{proof}
As we have seen that $p_X$ and $\pi_X$ are affine, it suffices to verify the corollary if $Y=\Spec(A)$ is affine and $\mathscr{S}=\widetilde{S}$. The first assertion follows from the canonical isomorphism ${(S_f^{\geqslant})_{f/1}}^{\hspace*{-10pt}\substack{\leqslant\\[-1.87ex]~}}\hspace*{4pt}\cong S_f^{\leqslant}$, which are compatible with passage from $f$ to $fg$ ($f,g$ homogeneous in $S_+$). Similarly, the formula (\ref{scheme projective cone canonical retraction restriction prop-1}), applied to $\pi_X$, shows that $\pi_X^{-1}(\psi^{-1}(X_f))=\Spec((S_f^{\geqslant})_{f/1})$ for $f$ homogeneous in $S_+$, and the second assertion then follows from the canonical isomorphism $(S_f^{\geqslant})_{f/1}\cong S_f$.
\end{proof}
We can then say that $\widehat{C}_X$, considered as an $X$-scheme, is obtained by glueing the affine $X$-schemes $C_X=\Spec(\mathscr{S}_X^{\geqslant})$ and $\widehat{E}_X=\Spec(\mathscr{S}_X^{\leqslant})$ along their intersection $E_X=\Spec(\mathscr{S}_X)$.
\begin{corollary}\label{scheme blunt cone over Proj isomorphic to vector bundle}
Suppose that $\mathscr{O}_X(1)$ is an invertible $\mathscr{O}_X$-module and that $\mathscr{S}_X\cong\bigoplus_{n\in\Z}(\mathscr{O}_X(1))^{\otimes n}$ (for example if $\mathscr{S}$ is generated by $\mathscr{S}_1$). Then the blunt projective cone $\widehat{E}$ is identified with the rank one vector bundle $\bm{V}(\mathscr{O}_X(-1))$ over $X$, and the bulnk affine cone $E$ is isomorphic to the open subscheme induced over the complement of the zero section in this vector bundle. With these indentifications, the canonical retraction $\widehat{E}\to X$ is identified with the structural morphism of the $X$-scheme $\bm{V}(\mathscr{O}_X(-1))$. Finally, there exists a canonical $Y$-morphism $\bm{V}(\mathscr{O}_X(1))\to C$, whose restriction to the complement of the zero section of $\bm{V}(\mathscr{O}_X(1))$ is an isomorphism from this complement to the blunt affine cone $E$.
\end{corollary}
\begin{proof}
In fact, if $\mathscr{L}=\mathscr{O}_X(1)$, then $\mathscr{S}_X^{\geqslant}$ is identified with $\bm{S}_{\mathscr{O}_X}(\mathscr{L})$ and $\mathscr{S}_X^{\leqslant}$ is identified with $\bm{S}_{\mathscr{O}_X}(\mathscr{L}^{-1})$, so $\widehat{E}_X$ is identified with $\bm{V}(\mathscr{L}^{-1})$ in view of \cref{scheme blunt cone over Proj isomorphic to Spec} and $C_X$ is identified with $\bm{V}(\mathscr{L})$. The morphism $\bm{V}(\mathscr{L})\to C$ is the restriction of $\Proj(\hat{\alpha})$, and the assertion of the corollary is a particular case of \cref{scheme blunt cone over Proj isomorphism prop}.
\end{proof}
We note that the inverse image of the sommet scheme of $C$ under the morphism $\bm{V}(\mathscr{O}_X(1))\to C$ is the zero section of $\bm{V}(\mathscr{O}_X(1))$ (\cref{scheme infinite place and sommet scheme inverse image char}). But in general the corresponding subschemes of $C$ and of $\bm{V}(\mathscr{O}_X(1))$ are not isomorphic.
\subsection{Blow up of projective cones}
With the notations of the previous subsection, we have a commutative diagram
\[\begin{tikzcd}
\widehat{C}_X\ar[r,"r"]&\widehat{C}\\
X\ar[r,"q"]\ar[u,"i_X\circ\eps_X"]&Y\ar[u,swap,"i\circ\eps"]
\end{tikzcd}\]
where $r=\Proj(\hat{\alpha})$. Moreover, the restriction of $r$ to the complement $\widehat{C}_X-i_X(\eps_X(X))$ of the sommet section is an isomorphism to $\widehat{C}-i(\eps(Y))$ of the sommet section in view of \cref{scheme blunt cone over Proj isomorphism prop}. If we suppose for simplicity that $Y$ is affine, $\mathscr{S}$ is of finite type and generated by $\mathscr{S}_1$, $X$ is projective over $Y$ and $\widehat{C}_X$ is projective over $X$, so $\widehat{C}_X$ is projective over $Y$ (\cref{scheme morphism projective permanence prop}(\rmnum{2})), and a fortiori over $\widehat{C}$ (\cref{scheme morphism projective permanence prop}(\rmnum{5})). We thus have a projective $Y$-morphism $r:\widehat{C}_X\to\widehat{C}$ (hence restricts to a projective $Y$-morphism $C_X\to C$) which contract $X$ to $Y$ and induces an isomorphism when restricted to the complement of $X$ and of $Y$. We therefore have a relation between $C_X$ and $C$, analogous to that which takes place between a blow up scheme and its initial scheme. We will effectively show that we can identify $C_X$ with the homogeneous spectrum of a graded $\mathscr{O}_C$-algebra.\par
For each $n\geq 0$, we consider the quasi-coherent ideal
\[\mathscr{S}(n)=\bigoplus_{m\geq n}\mathscr{S}_m\]
of the graded $\mathscr{O}_Y$-algebra of $\mathscr{S}$. It is clear that $(\mathscr{S}(n))_{n\geq 0}$ is a filtered sequence of ideals of $\mathscr{S}$. Consider the $\mathscr{O}_C$-module associated with $\mathscr{S}(n)$, which is a quasi-coherent ideal of $\mathscr{O}_C=\widetilde{\mathscr{S}}$:
\[\mathscr{I}_n=\widetilde{\mathscr{S}(n)}.\]
Then $(\mathscr{I}_n)$ is also a filtered sequence of quasi-coherent $\mathscr{O}_C$-ideals, so we can consider the quasi-coherent graded $\mathscr{O}_C$-algebra 
\[\mathscr{S}^{\natural}=\bigoplus_{n\geq 0}\mathscr{I}_n=\Big(\bigoplus_{n\geq 0}\mathscr{S}(n)\Big)^{\widetilde{\hspace*{3mm}}}.\]
\begin{proposition}\label{scheme affine cone over Proj isomorphic to Proj}
There exists a canonical $C$-isomorphism
\begin{align}\label{scheme affine cone over Proj isomorphic to Proj-1}
h:C_X\to\Proj(\mathscr{S}^{\natural}).
\end{align}
\end{proposition}
\begin{proof}
Suppose first that $Y=\Spec(A)$ is affine, so $\mathscr{S}=\widetilde{S}$ where $S$ is a graded $A$-algebra with positive degrees and $C=\Spec(S)$. We then have $\mathscr{S}^{\natural}=\widetilde{(S^{\natural})}$. To define the morphism $h$, consider an element $f\in S_d$ ($d>0$) and the corresponding element $f^{\natural}\in S^{\natural}$; the $S$-isomorphism (\ref{graded ring natural isomorphism prop-3}) defines a $C$-isomorphism
\begin{align}\label{scheme affine cone over Proj isomorphic to Proj-2}
\Spec(S_f^{\geqslant})\stackrel{\sim}{\to}\Spec(S^{\natural}_{(f^{\natural})}).
\end{align}
But with the notations of \cref{scheme blunt cone over Proj isomorphism prop}, if $\varphi:C_X\to X$ is the structural morphism, it follows from (\ref{scheme blunt cone over Proj isomorphism prop-1}) that $\varphi^{-1}(X_f)=\Spec(S_f^{\geqslant})$. We have on the other hand $D_+(f^{\natural})=\Spec(S^{\natural}_{(f^{\natural})})$, so that (\ref{scheme affine cone over Proj isomorphic to Proj-2}) define an isomorphism $v^{-1}(X_f)\to D_+(f^{\natural})$. Moreover, if $g\in S_e$ with $e>0$, the diagram
\[\begin{tikzcd}
\varphi^{-1}(X_{fg})\ar[d]\ar[r,"\sim"]&D_+(f^{\natural}g^{\natural})\ar[d]\\
\varphi^{-1}(X_f)\ar[r,"\sim"]&D_+(f^{\natural})
\end{tikzcd}\]
is commutative, which is clear from the definition of (\ref{graded ring natural isomorphism prop-3}). By definition $S_+$ is generated by these homogeneous elements $F$, so it follows from \cref{graded ring positive degree S^natural prop}(\rmnum{4}) that the $D_+(f^{\natural})$ form a covering of $\Proj(S^{\natural})$ and the $\varphi^{-1}(X_f)$ form a covering of $C_X$, if $X_f$ form a covering of $X$. These together gives a isomorphism $h:C_X\to\Proj(\mathscr{S}^{\natural})$.\par
To prove the proposition in the general case, it suffices to see that if $U$, $U'$ are two affine opens of $Y$ such that $U'\sub U$, with rings $A$ and $A'$, and if $\mathscr{S}|_U=\widetilde{S}$, $\mathscr{S}|_{U'}=\widetilde{S}'$, the diagram
\begin{equation}\label{scheme affine cone over Proj isomorphic to Proj-3}
\begin{tikzcd}
C_{U'}\ar[r]\ar[d]&\Proj(S^{\natural})\ar[d]\\
C_U\ar[r]&\Proj(S^{\natural})
\end{tikzcd}
\end{equation}
is commutative. But $S'$ is canonically identified with $S\otimes_AA'$, so $S'^{\natural}$ is identified with $S^{\natural}\otimes_SS'=S^{\natural}\otimes_AA'$ and we then have $\Proj(S'^{\natural})=\Proj(S^{\natural})\times_UU'$ (\cref{scheme Proj base ring change prop}). Similarly, if $X=\Proj(S)$ and $X'=\Proj(S')$, we have $X'=X\times_UU'$ and $\mathscr{S}_{X'}=\mathscr{S}_X\otimes_{\mathscr{O}_U}\mathscr{O}_{U'}$ (\cref{scheme Proj of qcoh alg base change twisted sheaf prop}), which means $\mathscr{S}_{X'}=j^*(\mathscr{S}_X)$, where $j:X'\to X$ is the projection. By \cref{scheme S-affine algebra under base change prop} we then have $C_{U'}=C_U\times_XX'=C_U\times_UU'$, and the commutativity of (\ref{scheme affine cone over Proj isomorphic to Proj-3}) is immediate.
\end{proof}
\begin{remark}\label{scheme blunt affine cone isomorphism functorial}
The end of the reasoning of \cref{scheme affine cone over Proj isomorphic to Proj} is immediately generalized in the following way.: let $g:Y'\to Y$ be a morphism, $\mathscr{S}'=g^*(\mathscr{S})$, $X'=\Proj(\mathscr{S}')$; we then have a commutative diagram
\begin{equation}\label{scheme blunt affine cone isomorphism functorial-1}
\begin{tikzcd}
C_{X'}\ar[r]\ar[d]&\Proj(\mathscr{S}'^{\natural})\ar[d]\\
C_X\ar[r]&\Proj(\mathscr{S}^{\natural})
\end{tikzcd}
\end{equation}
On the other hand, let $\varphi:\mathscr{S}''\to\mathscr{S}$ be a homomorphism of graded $\mathscr{O}_Y$-algebras such that the induced morphism $\Phi=\Proj(\varphi):X\to X''$ is everywhere defined, where $X''=\Proj(\mathscr{S}'')$. We have an $Y$-morphism $v:C\to C''$ (where $C''=\Spec(\mathscr{S}'')$) such that $\mathscr{A}(v)=\varphi$, and as $\varphi$ is a graded homomorphism, we deduce from $\varphi$ a $v$-morphism $\psi:\mathscr{S}''^{\natural}\to\mathscr{S}^{\natural}$ (\cref{scheme S-affine functor on qcoh full faithful}). Moreover, it follows from \cref{graded ring positive degree S^natural prop}(\rmnum{4}) and the hypotheses on $\varphi$ that $\Psi=\Proj(\psi)$ is everywhere defined. Finally, in view of (\ref{scheme Proj qcoh of algebra homomorphism induce nu on twisted}), we have a canonical $\Phi$-morphism $\mathscr{S}_{X''}\to\mathscr{S}_X$, whence a morphism $w:C_{X''}\to C_X$. The diagram
\[\begin{tikzcd}
C_{X''}\ar[r,"\sim"]\ar[d,"w"]&\Proj(\mathscr{S}^{\natural})\ar[d,"\Psi"]\\
C_X\ar[r,"\sim"]&\Proj(\mathscr{S}^{\natural})
\end{tikzcd}\]
is commutative, as can be verified in the case where $Y$ is affine.
\end{remark}
\begin{remark}\label{scheme projective cone isomorphic to Proj}
Recall that $(\mathscr{I}_n)_{n\geq 0}$ is a filtered sequence where $\mathscr{I}_n=\mathscr{S}(n)$, so we have $\mathscr{I}_1^n\sub\mathscr{I}_n\sub\mathscr{I}_1$ for any $n>0$. Now by definition, $\mathscr{I}_1=\widetilde{\mathscr{S}_+}$, so $\mathscr{I}_1$ defines in $C$ the closed subscheme $\eps(Y)$ (\cref{scheme S-affine closed subscheme char} and \cref{scheme cone canonical morphism}). We then conclude that for any $n>0$, the support of $\mathscr{O}_C/\mathscr{I}_n$ is contained in the underlying space of tge sommet scheme $\eps(Y)$. In the inverse image of the blunt affine cone $E$, the structural morphism $\Proj(\mathscr{S}^{\natural})\to C$ reduces to an isomorphism (as it follows from \cref{scheme affine cone over Proj isomorphic to Proj} and \cref{scheme blunt cone over Proj isomorphism prop}). Moreover, if we canonically identify $C$ as a dense open subset of $\widehat{C}$, we can evidently extend the ideal $\mathscr{I}_n$ of $\mathscr{O}_C$ to an ideal $\mathscr{J}_n$ of $\mathscr{O}_{\widehat{C}}$, such that it coincides with $\mathscr{O}_{\widehat{C}}$ on the open subset $\widehat{E}$ of $\widehat{C}$. If we put $\mathscr{T}=\bigoplus_{n\geq 0}\mathscr{J}_n$, which is a graded $\mathscr{O}_{\widehat{C}}$-algebra, we can then extend the isomorphism (\ref{scheme affine cone over Proj isomorphic to Proj-1}) into a $\widehat{C}$-isomorphism
\begin{align}\label{scheme projective cone isomorphic to Proj-1}
\widehat{C}_X\stackrel{\sim}{\to}\Proj(\mathscr{T}).
\end{align}
In fact, over $\widehat{E}$, it follows from the definition of $\mathscr{J}$ that $\Proj(\mathscr{T})$ is identified with $\widehat{E}$, and we therefore define the isomorphism (\ref{scheme projective cone isomorphic to Proj-1}) so that it coincides with the canonical isomorphism $\widehat{E}_X\to\widehat{E}$ on $\widehat{E}$ (\cref{scheme blunt cone over Proj isomorphism prop}); it is then clear that this isomorphism and (\ref{scheme affine cone over Proj isomorphic to Proj-1}) coincides over $\widehat{E}$. 
\end{remark}
\begin{corollary}\label{scheme cone over Proj inverse image of sommet char}
Suppose that there exists $n_0>0$ such that $\mathscr{S}_{n+1}=\mathscr{S}_1\mathscr{S}_n$ for $n\geq n_0$. Then the sommet scheme of $C_X$ (isomorphic to $X$) is the inverse image of the sommet scheme of $C$ (isomorphic to $Y$) under the canonical morphism $r=\Proj(\alpha):C_X\to C$. The converse of this is true if moreover $Y$ is Noetherian and $\mathscr{S}$ is of finite type.
\end{corollary}
\begin{proof}
The first assertion is local over $Y$, so we can assume that $Y=\Spec(A)$ is affine, $\mathscr{S}=\widetilde{S}$ where $S$ is a graded $A$-algebra with positive degrees. This then follows from \cref{scheme Proj of S^natural tensor S_0 prop}, because we have
\[\Proj(S^{\natural}\otimes_SS_0)=\Proj(S^{\natural}\otimes_S(S/S_+))=C_X\times_C\eps(Y)\]
(in view of the identification (\ref{scheme affine cone over Proj isomorphic to Proj-1}) and \cref{scheme Proj base ring change prop}), which is also the inverse image of $\eps(Y)$ in $C_X$ under the morphism $r:C_X\to C$. The converse of this also follows from \cref{scheme Proj of S^natural tensor S_0 prop} if $Y$ is Noetherian and affine and $S$ is of finite type. If $Y$ is Noetherian (not necessarily affine) and $\mathscr{S}$ is of finite type, there exists a finite convering of $Y$ by Noetherian affine covers $U_i$, and we then deduce that for each $i$, there is an integer $n_i$ such that $\mathscr{S}_{n+1}|_{U_i}=(\mathscr{S}_1|_U)(\mathscr{S}_n|_U)$ for $n\geq n_i$; the largest integer $n_0$ of the $n_i$ then satisfies the requirement.
\end{proof}
We now consider the $C$-scheme $\widetilde{C}$ with is obtained by blowing up the affine cone $C$ along the sommet scheme $\eps(Y)$. By definiton this is $\Proj(\bigoplus_{n\geq 0}(\mathscr{S}_+)^n)$; the canonical injection
\[\iota:\bigoplus_{n\geq 0}(\mathscr{S}_+)^n\to\mathscr{S}^{\natural}\]
defines (by the identification of (\ref{scheme affine cone over Proj isomorphic to Proj-1})) a canonical dominant $C$-morphism $\Proj(\iota):G(\iota)\to\widetilde{C}$, where $G(\iota)$ is an open subset of $C_X$. We note that it is possible that $G(\iota)\neq C_X$; for example, $Y=\Spec(k)$ where $k$ is a field, $\mathscr{S}=\widetilde{S}$ where $S=k[\bm{y}]$ and $\bm{y}$ is an indeterminate of degree $2$. If $R_n$ is the set $(S_+)^n$, considered as a subset of $S(n)=S_n^{\natural}$, then $S_+^{\natural}$ is not equal to the radical in $S_+^{\natural}$ of the ideal generated by the $R_n$.
\begin{corollary}\label{scheme Projective cone over Proj isomorphic to blow up iff}
Suppose that there exists $n_0>0$ such that $\mathscr{S}_n=\mathscr{S}_1^n$ for $n\geq n_0$. Then the canonical morphism $\Proj(\iota):G(\iota)\to\widetilde{C}$ is everywhere defined and an isomorphism from $C_X$ to $\widetilde{C}$. The converse of this is also true if moreover $Y$ is Noetherian and $\mathscr{S}$ is of finite type.
\end{corollary}
\begin{proof}
This assertion is local over $Y$, and therefore follows from \cref{graded ring S_+^n to S^natural prop}. The converse of this is also true if $Y$ is Noetherian and $\mathscr{S}$ is of finite type, as can be shown similarly to \cref{scheme cone over Proj inverse image of sommet char}.
\end{proof}
\begin{remark}
As the condition of \cref{scheme Projective cone over Proj isomorphic to blow up iff} implies that of \cref{scheme cone over Proj inverse image of sommet char}, we see that if this condition is verified, not only $C_X$ is identified with the scheme obtained by blowing up $C$ along the sommet scheme (isomorphic to $Y$), but also the sommet scheme of $C_X$ (isomorphic to $X$) is identified with the inverse image of the sommet scheme of $C$ in $C_X$. Moreover, the hypothesis of \cref{scheme Projective cone over Proj isomorphic to blow up iff} implies that over $X=\Proj(\mathscr{S})$, the $\mathscr{O}_X$-modules $\mathscr{O}_X(n)$ are invertible (\cref{scheme Proj of qcoh alg S(nd) on X_f prop}) and we have $\mathscr{O}_X(n)=\mathscr{L}^{\otimes n}$, where $\mathscr{L}=\mathscr{O}_X(1)$ (\cref{scheme Proj of qcoh alg twisted sheaf tensor prop}). By definition $C_X$ is then the vector bundle $\bm{V}(\mathscr{L})$ over $X$, and the sommet scheme is the zero section of this vector bundle. 
\end{remark}
\subsection{Ample sheaves and contractions}
Let $Y$ be a scheme, $f:X\to Y$ be a quasi-compact and quasi-separated morphism $\mathscr{L}$ be an ample inveritble $\mathscr{O}_X$-module realtive to $f$. Consider the graded $\mathscr{O}_Y$-algebra with positive degrees
\[\mathscr{S}=\mathscr{O}_Y\oplus\bigoplus_{n\geq 1}f_*(\mathscr{L}^{\otimes n})\]
which is quasi-coherent by \cref{scheme morphism qcqs qcoh direct image}. We have a canonical homomorphism of graded $\mathscr{O}_X$-algebras
\[\sigma:f^*(\mathscr{S})\to\bigoplus_{n\geq 0}\mathscr{L}^{\otimes n}\]
which, for each $n\geq 1$, coincides with the canonical homomorphism $\sigma_n:f^*(f_*(\mathscr{L}^{\otimes n}))\to\mathscr{L}^{\otimes n}$, and for $n=0$ is the identify on $\mathscr{O}_X$. The hypothesis that $\mathscr{L}$ is $f$-ample implies that (\cref{scheme relative ample and direct image algebra} and \cref{scheme Proj of qcoh alg qc associated ft zero iff}) the corresponding $Y$-morphism
\[r=r_{\mathscr{L},\sigma}:X\to P=\Proj(\mathscr{S})\]
is everywhere defined and a dominant open immersion, and we have $\mathscr{L}^{\otimes n}=r^*(\mathscr{O}_P(n))$ for $n\in\Z$.
\begin{proposition}\label{scheme relative ample morphism on affine cone prop}
Let $C=\Spec(\mathscr{S})$ the affine cone defined by $\mathscr{S}$. If $\mathscr{L}$ is $f$-ample, there exists a canonical $Y$-morphism
\begin{align}
g:V=\bm{V}(\mathscr{L})\to C
\end{align}
such that the diagram
\begin{equation}\label{scheme relative ample morphism on affine cone prop-1}
\begin{tikzcd}
X\ar[r,"j"]\ar[d,swap,"f"]&\bm{V}(\mathscr{L})\ar[d,"g"]\ar[r,"\pi"]&X\ar[d,"f"]\\
Y\ar[r,"\eps"]&C\ar[r,"\psi"]&Y
\end{tikzcd}
\end{equation}
is commutative, where $\psi$ and $\pi$ are structural morphisms, $j$ and $\eps$ are the canonical immersions which maps $X$ and $Y$ respectively to the zero section of $\bm{V}(\mathscr{L})$ and the sommet scheme of $C$. Moreover, the restriction of $g$ to $\bm{V}(\mathscr{L})-j(X)$ is an open immersion
\[\bm{V}(\mathscr{L})-j(X)\to E=C-\eps(Y)\]
into the blunt affine cone $E$ corresponding to $\mathscr{S}$.
\end{proposition}
\subsection{Quasi-coherent sheaves over the projective cone}
Let $Y$ be a scheme, $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra, $X=\Proj(\mathscr{S})$, $C=\Spec(\mathscr{S})$ and $\widehat{C}=\Proj(\widehat{\mathscr{S}})$. Let $\mathscr{M}$ be a quasi-coherent graded $\mathscr{S}$-module; to avoid any possible confusion, we denote by $\bigtilde{\mathscr{M}}$ the quasi-coherent  $\mathscr{O}_C$-module associated with $\mathscr{M}$ if $\mathscr{M}$ is considered as a \textit{nongraded} $\mathscr{S}$-module, and by $\sProj_0(\mathscr{M})$ the quasi-coherent $\mathscr{O}_X$-module associated with $\mathscr{M}$, where $\mathscr{M}$ is considered as a graded $\mathscr{S}$-module. We also set
\[\mathscr{M}_X=\sProj(\mathscr{M})=\bigoplus_{n\in\Z}\sProj_0(\mathscr{M}(n));\]
with the quasi-coherent $\mathscr{O}_X$-algebra being defined by (\ref{scheme cones over Proj qcoh alg S_X def}), $\sProj(\mathscr{M})$ is endowed a quasi-coherent graded $\mathscr{S}_X$-module structure, via the canonical homomorphisms
\[\mathscr{O}_X(m)\otimes_{\mathscr{O}_X}\sProj_0(\mathscr{M}(n))\to\sProj_0(\mathscr{S}(m)\otimes_{\mathscr{S}}\mathscr{M}(n))\to\Proj_0(\mathscr{M}(m+n))\]
which satisfies the axioms of modules in view of the commutative diagram (\ref{scheme Proj associated sheaf tensor commutativity-2}). If $Y=\Spec(A)$ is affine, $\mathscr{S}=\widetilde{S}$ and $\mathscr{M}=\widetilde{M}$, where $S$ is a graded $A$-algebra  and $M$ is a graded $S$-module, then for any homogeneous element $f\in S_+$, we have
\[\Gamma(X_f,\sProj(\mathscr{M}))=M_f\]
in view of the definition and (\ref{graded module natural isomorphism prop-1}).\par
Now consider the quasi-coherent graded $\widehat{\mathscr{S}}$-module
\[\bighat{\mathscr{M}}=\mathscr{M}\otimes_{\mathscr{S}}\widehat{\mathscr{S}}\]
(where $\widehat{\mathscr{S}}=\mathscr{S}[T]=\mathscr{S}\otimes_{\Z}\Z[T]$); we then deduce a quasi-coherent graded $\mathscr{O}_{\widehat{C}}$-module $\sProj_0(\bighat{\mathscr{M}})$ (recall that $\widehat{C}=\Proj(\widehat{\mathscr{S}})$), which we also denote by
\[\mathscr{M}^{\square}=\sProj_0(\bighat{\mathscr{M}}).\]
It is clear that $\mathscr{M}^{\square}$ is an exact functor on $\mathscr{M}$ and commutes with inductive limits and direct sums.
\begin{proposition}\label{scheme cone canonical morphism assocaited sheaf isomorphism}
With the notations of \cref{scheme cone canonical morphism} and \cref{scheme projective cone canonical retraction prop}, we have canonical homomorphisms
\begin{gather}
i^*(\mathscr{M}^{\square})\stackrel{\sim}{\to}\bigtilde{\mathscr{M}},\label{scheme cone canonical morphism assocaited sheaf isomorphism-1}\\
j^*(\mathscr{M}^{\square})\to\sProj_0(\mathscr{M}),\label{scheme cone canonical morphism assocaited sheaf isomorphism-2}\\
p^*(\sProj_0(\mathscr{M}))\to\mathscr{M}^{\square}|_{\widehat{E}}\label{scheme cone canonical morphism assocaited sheaf isomorphism-3}
\end{gather}
Moreover, the homomorphism (\ref{scheme cone canonical morphism assocaited sheaf isomorphism-2}) is an isomorphism if $\mathscr{S}$ is generated by $\mathscr{S}_1$.
\end{proposition}
\begin{proof}
In fact, $i^*(\mathscr{M}^{\square})$ is canonically identified with $(\bighat{\mathscr{M}}/(\bm{z}-1)\bighat{\mathscr{M}})\widetilde{\hspace*{3mm}}$ over $\Spec(\widehat{\mathscr{S}}/(\bm{z}-1)\widehat{\mathscr{S}})$ in view of \cref{scheme Proj of qcoh module on X_f prop} and the definition of $i$. The first isomorphism of (\ref{scheme cone canonical morphism assocaited sheaf isomorphism-1}) is then deduced from \cref{scheme S-affine functor on qcoh full faithful} and the canonical isomorphism $\bighat{\mathscr{M}}/(\bm{z}-1)\bighat{\mathscr{M}}\cong\mathscr{M}$. On the other hand, the canonical immersion $j:X\to\widehat{C}$ corresponds to the canonical homomorphism $\widehat{\mathscr{S}}\to\mathscr{S}$ with kernel $\bm{z}\widehat{\mathscr{S}}$, so the second isomorphism is a particular case of the canonical homomorphism of \cref{scheme Proj of qcoh alg inverse and direct char}, using the fact that $\bighat{\mathscr{M}}\otimes_{\widehat{S}}\mathscr{S}=\mathscr{M}$. Finally, the homomorphism of (\ref{scheme cone canonical morphism assocaited sheaf isomorphism-3}) is a particular case of the homomorphisms $\nu^{\sharp}$ defined in (\ref{scheme Proj qcoh of algebra homomorphism induce nu^sharp}). If $Y=\Spec(A)$ is affine, $\mathscr{S}=\widetilde{S}$, $\mathscr{M}=\widetilde{M}$, then we see from \cref{scheme Proj associated sheaf inverse image char} that the restriction of (\ref{scheme cone canonical morphism assocaited sheaf isomorphism-3}) to $p^{-1}(X_f)=\widehat{C}_f$ (for $f\in S_+$ homogeneous) corresponds to the canonical homomorphism
\[M_{(f)}\otimes_{S_{(f)}}S_f^{\leqslant}\to M_f^{\leqslant}\]
in view of (\ref{graded ring homogenization prop-2}) and (\ref{graded module homogenization prop-2}). The last assertion also follows from \cref{scheme Proj of qcoh alg inverse and direct char}.
\end{proof}
By abuse of language, we say that $\mathscr{M}^{\square}$ is the projective closure of the $\mathscr{O}_C$-module $\bigtilde{\mathscr{M}}$, where $\mathscr{M}$ is understood to be a graded $\mathscr{S}$-module.\par
Let us consider a morphism $q:Y'\to Y$ and a $q$-homomorphism $\varphi:\mathscr{S}\to\mathscr{S}'$. It then follows from (\ref{scheme S-affine base change associated module isomorphism}) that for any quasi-coherent graded $\mathscr{S}$-module $\mathscr{M}$, we have a canonical isomorphism
\[\Phi^*(\bigtilde{\mathscr{M}})\stackrel{\sim}{\to}(q^*(\mathscr{M})\otimes_{q^*(\mathscr{S})}\mathscr{S}')\widetilde{\hspace{3mm}}\]
of $\mathscr{O}_C$-modules, where $\Phi=\Spec(\varphi)$. On the other hand, if $w=\Proj(\varphi)$ and $\hat{\Phi}=\Proj(\hat{\varphi})$, (\ref{scheme Proj qcoh of algebra homomorphism induce nu}) gives a canonical $w$-homomorphism
\begin{align}\label{scheme cone base change associated sheaf homomorphism-1}
\sProj_0(\mathscr{M})\to(\sProj_0(q^*(\mathscr{M})\otimes_{q^*(\mathscr{S})}\mathscr{S}'))|_{G(\varphi)}
\end{align}
and also a canonical $\hat{\Phi}$-morphism
\begin{align}\label{scheme cone base change associated sheaf homomorphism-2}
\sProj_0(\bighat{\mathscr{M}})\to(\sProj_0(q^*(\bighat{\mathscr{M}})\otimes_{q^*(\widehat{\mathscr{S}})}\widehat{\mathscr{S}}'))|_{G(\hat{\varphi})}.
\end{align}

Now we consider the situation of the structural morphism $q:X\to Y$, where $X=\Proj(\mathscr{S})$, with the canonical $q$-homomorphism $\alpha:\mathscr{S}\to\mathscr{S}_X^{\geqslant}$. We then have a canonical isomorphism
\begin{align}\label{scheme cone over Proj M_X^geq isomorphism-1}
q^*(\mathscr{M})\otimes_{q^*(\mathscr{S})}\mathscr{S}_X^{\geqslant}\stackrel{\sim}{\to}\mathscr{M}_X^{\geqslant}
\end{align}
where $\mathscr{M}_X^{\geqslant}=\bigoplus_{n\geq 0}\sProj_0(\mathscr{M}(n))$. To see this, we can assume that $Y=\Spec(A)$ is affine, $\mathscr{S}=\widetilde{S}$ and $\mathscr{M}=\widetilde{M}$, and define the isomorphism (\ref{scheme cone over Proj M_X^geq isomorphism-1}) in each affine open $X_f$ ($f$ is homogeneous in $S_+$), and verify the compatibility when passing to a homogeneous multiple of $f$. Now, the restriction of the left side of (\ref{scheme cone over Proj M_X^geq isomorphism-1}) to $X_f$ is $\widetilde{M}'=((M\otimes_AS_{(f)})\otimes_{S\otimes_AS_{(f)}}S_f^{\geqslant})\widetilde{\hspace*{3mm}}$ by (\ref{scheme blunt cone over Proj isomorphism prop-1}). As we have a canonical isomorphism $M\otimes_AS_{(f)}\cong M\otimes_S(S\otimes_AS_{(f)})$, we conclude that $\widetilde{M}'\cong(M\otimes_SS_f^{\geqslant})\widetilde{\hspace*{3mm}}$, and this is canonically isomorphic to the restriction of $\mathscr{M}_X^{\geqslant}$ by (\ref{graded ring natural isomorphism prop-1}). The compatibility of this isomorphism with restrictions is clear.\par
By replace $\mathscr{M}$ by $\bighat{\mathscr{M}}$, $\mathscr{S}$ by $\widehat{\mathscr{S}}$ and $\mathscr{S}_X$ by $(\mathscr{S}_X^{\geqslant})\widehat{\hspace*{3mm}}$ in the preceding arguments, we obtain similarly a canonical isomorphism
\begin{align}\label{scheme cone over Proj M_X^geq isomorphism-2}
q^*(\bighat{\mathscr{M}})\otimes_{q^*(\widehat{\mathscr{S}})}(\mathscr{S}_X^{\geqslant})\widehat{\hspace*{3mm}}\stackrel{\sim}{\to}(\mathscr{M}_X^{\geqslant})\widehat{\hspace*{3mm}}
\end{align}

If we recall \cref{scheme blunt cone over Proj isomorphism prop} that the structural morphism $\psi:\Proj(\mathscr{S}_X^{\geqslant})\to X$ is an isomorphism, we then deduce a canonical $\psi$-isomorphism
\begin{align}\label{scheme blunt cone over Proj associated sheaf isomorphism prop}
\sProj_0(\mathscr{M})\stackrel{\sim}{\to}\sProj_0(\mathscr{M}_X^{\geq})
\end{align}
as a particular case of (\ref{scheme cone base change associated sheaf homomorphism-1}). In fact, we observe that, in the notations of \cref{scheme blunt cone over Proj isomorphism prop}, that this reduces to the fact that canonical homomorphism $M_{(f)}\otimes_{S_{(f)}}(S_f^{\geqslant})^{(d)}\to(M_f^{\geqslant})^{(d)}$ is an isomorphism if $f\in S_d$ is homogeneous, which is immediate.\par
The isomorphism (\ref{scheme cone over Proj M_X^geq isomorphism-2}) permits us, by apply (\ref{scheme cone base change associated sheaf homomorphism-2}) to the canonical morphism $r=\Proj(\hat{\alpha}):\widehat{C}_X\to\widehat{C}$, to obtain a canonical $r$-homomorphism 
\begin{align}\label{scheme projective cone over Proj M^square homomorphism}
\mathscr{M}^{\square}\to(\mathscr{M}_X^{\geqslant})^{\square}.
\end{align}
Now recall that the restrictions of $r$ to the blunt cones $\widehat{E}_X$ and $E_X$ are isomorphisms onto $\widehat{E}$ and $E$, respectively.
\begin{proposition}\label{scheme blunt cone over Proj associated sheaf isomorphism}
The restriction of the canonical $r$-homomorphism (\ref{scheme projective cone over Proj M^square homomorphism}) to $\widehat{E}_X$ and to $E_X$ are isomorphisms
\begin{gather}
\mathscr{M}^{\square}|_{\widehat{E}}\stackrel{\sim}{\to}(\mathscr{M}_X^{\geqslant})^{\square}|_{\widehat{E}_X},\label{scheme blunt cone over Proj associated sheaf isomorphism-1}\\
\mathscr{M}^{\square}|_{E}\stackrel{\sim}{\to}(\mathscr{M}_X^{\geqslant})^{\square}|_{E_X}.\label{scheme blunt cone over Proj associated sheaf isomorphism-2}
\end{gather}
\end{proposition}
\begin{proof}
We can assume that $Y=\Spec(A)$ is affine as in the proof of \cref{scheme blunt cone over Proj isomorphism prop}; with the notations there, we must show that the canonical homomorphism
\[\widehat{M}_{(f)}\otimes_{\widehat{S}_{(f)}}(S_f^{\geqslant})_{(f/1)}^{\widehat{\hspace*{3mm}}}\to(M\otimes_SS_f^{\geqslant})_{(f/1)}^{\widehat{\hspace*{3mm}}}\]
is an isomorphism. But in view of (\ref{graded ring homogenization prop-2}) and (\ref{graded module homogenization prop-2}), the left side is canonically identified with $M_f^{\geqslant}\otimes_{S_f^{\geqslant}}{(S_f^{\geqslant})_{f/1}}^{\hspace*{-10pt}\substack{\leqslant\\[-1.87ex]~}}\hspace*{4pt}$, hence with $M_f^{\geqslant}$ in view of (\ref{graded ring natural isomorphism prop-2}); the right side is identified with ${(M_f^{\geqslant})_{f/1}}^{\hspace*{-10pt}\substack{\leqslant\\[-1.87ex]~}}\hspace*{4pt}$, hence also to $M_f^{\geqslant}$ by (\ref{graded module natural isomorphism prop-2}), whence our assertion about (\ref{scheme blunt cone over Proj associated sheaf isomorphism-1}). The isomorphism (\ref{scheme blunt cone over Proj associated sheaf isomorphism-2}) then follows from (\ref{scheme blunt cone over Proj associated sheaf isomorphism-1}) and (\ref{scheme cone canonical morphism assocaited sheaf isomorphism-1}).
\end{proof}
\begin{corollary}\label{scheme blunt cone over Proj restriction of M_X^square char}
With the notations of \cref{scheme blunt cone over Proj isomorphic to Spec}, the restriction of $(\mathscr{M}_X^{\geqslant})^{\square}$ to $\widehat{E}_X$ is identified with $\widetilde{\mathscr{M}_X^{\leqslant}}$ and its restriction to $E_X$ is identified with $\widetilde{\mathscr{M}_X}$.
\end{corollary}
\begin{proof}
We can clearly reduce to the affine case, and this follows from the idnetification of ${(M_f^{\geqslant})_{f/1}}^{\hspace*{-10pt}\substack{\leqslant\\[-1.87ex]~}}\hspace*{4pt}$ with $M_f^{\leqslant}$ and $(M_f^{\geqslant})_{f/1}$ with $M_f$ (cf. (\ref{graded module natural isomorphism prop-2})). 
\end{proof}
\begin{proposition}\label{scheme blunt cone over Proj isomorphism of p^*Proj}
Under the hypotheses of \cref{scheme blunt cone over Proj isomorphic to vector bundle}, the canonical homomorphism (\ref{scheme cone canonical morphism assocaited sheaf isomorphism-3}) is an isomorphism.
\end{proposition}
\begin{proof}
In view of the fact that the structural morphism $\Proj(\mathscr{S}_X^{\geqslant})\to X$ is an isomorphism and the isomorphisms (\ref{scheme blunt cone over Proj associated sheaf isomorphism prop}) and (\ref{scheme blunt cone over Proj associated sheaf isomorphism-1}), we only need to prove that the canonical homomorphism $p_X^*(\sProj_0(\mathscr{M}_X^{\geqslant}))\to(\mathscr{M}_X^{\geqslant})^{\square}|_{E_X}$ is an isomorphism, which means that we can assume that $\mathscr{S}_1$ is an invertible $\mathscr{O}_Y$-module and $\mathscr{S}$ is generated by $\mathscr{S}_1$. With the notations of \cref{scheme cone canonical morphism assocaited sheaf isomorphism}, we then have, for $f\in S_1$, $S_f^{\leqslant}=S_{(f)}[1/f]$ and the canonical isomorphism $M_{(f)}\otimes_{S_{(f)}}S_f^{\leqslant}\to M_f^{\leqslant}$ is an isomorphism by the definition of $M_f^{\geqslant}$.
\end{proof}
We now consider the quasi-coherent $\mathscr{S}$-module $\mathscr{M}(n)=\bigoplus_{m\geq n}\mathscr{M}_m$ and the quasi-coherent graded $\mathscr{S}^{\natural}$-module
\[\mathscr{M}^{\natural}=\Big(\bigoplus_{n\geq 0}\mathscr{M}(n)\Big)^{\widetilde{\hspace*{3mm}}}.\]
By \cref{scheme affine cone over Proj isomorphic to Proj} we have a canonical $C$-isomorphism $h:C_X\stackrel{\sim}{\to}\Proj(\mathscr{S}^{\natural})$.
\begin{proposition}\label{scheme affine cone over Proj isomorphic to Proj associated sheaf}
There exists a canonical $h$-isomorphism
\begin{align}\label{scheme affine cone over Proj isomorphic to Proj associated sheaf-1}
\sProj_0(\mathscr{M}^{\natural})\stackrel{\sim}{\to}\widetilde{\mathscr{M}_X}.
\end{align}
\end{proposition}
\begin{proof}
This can be proved as \cref{scheme affine cone over Proj isomorphic to Proj}, by using the bi-isomorphism (\ref{graded module natural isomorphism prop-3}) here instead of (\ref{graded ring natural isomorphism prop-3}).
\end{proof}
\chapter{Cohomology of coherent sheaves over schemes}\label{scheme cohomology chapter}
\section{Cohomology of affine schemes}
\subsection{\v{C}ech cohomology and Koszul complex}
Let $X$ be a quasi-compact and quasi-separated scheme and $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module. Let $A=\Gamma(X,\mathscr{O}_X)$, $M=\Gamma(X,\mathscr{F})$, $\bm{f}=(f_i)_{1\leq i\leq r}$ be a family of elements of $A$, and $U_i=X_{f_i}$ be the open subset of $X$. Let $U=\bigcup_{i=1}^{r}U_i$ and $\mathfrak{U}=(U_i)$ be the covering of $U$. For any sequence $(i_0,i_1,\dots,i_p)\in I^{p+1}$ with $I=\{1,\dots,r\}$, we set
\[U_{i_0\dots i_p}=\bigcap_{j=0}^{p}U_{i_j}=X_{f_{i_0}\dots f_{i_p}}.\]
By \cref{scheme qcqs section of qcoh over X_s char}, we have $\Gamma(U_{i_0\dots i_p},\mathscr{F})=M_{f_{i_0}\cdots f_{i_p}}$, where $M=\Gamma(X,\mathscr{F})$. Note that the localization module $M_{f_{i_0}\dots f_{i_p}}$ is identified with the limit of the inductive system $\{M_{i_0\dots i_p}^n\}_{n\geq 0}$, where $M_{i_0\dots i_p}^n=M$ and the homomorphism $\varphi_{nm}:M_{i_0\dots i_p}^m\to M_{i_0\dots i_p}^n$ is given by multiplication by $(f_{i_0}\dots f_{i_p})^{n-m}$ for $m\leq n$.\par
For any $n\geq 0$, let $C_n^{p+1}(M)$ be the set of alternating maps from $I^{p+1}$ to $M$, and consider the inductive system formed by these $A$-modules and the homomorphisms induced by $\varphi_{nm}$. If $C^p(\mathfrak{U},\mathscr{F})$ is the group of alternating \v{C}ech $p$-cochains relative to the covering $\mathfrak{U}$ with coefficients in $\mathscr{F}$, then we see that
\[C^p(\mathfrak{U},\mathscr{F})=\rlim_nC_n^{p+1}(M).\]
On the other hand, from the definition of $C_n^{p+1}(M)$ it is easy to see that it is canonically identified with the Koszul complex $K^{p+1}(\bm{f}^n,M)$, and the homomorphism $\varphi_{nm}$ is identified with the map
\[\varphi_{\bm{f}^{n-m}}:K^\bullet(\bm{f}^n,M)\to K^\bullet(\bm{f}^m,M)\]
induced by the map $(x_1,\dots,x_r)\mapsto(f_1^{n-m}x_1,\dots,f_r^{n-m}x_r)$ on $A^r$. We then have, for any $p\geq 0$, a functorial isomorphism
\begin{align}\label{scheme qcqs Cech complex is limit of Koszul}
C^p(\mathfrak{U},\mathscr{F})\stackrel{\sim}{\to}C^{p+1}(\f,M),
\end{align}
where $\f$ is the ideal generated by $\bm{f}$. Moreover, the definition of the differentials of $C^p(\mathfrak{U},\mathscr{F})$ and $C_n^p(M)$ show that the isomorphism (\ref{scheme qcqs Cech complex is limit of Koszul}) is in fact a morphism of complexes.
\begin{proposition}\label{scheme qcqs Cech cohomology is limit of Koszul}
If $X$ is a quasi-compact and quasi-separated scheme, there exists a canonical functorial isomorphism
\begin{align}\label{scheme qcqs Cech cohomology is limit of Koszul-1}
H^p(\mathfrak{U},\mathscr{F})\stackrel{\sim}{\to}H^{p+1}(\f,M)\for p\geq 1,
\end{align}
where $\f$ is the ideal generated by $\bm{f}$. Moreover, we have a functorial exact sequence
\begin{equation}\label{scheme qcqs Cech cohomology is limit of Koszul-2}
\begin{tikzcd}
0\ar[r]&H^0(\f,M)\ar[r]&M\ar[r]&H^0(\mathfrak{U},\mathscr{F})\ar[r]&H^1(\f,M)\ar[r]&0
\end{tikzcd}
\end{equation}
\end{proposition}
\begin{proof}
The relation (\ref{scheme qcqs Cech cohomology is limit of Koszul-1}) is in fact a concequence of (\ref{scheme qcqs Cech complex is limit of Koszul}). On the other hand, we have $C^0(\mathfrak{U},\mathscr{F})=C^1(\f,M)$, so $H^0(\mathfrak{U},\mathscr{F})$ is identified with a subgroup of $1$-cocycles of $C^1(\f,M)$. As $C^0(\f,M)=M$, the exact sequence (\ref{scheme qcqs Cech cohomology is limit of Koszul-2}) follows from the definition of $H^0(\f,M)$ and $H^1(\f,M)$.
\end{proof}
\begin{corollary}\label{scheme qcqs qc coholomogy qcoh on covering vanish if}
Suppose that the $X_{f_i}$ are quasi-compact and there exists $g_i\in\Gamma(U,\mathscr{F})$ such that $\sum_ig_i(f_i|_U)=1|_U$. Then for any quasi-coherent $(\mathscr{O}_X|_U)$-module $\mathscr{G}$, we have $H^p(\mathfrak{U},\mathscr{G})=0$ for $p>0$. If moreover $U=X$, then the canonical homomorphism $M\to H^0(\mathfrak{U},\mathscr{F})$ in (\ref{scheme qcqs Cech cohomology is limit of Koszul-2}) is bijective.
\end{corollary}
\begin{proof}
By hypothesis $U_i=X_{f_i}$ is quasi-compact, so $U$ is quasi-compact, and we can assume that $U=X$. Then the hypothesis implies that $\f=A$, so by \cref{Koszul complex alpha surjective then null-homotopy} we have $H^p(\f,M)=0$ for $p\geq 1$, and the corollary follows from (\ref{scheme qcqs Cech cohomology is limit of Koszul-1}) and (\ref{scheme qcqs Cech cohomology is limit of Koszul-2}).
\end{proof}
\begin{remark}\label{scheme affine Cech and Koszul naturality}
Let $X$ be an affine scheme, so that the $U_i=X_{f_i}=D(f_i)$ are affine opens, and so is each $U_{i_0\dots i_p}$ (but $U$ is not necessarily affine). In this case, the functors $\Gamma(X,\mathscr{F})$ and $\Gamma(U_{i_0\dots i_p},\mathscr{F})$ are exact by \cref{Serre's criterion for affineness}. If we have an exact sequence $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$ of quasi-coherent $\mathscr{O}_X$-modules, the sequence of complexes
\[\begin{tikzcd}
0\ar[r]&C^\bullet(\mathfrak{U},\mathscr{F}')\ar[r]&C^\bullet(\mathfrak{U},\mathscr{F})\ar[r]&C^\bullet(\mathfrak{U},\mathscr{F}'')\ar[r]&0
\end{tikzcd}\]
is exact, so we obtain a long exact sequence of coholomogy groups
\[\begin{tikzcd}
\cdots\ar[r]&H^p(\mathfrak{U},\mathscr{F}')\ar[r]&H^p(\mathfrak{U},\mathscr{F})\ar[r]&H^p(\mathfrak{U},\mathscr{F}'')\ar[r,"\delta"]&H^{p+1}(\mathfrak{U},\mathscr{F}')\ar[r]&0
\end{tikzcd}\]
On the other hand, if we put $M'=\Gamma(X,\mathscr{F}')$, $M''=\Gamma(X,\mathscr{F}'')$, $M=\Gamma(X,\mathscr{F})$, then the sequence $0\to M'\to M\to M'\to 0$ is exact; as $C^\bullet(\f,M)$ is an exact functor on $M$, we then get a long exact sequence on cohomology
\[\begin{tikzcd}
\cdots\ar[r]&H^p(\f,M')\ar[r]&H^p(\f,M)\ar[r]&H^p(\f,M'')\ar[r,"\delta"]&H^{p+1}(\f,M')\ar[r]&0
\end{tikzcd}\]
Now as the diagram
\[\begin{tikzcd}
0\ar[r]&C^\bullet(\mathfrak{U},\mathscr{F}')\ar[d]\ar[r]&C^\bullet(\mathfrak{U},\mathscr{F})\ar[d]\ar[r]&C^\bullet(\mathfrak{U},\mathscr{F}'')\ar[r]\ar[d]&0\\
0\ar[r]&C^\bullet(\f,M')\ar[r]&C^\bullet(\f,M)\ar[r]&C^\bullet(\f,M'')\ar[r]&0
\end{tikzcd}\]
is commutative, we conclude that the diagram
\begin{equation}\label{scheme affine Cech and Koszul naturality-1}
\begin{tikzcd}
H^p(\mathfrak{U},\mathscr{F}'')\ar[d]\ar[r,"\delta"]&H^{p+1}(\mathfrak{U},\mathscr{F}')\ar[d]\\
H^{p+1}(\f,M'')\ar[r,"\delta"]&H^{p+2}(\f,M')
\end{tikzcd}
\end{equation}
is commutative for any $p>0$.
\end{remark}
\subsection{Cohomology of affine schemes}
\begin{theorem}\label{scheme affine qcoh cohomology vanish}
Let $X$ be an affine scheme. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, we have $H^p(X,\mathscr{F})=0$ for $p>0$.
\end{theorem}
\begin{proof}
Let $\mathfrak{U}$ be a finite covering of $X$ by affine opens $X_{f_i}=D(f_i)$ ($1\leq i\leq r$); then the ideal generated by $f_i$ is equal to $A=\Gamma(X,\mathscr{O}_X)$. We then conclude from \cref{scheme qcqs qc coholomogy qcoh on covering vanish if} that we have $H^p(\mathfrak{U},\mathscr{F})=0$ for any $p>0$.  As affine opens for a basis for $X$, we then conclude from the definition of the \v{C}ech cohomology that $\check{H}^p(X,\mathscr{F})=0$ for any $p>0$. But this is also applicable on $X_f$ for $f\in A$, so $\check{H}^p(X_f,\mathscr{F})=0$ for $p>0$; as $X_f\cap X_g=X_{fg}$, we then conclude from Leray's vanishing theorem that $H^p(X,\mathscr{F})=0$ for $p>0$.
\end{proof}
\begin{corollary}\label{scheme morphism affine higher direct image vanish}
Let $f:X\to Y$ be an affine morphism. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, we have $R^pf_*(\mathscr{F})=0$ for $p>0$.
\end{corollary}
\begin{proof}
By definition $R^pf_*(\mathscr{F})$ is defined to be the sheaf associated with the presheaf $U\mapsto H^p(f^{-1}(U),\mathscr{F})$, where $U$ runs through open subsets of $Y$. Now the affine opens $U$ form a basis for $Y$, and for such $U$, $f^{-1}(U)$ is affine, so $H^p(f^{-1}(U),\mathscr{F})=0$ by \cref{scheme affine qcoh cohomology vanish}, so we conclude that $R^pf_*(\mathscr{F})=0$.
\end{proof}
\begin{corollary}\label{scheme morphism affine cohomology of direct image}
Let $f:X\to Y$ be an affine morphism. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphism $H^p(Y,f_*(\mathscr{F}))\to H^p(X,\mathscr{F})$ is bijective for any $p$.
\end{corollary}
\begin{proof}
Consider the Leray spectral sequence
\[E_2^{p,q}=(R^p\Gamma\circ R^qf_*)(\mathscr{F})=H^p(Y,R^qf_*(\mathscr{F})),\]
it follows from \cref{scheme morphism affine higher direct image vanish} that $E_2^{p,q}=0$ for $q>0$, so this sequence collapses at $E_2$ page, whence our assertion.
\end{proof}
\begin{corollary}\label{scheme morphism affine R^pg_*(f_*) isomorphic to composition}
Let $f:X\to Y$ be an affine morphism and $g:Y\to Z$ be a morphism. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphism $R^pg_*(f_*(\mathscr{F}))\to R^p(g\circ f)_*(\mathscr{F})$ is bijective for any $p$.
\end{corollary}
\begin{proof}
It suffices to remark that, by \cref{scheme morphism affine cohomology of direct image}, for any affine open $W$ of $Z$, the canonical homomorphism $H^p(g^{-1}(W),f_*(\mathscr{F}))\to H^p(f^{-1}(g^{-1}(W)),\mathscr{F})$ is bijective; this homomorphism of presheaves then defines a canonical homomorphism $R^pg_*(f_*(\mathscr{F}))\to R^p(g\circ f)_*(\mathscr{F})$ which is bijective.
\end{proof}
\subsection{Applications to cohomology of schemes}
\begin{proposition}\label{scheme separated cohomology compute by finite affine cover}
Let $X$ be a separated scheme, $\mathfrak{U}=(U_\alpha)$ be a covering of $X$ by affine opens. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the cohomology module $H^\bullet(X,\mathscr{F})$ and $H^\bullet(\mathfrak{U},\mathscr{F})$ (over $\Gamma(X,\mathscr{O}_X)$) are canonically isomorphic.
\end{proposition}
\begin{proof}
In fact, as $X$ is separated, any finite intersection $V$ of open sets in the covering $\mathfrak{U}$ is affine (\cref{scheme separated over affine iff intersection of affine open cover}), so $H^p(V,\mathscr{F})=0$ for $q>0$ in view of \cref{scheme affine qcoh cohomology vanish}. The proposition then follows from Leray's vanishing theorem.
\end{proof}
\begin{remark}
We note that the conclusion of \cref{scheme separated cohomology compute by finite affine cover} is still valid if the finite intersections of $U_\alpha$ are affine, even if $X$ is not necessarily separated.
\end{remark}
\begin{corollary}\label{scheme qcsp affine open covering Cech and Koszul isomorphic}
Let $X$ be a quasi-compact and separated scheme, $A=\Gamma(X,\mathscr{O}_X)$, $\bm{f}=(f_i)_{1\leq i\leq r}$ be a sequence of elements of $A$ such that the $X_{f_i}$ are affine. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, we have a canonical functorial isomorphism
\begin{align}\label{scheme qcsp affine open covering Cech and Koszul isomorphic-1}
H^p(U,\mathscr{F})\stackrel{\sim}{\to} H^{p+1}(\f,M) \for p>0
\end{align}
where $\f$ is the ideal generated by $\bm{f}$. Moreover, we have a functorial exact sequence
\begin{equation}\label{scheme qcsp affine open covering Cech and Koszul isomorphic-2}
\begin{tikzcd}
0\ar[r]&H^0(\f,M)\ar[r]&M\ar[r]&H^0(U,\mathscr{F})\ar[r]&H^1(\f,M)\ar[r]&0
\end{tikzcd}
\end{equation}
\end{corollary}
If $X$ is an affine scheme, it then follows from \cref{scheme affine Cech and Koszul naturality} and \cref{scheme separated cohomology compute by finite affine cover} that for any $q\geq 0$, the diagram
\begin{equation}\label{scheme covering affine open Cech and Koszul naturality}
\begin{tikzcd}
H^p(U,\mathscr{F}'')\ar[d]\ar[r,"\delta"]&H^{p+1}(U,\mathscr{F}')\ar[d]\\
H^{p+1}(\f,M'')\ar[r,"\delta"]&H^{p+2}(\f,M')
\end{tikzcd}
\end{equation}
corresponding to an exact sequence $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$ of quasi-coherent $\mathscr{O}_X$-modules, is commutative.
\begin{proposition}\label{scheme qcsp cohomology invertible on X_f char}
Let $X$ be a quasi-compact and separated $X$ scheme, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, and consider the graded ring $A_*=\Gamma_*(\mathscr{L})$. Then $H^\bullet(\mathscr{F},\mathscr{L})=\bigoplus_{n\in\Z}H^\bullet(X,\mathscr{F}\otimes\mathscr{L}^{\otimes n})$ is a graded $A_*$-module, and for any $f\in(A_*)_n$, we have a canonical isomorphism
\begin{align}\label{scheme qcsp cohomology invertible on X_f char-1}
H^\bullet(X_f,\mathscr{F})\stackrel{\sim}{\to}(H^\bullet(\mathscr{F},\mathscr{L}))_{(f)}
\end{align}
of $(A_*)_{(f)}$-modules.
\end{proposition}
\begin{proof}
As $X$ is quasi-compact and separated, we can compute the cohomology of $\mathscr{O}_X$-module $\mathscr{F}\otimes\mathscr{L}^{\otimes n}$ using the same finite covering $\mathfrak{U}=(U_i)$ by open affine subsets such that $\mathscr{L}|_{U_i}$ is isomorphic to $\mathscr{O}_X|_{U_i}$ for each $i$ (\cref{scheme separated cohomology compute by finite affine cover}). Also, since each $U_i\cap X_f$ is open and affine, we can also compute $H^\bullet(X_f,\mathscr{F}\otimes\mathscr{L}^{\otimes n})$ using the covering $\mathfrak{U}|_{X_f}=(U_i\cap X_f)$. Now for any $f\in A_n$, it is immediate that the multiplication by $f$ defines a homomorphism $C^\bullet(\mathfrak{U},\mathscr{F}\otimes\mathscr{L}^{\otimes m})\to C^\bullet(\mathfrak{U},\mathscr{F}\otimes\mathscr{L}^{\otimes(m+n)})$, whence a homomorphism $H^\bullet(\mathfrak{U},\mathscr{F}\otimes\mathscr{L}^{\otimes m})\to H^\bullet(\mathfrak{U},\mathscr{F}\otimes\mathscr{L}^{\otimes(m+n)})$. On the other hand, by \cref{scheme qcqs qcoh section over X_s char} and \cref{scheme affine associated sheaf ker and coker} (\rmnum{2}), any $f\in A_n$ gives an isomorphism of $(A_*)_{(f)}$-modules
\[C^\bullet(\mathfrak{U}|_{X_f},\mathscr{F})\stackrel{\sim}{\to}(C^\bullet(\mathfrak{U},\bigoplus_{n\in\Z}\mathscr{F}\otimes\mathscr{L}^{\otimes n}))_{(f)}.\]
By passing to cohomologies, we then deduce the desired isomorphism (\ref{scheme qcsp cohomology invertible on X_f char-1}), using the fact that $M\mapsto M_{(f)}$ is an exact functor on the category of graded modules.
\end{proof}
\begin{corollary}\label{scheme qcsp cohomology on X_f isomorphism}
If $A=\Gamma(X,\mathscr{O}_X)$, then for any $f\in A$ we have a canonical isomorphism $H^\bullet(X_f,\mathscr{F})\stackrel{\sim}{\to}(H^\bullet(X,\mathscr{F}))_f$ of $A_f$-module.
\end{corollary}
\begin{corollary}\label{scheme qcsp cohomology H^i and X_f affine iff}
Let $X$ be a quasi-compact and separated scheme and $f\in\Gamma(X,\mathscr{O}_X)$.
\begin{enumerate}
\item[(a)] If $X_f$ is affine, then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ and any $\xi\in H^i(X,\mathscr{F})$ with $i>0$, there exists an integer $n>0$ such that $f^n\xi=0$.
\item[(b)] Conversely, suppose that $X_f$ is quasi-compact and for any quasi-coherent ideal $\mathscr{I}$ and any $\zeta\in H^1(X,\mathscr{I})$, there exists $n>0$ such that $f^n\zeta=0$. Then $X_f$ is affine.
\end{enumerate}
\end{corollary}
\begin{proof}
First, if $X_f$ is affine then $H^i(X_f,\mathscr{F})=0$ for $i>0$, so (a) follows from the isomorphism of \cref{scheme qcsp cohomology on X_f isomorphism}. Conversely, in case (b), in view of Serre's criterion, it suffices to prove that for any quasi-coherent ideal $\mathscr{K}$ of $\mathscr{O}_X|_{X_f}$, we have $H^1(X_f,\mathscr{K})=0$. Now as $X_f$ is a quasi-compact open subset of the quasi-compact scheme $X$, by \cref{scheme local Noe qcoh extension} there exists a quasi-coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$ such that $\mathscr{K}=\mathscr{I}|_{X_f}$. By \cref{scheme qcsp cohomology on X_f isomorphism} we have $H^1(X_f,\mathscr{K})=(H^1(X,\mathscr{I}))_f$, and the hypothesis then implies our claim.
\end{proof}
\begin{lemma}[\textbf{Induction principle}]\label{scheme qcqs induction principle}
Let $X$ be a quasi-compact and quasi-separated scheme and $\mathcal{P}$ be a property for quasi-compact open subsets of $X$. Assume that the following conditions are satisfied:
\begin{enumerate}
\item[(a)] $\mathcal{P}$ holds for affine opens of $X$,
\item[(b)] if $U$ is a quasi-compact open subset of $X$, $V$ is an affine open of $X$, and $\mathcal{P}$ holds for $U$, $V$, $U\cap V$, then $\mathcal{P}$ holds for $U\cup V$. 
\end{enumerate}
Then $\mathcal{P}$ holds for every quasi-compact open subset of $X$, and in particular holds for $X$.
\end{lemma}
\begin{proof}
We first prove that $\mathcal{P}$ holds for separated quasi-compact open subset $W\sub X$. For this, note that $W$ can be written as a union $W=U_1\cup\cdots\cup U_n$ of affine opens and we can applying induction on $n$ with $U=U_1\cup\cdots\cup U_n$ and $V=U_n$. This is allowed because $U\cap V=(U_1\cap U_n)\cup\cdots\cup(U_{n-1}\cap U_n)$ is again a union of $n-1$ affine open subschemes. Now for any quasi-compact open subset $W\sub X$, we can induct on the number of affine opens needed to cover $W$ using the same trick as before and using that the quasi-compact open $U_i\cap U_n$ is separated as an open subscheme of the affine scheme $U_n$.
\end{proof}
\begin{proposition}\label{scheme qcqs morphism qcoh higher direct image}
Let $f:X\to Y$ be a quasi-compact and quasi-separated morphism. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, $R^pf_*(\mathscr{F})$ is quasi-coherent for $p\geq 0$.
\end{proposition}
\begin{proof}
Since taking restriction commutes with higher direct images, we may assume that $Y$ is affine. Then $X$ is quasi-compact and quasi-separated. For a quasi-compact open subset $U\sub X$ and $f_U=f|_U$, we let $\mathcal{P}(U)$ be the property that $R^p(f_U)_*(\mathscr{F})$ is quasi-coherent for all quasi-coherent modules $\mathscr{F}$ on $U$ and $o\geq 0$. It then suffices to prove that the conditions of \cref{scheme qcqs induction principle} hold. If $U$ is affine, then the morphism $f_U$ is affine, so by \cref{scheme qcqs morphism affine iff f_* exact} we have $R^p(f_U)_*(\mathscr{F})=0$ for $p>0$, and $f_*(\mathscr{F})$ is quasi-coherent by \cref{scheme morphism qcqs qcoh direct image}. Now let $U\sub X$ be a quasi-compact open subset, $V\sub X$ be an affine open subset, and assume that property $\mathcal{P}$ holds for $U$, $V$ and $U\cap V$. Then for any quasi-coherent $\mathscr{O}_X|_{U\cup V}$-module $\mathscr{F}$, we have the relative Mayer-Vietoris sequence 
\[\begin{tikzcd}[column sep=8pt]
0\ar[r]&(f_{U\cup V})_*(\mathscr{F})\ar[r]&(f_{U})_*(\mathscr{F}|_U)\oplus(f_{V})_*(\mathscr{F}|_V)\ar[r]&(f_{U\cap V})_*(\mathscr{F}|_{U\cap V})\ar[r]&R^1(f_{U\cup V})_*(\mathscr{F})\ar[r]&\cdots
\end{tikzcd}\]
It then follows from our assumption and \cref{scheme affine associated sheaf ker and coker} that $R^p(f_{U\cup V})_*(\mathscr{F})$ is quasi-coherent for $p\geq 0$, so the assertion follows by applying \cref{scheme qcqs induction principle}.
\end{proof}
\begin{corollary}\label{scheme qcqs morphism direct image over affine char}
Let $f:X\to Y$ be a quasi-compact and quasi-separated morphism. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ and any affine open $V\sub Y$, the canonical homomorphism
\[H^p(f^{-1}(V),\mathscr{F})\to H^0(V,R^pf_*(\mathscr{F}))\]
is an isomorphism for $p\geq 0$.
\end{corollary}
\begin{proof}
Since this question is local, we may assume that $Y$ is affine. Consider the Leray spectral sequence
\[E_2^{p,q}=H^p(Y,R^qf_*(\mathscr{F}))\Rightarrow H^{p+q}(X,\mathscr{F}).\]
By \cref{scheme qcqs morphism qcoh higher direct image}, we see that the $R^qf_*(\mathscr{F})$ are quasi-coherent $\mathscr{O}_Y$-module, so we have $H^p(Y,R^qf_*(\mathscr{F}))=0$ for $p>0$ (\cref{Serre's criterion for affineness}). The spectral sequence therefore collapses at $E_2$ page and we obtain an isomorphism $H^q(X,\mathscr{F})\cong H^0(Y,R^qf_*(\mathscr{F}))$.
\end{proof}
\begin{corollary}\label{scheme qcsp over qc qcoh R^pf_* vanish for p>r}
Let $f:X\to Y$ be a quasi-compact and separated morphism, and suppose that $Y$ is quasi-compact. Then there exists an integer $r>0$ such that for any quasi-coherent $\mathscr{O}_X$-module, we have $R^pf_*(\mathscr{F})=0$ for $p>r$. If $Y$ is affine, then we can choose $r$ so that there exists a covering of $X$ by $r$ affine opens.
\end{corollary}
\begin{proof}
Since $Y$ is a union of affine opens, it suffices to prove the second assertion, in view of \cref{scheme qcqs morphism direct image over affine char}. Now if $\mathfrak{U}$ is a covering of $X$ by $r$ affine opens, then $H^p(\mathfrak{U},\mathscr{F})=0$ for $p>r$, since the cochains can be taken to be alternating. The conclusion then follows from \cref{scheme separated cohomology compute by finite affine cover}.
\end{proof}
\begin{corollary}\label{scheme qcsp over affine R^pf_* section on Y_f char}
Under the hypothesis of \cref{scheme qcqs morphism qcoh higher direct image}, suppose that $Y=\Spec(A)$ is affine. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ and any $f\in A$, we have
\[\Gamma(Y_f,R^pf_*(\mathscr{F}))=(\Gamma(Y,R^pf_*(\mathscr{F})))_f.\]
\end{corollary}
\begin{proof}
This follows from \cref{scheme qcqs morphism qcoh higher direct image} and \cref{scheme qcqs section of qcoh over X_s char}.
\end{proof}
\begin{proposition}\label{scheme qcqs morphism direct image composition by affine prop}
Let $Y$ be a quasi-compact scheme, $f:X\to Y$ be a quasi-compact and quasi-separated morphism, $g:Y\to Z$ be an affine morphism. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, the canonical homomorphism $R^p(g\circ f)_*(\mathscr{F})\to g_*(R^pf_*(\mathscr{F}))$ is bijective for $p\geq 0$.
\end{proposition}
\begin{proof}
Consider the Grothendieck spectral sequence
\[E_2^{p,q}=R^pg_*(R^qf_*(\mathscr{F}))\Rightarrow R^{p+q}(g\circ f)_*(\mathscr{F}).\]
Since each $R^qf_*(\mathscr{F})$ is quasi-coherent by \cref{scheme qcqs morphism qcoh higher direct image}, it suffices to prove that $R^pg_*(\mathscr{G})=0$ for any quasi-coherent $\mathscr{O}_Y$-module $\mathscr{G}$ and $p>0$. Since this question is local, we may assume that $Z$ is affine; but then $Y$ is also affine so the assertion follows from \cref{scheme qcqs morphism direct image over affine char}.
\end{proof}
\begin{proposition}\label{scheme morphism qcsp base change formula in derive cat}
Let $f:X\to Y$ be a quasi-compact and separated morphism and $g:Y'\to Y$ be a morphism. Let $f'=f_{(Y')}:X'=X_{(Y')}\to Y'$, and consider the commutative diagram
\[\begin{tikzcd}
X'\ar[r,"f'"]\ar[d,swap,"g'"]&Y'\ar[d,"g"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
Let $\mathscr{F}$ (resp. $\mathscr{G}$) be a quasi-coherent $\mathscr{O}_X$-module (resp. $\mathscr{O}_{Y'}$-module) and assume that $\mathscr{F}$ and $\mathscr{G}$ are tor-independent, i.e., that for any points $x\in X$, $y'\in Y'$ such that $g(y')=f(x)=y$, we have 
\[\Tor_p^{\mathscr{O}_{Y,y}}(\mathscr{G}_{y'},\mathscr{F}_x)=0 \for  p>0.\]
Then there exists a natural isomorphism in the derived category $D(Y')$:
\begin{align}\label{scheme morphism qcsp base change formula in derive cat-1}
\mathscr{G}\otimes^L_YRf_*(\mathscr{F})\stackrel{\sim}{\to}Rf'_*(\mathscr{G}\otimes_Y\mathscr{F}),
\end{align}
where $G\otimes_Y^LRf_*(\mathscr{F}):=\mathscr{G}\otimes^L_{\mathscr{O}_{Y'}}Lg^*(Rf_*(\mathscr{F}))$.
\end{proposition}
When $Y=Y'$ (resp. $\mathscr{G}=\mathscr{O}_{Y'}$), the isomorphism (\ref{scheme morphism qcsp base change formula in derive cat-1}) is called the \textbf{projection isomorphism} (resp. \textbf{base change isomorphism}). When $\mathscr{G}=\mathscr{O}_{Y'}$, we have $\mathscr{G}\otimes_Y\mathscr{F}=g'^*(\mathscr{F})$, so we deduce from (\ref{scheme morphism qcsp base change formula in derive cat-1}) a canonical map
\begin{align}\label{scheme morphism qcsp base change formula-1}
g^*(R^pf_*(\mathscr{F}))\to R^pf'_*(g'^*(\mathscr{F}))
\end{align}
This is the composition of the canonical map $g^*(R^pf_*(\mathscr{F}))\to H^p(Lg^*(Rf_*(\mathscr{F})))$ and the isomorphism $H^p(Lg^*(Rf_*(\mathscr{F})))\stackrel{\sim}{\to}R^pf'_*(g'^*(\mathscr{F}))$ obtained from (\ref{scheme morphism qcsp base change formula in derive cat-1}) by applying $H^p$. However, this is not an isomorphism in general.
\begin{proof}
First, we consider the case where $X=\Spec(B)$, $Y=\Spec(A)$, $Y'=\Spec(A')$ are affine, so that $X'$ is affine with ring $B'=A'\otimes_AB$, and $\mathscr{F}=\widetilde{M}$, $\mathscr{G}=\widetilde{N}$ for some $B$-module $M$ and $A'$-module $N$. Then $Rf_*(\mathscr{F})$ is represented by the underlying $A$-module $M_{[A]}$ of $M$, and $Rf'_*(\mathscr{G}\otimes_Y\mathscr{F})$ by the underlying $A'$-module $(N\otimes_AM)_{[A']}$ of $(N\otimes_{A'}B')\otimes_{B'}(B'\otimes_AM)$. On the other hand, the derived tensor product $\mathscr{G}\otimes_Y^LRf_*(\mathscr{F})$ is represented by
\[N\otimes_A^LM_{[A]}:=N\otimes_{A'}^L(A'\otimes_A^LM_{[A]}),\]
which can be calculated as $N\otimes_AP$, where $P$ is a flat resolution of $M_{[A]}$. The tor-independence hypothesis implies that $\Tor_p^A(N,M_{[A]})=0$ for $p>0$, i.e., the natural map
\begin{align}\label{scheme morphism qcsp base change formula in derive cat-2}
N\otimes_A^LM_{[A]}\to N\otimes_AM_{[A]}
\end{align}
is an isomorphism (in $D(A')$). The isomorphism (\ref{scheme morphism qcsp base change formula in derive cat-1}) is then composition of (\ref{scheme morphism qcsp base change formula in derive cat-2}) and the (trivial) isomorphism
\[N\otimes_AM_{[A]}\stackrel{\sim}{\to}(N\otimes_AM)_{[A']}.\]

In the general case, as $f$ and $Y$ are quasi-compact, $X$ has a finite affine open covering $\mathfrak{U}=(U_i)$. Since $f$ is separated, any finite intersection $U_{i_0\dots i_p}$ is separated over $Y$, so it follows from \cref{scheme separated cohomology compute by finite affine cover} that $Rf_*(\mathscr{F})=f_*(\check{\mathscr{C}}(\mathfrak{U},\mathscr{F}))$, where $\check{\mathscr{C}}(\mathfrak{U},\mathscr{F})$ is the alternating \v{C}ech complex of $\mathfrak{U}$ with values in $\mathscr{F}$. The preceding discussion, applied to affine open subsets of $Y'$ above affine open subsets of $Y$, then shows that we have natural identifications
\[\mathscr{G}\otimes_Y^LRf_*(\mathscr{F})\stackrel{\sim}{\to} \mathscr{G}\otimes_{\mathscr{O}_{Y'}}g^*(f_*(\check{\mathscr{C}}(\mathfrak{U},\mathscr{F})))\stackrel{\sim}{\to} f'_*(\check{\mathscr{C}}(\mathfrak{U}',\mathscr{G}\otimes_Y\mathscr{F}))\stackrel{\sim}{\to} Rf'_*(\mathscr{G}\otimes_Y\mathscr{F}),\]
where $\mathfrak{U}'$ is the covering of $X'$ formed by the inverse images of the $U_i$'s. It is easy to check that the above composition does not depend on the choice of $\mathfrak{U}$, so we take this as the definition of the isomorphism (\ref{scheme morphism qcsp base change formula in derive cat-1}).
\end{proof}
\begin{corollary}\label{scheme morphism qcsp base change formula}
Let $Y$ be a quasi-compact scheme, $f:X\to Y$ be a quasi-compact and separated morphism, and $g:Y'\to Y$ be a flat morphism. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$, we have a base change isomorphism
\[g^*Rf_*(\mathscr{F})\stackrel{\sim}{\to}Rf'_*(g'^*(\mathscr{F})),\]
and the induced base change maps (\ref{scheme morphism qcsp base change formula-1}) are isomorphisms.
\end{corollary}
\begin{proof}
If $g$ is flat, then we can take $\mathscr{G}=\mathscr{O}_{Y'}$ in \cref{scheme morphism qcsp base change formula in derive cat}, so that we obtain a base change isomorphism
\[g^*Rf_*(\mathscr{F})\stackrel{\sim}{\to}Rf'_*(g'^*(\mathscr{F})).\]
Moreover, since $g$ is flat, the canonical map $g^*(R^pf_*(\mathscr{F}))\to H^p(Lg^*(Rf_*(\mathscr{F})))$ is an isomorphism, so the induced base change maps (\ref{scheme morphism qcsp base change formula-1}) are isomorphisms.
\end{proof}
\begin{corollary}\label{scheme morphism qcsp base change on fiber formula}
Let $Y$ be a quasi-compact scheme and $f:X\to Y$ be a quasi-compact and separated morphism. Let $y\in Y$ be a point and $X_y$ be the fiber of $f$ at $y$. Then for any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ which is flat over $Y$, we have a natural isomorphism (in the derived category of $\kappa(y)$-vector spaces)
\begin{align}\label{scheme morphism qcsp base change on fiber formula-1}
\kappa(y)\otimes_{\mathscr{O}_Y}^LRf_*(\mathscr{F})\stackrel{\sim}{\to}R\Gamma(X_y,\mathscr{F}_y)
\end{align}
where $\mathscr{F}_y=\mathscr{O}_{X_y}\otimes_{\mathscr{O}_X}\mathscr{F}$.
\end{corollary}
\begin{proof}
By hypothesis $\mathscr{F}$ is tor-independent of $\kappa(y)$, so we can apply \cref{scheme morphism qcsp base change formula in derive cat}.
\end{proof}
\begin{corollary}\label{scheme ft affine iff faithfully flat base change}
Let $A$ be a ring, $X$ be an $A$-scheme of finite type, and $B$ be a faithfully flat $A$-algebra. Then for $X$ to be affine, it is necesary and sufficient that $X\otimes_AB$ is affine.
\end{corollary}
\begin{proof}
The condition is clearly necessary. Conversely, as $X$ is separated over $A$ and the morphism $\Spec(B)\to\Spec(A)$ is flat, it follows from \cref{scheme morphism qcsp base change formula} that we have 
\[H^i(X\otimes_AB,\mathscr{F}\otimes_AB)=H^i(X,\mathscr{F})\otimes_AB\]
for $i\geq 0$ and any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$. As $X\otimes_AB$ is affine, we see that $H^i(X\otimes_AB,\mathscr{F}\otimes_AB)=0$ for $i>0$, so $H^i(X,\mathscr{F})=0$ for $i>0$ since $B$ is faithfully flat over $A$. As $X$ is quasi-compact, the conclusion then follows from Serre's criterion.
\end{proof}
\begin{remark}
The projection isomorphism and the base change isomorphism together give a proof of the K\"unneth formula. To see this, let $f:X\to S$, $g:Y\to S$ be two quasi-compact and separated morphisms, and form the fiber product $X\times_SY$:
\[\begin{tikzcd}
X\times_SY\ar[r,"q"]\ar[d,swap,"p"]&Y\ar[d,"g"]\\
X\ar[r,"f"]&S
\end{tikzcd}\]
Let $\mathscr{F}$ (resp. $\mathscr{G}$) be a quasi-coherent $\mathscr{O}_X$-module (resp. $\mathscr{O}_Y$-module) and $h=f\circ p=g\circ q$. Then (assuming the projection isomorphism and the base change isomorphism) we have the following isomorphisms:
\begin{align*}
Rh_*(\mathscr{F}\otimes_S^L\mathscr{G})&=Rf_*(Rp_*(Lp^*(\mathscr{F})\otimes_S^L Lq^*(\mathscr{G})))\cong Rf_*(\mathscr{F}\otimes_S^L Rp_*(Lq^*(\mathscr{G})))\\
&\cong Rf_*(\mathscr{F}\otimes_S^L Lf_*(Rg_*(\mathscr{G})))\cong Rf_*(\mathscr{F})\otimes_S^L Rg_*(\mathscr{G}).
\end{align*}
\end{remark}
\section{Coholomogical properties of projective morphisms}
\subsection{Cohomology associated with an invertible sheaf}
Let $X$ be a scheme, $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module, and consider the graded ring
\[S=\Gamma_*(X,\mathscr{L})=\bigoplus_{n\in\Z}\Gamma(X,\mathscr{L}^{\otimes n}).\]
Let $\bm{f}=(f_i)_{1\leq i\leq r}$ be a family of homogeneous elements of $S$, where $f_i\in S_{d_i}$. Put $U_i=X_{f_i}$, $U=\bigcup_iU_i$, and let $\mathfrak{U}=(U_i)$ be the covering of $U$. For any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ of $X$, we set
\begin{align}\label{scheme qcoh graded cohomology-1}
H^\bullet(\mathfrak{U},\mathscr{F};\mathscr{L}):=\bigoplus_{n\in\Z}H^\bullet(\mathfrak{U},\mathscr{F}\otimes\mathscr{L}^{\otimes n}),\quad H^\bullet(U,\mathscr{F};\mathscr{L}):=\bigoplus_{n\in\Z}H^\bullet(U,\mathscr{F}\otimes\mathscr{L}^{\otimes n}).
\end{align}
We note that the abelian groups in (\ref{scheme qcoh graded cohomology-1}) are bigraded: for $m,n\in\Z$ we set
\[(H^\bullet(\mathfrak{U},\mathscr{F};\mathscr{L}))_{mn}=H^m(\mathfrak{U},\mathscr{F}\otimes\mathscr{L}^n),\quad (H^\bullet(U,\mathscr{F};\mathscr{L}))_{mn}=H^m(U,\mathscr{F}\otimes\mathscr{L}^n).\]
For any fixed $m\in\Z$, it is clear that $H^m(\mathfrak{U},\mathscr{F};\mathscr{L})$ and $H^m(U,\mathscr{F};\mathscr{L})$ are graded $S$-modules. We now consider the graded $S$-module
\[M=\Gamma_*(\mathscr{F};\mathscr{L})=H^0(X,\mathscr{F};\mathscr{L})=\bigoplus_{n\in\Z}\Gamma(X,\mathscr{F}\otimes\mathscr{L}^{\otimes n}).\]
If $X$ is quasi-compact and quasi-separated, then it follows from \cref{scheme qcqs qcoh extension by invertible sheaf} that for any sequence $(i_0,i_1,\dots,i_p)$, we have a canonical isomorphism
\[\Gamma(U_{i_0\dots i_p},\mathscr{F};\mathscr{L})=H^0(U_{i_0\dots i_p},\mathscr{F};\mathscr{L})=M_{f_{i_0}\cdots f_{i_p}}.\]
Recall that $M_{f_{i_0}\cdots f_{i_p}}$ is idnetified with $\rlim_nM^n_{i_0\dots i_p}$, and this identification is an isomorphism of graded $S$-modules, if we define the degree of an element $z\in\rlim_nM^n_{i_0\dots i_p}$ to be the number $m-n(d_{i_0}+\dots+d_{i_p})$ if $z$ is the image of a homogeneous element $x\in M^n_{i_0\dots i_p}=M$ of degree $m$ (from the definition of the transition homomorphism, it follows that this definition does not depend on the choice of $x$). Let $C_n^p(M)$ be the set of alternating maps $I^{p+1}\to M$ (for any $n$), then we can similarly define a graded $S$-module structure on $\rlim_n C_n^p(M)$. Now the canonical isomorphism
\[C^p(\mathfrak{U},\mathscr{F};\mathscr{L})=\rlim_nC_n^p(M)\]
is then an isomorphism of graded $S$-modules. By \cref{scheme qcqs Cech cohomology is limit of Koszul}, we have isomorphism of graded $S$-modules
\[C^p(\mathfrak{U},\mathscr{F};\mathscr{L})=C^{p+1}(\f,M)=\rlim_nK^{p+1}(\bm{f}^n,M)\]
where the degree of an element in $\rlim K^{p+1}(\bm{f}^n,M)$ is defined similarly. It is easy to see that the isomorphisms above are compatible with differential maps, so from \cref{scheme qcqs Cech cohomology is limit of Koszul} we conclude the following:
\begin{proposition}\label{scheme qcqs graded cohomology Cech is limit of Koszul}
Let $X$ be a quasi-compact and quasi-separated scheme. Then there exists a canonical isomorphism of graded $S$-modules
\begin{align}\label{scheme qcqs graded cohomology Cech is limit of Koszul-1}
H^p(\mathfrak{U},\mathscr{F};\mathscr{L})\stackrel{\sim}{\to}H^{p+1}(\f,M)\for p\geq 1,
\end{align}
where $\f$ is the ideal generated by $\bm{f}$. Moreover, we have a functorial exact sequence
\begin{equation}\label{scheme qcqs graded cohomology Cech is limit of Koszul-2}
\begin{tikzcd}
0\ar[r]&H^0(\f,M)\ar[r]&M\ar[r]&H^0(\mathfrak{U},\mathscr{F};\mathscr{L})\ar[r]&H^1(\f,M)\ar[r]&0
\end{tikzcd}
\end{equation}
of homomorphisms of degree $0$.
\end{proposition}
\begin{corollary}\label{scheme qcsp graded cohomology is limit of Koszul}
If $X$ is quasi-compact and separated and $U_i=X_{f_i}$ are affine, then there exists a canonical isomorphism of degree $0$:
\[H^p(U,\mathscr{F};\mathscr{L})\stackrel{\sim}{\to}H^{p+1}(\f,M)\for p>0.\]
and we have a functorial exact sequence
\[
\begin{tikzcd}
0\ar[r]&H^0(\f,M)\ar[r]&M\ar[r]&H^0(\mathfrak{U},\mathscr{F};\mathscr{L})\ar[r]&H^1(\f,M)\ar[r]&0
\end{tikzcd}\]
of homomorphisms of degree $0$.
\end{corollary}
\begin{corollary}\label{scheme Proj cohomology is limit of Koszul}
Let $S$ be a graded ring with positive degrees, $(f_i)_{1\leq i\leq r}$ be homogeneous elements of $S_+$ with $f_i\in S_{d_i}$, and $M$ be a graded $S$-module. Let $X=\Proj(S)$, $U_i=D_+(f_i)$, and $\mathscr{L}=\mathscr{O}_X(1)$, then there exists a canonical isomorphism of degree $0$:
\[H^p(U,\widetilde{M};\mathscr{L})\stackrel{\sim}{\to}H^{p+1}(\f,M)\for p>0.\]
and we have a functorial exact sequence
\[
\begin{tikzcd}
0\ar[r]&H^0(\f,M)\ar[r]&M\ar[r]&H^0(\mathfrak{U},\widetilde{M};\mathscr{L})\ar[r]&H^1(\f,M)\ar[r]&0
\end{tikzcd}\]
of homomorphisms of degree $0$.
\end{corollary}
\begin{proof}
In fact, we have $\Gamma(U_{i_0\dots i_p},\widetilde{M(n)})=(M_{f_{i_0}\cdots f_{i_p}})_n$, so $\Gamma(U_{i_0\dots i_p},\widetilde{M};\mathscr{L})=M_{f_{i_0}\cdots f_{i_p}}$. The conclusion then follows from \cref{scheme qcsp graded cohomology is limit of Koszul} since $X$ is quasi-compact and separated.
\end{proof}
\begin{remark}
\cref{scheme Proj cohomology is limit of Koszul} is intersting if $S$ is an $A$-algebra generated by $S_1$ where $A$ is Noetherian. In fact, in this case any quasi-coherent $\mathscr{O}_X$-module $\mathscr{F}$ is of the form $\widetilde{M}$ by \cref{scheme Proj qc beta isomorphism}.
\end{remark}
\begin{remark}\label{scheme Proj Cech and Koszul naturality}
Under the hypothesis of \cref{scheme Proj cohomology is limit of Koszul}, the functor $\Gamma(U_{i_0\dots i_p},\widetilde{M};\mathscr{L})=M_{f_{i_0}\cdots f_{i_p}}$ is exact on $M$, and as in \cref{scheme affine Cech and Koszul naturality}, if $0\to M'\to M\to M''\to 0$ is an exact sequence of graded $S$-modules, we have a commutative diagram for $p\geq 0$:
\[\begin{tikzcd}
H^p(U,\widetilde{M}'';\mathscr{L})\ar[d]\ar[r,"\partial"]&H^{p+1}(U,\widetilde{M}';\mathscr{L})\ar[d]\\
H^{p+1}(\f,M'')\ar[r,"\partial"]&H^{p+2}(\f,M')
\end{tikzcd}\]
\end{remark}
We now apply \cref{scheme Proj cohomology is limit of Koszul} to the polynomial ring $S=A[T_0,\dots,T_r]$, where $A$ is a ring and $T_i$ are indeterminantes. Let $M=S$ and $f_i=T_i$, we are then reduced to compute $H^\bullet(\m,S)$, where $\bm{T}=(T_i)_{0\leq i\leq r}$ and $\m$ is the maximal ideal of $S$ generated by $T_0,\dots,T_r$.
\begin{lemma}\label{scheme Proj cohomology of polynomial}
If $S=A[T_0,\dots,T_r]$ and $\bm{T}=(T_i)_{0\leq i\leq r}$, then
\begin{equation}\label{scheme Proj cohomology of polynomial-1}
H^i(\bm{T}^n,S)=\begin{cases}
0&i\neq r+1,\\
S/\m^n&i=r+1.
\end{cases}
\end{equation}
\end{lemma}
\begin{proof}
This is an immediate from the fact that the sequence $\bm{T}$ is regular.
\end{proof}
By passing to inductive limits over $n$, we see that $H^i(\m,S)=0$ for $i\neq r+1$. If $i=r+1$, then the inductive system is formed by $S/\m^n$ and $\varphi_{nm}:S/\m^n\to S/\m^m$ for $0\leq n\leq m$ is the multiplication by $(T_0\cdots T_r)^{n-m}$. For any sequence $\alpha=(\alpha_0,\dots,\alpha_r)$ and integer $n\geq\sup_i\{\alpha_i\}$, we define 
\[\xi_\alpha^n=T_0^{n-\alpha_0}\cdots T_r^{n-\alpha_r}\mod\m^n.\] Then $\varphi_{nm}(\xi_\alpha^n)=\xi_\alpha^m$, so the $\xi^n_\alpha$ form an element $\xi_\alpha$ in the inductive limit $H^{r+1}(\m,S)$.
\begin{corollary}\label{scheme Proj cohomology limit of polynomial}
With the notations of \cref{scheme Proj cohomology of polynomial}, we have $H^i(\m,S)=0$ for $i\neq r+1$, and $H^{r+1}(\m,S)$ is a free $A$-module with basis formed by the elements $\xi_\alpha$ with $\alpha_i>0$ for each $i$.
\end{corollary}
\begin{proof}
In fact, for each $n\geq 0$, the elements $\xi_\alpha^n$ for $0<\alpha_i\leq n$ form a basis of the $A$-module $S/\m^n$, so the corollary follows from (\ref{scheme Proj cohomology of polynomial-1}).
\end{proof}
\begin{proposition}\label{scheme Proj cohomology of O_X(n)}
Let $A$ be a ring, $r>0$ be an integer, and $X=\P_A^r$.
\begin{enumerate}
\item[(a)] We have $H^i(X,\mathscr{O}_X;\mathscr{O}_X(1))=0$ for $i\neq 0,r$.
\item[(b)] The canonical homomorphism $\alpha:S\to H^0(X,\mathscr{O}_X;\mathscr{O}_X(1))$ is an isomorphism.
\item[(c)] The $A$-module $H^r(X,\mathscr{O}_X;\mathscr{O}_X(1))$ is free with a basis formed by the elements $\xi_\alpha$ with $\alpha_i>0$ for each $i$. Moreover, $\xi_\alpha$ is of degree $-|\alpha|=-(\alpha_0+\cdots+\alpha_r)$ and $T_i\cdot\xi_\alpha=\xi_{\alpha_0,\dots,\alpha_i-1,\dots,\alpha_r}$.
\end{enumerate}
\end{proposition}
\begin{proof}
By \cref{scheme Proj cohomology limit of polynomial} we have $H^i(\m,S)=0$ for $i\neq r+1$, so the assertion in (a) follows from (\ref{scheme qcqs graded cohomology Cech is limit of Koszul-1}). From the exact sequence (\ref{scheme qcqs graded cohomology Cech is limit of Koszul-2}), it is easy to see that $S\cong H^0(X,\mathscr{O}_X;\mathscr{O}_X(1))$, and the isomorphism is given by the canonical homomorphism $\alpha$. The last assertion also follows from (\ref{scheme qcqs graded cohomology Cech is limit of Koszul-1}) and \cref{scheme Proj cohomology limit of polynomial}.
\end{proof}
\begin{corollary}\label{scheme Proj cohomology of O_X(n) nonzero value}
The values $(i,n)$ such that $H^i(X,\mathscr{O}_X(n))\neq 0$ are the following: $i=0$ and $n\geq 0$, or $i=r$ and $n\leq-(r+1)$.
\end{corollary}
\begin{proof}
We note that if $A\neq 0$ then $H^i(X,\mathscr{O}_X(n))\neq 0$ by the listed values of $(i,n)$.
\end{proof}
\begin{corollary}\label{scheme Proj cohomology of O_X(n) free ft}
The $A$-modules $H^i(X,\mathscr{O}_X(n))$ are free of finite rank. If $i>0$, then they are zero for $n>0$.
\end{corollary}
\begin{proposition}\label{scheme Projective bundle cohomology of O_X(n)}
Let $Y$ be a scheme, $\mathscr{E}$ be a locally free $\mathscr{O}_Y$-module of rank $r+1$, and $X=\P(\mathscr{E})$ be the projective bundle defined by $\mathscr{E}$. Let $f:X\to Y$ be the structural morphism, then the values $(n,i)$ such that $R^if_*(\mathscr{O}_X(n))\neq 0$ are the following: $i=0$ and $n\geq 0$, or $i=r$ and $n\leq-(r+1)$. Moreover, the canonical homomorphism
\[\alpha:\bm{S}_{\mathscr{O}_Y}(\mathscr{E})\to \Gamma_*(\mathscr{O}_X)=\bigoplus_{n\in\Z}f_*(\mathscr{O}_X(n))\]
is an isomorphism.
\end{proposition}
\begin{proof}
This question is local over $Y$, so we can assume that $Y=\Spec(A)$ is affine and $\mathscr{E}=\widetilde{E}$, where $E=A^{r+1}$. We can then apply \cref{scheme Proj cohomology of O_X(n)}, in view of \cref{scheme qcqs morphism direct image over affine char}.
\end{proof}
\subsection{The coherence theorem for projective morphisms}
\begin{proposition}\label{scheme Proj over Noe ring cohomology of coh prop}
Let $A$ be a Noetherian ring and $S$ be a graded $A$-algebra with positive degrees that is generated by $r+1$ elements of $S_1$. Let $X=\Proj(S)$, and consider a coherent $\mathscr{O}_X$-module $\mathscr{F}$.
\begin{enumerate}
\item[(a)] The $A$-module $H^p(X,\mathscr{F})$ is finitely generated.
\item[(b)] We have $H^p(X,\mathscr{F})=0$ for $p>r$.
\item[(c)] There exists an integer $n_0$ such that for $n\geq n_0$, we have $H^p(X,\mathscr{F}(n))$ for $p>0$.
\item[(d)] There exists an integer $n_0$ such that for $n\geq n_0$, $\mathscr{F}(n)$ is generated by global sections.
\end{enumerate}
\end{proposition}
\begin{proof}
Note that $X$ can be identified with a closed subscheme of $P=\P_A^r$ (\cref{scheme Proj closed immersion char}). Moreover, if $j:X\to P$ is the canonical injection, $j_*(\mathscr{F})$ is a coherent $\mathscr{O}_P$-module and we have $j_*(\mathscr{F}(n))=(j_*(\mathscr{F}))(n)$ (\cref{scheme Proj of qcoh alg qc qcoh iso to assocaited ft} and \cref{scheme Proj of qcoh alg inverse and direct char}). In view of (G, \Rmnum{2}, cor. du th.4.9.1), we only need to consider the case where $X=\P^r_A$ and $S=A[T_0,\dots,T_r]$. Now $X$ can be covered by $r+1$ affine opens $D_+(T_i)$, so (b) follows from \cref{scheme qcqs morphism direct image over affine char} and \cref{scheme qcsp over qc qcoh R^pf_* vanish for p>r}. We also note that (d) is proved in \cref{scheme Proj of qcoh alg twisted sigma surjective}.\par
We now prove (a) and (c). By \cref{scheme Proj cohomology of O_X(n)}, these assertions hold for $\mathscr{F}=\mathscr{O}_X(m)$, hence for direct sums of finitely many $\mathscr{O}_X$-module of the form $\mathscr{O}_X(m_j)$. On the other hand, (a) and (c) are trivial for $p>r$ in view of (b). We now proceed by descendent induction on $p$. Since $\mathscr{F}$ is coherent, it is a quotient of direct sume of finitely many sheaves $\mathscr{O}_X(m_j)$ (\cref{scheme Proj qcoh iso to quotient of O_X(-n)^r}). That is, we have an exact sequence $0\to\mathscr{R}\to\mathscr{E}\to\mathscr{F}\to 0$ where $\mathscr{R}$ is coherent and $\mathscr{E}$ satisfies (a) and (c). Since tensoring with $\mathscr{O}_X(n)$ is exact, we obtain an exact sequence
\[\begin{tikzcd}
H^{p-1}(X,\mathscr{E}(n))\ar[r]&H^{p-1}(X,\mathscr{F}(n))\ar[r]&H^p(X,\mathscr{R}(n)).
\end{tikzcd}\]
As $\mathscr{E}(n)$ is a direct sum of $\mathscr{O}_X(m_j+n)$, we see $H^{p-1}(X,\mathscr{E}(n))$ is finitely generated by \cref{scheme Proj cohomology of O_X(n) free ft}, and so is $H^p(X,\mathscr{R}(n))$ by induction hypothesis. As $A$ is Noetherian, we then conclude that $H^{p-1}(X,\mathscr{F}(n))$ is finitely generated for any $n\in\Z$, and in particular for $n=0$. On the other hand, by induction hypothesis there exists an integer $n_0$ such that for $n\geq n_0$ we have $H^p(X,\mathscr{R}(n))=0$, and we can choose $n_0$ such that $H^{p-1}(X,\mathscr{E}(n))=0$ for $n\geq n_0$, since $\mathscr{E}$ satisfies (c). Therefore we see that $H^{p-1}(X,\mathscr{F}(n))=0$ for $n\geq n_0$, which completes the proof. 
\end{proof}
\begin{theorem}[\textbf{Serre}]\label{scheme morphism projective cohomology of coh prop}
Let $Y$ be a Noetherian scheme, $f:X\to Y$ be a projective morphism, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module that is ample for $f$. For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, set $\mathscr{F}(n)=\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{L}^{\otimes n}$.
\begin{enumerate}
\item[(a)] The $\mathscr{O}_Y$-module $R^pf_*(\mathscr{F})$ is coherent for $p\geq 0$.
\item[(b)] There exists an integer $n_0$ such that for $n\geq n_0$, we have $R^pf_*(\mathscr{F}(n))=0$ for $p>0$.
\item[(c)] There exists an integer $n_0$ such that for $n\geq n_0$, the canonical homomorphism $f^*(f_*(\mathscr{F}(n)))\to\mathscr{F}(n)$ is surjective.
\end{enumerate}
\end{theorem}
\begin{proof}
We note that the theorem is unchanged if we replace $\mathscr{L}$ by $\mathscr{L}^{\otimes d}$ for $d>0$. In fact, we then have $\mathscr{F}(n)=(\mathscr{F}\otimes\mathscr{L}^{\otimes r})\otimes\mathscr{L}^{\otimes kd}$ for $k>0$ and $0\leq r<d$, and by hypothesis for any $r$ there is an integer $n_r$ such that for $k\geq n_r$, the properties (b) and (c) holds for $\mathscr{F}\otimes\mathscr{L}^{\otimes r}$. Let $n_0$ be the supremum of $dn_r$, then assertion (b) and (c) hold for $n\geq n_0$. In view of \cref{scheme qc relative ample iff power very ample}, we may assume that $\mathscr{L}$ is very ample relative to $f$, so there exists a dominant open immersion $i:X\to P$, where $P=\Proj(\mathscr{S})$ for a quasi-coherent graded $\mathscr{O}_Y$-algebra $\mathscr{S}$ with positive degrees that is finitely generated by $\mathscr{S}_1$; moreover, $\mathscr{L}\cong i^*(\mathscr{O}_P(1))$. Since $f$ is proper, the morphism $i$ is also proper by \cref{scheme morphism proper cancelled prop}, so it is an isomorphism $X\cong P$. We can therefore assme that $X=\Proj(\mathscr{S})$ and $\mathscr{L}=\mathscr{O}_X(1)$, and the theorem then follows from \cref{scheme Proj over Noe ring cohomology of coh prop}.
\end{proof}
\begin{corollary}\label{scheme morphism projective f_*(F(n)) exact}
Under the hypothesis of \cref{scheme morphism projective cohomology of coh prop}, let $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ be an exact sequence of coherent $\mathscr{O}_X$-modules. Then there exists an integer $n_0$ such that for $n\geq n_0$, the sequence
\[\begin{tikzcd}
0\ar[r]&f_*(\mathscr{F}(n))\ar[r]&f_*(\mathscr{G}(n))\ar[r]&f_*(\mathscr{H}(n))
\end{tikzcd}\]
is exact.
\end{corollary}
\begin{proof}
This follows from the long exact sequence of $f_*$ and property (b) of \cref{scheme morphism projective cohomology of coh prop}.
\end{proof}
\begin{corollary}\label{scheme morphism ft f_*(F(n)) exact if supp proper}
Let $Y$ be a Noetherian scheme, $f:X\to Y$ be a morphism of finite type, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module that is ample for $f$. Let $0\to\mathscr{F}\to\mathscr{G}\to\mathscr{H}\to 0$ be an exact sequence of coherent $\mathscr{O}_X$-modules such that the supports of $\mathscr{F}$ and $\mathscr{H}$ are proper over $Y$. Then there exists an integer $n_0$ such that for $n\geq n_0$, the sequence
\[\begin{tikzcd}
0\ar[r]&f_*(\mathscr{F}(n))\ar[r]&f_*(\mathscr{G}(n))\ar[r]&f_*(\mathscr{H}(n))
\end{tikzcd}\]
is exact.
\end{corollary}
\begin{proof}
The same reasoning of \cref{scheme morphism projective cohomology of coh prop} show that we can assume that $\mathscr{L}$ is very ample relative to $f$, so we can identify $X$ as an open subscheme of $Z=\Proj(\mathscr{S})$, where $\mathscr{S}$ is a quasi-coherent graded $\mathscr{O}_Y$-algebra with positive degrees, such that $\mathscr{S}$ is finitely generated by $\mathscr{S}_1$, and $\mathscr{L}=i^*(\mathscr{O}_Z(1))$, where $i:X\to P$ is the caonical immersion. Now as $\supp(\mathscr{G})$ is closed in $X$ and contained in $\supp(\mathscr{F})\cap\supp(\mathscr{H})$, it is proper over $Y$; the supports of $\mathscr{F},\mathscr{G},\mathscr{H}$ are then closed in $Z$. The sheaves $\mathscr{F}'=i_*(\mathscr{F})$, $\mathscr{G}'=i_*(\mathscr{G})$, and $\mathscr{H}'=i_*(\mathscr{H})$ are then coherent $\mathscr{O}_Z$-modules, and the sequence $0\to\mathscr{F}'\to\mathscr{G}'\to\mathscr{H}'\to 0$ is exact. Moreover, if $g:Z\to Y$ is the structral morphism, then $f=g\circ i$, and it is clear that $\mathscr{F}'(n)=i_*(\mathscr{F}(n))$ and similarly for $\mathscr{G}'$, $\mathscr{H}'$. The conclusion then follows from \cref{scheme morphism projective f_*(F(n)) exact}.
\end{proof}
\begin{remark}
The assertion (a) of \cref{scheme morphism projective cohomology of coh prop} is still valid if we only assume that $Y$ is locally Noetherian. In fact, this property is local over $Y$, and the hypotheses in\cref{scheme morphism projective cohomology of coh prop} imply that for any affine open $U\sub Y$, the restriction $f$ to $f^{-1}(U)$ is projective and $\mathscr{L}|_{f^{-1}(U)}$ is ample for this restriction.
\end{remark}
\begin{remark}
The assertion (a) of \cref{scheme morphism projective cohomology of coh prop} is still valid, as we have seen, when we only assumes that $X$ is a quasi-compact and quasi-separated scheme and $f:X\to Y$ is a quasi-compact and quasi-separated morphism (\cref{scheme qcqs relative ample iff sigma surjective}). However, note that assertion (b) is not true if we suppose that $Y$ is the spectrum of a field $k$ and that $f$ is quasi-projective. For example, let $X'=\Spec(k[T_0,\dots,T_r])$ and $X$ be the union of the affine opens $D(T_i)$ (so that $X$ can be considered as the space $\A_k^r$ with the origin removed). As the immersion $X\to X'$ is quasi-compact, the structural morphism $f:X\to Y$ is quasi-affine, so $\mathscr{O}_X$ is very ample relative to $f$ (\cref{scheme qc quasi-affine iff}). But the ring $\Gamma(X,\mathscr{O}_X)$ is identified with the intersection of $K[T_0,\dots,T_r]_{T_i}$ for $0\leq i\leq r$ (\cref{scheme integral section is intersection of stalk}), which is $K[T_0,\dots,T_r]$, so it follows from (\ref{scheme qcsp affine open covering Cech and Koszul isomorphic-1}) that we have $H^r(X,\mathscr{O}_X^{\otimes n})=H^r(X,\mathscr{O}_X)=A\neq 0$ for any $n\in\Z$. 
\end{remark}
\begin{theorem}\label{scheme morphism projective over Noe coherence of qcoh graded}
Let $Y$ be a Noetherian scheme and $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra of finite type. Let $f:X\to Y$ be a projective morphism, $\mathscr{S}'=f^*(\mathscr{S})$, $\mathscr{M}$ be a quasi-coherent $\mathscr{S}'$-module of finite type.
\begin{enumerate}
\item[(a)] For any $p\geq 0$, $R^pf_*(\mathscr{M})$ is an $\mathscr{S}$-module of finite type.
\item[(b)] Let $\mathscr{L}$ be an $f$-ample $\mathscr{O}_X$-module, and put $\mathscr{M}(n)=\mathscr{M}\otimes\mathscr{L}^{\otimes n}$. Then there exists an integer $n_0$ such that for $n\geq n_0$, we have $R^pf_*(\mathscr{M}(n))=0$ for $p>0$, and the canonical homomorphism $f^*(f_*(\mathscr{M}(n)))\to\mathscr{M}(n)$ is surjective.
\end{enumerate}
\end{theorem}
\subsection{Applications to associated sheaves of graded modules}
\begin{theorem}\label{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}
Let $Y$ be a Noetherian scheme, $\mathscr{S}$ be a quasi-coherent $\mathscr{O}_Y$-algebra of finite type with positive degrees, $X=\Proj(\mathscr{S})$, and $q:X\to Y$ be the structural morphism. Let $\mathscr{M}$ be a quasi-coherent graded $\mathscr{S}$-module that is eventually finite. Then there exists an integer $n_0$ such that for $n\geq n_0$, the canonical homomorphism of (\cite{EGA2}, 8.14.5.1)
\[\alpha_n:\mathscr{M}_n\to q_*(\sProj_0(\mathscr{M}(n)))=q_*((\sProj(\mathscr{M}))_n)\]
is bijective. In other words, the canonical homomorphism $\alpha:\mathscr{M}\to\Gamma_*(\sProj(\mathscr{M}))$ is an eventual isomorphisms.
\end{theorem}
\begin{proof}
By \cref{scheme Proj qc associated ft zero iff}, we can assume that $\mathscr{M}$ is an $\mathscr{S}$-module of finite type. As $Y$ is quasi-compact, by \cref{scheme qcoh algebra S^(d) generated by S_d if} there exists an integer $d>0$ such that $\mathscr{S}^{(d)}$ is generated by $\mathscr{S}_d$, which is of finite type. Now $\mathscr{M}$ is the direct sum of $\mathscr{M}^{(d,k)}$ for $0\leq k<d$, and each $\mathscr{M}^{(d,k)}$ is quasi-coherent $\mathscr{S}^{(d)}$-module of finite type (\cref{graded ring finiteness of alter ring}), so it suffices to prove that the canonical homomorphism $\alpha:\mathscr{M}^{(d,k)}\to\Gamma_*((\sProj(\mathscr{M}))^{(d,k)})$ is an eventual isomorphism. In view of (\cite{EGA2}, 8.14.13) (and the diagram (\cite{EGA2}, 8.14.13.4)), we can therefore assume that $\mathscr{S}$ is finitely generated by $\mathscr{S}_1$. As $Y$ is Noetherian, the same reasoning as in \cref{scheme Proj over Noe ring cohomology of coh prop} shows that we can further assume that $Y=\Spec(A)$, $\mathscr{S}=\widetilde{\mathscr{S}}$, $\mathscr{M}=\widetilde{\mathscr{M}}$, where $A$ is a Noetherian ring, $S_1$ is a finitely generated $A$-module, and $M$ is a finitely generated $S$-module.\par
We also note that it suffices to prove the assertion for $M=S$. In fact, in the general case, we have an exact sequence $R\to L\to M\to 0$, where $L$ and $R$ are direct sums of graded modules of the form $S(m)$. If the assertion is proved for $M=S$, then it also holds for $M=S(m)$, hence for $L$ and $R$. Consider the commutative diagram
\[\begin{tikzcd}
\widetilde{R}_n\ar[r]\ar[d,"\alpha_n"]&\widetilde{L}_n\ar[r]\ar[d,"\alpha_n"]&\widetilde{M}_n\ar[r]\ar[d,"\alpha_n"]&0\\
q_*(\widetilde{R}(n))\ar[r]&q_*(\widetilde{L}(n))\ar[r]&q_*(\widetilde{M}(n))\ar[r]&0
\end{tikzcd}\]
The first and second vertical arrows are isomorphisms for $n\gg 0$, so by five lemma we conclude that the middle one is also an isomorphism for sufficiently large $n$, whence our assertion.\par
This being done, we are left to prove the theorem for $M=S$; for this, we first suppose that $S=A_0[T_0,\dots,T_r]$ (where $T_i$ are indeterminates). In this case, the assertion follows from \cref{scheme Proj cohomology of O_X(n)}(b). In the general case, $S$ is identified with a quotient of a ring $S'=A[T_0,\dots,T_n]$ by a graded ideal, so $X$ is a closed subscheme of $X'=\P_A^r$. If $j:X\to X'$ is the canonical injection, then $j_*(\widetilde{S}(n))$ is equal to the $\mathscr{O}_{X'}$-module $(\sProj(\widetilde{S}))(n)$ where $S$ is considered as a graded $S'$-module (\cref{scheme Proj associated sheaf direct image char}). As $j_*(\widetilde{S}(n))$ is a eventually finite $\mathscr{O}_{X'}$-module, the canonical homomorphism $\alpha_n:S_n\to\Gamma(X',j_*(\widetilde{S}(n)))$ is bijective for $n\gg 0$, and this proves our assertion since $\Gamma(X',j_*(\widetilde{S}(n)))=\Gamma(X,\widetilde{S}(n))$.
\end{proof}
\begin{corollary}
Under the hypotheses of \cref{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}, let $\mathscr{S}_X=\bigoplus_{n\in\Z}\mathscr{O}_X(n)$, and $\mathscr{F}$ be a quasi-coherent graded $\mathscr{S}_X$-module of finite type. Then $\Gamma_*(\mathscr{F})$ is eventually finite.
\end{corollary}
\begin{proof}
We see that in the proof of \cref{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}, $X$ is isomorphic to $\Proj(\mathscr{S}^{(d)})$ which is of finite type over $Y$. It then follows from (\cite{EGA2}, 8.14.9) that $\mathscr{F}$ is isomorphic to a graded $\mathscr{S}_X$-module of the form $\sProj_0(\mathscr{M})$, where $\mathscr{M}$ is a quasi-coherent $\mathscr{S}$-module of finite type. In view of \cref{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}, we see $\Gamma_*(\mathscr{F})$ is eventually isomorphic to $\mathscr{M}$, so is eventually finite.
\end{proof}
\begin{remark}\label{scheme Proj of qcoh alg over Noe qcoh category equivalence}
Let $Y$ be a Noetherian scheme, $\mathscr{S}$ be a graded $\mathscr{O}_Y$-alegbra satisfying the conditions of \cref{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}, and $X=\Proj(\mathscr{S})$. Let $\mathcal{K}_{\mathscr{S}}$ be the abelian category of quais-coherent graded $\mathscr{S}$-modules that are eventually finite, and $\mathcal{K}'_{\mathscr{S}}$ be the subcategory of $\mathcal{K}_{\mathscr{S}}$ consists of quais-coherent graded $\mathscr{S}$-modules that are eventually null. Finally, let $\mathcal{K}_X$ be the category of quasi-coherent graded $\mathscr{S}_X$-module of finite type (which amounts to saying, since $\mathscr{S}_X$ is periodic by (\cite{EGA2}, 8.14.4) and (\cite{EGA2}, 8.14.12), that each $\mathscr{F}_i$ is a coherent $\mathscr{P}_X$-module). Then in view of (\cite{EGA2}, 8.14.8), (\cite{EGA2}, 8.14.10) and \cref{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}, the functors $\mathscr{M}\mapsto\sProj(\mathscr{M})$ and $\mathscr{F}\mapsto\Gamma_*(\mathscr{F})$ define an equivalence from the quotient category $\mathcal{K}_{\mathscr{S}}/\mathcal{K}_{\mathscr{S}}'$ to the category $\mathcal{K}_X$. If $\mathscr{S}$ is generated by $\mathscr{S}_1$, we can also replace $\mathcal{K}_X$ by the category of coherent $\mathscr{O}_X$-modules.
\end{remark}
\begin{proposition}\label{scheme Proj of qcoh alg over Noe S_X periodic iff}
Let $Y$ be a Noetherian scheme.
\begin{enumerate}
\item[(a)] Let $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra of finite type with positive degrees, $X=\Proj(\mathscr{S})$, and $\mathscr{S}_X=\sProj(\mathscr{S})=\bigoplus_{n\in\Z}\mathscr{O}_X(n)$. Then $\mathscr{S}_X$ is a periodic graded $\mathscr{O}_X$-algebra whose homogeneous components $(\mathscr{S}_X)_n=\mathscr{O}_X(n)$ are coherent $\mathscr{O}_X$-modules. If $d>0$ is a period of $\mathscr{S}_X$, then $(\mathscr{S}_X)_d=\mathscr{O}_X(d)$ is an invertible $\mathscr{O}_X$-module that is $Y$-ample. Moreover, the canonical homomorphism $\alpha:\mathscr{S}\to\Gamma_*(\mathscr{S}_X)$ is a eventual isomorphism.
\item[(b)] Conversely, let $q:X\to Y$ be a projective morphism, and $\mathscr{S}'$ be a graded $\mathscr{O}_X$-algebra whose homogeneous components $\mathscr{S}'_n$ are coherent $\mathscr{O}_X$-modules, and that admits a period $d>0$ such that $\mathscr{S}'_d$ is an invertible $\mathscr{O}_X$-module that is $Y$-ample. Then $\mathscr{S}=\bigoplus_{n\geq 0}q_*(\mathscr{S}'_n)$ is a quasi-coherent graded $\mathscr{O}_Y$-algebra of finite type with positive degrees, and there exists a $Y$-isomorphism $i:X\cong\Proj(\mathscr{S})$ such that $i^*(\sProj(\mathscr{S}))$ is isomorphic to $\mathscr{S}'$.
\end{enumerate}
\end{proposition}
\begin{proposition}\label{scheme morphism projective over Noe isomorphic to Proj of S_X}
Let $Y$ be a Noetherian scheme, $q:X\to Y$ be a projective morphism, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module that is very ample for $q$. Then $\mathscr{S}=\bigoplus_{n\geq 0}q_*(\mathscr{L}^{\otimes n})$ is a quasi-coherent $\mathscr{O}_Y$-algebra of finite type such that $\mathscr{S}_n=\mathscr{S}_1^n$ for $n\gg 0$, and there exists an $Y$-isomorphism $r:X\cong P=\Proj(\mathscr{S})$ such that $\mathscr{S}\cong r^*(\mathscr{O}_P(1))$.
\end{proposition}
\begin{proposition}\label{scheme morphism projective birational is blow up}
Let $Y$ be a Noetherian integral scheme, $X$ be an integral scheme, and $f:X\to Y$ be a projective birational morphism. Then there exists a coherent fractional ideal $\mathscr{I}\sub\mathscr{K}_Y$ such that $X$ is $Y$-isomorphic to blow up $Y$-scheme relative to $\mathscr{I}$. Moreover, there exists an open subset $U\sub Y$ such that the restriction $f:f^{-1}(U)\to U$ is an isomorphic, and $\mathscr{I}|_U$ is invertible.
\end{proposition}
\begin{proof}
By \cref{scheme quasi-projective over qcqs iff P(E)}, there exists an invertible $\mathscr{O}_X$-module $\mathscr{L}$ that is very ample for $f$, so we can apply \cref{scheme morphism projective over Noe isomorphic to Proj of S_X}, hence identify $X$ with $\Proj(\mathscr{S})$, where $\mathscr{S}=\bigoplus_{n\geq 0}f_*(\mathscr{L}^{\otimes n})$. We also see that each $f_*(\mathscr{L}^{\otimes n})$ is a torsion-free $\mathscr{O}_Y$-module (\cref{scheme integral torsion-free sheaf push forward by dominant}), so $\mathscr{S}$ is canonically identified with a sub-$\mathscr{O}_Y$-module of $\mathscr{S}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y$. By \cref{scheme irreducible qcoh K(X) module simple} this sheaf is simple, so is completely determined when we know its restriction to any non-empty open set, for example to a open nonempty $U'\sub U$ (here $U\sub Y$ is an open subset such that $f$ is an isomorphic on $f^{-1}(U)$) such that $\mathscr{L}|_{f^{-1}(U')}$ is isomorphic to $\mathscr{O}_X|_{f^{-1}(U')}$. As by hypotheses $f_*(\mathscr{L}^{\otimes n})|_{U'}$ is then isomorphic to $\mathscr{O}_Y|_{U'}$, we conclude that $\mathscr{S}\otimes\mathscr{K}_Y$ is an $\mathscr{K}_Y$-module isomorphic to $\mathscr{K}_Y[T]$, where $T$ is an indeterminate, and $\mathscr{S}$ is eventually isomorphic to the sub-$\mathscr{O}_Y$-module generated by the canonical image of $f_*(\mathscr{L})$ in $\mathscr{S}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y$ (\cref{scheme morphism projective over Noe isomorphic to Proj of S_X}). But if we identify $\mathscr{S}\otimes_{\mathscr{O}_Y}\mathscr{K}_Y$ with $\mathscr{K}_Y[T]$, then the image of $f_*(\mathscr{L})$ is identified with $\mathscr{I}\cdot T$, where $\mathscr{I}$ is a coherent sub-$\mathscr{O}_Y$-module of $\mathscr{K}_Y$ (\cref{scheme morphism projective cohomology of coh prop}), and its restriction to $U'$ is isomorphic to $\mathscr{O}_Y|_{U'}$. We therefore conclude that $\mathscr{I}|_U$ is invertible and $\mathscr{S}$ is eventually isomorphic to $\bigoplus_{n\geq 0}\mathscr{I}^n$, whence our assertion.
\end{proof}
\begin{corollary}\label{scheme morphism projective birational is blow up of ideal}
Under the hypothesis of \cref{scheme morphism projective birational is blow up}, suppose that for any nontrivial coherent sub-$\mathscr{O}_Y$-module $\mathscr{I}$ of $\mathscr{K}_Y$, there exists an invertible $\mathscr{O}_Y$-module $\mathscr{L}$ such that
\[\Gamma(Y,\mathscr{L}\otimes_{\mathscr{O}_Y}\sHom_{\mathscr{O}_Y}(\mathscr{I},\mathscr{O}_Y))\neq 0.\]
Then, in the situation of \cref{scheme morphism projective birational is blow up}, we can suppose that $\mathscr{I}$ is an ideal of $\mathscr{O}_Y$. This additional condition is always verified if there exists an ample $\mathscr{O}_Y$-module.
\end{corollary}
\begin{proof}
We first note that
\[\mathscr{L}\otimes_{\mathscr{O}_Y}\sHom_{\mathscr{O}_Y}(\mathscr{I},\mathscr{O}_Y)=\sHom_{\mathscr{O}_Y}(\mathscr{L}^{-1},\sHom_{\mathscr{O}_Y}(\mathscr{I},\mathscr{O}_Y))=\sHom_{\mathscr{O}_Y}(\mathscr{I}\otimes_{\mathscr{O}_Y}\mathscr{L}^{-1},\mathscr{O}_Y)\]
so the hypothesis signifies that there is a nonzero homomorphism $u:\mathscr{I}\otimes\mathscr{L}^{-1}\to\mathscr{O}_Y$. Now for any $y\in Y$, $(\mathscr{I}\otimes\mathscr{L}^{-1})_y$ is identified with a sub-$\mathscr{O}_{Y,y}$-module of the fraction field $\mathscr{K}_{Y,y}$ of $\mathscr{O}_{Y,y}$, so $u_y$ is necessarily injective, and $u$ is therefore an isomorphism from $\mathscr{I}\otimes\mathscr{L}^{-1}$ onto an ideal $\mathscr{I}'$ of $\mathscr{O}_Y$. As the blow up $Y$-scheme relative to $\mathscr{I}$ and $\mathscr{I}\otimes\mathscr{L}^{-1}$ are isomorphic (\cref{scheme Proj of alg alter ring twisted sheaf char}), this proves the corollary. The last remark is a direct concequence of \cref{scheme ample sheaf iff global generation}.
\end{proof}
\begin{corollary}\label{scheme projective over k birational is blow up}
Let $X$ and $Y$ be integral schemes that are projective over a field $k$, and $f:X\to Y$ be a birational $k$-morphism. Then $X$ is $k$-isomorphic to a blow up $Y$-scheme relative to a closed subscheme $Y'$ (not necessarily reduced) of $Y$.
\end{corollary}
\begin{proof}
In fact, $f$ is projective by \cref{scheme morphism projective permanence prop}, and as $Y$ is projective over $k$, the condition of \cref{scheme morphism projective birational is blow up of ideal} is satisfied. It then suffices to consider the closed subscheme of $Y$ defined by the coherent ideal $\mathscr{I}$.
\end{proof}
\subsection{Euler characteristic and Hilbert polynomial}
Let $A$ be an Artinian ring, $X$ be a projective scheme over $Y=\Spec(A)$. For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, the cohomology module $H^i(X,\mathscr{F})$ is finitely generated (\cref{scheme morphism projective cohomology of coh prop}), hence is of finite length. We also see that $H^i(X,\mathscr{F})=0$ for $i\gg 0$, so the integer
\[\chi_A(\mathscr{F})=\sum_{i=0}^{\infty}(-1)^i\ell_A(H^i(X,\mathscr{F}))\]
is defined for any coherent $\mathscr{O}_X$-module. If $A$ is local Artinian, then we say that $\chi_A(\mathscr{F})$ is the Euler characteristic of $\mathscr{F}$ (over the ring $A$). For $\mathscr{F}=\mathscr{O}_X$, the integer $\chi_A(\mathscr{O}_X)$ is called the \textbf{arithmetic genus} of $X$ (over $A$).\par
It is clear that the map $\chi_A$ is additive on the category of coherent $\mathscr{O}_X$-modules. That is, for an exact sequence $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$, we have
\[\chi_A(\mathscr{F})=\chi_A(\mathscr{F}')+\chi_A(\mathscr{F}'').\]
\begin{theorem}
Let $A$ be a local Artinian ring, $X$ be a projective scheme over $Y=\Spec(A)$, $\mathscr{L}$ be a very ample $\mathscr{O}_X$-module relative to $Y$, and $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module. For $n\in\Z$, we set $\mathscr{F}(n)=\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{L}^{\otimes n}$.
\begin{enumerate}
\item[(a)] There exists a polynomial $P\in\Q[T]$ such that $\chi_A(\mathscr{F}(n))=P(n)$ for $n\in\Z$ (the polynomial $P$ is called the Hilbert polynomial of $\mathscr{F}$ over $A$).
\item[(b)] For $n\gg 0$, we have $\chi_A(\mathscr{F}(n))=\ell_A(\Gamma(X,\mathscr{F}(n)))$.
\item[(c)] The leading coefficient of $\chi_A(\mathscr{F}(n))$ is positive.
\end{enumerate}
\end{theorem}
\begin{example}\label{scheme P^r Hilbert polynomial of O_X(n)}
Let $k$ be a field, $r>0$ be an integer, and $X=\P_k^r$. Then we have $\chi_A(\mathscr{O}_X(n))=\binom{n+r}{r}$ for $n\in\Z$. To see this, we divide into three cases.
\begin{itemize}
\item For $n>0$, we have $\chi_A(\mathscr{O}_X(n))=\dim_k(H^0(X,\mathscr{O}_X(n)))$, which is the number of homogeneous polynomials of degree $n$ and is equal to $\binom{n+r}{r}$.
\item For $n<-r$, we have $\chi_A(\mathscr{O}_X(n))=(-1)^r\dim_k(H^r(X,\mathscr{O}_X(n)))$. If $n=-r-d$, the dimension of $H^r(X,\mathscr{O}_X(n))$ over $k$ is is the number of sequences of integers $(\alpha_0,\dots,\alpha_r)$ with $\alpha_i>0$ and $|\alpha|=r+d$ (\cref{scheme Proj cohomology of O_X(n)}), which is equal to the number $\binom{d+r-1}{r}=(-1)^r\binom{n+r}{r}$.
\item For $-r\leq n\leq 0$, we have $\binom{n+r}{r}=0$ and also $H^i(X,\mathscr{O}_X(n))=0$ for $i\geq 0$.
\end{itemize}
\end{example}
\begin{corollary}
Let $A$ be a local Artinian ring, $S$ be a graded $A$-algebra of finite type generated by $S_1$, $M$ be a graded $S$-module, and $X=\Proj(S)$. Then we have $\chi_A(\widetilde{M}(n))=\ell_A(M_n)$ for $n\gg 0$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme Proj of qcoh alg associated sheaf alpha TN isomorphism}, since $H^i(X,\widetilde{M}(n))=0$ for $i>0$ if $n\gg 0$.
\end{proof}
\subsection{Cohomological criterion for ampleness}
\begin{proposition}\label{scheme morphism proper over Noe relative ample iff}
Let $Y$ be a Noetherian scheme, $f:X\to Y$ be a proper morphism, and $\mathscr{L}$ be an invertible $\mathscr{O}_X$-module. For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, we set $\mathscr{F}(n)=\mathscr{F}\otimes\mathscr{L}^{\otimes n}$ for $n\in\Z$.
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{L}$ is ample for $f$.
\item[(\rmnum{2})] For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, there exists an integer $n_0$ such that for $n\geq n_0$, we have $R^pf_*(\mathscr{F}(n))=0$ for $p>0$.
\item[(\rmnum{3})] For any coherent ideal $\mathscr{I}$ of $\mathscr{O}_X$, there exists an integer $n_0$ such that for $n\geq n_0$, we have $R^1f_*(\mathscr{I}(n))=0$.
\end{enumerate}
\end{proposition}
\section{The finiteness theorem for proper morphisms}
\subsection{The d\'evissage lemma}
Let $\mathcal{A}$ be an abelian category. We say that a subset $\mathfrak{E}$ of objects of $\mathcal{A}$ is exact if $0\in\mathcal{E}$, and for any exact sequence $0\to A'\to A\to A''\to 0$ in $\mathcal{A}$ such that two of $A,A',A''$ are in $\mathfrak{E}$, then the third one is in $\mathfrak{E}$. The following technique, called the \textit{d\'evissage lemma}, is introduced by Alexander Grothendieck to prove statements about coherent sheaves on Noetherian schemes. One can think this method as an adaption of Noetherian induction. 
\begin{theorem}[\textbf{D\'evissage Lemma}]\label{scheme Noe devissage lemma}
Let $X$ be a Noetherian scheme, $\mathfrak{E}$ be an exact subset of the category $\mathcal{A}$ of coherent $\mathscr{O}_X$-modules, and $X'$ be a closed subset of $X$. Suppose that for any irreducible subset $Y$ of $X'$, with generic point $y$, there exists a coherent $\mathscr{O}_X$-module $\mathscr{G}\in\mathfrak{E}$ such that $\mathscr{G}_y$ is a $\kappa(y)$-vector space of dimension $1$. Then any coherent $\mathscr{O}_X$-module with support in $X'$ belongs to $\mathfrak{E}$.
\end{theorem}
\begin{proof}
Consider the following property $\mathcal{P}(Y)$ on a closed subset $Y$ of $X$: any coherent $\mathscr{O}_X$-module with support contained in $Y$ belongs to $\mathfrak{E}$. In view of the Noetherian induction principle (\cref{topo Noe induction principle}), we are reduced to prove the following: if $Y$ is a closed subset of $X'$ such that $\mathcal{P}(Y')$ is valid for any proper closed subset $Y'\sub Y$, then $\mathcal{P}(Y)$ is valid.\par
Now let $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module with support contained in $Y$, we show that $\mathscr{F}\in\mathfrak{E}$. In this case, we endow $Y$ with the reduced subscheme structure of $X$, and let $\mathscr{I}$ be the ideal of $\mathscr{O}_X$ defining it. By \cref{scheme qc qcoh ft ideal power annihilated if supp}, we see there exists an integer $n>0$ such that $\mathscr{I}^n\mathscr{F}=0$; for $1\leq k\leq n$, we then have an exact sequence
\[\begin{tikzcd}
0\ar[r]&\mathscr{I}^{k-1}\mathscr{F}/\mathscr{I}^{k}\mathscr{F}\ar[r]&\mathscr{F}/\mathscr{I}^k\mathscr{F}\ar[r]&\mathscr{F}/\mathscr{I}^{k-1}\mathscr{F}\ar[r]&0
\end{tikzcd}\]
of coherent $\mathscr{O}_X$-modules. As $\mathfrak{E}$ is exact, by recurrence on $k$, it suffices to prove that $\mathscr{F}_k=\mathscr{I}^{k-1}\mathscr{F}/\mathscr{I}^k\mathscr{F}$ belongs to $\mathfrak{E}$; in other words, we may also assume that $\mathscr{I}\mathscr{F}=0$, which means $\mathscr{F}=j_*(j^*(\mathscr{F}))$, where $j:Y\to X$ is the canonical injection.\par
First suppose that $Y$ is reducible, and let $Y=Y'\cup Y''$, where $Y',Y''$ are proper closed subsets of $Y$. We endow $Y',Y''$ with the reduced subscheme structure, and let $\mathscr{I}',\mathscr{I}''$ be the defining ideals of $\mathscr{O}_X$. Put $\mathscr{F}'=\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}')$ and $\mathscr{F}''=\mathscr{F}\otimes_{\mathscr{O}_X}(\mathscr{O}_X/\mathscr{I}'')$. The canonical homomorphisms $\mathscr{F}\to\mathscr{F}'$, $\mathscr{F}\to\mathscr{F}''$ then define a homomorphism $u:\mathscr{F}\to\mathscr{F}\oplus\mathscr{F}''$ such that any point $z\notin Y'\cap Y''$, the induced homomorphism $u_z:\mathscr{F}\to\mathscr{F}'_z\oplus\mathscr{F}''_z$ is bijective. In fact, we have $\mathscr{I}'\cap\mathscr{I}''=\mathscr{I}$; if $z\notin Y''$ then $\mathscr{I}'_z=\mathscr{I}_z$, so $\mathscr{F}'_z=\mathscr{F}_z$ and $\mathscr{F}''_z=0$; and similarly if $z\notin Y'$. The kernel and cokernel of $u$, which belong to $\mathcal{A}$, are then supported in $Y'\cap Y''$, and hence belong to $\mathfrak{E}$ by hypothesis. By the same reasoning, $\mathscr{F}'$ and $\mathscr{F}''$ are in $\mathfrak{E}$, hence so is $\mathscr{F}'\oplus\mathscr{F}''$. We now conclude from the following exact sequences
\[\begin{gathered}
\begin{tikzcd}
0\ar[r]&\ker u\ar[r]&\mathscr{F}\ar[r]&\im u\ar[r]&0
\end{tikzcd}\\
\begin{tikzcd}
0\ar[r]&\im u\ar[r]&\mathscr{F}'\oplus\mathscr{F}''\ar[r]&\coker u\ar[r]&0
\end{tikzcd}
\end{gathered}\]
that $\mathscr{F}$ belongs to $\mathfrak{E}$.\par
If on the other hand $Y$ is irreducible, then the subscheme $Y$ of $X$ is integral. If $y$ is the generic point of $Y$, we have $\mathscr{O}_{Y,y}=\kappa(y)$, and as $j^*(\mathscr{F})$ is a coherent $\mathscr{O}_Y$-module, $\mathscr{F}_y=(j^*(\mathscr{F}))_y$ is a $\kappa(y)$-vector space of finite dimension $m$. By hypothesis, there exists a coherent $\mathscr{O}_X$-module $\mathscr{G}\in\mathfrak{E}$ (necessarily supported in $Y$) such that $\mathscr{G}_y$ is a $\kappa(y)$-vector space of dimension $1$, so there is an $\kappa(y)$-isomorphism $(\mathscr{G}_y)^m\cong\mathscr{F}_y$, which is also an $\mathscr{O}_Y$-isomorphism, and as $\mathscr{G}^m$ and $\mathscr{F}$ are coherent, there exists an open neighborhood $W$ of $y$ in $X$ and an isomorphism $\mathscr{G}^m|_W\cong\mathscr{F}|_W$ (\cref{sheaf of module ft local prop}). Let $\mathscr{H}$ be the graph of this isomorphism, which is a coherent sub-$(\mathscr{O}_X|_W)$-module of $(\mathscr{G}^m\oplus\mathscr{F})|_W$. Then there is a sub-$\mathscr{O}_X$-module $\mathscr{H}_0$ of $\mathscr{G}^m\oplus\mathscr{F}$, inducing $\mathscr{H}$ over $W$ and zero over $X-Y$ (\cref{sheaf of module ft local prop}). The restrictions $v:\mathscr{H}_0\to\mathscr{G}^m$ and $w:\mathscr{H}_0\to\mathscr{F}$ of the canonical projections of $\mathscr{G}^m\oplus\mathscr{F}$ are then homomorphisms of coherent $\mathscr{O}_X$-modules which are isomorphic over $W$ and over $X-Y$. The kernel and cokernels of these homomorphisms are then supported in the proper closed subset $Y-(Y\cap W)$ of $Y$, so by hypotheses they belong to $\mathfrak{E}$. On the other hand, we have $\mathscr{G}^m\in\mathfrak{E}$ since $\mathscr{G}\in\mathfrak{E}$, so by the exactness of $\mathfrak{E}$ we conclude that $\mathscr{H}_0\in\mathfrak{E}$, hence $\mathscr{F}\in\mathfrak{E}$.
\end{proof}
\begin{corollary}\label{scheme Noe direct factor stable devissage lemma}
Suppose that the exact subset $\mathfrak{E}$ satisfies the additional property that any direct factor in $\mathcal{A}$ of a coherent $\mathscr{O}_X$-module $\mathscr{F}\in\mathfrak{E}$ belongs to $\mathfrak{E}$. Then the conclusion of \cref{scheme Noe devissage lemma} is still valid if we replace "$\mathscr{G}_y$ is a $\kappa(y)$-vector space of dimension $1$" by the condition that $\mathscr{G}_y\neq 0$ (or equivalently $\supp(\mathscr{G})=Y$).
\end{corollary}
\begin{proof}
In fact, in this case the proof of \cref{scheme Noe devissage lemma} when $Y$ is irreducible can be modified as follows: $\mathscr{G}_y$ is a $\kappa(y)$-vector space of dimension $q>0$, and we then have an isomorphism $(\mathscr{G}_y)^m\cong(\mathscr{F}_y)^q$. By the same reasoning, we obtain that $\mathscr{F}^q\in\mathfrak{E}$, so $\mathscr{F}\in\mathfrak{E}$ by our additional assumption on $\mathfrak{E}$.
\end{proof}
\subsection{The finiteness theorem for proper morphisms}
\begin{theorem}\label{scheme morphism proper over Noe R^pf_* coherence}
Let $Y$ be a locally Noetherian scheme and $f:X\to Y$ be a proper morphism. Then for any coherent $\mathscr{O}_X$-module $\mathscr{F}$, the $\mathscr{O}_Y$-modules $R^pf_*(\mathscr{F})$ are coherent for $p\geq 0$.
\end{theorem}
\begin{proof}
Since this question is local over $Y$, we can suppose that $Y$ is Noetherian, and hence $X$ is Noetherian (\cref{scheme local Noe local ft iff fp}). The coherent $\mathscr{O}_X$-module $\mathscr{F}$ satisfying the conclusion of \cref{scheme morphism proper over Noe R^pf_* coherence} is easily seen to form an exact subset $\mathfrak{E}$ of the category $\mathcal{A}$ of coherent $\mathscr{O}_X$-modules. In fact, let $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$ be an exact sequence of coherect $\mathscr{O}_X$-modules, and suppose for example that $\mathscr{F}'$, $\mathscr{F}$ belong to $\mathfrak{E}$. Then we have an exact sequence
\[\begin{tikzcd}
R^{p-1}f_*(\mathscr{F}'')\ar[r,"\partial"]&R^pf_*(\mathscr{F})\ar[r]&R^pf_*(\mathscr{F})\ar[r]&R^pf_*(\mathscr{F}'')\ar[r,"\partial"]&R^{p+1}f_*(\mathscr{F}')
\end{tikzcd}\]
in which the four outer terms are coherent. It then follows from \cref{sheaf of module coh 5 of 4} that $R^pf_*(\mathscr{F})$ is coherent. We also note that any direct factor $\mathscr{F}'\in\mathcal{A}$ of a coherent $\mathscr{O}_X$-module $\mathscr{F}\in\mathfrak{E}$ belongs to $\mathfrak{E}$: in fact, $R^pf_*(\mathscr{F}')$ is then a direct factor of $R^pf_*(\mathscr{F})$ (G, \Rmnum{2} 4.4.4), so is of finite type, and since it is quasi-coherent (\cref{scheme qcqs morphism qcoh higher direct image}), it is coherent (note that $Y$ is Noetherian). In view of \cref{scheme Noe direct factor stable devissage lemma}, we only need to prove that if $X$ is irreducible with generic point $x$, then there exists a coherent $\mathscr{O}_X$-module $\mathscr{F}\in\mathfrak{E}$ such that $\mathscr{F}_x\neq 0$. In fact, for any irreducible closed subscheme $Y$ of $X$ with canonical injection $j:Y\to X$, the composition $f\circ j$ is proper (\cref{scheme morphism proper permanence prop}), and if $\mathscr{G}$ is a coherent $\mathscr{O}_Y$-module supported in $Y$, then $j_*(\mathscr{G})$ is a coherent $\mathscr{O}_X$-module such that $R^p(f\circ j)_*(\mathscr{G})=R^pf_*(j_*(\mathscr{G}))$ (G, \Rmnum{2}, 4.9.1), so we can apply our result on $Y$.\par
By Chow's lemma (\cref{scheme morphism ft over Now Chow lemma}), there exists an irreducible scheme $X'$ and a surjective projective morphism $g:X'\to X$ such that $f\circ g:X'\to Y$ is projective. By \cref{scheme quasi-projective over qcqs iff P(E)}, there exists a $g$-ample $\mathscr{O}_{X'}$-module $\mathscr{L}$, so by \cref{scheme morphism projective cohomology of coh prop} we see that there exists an integer $n_0$ such that $\mathscr{F}=g_*(\mathscr{O}_{X'}(n))$ is a coherent $\mathscr{O}_X$-module and $R^pg_*(\mathscr{O}_{X'}(n))=0$ for $p>0$ and $n\geq n_0$. Moreover, if $x$ (resp. $x'$) is the generic point of $X$ (resp. $X')$, there exists an open subset $U$ of $x$ such that $g$ is an isomorphism from $g^{-1}(U)$ onto $U$, so $\mathscr{F}_x\cong(\mathscr{O}_{X'}(n))_{x'}\neq 0$. On the other hand, since $f\circ g$ is projective and $Y$ is Noetherian, the $R^p(f\circ g)(\mathscr{O}_{X'}(n))$ are coherent by \cref{scheme morphism projective cohomology of coh prop}. Consider the Grothendieck's spectral sequence:
\[E_2^{p,q}=R^pf_*(R^qg_*(\mathscr{O}_{X'}(n)))\Rightarrow R^*(f\circ g)_*(\mathscr{O}_{X'}(n)).\]
We have already remarked that for $n\gg 0$ we have $R^qg_*(\mathscr{O}_{X'}(n))=0$ for $q>0$, so this sequence collapse at $E_2$ and we obtain an isomorphism $E_2^{p,0}=R^pf_*(\mathscr{F})\cong R^p(f\circ g)_*(\mathscr{O}_{X'}(n))$, which implies $\mathscr{F}\in\mathfrak{E}$ and completes the proof.
\end{proof}
\begin{corollary}\label{scheme proper over Noe ring coherence of cohomology}
Let $A$ be a Noetherian ring, $X$ be a proper scheme over $A$. For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, the $H^p(X,\mathscr{F})$ are finitely generated $A$-modules, and there exists an integer $r$ such that $H^p(X,\mathscr{F})=0$ for any coherent $\mathscr{O}_X$-module $\mathscr{F}$ and $p>r$.
\end{corollary}
\begin{proof}
The second assertion is proved in \cref{scheme Proj over Noe ring cohomology of coh prop}, and the first one follows from \cref{scheme morphism proper over Noe R^pf_* coherence}, in view of \cref{scheme qcqs morphism direct image over affine char}.
\end{proof}
\begin{corollary}\label{scheme morphism ft R^pf_* coherence if supp proper}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism of finite type. For any coherent $\mathscr{O}_X$-module with support proper over $Y$, the $\mathscr{O}_Y$-modules $R^pf_*(\mathscr{F})$ are coherent for $p\geq 0$.
\end{corollary}
\begin{proof}
Since this question is local over $Y$, we may assume that $Y$ is Noetherian, and then so is $X$. By hypothesis, any closed subscheme $Z$ of $X$ with underlying space $\supp(\mathscr{F})$ is proper over $Y$, so if $j:Y\to X$ is the canonical injection, $f\circ j$ is proper. Now we may choose $Z$ such that $\mathscr{F}=j_*(\mathscr{G})$, where $\mathscr{G}=j^*(\mathscr{F})$ is a coherent $\mathscr{O}_Z$-module (\cref{scheme qc qcoh ft direct image of inverse prop}). Since we have $R^pf_*(\mathscr{F})=R^p(f\circ j)_*(\mathscr{G})$ by \cref{scheme morphism affine R^pg_*(f_*) isomorphic to composition}, the conclusion follows from \cref{scheme morphism proper over Noe R^pf_* coherence}.
\end{proof}
\begin{proposition}\label{scheme morphism proper over Noe coherence of qcoh graded}
Let $Y$ be a Noetherian scheme, $\mathscr{S}$ be a quasi-coherent graded $\mathscr{O}_Y$-algebra of finite type with positive degrees, $Y'=\Proj(\mathscr{S})$, and $g:Y'\to Y$ be the structural morphism. Let $f:X\to Y$ be a proper morphism, $\mathscr{S}'=f^*(\mathscr{S})$, and $\mathscr{M}$ be a quasi-coherent graded $\mathscr{S}'$-module of finite type. Then the $R^pf_*(\mathscr{M})$ are graded $\mathscr{S}$-modules of finite type for $p\geq 0$. Suppose moreover that $\mathscr{S}$ is generated by $\mathscr{S}_1$, then for any $p\in\N$, there exists an integer $k_p$ such that for $k\geq k_p$ and $r\geq 0$, we have
\begin{align}\label{scheme morphism proper over Noe coherence of qcoh graded-1}
R^pf_*(\mathscr{M}_{k+r})=\mathscr{S}_rR^pf_*(\mathscr{M}_k).
\end{align} 
\end{proposition}
\begin{proof}
The first assertion follows from \cref{scheme morphism projective over Noe coherence of qcoh graded} since in its proof the condition on $f$ is only used to derive the coherence of the $\mathscr{O}_{Y'}$-modules $R^pf'_*(\bigtilde{\mathscr{M}})$. With the hypotheses of \cref{scheme morphism proper over Noe coherence of qcoh graded}, $f'$ is proper (\cref{scheme morphism proper permanence prop}(\rmnum{3})), so we can now utilize \cref{scheme morphism proper over Noe R^pf_* coherence} to complete the proof.
\end{proof}
\begin{corollary}\label{scheme proper over Noe coh power by ideal cohomology}
Let $A$ be a Noetherian ring, $\mathfrak{I}$ be an ideal of $A$, $X$ be a proper $A$-scheme, and $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module. Then for any $p\geq 0$, the direct sum $\bigoplus_{k\geq 0}H^p(X,\mathfrak{I}^k\mathscr{F})$ is a finitely generated module over $S=\bigoplus_{k\geq 0}\mathfrak{I}^k$. In particular, there exists an integer $k_p\geq 0$ such that for $k\geq k_p$, $r\geq 0$, we have
\begin{align}\label{scheme proper over Noe coh power by ideal cohomology-1}
H^p(X,\mathfrak{I}^{k+r}\mathscr{F})=\mathfrak{I}^rH^p(X,\mathfrak{I}^k\mathscr{F}).
\end{align}
\end{corollary}
\begin{proof}
It suffices to apply \ref{scheme morphism proper over Noe coherence of qcoh graded} to $Y=\Spec(A)$, $\mathscr{S}=\widetilde{S}$, and $\mathscr{M}_k=\mathfrak{I}^k\mathscr{F}$.
\end{proof}
\subsection{Generalization to formal schemes}
\section{Zariski's main theorem and applications}
\subsection{Grothendieck's comparison theorem}
Let $X,Y$ be Noetherian schemes, $f:X\to Y$ be a proper morohism, $Y'$ be a closed subscheme of $Y$, and $X'$ be the inverse image $f^{-1}(Y')$. We denote by $\widehat{X}$ and $\widehat{Y}$ the formal completion $X_{/X'}$ and $Y_{/Y'}$ of $X$ and $Y$ along $X'$ and $Y'$, respectively, and let $\hat{f}:\widehat{X}\to\widehat{Y}$ be the extension of $f$ to completions. For any coherent $\mathscr{O}_X$-module $\mathscr{F}$, let $\widehat{\mathscr{F}}$ be the completion $\mathscr{F}_{/X'}$ of $\mathscr{F}$ along $X'$, which is coherent by \cref{scheme local Noe formal completion exact}.\par
Let $\mathscr{I}$ be a coherent ideal of $\mathscr{O}_Y$ defining $Y'$, then by \cref{scheme inverse image of subscheme}(b) the coherent ideal $\mathscr{K}=f^*(\mathscr{I})\mathscr{O}_X$ defines the closed subscheme $X'$ of $X$. For each $k\geq 0$, we consider the coherent $\mathscr{O}_X$-module
\[\mathscr{F}_k=\mathscr{F}\otimes_{\mathscr{O}_Y}(\mathscr{O}_Y/\mathscr{I}^{k+1})=\mathscr{F}/\mathscr{K}^{k+1}\mathscr{F}.\]
The $\mathscr{O}_Y$-modules $R^pf_*(\mathscr{F})$ and $R^pf_*(\mathscr{F}_k)$ are coherent for $p\geq 0$ (\cref{scheme morphism proper over Noe R^pf_* coherence}). For any $k\geq 0$ and $p\geq 0$, the canonical homomorphism $\mathscr{F}\to\mathscr{F}_k$ defines by functoriality a homomorphism
\begin{align}\label{scheme morphism proper completion and direct image-1}
R^pf_*(\mathscr{F})\to R^pf_*(\mathscr{F}_k)
\end{align}
Moreover, as $\mathscr{F}_k$ is an $\mathscr{O}_X/\mathscr{K}^{k+1}$-module, $R^pf_*(\mathscr{F}_k)$ is an $\mathscr{O}_Y/\mathscr{I}^{k+1}$-module (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 12.2.1) and we then deduce from (\ref{scheme morphism proper completion and direct image-1}) a homomorphism
\begin{align}\label{scheme morphism proper completion and direct image-2}
R^pf_*(\mathscr{F})\otimes_{\mathscr{O}_Y}(\mathscr{O}_Y/\mathscr{I}^{k+1})\to R^pf_*(\mathscr{F}_k).
\end{align}
The two sides of (\ref{scheme morphism proper completion and direct image-2}) form two projective systems, and the projective limit of the left side is just the completion $(R^pf_*(\mathscr{F}))_{/Y'}$, which we also denote by $\widehat{R^pf_*(\mathscr{F})}$. Moreover, it is immediate that the homomorphisms in (\ref{scheme morphism proper completion and direct image-2}) form a projective system, so by passing to projective limit we obtain a canonocal homomorphism
\begin{align}\label{scheme morphism proper completion and direct image-3}
\varphi_p:\widehat{R^pf_*(\mathscr{F})}\to\llim_kR^pf_*(\mathscr{F}_k).
\end{align}
Since (\ref{scheme morphism proper completion and direct image-2}) is a homomorphism of $(\mathscr{O}_Y/\mathscr{I}^{k+1})$-modules, and can be considered as a continuous homomorphism of discrete $\mathscr{O}_{\widehat{Y}}$-modules, we see that the homomorphism $\varphi_p$ is a continuous homomorphism of topological $\mathscr{O}_Y$-modules.\par
On the other hand, let $i_X:\widehat{X}\to X$ be the canonical morphism, which fits into the commutative diagram
\begin{equation}\label{scheme morphism proper completion and cohomology-1}
\begin{tikzcd}
X_k\ar[rd,swap,"i_k"]\ar[r,"h_k"]&\widehat{X}\ar[d,"i_X"]\\
&X
\end{tikzcd}
\end{equation}
where $X_k$ is the closed subscheme of $X$ defined by the ideal $\mathscr{K}^{k+1}$, $i_k:X_k\to X$ is the canonical injection, and $h_k$ is given the canonical homomorphism $\mathscr{O}_{\widehat{X}}\to\mathscr{O}_X/\mathscr{K}^{k+1}$. By \cref{scheme local Noe formal completion exact}, we have $\widehat{\mathscr{F}}=i_X^*(\mathscr{F})$. Since $\mathscr{F}_k=(i_k)_*(i_{k}^*(\mathscr{F}_k))$ (G, \Rmnum{2}, 4.9.1), we see that
\begin{align}\label{scheme morphism proper completion and cohomology-2}
H^p(X_k,i_k^*(\mathscr{F}_k))=H^p(X,\mathscr{F}_k).
\end{align}
The canonical homomorphism $H^p(\widehat{X},\widehat{\mathscr{F}})\to H^p(X_k,h_k^*(\widehat{\mathscr{F}}))$ can then by identified as the following homomorphism:
\begin{align}\label{scheme morphism proper completion and cohomology-3}
H^p(\widehat{X},\widehat{\mathscr{F}})\to H^p(X,\mathscr{F}_k).
\end{align}
These homomorphisms evidently form a projective system, so by passing to projective limit we obtain a canonical homomorphism
\begin{align}\label{scheme morphism proper completion and cohomology-4}
\psi_{p,X}:H^p(\widehat{X},\widehat{\mathscr{F}})\to\llim_kH^p(X,\mathscr{F}_k).
\end{align}
Now in view of \cref{scheme qcqs morphism direct image over affine char}, by replacing $X$ with open subsets of the form $f^{-1}(V)$, where $V$ is an affine open of $Y$, we also obtain homomorphisms
\[\psi_{p,V}:H^p(\widehat{X}\cap f^{-1}(V),\widehat{\mathscr{F}})\to\llim_k\Gamma(V,R^pf_*(\mathscr{F}_k)).\]
It is clear that the homomorphisms $\psi_{p,V}$ are compatible with restrictions, so by shefification, we obtain an induced canonical homomorphism
\begin{align}\label{scheme morphism proper completion and cohomology-4}
\psi_p:R^p\hat{f}_*(\widehat{\mathscr{F}})\to\llim_kR^pf_*(\mathscr{F}_k).
\end{align}

Finally, let $i_Y:\widehat{Y}\to Y$ be the canonical morphism; as $R^pf_*(\mathscr{F})$ is a coherent $\mathscr{O}_Y$-module by \cref{scheme morphism proper over Noe R^pf_* coherence}, we have $i_Y^*(R^pf_*(\mathscr{F}))=\widehat{R^pf_*(\mathscr{F})}$ (\cref{scheme local Noe formal completion exact}), and therefore a canonical homomorphism 
\begin{align}\label{scheme morphism proper completion and cohomology-5}
\rho_p:\widehat{R^pf_*(\mathscr{F})}=i_Y^*(R^pf_*(\mathscr{F}))\to R^p\hat{f}_*(i_X^*(\mathscr{F}))=R^p\hat{f}_*(\widehat{\mathscr{F}}),
\end{align}
which is defined in the same way as the canonical homomorphism (\ref{scheme morphism proper ftsp flat base change R^pf_*-3}). From the commutative diagram (\ref{scheme morphism proper completion and cohomology-1}), we then obtain a commutative diagram
\begin{equation}\label{scheme morphism proper comparision diagram}
\begin{tikzcd}
\widehat{R^pf_*(\mathscr{F})}\ar[rd,swap,"\varphi_p"]\ar[rr,"\rho_p"]&&R^p\hat{f}_*(\widehat{\mathscr{F}})\ar[ld,"\psi_p"]\\
&\llim_kR^pf_*(\mathscr{F}_k)
\end{tikzcd}
\end{equation}
\begin{theorem}[\textbf{Grothendieck's Comparison Theorem}]\label{scheme morphism proper comparison theorem}
Let $f:X\to Y$ be a proper morphism between Noetherian schemes, $Y'$ be a closed subset of $Y$, and $X'=f^{-1}(Y')$. Then for any coherent $\mathscr{O}_X$-module $\mathscr{F}$, $R^p\hat{f}_*(\widehat{\mathscr{F}})$ is a coherent $\mathscr{O}_{\widehat{X}}$-module and the homomorphisms in (\ref{scheme morphism proper comparision diagram}) are homeomorphisms for $p\geq 0$.
\end{theorem}
The fact that $\rho_p$ is an isomorphism signifies that the formation of $R^pf_*$ commutes with that of completion, so \cref{scheme morphism proper comparison theorem} gives a comparision result between formal geometry and algebraic geometry. We being its proof by establishing the following affine case:
\begin{corollary}\label{scheme morphism proper comparison theorem affine case}
Under the hypotheses of \cref{scheme morphism proper comparison theorem}, assume that $Y=\Spec(A)$, where $A$ is Noetherian, and $\mathscr{I}=\widetilde{\mathfrak{I}}$ is an ideal of $A$, so that $\mathscr{F}_k=\mathscr{F}/\mathfrak{I}^{k+1}\mathscr{F}$. Then for each $p\geq 0$, the projective system $(H^p(X,\mathscr{F}_k))_{k\geq 0}$ satisfies the Mittag-Leffler condition, and the canonical homomorphism
\begin{align}\label{scheme morphism proper comparison theorem affine case-1}
\psi_p:H^p(\widehat{X},\widehat{\mathscr{F}})\to\llim_kH^p(X,\mathscr{F}_k)
\end{align}
is an isomorphism.
Moreover, the filtration on $H^p(X,\mathscr{F})$ defined by the kernel of the canonical homomorphisms $H^p(X,\mathscr{F})\to H^p(X,\mathscr{F}_k)$ is $\mathfrak{I}$-good and the canonical homomorphisms
\begin{align}\label{scheme morphism proper comparison theorem affine case-2}
\varphi_p:\widehat{H^p(X,\mathscr{F})}\to\llim_kH^p(X,\mathscr{F}_k)
\end{align}
is a homeomorphism (where the left side is the $\mathfrak{I}$-adic completion of $H^p(X,\mathscr{F})$).  
\end{corollary}
\begin{proof}
Fix an integer $p\geq 0$, and we simplfy the notation by setting
\[H=H^p(X,\mathscr{F}),\quad H_k=H^p(X,\mathscr{F}_k),\quad R_k=\ker(H\to H_k)\sub H.\]
The exact sequence on cohomology
\[\begin{tikzcd}[column sep=8mm]
H^p(X,\mathfrak{I}^{k+1}\mathscr{F})\ar[r]&H^p(X,\mathscr{F})\ar[r]&H^p(X,\mathscr{F}_k)\ar[r,"\partial"]&H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F})\ar[r]&H^{+1}(X,\mathscr{F})
\end{tikzcd}\]
shows that $R_k$ is also the image of the homomorphism $H^p(X,\mathfrak{I}^{k+1}\mathscr{F})\to H^p(X,\mathscr{F})$; we set
\begin{align}\label{scheme morphism proper comparison theorem affine case-3}
Q_k=\ker(H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F})\to H^{p+1}(X,\mathscr{F}))=\im(H^p(X,\mathscr{F}_k)\to H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F}))
\end{align}
so that there is an exact sequence
\[\begin{tikzcd}
0\ar[r]&R_k\ar[r]&H\ar[r]&H_k\ar[r]&Q_k\ar[r]&0
\end{tikzcd}\]
Let $x$ be an element of $\mathfrak{I}^m$ for $m\geq 0$; the multiplication by $x$ on $\mathfrak{I}^k\mathscr{F}$ is a homomorphism $\mathfrak{I}^k\mathscr{F}\to\mathfrak{I}^{k+m}\mathscr{F}$, and therefore gives a homomorphism
\begin{align*}
\mu_{x,m}:H^p(X,\mathfrak{I}^k\mathscr{F})\to H^p(X,\mathfrak{I}^{k+m}\mathscr{F}).
\end{align*}
If we denote by $S$ the graded $A$-algebra $\bigoplus_{k\geq 0}\mathfrak{I}^k$, then the multiplications $\mu_{x,m}$ define over $E=\bigoplus_{k\geq 0}H^p(X,\mathfrak{I}^k\mathscr{F})$ a finitely generated graded $S$-module structure (\cref{scheme proper over Noe coh power by ideal cohomology}), which is Noetherian since $S$ is Noetherian (\cref{graded ring finitely generated criterion}).\par
We begin by showing that the submodules $(R_k)$ define a $\mathfrak{I}$-good filtration on $H$. First, for any $x\in\mathfrak{I}^m$, the diagram
\[\begin{tikzcd}
\mathfrak{I}^{k+1}\mathscr{F}\ar[d]\ar[r,"x"]&\mathfrak{I}^{k+m+1}\mathscr{F}\ar[d]\\
\mathscr{F}\ar[r,"x"]&\mathscr{F}
\end{tikzcd}\]
is commutative, so the correponding diagram
\begin{equation}\label{scheme morphism proper comparison theorem affine case-4}
\begin{tikzcd}
H^p(X,\mathfrak{I}^{k+1}\mathscr{F})\ar[r,"\mu_{x,m}"]\ar[d]&H^p(X,\mathfrak{I}^{k+m+1}\mathscr{F})\ar[d]\\
H^p(X,\mathscr{F})\ar[r,"\mu_{x,0}"]&H^p(X,\mathscr{F})
\end{tikzcd}
\end{equation}
is commutative, which proves, in view of the interpretation of $R_k$ as the image of $H^{p}(X,\mathfrak{I}^{k+1}\mathscr{F})$ in $H^p(X,\mathfrak{F})$, that $\mathfrak{I}^mR_k\sub R_{k+m}$ and that the graded $S$-module $R=\bigoplus_{k\geq 0}R_k$ is a quotient of the sub-$S$-module $M=\bigoplus_{k\geq 0}H^p(X,\mathfrak{I}^{k+1}\mathscr{F})$ of $E$. Since $M$ is also a finitely generated $S$-module by \cref{scheme proper over Noe coh power by ideal cohomology}, the $S$-module $R$ is then finitely generated, which is equivalent to the condition that $(R_k)$ is $\mathfrak{I}$-good (\cref{filtration I-good iff Res(M) is finite}).\par
Consider now the graded $S$-module $N=\bigoplus_{k\geq 0}H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F})$, which is a finitely generated $S$-module in view of \cref{scheme proper over Noe coh power by ideal cohomology}. For each $k\geq 0$, by (\ref{scheme morphism proper comparison theorem affine case-3}) we have $Q_k\sub N_k$, and by replacing $p$ by $p+1$ in the diagram (\ref{scheme morphism proper comparison theorem affine case-4}) we see that $S_mQ_k=\mathfrak{I}^{m}Q_k\sub Q_{k+m}$. In other words, $Q=\bigoplus_{k\geq 0}Q_k$ is a graded sub-$S$-module of $N$, and is therefore finitely generated. We denote by $\alpha_m:\mathfrak{I}^m\to A$ the canonical injection, which can also be written as $S_m\to S_0$. Since $\mathfrak{I}^{k+1}\mathscr{F}_k=0$, the $A$-module $H^p(X,\mathscr{F}_k)$ is annihilated by $\mathfrak{I}^{k+1}$, so $Q_k$, as the image of the $A$-homomorphism $H^p(X,\mathscr{F}_k)\to H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F})$, is also annihilated by $\mathfrak{I}^{k+1}$. This signifies that, in the $S$-module $Q$, we have
\begin{align}\label{scheme morphism proper comparison theorem affine case-5}
\alpha_{k+1}(S_{k+1})Q_k=0.
\end{align}
As $Q$ is a finitely generated $S$-module, there exists an integers $k_0$ and $d$ such that $Q_{k+d}=S_dQ_k$ for $k\geq k_0$ (\cref{graded ring finite module M_n+d=A_dM_n}); we then deduce from this relation and (\ref{scheme morphism proper comparison theorem affine case-5}) that there exists an integer $r>0$ such that
\begin{align}\label{scheme morphism proper comparison theorem affine case-6}
\alpha_r(S_r)Q=0.
\end{align}

Now note that the the canonical injection $\mathfrak{I}^{k+m}\mathscr{F}\to\mathfrak{I}^k\mathscr{F}$ gives by passing to cohomology an $A$-homomorphism 
\begin{align*}
\nu_m:H^{p+1}(X,\mathfrak{I}^{k+m}\mathscr{F})\to H^{p+1}(X,\mathfrak{I}^k\mathscr{F})
\end{align*}
and, for any $x\in\mathfrak{I}^m$, we have evidently a factorization
\begin{align*}
\mu_{x,0}:H^{p+1}(X,\mathfrak{I}^k\mathscr{F})\stackrel{\mu_{x,m}}{\to}H^{p+1}(X,\mathfrak{I}^{k+m}\mathscr{F})\stackrel{\nu_m}{\to}H^{p+1}(X,\mathfrak{I}^k\mathscr{F})
\end{align*}
from which we conclude that, for any sub-$A$-module $P$ of $H^{p+1}(X,\mathfrak{I}^k\mathscr{F})$, we have, in the $S$-module $N$,
\begin{align}\label{scheme morphism proper comparison theorem affine case-7}
\nu_m(S_mP)=\alpha_m(S_m)P.
\end{align}
If we choose $m\geq r$ to be a multiple of $d$, then as $Q_{k+m}=S_mQ_k$ for $k\geq k_0$ (by our choice of $d$), we derive from (\ref{scheme morphism proper comparison theorem affine case-7}) and (\ref{scheme morphism proper comparison theorem affine case-6}) that $\nu_m(Q_{k+m})=\alpha_m(S_m)Q_k\sub\alpha_r(S_r)Q_k=0$ for $k\geq k_0$.\par
Consider now the commutative diagram
\[\begin{tikzcd}
H^p(X,\mathscr{F})\ar[r]\ar[d,equal]&H^p(X,\mathscr{F}_{k+m})\ar[r,"\partial"]\ar[d]&H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F})\ar[r]\ar[d]&H^{p+1}(X,\mathscr{F})\ar[d]\\
H^p(X,\mathscr{F})\ar[r]&H^p(X,\mathscr{F}_k)\ar[r,"\partial"]&H^{p+1}(X,\mathfrak{I}^{k+1}\mathscr{F})\ar[r]&H^{p+1}(X,\mathscr{F})
\end{tikzcd}\]
induced from the homomorphisms $\mathfrak{I}^{k+m+1}\mathscr{F}\to\mathfrak{I}^k\mathscr{F}$ and $\mathscr{F}_{k+m}\to\mathscr{F}_k$. From this, we conclude the following commutative diagram
\[\begin{tikzcd}
0\ar[r]&R_{k+m}\ar[r]\ar[d]&H\ar[r]\ar[d,equal]&H_{k+m}\ar[r]\ar[d]&Q_{k+m}\ar[r]\ar[d,"\nu_m"]&0\\
0\ar[r]&R_{k}\ar[r]&H\ar[r]&H_{k}\ar[r]&Q_{k}\ar[r]&0
\end{tikzcd}\]
whose rows are exact. As the last vertical arrow is zero for $k\geq k_0$, the image of $H_{k+m}$ in $H_k$ is contained in $\ker(H_k\to Q_k)=\im(H\to H_k)$, whence equals to $\im(H\to H_k)$ by the commutativity of the diagram. This image then equals to the image of $H_{k'}$ in $H_k$ for $k'\geq k+m$, so the projective system $(H_k)_{k\geq 0}$ satisfies the Mittag-Leffler condition. Moreover, for any affine open $U$ of $X$, we have $H^i(U,\mathscr{F}_k)=0$ for $i>0$, and the map $H^0(U,\mathscr{F}_{k+m})\to H^0(U,\mathscr{F}_k)$ is surjective for $m\geq 0$ (\cref{scheme affine associated sheaf exact}). We can then apply (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 13.3.1) to conclude that the canonical homomorphism $H^p(\widehat{X},\widehat{\mathscr{F}})\to\llim_kH^p(X,\mathscr{F}_k)$ is bijective for each $p\geq 0$.\par
Now since the projective system $(H/R_k)$ also satisfies the Mittag-Leffler condition, taking projective limit preserves the exactness of the sequence
\[\begin{tikzcd}
0\ar[r]&H/R_k\ar[r]&H_k\ar[r]&Q_k\ar[r]&0
\end{tikzcd}\]
As $\nu_m(Q_{k+m})=0$, we have $\llim_kQ_k=0$, so we obtain an isomorphism $\llim_k(H/R_k)\cong\llim_kH_k$. But the filtration $(R_k)$ of $H$ is $\mathfrak{I}$-good, so it defines the $\mathfrak{I}$-adic topology on $H$, and $\llim_k(H/R_k)$ is therefore the $\mathfrak{I}$-adic completion of $H$.
\end{proof}
\begin{proof}[\textbf{Proof of \cref{scheme morphism proper comparison theorem}}]
We now return to the proof of \cref{scheme morphism proper comparison theorem}. For any affine open $V$ of $Y$, since $R^pf_*(\mathscr{F})$ is coherent, we see that $\Gamma(V,\widehat{R^pf_*(\mathscr{F})})$ is equal to the $\mathfrak{I}$-adic completion of $\Gamma(V,R^pf_*(\mathscr{F}))$, and $\Gamma(V,\llim_kR^pf_*(\mathscr{F}_k))$ is equal to $\llim_k\Gamma(V,R^pf_*(\mathscr{F}_k))$ (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 3.2.6). The fact that $\varphi_p$ is a homeomorphism then follows from \cref{scheme morphism proper comparison theorem affine case} and \cref{scheme qcqs morphism direct image over affine char}. Similarly, we see that each $\psi_{p,V}$ is an isomorphism, so $\psi_p$ is an isomorphism by the definition of $R^p\hat{f}_*(\widehat{\mathscr{F}})$, and hence a homeomorphism by .
\end{proof}
\begin{corollary}\label{scheme morphism proper R^pf_* of completion char}
Under the hypotheses of \cref{scheme morphism proper comparison theorem}, for any affine open $V$ of $Y$, the canonical homomorphism
\[H^p(\widehat{X}\cap f^{-1}(V),\widehat{\mathscr{F}})\to\Gamma(\widehat{Y}\cap V,R^p\hat{f}_*(\widehat{\mathscr{F}}))\]
is bijective.
\end{corollary}
\begin{proof}
This follows from the isomorphism $\psi_p$ in \cref{scheme morphism proper comparison theorem} and \cref{scheme qcqs morphism direct image over affine char}.
\end{proof}
\begin{remark}
Let $f:X\to Y$ be a morphism of finite type between Noetherian schemes, and $\mathscr{F}$ be a coherent $\mathscr{O}_Y$-module with support proper over $Y$. Then we see from \cref{scheme morphism ft R^pf_* coherence if supp proper} that $R^pf_*(\mathscr{F})$ is coherent for $p\geq 0$. Moreover, we can also suppose that $\mathscr{F}=j_*(\mathscr{G})$, where $\mathscr{G}=j^*(\mathscr{F})$ is a coherent $\mathscr{O}_Z$-module, $Z$ being a closed subscheme of $X$ with underlying space $\supp(\mathscr{F})$, and $j:Z\to X$ is the canonical injection (\cref{scheme qc qcoh ft direct image of inverse prop}). If we set $\mathscr{G}_k=\mathscr{G}\otimes_{\mathscr{O}_Y}(\mathscr{O}_Y/\mathscr{I}^{k+1})$, then
\[\mathscr{G}_k=j^*(\mathscr{F}_k),\quad R^pf_*(\mathscr{F}_k)=R^p(f\circ j)_*(\mathscr{G}_k),\quad R^pf_*(\mathscr{F})=R^p(f\circ j)_*(\mathscr{G})\]
by \cref{scheme morphism affine R^pg_*(f_*) isomorphic to composition}. On the other hand, in view of \cref{scheme local Noe formal completion and pullback}, we also have
\[R^p\hat{f}(\widehat{\mathscr{F}})=R^p\widehat{(f\circ j)}_*(\mathscr{G}).\]
We can then apply \cref{scheme morphism proper comparison theorem} to conclude that the result of \cref{scheme morphism proper comparison theorem} is also valid for $\mathscr{F}$ and $f$.
\end{remark}
\begin{proposition}[\textbf{Formal Function Theorem}]\label{scheme morphism proper formal function theorem}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, and $\mathscr{F}$ be a coherent $\mathscr{O}_X$-module. Then for any $y\in Y$ and $p\geq 0$, the $\mathscr{O}_{Y,y}$-module $(R^pf_*(\mathscr{F}))_y$ is finitely generated, separated for the $\m_y$-adic topology, and we have a homeomorphism
\[\widehat{(R^pf_*(\mathscr{F}))_y}\stackrel{\sim}{\to}\llim_kH^p(f^{-1}(y),\mathscr{F}\otimes_{\mathscr{O}_{Y}}(\mathscr{O}_{Y,y}/\m_y^k))\]
where the left side is the $\m_y$-adic completion of $(R^pf_*(\mathscr{F}))_y$ and $f^{-1}(y)$ is considered as the underlying space of $X\times_Y\Spec(\mathscr{O}_{Y,y}/\m_y^k)$ (\cref{scheme inverse image of subscheme}).
\end{proposition}
\begin{proof}
As $\mathscr{O}_{Y,y}$ is a Noetherian local ring and $(R^pf_*(\mathscr{F}))_y$ is finitely generated by \cref{scheme morphism proper over Noe R^pf_* coherence}, the $\m_y$-adic topology on $(R^pf_*(\mathscr{F}))_y$ is separated (\cref{Zariski ring def}). The assertions therefore result from \cref{scheme morphism proper comparison theorem affine case} if $Y$ is Noetherian and the poinr $y$ is closed, since we can then replace $Y$ be an affine neighborhood of $y$ and put $Y'=\{y\}$, in view of (G, \Rmnum{2}, 4.9.1). In the general case, we set
\[Y_1=\Spec(\mathscr{O}_{Y,y}),\quad X_1=X\times_YY_1,\quad \mathscr{F}_1=\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{O}_{Y_1},\quad f_1=f\times 1_{Y_1}:X_1\to Y_1.\]
Then $Y_1$ is Noetherian, $f_1$ is proper, and $\mathscr{F}_1$ is coherent. Let $y_1$ be the unique closed point in $Y_1$; the proposition is then valid for $f_1$, $\mathscr{F}_1$ and $y_1$. We have $\mathscr{O}_{Y_1,y_1}=\mathscr{O}_{Y,y}$, $f_1^{-1}(y_1)=f^{-1}(y)$ (\cref{scheme morphism base change by local scheme prop}), and the schemes $X\times_Y\Spec(\mathscr{O}_{Y,y}/\m_y^k)$ and $X_1\times_{Y_1}\Spec(\mathscr{O}_{Y_1,y_1}/\m_{y_1}^k)$ are canonically idnetified (\cref{scheme base change transitive}). Moreover, $\mathscr{F}_1\otimes_{\mathscr{O}_{Y_1}}(\mathscr{O}_{Y_1,y_1}/\m_{y_1}^k)$ is identified with $\mathscr{F}\otimes_{\mathscr{O}_Y}(\mathscr{O}_{Y,y}/\m_y^k)$ (\cref{scheme sheaf base change transitivity}). It then remains to see that $R^p(f_1)_*(\mathscr{F}_1)$ is canonically isomorphic to $R^pf_*(\mathscr{F})\otimes_{\mathscr{O}_Y}\mathscr{O}_{Y_1}$, which follows from \cref{scheme morphism qcsp base change formula}, since the local morphism $\Spec(\mathscr{O}_{Y,y})\to Y$ is flat.
\end{proof}
\begin{corollary}\label{scheme morphism proper R^pf_* vanish at point if p>r}
Let $Y$ be a locally Noetherian scheme. $f:X\to Y$ be a proper morphism, $y$ be a point of $Y$, and $r$ be the dimension of $f^{-1}(y)$. Then for any coherent $\mathscr{O}_X$-module $\mathscr{F}$, the sheaf $R^pf_*(\mathscr{F})$ vanishes in a neighborhood of $y$ for $p>r$. 
\end{corollary}
\begin{proof}
In fact, if $p>r$, we then have $H^p(f^{-1}(y),\mathscr{F}\otimes(\mathscr{O}_{Y,y}/\m_y^k))=0$ (by Leray's vanishing theorem) for any $k$, so the $\m_y$-adic completion of $(R^pf_*(\mathscr{F}))_y$ is zero. As this topology is separated by \cref{scheme morphism proper formal function theorem}, we then have $(R^pf_*(\mathscr{F}))_y=0$, so the conclusion follows from \cref{sheaf of module ft local prop}. 
\end{proof}
\begin{corollary}
Under the hypothesis of \cref{scheme morphism proper formal function theorem}, we have a canonical homeomorphism
\[\widehat{(f_*(\mathscr{F}))_y}\stackrel{\sim}{\to}\llim_k\Gamma(f^{-1}(y),\mathscr{F}_y/\m_y^k\mathscr{F}_y).\]
\end{corollary}
\begin{remark}
Many applications of \cref{scheme morphism proper formal function theorem} use only the case $p=0$, in which case the right-hand side is equal to $\Gamma(\widehat{X},\widehat{\mathscr{F}})$, where $\widehat{X}$ is the formal completion of $X$ along $X_y$, and $\widehat{\mathscr{F}}=\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{O}_{\widehat{X}}$. In particular, if $\mathscr{F}=\mathscr{O}_X$, we have $\Gamma(\widehat{X},\mathscr{O}_{\widehat{X}})$, which is the ring of \textbf{formal-regular functions} (also called \textbf{holomorphic functions}) on $X$ along $X_y$.
\end{remark}
\subsection{Zariski's connectedness theorem}
\begin{theorem}[\textbf{Zariski's Connectednes Theorem}]\label{scheme morphism proper Zariski connected}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, and
\[\begin{tikzcd}
X\ar[r,"f'"]&Y'\ar[r,"g"]&Y
\end{tikzcd}\]
be the Stein factorization of $f$. Then $g$ is finite, $f'$ is proper, $f'_*(\mathscr{O}_X)$ is isomorphic to $\mathscr{O}_{Y'}$, and the fibers $f'^{-1}(y')$ are nonempty and connected for any $y'\in Y'$.
\end{theorem}
\begin{proof}
Let $\theta:\mathscr{O}_{Y'}\to f'_*(\mathscr{O}_X)$ be the morphism induced by $f'$. Then since $g_*(\mathscr{O}_{Y'})=\mathscr{A}(Y')$ and $f_*(\mathscr{O}_X)=\mathscr{A}(X)$, the homomorphism $g_*(\theta):g_*(\mathscr{O}_{Y'})\to g_*(f'_*(\mathscr{O}_X))=f_*(\mathscr{O}_X)$ is an isomorphism, so $\theta$ is an isomorphism by \cref{scheme S-affine isomorphism iff algebra iso}. Since $\mathscr{A}(X)$ is coherent by \cref{scheme morphism proper over Noe R^pf_* coherence}, we see $f'$ is finite, and it is proper by \cref{scheme morphism proper permanence prop}. It then remains to prove the following assertion: if $f:X\to Y$ is a proper morphism with $f_*(\mathscr{O}_X)\cong\mathscr{O}_Y$ and $Y$ being locally Noetherian, then the fibers $f^{-1}(y)$ are nonempty and connected for any $y\in Y$. To this end, we note that the hypothesis $f_*(\mathscr{O}_X)\cong\mathscr{O}_Y$ implies $(f_*(\mathscr{O}_X))_y\cong\mathscr{O}_{Y,y}\neq 0$ for any $y\in Y$, so $f$ is dominant and hence is surjective since $f$ is closed. We may then, as in \ref{scheme morphism proper formal function theorem}, reduce to the case where $y$ is closed in $Y$. Then $f^{-1}(y)$ is a Noetherian space with finitely many connected components, and is equal to the underlying space of the completion $\widehat{X}$ of $X$ along $f^{-1}(y)$. If $(Z_i)_{1\leq i\leq n}$ is its connected components, it is clear that $\Gamma(\widehat{X},\mathscr{O}_{\widehat{X}})$ is the direct product of the rings $\Gamma(Z_i,\mathscr{O}_{\widehat{X}})$, and each of them is nonzero since the unit section is nozero at any point of $\widehat{X}$. Now if we apply \cref{scheme morphism proper comparison theorem} to $\mathscr{F}=\mathscr{O}_X$, whose completion along $f^{-1}(y)$ is $\mathscr{O}_{\widehat{X}}$, then we see that $\Gamma(\widehat{X},\mathscr{O}_{\widehat{X}})$ is isomorphic to the $\m_y$-adic completion $\widehat{\mathscr{O}_{Y,y}}$ of the local ring $\mathscr{O}_{\widehat{X}}$; this is a local ring which can not be a direct product of nonzero proper rings, since otherwise there are elements $e_1,e_1$ such that $e_1+e_1=1$ and $e_1e_2=0$. But then $e_1,e_2$ are nonunits so are contained in the maximal ideal, and their sum cannot be $1$. We therefore have $n=1$, which proves our assertion.
\end{proof}
\begin{corollary}\label{scheme morphism proper f_*O_X=O_Y fiber connected}
Under the hypothesis of \cref{scheme morphism proper Zariski connected}, if $f_*(\mathscr{O}_X)\cong\mathscr{O}_Y$, then the fibers $f^{-1}(y)$ are connected and nonempty for any $y\in Y$.
\end{corollary}
\begin{corollary}\label{scheme morphism proper fiber correspond to maximal ideal}
Under the hypothesis of \cref{scheme morphism proper Zariski connected}, for any $y\in Y$, the set of connected components of the fiber $f^{-1}(y)$ is in one-to-one correspondence to the fiber $g^{-1}(y)$ (in other words, the set of maximal ideals of $(f_*(\mathscr{O}_X))_y$).
\end{corollary}
\begin{proof}
Since $Y'$ is finite over $Y$, it has finite fiber at $y$ (\cref{scheme morphism integral fiber finite discrete}). As $f^{-1}(y)=f'^{-1}(g^{-1}(y))$, the corollary then follows from \cref{scheme morphism proper Zariski connected}.
\end{proof}
\begin{remark}\label{scheme morphism proper fiber geometrically connected}
Let $k$ be an extension field of $\kappa(y)$. If the scheme $f^{-1}(y)\otimes_{\kappa(y)}k=X\times_Y\Spec(k)$ is connected, so is $f^{-1}(y)$, since it is the image under a projection. For a morphism $f:X\to Y$ of scheme and a point $y\in Y$, we say that the fiber $f^{-1}(y)$ is \textbf{geometrically connected} if for any field extension $k$ of $\kappa(y)$, the scheme $f^{-1}(y)\otimes_{\kappa(y)}k=X\times_Y\Spec(k)$ is connected. Under the hypothesis of \cref{scheme morphism proper f_*O_X=O_Y fiber connected}, we can then conclude that the fibers $f^{-1}(y)$ are in fact geometrically connected. To see this, observe that for any extension $k$ of $\kappa(y)$, there exists a Noetherian local ring $A$ and a local hommorphism $\varphi:\mathscr{O}_{Y,y}\to A$ which is flat and such that the residue field of $A$ is $\kappa(y)$-isomorphic to $k$ (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 10.3.1). Let $Y_1=\Spec(A)$, $h:Y_1\to Y$ be the local morphism corresponding to $\varphi$, sending the unique closed point $y_1$ of $Y_1$ to $y$, and put $X_1=X\times_YY_1$ and $f_1=f\times 1_{Y_1}$. Then $f_1$ is proper and $f_1^{-1}(y_1)$ is $\kappa(y_1)$-isomorphic to $X\times_Y\Spec(k)$. It then remains to show that $(f_1)_*(\mathscr{O}_{X_1})=\mathscr{O}_{Y_1}$. Now since $g$ is flat, we have $(f_1)_*(\mathscr{O}_{X_1})=h^*(f_*(\mathscr{O}_X))=h^*(\mathscr{O}_Y)=\mathscr{O}_Y$, in view of \cref{scheme morphism qcsp base change formula} applied to $p=0$.\par
In the general case of \cref{scheme morphism proper Zariski connected}, the same reasoning shows that we have $(f_1)_*(\mathscr{O}_{X_1})=h^*(g_*(\mathscr{O}_{Y'}))$ (\cref{scheme S-affine algebra under base change prop}), and the Stein factorization $f_1=g_1\circ f'_1$ of $f_1$ is such that we have the Cartesian square
\[\begin{tikzcd}
X_1\ar[r,"f_1'"]\ar[d]&Y'_1\ar[r,"g_1"]\ar[d]&Y_1\ar[d,"h"]\\
X\ar[r,"f'"]&Y'\ar[r,"g"]&Y
\end{tikzcd}\]
By the transitivity of fibers, we then see that the number of connected components of $f_1^{-1}(y_1)$ is, in view of \cref{scheme morphism proper fiber correspond to maximal ideal}, equal to the number of elements of $g_1^{-1}(y_1)=g^{-1}(y)\otimes_{\kappa(y)}k$. If we choose $k$ to be an algebraic closure of $\kappa(y)$, this is also the number of geometric points of $g^{-1}(y)$, or the sum of the separable degrees $[\kappa(y'_i):\kappa(y)]_s$, where $y'_i$ runs through the finite set $g^{-1}(y)$ (\cref{scheme finite over field count point in a.c. extension}). Note that the $\kappa(y'_i)$ are none other than the residual fields of the semi-local ring $(f_*(\mathscr{O}_X))_y$.
\end{remark}
\begin{proposition}\label{scheme integral morphism proper fiber component and maximal ideal of closure}
Let $X$ and $Y$ be two locally Noetherian integral schemes and $f:X\to Y$ be a proper and dominante morphism. For any $y\in Y$, the number of connected components of $f^{-1}(y)$ is also equal to the number of maximal ideals of the integral closure $\mathscr{O}_{Y,y}'$ of $\mathscr{O}_{Y,y}$ in the rational function field $K(X)$.
\end{proposition}
\begin{proof}
Recall that for any open subset $U$ of $Y$, $\Gamma(U,f_*(\mathscr{O}_X))=\Gamma(f^{-1}(U),\mathscr{O}_X)$ is the intersection of the local rings $\mathscr{O}_{X,x}$ for $x\in f^{-1}(U)$ (formula (\ref{scheme integral section is intersection of stalk})). We then conclude that the fiber $(f_*(\mathscr{O}_X))_y$ is a subring of $K(X)$ containing $\mathscr{O}_{Y,y}$. Moreover, as $f_*(\mathscr{O}_X)$ is a coherent $\mathscr{O}_X$-module, $(f_*(\mathscr{O}_X))_y$ is a finitely generated $\mathscr{O}_{Y,y}$-module, hence contained in $\mathscr{O}_{Y,y}'$. By \cref{integral ring extension going up prop}, any maximal ideal of the ring $A$ is the intersection of $A$ of a maximal ideal of $\mathscr{O}_{Y,y}'$, whence the proposition.
\end{proof}
A local ring $A$ is called \textbf{unibranch} if $A_{\red}$ is an integral ring and the integral closure of $A_{\red}$ is a local ring. We say a point $y$ of an integral scheme $Y$ is unibrach if the local ring $\mathscr{O}_{Y,y}$ is \textbf{unibranch} (this is the case if $Y$ is normal at $y$). Let $A$ be an integral local ring, and $K$ be its fractional field. For $A$ to be unibranch, it is then necessary and sufficient that any subring $R$ of $K$, containing $A$ and is a finite $A$-algebra, is a local ring. In fact, if $A'$ is the integral closure $A$, then any such ring is contaiend in $A'$ and any maximal ideal of $R$ is trace of a maximal ideal of $A'$ along $R$, so if $A'$ is local, so is $R$. Conversely, $A'$ is the inductive limit of the filtered family of such finite $A$-algebras $A_\alpha$ of $A'$, and if each $A_\alpha$ is a local ring, then for $A_\alpha\sub A_\beta$, the maximal ideal of $A_\alpha$ is the trace over $A_\alpha$ of the maximal ideal of $A_\beta$, so $A'$ is a local ring.\par
We also note that if the completion of a Noetherian local ring $A$ is integral (in this case $A$ is called \textbf{analytically integral}), then $A$ is unibranch. In fact, let $\m$ be the maximal ideal of $A$, $K$ be its fraction field, and $L$ be that of $\widehat{A}$; we then have $L=K\otimes_A\widehat{A}$. Let $B$ be a finite sub-$A$-algebra of $K$, then the subring $R$ of $L$ generated by $\widehat{A}$ and $B$ is isomorphic to $B\otimes_A\widehat{A}$; this is a finitely generated $\widehat{A}$-module, and is the $\m$-adic completion of $B$. As $B$ is a semi-local ring (\cref{Noe semilocal ring finite extension is Noe semilocal}) and this completion is integral, we conclude from \ref{Noe semilocal ring completion is Noe semilocal} that $B$ has a unique maximal ideal, whence our assertion.
\begin{corollary}\label{scheme integral morphism proper fiber and separable degree}
Under the hypotheses of \ref{scheme integral morphism proper fiber component and maximal ideal of closure}, suppose that $[K(Y):K(X)]_s=n$ and that $y\in Y$ is unibranch. Then the fiber $f^{-1}(y)$ has at most $n$ connected components. In particular, if $K(X)$ is purely inseparable over $K(X)$, then $f^{-1}(y)$ is connected.
\end{corollary}
\begin{proof}
Let $\mathscr{O}_{Y,y}'$ be the integral closure of $\mathscr{O}_{Y,y}$, then the integral closure $R$ of $\mathscr{O}_{Y,y}$ in $K(X)$ is also that of $\mathscr{O}_{Y,y}'$. If $\mathscr{O}_{Y,y}'$ is a local ring, then $R$ is a semi-local ring with at most $n$ maximal ideals (\cref{integrally closed finite algebra extension finite lying over}).  
\end{proof}
\begin{remark}\label{scheme integral morphism proper fiber geometrically connected at normal point}
\cref{scheme integral morphism proper fiber and separable degree} is essentially the "connectedness theorem" proved by Zariski for algebraic schemes. Note that in \cref{scheme integral morphism proper fiber and separable degree} if we suppose that $Y$ is normal at $y$, then the fiber $f^{-1}(y)$ is geometrically connected, since (with the notation of \cref{scheme morphism proper fiber geometrically connected}) $g^{-1}(y)$ then reduces to a point $y'$ and $\kappa(y')$ is purely inseparable over $\kappa(y)$.
\end{remark}
\begin{corollary}\label{scheme integral morphism proper f_*O_X=O_Y at normal point}
Under the hypothesis of \cref{scheme integral morphism proper fiber component and maximal ideal of closure}, suppose moreover that $K(Y)$ is algebraically closed in $K(X)$, and let $y$ be a normal point of $Y$. Then $f^{-1}(y)$ is geometrically connected, and there exists an open neighborhood $U$ of $y$ such that $f_*(\mathscr{O}_X|_{f^{-1}(U)})$ is isomorphic to $\mathscr{O}_Y|_U$. In particular, if we suppose that $Y$ is normal (and $K(Y)$ is algebraically closed in $K(X)$), then $f_*(\mathscr{O}_X)$ is isomorphic to $\mathscr{O}_Y$.
\end{corollary}
\begin{proof}
The first assertion concerning $f^{-1}(y)$ is a particular case of \cref{scheme integral morphism proper fiber geometrically connected at normal point}. If $f:X\stackrel{f'}{\to}Y'\stackrel{g}{\to}Y$ is the Stein factorization, then $g^{-1}(y)$ is reduced to a single point $y'$. Moreover, we have $\mathscr{O}_{Y,y}\sub\mathscr{O}_{Y',y'}=(f_*(\mathscr{O}_X))_y\sub K(X)$, and as $\mathscr{O}_{Y',y'}$ is finite over $\mathscr{O}_{Y,y}$ (and a fortiori over $K(Y)$), it is contained in $K(Y)$ by our hypothesis; as $y$ is normal, we necessarily have $\mathscr{O}_{Y',y'}=\mathscr{O}_{Y,y}$. We then conclude that $g$ is a local isomorphism at the point $y'$ (\cref{scheme morphism local ft fp local immersion iso iff}), which completes the proof of the first part of the corollary. There seconds one follows from the first, because the additional assumption entails that $g$ is an isomorphism in the neighborhood of any point of $Y'$, whence an isomorphism.
\end{proof}
\begin{proposition}\label{scheme Proj of associated graded ring connected}
Let $A$ be a unibranch Noethreian local ring, $\a$ be a defining ideal of $A$, $A_0=A/\a$, and $S=\gr_{\a}(A)$. Then $\Proj(S)$ is a connected $A_0$-scheme.
\end{proposition}
\begin{proof}
Let $\m$ be the maximal ideal of $A$; $Y=\Spec(A)$ is an integral scheme with unique closed point $y$. By hypothesis, we have $\m^k\sub\a\sub\m$ for an integer $k$, so $V(\a)=\{\m\}$. Let $S'=\bigoplus_{n\geq 0}\a^n$, and $X=\Proj(S')$, which is the blow up $Y$-scheme relative to $\a$. Then $X$ is integral and the structural morphism $f:X\to Y$ is birational and projective (\cref{scheme integral blow up scheme prop}). \cref{scheme integral morphism proper fiber and separable degree} is then applicable and shows that $f^{-1}(y)$ is connected. But $f^{-1}(y)$ is the underlying space of $\Proj(S'\otimes_AA_0)$ (\cref{scheme Proj base ring change prop} and \cref{scheme morphism base change by local scheme prop}), and as $S'\otimes_AA_0=S$ by definition, the proposition follows.
\end{proof}
\subsection{Zariski's "Main Theorem"}
\begin{proposition}\label{scheme proper over local Noe isolated in fiber open prop}
Let $Y$ be a locally Noetherian scheme and $f:X\to Y$ be a proper morphism. Let $X'$ be the set of points $x\in X$ which is isolated in the fiber $f^{-1}(f(x))$. Then $X'$ is open in $X$, and if $f=g\circ f'$ is the Satein factorization of $f$, the restriction of $f'$ to $X'$ is an isomorphism from $X'$ onto an open subscheme of $Y'$, and we have $X'=f'^{-1}(U)$. 
\end{proposition}
\begin{proof}
As $g^{-1}(f(x))$ is finite and discrete (\cref{scheme morphism integral fiber finite discrete}), for $x$ to be isolated in $f^{-1}(f(x))$, it is necessary and sufficient that it is isolated in $f'^{-1}(f'(x))$. We may then assume that $f'=f$, so $f_*(\mathscr{O}_X)=\mathscr{O}_Y$. Then, if $x\in X'$, the fiber $f^{-1}(f(x))$ is connected by \cref{scheme morphism proper f_*O_X=O_Y fiber connected}, and is necessarily reduced to the point $x$. As $f$ is closed, for any open neighborhood $V$ of $x$, $f(X-V)$ is closed in $Y$ and does not contain $y=f(x)$, since $f^{-1}(y)=\{x\}$; if $U$ is the complement of $f(X-V)$ in $Y$, then we have $f^{-1}(U)\sub V$, so we conclude that the inverse images under $f$ of a fundamental system of open neighborhoods of $y$ form a fundamental system of open neighborhoods of $x$. The hypothesis $f_*(\mathscr{O}_X)=\mathscr{O}_Y$ then implies that the homomorphism $f^{\#}_y:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ is an isomorphism, so by \cref{scheme morphism local ft fp local immersion iso iff} there exists an open neighborhood $V$ of $x$ and an open neighborhood $U$ of $y$ such that $f^{-1}(U)\sub V$ and the restriction $f|_V:V\to U$ is an isomorphism. Moreover, by the remarks above, we may also assume that $V=f^{-1}(U)$, so that $V\sub X'$, which completes the proof. 
\end{proof}
\begin{proposition}\label{scheme morphism over local Noe finite iff affine proper}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is finite.
\item[(\rmnum{2})] $f$ is affine and proper.
\item[(\rmnum{3})] $f$ is proper, and for any $y\in Y$, the fiber $f^{-1}(y)$ is a finite set.
\end{enumerate}
\end{proposition}
\begin{proof}
We see that (\rmnum{1})$\Rightarrow$(\rmnum{2}) by \cref{scheme morphism finite is projective}. If $f$ is proper and affine, then so is the induced morphism $f^{-1}(y)\to\Spec(\kappa(y))$ (\cref{scheme morphism proper permanence prop} and \cref{scheme affine morphism permanence prop}), and the finiteness theorem \cref{scheme morphism proper over Noe R^pf_* coherence}, applied to the structural sheaf of $f^{-1}(y)$, shows that $f^{-1}(y)=\Spec(A)$, where $A$ is a finite dimensional $\kappa(y)$-algebra. Then $f^{-1}(y)$ is a finite $\kappa(y)$-scheme, so is a finite set (\cref{scheme algebraic Artinian iff}), and we see that (\rmnum{2})$\Rightarrow$(\rmnum{3}). Finally, as $f^{-1}(y)$ is an algebraic scheme, the hypothesis that $f^{-1}(y)$ is a finite set implies that it is discrete (\cref{scheme algebraic Artinian iff}). With the notations of \cref{scheme proper over local Noe isolated in fiber open prop}, we then have $X'=X$, and $f':X'\to Y'$ is an isomorphism; as $g$ is a finite morphism, we then conclude that (\rmnum{3})$\Rightarrow$(\rmnum{1}).
\end{proof}
\begin{theorem}[\textbf{Zariski's "Main Theorem"}]\label{scheme quasi-projective over Noe ZMT}
Let $Y$ be a Noetherian scheme, $f:X\to Y$ be a quasi-projective morphism, and $X'$ be the set of points $x\in X$ that is isolated in the fiber $f^{-1}(f(x))$. Then $X'$ is an open subset of $X$, and the open subscheme $X'$ of $X$ is isomorphic via $f$ to an open subscheme $Y'$ of $Y$ that is finite over $Y$.
\end{theorem}
\begin{proof}
The hypotheses implies that there exists a projective $Y$-scheme $P$ such that $X$ is $Y$-isomorphic to an open subscheme of $P$. We then reduce to prove the theorem if $f$ is a projective morphism, hence proper (\cref{scheme projective and quasi-projective}), and this follows from \cref{scheme proper over local Noe isolated in fiber open prop}.
\end{proof}
\begin{remark}\label{scheme quasi-projective over Noe ZMT reduced irreducible condition}
If $X$ is reduced (resp. irreducible and $X'$ is nonempty), we can suppose, in the situation of \cref{scheme quasi-projective over Noe ZMT}, that $Y'$ is reduced (resp. irreducible). In fact, we can replace $Y'$ by the scheme-theoretic closure $\widebar{X'}$ of $X'$ in $Y'$, and it is reduced if $X'$ is (\cref{scheme theoretic image exist if}). If $X'$ is nonempty, then it is irreducible if $X$ is, and then $\widebar{X'}$ is also irreducible.
\end{remark}
\begin{corollary}\label{scheme morphism ft isolated point nbhd finite}
Let $Y$ be a locally Noetherian and separated scheme, $f:X\to Y$ be morphism of finite type, and $x\in X$ be a point that is isolated in $f^{-1}(f(x))$. then there exists an open neighborhood $U$ of $x$ that is isomorphic to an open subscheme of $Y$ that is finite over $Y$.
\end{corollary}
\begin{proof}
Let $y=f(x)$, $U$ be an affine open neighborhood of $Y$, $V$ an affine open neighborhood of $x$ contained in $f^{-1}(U)$. As $Y$ is separated, the injection $U\to Y$ is affine (\cref{scheme morphism affine to sp is affine}), and as $V$ is affine over $U$ (again by \cref{scheme morphism affine to sp is affine}), the restriction of $f$ to $V$ is an affine morphism $V\to Y$ (\cref{scheme affine morphism permanence prop}(\rmnum{2})); a fortiori, this restriction is quasi-projective since it is of finite type (\cref{scheme morphism ft permanence prop}(\rmnum{1}) and \cref{scheme morphism quasi-projective permanence prop}). It then suffices to apply \cref{scheme quasi-projective over Noe ZMT}.
\end{proof}
\begin{corollary}\label{scheme affine ZMT}
Let $A$ be a Noetherian ring, $B$ be an $A$-algebra of finite type, $\mathfrak{P}$ be a prime ideal of $B$, $\p$ be its contraction in $A$. Suppose that $\mathfrak{P}$ is both maximal and minimal among prime ideals of $B$ with contraction $\p$, then there exists $g\in B-\mathfrak{P}$, a finite $A$-algebra $A'$ and an element $f'\in A'$ such that the $A$-algebra $B_g$ and $A'_{f'}$ are isomorphic.
\end{corollary}
\begin{proof}
It suffices to apply \cref{scheme morphism ft isolated point nbhd finite} to $Y=\Spec(A)$ and $X=\Spec(B)$, since the hypothesis on $\mathfrak{P}$ signified that it is isolated in the fiber.
\end{proof}
\begin{corollary}\label{scheme affine local ZMT}
Let $A$ be a Noetherian local ring, $B$ be an $A$-algebra of finite type, $\mathfrak{M}$ be a maximal ideal of $B$ whose contraction in $A$ is the maximal ideal $\m$ of $A$. Suppose that $\mathfrak{M}$ and minimal among prime ideals of $B$ with contraction $\m$. Then there exists a finite $A$-algebra $A'$ and a maximal ideal $\m'$ of $A'$ (whose contraction is $\m$) such that $B_{\mathfrak{M}}$ is isomorphic to the $A$-algebra $A'_{\m'}$.
\end{corollary}
\begin{proof}
This follows from \cref{scheme affine ZMT} by taking stalks at $\m$ and $\mathfrak{M}$.
\end{proof}
\begin{corollary}\label{scheme affine local integrally closed ZMT}
Under the hypothesis of \cref{scheme affine local ZMT}, suppose that $A$ and $B$ are integral with the same fraction field $K$. Then, if $A$ is integrally closed, we have $B=A$.
\end{corollary}
\begin{proof}
By \cref{scheme quasi-projective over Noe ZMT reduced irreducible condition} we can suppose that $A'$ is integral with fraction field $K$. The hypothesis over $A$ implies that $A'=A$, so $B_{\mathfrak{M}}=A$. As $A\sub B\sub B_{\mathfrak{M}}$, we conclude that $A=B$.
\end{proof}
\begin{corollary}\label{scheme morphism spft birational finite fiber open immersion}
Let $Y$ be a locally Noetherian integral scheme, $f:X\to Y$ be a separated morphism that is of finite type and birational. Suppose that $Y$ is normal and the fibers $f^{-1}(y)$ are finite for $y\in Y$. Then $f$ is an open immersion; if moreover $f$ is closed, then it is an isomorphic.
\end{corollary}
\begin{proof}
Let $x\in X$ and put $y=f(x)$. As $f^{-1}(y)$ is an algebraic scheme over $\kappa(y)$, the hypothesis that it is finite implies that it is discrete (\cref{scheme algebraic Artinian iff}); moreover $\mathscr{O}_{Y,y}$ is integrally closed and $\mathscr{O}_{X,x}$ and $\mathscr{O}_{Y,y}$ have the same fraction field. We can then apply \cref{scheme affine local integrally closed ZMT}, and the homomorphism $f^{\sharp}_y:\mathscr{O}_{Y,y}\to\mathscr{O}_{X,x}$ is bijective. We then conclude that $f$ is a local isomorphism.
\end{proof}
\begin{proposition}\label{scheme morphism local ft isolated in fiber open}
Let $Y$ be a locally Noetherian scheme and $f:X\to Y$ be a morphism locally of finite type. Then the set $X'$ of $x\in X$ isolated in the fiber $f^{-1}(f(x))$ is open in $X$.
\end{proposition}
\begin{proof}
This question is local over $X$ and $Y$, so we can assume that $X$ and $Y$ are affine Noetherian; $f$ is then affine and of finite type, hence quasi-projective (\cref{scheme morphism quasi-projective permanence prop}(\rmnum{1})), and it suffices to apply \cref{scheme quasi-projective over Noe ZMT}.
\end{proof}
\begin{corollary}\label{scheme morphism proper fiber isolated restriction finite}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism. Then the set $U$ of points $y\in Y$ such that $f^{-1}(y)$ is discrete is open in $Y$, and the restriction morphism $f|_{f^{-1}(U)}:f^{-1}(U)\to U$ is finite. In particular, a proper and quasi-finite morphism is finite.
\end{corollary}
\begin{proof}
In fact, the complement of $U$ in $Y$ is the image of $X-X'$ under $f$, which is closed in $X$ by \cref{scheme morphism local ft isolated in fiber open}. As $f$ is a closed map, $U$ is then open in $Y$. Moreover, it follows from \cref{scheme algebraic Artinian iff} that $f^{-1}(y)$ is finite for any $y\in U$; as the restriction morphism $f|_{f^{-1}(U)}:f^{-1}(U)\to U$ is proper (\cref{scheme morphism proper permanence prop}), it is finite in view of \cref{scheme morphism over local Noe finite iff affine proper}.
\end{proof}
\section{Covariant functors on \texorpdfstring{$\mathbf{Mod}(A)$}{A} and base change}
Let $f:X\to Y$ be a morphism of schemes and $\mathscr{F}$ be a quasi-coherent $\mathscr{O}_X$-module. In the study of the higher direct images $R^pf_*(\mathscr{F})$, the following problem is proposed: given a base change morphism $g:Y'\to Y$, we put $X'=X\times_YY'$, $f'=f_{(Y)}$ and $\mathscr{F}'=\mathscr{F}\otimes_Y\mathscr{O}_{Y'}$, so that the following diagram commutes:
\[\begin{tikzcd}
X'\ar[r,"f'"]\ar[d,swap,"g'"]&Y'\ar[d,"g"]\\
X\ar[r,"f"]&Y
\end{tikzcd}\]
Our purpose is to understanding the higher direct images $R^pf'_*(\mathscr{F}')$ (assume giving the information of $R^pf_*(\mathscr{F})$), which (as we will see) can be reduced to considering the behaviour of $R^pf_*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{G})$ for quasi-coherent $\mathscr{O}_Y$-modules $\mathscr{G}$, or that of the functor $R^pf_*(\mathscr{F}\otimes_{\mathscr{O}_Y}(-))$. If $\mathscr{F}$ is flat over $Y$, the functor $\mathscr{F}\otimes_{\mathscr{O}_Y}(-)$ is exact so the composition $R^\bullet f_*(\mathscr{F}\otimes_{\mathscr{O}_Y}(-))$ is a cohomological functor. But in general this is not true, and we want to replace $R^\bullet f_*(\mathscr{F}\otimes_{\mathscr{O}_Y}(-))$ by some good bahaved cohomological functor. We shall see in (\cite{EGA3}, 6.10) that this new cohomological functor $\mathscr{G}\mapsto \mathscr{T}^\bullet(\mathscr{G})$ is defined locally (over $Y$) by $H^\bullet(\mathscr{L}^\bullet\otimes_{Y}\mathscr{G})$, where $\mathscr{L}^\bullet$ is a complex of locally free $\mathscr{O}_Y$-modules (uniquely determined up to homotopy). It is then interesting to forget about $\mathscr{T}^\bullet$ and consider the properties of functors of the form $H^\bullet(\mathscr{L}^\bullet\otimes_Y(-))$ (with appropriate finiteness conditions on $\mathscr{L}^\bullet$ of $H^i(\mathscr{L}^\bullet)$). The most important properties of these functors concern the exactness of the component $\mathscr{T}^i$ of $\mathscr{T}^\bullet$, and we will give various criterions for establishing such properties. As an application, we will obtain conditions allowing us to confirm that the functor $R^pf_*(\mathscr{F}\otimes_{\mathscr{O}_Y}(-))$ is exact (what we will express by saying that $\mathscr{F}$ is \textit{cohomologically flat} on $Y$ in dimension $p$). Another important property for the components $\mathscr{T}^i$ of $\mathscr{T}^\bullet$ is the semi-continuous property of the function $y\mapsto\dim_{\kappa(y)}(\mathscr{T}^i(\kappa(y)))$. If $\mathscr{T}^i$ is exact, this property is replaced by a continuity (hence locally constant) property, the converse being true according to Grauert when $Y$ is reduced.
\subsection{Functor on \texorpdfstring{$\mathbf{Mod}(A)$}{A}}
Let $A$ be a ring (not necessarily commutative) and $\mathbf{Mod}(A)$ be the category of left $A$-modules. Consider an additive covariant functor $T:\mathbf{Mod}(A)\to\mathbf{Ab}$, and let $M$ be a $(A,A)$-bimodule. Then the abelian group $T(M)$ is naturally endowed with a right $A$-module structure. In fact, for any $a\in A$, let $h_{a,M}$ be the endomorphism $x\mapsto xa$ induced on $M$. Then by hypothesis, $T(h_{a,M})$ is an endomorphism of $T(M)$. Moreover, since $T$ is additive, for $a,b\in A$ we have
\[T(h_{ab})=T(h_b\circ h_a)=T(h_b)\circ T(h_a),\quad T(h_{a+b})=T(h_a)+T(h_b)\]
so the map $(a,y)\mapsto T(h_a)(y)$ is a right $A$-module structure on $T(M)$. In particular, $T(A)$ is a right $A$-module.\par
If $A$ is a commutative ring, then for any $A$-module $M$, $T(M)$ is also an $A$-module. If $u:M\to N$ is a homomorphism of $A$-modules, we have, for $a\in A$, $u\circ h_a=h_{a,N}\circ u$, so $T(u)\circ T(h_{a,M})=T(h_{a,N})\circ T(u)$, which means $T(u):T(M)\to T(N)$ is an $A$-homomorphism. We then say that $T$ can be considered as a covariant endofunctor on $\mathbf{Mod}(A)$. More precisely, we define an equivalence from the category of additive covariant functors $\mathbf{Mod}(A)\to\mathbf{Ab}$ to the category of $A$-linear covariant functors $\mathbf{Mod}(A)\to\mathbf{Mod}(A)$, given by $T(h_{a,M})=h_{a,T(M)}$ for $a\in A$. As the forgetful functor $\mathbf{Mod}(A)\to\mathbf{Ab}$ is exact and faithful, the exactness of these functors are therefore equivalent.\par
Assume that $A$ is commutative and let $B$ be an $A$-algebra (not necessarily commutative) and $\rho:A\to B$ be the ring homomorphism. Then we have an additive covariant functor $\rho^*:N\mapsto\rho^*(N)$ from the category of $B$-modules to that of $A$-modules. By composition with $T$, we then deduce a functor $T_{(B)}:\mathbf{Mod}(B)\to\mathbf{Ab}$, which is evidently additive and covariant, and called the \textbf{extension of scalar} of $T$ by $B$. It is clear that the extension of scalars is functorial and additive on $T$. Moreover, if $T$ commutes with inductive limits or direct sums (resp. is left exact, resp. is right exact), so is the functor $T_{(B)}$, since the functor $\rho^*$ is exact and commutes with inductive limits and direct sums.\par
Suppose that $A$ is commutative and $T$ commutes with inductive limits. Then for any multiplicative subset $S$ of $A$ and any $A$-module $M$, we have a canonical isomorphism of $A$-modules
\begin{align}\label{functor on Mod commute rlim localization-1}
T(S^{-1}M)\stackrel{\sim}{\to}S^{-1}T(M).
\end{align}
In fact, suppose first that $S$ is of the form $f^n$ for $f\in A$. Then we see that $M_f=\rlim M_n$, where $(M_n,\varphi_{nm})$ is the inductive system of $A$-module $M_n=M$ with $\varphi_{nm}=h_{f^{n-m}}$, so the isomorphism (\ref{functor on Mod commute rlim localization-1}) follows from the hypothesis on $T$. In the general case, we have $S^{-1}M=\rlim_{f\in S}M_f$, so we can similarly conclude the isomorphism. Moreover, the functoriality of (\ref{functor on Mod commute rlim localization-1}) shows that it is an isomorphism of $S^{-1}A$-modules, and we can then write
\begin{align}\label{functor on Mod commute rlim localization-2}
T_{(S^{-1}A)}(S^{-1}M)=S^{-1}T(M)=T(S^{-1}M).
\end{align}
If $S=A-\p$ is the complement of a prime ideal $\p$ of $A$, we then write $T_\p$ instead of $T_{(A_\p)}$.
\begin{proposition}\label{functor on Mod commute rlim exact iff localization}
Under the above hypothesis, if $T_\m$ is left exact (resp. right exact) for any maximal ideal $\m$ of $A$, then $T$ is left exact (resp. right exact).
\end{proposition}
\begin{proof}
This is a direct concequence of that fact that two submodules $N,P$ of an $A$-module $M$ are equal if and only if $N_\m=P_\m$ for any maximal ideal $\m$ of $A$ (\cref{localization submodule iff submodule of localization}).
\end{proof}
\subsection{Characterization of tensor product functor}
Let $A$ be a ring (not necessarily commutative) and $T:\mathbf{Mod}(A)\to\mathbf{Ab}$ be an additive covariant functor. For any left $A$-module $M$, we note that $\Hom_{\Z}(T(A),T(M))$ is canonically endowed with a left $A$-module structure such that $(a\cdot u)(y)=u(ya)$ for $y\in T(A)$, $a\in A$, $v\in\Hom_{\Z}(T(A),T(M))$. We define a homomorphism $\tilde{t}_M$ from $M$ into $\Hom_{\Z}(T(A),T(M))$ to be the composition
\[\begin{tikzcd}
M\ar[r,"\sim"]&\Hom_A(A,M)\ar[r,"T"]&\Hom_{\Z}(T(A),T(M))
\end{tikzcd}\]
where the first arrow is the canonical isomorphism $x\mapsto\theta_x$, given by $\theta_x(\xi)=\xi x$ for $\xi\in A$ and $x\in M$. Note that we have $\theta_{ax}=\theta_x\circ h_a$, so $T(\theta_{ax})=T(\theta_x\circ h_a)=T(\theta_x)\circ T(h_a)$ and for $y\in T(A)$,
\[T(\theta_{ax})(y)=T(\theta_x)(T(h_a)(y))=T(\theta_x)(ya).\]
We therefore conclude that $\tilde{t}_M$ induces a homomorphism
\begin{align}\label{functor on Mod homomorphism on tensor-1}
t_M:T(A)\otimes_AM\to T(M)
\end{align}
such that $t_M(a\otimes x)=T(\theta_x)(a)$ for $a\in T(A)$, $x\in M$. It is immediate to verify that $t_M$ is functorial on $M$, which means for any homomorphism $u:M\to N$ of left $A$-modules, the diagram
\begin{equation}\label{functor on Mod homomorphism on tensor-2}
\begin{tikzcd}
T(A)\otimes_AM\ar[r,"t_M"]\ar[d,swap,"1\otimes u"]&T(M)\ar[d,"T(u)"]\\
T(A)\otimes_AM\ar[r,"t_N"]&T(N)
\end{tikzcd}
\end{equation}
is commutative.\par
More generally, if $A$ is commutative, then for any $A$-module $N$ we can define a canonical homomorphism
\begin{align}\label{functor on Mod homomorphism on tensor-3}
t_{N,M}:T(N)\otimes_AM\to T(N\otimes_AM).
\end{align}
For this, it suffices to replace $\theta_x$ by the $A$-module homomorphism $N\to N\otimes_AM$, which sends $y\in N$ to $y\otimes x$. It is clear that this functor is functorial on $M$ and $N$. In particular, if $B$ is an $A$-algebra (not necessairly commutative), we have a functorial homomorphism
\begin{align}\label{functor on Mod homomorphism on tensor-4}
T(M)_{(B)}=T(M)\otimes_AB\to T_{(B)}(M_{(B)})
\end{align}
which is a homomorphism of $B$-modules. Moreover, the following diagram is commutative
\[\begin{tikzcd}
T(A)\otimes_AM\ar[r,"t_M"]\ar[d]&T(M)\ar[d]\\
T_{(B)}(B)\otimes_BM_{(B)}\ar[r,"t_{M_{(B)}}"]&T_{(B)}(M_{(B)})
\end{tikzcd}\]
where the right vertical arrow is the composition
\[T(M)\to T(M)\otimes_AB\to T(M\otimes_AB)=T_{(B)}(M_{(B)})\]
and the left vertical arrow is the homomorphism
\[T(A)\otimes_AM\to T_{(B)}(B)\otimes_B(B\otimes_AM)=T_{(B)}(B)\otimes_AM,\]
where $T(A)\to T_{(B)}(B)=T(B)$ is the homomorphism induced by $A\to B$.
\begin{lemma}\label{functor on Mod homomorphism on tensor isomorphism on free if}
If $T:\mathbf{Mod}(A)\to\mathbf{Ab}$ is a covariant additive functor which commutes with direct sums, the canonical homomorphism $t_L$ is an isomorphism for any free $A$-module $L$.  
\end{lemma} 
\begin{proof}
In fact, we can write $L=\bigoplus_iL_i$, where $L_i$ are isomorphic to $A$ for each $i\in I$. The definition of $t_L$ shows that $t_L=\bigoplus_it_{L_i}$, since
\[T:\Hom_A(A,L)\to\Hom_{\Z}(T(A),T(L))\]
is the direct sum of the $\Z$-linear maps $T_i:\Hom_A(A,L_i)\to\Hom_{\Z}(T(A),T(L_i))$ in view of the hypothesis on $T$. We are then reduced to the case where $L=A$, and $t_A$ is none other than the canonical isomorphism $T(A)\otimes_AA\cong T(A)$ for the $A$-module $T(A)$.
\end{proof}
\begin{lemma}\label{functor right exact if quotient by right exact}
Let $\mathcal{A}$ and $\mathcal{B}$ be abelian categories, $F,G$ be covariant additive functors from $\mathcal{A}$ to $\mathcal{B}$, and $\gamma:F\Rightarrow G$ be a morphism such that, for any object $A\in\mathcal{A}$, $\gamma_A:F(A)\to G(A)$ is an epimorphism. Then, if $F$ is right exact and $G$ is semi-exact, $G$ is right exact.
\end{lemma}
\begin{proof}
Since $G$ is semi-exact, it suffices to prove that for any epimorphism $v:A\to B$ in $\mathcal{A}$, $G(v):G(A)\to G(B)$ is an epimorphism. Now, we have a commutative diagram
\[\begin{tikzcd}
F(A)\ar[r,"F(v)"]\ar[d,swap,"\gamma_A"]&F(B)\ar[d,"\gamma_B"]\\
G(A)\ar[r,"G(v)"]&G(B)
\end{tikzcd}\]
in which $F(v)$, $\gamma_A$, $\gamma_B$ are epimorphisms. It then follows from $G(v)$ is an epimorphism.
\end{proof}
\begin{proposition}\label{functor on Mod isomorphic to tensor iff}
Let $T:\mathbf{Mod}(A)\to\mathbf{Ab}$ be a covariant additive functor which commutes with direct sums. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $T$ is right exact;
\item[(\rmnum{2})] the canonical homomorphism $t_M$ is an isomorphism for any $A$-module $M$;
\item[(\rmnum{2}')] $T$ is semi-exact and the homomorphism $t_M$ is surjective for any $A$-module $M$;
\item[(\rmnum{3})] $T$ is isomorphic to the functor $N\otimes_A(-)$, where $N$ is an $A$-module.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{2}) implies (\rmnum{3}) and (\rmnum{3}) implies (\rmnum{1}), since we can then take $N=T(A)$. We now prove that (\rmnum{1})$\Rightarrow$(\rmnum{2}); for this, put $F(M)=T(A)\otimes_AM$ for any $A$-module $M$. There exists an exact sequence $P\to L\to M\to 0$, where $P$ and $L$ are free $A$-modules. As $T$ and $F$ are right exact, we then have a commutative diagram
\[\begin{tikzcd}
F(P)\ar[r]\ar[d,"t_P"]&F(L)\ar[r]\ar[d,"t_L"]&F(M)\ar[r]\ar[d,"t_M"]&0\\
T(P)\ar[r]&T(L)\ar[r]&T(M)\ar[r]&0
\end{tikzcd}\]
with exact rows. As $t_P$ and $t_L$ are isomorphism by \cref{functor on Mod homomorphism on tensor isomorphism on free if}, so is $t_M$ by five lemma. Finally, it is clear that (\rmnum{2}) implies (\rmnum{2}'), and to see that (\rmnum{2}') implies (\rmnum{2}), it suffices to apply \cref{functor right exact if quotient by right exact}.
\end{proof}
\begin{remark}
For any right $A$-module $N$, let $T_N(M)=N\otimes_AM$, where $M$ is a left $A$-module. Then $T_N$ is a right exact covariant additive functor from $\mathbf{Mod}(A)$ to $\mathbf{Ab}$, and commutes with direct sums. If we canonically identify $T_N(A)$ with $N$, then the corresponding homomorphism (\ref{functor on Mod homomorphism on tensor-3}) is the identity. We therefore conclude that the right $A$-module $N$ in \cref{functor on Mod isomorphic to tensor iff} is uniquely determined up to isomorphisms, and is isomorphic to $T(A)$. In other words, the morphisms $T\mapsto T(A)$ and $N\mapsto T_N$ define a equivalence from the category of covariant additive functors which are right exact and commute with direct sums to the category of right $A$-modules.
\end{remark}
\begin{proposition}\label{functor on Mod Artian isomorphic to tensor iff}
Let $A$ be a left Artinian ring with Jacobson radical $\m$ such that $A/\m$ is a field $k$. Let $T:\mathbf{Mod}(A)\to\mathbf{Ab}$ be a covariant additive functor which commutes with direct sums. Then the conditions of \cref{functor on Mod isomorphic to tensor iff} are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{5})] $T$ is semi-exact and the homomorphism $T(\eps):T(A)\to T(k)$ induced by the canonical homomorphism $\eps:A\to k$ is surjective.
\end{enumerate}
\end{proposition}
\subsection{Exactness of cohomological functors on \texorpdfstring{$\mathbf{Mod}(A)$}{A}}
\begin{proposition}\label{cohomology functor on Mod T^p right exact iff}
Let $A$ be a ring (not necessarily commutative) and $T^\bullet$ be a covariant cohomological functor from $\mathbf{Mod}(A)$ to $\mathbf{Ab}$ which commutes with direct sums. Let $p$ be an integer such that $T^p$ and $T^{p-1}$ are defined. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $T^p$ is right exact;
\item[(\rmnum{2})] $T^{p+1}$ is left exact;
\item[(\rmnum{3})] for any left $A$-module $M$, the canonical homomorphism 
\begin{align}\label{cohomology functor on Mod T^p right exact iff-1}
T^p(A)\otimes_AM\to T^p(M)
\end{align}
is an isomorphism.
\item[(\rmnum{4})] for any $A$-module $M$, the homomorphism (\ref{cohomology functor on Mod T^p right exact iff-1}) is an epimorphism;
\item[(\rmnum{5})] $T^p$ is isomorphic to a functor $N\otimes_A(-)$, where $N$ is a (uniqely determined) right $A$-module and isomorphic to $T^p(A)$.
\end{enumerate}
If the conditions of \cref{functor on Mod Artian isomorphic to tensor iff} are satisfied, then these conditions are equivalent to:
\begin{enumerate}
\item[(\rmnum{6})] the canonical homomorphism $T^p(\eps):T^p(A)\to T^p(k)$ is an epimorphism.
\end{enumerate}
\end{proposition}
\begin{proof}
By the definition of cohomological functors, $T^i$ are semi-exact for any $i$ such that $T^i$ is defined. Moreover, for any exact sequence
\[\begin{tikzcd}
0\ar[r]&A\ar[r,"u"]&B\ar[r,"v"]&C\ar[r]&0
\end{tikzcd}\]
we have $\ker(T^{p+1}(u))=\coker(T^p(v))$, so it is clear that (\rmnum{1}) and (\rmnum{2}) are equivalent. The rest of the proposition follows from \cref{functor on Mod isomorphic to tensor iff} and \cref{functor on Mod Artian isomorphic to tensor iff}.
\end{proof}
\begin{corollary}\label{cohomology functor on Mod T^p right exact annihilator prop}
Let $A$ be a commutative ring. With the notations of \cref{cohomology functor on Mod T^p right exact iff}, suppose that $T^p$ is right exact. If $f\in A$ does not belong to the annihilator of any nonzero element of an $A$-module $M$, then $f$ doe not belong to the annihilator of any nonzero element of the $A$-module $T^{p+1}(M)$. In particular, if $A$ is an integral domain, then the $A$-module $T^{p+1}(A)$ is torsion free.
\end{corollary}
\begin{proof}
Let $h_f$ be the homothety with ratio $f$ on $M$. Then the hypothesis signifies that $h_f$ is injective, and by \cref{cohomology functor on Mod T^p right exact iff}, the homomorphism $T^{p+1}(h_f)$ is also injective, whence the corollary.
\end{proof}
\begin{proposition}\label{cohomology functor on Mod T^p exact iff}
Let $A$ be a ring and $T^\bullet:\mathbf{Mod}(A)\to \mathbf{Ab}$ be a cohomological functor which commutes with direct sums. Let $p$ be an integer such that $T^{p-1}$, $T^p$ and $T^{p+1}$ are defined. Then the following conditions are satisfied:
\begin{enumerate}
\item[(\rmnum{1})] $T^p$ is exact;
\item[(\rmnum{2})] $T^{p-1}$ is right exact and $T^{p+1}$ is left exact;
\item[(\rmnum{3})] for any left $A$-module $M$, the canonical homomorphism
\begin{align}\label{cohomology functor on Mod T^p exact iff-1}
T^i(A)\otimes_AM\to T^i(M)
\end{align}
is an isomorphism for $i=p,p-1$;
\item[(\rmnum{3}')] for any left $A$-module $M$, the canonical homomorphism (\ref{cohomology functor on Mod T^p exact iff-1}) is an epimorphism for $i=p,p-1$;
\item[(\rmnum{4})] for any left $A$-module $M$, the canonical homomorphism (\ref{cohomology functor on Mod T^p exact iff-1}) is an isomorphism for $i=p$ and $T^p(A)$ is a flat right $A$-module;
\item[(\rmnum{4}')] for any left $A$-module $M$, the canonical homomorphism (\ref{cohomology functor on Mod T^p exact iff-1}) is an epimorphism for $i=p$ and $T^p(A)$ is a flat right $A$-module.
\end{enumerate}
\end{proposition}
\begin{proof}
The equivalence of (\rmnum{1}) and (\rmnum{2}) follows from the equivalence of conditions (\rmnum{1}) and (\rmnum{2}) of \cref{cohomology functor on Mod T^p right exact iff}, and the equivalence of (\rmnum{2}), (\rmnum{3}) and (\rmnum{3}') follows from that of conditions (\rmnum{1}), (\rmnum{3}) and (\rmnum{4}) of \cref{cohomology functor on Mod T^p right exact iff}. Finally, to sya that $T^p(A)$ is flat signifies that the functor $T^p(A)\otimes_AM$ is left exact, so the equivalence of (\rmnum{1}), (\rmnum{4}') and (\rmnum{4}) also follows from that of conditions (\rmnum{1}), (\rmnum{3}) and (\rmnum{4}) of \cref{cohomology functor on Mod T^p right exact iff}.
\end{proof}
\begin{corollary}\label{cohomology functor on Mod T^p exact and fp rank locally constant}
Suppose that $A$ is commutative, $T^p$ is exact, and that $T^p(A)$ is an $A$-module of finite presentation. Then the function $x\mapsto\dim_{\kappa(x)}(T^p(\kappa(x)))$ is locally free over $X=\Spec(A)$, hence constant if $\Spec(A)$ is connected.
\end{corollary}
\begin{proof}
As $T^p(A)$ is a flat $A$-module by \cref{cohomology functor on Mod T^p exact iff}, it is projective and finitely generated (\cref{module fp flat is projective}), so $\widetilde{T^p(A)}$ is a locally free $\mathscr{O}_X$-module. We have $T^p(\kappa(x))=T^p(A)\otimes_A\kappa(x)$, so the rank function is locally constant by \cref{module finite projective iff}.
\end{proof}
\begin{proposition}\label{cohomology functor on Mod Artian T^p exact iff}
Let $A$ be a left Artinian ring with Jacobson radical $\m$ such that $A/\m$ is a field $k$. Let $T^\bullet:\mathbf{Mod}(A)\to \mathbf{Ab}$ be a cohomological functor which commutes with direct sums. Then the conditions of \cref{cohomology functor on Mod T^p exact iff} are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{5})] the canonical homomorphism $T^i(\eps):T^i(A)\to T^i(k)$ is an epimorphism for $i=p,p+1$;
\item[(\rmnum{6})] $T^p(\eps)$ is an epimorphism and $T^p(A)$ is a flat right $A$-module.
\end{enumerate}
Suppose that $A$ is commutative. Then the above conditions are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{7})] for any $A$-module $M$ of finite length, we have $\ell(T^p(M))=\ell(T^p(k))\cdot\ell(M)$;
\item[(\rmnum{8})] $\ell(T^p(A))=\ell(T^p(k))\cdot\ell(A)$. 
\end{enumerate}
\end{proposition}
\begin{proof}
The equivalence of (\rmnum{5}), (\rmnum{6}) and the conditions of \cref{cohomology functor on Mod T^p exact iff} can be deduced from \cref{cohomology functor on Mod T^p right exact iff}.
\end{proof}
\begin{proposition}\label{cohomology functor on Mod truncation exact iff}
Let $A$ be a ring and $T^\bullet:\mathbf{Mod}(A)\to \mathbf{Ab}$ be a cohomological functor which commutes with direct sums. Suppose that there exists an integer $n_0$ such that $T^p$ is exact for $p\geq n_0$. Then, for an integer $n<n_0$, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $T^p$ is exact for $p\geq n$;
\item[(\rmnum{2})] $T^p(A)$ is a flat right $A$-module for $p\geq n$;
\item[(\rmnum{3})] for any left $A$-module $M$, the canonical homomorphism $T^p(A)\otimes_AM\to T^p(M)$ is surjective for $p\geq n-1$.
\end{enumerate}
\end{proposition}
\begin{proof}
The equivalence of (\rmnum{1}) and (\rmnum{2}) follows from \cref{cohomology functor on Mod T^p exact iff} by induction, and (\rmnum{3}) follows from \cref{cohomology functor on Mod T^p exact iff}(\rmnum{3}').
\end{proof}
If $A$ is a commutative ring, $B$ is an $A$-algebra (not necessarily) commutative, and $T^\bullet:\mathbf{Mod}(A)\to \mathbf{Ab}$ be a cohomological functor, then since the functor $\rho^*$ is exact and faithful ($\rho:A\to B$ being the ring homomorphism), we see that the extension of scalar $T_{(B)}^\bullet$ is also a cohomological functor.
\begin{corollary}\label{cohomology functor on Mod T^p truncation exact after localization}
Suppose that $T^\bullet$ satisfies the conditions of \cref{cohomology functor on Mod truncation exact iff} and commutes with inductive limits. Moreover, assume that $A$ is an integral domain and the $A$-modules $T^p(A)$ are of finite presentation. Then for any integer $n<n_0$, there exists a nonzero element $f\in A$ such that the functor $T^p_{(A_f)}:\mathbf{Mod}(A_f)\to\mathbf{Ab}$ is exact for $p\geq n$. In particular, if there are finitely many indices $p$ such that $T^p\neq 0$, then there exists a nonzero element $f\in A$ such that the functors $T^p_{(A_f)}$ are all exact.
\end{corollary}
\begin{proof}
By hypothesis, $T^p$ is exact for $p\geq n_0$, so $T^p(A)$ is flat for these values of $p$. In view of \cref{cohomology functor on Mod truncation exact iff} and (\ref{functor on Mod commute rlim localization-1}), it suffices to choose $f$ such that $T^p_{(A_f)}(A_f)=T^p(A_f)=(T^p(A))_f$ is a free $A_f$-module for $n\leq p<n_0$. If $x$ is the generic point of $\Spec(A)$, $(T^p(A))_x$ is a vector space of finite dimension over the fraction field of $A$. As each $T^p(A)$ is of finite presentation, there exists an element $f\in A$ satisfying the desired property (\cref{localization module free at p then free at f}).
\end{proof}
\begin{corollary}\label{cohomology functor on Mod T^p truncation exact rank constant}
Suppose that $T^\bullet$ satisfies the conditions of \cref{cohomology functor on Mod truncation exact iff} and commutes with inductive limits. Moreover, assume that $A$ is Noetherian and the $A$-modules $T^p(A)$ are finitely generated. Then for any integer $n$, there exists an open dense subset $U$ of $\Spec(A)$ such that, for any $p\geq n$, the function $x\mapsto\dim_{\kappa(x)}(T^p(\kappa(x)))$ is constant on $U$.
\end{corollary}
\begin{proof}
Let $\p$ be a minimal prime ideal of $A$. By hypothesis, the ring $B=A/\p$ is integral and $\Spec(B)$ is identified with an irreducible component of $\Spec(A)$. We now prove by induction on the integer $p\geq n$ that, for each $p$, there exists $f_p\in B-\{0\}$ such that if we put $B'=B_{f_p}$, then $T^i_{(B')}$ is exact and the $T_i(B')$ are finitely generated $B'$-modules for $i\geq p$. By our hypothesis, this is true for $p\geq n_0$, since in this case $T^p$ is exact and $T^p(B)\cong T^p(A)/T^p(\p)$, hence is a finitely generated $A$-module (and a fortiori $B$-module), so we can choose $f_p=1$ (so that $B'=B=A/\p$). We preceed by induction on $p$, so let $f_p$ be such an element. Then $f_p$ is the canonical image of an element $g_p\in A$, and if we put $A'=A_{g_p}$, we have $B'=A'/\p'$ where $\p'$ is the minimal prime ideal $\p_{g_p}$ of $A'$. As $T^i(A_{g_p})=(T_i(A))_{g_p}$, the $T^i(A')$ are finitely generated $A'$-modules, so $T^\bullet_{(A')}$ satisfies the same condition as $T^\bullet$, with $n_0$ replaced by $p$. We can then reduce the proof to the case where $A'=A$ and $T^p$ is exact. The exact sequence $0\to\p\to A\to A/\p\to 0$ then gives an exact sequence
\[\begin{tikzcd}
T^{p-1}(A)\ar[r]&T^{p-1}(A/\p)\ar[r,"\delta"]&T^p(\p)\ar[r]&T^p(A)
\end{tikzcd}\]
and as $T^p$ is exact, the last arrow is injective, so $T^{p-1}(A/\p)$ is a quotient of $T^{p-1}(A)$ and therefore finitely generated. We note that in the proof of \cref{cohomology functor on Mod T^p truncation exact after localization}, we only use the fact that $T^p(A)$ are finitely generated for $p\geq n$, so we can apply it to the integral ring $B$ and the functor $T^\bullet_{(B)}$, with $n=p-1$, which produces the desired element $f_N$. If the corollary is proved for the ring $B_{f_N}$, then there exists an open dense subset $W$ of $\Spec(B_{f_N})$ such that the function $\dim_{\kappa(x)}(T^p(\kappa(x)))$ is constant, since $A_x=(B_{f_N})_x$ for any $x\in W$. By applying this reasoning to each irreducible component of $\Spec(A)$, the corollary is then proved. To summarize, the corollary is now reduced to the case where $A$ is an integral domain, so by \cref{cohomology functor on Mod T^p truncation exact after localization} there exists an element $f\in A-\{0\}$ such that the $A_f$-modules $T^p(A_f)$ are free of finite rank for $p\geq n$. The corollary then follows from \cref{cohomology functor on Mod T^p exact and fp rank locally constant}.
\end{proof}
\begin{proposition}\label{cohomology functor on Mod local ring truncation exact iff}
Let $A$ be a commutative local ring, $k$ be its residue field, $T^\bullet:\mathbf{Mod}(A)\to \mathbf{Ab}$ be a cohomological functor which commutes with direct sums. Suppose that there exists an integer $n_0$ such that $T^p$ is exact for $i\geq n_0$, and that the $T^p(A)$ are finitely presented $A$-modules. Then the conditions of \cref{cohomology functor on Mod truncation exact iff} imply the following conditions, and they are equivalent if $A$ is reduced:
\begin{enumerate}
\item[(\rmnum{4})] for any $x\in\Spec(A)$, we have
\[\dim_{\kappa(x)}(T^p(\kappa(x)))=\rank_k(T^p(k))\for p\geq n;\]
\item[(\rmnum{4}')] for any generic point $x_j$ of an irreducible component of $\Spec(A)$, we have
\[\rank_{\kappa(x_j)}(T^p(\kappa(x_j)))=\rank_k(T^p(k))\for p\geq n.\]
\end{enumerate}
\end{proposition}
\begin{proof}
As $T^p(A)$ is a finitely presented $A$-module, condition (\rmnum{2}) of \cref{cohomology functor on Mod truncation exact iff} is equivalent to that $T^p(A)$ is a free $A$-module for $p\geq n$ (\cref{module fp flat is projective}). Condition (\rmnum{3}) implies that $T^p(\kappa(x))=T^p(A)\otimes_A\kappa(x)$ for $p\geq n$, so the conditions of \cref{cohomology functor on Mod truncation exact iff} implies (\rmnum{4}), and it is clear that (\rmnum{4}) implies (\rmnum{4}'). Conversely, we need to show that (\rmnum{4}') implies (\rmnum{1}) if $A$ is reduced. We preceed by descending induction on the integer $p\geq n$, since we know that $T^p$ is exact for $p\geq n_0$. Suppose that $T^i$ is exact for $i\geq p>n$, we show that $T^{p-1}(A)$ is a free $A$-module. In view of the induction hypothesis, $T^{p-1}(A)\otimes_AM$ is isomorphic to $T^{p-1}(M)$ for any $A$-module $M$, by condition (\rmnum{3}) of \cref{cohomology functor on Mod truncation exact iff} and \cref{cohomology functor on Mod T^p exact iff}. Applying this property to $M=\kappa(x_j)$ and $M=k$, we conclude that for each $j$, we have
\[\rank_{\kappa(x_j)}(T^{p-1}(A)\otimes_A\kappa(x_j))=\rank_k(T^{p-1}(k)).\]
But this implies that $T^{p-1}(A)$ is free (\cref{local ring reduced finite module free iff}), whence the proposition.
\end{proof}
\subsection{Exactness of the fonctor \texorpdfstring{$H^\bullet(P^\bullet\otimes_AM)$}{H}}\label{cohomology functor by tensor subsection}
Let $A$ be a ring (notn ecessarily commutative) and $P^\bullet$ be a complex of flat right $A$-modules. As the functor $P^i\otimes_A(-)$ is then exact for each $i$, the $\delta$-functor
\begin{align}\label{cohomology functor by tensor def}
T^\bullet(M)=H^\bullet(P^\bullet\otimes_AM)
\end{align}
is a cohomological functor from $\mathbf{Mod}(A)$ to $\mathbf{Ab}$, which is $A$-linear if $A$ is commutative and commutes with inductive limits.\par
If $A$ is commutative and $B$ is an $A$-algebra, then the cohomological functor $T^\bullet_{(B)}$ can be defined by
\[T^\bullet_{(B)}=H^\bullet(P^\bullet\otimes_A\rho^*(N))\]
where $\rho:A\to B$ is the ring homomorphism. As we can write $P^\bullet\otimes_A\rho^*(N)=P^\bullet\otimes_A\rho^*(B\otimes_BN)=(P^\bullet\otimes_AB)\otimes_BN$, we see that
\begin{align}\label{cohomology functor by tensor base change prop}
T^\bullet_{(B)}(N)=H^\bullet(P^\bullet_{(B)}\otimes_BN)
\end{align}
where $P_{(B)}^\bullet=P^\bullet\otimes_AB$ is a complex of flat $B$-modules (\cref{module flat extension is flat}).
\begin{proposition}\label{cohomology functor by tensor left exact iff}
Let $T^\bullet$ be the cohomological functor defined by (\ref{cohomology functor by tensor def}). Then for an integer $p$, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $T^p$ is left exact (or equivalently, $T^{p-1}$ is right exact);
\item[(\rmnum{2})] $W^p(P^\bullet)=\coker(P^{p-1}\to P^p)$ is a flat right $A$-module;
\item[(\rmnum{3})] there exists a complex $Q^\bullet$ of flat right $A$-modules such that $d^{p-1}:Q^{p-1}\to Q^p$ is zero and an isomorphism $H^\bullet(P^\bullet\otimes_AM)\stackrel{\sim}{\to}H^\bullet(Q^\bullet\otimes_AM)$ of cohomological functors.  
\end{enumerate}
\end{proposition}
\begin{proof}
By definition, we have a canonical exact sequence
\[\begin{tikzcd}
0\ar[r]&T^p(M)\ar[r]&W^p(P^\bullet\otimes_AM)\ar[r]&P^{p+1}\otimes_AM
\end{tikzcd}\]
where $W^p(P^\bullet\otimes_AM)=\coker(P^{p-1}\otimes_AM\to P^p\otimes_AM)=W^p(P^\bullet)\otimes_AM$ in view of the flatness of $P^\bullet$. For any homomorphism $f:M\to N$, we have a commutative diagram
\begin{equation}\label{cohomology functor by tensor left exact iff-1}
\begin{tikzcd}
0\ar[r]&T^p(M)\ar[r]\ar[d,"u"]&W^p(P^\bullet)\otimes_AM\ar[r]\ar[d,"v"]&P^{p+1}\otimes_AM\ar[d,"w"]\\
0\ar[r]&T^p(N)\ar[r]&W^p(P^\bullet)\otimes_AN\ar[r]&P^{p+1}\otimes_AN
\end{tikzcd}
\end{equation}
with exact rows. If $f$ is a monomorphism, so is $w$ since $P^{p+1}$ is flat; if $T^p$ is left exact, then $u$ is also a monomorphism. We then conclude that $v$ is a monomorphism, which implies that $W^p(P^\bullet)$ is flat. Conversely, if this is the case, then $v$ is a monomorphism for any monomorphism $f:M\to N$, so the diagram (\ref{cohomology functor by tensor left exact iff-1}) shows that $u$ is a monomorphism, and therefore $T^p$ is left exact. This proves (\rmnum{1}) implies (\rmnum{2}), and it is immediate that (\rmnum{3}) implies (\rmnum{1}), because if $P^\bullet$ has zero differentials and $0\to M'\to M\to M''\to 0$ is an exact sequence of $A$-modules, the connecting homomorphism of the sequence
\[\begin{tikzcd}
H^{p-1}(P^\bullet\otimes_AM'')\ar[r,"\delta"]&H^p(P^\bullet\otimes_AM')\ar[r]&H^p(P^\bullet\otimes_AM)
\end{tikzcd}\]
is zero by definition, so $T^p$ is left exact. Conversely, we prove that (\rmnum{2}) implies (\rmnum{3}). If $Z^p(P^\bullet)=\ker(P^p\to P^{p+1})$, we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&Z^{p-1}(P^\bullet)\ar[r]&P^{p-1}\ar[r]&P^p\ar[r]&W^p(P^\bullet)\ar[r]&0
\end{tikzcd}\]
in which $P^{p-1}$, $P^p$ and $W^p(P^\bullet)$ are flat, so $Z^{p-1}(P^\bullet)$ is flat. We can then define $Q^\bullet$ to be the following complex
\[\begin{tikzcd}
\cdots\ar[r]&P^{p-2}\ar[r]&Z^{p-1}(P^\bullet)\ar[r,"0"]&W^p(P^\bullet)\ar[r]&P^{p+1}\ar[r]&P^{p+2}\ar[r]&\cdots
\end{tikzcd}\]
As the $P^i$ are flat, we have
\[W^i(P^\bullet\otimes_AM)=W^i(P^\bullet)\otimes_AM,\quad Z_i(P^\bullet\otimes_AM)=Z_i(P^\bullet)\otimes_AM,\quad B^i(P^\bullet\otimes_AM)=B^i(P^\bullet)\otimes_AM\]
from which we conclude that for any $M$ the functorial homomorphisms $H^i(P^\bullet\otimes_AM)\stackrel{\sim}{\to}H^i(Q^\bullet\otimes_AM)$ for each $i$, which proves the assertion.
\end{proof}
\begin{remark}
We note that the conditions of \cref{cohomology functor by tensor left exact iff} imply that each $B^p(P^\bullet)$ is flat, because we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&B^p(P^\bullet)\ar[r]&P^p\ar[r]&W^p(P^\bullet)\ar[r]&0
\end{tikzcd}\]
in which $P^p$ and $W^p(P^\bullet)$ are flat.
\end{remark}
\begin{corollary}\label{cohomology functor by tensor Noe regular dim 1 exact iff}
Suppose that $A$ is a regular Noetherian ring of dimension $1$. Then, for the $T^p$ to be left exact, it is necessary and sufficient that $T^p(A)$ is a flat $A$-module. For $T^p$ to be exact, it is necessary and sufficient that $T^p(A)$ and $T^{p+1}(A)$ are flat $A$-modules.
\end{corollary}
\begin{proof}
Recall that for a module $M$ over a Dedekind ting, flatness is equivalent to torsion free, so under our hypothesis, any submodule of a flat $A$-module is flat. The second assertion follows from the first, since $T^p$ is exact if and only if $T^p$ and $T^{p+1}$ are left exact. To prove the frist assertion, we consider the following exact sequence
\[\begin{tikzcd}
0\ar[r]&H^p(P^\bullet)\ar[r]&W^p(P^\bullet)\ar[r]&B^{p+1}(P^\bullet)\ar[r]&0
\end{tikzcd}\]
where $B^{p+1}(P^\bullet)$ is a submodule of the flat module $P^{p+1}$, hence flat, so $H^p(P^\bullet)$ is flat if and only if $W^p(P^\bullet)$ is flat.
\end{proof}
The most important application of \cref{cohomology functor by tensor left exact iff} is the following result:
\begin{proposition}\label{cohomology functor by tensor Noe left exact set open}
Let $A$ be a (commutative) Noetherian ring and $P^\bullet$ be a complex of flat $A$-modules. Suppose that the $P^i$ are finitely generated $A$-modules, or that the $H^i(P^\bullet)$ are finitely generated and there exists an integer $n_0$ such that $H^i(P^\bullet)=0$ for $i>n_0$. Let $T^\bullet$ be the cohomological functor defined by (\ref{cohomology functor by tensor def}), then the set $U$ of $y\in\Spec(A)$ such that $(T^p)_y$ is left exact (resp. right exact) is open in $\Spec(A)$.
\end{proposition}
\begin{proof}
In any case, by (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 11.9.3), we can replace $P^\bullet$ by a complex $Q^\bullet$ consists of finitely generated $A$-modules such that the functors $H^\bullet(P^\bullet\otimes_A(-))$ and $H^\bullet(Q^\bullet\otimes_A(-))$ are isomorphic; in particular, the $W^i(P^\bullet)$ are finitely generated. Moreover, in view of \cref{cohomology functor on Mod T^p right exact iff}, we only need to prove the assertion concerning left exactness of $T^p$. Now let $x\in U$; as the functor $M\mapsto M_x$ is exact, we have $(W^p(P^\bullet))_x=W^p(P^\bullet_x)$, and in view of (\ref{cohomology functor by tensor base change prop}) and \cref{cohomology functor by tensor left exact iff}, the hypothesis implies that $(W^p(P^\bullet))_x$ is a flat $A_x$-module, hence free (\cref{module finite projective iff}). We then conclude that there exists $f\in A$ such that $(W^p(P^\bullet))_f$ is a free $A_f$-module (\cref{localization module free at p then free at f}), and a fortiori $(W^p(P^\bullet))_y$ is free over $A_y$ for any $y\in D(f)$. This then proves our assertion, since $D(f)\sub U$.
\end{proof}
\begin{corollary}\label{cohomology functor by tensor Noe integral exact set nonempty}
Under the hypothesis of \cref{cohomology functor by tensor Noe left exact set open}, assume that $A$ is integral. Then the set $U$ of $\Spec(A)$ such that $(T^p)_x$ is exact is nonempty in $\Spec(A)$.
\end{corollary}
\begin{proof}
It suffices to note that $(T^p)_x$ is exact for the generic point $x$ of $\Spec(A)$, since $A_x$ is then the fraction field.
\end{proof}
\begin{proposition}\label{cohomology functor by tensor Noe left exact iff Hom}
Under the hypothesis of \cref{cohomology functor by tensor Noe left exact set open}, the conditions of \cref{cohomology functor by tensor left exact iff} are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{4})] there exsist an $A$-module $Q$ and an isomorphism
\begin{align}\label{cohomology functor by tensor Noe left exact iff Hom}
T^p(M)\stackrel{\sim}{\to}\Hom_A(Q,M).
\end{align}
\end{enumerate}
Moreover, the $A$-module $Q$ is uniquely determined up to isomorphisms, and is finitely generated.
\end{proposition}
\begin{proof}
The uniqueness of $Q$ follows easily from Yoneda's lemma, and it is clear that $\Hom_A(Q,-)$ is left exact. Conversely, assume that $T^p$ is left exact, we prove the existence of $Q$. By (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 11.9.3), we can assume that each $P^i$ is free of finite rank, hence projective. The dual $\check{P}^i$ of $P^i$ is then also a finitely generated projective module, $P^i$ is isomorphic to the dual of $\check{P}^i$, and the canonical homomorphism $P^i\otimes_AM\to\Hom_A(\check{P}^i,M)$ is bijective. We see on the other hand (\cref{cohomology functor by tensor left exact iff}) that we can suppose that $d^{p-1}:P^{p-1}\to P^p$ is zero, so we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&T^p(M)\ar[r,"u"]&P^p\otimes_AM\ar[r]&P^{p+1}\otimes_AM
\end{tikzcd}\]
where $v=d^p\otimes 1$. Put $Q'=\ker d^p$, so that we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&Q'\ar[r,"w"]&P^p\ar[r,"d^p"]&P^{p+1}
\end{tikzcd}\]
Then by transposition, the sequence
\[\begin{tikzcd}
\check{P}^{p+1}\ar[r,"(d^p)^t"]&\check{P}^p\ar[r,"w^t"]&\check{Q}'\ar[r]&0
\end{tikzcd}\]
is exact. We then claim that the module $Q=\check{Q}'=\coker(d^p)^t$ satisfies our requirement. In fact, we have the exact sequence 
\[\begin{tikzcd}
0\ar[r]&\Hom_A(Q,M)\ar[r]&\Hom_A(\check{P}^p,M)\ar[r,"v'"]&\Hom_A(\check{P}^{p+1},M)
\end{tikzcd}\]
where $v'=\Hom((d^p)^t,1)$. If we canonically identify $P^i\otimes_AM$ with $\Hom(\check{P}^i,M)$, then $v'$ is identified with $v=d^p\otimes 1$, and we therefore have a functorial isomorphism $T^p(M)\stackrel{\sim}{\to}\Hom_A(Q,M)$. Morever, $Q$, being a quotient of $\check{P}^p$, is finitely generated.
\end{proof}
\begin{proposition}\label{cohomology functor by tensor Noe adic completion prop}
Under the hypothesis of \cref{cohomology functor by tensor Noe left exact set open}, for any finitely generated $A$-module $M$:
\begin{enumerate}
\item[(a)] the $T^i(M)$ are finitely generated $A$-modules;
\item[(b)] for any ideal $\mathfrak{I}$ of $A$, the canonical homomorphism
\begin{align}
\widehat{T^i(M)}\to\llim_nT^i(M\otimes_A(A/\mathfrak{I}^{n+1}))
\end{align}
is bijective.
\end{enumerate}
\end{proposition}
\begin{proof}
As in \cref{cohomology functor by tensor Noe left exact set open}, we can assume that each $P^i$ is finitely generated. Then every submodule of $P^i\otimes_AM$ is finitely generated, whence assertion (a). To prove (b), it suffices to show that, if $u:E\to F$ is a homomorphism of finitely generated $A$-modules and $M$ is a finitely generated $A$-module, then, if we set $K(M)=\ker u\otimes 1_M$ and $C(M)=\coker u\otimes 1_M$, we have canonical isomorphisms
\[\widehat{K(M)}\to\llim K(M_n),\quad \widehat{C(M)}=\llim C(M_n).\]
To this end, we note that since $E\otimes_AM$ and $F\otimes_AM$ are finitely generated $A$-module, $\widehat{K(M)}$ and $\widehat{C(M)}$ are respectively the kernel and cokernel of the homomorphism $\widehat{u\otimes 1_M}:\widehat{E\otimes_AM}\to\widehat{F\otimes_AM}$. By the left exactness of $\llim$, we then have $\widehat{K(M)}=\llim K(M_n)$, and $\widehat{K(M)}=\llim K(M_n)$; on the other hand, since $C(M_n)=C(M)\otimes_A(A/\mathfrak{I}^{n+1})$, we see from defintion that $\widehat{C(M)}=\llim C(M_n)$.
\end{proof}
\subsection{The case of Noetherian local rings}
We now consider the case where $A$ is a Noetherian local ring. Let $\mathfrak{I}$ be the maximal ideal of $A$. Let $T:\mathbf{Mod}(A)\to\mathbf{Ab}$ be a covariant additive functor; then the canonical homomorphisms (\ref{functor on Mod homomorphism on tensor-1})
\[T(M)\otimes_A(A/\m^{n+1})\to T(M\otimes_A(A/\m^{n+1}))\]
form a projective system of $A$-homomorphisms, hence give a functorial homomorphism of $\widehat{A}$-modules
\begin{align}\label{functor on Mod Noe local right exact iff-1}
\widehat{T(M)}\to\llim T(M_n)
\end{align}
where $M_n=M\otimes_A(A/\m^{n+1})$ and $A_n=A/\m^{n+1}$.
\begin{proposition}\label{functor on Mod Noe local right exact iff}
Let $A$ be a Noetherian local ring with maximal ideal $\m$, residue field $k$, $T:\mathbf{Mod}(A)\to\mathbf{Ab}$ be a covariant additive functor, which is semi-exact and commutes with inductive limits. Suppose that for every finitely generated $A$-module $M$, $T(M)$ is a finitely generated $A$-module and the canonical homomorhism (\ref{functor on Mod Noe local right exact iff-1}) is an isomorphism. Under these conditions, the following properties are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $T$ is right exact;
\item[(\rmnum{2})] for each $n$, the functor $N\mapsto T(N)$ is right exact on the category of finitely generated $A_n$-modules (which means $T$ is exact on the category of $A$-modules of finite length);
\item[(\rmnum{3})] the canonical homomorphism $T(\eps):T(A)\to T(k)$ is surjective;
\item[(\rmnum{4})] for sufficiently large $n$, the canonical homomorphism $T(A_n)\to T(k)$ is surjective.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{1}) implies (\rmnum{2}); to see that (\rmnum{2}) implies (\rmnum{1}), let $u:M\to N$ be an epimorphism of $A$-modules. As $T$ commutes with inductive limits and the functor $\rlim$ is exact on the category of $A$-modules (indexed by filtered sets), we can also suppose that $M$ and $N$ are finitely generated, so by hypothesis $T(M)$ and $T(N)$ are also finitely generated. As $A$ is a Noethertian local ring (hence a Zariski ring with the $\m$-adic topology), it suffices to prove that $\widehat{T(u)}:\widehat{T(M)}\to\widehat{T(N)}$ is surjective (\cref{Zariski ring def}). By hypothesis, $\widehat{T(M)}$ and $\widehat{T(N)}$ are isomorphic to $\llim T(M_n)$ and $\llim T(N_n)$, respectively, and $\widehat{T(u)}$ can be identified with the projective limit of the homomorphisms $T(u\otimes 1_{A_n}):T(M_n)\to T(N_n)$, which are all surjective by condition (\rmnum{2}). We then conclude that $\widehat{T(u)}$ is surjective, so (\rmnum{2}) implies (\rmnum{1}). It is clear that (\rmnum{1}) implies (\rmnum{3}), and since $T(\eps)$ can be written as $T(A)\to T(A_n)\to T(k)$, (\rmnum{3}) implies (\rmnum{4}). Finally, by \cref{functor on Mod Artian isomorphic to tensor iff} we know that (\rmnum{2}) is equivalent to (\rmnum{4}), since $T$ is semi-exact on $\mathbf{Mod}(A_n)$.
\end{proof}
\begin{corollary}\label{functor on Mod Noe local zero iff T(k)}
Under the hypotheses of \cref{functor on Mod Noe local right exact iff}, if $T(k)=0$, then $T=0$.
\end{corollary}
\begin{proof}
As $k$ is the only simple $A$-module, we deduce from (\ref{*} 7.3.5.4) that $T(E)=0$ for any $A$-module $E$ of finite length. If $M$ is a finitely generated $A$-module, then $\widehat{T(M)}$ is isomorphic to $\llim T(M_n)$, and as $M_n$ are of finite length, we have $\widehat{T(M)}=0$, so $T(M)=0$ since it is finitely generated (\cref{Zariski ring def}). Finally, for any $A$-module $M$, $T(M)$ is the inductive limit of $T(N_\alpha)$, where $N_\alpha$ are the finitely generated submodules of $M$, whence the assertion.
\end{proof}
\begin{proposition}\label{cohomology functor on Mod Noe local zero iff T(k)}
Let $A$ be a Noetherian local ring with maximal ideal $\m$, residue field $k$, $T^\bullet:\mathbf{Mod}(A)\to \mathbf{Ab}$ be a cohomological functor which is semi-exact and commutes with inductive limits. Suppose that for any integer $i$ and any finitely generated $A$-module $M$, $T^i(M)$ is finitely generated and the canonical homomorphism $\widehat{T^i(M)}\to\llim T^i(M_n)$ is bijective. For an integer $p$, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $T^p$ is exact;
\item[(\rmnum{2})] $T^p$ is right exact and $T^p(A)$ is a free $A$-module.
\item[(\rmnum{3})] the canonical homomorphism $T^i(A)\to T^i(k)$ is surjective for $i=p,p-1$; 
\item[(\rmnum{4})] for each $n$, the canonical homomorphism $T^i(A_n)\to T^i(k)$ is surjective for $i=p,p-1$; 
\item[(\rmnum{5})] for each $n$, the functor $N\mapsto T^p(N)$ is exact on the category of finitely generated $A_n$-modules.
\end{enumerate}
\end{proposition}
\begin{proof}
It follows from \cref{cohomology functor on Mod T^p right exact iff} that (\rmnum{1}) is equivalent to that $T^p$ and $T^{p-1}$ are right exact; by the same reasoning, (\rmnum{5}) is equivalent to say that $T^p$ and $T^{p-1}$ are right exact on the category of finitely generated $A_n$-modules. We then deduce form \cref{functor on Mod Noe local right exact iff} that (\rmnum{1}) is equivalent to (\rmnum{5}); the equivalence of (\rmnum{1}), (\rmnum{3}) and (\rmnum{4}) also follows from \cref{functor on Mod Noe local right exact iff}. Finally, we see that any finitely generated flat $A$-module is projective, the equivalence of (\rmnum{1}) and (\rmnum{2}) follows from \cref{cohomology functor on Mod T^p exact iff}.
\end{proof}
\begin{corollary}\label{cohomology functor on Mod Noe local T^p(k) zero prop}
Suppose the hypotheses of \cref{cohomology functor on Mod Noe local zero iff T(k)}.
\begin{enumerate}
\item[(a)] If $T^p(k)=0$, then $T^p=0$, $T^{p-1}$ is right exact and $T^{p+1}$ is left exact.
\item[(b)] If $T^{p-1}(k)=T^{p+1}(k)=0$, then $T^p$ is exact, the canonical homomorphism
\[T^p(A)\otimes_AM\to T^p(M)\]
is bijective and $T^p(A)$ is a free $A$-module.
\end{enumerate}
\end{corollary}
\begin{proof}
Assertion (a) follows directly from \cref{functor on Mod Noe local zero iff T(k)} since $T^p$ is semi-exact, and the first two assertions of (b) also follows from this. Finally, the last assertion follows from \cref{functor on Mod Noe local right exact iff}.
\end{proof}
\begin{corollary}\label{cohomology functor on Mod DVR exact iff}
Retain the the hypotheses of \cref{cohomology functor on Mod Noe local zero iff T(k)} and suppose that $A$ is a DVR.
\begin{enumerate}
\item[(a)] For $T^p$ to be right exact, it is necessary and sufficient that $T^{p+1}(A)$ is a free $A$-module.
\item[(b)] For $T^p$ to be exact, it is necessary and sufficient that $T^p(A)$ and $T^{p+1}(A)$ are free $A$-modules.
\end{enumerate}
\end{corollary}
\begin{proof}
It is clear that (a) implies (b), in view of \cref{cohomology functor on Mod T^p right exact iff}. To prove (a), let $\pi$ be a uniformizer of $A$; for a finitely generated $A$-module $M$ to be free (or equivalently, flat), it is necessary and sufficient that the homothety $h_\pi:x\mapsto\pi x$ of $M$ is injective, because this means $M$ is torsion free. Consider the exact sequence
\[\begin{tikzcd}
0\ar[r]&A\ar[r,"h_f"]&A\ar[r]&k\ar[r]&0
\end{tikzcd}\]
which induces an exact sequence
\[\begin{tikzcd}
T^p(A)\ar[r]&T^p(k)\ar[r]&T^{p+1}(A)\ar[r,"h_f"]&T^{p+1}(A)
\end{tikzcd}\]
We then see that $T^{p+1}(A)$ is free if and only if $T^p(A)\to T^p(k)$ is surjective, which proves our assertion (\cref{functor on Mod Noe local right exact iff}).
\end{proof}
\subsection{Descent of exactness and the semi-continuity theorem}
\begin{proposition}\label{cohomology functor by tensor exact base change}
Under the hypothesis of \cref{cohomology functor by tensor left exact iff}, let $B$ be a commutative $A$-algebra. If $T^p$ is right exact (resp. left exact), then so is $T^p_{(B)}$. The converse is true if $B$ is a fiathfully flat $A$-module.
\end{proposition}
\begin{proof}
The first assertion is trivial since the forgetful functor is exact and faithful. Conversely, suppose first that $B$ is a flat $A$-module. We then have, for any $A$-module $M$, $H^\bullet(P^\bullet\otimes_A(M\otimes_AB))=(H^\bullet(P^\bullet\otimes_AM))\otimes_AB$, wich means, for each $p$,
\begin{align}\label{cohomology functor by tensor exact base change-1}
T^p(M)\otimes_AB=T^p_{(B)}(M_{(B)}).
\end{align}
Suppose that $T^p_{(B)}$ is right exact (resp. right exact), then as $M\to M_{(B)}$ is an exact functor, the first member of (\ref{cohomology functor by tensor exact base change-1}) is a right exact (resp. left exact) functor on $M$; if $B$ is assumed to be faithfully flat, then we deduce that $T^p$ has the same exactness property.
\end{proof}
\begin{proposition}\label{cohomology functor by tensor exact iff base change to DVR}
Under the hypothesis of \cref{cohomology functor by tensor left exact iff}, suppose that $A$ is a reduced Noetherian ring and the $P^i$ are finitely generated $A$-modules. For $T^p$ to be right exact (resp. left exact), it is necessary and sufficient that, for any $A$-algebra $B$ which is a DVR, $T^p_{(B)}$ is right exact (resp. left exact).
\end{proposition}
\begin{proof}
In view of \cref{cohomology functor on Mod T^p right exact iff}, we only need to consider the left exactness, hence prove the sufficiency of the condition of the corollary. In view of \cref{cohomology functor by tensor left exact iff}, it suffices to prove that $W^p(P^\bullet)$ is a flat $A$-module; as $P^p$ is finitely generated, $W^p(P^\bullet)$ is also finitely generated, so the criterion of (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 10.2.8) shows that it suffices to show that $W^p(P^\bullet)\otimes_AB$ is a flat $B$-module for any $A$-algebra $B$ which is a DVR. Now, as $P^\bullet$ is a complex of flat $A$-modules, we have
\[W^p(P^\bullet)\otimes_AB=W^p(P^\bullet\otimes_AB);\]
where $P^\bullet\otimes_AB$ is a complex of flat $B$-modules and for any $B$-module $N$, we have $H^\bullet(P^\bullet\otimes_AN)=H^\bullet((P^\bullet\otimes_AB)\otimes_BN)$, so $T^p_{(B)}(N)=H^p((P^\bullet\otimes_AB)\otimes_BN)$. Applying \cref{cohomology functor by tensor left exact iff} to $T^p_{(B)}$, we see that the hypothesis that $T^p_{(B)}$ is left exact is equivalent to that $W^p(P^\bullet\otimes_AB)$ is a flat $B$-module, whence our assertion.
\end{proof}
The criterion of \cref{cohomology functor by tensor exact iff base change to DVR} reduces the exactness of $T^p$ to the case of DVRs. In this case, we have the following useful result, which can be considered as a "universal coefficient theorem".
\begin{proposition}\label{cohomology functor by tensor Noe regular 1 dim exact sequence}
Under the hypothesis of \cref{cohomology functor by tensor left exact iff}, suppose that $A$ is a one dimensional regular Noetherian ring (in other words, $A$ is Noetherian and for any $x\in\Spec(A)$, $A_x$ is a field or a DVR). Then for any integer $p$ and $A$-module $M$, we have a canonical exact sequence
\begin{equation}\label{cohomology functor by tensor Noe regular 1 dim exact sequence-1}
\begin{tikzcd}
0\ar[r]&T^p(A)\otimes_AM\ar[r,"t_M"]&T^p(M)\ar[r]&\Tor_1^A(T^{p+1}(A),M)\ar[r]&0
\end{tikzcd}
\end{equation}
\end{proposition}
\begin{proof}
We simplify our notation by writing $H^p$, $Z^p$, $B^p$ for $H^p(P^\bullet)$, $Z^p(P^\bullet)$, $B^p(P^\bullet)$. Then we have the following exact sequences
\begin{equation*}
\begin{gathered}
\begin{tikzcd}
0\ar[r]&H^p\ar[r]&W^p\ar[r]&B^{p+1}\ar[r]&0
\end{tikzcd}\\
\begin{tikzcd}
0\ar[r]&B^{p+1}\ar[r]&Z^{p+1}\ar[r]&H^{p+1}\ar[r]&0
\end{tikzcd}\\
\begin{tikzcd}
0\ar[r]&Z^p\ar[r]&P^p\ar[r]&B^{p+1}\ar[r]&0
\end{tikzcd}
\end{gathered}
\end{equation*}
As $P^p$ and $P^{p+1}$ are flat, so are their submodules (since for any $x\in\Spec(A)$, a $A_x$-module is flat if and only if it is torsion free). By tensoring with $M$, we then obtain exact sequences
\begin{equation}\label{cohomology functor by tensor Noe regular 1 dim exact sequence-2}
\begin{tikzcd}[column sep=6mm]
0\ar[r]&H^p\otimes_AM\ar[r]&W^p\otimes_AM\ar[r,"u"]&B^{p+1}\otimes_AM\ar[r]&0
\end{tikzcd}
\end{equation}
\vspace*{-9mm}
\begin{equation}\label{cohomology functor by tensor Noe regular 1 dim exact sequence-3}
\begin{tikzcd}[column sep=6mm]
0\ar[r]&\Tor_1^A(H^{p+1},M)\ar[r]&B^{p+1}\otimes_AM\ar[r,"v"]&Z^{p+1}\otimes_AM\ar[r]&H^{p+1}\otimes_AM\ar[r]&0
\end{tikzcd}
\end{equation}
\vspace*{-5mm}
\begin{equation}\label{cohomology functor by tensor Noe regular 1 dim exact sequence-4}
\begin{tikzcd}[column sep=6mm]
0\ar[r]&Z^p\otimes_AM\ar[r,"w"]&P^p\otimes_AM\ar[r]&B^{p+1}\otimes_AM\ar[r]&0
\end{tikzcd}
\end{equation}
By definition, $T^p(M)=\ker(d^p\otimes 1_M)/\im(d^{p-1}\otimes 1_M)$, which is the kernel of the homomorphism
\[(P^p\otimes_AM)/\im(d^{p-1}\otimes 1_M)\to P^{p+1}\otimes_AM\]
obtained from $d^p\otimes 1_M$ by passing to quotient. By definition we have $W^p=P^p/B^p$, so this homomorphism can also be written as $W^p\otimes_AM\to P^{p+1}\otimes_AM$, which is exactly the composition
\[\begin{tikzcd}
W^p\otimes_AM\ar[r,"u"]&B^{p+1}\otimes_AM\ar[r,"v"]&Z^{p+1}\otimes_AM\ar[r,"w"]&P^{p+1}\otimes_AM
\end{tikzcd}\]
By (\ref{cohomology functor by tensor Noe regular 1 dim exact sequence-4}), the homomorphism $w$ is injective, so we get an exact sequence
\[\begin{tikzcd}
0\ar[r]&\ker u\ar[r]&T^p(M)\ar[r]&\ker v\ar[r]&0
\end{tikzcd}\]
This is exactly (\ref{cohomology functor by tensor Noe regular 1 dim exact sequence-1}), since we have $H^p=T^p(A)$ by (\ref{cohomology functor by tensor Noe regular 1 dim exact sequence-2}) and (\ref{cohomology functor by tensor Noe regular 1 dim exact sequence-3}).
\end{proof}
\begin{remark}
Since $H^\bullet(P^\bullet\otimes_AM)$ is the cohomology of the double complex $P^\bullet\otimes_AM$ (where $M$ is considered as a complex with only zero-th term), it is the limit of a regular homological spectral sequence with term $E^2$ given by
\[E_{p,q}^2=\Tor_p^A(H_q(P^\bullet),M)=\Tor_p^A(T^q(A),M).\]
The hypothesis of \cref{cohomology functor by tensor Noe regular 1 dim exact sequence} implies that for any $A$-module $E,F$, we have $\Tor_p^A(E,F)=0$ for $p\geq 2$ (\cref{Noe ring gldim finite iff regular with finite dim}), so we have an exact sequence
\[\begin{tikzcd}
0\ar[r]&E^2_{0,q}\ar[r]&H^q(P^\bullet\otimes_AM)\ar[r]&E^2_{1,q-1}
\end{tikzcd}\]
which is none other than (\ref{cohomology functor by tensor Noe regular 1 dim exact sequence-1}).
\end{remark}
\begin{corollary}\label{cohomology functor by tensor DVR rank inequality}
Under the hypothesis of \cref{cohomology functor by tensor left exact iff}, suppose that $A$ is a DVR with fraction field $K$, residue field $k$, and that the $T^i(A)$ are finitely generated $A$-modules. Then
\begin{align}\label{cohomology functor by tensor DVR rank inequality-1}
\dim_k(T^p(k))\geq\dim_k(T^p(A)\otimes_Ak)\geq\rank_A(T^p(A))=\dim_K(T^p(K)).
\end{align}
Moreover, for the equality hold, it is necessary and sufficient that $T^p$ is exact, or that $T^p(A)$ and $T^{p+1}(A)$ are free $A$-modules.
\end{corollary}
\begin{proof}
By taking $M=k$ in the exact sequence (\ref{cohomology functor by tensor Noe regular 1 dim exact sequence-1}), we see that
\[\dim_k(T^p(k))=\dim_k(T^p(A)\otimes_Ak)+\dim_k(\Tor_1^A(T^{p+1}(A),k)).\]
On the other hand, as $T^p(A)$ is a finitely generated module over the integral local ring $A$, we have (\cref{local ring reduced finite module free iff})
\[\dim_k(T^p(A)\otimes_Ak)\geq\rank_A(T^p(A))=\rank_K(T^p(A)\otimes_AK)\]
and the equality holds if and only if $T^p(A)$ is a free $A$-module. On the other hand, since $K$ is a flat $A$-module, we have $T^p(A)\otimes_AK=H^p(P^\bullet)\otimes_AK=H^p(P^\bullet\otimes_AK)=T^p(K)$, whence the inequalities in (\ref{cohomology functor by tensor DVR rank inequality-1}). Moreover, by our remarks, the equality holds if and only if $T^p(A)$ is free and $\Tor_1^A(T^{p+1}(A),k)=0$, where ther later conditions means $T^{p+1}(A)$ is a free $A$-module. Finally, the last assertion follows from \cref{cohomology functor on Mod DVR exact iff}.
\end{proof}
Retain the hypothesis of \cref{cohomology functor by tensor left exact iff}, we now consider the function
\[d_p(x)=d_p^T(x)=\dim_{\kappa(x)}(T^p(\kappa(x)))\]
on the space $\Spec(A)$.
\begin{lemma}\label{cohomology functor by tensor rank function base change}
Let $\rho:A\to A'$ be a ring homomorphism and $f:\Spec(A')\to\Spec(A)$ be the corresponding morphism. If we set $T'^\bullet=T^\bullet_{(A')}$, then
\[d_p^{T'}=d_p^T\circ f.\]
\end{lemma}
\begin{proof}
For any $x'\in\Spec(A')$, we have (setting $x=f(x')$)
\[H^\bullet(P^\bullet\otimes_A\kappa(x'))=H^\bullet((P^\bullet\otimes_A\kappa(x))\otimes_{\kappa(x)}\kappa(x'))=H^\bullet((P^\bullet\otimes_A\kappa(x)))\otimes_{\kappa(x)}\kappa(x')\]
since $\kappa(x')$ is flat over $\kappa(x)$, whence the assertion.
\end{proof}
\begin{lemma}\label{cohomology functor by tensor rank function base change}
If $A$ is a Noetherian ring and $P^\bullet$ is a complex of finitely generated flat $A$-modules. Then the function $d_p^T(x)$ is constructible.
\end{lemma}
\begin{proof}
It suffices to prove that for any closed irreducible subset $Y$ of $\Spec(A)$, there exists a nonempty open subset $U$ of $Y$ such that $d_p$ is constant on $U$ (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 9.2.2). As $Y=\Spec(A/\a)$ for some radical ideal $\a$, we can, in view of \cref{cohomology functor by tensor rank function base change}, reduce to the case where $Y=X$ and $A$ is an integral Noetherian domain. But the conclusion then follows from \cref{cohomology functor on Mod T^p truncation exact rank constant}.
\end{proof}
\begin{theorem}\label{cohomology functor by tensor rank function semi-continuous}
Let $A$ be a Noetherian ring, $P^\bullet$ be a complex of finitely generated flat $A$-modules, and $T^\bullet(M)=H^\bullet(P^\bullet\otimes_AM)$ the cohomological functor defined by $P^\bullet$. For each $x\in\Spec(A)$, let $d_p(x)=\dim_{\kappa(x)}(T^p(\kappa(x)))$.
\begin{enumerate}
\item[(a)] The function $d_p$ is constructible and upper semi-continuous on $\Spec(A)$.
\item[(b)] If $T^p$ is exact, then $d_p$ is continuous (hence locally constant) on $\Spec(A)$. The converse is true if $A$ is reduced.
\end{enumerate}
\end{theorem}
\begin{proof}
The fisrt part of assertion (a) follows from \cref{cohomology functor by tensor rank function base change}. To prove the second one, it suffices (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 9.3.4) to show that if $y\rightsquigarrow x$ is a generalization of $x\in\Spec(A)$, then $d_p(y)\leq d_p(x)$. Now, there exists a discrete valuation ring $B$ and a morphism $f:\Spec(B)\to\Spec(A)$ such that, if $a$ denote the closed point of $\Spec(B)$ and $b$ is the genetric point, we have $f(a)=x$ and $f(b)=y$ (\cref{scheme morphism from valuation specturm char}). In view of \cref{cohomology functor by tensor rank function base change}, we are then reduced to prove the inequality $d_p(a)\geq d_p(b)$ in $\Spec(B)$, which is none other than the inequality (\ref{cohomology functor by tensor DVR rank inequality-1}).\par
The first assertion of (b) follows similarly from \cref{cohomology functor by tensor DVR rank inequality} by passing to DVRs. For the converse, we use the criterion of \cref{cohomology functor by tensor exact iff base change to DVR}. In view of \cref{cohomology functor by tensor rank function base change}, we can reduce to the case where $A$ is a DVR. But as $\Spec(A)$ consists of two points, the hypothesis that $d_p$ is continuous implies that $T^p$ is exact, in view of \cref{cohomology functor by tensor DVR rank inequality}.
\end{proof}
\begin{corollary}\label{cohomology functor by tensor rank function on minimal prime prop}
Let $A$ be a Noetherian ring, $(\p_i)_{1\leq i\leq r}$ be its minimal prime ideals, and $k_i$ be the residue field of $\p_i$.
\begin{enumerate}
\item[(a)] For any $x\in\Spec(A)$, there exists an index $i$ such that $d_p(x)\geq\dim_{k_i}(T^p(k_i))$. In particular, if $A$ is integral with fraction field $K$, we have $d_p(x)\geq\dim_K(T^p(K))$.
\item[(b)] Suppose that $A$ is local and reduced, and let $k$ be its residue field. Then, for $T^p$ to be exact, it is necessary and sufficient that for each $1\leq i\leq r$, we have
\begin{align}\label{cohomology functor by tensor rank function on minimal prime prop-1}
\dim_k(T^p(k))=\dim_{k_i}(T^p(k)).
\end{align}
\end{enumerate}
\end{corollary}
\begin{proof}
Assertion (a) is immediate since any neighborhood of $x$ contains one of the $\p_i$, and it suffices to apply the definition of upper semi-continuity. On the other hand, if $A$ is local, the only neighborhood in $\Spec(A)$ of the maximal ideal $\m$ is $\Spec(A)$, so we have $d_p(x)\leq\dim_k(T^p(k))$ for any $x\in\Spec(A)$. Now, the relation (\ref{cohomology functor by tensor rank function on minimal prime prop-1}) then implies that $d_p(x)$ is constant on $\Spec(A)$, and therefore $T^p$ is exact in view of \cref{cohomology functor by tensor rank function semi-continuous}(b). The converse is also evident in view of this, since the specturm of a local ring is connected.
\end{proof}
\subsection{Application to proper morphisms}
\paragraph{The semicontinuity and exchange property}
Let $f:X\to Y$ be a quasi-compact and separated morphis of schemes, and let $\mathscr{P}^\bullet$ be a complex of quasi-coherent $\mathscr{O}_X$-modules. Suppose that each $\mathscr{P}^i$ is a $Y$-flat $\mathscr{O}_X$-module, so that we can consider the $\delta$-functor defined by
\begin{align}\label{scheme qcsp functor defined by tensor}
\mathscr{T}^p(\mathscr{P}^\bullet,\mathscr{M})=\mathscr{T}^p(\mathscr{P}^\bullet,\mathscr{M})=R^pf_*(\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y\mathscr{M}})
\end{align}
where $\mathscr{M}$ is a quasi-coherent $\mathscr{O}_Y$-module. It follows from our hypothesis that $\mathscr{T}^\bullet$ is a cohomological functor on $\mathbf{Qcoh}(Y)$.\par
Now let $g:Y'\to Y$ be a base change morphism, and put $X'=X\times_YY'$, $f'=f_{(Y')}:X'\to Y'$, which is a quasi-compact and separated morphism. Let $\mathscr{P}'^\bullet=\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{O}_{Y'}$, which is a complex of $Y'$-flat $\mathscr{O}_{X'}$-modules. We can then define
\[\mathscr{T}^\bullet_{Y'}=Rf'_*(\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M}')\]
as a cohomological functor on $\mathbf{Qcoh}(Y')$. If $Y'$ is an affine scheme with ring $A'$, then we also write $\mathscr{T}^\bullet_{(A')}$ for $\mathscr{T}^\bullet_{Y'}$. For any $A'$-module $M'$, we then have $\mathscr{T}^\bullet_{A'}(\widetilde{M}')=\widetilde{T^\bullet_{A'}(M')}$, where we set $T^\bullet_{A'}(M')=\Gamma(Y',\mathscr{T}^\bullet_{A'}(\widetilde{M}'))$. Then $T^\bullet_{A'}$ is a cohomological functor on the category of $A'$-modules. We observe that if $Y=\Spec(A)$ is also affine, the functor $T^\bullet_{A'}$ is then the extension of scalars of the functor $T_A^\bullet$: in fact, let $g':X'\to X$ be the bese change morphism of $g$; if $\mathfrak{U}$ is an affine open covering of $X$, $\mathfrak{U}'=g'^{-1}(\mathfrak{U})$ is then an affine open covering of $X'$. In view of (\cite{EGA3}, 6.2.2), it boils down to show that
\[\mathscr{C}^\bullet(\mathfrak{U},\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}g_*(\mathscr{M}'))=\mathscr{C}^\bullet(\mathfrak{U}',\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M}),\]
and finally, that for any affine open $U$ of $X$, if $U'=g^{-1}(U)$, then we have $\Gamma(U,\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}g_*(\mathscr{M}'))=\Gamma(U',\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$, which is trivial. In particular, if $U$ is an open subset of $Y$, we then have
\[\mathscr{T}^\bullet_{U}(\mathscr{M}|_U)=(\mathscr{T}^\bullet(\mathscr{M}))|_U.\]

For any quasi-coherent $\mathscr{O}_Y$-module $\mathscr{M}$, we have a canonical homomorphism
\begin{align}\label{scheme qcsp cohomological functor tensor homomorphism}
\mathscr{T}^p(\mathscr{O}_Y)\otimes_{\mathscr{O}_Y}\mathscr{M}\to\mathscr{T}^p(\mathscr{M}).
\end{align}
In fact, if $Y$ is affine, this is the canonical homomorphism (\ref*{functor on Mod homomorphism on tensor-1}); this definition extends to the general case, since if $U,V$ are two affine opens of $Y$ such that $V\sub U$, the diagram
\[\begin{tikzcd}
(\mathscr{T}^p(\mathscr{O}_Y)\otimes_{\mathscr{O}_Y}\mathscr{M})|_U=\mathscr{T}^p_U(\mathscr{O}_Y|_U)\otimes_{\mathscr{O}_Y|_U}(\mathscr{M}|_U)\ar[r]\ar[d]&\mathscr{T}^p(\mathscr{M}|_U)=(\mathscr{T}^p(\mathscr{M}))|_U\ar[d]\\
(\mathscr{T}^p(\mathscr{O}_Y)\otimes_{\mathscr{O}_Y}\mathscr{M})|_V=\mathscr{T}^p_V(\mathscr{O}_Y|_V)\otimes_{\mathscr{O}_Y|_V}(\mathscr{M}|_V)\ar[r]&\mathscr{T}^p(\mathscr{M}|_V)=(\mathscr{T}^p(\mathscr{M}))|_V
\end{tikzcd}\]
is commutative by (\ref{functor on Mod homomorphism on tensor-2}). Similarly, for any morphism $g:Y'\to Y$, we have a canonical homomorphism
\[\mathscr{T}^p(\mathscr{O}_Y)\otimes_{\mathscr{O}_{Y}}\to\mathscr{T}^p_{Y'}(\mathscr{O}_{Y'})\]
which is none other than the homomorphism (\ref{functor on Mod homomorphism on tensor-4}).\par
If $f$ is a proper morphism, $Y=\Spec(A)$ is a Noetherian affine scheme and $\mathscr{P}^\bullet$ is a \textit{bounded above} complex of $Y$-flat coherent $\mathscr{O}_Y$-modules, we then have (\cite{EGA3}, 6.10.5) an isomorphism $\mathscr{T}^p\stackrel{\sim}{\to}H^\bullet(\mathscr{L}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$, where $\mathscr{L}^\bullet=\widetilde{L}^\bullet$ and $L^\bullet$ is a bounded above complex of free $A$-modules of finite rank. The functor $\mathscr{T}^\bullet$ is then of the type we encountered in \cref{cohomology functor by tensor subsection}, so the corresponding results can be applied.
\begin{theorem}\label{scheme proper Noe functor by flat complex prop}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, and $\mathscr{P}^\bullet$ be a bounded above complex of $Y$-flat coherent $\mathscr{O}_Y$-modules. Then the functor $\mathscr{T}^\bullet$ defined by (\ref{scheme qcsp functor defined by tensor}) satisfies the following conditions.
\begin{enumerate}
\item[(a)] (\textbf{Semi-continuity}) The function $y\mapsto d_p(y)=\dim_{\kappa(y)}(T^p_{(\kappa(y))}(\kappa(y)))$ is upper semi-continuous on $Y$.
\item[(b)] (\textbf{Exchange property}) For any integer $p$, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{T}^p$ is right exact;
\item[(\rmnum{1}')] $\mathscr{T}^p$ is isomorphic to the functor $\mathscr{M}\mapsto\mathscr{N}\otimes_{\mathscr{O}_Y}\mathscr{M}$, where $\mathscr{N}$ is isomorphic to $\mathscr{T}^p(\mathscr{O}_Y)=R^pf_*(\mathscr{P}^\bullet)$; 
\item[(\rmnum{1}'')] the canonical homomorphism (\ref{scheme qcsp cohomological functor tensor homomorphism}) is an isomorphism;
\item[(\rmnum{2})] $\mathscr{T}^{p+1}$ is left exact;
\item[(\rmnum{2}')] $\mathscr{T}^{p+1}$ is isomorphic to the functor $\mathscr{M}\mapsto\sHom_{\mathscr{O}_Y}(\mathscr{Q},\mathscr{M})$, where $\mathscr{M}$ is a coherent $\mathscr{O}_Y$-module uniquely determined up to isomorphism;
\item[(\rmnum{3})] for any affine open $U=\Spec(A)$ of $Y$, the functor $T^p_A$ is right exact;
\item[(\rmnum{4})] for any morphism $g:Y\to Y'$, the canonical homomorphism
\[\mathscr{T}^p(\mathscr{O}_Y)\otimes_{\mathscr{O}_{Y}}\to\mathscr{T}^p_{Y'}(\mathscr{O}_{Y'})\]   
is an isomorphism.
\end{enumerate}
\end{enumerate}
\end{theorem}
\begin{proof}
The semi-continuous property is local over $Y$, hence follows from \cref{cohomology functor by tensor rank function semi-continuous}. It is clear that (\rmnum{1}'') implies (\rmnum{1}') and (\rmnum{1}') implies (\rmnum{1}), and the equivalence of (\rmnum{1}), (\rmnum{1}''), (\rmnum{2}) and (\rmnum{2}') is proved in \cref{cohomology functor by tensor left exact iff} and \cref{cohomology functor on Mod T^p right exact iff} if $Y$ is affine. To pass to general case, we first prove that (\rmnum{1})$\Leftrightarrow$(\rmnum{3}), which shows that property (\rmnum{1}) is local over $Y$; our demonstration will also apply to prove that properties (\rmnum{1}'') and (\rmnum{2}) are local over $Y$. Now it is clear that (\rmnum{3}) implies (\rmnum{1}), so we only need to consider the converse. It evidently suffices to show that for any affine open $U$ of $Y$ and any exact sequence $0\to\mathscr{F}'\to\mathscr{F}\to\mathscr{F}''\to 0$ of quasi-coherent $(\mathscr{O}_Y|_U)$-modules, there exists an exact sequence $\mathscr{O}_Y$-modules whose restriction to $U$ is the given sequence. Now, this follows from the hypothesis that $Y$ is locally Noetherian and (\cref{scheme qcoh extension from retrocompact prop}): we can extend $\mathscr{F}$ (resp. $\mathscr{F}'$) to a quasi-coherent $\mathscr{O}_X$-module $\mathscr{G}$ (resp. sub-$\mathscr{O}_X$-module $\mathscr{G}'$ of $\mathscr{G}$), and it suffices to put $\mathscr{G}''=\mathscr{G}/\mathscr{G}'$.\par
To prove the equivalence of (\rmnum{2}) and (\rmnum{2}') in the general case, we note that if $Y$ is affine, the $\mathscr{O}_Y$-module $\mathscr{Q}$ is determined uniquely up to isomorphism; if $U$ is an affine open of the affine scheme $Y$, then there is a functorial isomorphism
\[\mathscr{T}^{p+1}_U(\mathscr{M}|_U)\stackrel{\sim}{\to}\sHom_{\mathscr{O}_Y|_U}(\mathscr{Q}|_U,\mathscr{M}|_U).\]
In the general case, for any affine open $U$ of $Y$, there exists a coherent $(\mathscr{O}_Y|_U)$-module $\mathscr{Q}_U$ and a functorial isomorphism $\mathscr{T}^{p+1}_U(\mathscr{M}|_U)\stackrel{\sim}{\to}\sHom_{\mathscr{O}_Y|_U}(\mathscr{Q}_U,\mathscr{M}|_U)$; the preceding remark allows us to glue the $\mathscr{Q}_U$ to produce a coherent $\mathscr{O}_Y$-module which satisfies (\rmnum{2}').\par
Finally, we prove the equivalence of (\rmnum{1}) and (\rmnum{4}); it is clear that (\rmnum{4}) is local over $Y$, and we have seen that so is (\rmnum{1}); moreover, (\rmnum{4}) is also local over $Y'$. If $Y=\Spec(A)$ and $Y'=\Spec(A')$, then $T^\bullet_{A'}$ is the extension of scalars of $T^\bullet_A$, and it is clear that (\rmnum{1}') implies (\rmnum{4}). Conversely, suppose that $Y=\Spec(A)$ and let $A'$ be the $A$-algebra $A\oplus M$, where $M$ is a given $A$-module and the multiplication on $A'$ is defined by $(a_1,m_1)(a_2,m_2)=(a_1,a_2,a_1m_2+a_2m_1)$. Then we have
\[T^p_{A'}(A')=T^p(A\oplus M)=T^p(A)\oplus T^p(M)\]
and the hypothesis (\rmnum{4}) implies that the canonical homomorphism $T^p(A)\otimes_AM\to T^p(M)$ is also bijective, so (\rmnum{4}) implies (\rmnum{1}'') and this completes the proof. 
\end{proof}
\begin{theorem}\label{scheme proper Noe flat tensor direct image is sHom}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, and $\mathscr{F}$ be a $Y$-flat coherent $\mathscr{O}_Y$-module. Then there exists a coherent $\mathscr{O}_Y$-module $\mathscr{Q}$ (uniquely determined up to isomorphism) such that there exists an isomorphism of functors on quasi-coherent $\mathscr{O}_Y$-modules $\mathscr{M}$:
\[f_*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\stackrel{\sim}{\to}\sHom_{\mathscr{O}_Y}(\mathscr{Q},\mathscr{M}).\]
\end{theorem}
\begin{proof}
In fact, the functor $\mathscr{T}^0=f_*$ is left exact, so the assertion follows from \cref{scheme proper Noe functor by flat complex prop}.
\end{proof}
\begin{corollary}\label{scheme proper Noe homomorphism of flat ker is sHom}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, $\mathscr{F},\mathscr{F}'$ be $Y$-flat coherent $\mathscr{O}_Y$-modules, and $u:\mathscr{F}\to\mathscr{F}'$ be a homomorphism. Consider the following functors on quasi-coherent $\mathscr{O}_Y$-modules $\mathscr{M}$:
\begin{gather*}
\mathscr{T}(\mathscr{M})=\ker(f_*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\to f_*(\mathscr{F}'\otimes_{\mathscr{O}_Y}\mathscr{M})),\\
T(\mathscr{M})=\Gamma(Y,\mathscr{T}(\mathscr{M}))=\ker(\Gamma(X,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\to\Gamma(X,\mathscr{F}'\otimes_{\mathscr{O}_Y}\mathscr{M})).
\end{gather*}
Then there exists a coherent $\mathscr{O}_Y$-module $\mathscr{R}$ (uniquely determined up to isomorphism) and isomorphisms of functors
\begin{align}\label{scheme proper Noe homomorphism of flat ker is sHom-1}
\mathscr{T}(\mathscr{M})\stackrel{\sim}{\to}\sHom_{\mathscr{O}_Y}(\mathscr{R},\mathscr{M}),\quad T(\mathscr{M})\stackrel{\sim}{\to}\Hom_{\mathscr{O}_Y}(\mathscr{R},\mathscr{M}).
\end{align}
\end{corollary}
\begin{proof}
It suffices to consider the functor $T(\mathscr{M})$, so by \cref{scheme proper Noe flat tensor direct image is sHom} there exists two coherent $\mathscr{O}_Y$-modules $\mathscr{Q}$, $\mathscr{Q}'$ defining functorial isomorphisms
\[\Gamma(X,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\stackrel{\sim}{\to}\Hom_{\mathscr{O}_Y}(\mathscr{Q},\mathscr{M}),\quad \Gamma(X,\mathscr{F}'\otimes_{\mathscr{O}_Y}\mathscr{M})\stackrel{\sim}{\to}\Hom_{\mathscr{O}_Y}(\mathscr{Q}',\mathscr{M}).\]
Now, $u:\mathscr{F}\to\mathscr{F}'$ defines a morphism of functors
\[\Gamma(X,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\to\Gamma(X,\mathscr{F}'\otimes_{\mathscr{O}_Y}\mathscr{M})\]
which corresponds to a unique homomorphism $v:\mathscr{Q}'\to\mathscr{Q}$ such that the diagram
\[\begin{tikzcd}
\Gamma(X,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\ar[d,"\sim"]\ar[r]&\Gamma(X,\mathscr{F}'\otimes_{\mathscr{O}_Y}\mathscr{M})\ar[d,"\sim"]\\
\Hom_{\mathscr{O}_Y}(\mathscr{Q},\mathscr{M})\ar[r]&\Hom_{\mathscr{O}_Y}(\mathscr{Q}',\mathscr{M})
\end{tikzcd}\]
is commutative. As the covariant functor $\mathscr{N}\mapsto\Hom_{\mathscr{O}_Y}(\mathscr{N},\mathscr{M})$ is left exact, it then suffices to put $\mathscr{R}=\coker v$.
\end{proof}
\begin{corollary}\label{scheme proper Noe functor Hom from fp is sHom}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, $\mathscr{F},\mathscr{G}$ be coherent $\mathscr{O}_X$-modules satisfying the following conditions:
\begin{enumerate}
\item[(a)] $\mathscr{F}$ is $Y$-flat;
\item[(b)] $\mathscr{G}$ is isomorphic to the cokernel of a homomorphism of locally free $\mathscr{O}_X$-modules $\mathscr{E}_1\to\mathscr{E}_0$.
\end{enumerate}
Consider the following functors on quasi-coherent $\mathscr{O}_Y$-modules $\mathscr{M}$:
\begin{gather*}
\mathscr{T}(\mathscr{M})=f_*(\sHom_{\mathscr{O}_Y}(\mathscr{G},\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})),\\
T(\mathscr{M})=\Gamma(Y,\mathscr{T}(\mathscr{M}))=\Hom_{\mathscr{O}_X}(\mathscr{G},\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M}).
\end{gather*}
Then there exsits a coherent $\mathscr{O}_Y$-module $\mathscr{N}$ (uniquely deteremined up to isomorphism) and isomorphisms of functors
\[\mathscr{T}(\mathscr{M})\stackrel{\sim}{\to}\sHom_{\mathscr{O}_Y}(\mathscr{N},\mathscr{M}),\quad T(\mathscr{M})\stackrel{\sim}{\to}\Hom_{\mathscr{O}_Y}(\mathscr{N},\mathscr{M}).\]
\end{corollary}
\begin{proof}
We have functorial isomorphisms
\[\sHom_{\mathscr{O}_X}(\mathscr{E}_i,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\stackrel{\sim}{\to}\check{\mathscr{E}}_i\otimes_{\mathscr{O}_X}(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\stackrel{\sim}{\to}(\check{\mathscr{E}}_i\otimes_{\mathscr{O}_X}\mathscr{F})\otimes_{\mathscr{O}_Y}\mathscr{M}\stackrel{\sim}{\to}\sHom_{\mathscr{O}_X}(\mathscr{E}_i,\mathscr{F})\otimes_{\mathscr{O}_Y}\mathscr{M}\]
for $i=0,1$. Put $\mathscr{F}_i=\sHom_{\mathscr{O}_X}(\mathscr{E}_i,\mathscr{F})$, which are $Y$-flat coherent $\mathscr{O}_X$-modules, and let $u:\sHom(v,1_\mathscr{F}):\mathscr{F}_0\to\mathscr{F}_1$. In view of the left exactness of the functor $\sHom_{\mathscr{O}_X}(-,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})$, we have functorial isomorphisms
\begin{align*}
\sHom_{\mathscr{O}_X}(\mathscr{G},\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})&\stackrel{\sim}{\to}\ker(\sHom_{\mathscr{O}_X}(\mathscr{E}_0,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\to \sHom_{\mathscr{O}_X}(\mathscr{E}_1,\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M}))\\
&\stackrel{\sim}{\to}\ker(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M}\to\mathscr{F}_1\otimes_{\mathscr{O}_Y}\mathscr{M}).
\end{align*}
Since $f_*$ is left exact, we then deduce functorial isomorphisms
\[f_*(\sHom_{\mathscr{O}_X}(\mathscr{G},\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M}))\stackrel{\sim}{\to}\ker(f_*(\mathscr{F}_0\otimes_{\mathscr{O}_Y}\mathscr{M})\to f_*(\mathscr{F}_1\otimes_{\mathscr{O}_Y}\mathscr{M}))\]
and it suffices to apply \cref{scheme proper Noe homomorphism of flat ker is sHom}.
\end{proof}
\begin{remark}
In \cref{scheme proper Noe flat tensor direct image is sHom}, \cref{scheme proper Noe homomorphism of flat ker is sHom} and \cref{scheme proper Noe functor Hom from fp is sHom}, the formation of the $\mathscr{O}_Y$-modules $\mathscr{Q}$, $\mathscr{R}$, $\mathscr{N}$ commutes with base changes. For example, in \cref{scheme proper Noe flat tensor direct image is sHom}, let $g:Y'\to Y$ be a base change morphism. Then we have, for any quasi-coherent $\mathscr{O}_{Y'}$-module $\mathscr{M}'$, the isomorphisms
\[f'_*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})\stackrel{\sim}{\to}\sHom_{\mathscr{O}_{Y'}}(g^*(\mathscr{Q}),\mathscr{M}')\]
because in view of the adjunction property, we have
\[\Hom_{\mathscr{O}_Y}(\mathscr{Q},g_*(\mathscr{M}'))=\Hom_{\mathscr{O}{Y'}}(g^*(\mathscr{Q}),\mathscr{M}').\]
Similarly, if in \cref{scheme proper Noe homomorphism of flat ker is sHom} we replace $Y,f,\mathscr{M},\mathscr{F},\mathscr{F}'$ by $Y',f',\mathscr{M}',\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{O}_{X'},\mathscr{F}'\otimes_{\mathscr{O}_X}\mathscr{O}_{X'}$, then it is necessary to replace $\mathscr{R}$ by $g^*(\mathscr{R})$.
\end{remark}
\begin{remark}
The condition (b) of \cref{scheme proper Noe functor Hom from fp is sHom} on $\mathscr{G}$ is satisfied for any $\mathscr{G}$ if there exists a $Y$-ample $\mathscr{O}_X$-module. In fact, it suffices to note that there exists a locally free $\mathscr{O}_X$-module $\mathscr{E}_0$ such that $\mathscr{G}$ is isomorphic to a quotient of $\mathscr{E}_0$ (\cref{scheme ample sheaf iff global generation}). As $\mathscr{E}_0$ and $\mathscr{G}$ are coherent, the kernel $\mathscr{G}_1$ of $\mathscr{E}_0\to\mathscr{G}$ is also coherent, and by applying the same reasoning to $\mathscr{G}_1$, we obtain an exact sequence $\mathscr{E}_1\to\mathscr{E}_0\to\mathscr{G}\to 0$, where $\mathscr{E}_0$ and $\mathscr{E}_1$ are locally free of finite type.
\end{remark}
\begin{proposition}\label{scheme proper Noe functor by flat complex right exact local char}
Under the hypothesis of \cref{scheme proper Noe functor by flat complex prop}, let $y$ be a point of $Y$ and $p$ be an integer. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] the functor $T^p_{\mathscr{O}_{Y,y}}$ is right exact;
\item[(\rmnum{2})] the canonical homomorphism $T^p_{\mathscr{O}_{Y,y}}(\mathscr{O}_{Y,y})\to T^p_{\mathscr{O}_{Y,y}}(\kappa(y))$ is surjective;
\item[(\rmnum{3})] for any integer $n$, the canonical homomorphism $T^p_{\mathscr{O}_{Y,y}}(\mathscr{O}_{Y,y}/\m_y^{n+1})\to T^p_{\mathscr{O}_{Y,y}}(\kappa(y))$ is surjective.
\end{enumerate}
Moreover, the set of $y\in Y$ verifying these conditions is exactly the open subset $U$ of $Y$ such that $\mathscr{T}^p_U$ is right exact.
\end{proposition}
\begin{proof}
The equivalence of (\rmnum{1}), (\rmnum{2}), (\rmnum{3}) follows from \cref{cohomology functor by tensor Noe adic completion prop} and \cref{functor on Mod Noe local right exact iff}. The fact that the set $U$ where $T^p_{\mathscr{O}_{Y,y}}$ is right exact is open is a concequence of \cref{cohomology functor by tensor Noe left exact set open}, and conversely if $\mathscr{T}^p_V$ is right exact, so is $T^p_{\mathscr{O}_{Y,y}}$ for any $y\in V$, by the condition (\rmnum{3}) of \cref{scheme proper Noe functor by flat complex prop} and \cref{cohomology functor by tensor exact base change}.
\end{proof}
\begin{corollary}
If $\mathscr{T}^p$ is right exact (resp. left exact), then, for any morphism $g:Y'\to Y$, $\mathscr{T}^p_{Y'}$ is right exact (resp. left exact). The converse is ture if the morphism $g$ is faithfully flat.
\end{corollary}
\begin{proof}
The first assertion follows immediately from \cref{cohomology functor by tensor exact base change} and the fact that the question is local on $Y$ and $Y'$, in view of \cref{scheme proper Noe functor by flat complex prop}(\rmnum{2}) and (\rmnum{3}). To prove the second assertion, it suffices to show that for any $y\in Y$, $T^p_{\mathscr{O}_{Y,y}}$ is right exact (resp. left exact). But by our hypothesis, there exists $y'\in Y'$ such that $g(y)=y'$ and $\mathscr{O}_{Y',y'}$ is fiathfully flat over $\mathscr{O}_{Y,y}$, so the assertion follows from \cref{cohomology functor by tensor exact base change}.
\end{proof}
\paragraph{Cohomological flatness}
Let $X,Y$ be schemes, $f:X\to Y$ be a quasi-compact and separated morphism, $\mathscr{P}^\bullet$ be a complex of $Y$-flat quasi-coherent $\mathscr{O}_X$-modules, $\mathscr{T}^\bullet$ be the cohomological functor defined by $\mathscr{P}^\bullet$, and $y$ be a point of $Y$. We say that $\mathscr{P}^\bullet$ is \textbf{cohomologically flat over $\bm{Y}$ at the point $\bm{y}$, in dimension $\bm{p}$}, if there exists an open neighborhood $U$ of $y$ in $Y$ such that $\mathscr{T}^p_U$ is exact. We say $\mathscr{P}^\bullet$ is \textbf{cohomologically flat in dimension $\bm{p}$ over $\bm{Y}$} if it is cohomologically flat over $Y$ at every point $y\in Y$, in dimension $p$.\par
If $\mathscr{P}^\bullet$ is cohomologically flat over $Y$ (resp. over $Y$ at point $y$) for any dimension $p$, we simply say that $\mathscr{P}^\bullet$ is \textbf{cohomologically flat over $\bm{Y}$} (resp. over $Y$ at $y$). By definition, the notion of cohomologically flatness is local over $Y$. If $Y$ is locally Noetherian, then for $\mathscr{P}^\bullet$ to be cohomologically flat over $Y$ in dimension $p$, it is necessary and sufficient that the functor $\mathscr{T}^p$ is exact (for this, mimic the proof \cref{scheme proper Noe functor by flat complex prop}).
\begin{proposition}\label{cohomologically flat at point iff}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, $\mathscr{P}^\bullet$ be a bounded above complex of $Y$-flat coherent $\mathscr{O}_X$-modules, $\mathscr{T}^\bullet$ be the cohomological functor defined by $\mathscr{P}^\bullet$. For any $y\in Y$, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{P}^\bullet$ is cohomologically flat over $Y$ at $y$ in dimension $p$;
\item[(\rmnum{2})] the functor $\mathscr{T}^p$ is exact;
\item[(\rmnum{3})] there exists an integer $n_0$ such that for $n\geq n_0$, we have
\begin{align}\label{cohomologically flat at point iff-1}
\ell_{\mathscr{O}_{Y,y}}(T^p_{\mathscr{O}_{Y,y}}(\mathscr{O}_{Y,y}/\m_y^{n+1}))=\ell_{\mathscr{O}_{Y,y}}(T^p_{\mathscr{O}_{Y,y}}(\kappa(y)))\cdot\ell_{\mathscr{O}_{Y,y}}(\mathscr{O}_{Y,y}/\m_y^{n+1}).
\end{align}
\item[(\rmnum{4})] there exists an open neighborhood $U$ of $y$ such that $R^pf_*(\mathscr{P}^\bullet)|_U$ is isomorphic to $(\mathscr{O}_Y|_U)^n$ and that, for any quasi-coherent $(\mathscr{O}_Y|_U)$-module $\mathscr{M}$, the canonical homomorphism
\begin{align}\label{cohomologically flat at point iff-2}
((R^pf_*(\mathscr{P}^\bullet))|_U)\otimes_{\mathscr{O}_Y|_U}\mathscr{M}\to R^pf_*((\mathscr{P}^\bullet|_U)\otimes_{\mathscr{O}_Y|_U}\mathscr{M})
\end{align}
is bijective.
\end{enumerate}
If these conditions are verified, then we have the following:
\begin{enumerate}
\item[(\rmnum{5})] There exists an open neighborhood $U$ of $y$ such that the function $d_p$ of \cref{cohomology functor by tensor rank function semi-continuous} is constant in $U$.
\end{enumerate}
Moreover, if $Y$ is reduced at the point $y$, then (\rmnum{5}) is equivalent to the above conditions.
\end{proposition}
\begin{proof}
In fact, condition (\rmnum{2}) is equivalent to say that $T^p_{\mathscr{O}_{Y,y}}$ and $T^{p-1}_{\mathscr{O}_{Y,y}}$ are right exact, so the equivalence of (\rmnum{1}) and (\rmnum{2}) are clear. As $\mathscr{O}_{Y,y}/\m_y^{n+1}$ is Artinian, and that $T^p_{\mathscr{O}_{Y,y}}(\mathscr{O}_{Y,y}/\m_y^{n+1})$ and $T^p_{\mathscr{O}_{Y,y}}(\kappa(y))$ are finitely generated $(\mathscr{O}_{Y,y}/\m_y^{n+1})$-modules, hence of finite length, so the equivalence of (\rmnum{2}) and (\rmnum{3}) follows from \cref{scheme proper Noe functor by flat complex right exact local char} and \cref{cohomology functor on Mod Artian T^p exact iff}. The fact that (\rmnum{1}) implies (\rmnum{5}), and the equivalence if $Y$ is reduced at $y$, all results from \cref{cohomology functor by tensor rank function semi-continuous}. Finally, (\rmnum{1}) implies that $(R^pf_*(\mathscr{P}^\bullet))_y$ is a flat $\mathscr{O}_{Y,y}$-module (\cref{cohomology functor on Mod T^p exact iff}(\rmnum{4}')), hence free since it is finitely generated over $\mathscr{O}_{Y,y}$. Since $R^pf_*(\mathscr{P}^\bullet)$ is coherent, this implies $R^pf_*(\mathscr{P}^\bullet)$ is free over an open neighborhood of $y$ (\cref{sheaf of module ft local prop}). Conversely, it is clear that (\rmnum{4}) implies (\rmnum{1}) by the definition of $\mathscr{T}^p_U$.
\end{proof}
\begin{proposition}\label{cohomologically flat truncation iff locally free}
Under the hypothesis of \cref{cohomologically flat at point iff}, the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $\mathscr{P}^\bullet$ is cohomologically flat over $Y$ in dimension $i\geq p$;
\item[(\rmnum{2})] for $i\geq p-1$, the functors $\mathscr{T}^i$ are right exact;
\item[(\rmnum{3})] for $i\geq p$, the $\mathscr{O}_X$-modules $R^if_*(\mathscr{P}^\bullet)$ is locally free.
\end{enumerate}
\end{proposition}
\begin{proof}
The equivalence of (\rmnum{1}) and (\rmnum{2}) is verified in \cref{cohomology functor on Mod T^p exact iff} and (\rmnum{1}) implies (\rmnum{3}) in view of \cref{cohomologically flat at point iff}(\rmnum{4}). Conversely, assume that (\rmnum{3}) is satisfied; since the question is local over $Y$, we may assume that $Y=\Spec(A)$ is affine. In this case, since $\mathscr{P}^\bullet$ is bounded above, we then have $\mathscr{T}^\bullet\stackrel{\sim}{\to}H^\bullet(\mathscr{L}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$, where $\mathscr{L}^\bullet=\widetilde{L}^\bullet$ and $L^\bullet$ is a bounded above complex of free $A$-modules of finite rank. Then the functor $T^i$ is exact for $i\gg 0$, and by our hypothesis, $T^i(A)$ is a free $A$-module for $i\geq p$. We conclude from \cref{cohomology functor on Mod T^p} that $\mathscr{T}^i=T^i$ is exact for $i\geq p$.
\end{proof}
We usually apply the criterions of cohomologically flatness to the case where the complex $\mathscr{P}^\bullet$ has a single nonzero term $\mathscr{F}$ at degree $0$. In this case, we have $\mathscr{T}^p(\mathscr{M})=T^pf_*(\mathscr{F}\otimes_{\mathscr{O}_Y}\mathscr{M})$.
\begin{proposition}\label{scheme cohomologically flat dim 0 if separable fiber}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a flat and proper morphism, $y$ be a point of $Y$. Suppose that $\Gamma(X_y,\mathscr{O}_{X_y})=R$ is a separated $\kappa(y)$-algebra. Then $\mathscr{O}_{X}$ is cohomologically flat over $Y$ at point $y$ in dimension $0$.
\end{proposition}
\begin{proof}
In view of \cref{cohomologically flat at point iff}, we may assume that $Y$ is the spectrum of $A=\mathscr{O}_{Y,y}$. Since $f$ is exact, we can choose $\mathscr{F}=\mathscr{O}_X$ to define the functor $T^\bullet$, and it is clear that $T^0$ is left exact. It then remains to prove that $T^0$ is right exact, to which we can reduce to the case where $A=\mathscr{O}_{Y,y}$ is an Artinian ring (\cref{scheme proper Noe functor by flat complex right exact local char}(\rmnum{3})). Let $k'$ be a finite extension of $\kappa(y)$ so that $R\otimes_{\kappa(y)}k'$ is a direct product of finitely many fields isomorphic to $k'$. Since there exists a local homomorphism from $A$ to a local ring $A'$, which is a free $A$-algebra and such that the residue field of $A'$ is isomorphic to $k'$ (\cite{EGA3} $0_{\text{\Rmnum{3}}}$, 10.3.2), we can, in view of \cref{cohomology functor by tensor exact base change}, assume further that $R$ is isomorphic to a direct product of $m$ fields isomorphic to $\kappa(y)$. In this case, it is easy to see that the fiber $X_y$ has exactly $m$ connected components $X'_i$, and $\Gamma(X'_i,\mathscr{O}_{X'_i})=\kappa(y)$ for each $i$. Since $A$ is now a local Artinian ring, its spectrum is reduced to a singleton, so $X$ and $X_y$ have the same underlying space; in particular, $X$ also has $m$ connected components $X_i$, and $X'_i=X_i\times_Y\kappa(y)$. We can then reduce to the case where $R=\kappa(y)$, and in view of \cref{scheme proper Noe functor by flat complex right exact local char}(\rmnum{2}), it suffices to prove that the canonical homomorphism $\Gamma(X,\mathscr{O}_X)\to\Gamma(X_y,\mathscr{O}_{X_y})$ is surjective. But this is trivial, since the composition
\[\Gamma(Y,\mathscr{O}_Y)=A\to\Gamma(X,\mathscr{O}_X)\to\Gamma(X_y,\mathscr{O}_{X_y})=\kappa(y)\]
is surjective.
\end{proof}
\begin{corollary}\label{scheme morphism flat proper separable fiber prop}
Under the hypothesis of \cref{scheme cohomologically flat dim 0 if separable fiber}, there exists an open neighborhood $U$ of $y$ such that:
\begin{enumerate}
\item[(a)] $f_*(\mathscr{O}_X)|_U$ is isomorphic to $(\mathscr{O}_Y|_U)^m$;
\item[(b)] for any $z\in U$, the canonical homomorphism
\[(f_*(\mathscr{O}_X))_z\otimes_{\mathscr{O}_{Y,z}}\kappa(z)\to\Gamma(X_z,\mathscr{O}_{X_z})\]
is bijective.
\item[(c)] there exists a coherent $\mathscr{O}_U$-module $\mathscr{Q}$ and a functorial isomorphism
\[R^1f_*(f^*(\mathscr{M}))\stackrel{\sim}{\to}\sHom_{\mathscr{O}_U}(\mathscr{Q},\mathscr{M})\]
\end{enumerate}
\end{corollary}
\begin{proof}
Assertion (a) follows from \cref{scheme cohomologically flat dim 0 if separable fiber} and \cref{cohomologically flat at point iff}, and (b), (c) follows from the fact that $\mathscr{T}^0_U$ is exact and \cref{scheme proper Noe functor by flat complex prop}.
\end{proof}
\begin{corollary}
Under the \cref{scheme cohomologically flat dim 0 if separable fiber}, assume that $\Gamma(X_y,\mathscr{O}_{Y,y})=\kappa(y)$. Then there exists an open neighborhood $U$ of $y$ such that the canonical homomorphism $\mathscr{O}_Y|_U$.
\end{corollary}
\begin{proof}
In fact, it follows from \cref{scheme morphism flat proper separable fiber prop} that the integer $m$ in (a) is necessarily equal to $1$.
\end{proof}
\begin{remark}
Under the conditions of \cref{scheme cohomologically flat dim 0 if separable fiber}, consider the Stein factorization
\[\begin{tikzcd}
X\ar[r,"f'"]&Y'\ar[r,"g"]&Y
\end{tikzcd}\]
where $Y'=\Spec(f_*(\mathscr{O}_X))$. The finite morphism $g$ is then such that $g_*(\mathscr{O}_{Y'})=f_*(\mathscr{O}_X)$ is locally free in an neighborhood of $y$, and its fiber at $y$ is the specturm of a separated algebra over $\kappa(y)$ (\cref{scheme S-affine stable under base change}). We shall see later that, there exists an open neighborhood $U$ of $y$ such that for any $z\in U$, the fiber $g^{-1}(z)$ is the spectrum of a separatble $\kappa(z)$-algebra (this is called an \'etale covering of $U$). Therefore, the hypothesis of \cref{scheme cohomologically flat dim 0 if separable fiber} made on $y$ is in fact valid in an open neighborhood of $y$.
\end{remark}
\paragraph{Invariance of Euler characteristic and Hilbert function}
Let $A$ be a ring, $M$ be a finitely generated projective $A$-module (which means $\widetilde{M}$ is locally free on $X=\Spec(A)$). For any $\p\in\Spec(A)$, the rank of $M$ at $\p$ is defined to be the rank of the $A_\p$-module $M_\p$ (or the rank of the locally free $\mathscr{O}_X$-module $\widetilde{M}$ at $\p$). We then have
\begin{align}\label{module complex of proj Euler characteristic by rank-1}
\rank_\p(M)=\rank_\p(M_\p)=\dim_{\kappa(\p)}(M\otimes_A\kappa(\p)).
\end{align}
\begin{proposition}\label{module complex of proj Euler characteristic by rank}
Let $P^\bullet$ be a bounded complex of finitely generated projective $A$-modules, and for any module $M$, let $T^\bullet(M)=H^\bullet(P^\bullet\otimes_AM)$. Then for any $\p\in\Spec(A)$, we have
\begin{align}\label{module complex of proj Euler characteristic by rank-2}
\sum_i(-1)^i\dim_{\kappa(\p)}(T^i(\kappa(\p)))=\sum_i(-1)^i\rank_\p(P^i).
\end{align}
\end{proposition}
\begin{proof}
In fact, by definition we have $T^i(\kappa(\p))=H^i(P^\bullet\otimes_A\kappa(\p))$, and in view of \ref{module complex of proj Euler characteristic by rank-1}, the formula (\ref{module complex of proj Euler characteristic by rank-2}) is none other than the invariance of Euler characteristic of a bounded complex of finite dimensional vector spaces when passing to homology.
\end{proof}
\begin{corollary}\label{module bounded complex of projective Euler characteristic locally constant}
The function
\[\p\mapsto \sum_i(-1)^i\dim_{\kappa(\p)}(T^i(\kappa(\p)))\]
is locally constant on $\Spec(A)$.
\end{corollary}
\begin{proof}
This follows from (\ref{module complex of proj Euler characteristic by rank-2}), since the rank of a finitely projective module $P^i$ is locally constant (\cref{module finite projective iff}).
\end{proof}
\begin{theorem}\label{scheme proper Noe functor by flat complex Euler characteristic locally constant}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, $\mathscr{P}^\bullet$ be a bounded complex of $Y$-flat coherent $\mathscr{O}_X$-modules. Let $T^\bullet$ be the functor defined by (\ref{scheme qcsp functor defined by tensor}), then the function
\begin{align}\label{scheme proper Noe functor by flat complex Euler characteristic locally constant-1}
y\mapsto \sum_i(-1)^i\dim_{\kappa(y)}(T^i(\kappa(y)))
\end{align}
is locally constant on $Y$.
\end{theorem}
\begin{proof}
We may assume that $Y=\Spec(A)$ is affine with ring $A$ Noetherian. Then there exists a complex $L^\bullet$ of finitely generated $A$-modules such that $\mathscr{T}^p(\mathscr{M})\stackrel{\sim}{\to}H^p(\mathscr{L}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$, where $\mathscr{L}^\bullet=\widetilde{L}^\bullet$. As the complex $\mathscr{P}^\bullet$ is bounded (take a finite affine covering $\mathfrak{U}$ of $X$), the double complex $\mathscr{C}^\bullet(\mathfrak{U},\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$ is bounded. More precisely, there exists a finite subset $E$ (independent of $\mathscr{M}$), such that for any $(i,j)\notin E$, we have $\mathscr{C}^i(\mathfrak{U},\mathscr{P}^j\otimes_{\mathscr{O}_Y}\mathscr{M})=0$. From this, we see that there exists an integer $i_0$ such that $\mathscr{T}^i(\mathscr{M})=0$ for any quasi-coherent $\mathscr{O}_Y$-module $\mathscr{M}$ and $i\geq i_0$. In particular, for such values of $i$, $\mathscr{T}^i$ is trivially an exact functor, so by \cref{cohomology functor by tensor left exact iff}, $W^i(L^\bullet)$ is a finitely generated flat (hence projective) $A$-module for such $i$. Consider the complex $(Q^\bullet)$, where $Q^i=L^i$ for $i<i_0$, $Q^{i_0}=W^{i_0}(L^\bullet)$, and $Q^i=0$ for $i>i_0$, and set $\mathscr{Q}^\bullet=\widetilde{Q}^\bullet$. It is clear that $H^i(\mathscr{Q}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})=H^i(\mathscr{L}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$ for $i<i_0-1$ and also for $i\geq i_0$ (the two members being both zero). On the other hand, as $\im(W^{i_0}\otimes_AM)=\im(L^{i_0}\otimes_AM)$ by defintion, we also have $H^i(\mathscr{Q}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})=H^i(\mathscr{L}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{M})$ for $i=i_0-1$. We then see that we may assume that $\mathscr{L}^\bullet$ is a bounded complex, with the weaker assumption that each $\mathscr{L}^i$ is a locally free $\mathscr{O}_Y$-module. The theorem now follows from {module bounded complex of projective Euler characteristic locally constant}.
\end{proof}
Under the condition of \cref{scheme proper Noe functor by flat complex Euler characteristic locally constant}, the function (\ref{scheme proper Noe functor by flat complex Euler characteristic locally constant-1}) is constant if $Y$ is connected. If $Y$ is connected and nonempty, we denote its value by $\chi(f,\mathscr{P}^\bullet)$ or $\chi(Y,\mathscr{P}^\bullet)$, or simply $\chi(\mathscr{P}^\bullet)$ if there is no confusion, and call it the \textbf{Euler characteristic of $\mathscr{P}^\bullet$ relative to $\bm{f}$}. In the general case, we denote by $\chi(f,\mathscr{P}^\bullet;y)$ or $\chi(Y,\mathscr{P}^\bullet;y)$, or simple $\chi(\mathscr{P}^\bullet;y)$ the integer in (\ref{scheme proper Noe functor by flat complex Euler characteristic locally constant-1}).\par
Under the hypothesis of \cref{scheme proper Noe functor by flat complex Euler characteristic locally constant}, let
\[\begin{tikzcd}
0\ar[r]&\mathscr{P}'^\bullet\ar[r,"u"]&\mathscr{P}^\bullet\ar[r,"v"]&\mathscr{P}''^\bullet\ar[r]&0
\end{tikzcd}\]
be an exact sequence of bounded complexes of $Y$-flat coherent $\mathscr{O}_X$-modules, where the homomorphisms $u,v$ are of even degrees $2d,2d'$. Then as $\mathscr{T}^\bullet$ is a cohomological functor, we have an exact sequence
\[\begin{tikzcd}[column sep=3mm]
\cdots\ar[r]&\mathscr{T}^i(\mathscr{P}'^\bullet,\kappa(y))\ar[r]&\mathscr{T}^{i+2d}(\mathscr{P}'^\bullet,\kappa(y))\ar[r]&\mathscr{T}^{i+2d+2d'}(\mathscr{P}'^\bullet,\kappa(y))\ar[r]&\mathscr{T}^{i+1}(\mathscr{P}'^\bullet,\kappa(y))\ar[r]&\cdots
\end{tikzcd}\]
with only finitely many nonzero terms. Since the Euler characteristic of this complex is zero, we conclude that
\begin{align}\label{scheme proper Noe functor by flat complex Euler characteristic additive-1}
\chi(\mathscr{P}^\bullet;y)=\chi(\mathscr{P}'^\bullet;y)+\chi(\mathscr{P}''^\bullet;y)
\end{align}
for any $y\in Y$. By an induction process, it is not hard to see that (by (\ref{scheme proper Noe functor by flat complex Euler characteristic additive-1}))
\begin{align}\label{scheme proper Noe functor by flat complex Euler characteristic additive-2}
\chi(\mathscr{P}^\bullet;y)=\sum_i(-1)^i\chi(\mathscr{P}^i;y)
\end{align}
where for any coherent $\mathscr{O}_X$-module $\mathscr{F}$, flat over $Y$, we denote by $\chi(\mathscr{F};y)$ (or $\chi(f,\mathscr{F};y)$) the function $\chi(\mathscr{L}^\bullet;y)$ corresponding to the complex $\mathscr{L}^\bullet$ with only zero-th term $\mathscr{F}$. Therefore, the study of Euler characteristics is reduced to that of a single coherent $\mathscr{O}_X$-module.
\begin{proposition}\label{scheme proper Noe functor by flat complex Euler characteristic base change invariant}
Under the hypothesis of \cref{scheme proper Noe functor by flat complex Euler characteristic locally constant}, let $Y'$ be a locally Noetherian scheme, $g:Y'\to Y$ be a morphism, $X'=X\times_YY'$, $f'=f_{(Y')}:X'\to Y'$, $\mathscr{P}'^\bullet$ be the bounded complex $\mathscr{P}^\bullet\otimes_{\mathscr{O}_Y}\mathscr{O}_{Y'}$ of coherent $Y'$-flat $\mathscr{O}_{X'}$-modules. Then for $y'\in Y'$, we have
\begin{align}\label{scheme proper Noe functor by flat complex Euler characteristic base change invariant-1}
\chi(\mathscr{P}'^\bullet;y')=\chi(\mathscr{P}^\bullet;g(y')).
\end{align}
\end{proposition}
\begin{proof}
The $\mathscr{O}_{X'}$-modules $\mathscr{P}'^i$ is the inverse image off $\mathscr{P}^i$ under the projection $X'\to X$, hence $Y'$-flat. On the other hand, we see that $f'$ is proper, so the first member of (\ref{scheme proper Noe functor by flat complex Euler characteristic base change invariant-1}) is well-defined. The formula (\ref{scheme proper Noe functor by flat complex Euler characteristic base change invariant-1}) follows from (\cite{EGA3}, 6.10.4.2) and \cref{cohomology functor by tensor rank function base change}, by reducing to the case where $Y'$ and $Y$ are affine.
\end{proof}
\begin{proposition}\label{scheme proper Noe R^pf_* locally free if single nonzero fiber}
Under the hypothesis of \cref{scheme proper Noe functor by flat complex Euler characteristic locally constant}, suppose that there exists an integer $i_0$ such that $T^i(\kappa(y))=0$ for $i\neq i_0$ and any $y\in Y$. Then $\mathscr{T}^{i_0}(\mathscr{O}_Y)=R^{i_0}f_*(\mathscr{P}^\bullet)$ is a locally free $\mathscr{O}_Y$-module, whose rank $n$ is equal to $(-1)^{i_0}\chi(f,\mathscr{P}^\bullet;y)$. 
\end{proposition}
\begin{proof}
Note that the hypothesis of \cref{cohomology functor by tensor Noe left exact set open} is verified, so we can apply \cref{cohomology functor by tensor Noe adic completion prop}, and the hypothesis implies that $T^i_{\mathscr{O}_{Y,y}}$ is zero for $i\neq i_0$ in view of \cref{functor on Mod Noe local zero iff T(k)}. By \cref{cohomology functor on Mod T^p exact iff}, $\mathscr{T}^{i_0}$ is then exact, so by (\cite{EGA3}, 7.8.4), $R^{i_0}f_*(\mathscr{P}^\bullet)$ is locally free with rank at $y\in Y$ equal to
\[\dim_{\kappa(y)}(T^{i_0}(\kappa(y)))=(-1)^{i_0}\chi(f,\mathscr{P}^\bullet;y)\]
by definition, since $T^i(\kappa(y))=0$ for $i\neq i_0$.
\end{proof}
\begin{corollary}\label{scheme proper Noe flat coh R^pf_* locally free if fiber cohomology zero}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a proper morphism, $\mathscr{F}$ be a $Y$-flat coherent $\mathscr{O}_X$-module. Suppose that $R^if_*(\mathscr{F})=0$ for any $i>0$. Then $f_*(\mathscr{F})$ is a locally free $\mathscr{O}_Y$-module, with rank equal to $\chi(f,\mathscr{F};y)$.
\end{corollary}
\begin{proof}
It suffices to prove that $H^i(X_y,\mathscr{F}\otimes_{\mathscr{O}_Y}\kappa(y))=0$ for any $i>0$ and $y\in Y$. For this, we may assume that $Y=\Spec(A)$ is affine. With the notations of \cref{scheme proper Noe functor by flat complex Euler characteristic locally constant}, and $\mathscr{P}^\bullet$ being reduced to a single term $\mathscr{F}$, we have in fact $\mathscr{T}^p(\mathscr{O}_Y)=0$ for $p>0$ by hypothesis. We then conclude from \cref{cohomology functor on Mod T^p exact iff} that $\mathscr{T}^p$ is exact for $p>0$, and the assertion then follows from the equivalence of \cref{scheme proper Noe functor by flat complex prop}(\rmnum{1}) and (\rmnum{4}).
\end{proof}
\begin{proposition}\label{scheme proper Noe Hilber function def}
Under the hypothesis of \cref{scheme proper Noe functor by flat complex Euler characteristic locally constant}, let $\mathscr{L}$ be a very ample $\mathscr{O}_X$-module relative to $Y$, and put $\mathscr{P}^\bullet(n)=\mathscr{P}^\bullet\otimes_{\mathscr{O}_X}\mathscr{L}^{\otimes n}$ for each $n\in\Z$. Then for any $y\in Y$, the function
\[n\mapsto\chi(f,\mathscr{P}^\bullet(n);y)\]
is a polynomial with coefficients in $\Q$, and is locally constant on $Y$.
\end{proposition}
\begin{proof}
It is clear that $\mathscr{P}^\bullet(n)$ is a complex of $Y$-flat $\mathscr{O}_X$-modules. In view of (\ref{scheme proper Noe functor by flat complex Euler characteristic additive-2}), we can assume that $\mathscr{P}^\bullet$ has a single nonzero term $\mathscr{F}$ at degree $0$. Moreover, as the question is local on $Y$, we may reduce to the case where $Y$ is affine and $f$ is projective. Put $X_y=f^{-1}(y)$ and let $\mathscr{L}_y=\mathscr{L}\otimes_{\mathscr{O}_Y}\kappa(y)$, which is a very ample $\mathscr{O}_{X_y}$-module (\cref{scheme very ample permanence prop}). For the functor $\mathscr{T}^\bullet$ defined by $\mathscr{P}^\bullet(n)$, we then have
\[T^i(\kappa(y))=H^i(X_y,\mathscr{F}_y\otimes\mathscr{L}_y^{\otimes n})\]
where $\mathscr{F}_y=\mathscr{F}\otimes_{\mathscr{O}_{Y}}\kappa(y)$. In this case, $\chi(f,\mathscr{F}(n);y)$ is none other than the Euler characteristic $\chi_{\kappa(y)}(\mathscr{F}_y(n))$ defined in (\cite{EGA3}, 2.5.1). The fact that $\chi(f,\mathscr{P}^\bullet(n);y)$ is a rational polynomial then follows from (\cite{EGA3}, 2.5.3). Moreover, for each $n$, this number is locally constant by \cref{module bounded complex of projective Euler characteristic locally constant}, whence our assertion.
\end{proof}
We denote by $P(f,\mathscr{P}^\bullet;y)$ or $P(\mathscr{P}^\bullet;y)$ the polynomial of \cref{scheme proper Noe Hilber function def}, with rational coefficients, and call it the \textbf{Hilbert polynomial} at $y$ relative to $\mathscr{P}^\bullet$, $f$ and $\mathscr{L}$ (or simply the Hilbert polynomial of $\mathscr{P}^\bullet$ at $y$, or of $f$, if there is no confusion). From the properties of $\chi(f,\mathscr{P}^\bullet;y)$, we have 
\begin{align}\label{scheme proper Noe Hilber polynomial additive-1}
P(\mathscr{P}^\bullet;y)=P(\mathscr{P}'^\bullet;y)+P(\mathscr{P}''^\bullet;y)
\end{align}
for an exact sequence $0\to\mathscr{P}^\bullet\to\mathscr{P}'^\bullet\to\mathscr{P}''^\bullet\to 0$, and in particular
\begin{align}\label{scheme proper Noe Hilber polynomial additive-2}
P(\mathscr{P}^\bullet;y)=\sum_i(-1)^iP(\mathscr{P}^\bullet;y).
\end{align}
Similarly, with the hypotheses and notations of \cref{scheme proper Noe functor by flat complex Euler characteristic base change invariant}, we have
\begin{align}\label{scheme proper Noe Hilber polynomial additive-3}
P(\mathscr{P}'^\bullet;y')=P(\mathscr{P}^\bullet;g(y')).
\end{align}
The formula (\ref{scheme proper Noe Hilber polynomial additive-2}) reduces the study of Hilber functions to that of a single $Y$-flat $\mathscr{O}_X$-module. In this case, this polynomial has an interpretation which does not depend on cohomology.
\begin{corollary}\label{scheme proper Noe f_*F(n) locally free prop}
Let $Y$ be a Noetherian scheme, $f:X\to Y$ be a projective morphism, $\mathscr{L}$ be a very ample $\mathscr{O}_X$-module relative to $Y$, $\mathscr{F}$ be a $Y$-flat coherent $\mathscr{O}_X$-module. Then there exists an integer $n_0$ such that for $n\geq n_0$, $f_*(\mathscr{F}(n))$ is a locally free $\mathscr{O}_Y$-module whose rank at $t\in Y$ is equal to $P(f,\mathscr{F};y)(n)$.
\end{corollary}
\begin{proof}
As the morphism $f$ is projective, by \cref{scheme morphism projective cohomology of coh prop} there exists $n_0$ such that for $n\geq n_0$, we have $R^if_*(\mathscr{F}(n))=0$ for $i>0$. The conclusion then follows from \cref{scheme proper Noe flat coh R^pf_* locally free if fiber cohomology zero}.
\end{proof}
\begin{proposition}\label{scheme proper Noe flat iff f_*F(n) locally free}
Let $Y$ be a Noetherian scheme, $f:X\to Y$ be a projective morphism, $\mathscr{L}$ be a ample $\mathscr{O}_X$-module relative to $f$, and put $\mathscr{F}(n)=\mathscr{F}\otimes_{\mathscr{O}_X}\mathscr{L}^{\otimes n}$ for any $\mathscr{O}_X$-module $\mathscr{F}$ and $n\in\Z$. For a coherent $\mathscr{O}_X$-module $\mathscr{F}$ to be $Y$-flat, it is necessary and sufficient that there exists an integer $n_0$ such that, for $n\geq n_0$, $f_*(\mathscr{F}(n))$ is a locally free $\mathscr{O}_Y$-module.
\end{proposition}
\begin{proof}
The necessarity of this condition is proved in \cref{scheme proper Noe f_*F(n) locally free prop}. To prove the converse, we can assume that $Y$ is affine with ring $A$. In view of the hypothesis and \cref{scheme morphism projective cohomology of coh prop}, the $A$-modules $\Gamma(X,\mathscr{F}(n))$ are finitely generated and projective (\cref{module finite projective iff}). Let $S$ be the graded ring $\Gamma_{n\geq 0}\Gamma(X,\mathscr{L}^{\otimes n})$; then $X$ is canonically idetified with $\Proj(S)$ (\cref{scheme ample sheaf iff}(\rmnum{2}) and \cref{scheme proper morphism into Proj is proper}). Let $M=\bigoplus_{n\geq n_0}\Gamma(X,\mathscr{F}(n))$; by replacing $\mathscr{L}$ with a power $\mathscr{L}^{\otimes d}$, we may assume that $S$ is generated by finitely many elements of degree $1$ (\cref{scheme Proj unchanged if alter ring}), and it then follows from \cref{scheme Proj qc beta isomorphism} and \cref{scheme Proj qc associated ft zero iff} that $\mathscr{F}$ is identified with $\widetilde{M}$. For a homogeneous element $g\in S$ of positive degere, we then have $\Gamma(X_g,\mathscr{F})=M_{(g)}$. Now $M$, a sum of projective modules, is a flat $A$-module, hence so is $M_g$, and therefore also $M_{(g)}$, which is a direct factor of $M_g$. We then conclude that $\mathscr{F}$ is $Y$-flat at any point of $X_g$, and as the $X_g$ cover $X$, the assertion is proved.
\end{proof}
\chapter{Local study of schemes and morphisms of schemes}
\section{Unramified morphisms, smooth morphisms and \'etale morphisms}
In this section, we introduce the notions of unramified morphisms, smooth morphisms and \'etale morphisms between schemes. These three classes of morphisms are analogues of the following types of maps of manifolds in differential geometry.
\begin{itemize}
\item \textbf{Submersions} are maps inducing surjections of tangent spaces everywhere. They are useful in the notion of a fibration. (Perhaps a more relevant notion from differential geometry, allowing singularities, is "locally on the source a smooth fibration".)
\item \textbf{Immersions} are maps inducing injections of tangent spaces. They can be thought as a generalized notion for submanifolds.
\item \textbf{Local isomorphisms} are maps inducing isomorphisms of tangent spaces. They are be viewed as covering spaces of manifolds.
\end{itemize}
\subsection{Formally unramification and formally smoothness}
Let $f:X\to Y$ be a morphism of schemes. We say that $f$ is \textbf{formally smooth} (resp. \textbf{formally unramified}) if for any affine scheme $Y'$ over $Y$ and any closed subscheme $Y_0'$ of $Y'$ defined by a square zero ideal $\mathscr{I}$ of $\mathscr{O}_{Y'}$, the canonical map
\begin{align}\label{scheme formally smooth unramified canonical map}
\Hom_Y(Y',X)\to\Hom_Y(Y_0',X)
\end{align}
is surjective (resp. injective). In this case, we say that $X$ is formally smooth (resp. formally unramified) over $Y$. If $X$ is both formally smooth and formally unramified over $Y$, then it is said to be \textbf{\'etale} over $Y$.
\begin{example}\label{scheme affine formally smooth unramified iff algebra}
Suppose that $Y=\Spec(A)$ and $X=\Spec(B)$ are affine schemes, so that the morphism $f$ corresponds to a ring homomorphism $\varphi:A\to B$. Then $X$ is formally smooth (resp. formally unramified) over $Y$ if and only if $B$ is a formally smooth (resp. formally unramified) $A$-algebra.
\end{example}
\begin{example}\label{scheme formally smooth etale lifting for locally nilpotent}
In view of the proof of \cref{algebra formally smooth lifting for complete algebras}, if a morphism $f:X\to Y$ is formally smooth (resp. formally unramified), then for any affine scheme $Z$ over $Y$ and any closed subscheme $Z_0$ of $Z$ defined by a nilpotent ideal $\mathscr{I}$ of $\mathscr{O}_Z$, the canonical map
\[\Hom_Y(Z,X)\to\Hom_Y(Z_0,X)\]
is surjective (resp. injective), so we can also take this as the definition of formally unramification (resp. formally smoothness). We also note that if $f$ is formally smooth (resp. formally \'etale), then for an \textit{arbitrary} scheme $Z$ over $Y$ and any closed subscheme $Z_0$ of $Z$ defined by a locally nilpotent ideal $\mathscr{I}$ of $\mathscr{O}_Z$, the canonical map
\[\Hom_Y(Z,X)\to\Hom_Y(Z_0,X)\]
is surjective (resp. bijective). To see this, let $(U_\alpha)$ be an open affine covering of $Z$ such that the ideal $\mathscr{I}|_{U_\alpha}$ is nilpotent, and for each $\alpha$, let $U_\alpha^0$ be the inverse image of $U_\alpha$ in $Z_0$, which is the closed subscheme of $U_\alpha$ defined by $\mathscr{I}|_{U_\alpha}$. Let $f_0:Z_0\to X$ be a $Y$-morphism, then by the hypotheses and \cref{algebra formally smooth lifting for complete algebras}, for any $\alpha$, there is a (resp. unique) $Y$-morphism $f_\alpha:U_\alpha\to X$ whose restriction to $U_\alpha^0$ equals to $f_0|_{U_\alpha^0}$. Since $f_\alpha$ and $f_\beta$ then coincide on any affine open of $U_\alpha\cap U_\beta$, we conclude that there exists a (resp. unique) morpism $f:Z\to X$ whose restriction to $Z_0$ is equal to $f_0$.
\end{example}
\begin{proposition}[\textbf{Properties of Formally Unramified and Formally Smooth Morphisms}]\label{scheme formally unramified smooth permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] A monomorphism is formally unramified, and an open immersion is formally \'etale.
\item[(\rmnum{2})] The composition of two formally smooth (resp. formally unramified) morphisms is formally smooth (resp. formally unramified).
\item[(\rmnum{3})] If $f:X\to Y$ is a formally smooth (resp. formally unramified) $S$-morphism, so is $f_{(S')}:X_{(S')}\to Y_{(S')}$ for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:Y\to Y'$ are two formally smooth (resp. formally unramified) $S$-morphisms, $f\times_Sg$ is formally smooth (resp. formally unramified).
\item[(\rmnum{5})] Let $f:X\to Y$ and $g:Y\to Z$ be two morphisms. If $g\circ f$ is formally unramified, so is $f$.
\item[(\rmnum{6})] If $f:X\to Y$ is a formally unramified morphism, so is $f_{\red}:X_{\red}\to Y_{\red}$.
\end{enumerate}
\end{proposition}
\begin{proof}
In view of \cref{scheme morphism arbitrary calcelled if} and \cref{scheme morphism cancelled by separated if}, it suffices to prove (\rmnum{1}), (\rmnum{2}) and (\rmnum{3}). The two assertions of (\rmnum{1}) are trivial by definition. To prove (\rmnum{2}), consider two morphisms $f:X\to Y$, $g:Y\to Z$, an affine scheme $Z'$ over $Z$, a closed subscheme $Z'_0$ of $Z'$ defined by a square zero ideal. Suppose that $f$ and $g$ are formally smooth, and consider a $Z$-morphism $u_0:Z_0'\to X$:
\[\begin{tikzcd}[row sep=5mm, column sep=10mm]
Z_0'\ar[r,"u_0"]\ar[dd,swap,"j"]&X\ar[d,"f"]\\
&Y\ar[d,"g"]\\
Z'\ar[ru,dashed,"v"{anchor=south}]\ar[ruu,dashed,"u",pos=0.62]\ar[r]&Z
\end{tikzcd}\]
The hypothesis over $g$ implies that there exists a $Z$-morphism $v:Z'\to Y$ such that $f\circ u_0=v\circ j$ (where $j:Z_0'\to Z'$ is the canonical injection), and the hypothesis over $f$ implies that there exists a morphism $u:Z\to X$ such that $f\circ u=v$ and $u\circ j=u_0$, so $(g\circ f)\circ u$ is equal to the structural morphism $Z'\to Z$ and $u\circ j=u_0$, which proves that $g\circ f$ is formally smooth. By a smilar reasoning, we see that $f\circ g$ is formally unramified if both morphisms are formally unramified.\par
Finally, to prove (\rmnum{3}), put $X'=X_{(S')}$, $Y'=Y_{(S')}$, $f'=f_{(S')}$. Consider an affine scheme $Y''$ over $Y'$ and a closed subscheme $Y''_0$ of $Y''$ defined by a square zero ideal. Then $\Hom_{Y'}(Y'',X')$ is canonically identified with $\Hom_Y(Y'',X)$, and $\Hom_{Y'}(Y''_0,X')$ with $\Hom_Y(Y'',X)$, so our conclusion follows from the definition.
\end{proof}
\begin{proposition}\label{scheme formally smooth cancelled by formally unramified}
Let $f:X\to Y$ and $g:Y\to Z$ be morphisms and suppose that $g$ is formally unramified. Then, if $g\circ f$ is formally smooth (resp. formally \'etale), so is $f$.
\end{proposition}
\begin{proof}
Let $Y'$ be an affine scheme, $h:Y'\to Y$ be a morphism, $Y'_0$ be a closed subscheme of $Y'$ defined by a square zero ideal, and $u_0:Y'_0\to X$ be a $Y$-morphism. 
\[\begin{tikzcd}
Y'_0\ar[d,swap,"j"]\ar[r,"u_0"]&X\ar[d,"f"]&\\
Y'\ar[r,"h"]\ar[ru,dashed,"u",pos=.6]&Y\ar[r,"g"]&Z
\end{tikzcd}\]
If $g\circ f$ is formally smooth, there exists a $Z$-morphism $u:Y'\to X$ such that $u\circ j=u_0$ (where $j:Y'_0\to Y'$ is the canonical injection) and $(g\circ f)\circ u=g\circ h$. But this then implies that $f\circ u$ and $h$ are $Z$-morphisms from $Y'$ to $Y$ such that $(f\circ u)\circ j=h\circ j$, so since $g$ is formally unramified, we conclude that $f\circ u=h$, so $u$ is a $Y$-morphism. In view of \cref{scheme formally unramified smooth permanence prop}(\rmnum{5}), the proposition is therefore proved. 
\end{proof}
\begin{corollary}\label{scheme cancelled by formally etale prop}
Suppose that $g$ is formally \'etale. Then for the composition $g\circ f$ to be formally smooth (resp. formally unramified), it is necessary and sufficient that $f$ is formally smooth (resp. formally unramified).
\end{corollary}
\begin{proof}
This follows from \cref{scheme formally smooth cancelled by formally unramified} and \cref{scheme formally unramified smooth permanence prop}(\rmnum{2}) and (\rmnum{5}).
\end{proof}
\begin{proposition}\label{scheme formally smooth unramified open covering prop}
Let $f:X\to Y$ be a morphism of schemes.
\begin{enumerate}
\item[(\rmnum{1})] Let $(U_\alpha)$ be an open covering of $X$ and, for each $\alpha$, let $i_\alpha:U_\alpha\to X$ be the canonical injection. For $f$ to be formally smooth (resp. formally unramified), it is necessary and sufficient that each morphism $f\circ i_\alpha$ is formally smooth (resp. formally unramified).
\item[(\rmnum{2})] Let $(V_\lambda)$ be an open covering of $Y$. For $f$ to be formally smooth (resp. formally unramified), it is necessary and sufficient that each restriction $f|_{f^{-1}(V_\lambda)}:f^{-1}(V_\lambda)\to V_\lambda$ is formally smooth (resp. formally unramified).
\end{enumerate}
\end{proposition}
\begin{proof}
We first note that (\rmnum{2}) is a concequence of (\rmnum{1}): in fact, if $j_\lambda:V_\lambda\to Y$ and $i_\lambda:f^{-1}(V_\lambda)\to X$ are the canonical injections, the restriction $f_\lambda:f^{-1}(V_\lambda)\to V_\lambda$ satisfies $j_\lambda\circ f_\lambda=f\circ i_\lambda$; if $f$ is formally smooth (resp. formally unramified), then so is $f\circ i_\lambda$ (\cref{scheme formally unramified smooth permanence prop}); but as $j_\lambda$ is formally \'etale, this implies that $f_\lambda$ is formally smooth (resp. formally unramified) by \cref{scheme cancelled by formally etale prop}. Conversely, if each restriction $f_\lambda$ is formally smooth (resp. formally unramified), then so is $j_\lambda\circ f_\lambda$ (\cref{scheme formally unramified smooth permanence prop}), and hence is $f$ in view of (\rmnum{1}). Now since each $i_\alpha$ is formally \'etale, it then boils down to prove that if the $f\circ i_\alpha$ is formally smooth (resp. formally unramified), then so is $f$.\par
Let $Y'$ be an affine scheme, $Y'_0$ be a closed subscheme of $Y'$ defined by a square zero ideal, and $g:Y'\to Y$ be a morphism. Let $u_0:Y'_0\to X$ be a morphism, and denote by $W_\alpha$ (resp. $W_\alpha^0$) the open subscheme of $Y'$ (resp. $Y_0'$) induced on $u_0^{-1}(U_\alpha)$ (note that $Y'$ and $Y'_0$ have the same underlying space). First suppose that $f\circ i_\alpha$ is formally unramified. We show that if $u_1$ and $u_2$ are two $Y$-morphisms from $Y'$ to $X$ whose restriction on $Y'_0$ coincide, then $u_1=u_2$. To see this, note that by \cref{scheme formally unramified smooth permanence prop}~(\rmnum{4}), the hypothesis that $f\circ i_\alpha$ is formally unramified implies that $u_1|_{W_\alpha}=u_2|_{W_\alpha}$ for each $\alpha$, so the assertion is true in this case.\par
Now suppose that $f\circ i_\alpha$ is formally smooth for each $\alpha$, we prove that there exists a $Y$-morphism $u:Y'\to X$ whose restriction to $Y'_0$ is $u_0$. Now since $Y'$ is affine, we can apply (\cite{EGA4}, 16.5.17), whose conclusion precisely proves the existence of $u$.
\end{proof}
\subsection{Differential properties and characterizations}
\begin{proposition}\label{scheme formally unramified iff Omega zero}
For a morphism $f:X\to Y$ to be formally unramified, it is necessary and sufficient that $\Omega^1_{X/Y}=0$.
\end{proposition}
\begin{proof}
By \cref{scheme formally smooth unramified open covering prop}, the question is local on source and target, so we can assume that $X=\Spec(B)$ and $Y=\Spec(A)$ are affine, hence reduce to proving that the $A$-algebra $B$ is formally unramified if and only if $\Omega^1_{B/A}=0$. For this, recall that $\Hom_B(\Omega^1_{B/A},M)$ is isomorphic to $\Der_A(B,M)$ for any $B$-module $M$, so if $\Omega^1_{B/A}=0$, \cref{algebra derivation act on lifting} implies that $B$ is formally unramified over $A$. Conversely, assume that $B$ is formally unramified over $A$ and consider the multiplication map $\mu:B\otimes_AB\to B$ of the $A$-algebra $B$. Let $\mathfrak{I}$ be the kernel of $\mu$ and set $C=(B\otimes_AB)/\mathfrak{I}^2$, $N=\mathfrak{I}/\mathfrak{I}^2$. Then $N$ is a square zero ideal of $C$, and since $B$ is formally unramified over $A$, we get $\Der_A(B,N)=0$ by \cref{algebra derivation act on lifting}. But $N$ is by definition the differential module $\Omega^1_{B/A}$, so we conclude that $\Hom_B(\Omega^1_{B/A},\Omega^1_{B/A})=0$, whence $\Omega^1_{B/A}=0$.
\end{proof}
\begin{corollary}\label{scheme formally unramified iff Omega pullback surjective}
Let $f:X\to Y$ and $g:Y\to Z$ be two morphism. For $f$ to be formally unramified, it is necessary and sufficient that the canonical homomorphism $f^*(\Omega^1_{Y/Z})\to\Omega^1_{X/Z}$ is surjective.
\end{corollary}
\begin{proof}
This is an immediate concequence of \cref{scheme formally unramified iff Omega zero} and the exact sequence
\begin{equation*}
\begin{tikzcd}
f^*(\Omega^1_{Y/Z})\ar[r]&\Omega^1_{X/Z}\ar[r]&\Omega^1_{X/Y}\ar[r]&0
\end{tikzcd}
\qedhere
\end{equation*}
\end{proof}
\begin{proposition}\label{scheme formally smooth Omega projective pullback sequence exact}
Let $f:X\to Y$ be a formally smooth morphism.
\begin{enumerate}
\item[(\rmnum{1})] The $\mathscr{O}_X$-module $\Omega^1_{X/Y}$ is locally projective. If $f$ is locally of finite type, then $\Omega^1_{X/Y}$ is locally free of finite rank.
\item[(\rmnum{2})] For any morphism $g:Y\to Z$, the sequence of $\mathscr{O}_X$-modules
\begin{equation}\label{scheme formally smooth Omega projective pullback sequence exact-1}
\begin{tikzcd}
0\ar[r]&f^*(\Omega^1_{Y/Z})\ar[r]&\Omega^1_{X/Z}\ar[r]&\Omega^1_{X/Y}\ar[r]&0
\end{tikzcd}
\end{equation}
is exact. Moreover, for any $x\in X$, there exists an open neighborhood $U$ of $x$ such that the restriction of these homomorphisms to $U$ form a splict exact sequence.
\end{enumerate}
\end{proposition}
\begin{proof}
If $f$ is locally of finite type, then the diagonal map $\Delta_{X/Y}:X\to X\times_YX$ is of finite presentation (\cref{scheme morphism local ft diagonal is local fp}), so $\Omega^1_{X/Y}$ is an $\mathscr{O}_X$-module of finite type in view of \cref{scheme immersion local fp iff ideal sheaf finite type}. To see that $\Omega^1_{X/Y}$ is locally projective, it suffices to assume that $Y=\Spec(A)$ and $X=\Spec(B)$ are affine, and the conclusion then follows from \cref{algebra formally smooth Omega projective}. Now to prove (\rmnum{2}), we can also assume that $X,Y,Z$ are affine schemes, and in this case the conclusion then follows from the interpretation of the modules appearing in the sequence (\ref{scheme formally smooth Omega projective pullback sequence exact-1}) and (\cite{EGA4} $0_{\text{\Rmnum{4}}}$, 20.5.7).
\end{proof}
\begin{corollary}\label{scheme formally etale Omega pullback isomorphism}
If $f:X\to Y$ is a formally \'etale morphism, then for any morphism $g:Y\to Z$, the canonical homomorphism $f^*(\Omega^1_{Y/Z})\to\Omega^1_{X/Z}$ is bijective.
\end{corollary}
\begin{proof}
This follows from the exact sequence (\ref{scheme formally smooth Omega projective pullback sequence exact-1}) and the fact that we have $\Omega^1_{X/Y}=0$ (\cref{scheme formally unramified iff Omega zero}).
\end{proof}
\begin{proposition}\label{scheme formally smooth conormal sequence exact}
Let $f:X\to Y$ be a morphism, $X'$ be a closed subscheme of $X$ such that the composition morphism $X'\to X\to Y$ is formally smooth. Then the sequence of $\mathscr{O}_{X'}$-modules
\begin{equation}
\begin{tikzcd}
0\ar[r]&\mathscr{N}_{X'/X}\ar[r]&\Omega^1_{X/Y}\otimes_{\mathscr{O}_X}\mathscr{O}_{X'}\ar[r]&\Omega^1_{X'/Y}\ar[r]&0
\end{tikzcd}
\end{equation}
is exact. Moreover, for any $x\in X$, there exists an open neighborhood $U$ of $x$ such that the restriction of these homomorphisms to $U$ form a splict exact sequence.
\end{proposition}
\begin{proof}
In view of \cref{scheme formally smooth unramified open covering prop}, we can assume that $X=\Spec(B)$, $X'=\Spec(B/\mathfrak{I})$ and $Y=\Spec(A)$ are affine, where $\mathfrak{I}$ is an idela of $B$. Then the conormal sheaf $\mathscr{N}_{X'/X}$ corresponds to the $B$-module $\mathfrak{I}/\mathfrak{I}^2$, and the conclusion follows from \cref{algebra formally smooth A/I conormal sequence split exact}.
\end{proof}
\begin{proposition}\label{scheme local ft monomorphism iff}
Let $f:X\to Y$ be a morphism locally of finite type. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is a monomorphism;
\item[(\rmnum{2})] $f$ is radical and formally unramified;
\item[(\rmnum{3})] for any $y\in Y$, the fiber $f^{-1}(y)$ is either empty or $\kappa(y)$-isomorphic to $\Spec(\kappa(y))$.
\end{enumerate}
\end{proposition}
\begin{proof}
The fact that (\rmnum{1}) implies (\rmnum{3}) follows from \cref{scheme monomorphism fiber prop}. It is clear that (\rmnum{3}) implies that $f$ is radical, and we prove that $\Omega^1_{X/Y}=0$ in this case. Note that the $\mathscr{O}_X$-module $\Omega^1_{X/Y}$ is quasi-coherent of finite type (\cite{EGA4}, 16.3.9), so it follows from \cref{scheme general tensor of ft sheaf supp char} that, for $(\Omega^1_{X/Y})_x=0$, it is necessary and sufficient that if we put $Y_1=\Spec(\kappa(y))$, $X_1=f^{-1}(y)=X\times_YY_1$, then $(\Omega^1_{X_1/Y_1})_x=0$. But as the morphism $f_1:X_1\to Y_1$ induced from $f$ is formally unramified in view of the hypotheses of (\rmnum{3}) (\cref{scheme formally unramified smooth permanence prop}), the conclusion follows from \cref{scheme formally unramified iff Omega zero}.\par
Finally, we show that (\rmnum{2}) implies (\rmnum{1}). For this, consider the diagonal morphism $g=\Delta_f:X\to X\times_YX$; since $f$ is radical, $g$ is surjective (\cref{scheme radical morphism def}). On the other hand, $\Omega^1_{X/Y}$ is defined by the conormal sheaf of the immersion $g$, and the hypothesis that $f$ is unramified implies $\Omega^1_{X/Y}=0$. Moerover, $g$ is locally of finite presentation (\cref{scheme morphism local ft diagonal is local fp}), so it is an open immersion by (\cite{EGA4}, 16.1.10). Being surjective, this immersion is then an isomorphism, so $f$ is a monomorphism by \cref{scheme monomorphism iff diagonal isomorphism}.
\end{proof}
\subsection{Unramified morphisms and smooth morphisms}
We say that a morphism $f:X\to Y$ is \textbf{smooth} (resp. \textbf{unramified}) if it is locally of finite presentation and formally smooth (resp. formally unramified), and \textbf{\'etale} if it is both smooth and unramified.
\begin{example}
Let $A$ be a ring and $B$ be an $A$-algebra. Then $B$ is a smooth (resp. unramified) algebra if the corresponding morphism $\Spec(B)\to\Spec(A)$ is smooth (resp. unramified).
\end{example}
\begin{proposition}[\textbf{Properties of Unramified and Smooth Morphisms}]\label{scheme unramified smooth permanence prop}
\mbox{}
\begin{enumerate}
\item[(\rmnum{1})] An open immersion is \'etale. For an immersion to be unramified, it is necessary and sufficient that it is locally of finite presentation.
\item[(\rmnum{2})] The composition of two smooth (resp. unramified) morphisms is formally smooth (resp. formally unramified).
\item[(\rmnum{3})] If $f:X\to Y$ is a smooth (resp. unramified) $S$-morphism, so is $f_{(S')}:X_{(S')}\to Y_{(S')}$ for any base change $S'\to S$.
\item[(\rmnum{4})] If $f:X\to X'$ and $g:Y\to Y'$ are two smooth (resp. unramified) $S$-morphisms, $f\times_Sg$ is smooth (resp. unramified).
\item[(\rmnum{5})] Let $f:X\to Y$ and $g:Y\to Z$ be two morphisms. If $g$ is locally of finite type and $g\circ f$ is unramified, so is $f$.
\end{enumerate}
\end{proposition}
\begin{proof}
This follows from \cref{scheme morphism fp permanence prop} and \cref{scheme formally unramified smooth permanence prop}.
\end{proof}
\begin{proposition}\label{scheme smooth cancelled by unramified}
Let $f:X\to Y$, $g:Y\to Z$ be morphisms, and suppose that $g$ is unramified. Then, if $g\circ f$ is smooth (resp. \'etale), so is $f$.
\end{proposition}
\begin{proof}
In fact, as $g$ and $g\circ f$ are locally of finite presentation, so is $f$ (\cref{scheme morphism local fp permanence prop}(\rmnum{5})), and the conclusion then follows from \cref{scheme formally smooth cancelled by formally unramified}.
\end{proof}
\begin{corollary}\label{scheme cancelled by etale prop}
Suppose that $g$ is \'etale, then for $f$ to be smooth (resp. \'etale), it is necessary and sufficient that $g\circ f$ is smooth (resp. \'etale).
\end{corollary}
\begin{proof}
This follows from \cref{scheme smooth cancelled by unramified} and \cref{scheme unramified smooth permanence prop}(\rmnum{2}).
\end{proof}
\begin{proposition}\label{scheme morphism local fp unramified iff Omega pullback surjective}
Let $g:Y\to S$ and $h:X\to S$ be morphisms locally of finite presentation. For an $S$-morphism $f:X\to Y$ to be unramified, it is necessary and sufficient that the canonical homomorphism $f^*(\Omega^1_{Y/S})\to\Omega^1_{X/S}$ is surjective.
\end{proposition}
\begin{proof}
As $f$ is then locally of finite presentation (\cref{scheme unramified smooth permanence prop}(\rmnum{2})), the proposition follows from \cref{scheme formally unramified iff Omega pullback surjective}.
\end{proof}
In view of \cref{scheme formally smooth unramified open covering prop} and the local nature of morphisms locally of finite presentation, we say a morphism $f:X\to Y$ is smooth (resp. unramified) at a point $x\in X$ if there exists an open neighborhood $U$ of $x$ in $X$ such that the restriction $f|_U$ is a smooth (resp. unramified) morphism from $U$ into $Y$. Then a morphism $f:X\to Y$ is smooth (resp. unramified) if and only if it is smooth (resp. unramified) at every point of $X$. Moreover, it is clear from this definition that the points of $X$ where $f$ is smooth (resp. unramified) is open in $X$.
\begin{proposition}\label{scheme local free vector bundle is smooth}
For any scheme $Y$ and any locally free $\mathscr{O}_X$-module $\mathscr{E}$ of finite rank, the vector bundle $\bm{V}(\mathscr{E})$ is a smooth $Y$-scheme.
\end{proposition}
\begin{proof}
In fact, by \cref{scheme formally smooth unramified open covering prop} we can assume that $Y=\Spec(A)$ is affine and $\bm{V}(\mathscr{E})=\Spec(A[T_1,\dots,T_n])$. As $A[T_1,\dots,T_n]$ is formally smooth over $A$ and finitely presented, this proves the proposition.
\end{proof}
\begin{corollary}\label{scheme local free projective bundle is smooth}
Under the hypothesis of \cref{scheme local free vector bundle is smooth}, the projective bundle $\P(\mathscr{E})$ is a smooth $Y$-scheme.
\end{corollary}
\begin{proof}
We can assume that $Y=\Spec(A)$ and $\P(\mathscr{E})=\P_Y^n$. Then there is a finite open covering of $\P^n_A$ by the $D_+(T_i)$. But the ring of $D_+(T_i)$, being $A[T_1,\dots,T_n]_{(T_i)}$, is isomorphic to the polynomial ring $A[T_0,\dots,\widehat{T}_i,\dots,T_n]$, and hence smooth, so the corollary follows from \cref{scheme formally smooth unramified open covering prop}.
\end{proof}
\subsection{Characterization of unramification and smoothness}
\paragraph{Characterization of unramified morphisms}
\begin{theorem}\label{scheme morphism local fp unramified at point iff}
Let $f:X\to Y$ be a morphism locally of finite presentation and $x$ be a point of $X$. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is unramified at $x$;
\item[(\rmnum{2})] the diagonal morphism $\Delta_f:X\to X\times_YX$ is a local isomorphism at $x$.
\item[(\rmnum{2}')] if $Z=X\times_YX$ and $z=\Delta_f(x)$, the morphism $(\Delta_f)^{\#}_x:\mathscr{O}_{Z,z}\to\mathscr{O}_{X,x}$ is bijective; 
\item[(\rmnum{2}'')] for any morphism $g:Y'\to Y$ and any point $y'\in Y'$ lying over $y=f(x)$, any $Y'$-section $s'$ of $X'=X\times_YY'$ with $x'=s'(y')$ lying over $x$ is a local isomorphism at $y'$;
\item[(\rmnum{3})] $(\Omega^1_{X/Y})_x=0$;
\item[(\rmnum{4})] the $\kappa(y)$-scheme $X_y$ is unramified over $\kappa(y)$ at $x$;
\item[(\rmnum{4}')] the point $x$ is isolated in $X_y$ and the local ring $\mathscr{O}_{X_y,x}$ is a field and separable over $\kappa(y)$;
\item[(\rmnum{4}'')] $\mathscr{O}_{X_y,x}=\mathscr{O}_{X,x}/\m_y\mathscr{O}_{X,x}$ is a field and a finite separable extension of $\kappa(y)$;
\item[(\rmnum{5})] $\mathscr{O}_{X,x}$ is a formally unramified $\mathscr{O}_{Y,y}$-algebra.
\end{enumerate}
\end{theorem}
\begin{proof}
As $f$ is locally of finite type, the $\mathscr{O}_X$-module $\Omega^1_{X/Y}$ is of finite type (\cite{EGA4}, 16.3.9), so $(\Omega^1_{X/Y})_x=0$ if and only if there exists an open neighborhood $U$ of $x$ such that $\Omega^1_{X/Y}|_U=0$. In view of \cref{scheme formally unramified iff Omega zero}, this proves the equivalence of (\rmnum{1}) and (\rmnum{3}). On the other hand, if we put $A=\mathscr{O}_{Y,y}$, $B=\mathscr{O}_{X,x}$, then $(\Omega^1_{X/Y})_x=\Omega^1_{B/A}$ (\cite{EGA4}, 16.4.15), so the equivalence of (\rmnum{3}) and (\rmnum{5}) also follows from the affine case of \cref{scheme formally unramified iff Omega zero}.\par
By the very definition of unramified morphism at $x$, we see that (\rmnum{1}) is equivalent to (\rmnum{4}). Also, as properties (\rmnum{4}) and (\rmnum{4}') only involve the morphism $X_y\to\Spec(\kappa(y))$, this also implies the  equivalence of (\rmnum{4}) and (\rmnum{4}'). On the other hand, (\rmnum{4}') and (\rmnum{4}'') are equivalent, because it amounts to the same thing to say that $\mathscr{O}_{X_y,x}$ is a finite $\kappa(y)$-algebra or that $x$ is an isolated point of $X_y$, since $X_y$ is a $\kappa(y)$-scheme locally of type (\cref{scheme algebraic Artinian iff}).\par
We now prove the equivalence of (\rmnum{2}) and (\rmnum{2}'). We can limit ourselves to the case where $Y=\Spec(R)$, $X=\Spec(S)$ are affine and $f$ is finitely presented. Then we have $Z=\Spec(S\otimes_RS)$ and $\Delta_f$ corresponds to the multiplication map $S\otimes_RS\to S$, whose kernel $\mathfrak{I}$ is a finitely generated ideal (\cite{EGA4} $0_{\text{\Rmnum{4}}}$, 20.4.4). If we put $\mathscr{I}=\widetilde{\mathfrak{I}}$, the $\mathscr{O}_Z$-module $\Delta_f^*(\mathscr{O}_X)=\mathscr{O}_Z/\mathscr{I}$ is then of finite presentation, and the hypothesis that the homomorphism $(\Delta_f)^{\#}_x:\mathscr{O}_{Z,z}\to\mathscr{O}_{X,x}$ is bijective implies that, by replacing $X$ by an open neighborhood of $x$, the homomorphism $(\Delta_f)^{\#}:\mathscr{O}_Z\to\Delta_f^*(\mathscr{O}_X)$ is itself bijective (\cref{sheaf of module fp isomorphic on stalk}). This then proves that (\rmnum{2}') implies (\rmnum{2}), and the converse is evident.\par
On the other hand, the equivalence of (\rmnum{2}) and (\rmnum{2}'') follows from \cref{scheme morphism cartesian square with diagonal morphism} even without the finiteness hypothesis on $f$: in fact, giving a $Y'$-section $s':Y'\to X'$ is equivalent to giving a $Y$-morphism $h=g'\circ s':Y'\to X$ (where $g':Y'\to X$ is the canonical projection) such that $s'=\Gamma_h$, and the diagram
\[\begin{tikzcd}
Y'\ar[r,"s'"]\ar[d,swap,"h"]&X'=Y'\times_YX\ar[d,"h\times_X1_X"]\\
X\ar[r,"\Delta_f"]&X\times_YX
\end{tikzcd}\]
is then cartesian. Therefore if $\Delta_f$ is a local isomorphism at $x$, then $s'$ is a local isomorphism at $y'$ (since $x=h(y')$), and this proves (\rmnum{2})$\Rightarrow$(\rmnum{2}''). The converse is obtained by applying (\rmnum{2}'') to the case where $Y'=X$, $y'=x$, $g=f$ and $s'=\Delta_f$.\par
To finish the proof of the theorem, it then suffices to prove the following implications
\[\text{(\rmnum{4}'')$\Rightarrow$(\rmnum{3})$\Rightarrow$(\rmnum{2})$\Rightarrow$(\rmnum{4}'')}.\]
First, as $\Omega^1_{X/Y}$ is an $\mathscr{O}_X$-module of finite type, it follows from Nakayama lemma that condition (\rmnum{3}) is equivalent to $(\Omega^1_{X/Y})_x/\m_y(\Omega^1_{X/Y})_x=0$, which means $(\Omega^1_{X_y/\Spec(\kappa(y))})_x=0$ (\cite{EGA4}, 16.4.5). We are therefore reduced to the case where $Y$ is the specturm of a field $k$ and $X$ is an algebraic $k$-scheme. The hypothesis that $\mathscr{O}_{X,x}$ is a finite field extension $k'$ of $k$ implies that $x$ is closed in $X$ (\cref{scheme algebraic point isolated iff}), and hence isolated in $X$. But then the hypothsis that $k'$ is separable over $k$ implies that $\Omega^1_{k'/k}=0$ (\cite{EGA4} $0_{\text{\Rmnum{4}}}$, 20.6.20), which proves (\rmnum{3}). Moreover, in this case $\Omega^1_{X/Y}|_U=0$ for an open neighborhood of $x$ in $X$, so assertion (\rmnum{2}) follows from the definition of $\Omega^1_{X/Y}$.\par
Finally, to show that (\rmnum{2})$\Rightarrow$(\rmnum{4}''), we can, by replacing $X$ by an open neighborhood of $x$, suppose that $\Delta_f$ is an open immersion. If we denote by $f_y:X_y\to\Spec(\kappa(y))$ the morphism induced by $f$ on fiber, then $\Delta_{f_y}$ is also an open immersion (\cref{scheme immersion stable under base change}), and as condition (\rmnum{4}'') only concerns the $\kappa(y)$-scheme $X_y$, we can therefore assume that $Y=\Spec(k)$ and $X=\Spec(A)$, where $k$ is a field and $A$ is a finite type $k$-algebra. Condition (\rmnum{4}'') is then established if we can show that $A$ is a finite and separable $k$-algebra. If $K$ is an algebraic closure of $k$, this amounts to saying that $A\otimes_kK$ is a finite and separable $K$-algebra (\cite{EGA4}, 4.6.1), so we can further assume that $k$ is algebraically closed. We first prove that $A$ is a finite $k$-algebra. For this, it suffices to show that every closed point $x$ of $X$ is isolated, since then the set of such points is open in $X$ and discrete, hence finite ($X$ is Noetherian), and the assertion then follows from \cref{scheme algebraic Artinian iff}. Now for such a point $x$, we have $\kappa(x)=k$ since $k$ is algebraically closed (\cref{scheme algebraic is Jacobson and closed point char}), so by \cref{scheme algebraic over ac field closed point iff rational} there is a $Y$-section of $X$ such that $s(Y)=\{x\}$, and in view of (\cite{EGA4}, 17.4.1.1), $\{x\}$ is the inverse image of the diagonal $\Delta_X(X)$ under a morphism $X\to X\times_YX$, hence is open in $X$ in view of the hypothesis of (\rmnum{2}). The $k$-algebra $A$ is therefore finite, hence is isomorphic to a direct product of finite local $k$-algebras. Since our question is local, we can then assume that $A$ is a finite local $k$-algebra, so that $X=\Spec(A)$ is reduced to a singleton. The residue field of $A$, being a finite extension of $k$, is necessarily equal to $k$, so in view of \cref{scheme fiber product inverse image char by composition extension}, the product $X\times_kX$ is reduced to a singleton, and $\Delta_f$ is then an isomorphism. Since $\Delta_f$ corresponds to the multiplication map $\mu:A\otimes_kA\to A$, we conclude that $\mu$ is an isomorphism, which means $\Omega^1_{A/k}=0$ and $A$ is separable over $k$.
\end{proof}
\begin{remark}\label{scheme morphism formally unramified iff variant}
If we onlt assume that $f$ is locally of finite type, then $\Omega^1_{X/Y}$ is an $\mathscr{O}_X$-module of finite type (\cite{EGA4}, 16.3.9), and $\Delta_f$ is a morphism locally of finite presentation (\cref{scheme morphism local ft diagonal is local fp}). The proof of \cref{scheme morphism local fp unramified at point iff} is still valid, provided that condition (\rmnum{1}) is replaced by the following: the restriction of $f$ to an open neighborhood of $x$ is formally unramified. We also see that in this case the restriction of $f$ to an open neighborhood of $x$ is a locally quasi-finite morphism.\par
In fact, many authors require unramified morphisms to be (locally of finite type), rather than (locally) of finite presentation. The benifits of this definition is that any closed immersion is then unramified, which is reasonable under our intuition about unramification. The requirement of being locally of finite presentation, however, is necessary when we consider \'etale morphisms, so we add it to the definition of unramified morphism for consistency (following Grothendieck's definition). However, one should note that most of the proofs involving unramified morphisms work through finite type cases, and the restriction of being locally of finite presentation in fact unnecessary in most of the cases when we talk about unramified morphisms.
\end{remark}
\begin{corollary}\label{scheme morphism local fp unramified iff}
Let $f:X\to Y$ be a morphism locally of finite presentation. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is unramified;
\item[(\rmnum{2})] the diagonal morphism $\Delta_f:X\to X\times_YX$ is an open immersion;
\item[(\rmnum{2}')] for any morphism $Y'\to Y$, any $Y'$-section of $X'\times_YY'$ is an open immersion;
\item[(\rmnum{3})] $\Omega^1_{X/Y}=0$;
\item[(\rmnum{4})] for any $y\in Y$, the $\kappa(y)$-scheme $X_y$ is unramified over $\kappa(y)$;
\item[(\rmnum{4}')] for any $y\in Y$, the $\kappa(y)$-scheme $X_y$ is isomorphic to $\coprod_{\lambda\in I}\Spec(K_\lambda)$, where for each $\lambda$, $K_\lambda$ is a finite separable extension of $\kappa(y)$;
\item[(\rmnum{5})] for any $x\in X$, the local ring $\mathscr{O}_{X,x}$ is a formally unramified $\mathscr{O}_{Y,f(x)}$-algebra. 
\end{enumerate}
\end{corollary}
\begin{proof}
This follows from the observation that a morphism $f:X\to Y$ is unramified if and only if it is unramified at every point of $X$.
\end{proof}
\begin{corollary}\label{scheme morphism unramified is local quasi-finite}
If $f:X\to Y$ is unramified, then it is locally quasi-finite.
\end{corollary}
\begin{proof}
By \cref{scheme morphism local fp unramified at point iff}, for any point $x\in X$, the $\kappa(y)$-algebra $\mathscr{O}_{X_y,x}$ is finite, so $x$ is isolated in $X_y$ and the conclusion follows from (\cite{EGA4}, 13.1.4).
\end{proof}
\begin{proposition}\label{scheme local Noe morphism unramified at point iff completion}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$. If $A=\mathscr{O}_{Y,y}$ and $\mathscr{O}_{X,x}$, then the conditions of \cref{scheme morphism local fp unramified at point iff} are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{6})] $\widehat{B}\otimes_{\widehat{A}}\kappa_A$ is a finite and separable field extension of $\kappa_A$ (which implies that $\widehat{B}$ is a finite $\widehat{A}$-algebra);
\item[(\rmnum{6}')] $\widehat{B}$ is a formally unramified $\widehat{A}$-algebra. 
\end{enumerate}
Moreover, if $\kappa(x)=\kappa(y)$, or if $k$ is separably closed, these conditions are also equivalent to:
\begin{enumerate}
\item[(\rmnum{6}'')] the homomorphism $\widehat{A}\to\widehat{B}$ is surjective.
\end{enumerate}
\end{proposition}
\begin{proof}
Note that by the same reasoning of (\cite{EGA4} $0_{\text{\Rmnum{4}}}$, 19.3.6), the $A$-alebra $B$ is formally unramified if and only if $\widehat{B}$ is formally unramified over $\widehat{A}$ for the adic topology. On the other hand, since $f$ is locally of finite type, $\Omega^1_{B/A}$ is a finitely generated $B$-module (\cite{EGA4}, 16.3.9), $\Omega^1_{B/A}=0$ if and only if $\widehat{\Omega}_{B/A}=0$ (\cref{Zariski ring def}), so $B$ is a formally unramified $A$-algebra if and only if it is formally unramified over $A$ for the adic topology (\cite{EGA4} $0_{\text{\Rmnum{4}}}$, 20.7.4), and this proves the equivalence of (\rmnum{5}) and (\rmnum{6}').\par
Since $\kappa_A=A/\m_A=\widehat{A}/\m_A\widehat{A}$, we have $\widehat{B}\otimes_{\widehat{A}}\kappa_A=\widehat{B}/\m_A\widehat{B}=\widehat{B}\otimes_B(B/\m_AB)$, and $\widehat{B}/\m_A\widehat{B}$ is therefore the completion of $B/\m_AB=B\otimes_A\kappa_A$ for the $\m_B$-adic topology (\cref{filtration Noe I-adic completion is tensor}). Since $\widehat{B}$ is a fiathfully flat $B$-module, we see that $B/\m_AB$ is a field if and only if $\widehat{B}/\m_A\widehat{B}$ is a field. Moreover, since completion does not change the residue field, in this case $B/\m_AB$ is separable over $\kappa_A$ if and only if $\widehat{B}/\m_A\widehat{B}$ is separable over $\kappa_A$; this proves the equivalence of (\rmnum{4}'') and (\rmnum{6}).\par
Finally, if $\kappa(x)=\kappa(y)$ or $\kappa_A$ is separably closed, condition (\rmnum{6}) implies that the homomorphism $\widehat{A}/\m_A\widehat{A}\to\widehat{B}/\m_A\widehat{B}$ is bijective and that $\widehat{B}$ is a quasi-finite $\widehat{A}$-algebra (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 7.4.4), hence finite (since $\widehat{A}$ is complete, $\widehat{B}$ is separated for the $\m_A$-adic topology, and $\m_A\widehat{B}$ is a defining ideal of $\widehat{B}$ (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 7.4.1)). The homomorphism $\widehat{A}\to\widehat{B}$ is then surjective by Nakayama lemma, so (\rmnum{6}) implies (\rmnum{6}''); the converse of this is evident.
\end{proof}
Given an $S$-scheme $Y$ and two $S$-morphisms $f:X\to Y$, $g:X\to Y$, we define the \textbf{coincidence scheme} of $f$ and $g$ to be the inverse image of the diagonal $\Delta_{Y/S}$ under the $S$-morphism $(f,g)_S$. Moreover, by \cref{scheme morphism equalizer char by inverse image of diagonal}, this subscheme is canonically identified with the kernel $\ker(f,g)$.
\begin{proposition}\label{scheme unramified coincidence subscheme open}
Let $h:Y\to S$ be an unramified morphism and $f:X\to Y$, $g:X\to Y$ be two $S$-morphisms. Then the coincidence scheme of $f$ and $g$ is an open subscheme of $X$.
\end{proposition}
\begin{proof}
In fact, since $\Delta_h:Y\to Y\times_SY$ is an open immersion by \cref{scheme morphism local fp unramified iff}, the inverse image of $\Delta_{Y/S}$ under $(f,g)_S$ is an open subscheme of $X$.
\end{proof}
\begin{corollary}\label{scheme unramified factor through ker iff locally equal on kappa}
Under the hypotheses of \cref{scheme unramified coincidence subscheme open}, let $x$ be a point of $X$ such that the following diagram commutes
\[\begin{tikzcd}
\Spec(\kappa(x))\ar[r]&X\ar[r,shift left=3pt,"f"]\ar[r,swap,shift right=3pt,"g"]&Y
\end{tikzcd}\]
Then there exists an open neighborhood $U$ of $x$ such that $f|_U=g|_U$. If $Y$ is also separated over $S$, then there also exists an open neighborhood $Z$ of $x$ such that $f|_Z=g|_Z$. In particular, if $X$ is also connected, then $f=g$.
\end{corollary}
\begin{proof}
By \cref{scheme morphism equalizer char by residue field}, $x$ belongs to the subscheme $\ker(f,g)$, and the assertion then follows from \cref{scheme unramified coincidence subscheme open}.
\end{proof}
\begin{corollary}\label{scheme unramified factor through ker iff locally equal on fiber}
Under the hypotheses of \cref{scheme unramified coincidence subscheme open}, suppose that the structural morphism $\varphi:X\to S$ is closed. Let $s$ be a point of $X$ and suppose that the compositions the following diagram commutes
\[\begin{tikzcd}
X_s\ar[r]&X\ar[r,shift left=3pt,"f"]\ar[r,swap,shift right=3pt,"g"]&Y
\end{tikzcd}\]
Then there exists an open neighborhood $V$ of $s$ in $S$ such that $f|_{\varphi^{-1}(V)}=g|_{\varphi^{-1}(V)}$. If $Y$ is also separated over $S$ and $\varphi$ is open, then we can choose $V$ to be clopen. In particular, if $S$ is also connected, then $f=g$.
\end{corollary}
\begin{proof}
It follows from \cref{scheme unramified factor through ker iff locally equal on kappa} that the subscheme $C=\ker(f,g)$ is open in $X$ and contains $X_s$. As $\varphi$ is closed, there exists an open neighborhood $V$ of $s$ such that $\varphi^{-1}(V)\sub C$. If $Y$ is also separated over $S$, then $C$ is also closed, so $\varphi(X-C)$ is clopen in $S$, and its complement $V$ in $S$ is then a clopen neighborhood of $s$ such that $\varphi^{-1}(V)\sub C$.
\end{proof}
\begin{proposition}\label{scheme unramified connected section correspond connected component}
Let $Y$ be a connected scheme, $f:X\to Y$ be a unramified and separated morphism. Then any $Y$-section $g$ of $X$ is an isomorphism from $Y$ onto an connected component of $X$, and the map $g\mapsto g(Y)$ is a bijection from $\Gamma(X/Y)$ to the set of connected components $Z$ of $X$ (necessarily open in $X$) such that the restriction of $f$ to $Z$ is an isomorphism from $Z$ onto $Y$. In particular, if $g_1$ and $g_2$ and two $Y$-sections of $X$ such that $g_1(y)=g_2(y)$ for a point $y\in Y$, then $g_1=g_2$.
\end{proposition}
\begin{proof}
It follows from \cref{scheme morphism local fp unramified iff} that any $Y$-section $s$ of $X$ is an open immersion, and as $X$ is a separated $Y$-scheme, $s$ is also a closed immersion (\cref{scheme morphism to separated graph is closed}). Then $s$ is an isomorphism from $Y$ onto a clopen subscheme of $X$, and as $s(Y)$ is connected, this is necessarily a connected component of $X$. The rest of the proposition is then immediate.
\end{proof}
\begin{example}
Let $k$ be a field and $X=\coprod_{n\in\N}\Spec(k)$ be an infinite direct sum of $\Spec(k)$. Then the morphism $f:X\to\Spec(k)$ is \'etale. This can be considered as a trivial covering space formed by infinitely many copies of the base space.
\end{example}
\begin{example}\label{scheme cusp normalization unramification locus}
Let $k$ be a field with $\char(k)\neq 2$ and consider the normalization $f:\A^1_k\to C$ morphism, where $C=\Spec(k[T^2,T^3])$ and $\A_1^k=\Spec(k[T])$. The morphism $f$ corresponds to the ring homomorphism
\[\varphi:k[T^2,T^3]\to k[T],\quad (X,Y)\mapsto(T^2,T^3).\]
If we set $A=k[T^2,T^3]$ and $B=k[T]$, then it is easy to see that $B=A[X]/(X^2-T^2)$, so the $B$-module $\Omega^1_{B/A}$ is generated by the symbol $dX$ subject to the relation
\[0=d(X^2-T^2)=2XdX-dT^2=2XdX.\]
and it is therefore isomorphic, as a $B$-module, to
\[A[X]/(2X,X^2-T^2)=k[T^2,T^3,X]/(2X,X^2-T^2)=k[T]/(2T)=k[T]/(T).\]
From this, we see that the support of $\Omega^1_{B/A}$ is equal to $\{(T)\}$, so by \cref{scheme morphism local fp unramified iff} the unramified locus of $f$ is $\A^1_k-\{0\}$. This ramification can also be detected from the local homomorphism $\varphi_\p:A_{\p}\to B_{\mathfrak{P}}$, where $\p=(T^2)$ and $\mathfrak{P}=(T)$. The induced homomorphism on residue fields is an isomorphism on $k(T)$, but the image of the maximal ideal of $\p A_\p$ to $\mathfrak{P}B_\mathfrak{P}$ is equal to $\mathfrak{P}^2B_\mathfrak{P}$, so it is not unramified.\par
Geometrically, the ramification of $f$ at origin is resulted from the fact that the tangent vectors (two different directions) of $\A^1_k$ are both bended to the same tangent vector (the same direction) of the origin of $C$. This justifies our intuition of unramification by unicity of tangent vector liftings.
\end{example}
\begin{example}\label{scheme parabola projection unramification locus}
Let $k$ be a field and consider the morphism $f:\A_1^k\to \A_1^k$ corresponding to the ring homomorphism
\[\varphi:k[X]\to k[Y],\quad X\mapsto Y^2.\]
This can be considered as the projection of the parabola onto $\A_k^1$. Let $A=k[X]$ and $B=k[Y]$, then we have $B=A[T]/(T^2-X)$, so the $B$-module $\Omega^1_{B/A}$ is isomorphic to $k[Y]/(2T)=k[Y]/(Y)$. Therefore the ramification locus of $f$ is again $\A^1_k-\{0\}$. This is not surprising, since geometrically the tangent map of $f$ at the origin is zero, so it does not satisfy the unicity of tangent vector liftings.\par
We also remark that the morphism $f$ is flat. In fact, for any $\lambda\in k$, the fiber of $f$ over the closed point $(X-\lambda)$ is $\Spec(k[Y]/(Y^2-\lambda))$, which is the disjioint union of $2$ points if $\lambda\neq 0$, and is the tangen vector $\Spec(k[\eps]/(\eps^2))$ if $\lambda=0$. In all cases, we see that $\dim_k(k[Y]/(Y^2-\lambda))=2$, so $f$ is flat. Another way to see this is to use the miracle flatness: since $f$ is a morphism between regular schemes of equal dimension, it must be flat.
\end{example}
\paragraph{Characterization of smooth morphisms}
\begin{theorem}\label{scheme morphism local fp smooth at point iff}
Let $f:X\to Y$ be a morphism locally of finite presentation, $x$ be a point of $X$ and $y=f(x)$. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is smooth at $x$;
\item[(\rmnum{2})] $f$ is flat at $x$ and the $\kappa(y)$-scheme $X_y$ is smooth over $\kappa(y)$ at $x$;
\item[(\rmnum{2}')] $f$ is flat and geometrically regular at $x$;
\item[(\rmnum{3})] $\mathscr{O}_{X,x}$ is a formally flat $\mathscr{O}_{Y,y}$-algebra.
\end{enumerate}
\end{theorem}
\begin{proof}
By the hypothesis on $f$, we can assume that $Y=\Spec(A)$, $X=\Spec(C)$, where $C=B/\mathfrak{I}$, $B=A[T_1,\dots,T_n]$ being a polynomial algebra and $\mathfrak{I}$ a finitely generated ideal of $B$. The equivalence of (\rmnum{1}) and (\rmnum{3}) then follows from \cref{algebra A/I formally smooth Jacobian criterion}. On the other hand, apply this result to the morphism $f_y:X_y\to\Spec(\kappa(y))$ (which is locally of finite type), we see that the equivalence of (\rmnum{1}), (\rmnum{2}) and (\rmnum{2}') follows from \cref{Noe ring formally smooth iff flat and fiber georegular}.
\end{proof}
\begin{corollary}\label{scheme morphism local fp smooth iff flat georegular}
Let $f:X\to Y$ be a morphism locally of finite presentation. For $f$ to be smooth, it is necessary and sufficient that $f$ is flat and for any $y\in Y$, $X_y$ is a geometrically regular $\kappa(y)$-scheme.
\end{corollary}
\begin{proof}
This follows from the definition of flat morphisms and \cref{scheme morphism local fp smooth at point iff}.
\end{proof}
\begin{proposition}\label{scheme local Noe morphism smooth at point iff completion}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$ and $y=f(x)$. If $A=\mathscr{O}_{Y,y}$ and $\mathscr{O}_{X,x}$, then the conditions of \cref{scheme morphism local fp smooth at point iff} are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{4})] $B$ is a formally smooth $A$-algebra;
\item[(\rmnum{4}')] $\widehat{B}$ is a formally unramified $\widehat{A}$-algebra. 
\end{enumerate}
Moreover, if $\kappa(x)=\kappa(y)$, these conditions are also equivalent to:
\begin{enumerate}
\item[(\rmnum{4}'')] $\widehat{B}$ is isomorphic to a power series $\widehat{A}$-algebra $\widehat{A}\llbracket T_1,\dots,T_n\rrbracket$.
\end{enumerate}
\end{proposition}
\begin{proof}
The equivalence of condition (\rmnum{3}) of \cref{scheme morphism local fp smooth at point iff} and (\rmnum{4}) follows from Jacobian criterion (\cref{algebra A/I formally smooth Jacobian criterion}), and that of (\rmnum{4}) and (\rmnum{4}') follows from (\cite{EGA4} $0_{\text{\Rmnum{4}}}$ 19.3.6). On the other hand, (\rmnum{4}'') implies (\rmnum{4}') without the hypothesis on residue fields (\cref{algebra polynomial ring formally smooth}). Finally, if $\m$ is the maximal ideal of $\widehat{A}$, condition (\rmnum{4}') implies that $\widehat{B}/\m\widehat{B}$ is a formally smooth complete Noetherian local $\kappa(y)$-algebra. The hypothesis $\kappa(x)=\kappa(y)$ then shows that $\widehat{B}/\m\widehat{B}$ is $\kappa(y)$-isomorphic to a formal series algebra $\kappa(y)\llbracket T_1,\dots,T_n\rrbracket$ (\cref{Noe local k-algebra formally smooth iff georegular}). On the other hand, as $\widehat{A}\llbracket T_1,\dots,T_n\rrbracket$ is a flat $\widehat{A}$-module and a complete Noetherian local $\widehat{A}$-algebra, we conclude from (\cite{EGA4} $0_{\text{\Rmnum{4}}}$, 19.6.4) that it is isomorphic to $\widehat{B}$, so (\rmnum{4}') imples (\rmnum{4}'').
\end{proof}
\begin{proposition}\label{scheme local Noe reduced smooth at point iff universal open georegular}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$ and $y=f(x)$. Suppose that $Y$ is reduced at $y$. Then for $f$ to be smooth at $x$, it is necessary and sufficient that $f$ is universally open in an open neighborhood of $x$ in $X_y$ and that the $\kappa(y)$-scheme $X_y$ is a geometrically regular at $x$.
\end{proposition}
\begin{proof}
In view of, it amounts to show that if $X_y$ is geometrically regular at $x$, then $f$ is flat at $x$ if and only if it is universally open in an open neighborhood of $x$ in $X_y$. Now if $f$ is flat at $x$, so is it in an open neighborhood of $x$ in $X$ (\cite{EGA4}, 11.1.1) and hence universally open in this neighborhood (\cite{EGA4}, 2.4.6). Conversely, the hypotheses that $X_y$ is geometrically regular at $x$ and $f$ is universally open in an open neighborhood of $x$ in $X_y$ together imply that $f$ is flat at $x$, since $\mathscr{O}_{Y,y}$ is reduced (\cite{EGA4}, 15.2.2).
\end{proof}
\begin{corollary}\label{scheme local Noe reduced geounibrach smooth at point iff equidim georegular}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$ and $y=f(x)$. Suppose that $Y$ is reduced and geometrically unibrach at $y$. Then for $f$ to be smooth at $x$, it is necessary and sufficient that $f$ is equidimensional at $x$ and that the $\kappa(y)$-scheme $X_y$ is a geometrically regular at $x$.
\end{corollary}
\begin{proof}
Since the set of points where $f$ is equidimensional is open (\cite{EGA4}, 13.3.2), this follows from \cref{scheme local Noe reduced smooth at point iff universal open georegular} and Chevalley's criterion (\cite{EGA4}, 14.4.4).
\end{proof}
\begin{proposition}\label{scheme morphism smooth at point descent prop}
Let $f:X\to Y$ be a morphism locally of finite presentation which is smooth at a point $x\in X$, and $y=f(x)$. Then, for the local ring $\mathscr{O}_{X,x}$ to be reduced (resp. integrally closed, resp. geometrically unibrach), it is necessary and sufficient that $\mathscr{O}_{Y,y}$ is.
\end{proposition}
\begin{proposition}\label{scheme local Noe morphism smooth at point dim depth equality}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite type which is smooth  at a point $x\in X$. Put $y=f(x)$, then
\begin{itemize}
\item $\dim(\mathscr{O}_{X,x})=\dim(\mathscr{O}_{Y,y})+\dim(\mathscr{O}_{X,x}\otimes_{\mathscr{O}_{Y,y}}\kappa(y))$;
\item $coprof(\mathscr{O}_{X,x})=coprof(\mathscr{O}_{Y,y})$;
\item for the local ring $\mathscr{O}_{X,x}$ to possesses property ($S_n$) or ($R_n$), it is necessary and sufficient that $\mathscr{O}_{Y,y}$ to possesses property ($S_n$) or ($R_n$). In particular, if $\mathscr{O}_{X,x}$ is regular (resp. normal), so is $\mathscr{O}_{Y,y}$.
\end{itemize}
\end{proposition}
\paragraph{Characterization of \'etale morphisms}
\begin{theorem}\label{scheme morphism local fp etale at point iff}
Let $f:X\to Y$ be a morphism locally of finite presentation, $x$ be a point of $X$ and $y=f(x)$. then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is \'etale at $x$.
\item[(\rmnum{1}')] $f$ is smooth and unramified at $x$;
\item[(\rmnum{2})] $f$ is smooth and quasi-finite at $x$;
\item[(\rmnum{3})] $f$ is flat and unramified at $x$;
\item[(\rmnum{3}')] $f$ is flat at $x$ and the ring $\mathscr{O}_{X,x}/\m_y\mathscr{O}_{X,x}$ is a finite and separable field extension of $\kappa(y)$;
\item[(\rmnum{4})] $\mathscr{O}_{X,x}$ is a formally \'etale $\mathscr{O}_{Y,y}$-algebra.
\end{enumerate}
\end{theorem}
\begin{proof}
The equivalence of (\rmnum{1}) and (\rmnum{1}') follows from definition, and that of (\rmnum{1}) and (\rmnum{4}) follows from \cref{scheme morphism local fp unramified at point iff} and \cref{scheme morphism local fp smooth at point iff}. The equivalence of (\rmnum{3}) and (\rmnum{3}') also follows from \cref{scheme morphism local fp unramified at point iff}. The fact that (\rmnum{1}')$\Rightarrow$(\rmnum{3}) follows from \cref{scheme morphism local fp smooth at point iff}. Conversely, if (\rmnum{3}') is satisfied, then $f$ is geometrically regular at $x$ by \cref{algebra Artin georegular iff separable}, and hence smooth at $x$ by \cref{scheme morphism local fp smooth at point iff}. Also, the implication (\rmnum{1})$\Rightarrow$(\rmnum{2}) follows from \cref{scheme morphism unramified is local quasi-finite}.\par
It then remains to prove that (\rmnum{2})$\Rightarrow$(\rmnum{3}), and as we have seen that $f$ is flat at $x$ (\ref{scheme morphism local fp smooth at point iff}), it suffices to show that $X_y$ is unramified over $\kappa(y)$. In other words, we are reduced to the case where $Y=\Spec(k)$. As the question is local over $X$, we can also assume that $X=\Spec(A)$, where $A$ is a finite local $k$-algebra (\cite{EGA1} $0_{\text{\Rmnum{1}}}$, 7.4.1). In view of the hypothesis (\rmnum{2}), $A$ is a formally smooth $k$-algebra, and hence geometrically regular (\cref{Noe local k-algebra formally smooth iff georegular}). Since it is Artinian, we then conclude $\m_A=0$, so $A$ a finite and separable extension of $k$.
\end{proof}
\begin{corollary}\label{scheme morphism local fp etale iff}
Let $f$ be a morphism locally of finite presentation. Then the following conditions are equivalent:
\begin{enumerate}
\item[(\rmnum{1})] $f$ is \'etale.
\item[(\rmnum{1}')] $f$ is smooth and unramified;
\item[(\rmnum{2})] $f$ is smooth and locally quasi-finite;
\item[(\rmnum{3})] $f$ is flat and unramified;
\item[(\rmnum{3}')] $f$ is flat and for any $y\in Y$, the fiber $X_y$ is a sum of specturms of finite and separable field extensions of $\kappa(y)$;
\item[(\rmnum{3}'')] $f$ is flat and for any $y\in Y$ and any separably closed extension $k'$ of $\kappa(y)$, the geometric fiber $X_y\otimes_{\kappa(y)}k'$ is a sum of specturms of fields isomorphic to $k'$.
\end{enumerate}
\end{corollary}
\begin{proposition}\label{scheme morphism local fp over local Noe etale at point iff}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite presentation, $x$ be a point of $X$ and $y=f(x)$. If $A=\mathscr{O}_{Y,y}$ and $\mathscr{O}_{X,x}$, then the conditions of \cref{scheme morphism local fp etale at point iff} are equivalent to the following:
\begin{enumerate}
\item[(\rmnum{4})] $\widehat{B}$ is a formally \'etale $\widehat{A}$-algebra. 
\item[(\rmnum{4}')] $\widehat{B}$ is a free $\widehat{A}$-module and $\widehat{B}\otimes_{\widehat{A}}\kappa_A$ is a finite and separable field extension of $\kappa_A$ (which implies that $\widehat{B}$ is a finite $\widehat{A}$-algebra).
\end{enumerate}
Moreover, if $\kappa(x)=\kappa(y)$ or $\kappa(y)$ is separably closed, these conditions are also equivalent to:
\begin{enumerate}
\item[(\rmnum{4}'')] the canonical homomorphism $\widehat{A}\to\widehat{B}$ is bijective.
\end{enumerate}
\end{proposition}
\begin{proposition}\label{scheme morphism over local Noe etale at point dim equal}
Let $Y$ be a locally Noetherian scheme, $f:X\to Y$ be a morphism locally of finite type, $x$ be a point of $X$ and $y=f(x)$. If $f$ is \'etale at $x$, then $\dim(\mathscr{O}_{X,x})=\dim(\mathscr{O}_{Y,y})$.
\end{proposition}
\begin{proof}
This follows from \cref{scheme local Noe morphism smooth at point dim depth equality} since $x$ is isolated in the fiber $X_y$.
\end{proof}
\section{Galois categories}\label{Galois category section}
\subsection{The axioms of Galois theory}
\section{The \'etale fundamental group}
\subsection{Finite group quotients of schemes}
Let $G$ be a (fixed) finite group and $S$ be a scheme. By a \textbf{$\bm{G}$-scheme} over $S$, we mean an $S$-scheme $X$ with a right action of $G$ on $X$. By definition, this means we have a homomorphism $\rho:G\to\Aut_S(X)$ from $G$ into the set of $S$-automorphisms of $G$. For any $S$-scheme $Z$, $G$ has an induced left action on the set $\Hom_S(X,Z)$, so we can consider the set $\Hom_S(X,Z)^G$ of $G$-invariant $S$-morphisms. Since this set depends functorially by $Z$, we then obtain a functor $\Hom(X,-)^G$, for which we can ask the representability. By Yoneda lemma, this is equivalent to the existence a $S$-scheme $Y$ and a $G$-invariant $S$-morphism $p:X\to Y$ such that, for any $S$-scheme $Z$, the corresponding map
\[\Hom_S(Y,Z)\to\Hom_S(X,Z)^G,\quad g\mapsto g\circ p\]
is bijective. In this case, we say that $(Y,p)$ (or the $S$-morphism $p:X\to Y$) is a \textbf{quotient scheme} of $X$ by $G$, and denote it by $X/G$. It is clear that the pair $(Y,p)$ is determined up to isomorphism.\par
If the scheme $X$ is affine, then the quotient scheme of $X$ always exists and has a simple interpretation. In fact, in this case $G$ has a left action on the ring $A$ of $X$, and the invariant subring $A^G$ then provides such a quotient.
\begin{proposition}\label{scheme affine finite group quotient prop}
Let $R$ be a ring, $A$ be an $R$-algebra with an $R$-linear action by $G$. Let $X=\Spec(A)$, $Y=\Spec(A^G)$, and $p:X\to Y$ be the canonical morphism.
\begin{enumerate}
\item[(a)] The morphism $p$ is integral and surjective.
\item[(b)] The fibers of $p$ are orbits of $G$, and $p$ is a quotient map.
\item[(c)] Let $x\in X$, $y=p(x)$, and $G_x$ be the stabilizer of $x$. Then $\kappa(x)$ is a normal extension of $\kappa(y)$ and the canonical map $G_x\to\Gal(\kappa(x)/\kappa(y))$ is surjective.
\item[(d)] $(Y,p)$ is a quotient scheme of $X$ by $G$.
\end{enumerate} 
\end{proposition}
\begin{proof}
The assertions (a), (b) and (c) follows from \cref{algebra action integral over fix point}, \cref{algebra finite group action prop} and the fact that an integral morphism is closed (\cref{scheme morphism integral is universally closed}). Finally, assertion (d) follows from \cref{scheme affine morphism char by ring homomorphism} and the fact that for any ring $B$, we have a canonical bijection
\begin{equation*}
\Hom_{\mathbf{Ring}}(B,A)^G\stackrel{\sim}{\to}\Hom_{\mathbf{Ring}}(B,A^G).\qedhere
\end{equation*}
\end{proof}
\begin{corollary}\label{scheme affine finite group quotient structure sheaf}
Under the hypotheses of \cref{scheme affine finite group quotient prop}, the canonical homomorphism $\mathscr{O}_Y\to p_*(\mathscr{O}_X)^G$ is an isomorphism.
\end{corollary}
\begin{proof}
By \cref{scheme affine associated sheaf direct image char}, the sheaf $p_*(\mathscr{O}_X)$ corresponds to the $A^G$-module $A$, so the corollary follows from the isomorphism $(S^{-1}A)^G=S^{-1}A^G$ of \cref{algebra action and localization}.
\end{proof}
\begin{proposition}\label{scheme finite group quotient char by affine morphism}
Let $S$ be a scheme, $X$ be a $G$-scheme over $S$ and $p:X\to Y$ be a $G$-invariant affine $S$-morphism such that $\mathscr{O}_Y\cong p_*(\mathscr{O}_X)^G$. Then the conditions of \cref{scheme affine finite group quotient prop} are satisfied.
\end{proposition}
\begin{proof}
Since conditions (a), (b) and (c) are local on $X$ and $Y$, we can assume that $Y=\Spec(B)$ and $X=\Spec(A)$ are both affine (since the morphism $p$ is affine). Then the hypothesis implies that $B=A^G$, so it suffices to apply \cref{scheme affine finite group quotient prop}. As for assertion (d), it suffices to note that $p:X\to Y$ is a quotient map.
\end{proof}
\begin{corollary}\label{scheme finite group quotient char by affine morphism restriction open}
Under the hypotheses of \cref{scheme finite group quotient char by affine morphism}, for any open subset $U$ of $Y$, the restriction $p^{-1}(U)\to U$ is a quotient $U$ by $G$.
\end{corollary}
\begin{proof}
This follows from the fact that the restriction $p|_{p^{-1}(U)}:p^{-1}(U)\to U$ also satisfies the hypotheses of \cref{scheme finite group quotient char by affine morphism}.
\end{proof}
\begin{corollary}\label{scheme finite group quotient affine separated ft iff}
Retain the hypotheses of \cref{scheme finite group quotient char by affine morphism}.
\begin{enumerate}
\item[(a)] For $X$ to be affine (resp. separated) over $S$, it is necessary and sufficient that $Y$ is affine (resp. separated) over $S$.
\item[(b)] If $X$ is of finite type over $S$, then it is finite over $Y$. If $S$ is also locally Noetherian, then $Y$ is of finite type over $S$.
\end{enumerate}
\end{corollary}
\begin{proof}
As $X$ is affine (and a fortiori separated) over $Y$, we see that $Y$ is affine (resp. separated) over $S$ if and only if $X$ is (\cref{scheme morphism separated permanence prop} and \cref{scheme affine morphism permanence prop}). Now if $X$ is of finite type over $Z$, so is it over $Y$, and hence finite over $Y$ (since $p:X\to Y$ is integral). If $S$ is also locally Noetherian, then since $Y$ is already quasi-compact over $S$ (\cref{scheme morphism qc permanence prop}), it suffices to show that $Y$ is locally of finite type over $S$, so we may assume that $X=\Spec(A)$, $Y=\Spec(B)$ and $S=\Spec(R)$ are affine. Then the ring $A$ is of finite type over $R$ and the conclusion follows from \cref{algebra action invariant subring finite over Noe}.
\end{proof}
Let $X$ be a $G$-scheme over a scheme $S$. If there exists a quotient scheme $(Y,p)$ of $X$ by $G$, we then say that $X$ is \textbf{admissible} (or an \textbf{admissible $\bm{G}$-scheme} over $S$). By \cref{scheme affine finite group quotient prop}, we see that any affine $G$-scheme over $S$ is admissible. In the general case, we have the following characterization for admissible $G$-schemes.
\begin{proposition}\label{scheme finite group admissible iff affine open}
Let $X$ be a $G$-scheme over a scheme $S$. Then the following conditions are equivelent:
\begin{enumerate}
\item[(\rmnum{1})] $X$ is admissible;
\item[(\rmnum{2})] $X$ is a union of affine open $G$-invariant subsets;
\item[(\rmnum{3})] any orbit of $G$ in $X$ is contained in an affine open subset.
\end{enumerate}
\end{proposition}
\begin{proof}
It is clear that (\rmnum{2})$\Rightarrow$(\rmnum{3}), and conversely, if an orbit $T$ of $G$ is contained in an affine open subset $U$, then the intersection $U'=\bigcap_{g\in G}g\cdot U$ is a $G$-invariant open subset containing $T$ and contained in the affine open $U$. As in $U$, any finite subset has a fundamental system of open affine neighborhoods, there exists an open affine neighborhood $V$ of $T$ contained in $U'$. The transforms of $V$ by $G$ are therefore affine and contained in $U'$, which is separate, so their intersection $U''$ is an affine open subset which is invariant under $G$ and contains $T$. Since $X$ is the union of orbits of $G$, we conclude that (\rmnum{3})$\Rightarrow$(\rmnum{2}).\par
We note that condition (\rmnum{2}) is necessary for (\rmnum{1}), since if $p:X\to Y$ is a quotient scheme of $X$ and $(V_\alpha)$ is an affine open covering of $Y$, then $U_\alpha=p^{-1}(V_\alpha)$ is $G$-invariant and affine in $X$, and they cover $X$. Conversely, if $(X_\alpha)$ is a covering of $X$ by $G$-invariant affine opens, then by \cref{scheme affine finite group quotient prop}, we can form the quotient $Y_\alpha=X_\alpha/G$; in each $Y_i$, the image of $X_i\cap X_j$ is an open subset $Y_{ij}$, which is identified with $X_{ij}/G$ in view of \cref{scheme finite group quotient char by affine morphism restriction open}. In particular, we deduce an isomorphism $Y_{ij}\cong Y_{ji}$, so we can glue $Y_i$ to construct $Y$.
\end{proof}
\begin{corollary}\label{scheme finite group admissible pass to subgroup}
If $X$ is an admissible $G$-scheme, then it is admissible for any subgroup $H$ of $G$.
\end{corollary}
\begin{corollary}\label{scheme S-affine finite group quotient char}
Let $S$ be a scheme and suppose that $X$ is a $G$-scheme over $S$ which is affine over $S$. Then $X$ is admissible; in fact, if $X$ is defined by the quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{A}$, then its quotient $Y$ is defined by the quasi-coherent algebra $\mathscr{A}^G$.
\end{corollary}
\begin{proof}
We may assume that $X=\Spec(A)$ and $S=\Spec(R)$ are affine, where $A$ is an $R$-algebra. Then by \cref{scheme affine finite group quotient prop} the quotient is defined by the $R$-algebra $A^G$, so the conclusion follows.
\end{proof}
\begin{proposition}\label{scheme finite group quotient flat base change prop}
Let $X$ be an admissible $G$-scheme over $S$ and $p:X\to Y$ be its quotient scheme. Consider a base change $S'\to S$ and put $X'=X\times_SS'$, $Y'=Y\times_SS'$, so that $X'$ is a $G$-scheme over $S'$ and the morphism $p':X'\to Y'$ is $G$-invariant. If $S'$ is flat over $S$, then $(Y',p')$ is the quotient of $X'$ by $G$. In other words, we have an isomorphism
\[(X/G)\times_SS'\cong(X\times_SS')/G\]
\end{proposition}
\begin{proof}
We can evidently assume that $S$, $X$ and $Y$ are affine. It then suffices to prove that, if $A$ is an $R$-algebra acted by $G$ and $B=A^G$ is the invariant subring, then for any flat $R$-algebra $R'$, the invairant subring of $A'=A\times_RR'$ is identified with $B'=B\otimes_RR'$. To see this, note that the subring $B$ is characterized by the exact sequence
\[\begin{tikzcd}
0\ar[r]&B\ar[r]&A\ar[r,"\varphi_A"]&\prod_{g\in G}A\ar[r]&0
\end{tikzcd}\]
where the homomorphism $\varphi_A$ is defined by $x\mapsto(gx-x)_{g\in G}$. Since the induced homomorphism $\varphi_A\otimes 1_{R'}:A'\to A'$ is identified with $\varphi_{A'}$ and $R'$ is flat over $R$, the conclusion follows.
\end{proof}
\begin{remark}
We note that the flatness assumption is essential for \cref{scheme finite group quotient flat base change prop}. For example, if $Y'$ is a closed subscheme of $Y$ and $X'$ is its inverse image under $p$, then $Y'$ is not necessarily isomorphic to the quotient $X'/G$. However, as we shall see, this is true if $X$ is \'etale over $Y$.
\end{remark}
\subsection{Decomposition groups and inertia groups}\label{scheme admmitible decomposition and inertia group subsection}
Let $G$ be a finite group and $X$ be a $G$-scheme. For $x\in X$, the stabilizer subgroup of $x$ is called the \textbf{decomposition group} of $x$, and denoted by $G^Z(x)$. This group has a canonical action on the residue field $\kappa(x)$, and the kernel of the canonical homomorphism $G^Z(x)\to\Aut(\kappa(x))$ is called the \textbf{inertia group} of $x$, and denoted by $G^T(x)$.\par
Let $\Omega$ be a separably closed field and $\xi:\Spec(\Omega)\to X$ be a geometric point of $X$ which image $x$. Then $G$ acts on the set of $\Omega$-points $X(\Omega)$, and the inertia group of $x$ is identified with the stabilizer of $\xi$:
\[G^T(x)=\{g\in G:g\xi=\xi\}.\]
Using this interpretation of the inertia subgroup, we can prove the following fact:
\begin{proposition}\label{scheme admissible G^T base change invariant}
For any base change morphism $S'\to S$, let $X'=X\times_SS'$, $x'$ be a point of $X'$, and $x$ be its image in $X$. Then we have $G^T(x')=G^T(x)$.
\end{proposition}
\begin{proof}
It suffices to choose $\Omega$ large enough so that it is an extension of $\kappa(s')$ (where $s'$ is the image of $x'$ in $S'$).
\end{proof}
\begin{proposition}\label{scheme admissible quotient by subgroup G^Z G^T prop}
Let $X$ be an admissible $G$-scheme, $p:X\to Y$ be its quotient, and suppose that $Y$ is locally Noetherian and $p$ is finite. Let $H$ be a subgroup of $G$ and consider $X'=X/H$. Let $x\in X$, $x'$ be its image in $X'$, and $y=p(x)$.
\begin{enumerate}
\item[(a)] If $H\sups G^T(x)$, then the homomorphism $p^\#_{x'}:\mathscr{O}_{Y,y}\to\mathscr{O}_{X',x'}$ is \'etale.
\item[(b)] If $H\sups G^Z(x)$, then the homomorphism $p^\#_{x'}:\mathscr{O}_{Y,y}\to\mathscr{O}_{X',x'}$ induces an isomorphism on completions.
\end{enumerate}
\end{proposition}
\begin{proof}
Since $Y$ is locally Noetherian, the local scheme $Y'=\Spec(\widehat{\mathscr{O}_{Y,y}})$ is flat over $Y$, so by considering the base change $Y'\to Y$ and use \cref{scheme finite group quotient flat base change prop}, we may assume that $Y$ is the spectrum of a complete Noetherian local ring and $X$ is the specturm of a finite $A$-algebra $B$. If $H\sups G^Z(x)$, then by \cref{algebra finite subgroup fixed ring prop}(b), $\kappa(x')$ is identified with $\kappa(y)$ and $\m_y$ generates the maximal ideal of $\m_{x'}$, so the homomorphism $p^\#_{x'}:\mathscr{O}_{Y,y}\to\mathscr{O}_{X',x'}$ induces an isomorphism on completions. Assertion (a) then follows from (b) if we make a flat base change of $Y$ so that $G^Z(x)=G^T(x)$ (\cref{scheme admissible G^T base change invariant}).
\end{proof}
\begin{corollary}\label{scheme admissible quotient etale if inertia trivial}
Under the conditions of \cref{scheme admissible quotient by subgroup G^Z G^T prop}, suppose that $G^T(x)$ is trivial. Then $X$ is \'etale over $Y$ at $x$.
\end{corollary}
\begin{corollary}\label{scheme admissible connected faithful quotient etale iff inertia trivial}
Suppose that $X$ is connected and the action of $G$ is faithful on $X$. For $X$ to be \'etale over $Y$, it is necessary and sufficient that the inertia groups of $X$ are trivial. In this case, $G$ is identified with the group of $Y$-automorphisms of $X$.
\end{corollary}
\begin{proof}
In view of \cref{scheme admissible quotient etale if inertia trivial}, it suffices to suppose that $X$ is \'etale over $Y$. Let $x\in X$ and $g\in G^T(x)$, then it follows from \cref{scheme unramified factor through ker iff locally equal on kappa} that $g$ acts trivially on $X$, and hence equals to the identity since $G$ acts faithfully on $X$.
\end{proof}
\begin{proposition}\label{scheme sp etale over local Noe quotient etale}
Let $S$ be a locally Noetherian scheme, $X$ be a separated and \'etale scheme of finite type over $S$, and $G$ be a finite group of $S$-automorphisms of $X$. Then the $G$-scheme $X$ is admissible and the quotient scheme $X/G$ is \'etale over $S$.
\end{proposition}
\begin{proof}
Since $X$ is separated and \'etale over $S$, it is quasi-projective over $S$ (\cite{EGA4}, 8.11.2), so the existence of $X/G$ follows from \cref{scheme finite group admissible iff affine open}(\rmnum{3}). To see that $X/G$ is \'etale over $S$, we may assume that $G$ acts transitively on the set of connected components of $X$, and by considering the stabilizer of a connected component, that $X$ is connected. Finally, we can assume that $G$ acts faithfully on $X$. But then the inertia groups of $X$ are trivial, so it follows from \cref{scheme admissible quotient etale if inertia trivial} that $p:X\to X/G$ is \'etale. To see that $X/G$ is then \'etale over $S$, we consider a point $x\in X$ and let $y=p(x)$, $s=\varphi(x)$ (where $\varphi:X\to S$ is the structural morphism). By taking a flat base change, we may assume that $\kappa(s)$ is separably closed, so by \cref{scheme morphism local fp over local Noe etale at point iff}, the induced homomorphisms $\widehat{\mathscr{O}_{Y,y}}\to\widehat{\mathscr{O}_{X,x}}$ and $\widehat{\mathscr{O}_{S,s}}\to\widehat{\mathscr{O}_{X,x}}$ are bijective, so $\widehat{\mathscr{O}_{S,s}}\to\widehat{\mathscr{O}_{Y,y}}$ is bijective and $X/S$ is \'etale over $S$ by \cref{scheme morphism local fp over local Noe etale at point iff}.
\end{proof}
\begin{corollary}\label{scheme finite etale over local Noe quotient finite etale}
If $X$ is finite \'etale over $S$, then $X/G$ is finite \'etale over $S$.
\end{corollary}
\begin{proof}
By \cref{scheme S-affine finite group quotient char}, if $X$ is defined by the quasi-coherent $\mathscr{O}_S$-algebra $\mathscr{A}$, then $X/G$ is defined by $\mathscr{A}^G$. By assumption $\mathscr{A}$ is a finite $\mathscr{O}_S$-algebra, so its subalgebra $\mathscr{A}^G$ is also finite over $S$, since $S$ is locally Noetherian.
\end{proof}
\subsection{The Galois category \texorpdfstring{$\mathbf{FEt}_{S}$}{FEt}}
Let $S$ be a locally Noetherian and connected scheme. We denote by $\mathbf{FEt}_{S}$ the category of finite \'etale coverings of $S$, with morphisms given by $S$-morphisms of finite \'etale coverings of $S$. Any object $X$ of $\mathbf{FEt}_X$ is often call a finite \'etale cover of $S$ (even if $X$ is empty). It is clear that there is a canonical functor $p:\mathbf{FEt}_S\to\mathbf{Sch}_S$.
\begin{example}\label{scheme separably closed field FEt cat char}
Let $k$ be a separably closed field and $S=\Spec(k)$. In this case $\mathbf{FEt}_{S}$ is equivalent to the category of finite sets: in fact, a scheme tale over $k$ is the disjoint union of spectra of fields finite separable over $k$, whose underlying space is finite. Conversely, a finite set with $n$ points is uniquely endowed with the structure of a scheme \'etale over $k$, that is, the specturm $\Spec(k^n)$.
\end{example}
Consider now a geometric point $\bar{s}:\Spec(\Omega)\to S$ of $S$, with values in an algebraically closed field $\Omega$. For an \'etale covering $X$ of $S$, we define $F_{\bar{s}}(X)$ to be the underlying set of the fiber $X_{\bar{s}}=X\times_S\bar{s}$. Since $X_{\bar{s}}$ is finite and \'etale over $\bar{s}$, it is a disjoint union of copies of $\bar{s}$ (\cref{scheme separably closed field FEt cat char}), so $F_{\bar{s}}(X)$ can also be considered as the set of geometric points $\Spec(\Omega)\to X$ lying over $\bar{s}$, in other words,
\[F_{\bar{s}}(X)=\Hom_S(\bar{s},X).\]
The assignment $X\mapsto F(X)$ is clearly functorial on $X$, hence defines a functor $F_{\bar{s}}:\mathbf{FEt}_{S}\to\mathbf{FSet}$.
\begin{proposition}\label{scheme finite etale cat is Galois}
The pair $(\mathbf{FEt}_{S},F_{\bar{s}})$ form a Galois category.
\end{proposition}
\begin{proof}
After identifying $\mathbf{FEt}_{\bar{x}}$ with the category of finite sets (\cref{scheme separably closed field FEt cat char}), we see that our functor $F_{\bar{s}}$ is nothing but the base change functor under the morphism $\bar{s}\to S$. Condition (G1) follows from \cref{scheme unramified smooth permanence prop}, (G2) follows from (\cref{scheme finite etale over local Noe quotient finite etale}), (G3) from (\cite{SGA1}, 5.3.5), and (G4) is trivial by definition. On the other hand, (G5) follows from (\cite{SGA1}, 5.3.5) and the begining of \cref{scheme admmitible decomposition and inertia group subsection}, and (G6) is proved in (\cite{SGA1}, 5.3.7).
\end{proof}
We can therefore apply the results proved in \cref{Galois category section}, which permits us in particular to define a pro-object $P$ of $\mathbf{FEt}_{S}$ representing $F_{\bar{s}}$, which is called the \textbf{universal covering} of $S$ at $s$, and a topological group $\pi=\Aut(F_{\bar{s}})=\Aut^0(P)$, called the \textbf{\'etale fundamental group} of $S$ at $s$, denoted by $\pi_1(S,\bar{s})$. The functor $F$ then defines an equivalence from $\mathbf{FEt}_{S}$ to the category of finite $\pi$-sets, where $\pi=\pi_1(S,\bar{s})$. This equivalence allows us to interpret the operations of projective limits and finite inductive limits on coverings (products, fiber products, sums, passing to quotients, etc.) in terms of the analogues operations on $\pi$-$\mathbf{FSet}$, i.e. in terms of the obvious operations over finite $\pi$-sets. We also note that, since the topological connected components of an \'etale covering are also \'etale coverings, an object $X$ in $\mathbf{FEt}_{S}$ is connected in $\mathbf{FEt}_{S}$ if and only if it is topological connected; in view of (\cite{SGA1}, 5.5.3), this signifies that $\pi$ acts transitively on $F_{\bar{s}}(X)$. Note that for an object $X$ in $\mathbf{FEt}_{S}$ to be faithfully flat and quasi-compact over $S$ (it is already flat and quasi-compact over $S$), it is necessary and sufficient that the structural morphism $X\to S$ is surjective, i.e., is an epimorphism in $\mathbf{FEt}_{S}$, or that $X\neq\emp$.\par
If $\bar{s}'$ is another geometric point of $S$ (corresponding to an algebraically closed field $\Omega'$), then it defines a fiber functor $F'=F_{\bar{s}'}$ over $\mathbf{FEt}_{S}$, which is necessarily isomorphic to $F=F_{\bar{s}}$. Therefore, the fundamental group $\pi_1(S,s)$ is independent of $\bar{s}$ up to isomorphisms. If we denote by $\pi_1(S;s,s')$ the set of these isomorphisms (which can also be regareded as the set of isomorphisms $F_{\bar{s}}\to F_{\bar{s}'}$), then we obtain a groupoid whose objects are geometric points of $S$, and the fundamental group being the automorphism of these objects. The set $\pi_1(S;\bar{s},\bar{s}')$ can also be considered as the set of path classes from $\bar{s}$ to $\bar{s}'$, which has an evident composition law. Finally, we can define a pro-group $\Pi_1^S$ of $\mathbf{FEt}_{S}$, called the \textbf{fundamental pro-group of $\bm{S}$} or \textbf{local system of fundamental groups over $\bm{S}$}, by the condition that we have a functorial isomorphism at the geometric point $\bar{s}$ of $S$:
\[F_{\bar{s}}(\Pi_1^S)=\pi_1(S,\bar{s}).\]
(cf. \cite{SGA1}, remarique 5.5.10). In particular, if $s$ is an ordinary point of $S$, the fiber of $\Pi_1^S$ at $s$ is a pro-group over $\kappa(s)$, which is the projective limit of finite \'etale groups over $\kappa(s)$. This pro-group is the called the \textbf{fundamental group of $\bm{S}$ at the point $\bm{s}$}, and denoted by $\pi_1(S,s)$. By definition, the points with values in an algebraically closed extension $\Omega$ of $\kappa(s)$ are exactly the elements of $\pi_1(S,\bar{s})$, where $\bar{s}$ is the geometric point of $S$ defined by this extension. In particular, (by taking $S$ to be the spectrum of a field) any field $k$ is canonically associated with a pro-group over $k$, denoted by $\pi_1(k)$, which is the projective limit of finite \'etale groups over $k$, and whose points in an algebraically closed extension $\Omega$ of $k$ is identified with the elements of the Galois group of $\widebar{k}/k$, where $\widebar{k}$ is the Galois closure of $k$ in $\Omega$.\par
Now let $f:S'\to S$ be a morphism of locally Noetherian connected schemes, $\bar{s}'$ be a geometric point of $S'$, and $\bar{s}=f(\bar{s}')$ be its image in $S$. Then the inverse image functor induces a functor of categories:
\[f^*:\mathbf{FEt}_{S}\to\mathbf{FEt}_{S'}\]
and we have a functorial isomorphism $F_{\bar{s}}\stackrel{\sim}{\to}F_{\bar{s}'}\circ f^*$, so that $f^*$ is an exact functor and we have a commutative diagram
\[\begin{tikzcd}
\mathbf{FEt}_{S}\ar[r,"\text{base change}"]\ar[d]\ar[d,"F_{\bar{s}}"]&\mathbf{FEt}_{S'}\ar[d,"F_{\bar{s}'}"]\\
\text{$\pi(S,\bar{s})$-$\mathbf{FSet}$}\ar[r,"f^*"]&\text{$\pi(S',\bar{s}')$-$\mathbf{FSet}$}
\end{tikzcd}\]
We have in particular a canonical homomorphism
\[f_*=\pi_1(f,\bar{s}'):\pi_1(S',\bar{s}')\to\pi_1(S,\bar{s})\]
which allows us to consider the inverse image functor as an operation of restriction of the group action. The properties of the function $f^*$ are therefore expressed in a simple way by the properties of the homomorphism of the associated groups. If in particular $S'$ is an \'etale covering of $S$, then the homomorphism $f_*$ is an isomorphism from $\pi_1(S',\bar{s}')$ onto an open subgroup of $\pi_1(S,\bar{s})$ defining the \'etale covering $S'$ of $S$ (i.e. the stabilizer of $\bar{s}'\in F_{\bar{s}}(S')$ in $\pi_1(S,\bar{s})$).
\begin{proposition}\label{scheme etale fundamental group and absolute Galois group}
Let $S$ be the spectrum of a field $k$, and $\Omega$ be an algebraically closed extension of $k$, defining a geometric point $\bar{s}$ of $S$ with values in $\Omega$. Let $k^{\sep}$ be the separable closure of $k$ in $\Omega$. Then there exists a canonical isomorphism $\pi_1(S,\bar{s})\stackrel{\sim}{\to}\Gal(k^{\sep}/k)$.
\end{proposition}
\begin{proof}
Let $\widebar{k}$ be the algebraic closure of $k$ in $\Omega$, which corresponds to a geometric point $\bar{s}'$ of $S$ with values in $k'$. The natural homomorphism $F_{\bar{s}'}\to F_{\bar{s}}$ is evidently an isomorphism, because any scheme $X$ \'etale over $S$ we have
\[\Hom_S(\bar{s},Y)=\Hom_S(\bar{s}',Y)\]
In fact, $X$ is then isomorphic to the spectrum of finite separable fields extensions of $k$ in $\Omega$, and any such extension necessairly lies in $k^{\sep}$, hence in $\widebar{k}$. On the other hand, the group $G=\Gal(\widebar{k}/k)=\Gal(k^{\sep}/k)$ clearly acts on $F_{\bar{s}'}$, so we have a homomorphism
\[G\to\Aut(F_{\bar{s}'})\stackrel{\sim}{\to}\Aut(F_{\bar{s}})=\pi_1(S,\bar{s}).\]
We then obtain a continuous homomorphism $G\to\pi_1(S,\bar{s})$, and it remains to prove that this is an isomorphism. To this end, note that this homomorphism is injective because any element in its kernel is an autumorphism of $\widebar{k}/k$ which induces the identity on any finite separated extension of $k$, hence trivial. It is surjective because if $X$ is a connected \'etale covering of $S$, hence defined by a finite separable extension $L/k$, then $G$ is transitive on the set of $k$-homorphisms of $L$ into $\widebar{k}$.
\end{proof}
\begin{remark}\label{scheme etale pi_1 and absolute Galois group}
We can in fact write out the explicit isomorphism of \cref{scheme etale pi_1 and absolute Galois group}. Observe that $\Gal(k^{\sep}/k)=\Gal(\widebar{k}/k)$ and $F_{\bar{s}}(X)=\Hom_S(\Spec(\widebar{k}),Y)$, so we can consider the map
\[\Gal(\widebar{k}/k)\times F_{\bar{s}}(X)\to F_{\bar{s}}(X),\quad (\sigma,\bar{x})\mapsto \bar{x}\circ{^a\sigma}\]
where $^a\sigma$ is the induced automorphism on $\Spec(\widebar{k})$. This defines an action of $\Gal(\widebar{k}/k)$ on $F_{\bar{s}}$ since
\[\sigma\tau\cdot\bar{x}=\bar{x}\circ{^a(\sigma\tau)}=\bar{x}\circ{^{a}\tau}\circ{^{a}\sigma}=\sigma\cdot(\tau\cdot\bar{x}).\]
The action is clearly functorial on $X$, so we obtain the canonical homomorpism $\Gal(\widebar{k}/k)\to\pi_1(S,\bar{s})$.
\end{remark}
\begin{proposition}\label{scheme normal pi_1 quotient of function field}
Let $S$ be a connected, locally Noetherian and integral normal scheme, $K$ be the function field of $S$, $\Omega$ be an algebraically closed extension of $K$ corresponding to a geometric point $\bar{s}'$ of $S'=\Spec(K)$ and a geometric point $\bar{s}$ of $S$. Then the canonical homomorphism $\pi_1(S',\bar{s}')\to\pi_1(S,\bar{s})$ is surjective. If we identify $\pi_1(S',\bar{s}')$ with the absolute Galois group $\Gal(K^{\sep}/K)$ of $K$ in $\Omega$, then the kernel of this homomorphism corresponds to the Galois group of the subextension $M/K$, where $M$ is the composite of finite extensions $L$ of $k$ in $\Omega$, which are unramified over $S$. 
\end{proposition}
\begin{proof}
The first assertion signifies that the inverse image under $S'$ of a connected \'etale covering $X$ of $S$ is connected, i.e. that $X$ is integral; this follows from (\cite{SGA1} 1.10.1). The kernel of this homomorphism can be interpreted as the automorphisms of $K^{\sep}/K$ which induces identity on the set $F_{\bar{s}}(X)$, where we can assume that the \'etale covering $X$ of $S$ is connected. But this then signifies, in view of the fact that $X_{\bar{s}}$ is \'etale over $\bar{s}$, that these automotphisms induce identity on the finite subextensions of $K^{\sep}/K$ which are unramified over $S$, whence our assertion.
\end{proof}